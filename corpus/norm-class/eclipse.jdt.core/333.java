copyright ibm corporation rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors ibm corporation initial api implementation org eclipse jdt internal core java buffered input stream bufferedinputstream java buffered output stream bufferedoutputstream java data input stream datainputstream java data output stream dataoutputstream java file java file input stream fileinputstream java file output stream fileoutputstream java io exception ioexception java util org eclipse core resources org eclipse core runtime org eclipse jdt core org eclipse jdt internal core java model manager javamodelmanager per project info perprojectinfo org eclipse jdt internal core util util global java element delta processing suppress warnings suppresswarnings rawtypes unchecked delta processing state deltaprocessingstate i resource change listener iresourcechangelistener collection listeners java element deltas i element changed listener ielementchangedlistener element changed listeners elementchangedlisteners i element changed listener ielementchangedlistener element changed listener masks elementchangedlistenermasks element changed listener count elementchangedlistenercount collection pre java resource change listeners i resource change listener iresourcechangelistener pre resource change listeners preresourcechangelisteners i resource change listener iresourcechangelistener pre resource change event masks preresourcechangeeventmasks pre resource change listener count preresourcechangelistenercount delta processor current thread thread local threadlocal delta processors deltaprocessors thread local threadlocal do not use donotuse reset delta processor current thread avoid memory https bugs eclipse org bugs bug cgi delta processors deltaprocessors table i path ipath classpath entry delta processor deltaprocessor root info rootinfo hash map hashmap roots hash map hashmap table i path ipath classpath entry array list arraylist delta processor deltaprocessor root info rootinfo i path ipath corresponds root hash map hashmap other roots otherroots hash map hashmap table i path ipath classpath entry delta processor deltaprocessor root info rootinfo time delta processor invoked hash map hashmap old roots oldroots hash map hashmap table i path ipath classpath entry array list arraylist delta processor deltaprocessor root info rootinfo time delta processor invoked i path ipath corresponds root hash map hashmap old other roots oldotherroots hash map hashmap table i path ipath source attachment path classpath entry i path ipath root path hash map hashmap source attachments sourceattachments hash map hashmap table i java project ijavaproject i java project ijavaproject list direct dependent key hash map hashmap project dependencies projectdependencies hash map hashmap roots tab les tables recomputed roots are stale rootsarestale threads running initialize roots initializeroots initial izing threads initializingthreads collections synchronized set synchronizedset hash set hashset table file system abs oulte absoulte path string timestamp hashtable external time stamps externaltimestamps map i project iproject classpath change classpathchange note delta processing ensure don loose https bugs eclipse org bugs bug cgi java model corrupt switching target platform hash map hashmap classpath changes classpathchanges hash map hashmap table java project javaproject classpath validation classpathvalidation hash map hashmap classpath valid ations classpathvalidations hash map hashmap table java project javaproject project reference change projectreferencechange hash map hashmap project reference changes projectreferencechanges hash map hashmap table java project javaproject external folder change externalfolderchange hash map hashmap external folder changes externalfolderchanges hash map hashmap workaround bug circular errors reported cache projects project add ition addition deletion started hash set hashset java project names cache javaprojectnamescache list i java element ijavaelement scope external archives refresh post change refresh needed hash set hashset external elements to refresh externalelementstorefresh clone def ensively defensively listener listener reacting not ification notification iteration adding changing removing deregisters add element changed listener addelementchangedlistener i element changed listener ielementchangedlistener listener event mask eventmask element changed listener count elementchangedlistenercount element changed listeners elementchangedlisteners listener clone masks middle not ifications notifications listener decide change event mask listeners not ified notified clone length clonelength element changed listener masks elementchangedlistenermasks length system arraycopy element changed listener masks elementchangedlistenermasks element changed listener masks elementchangedlistenermasks clone length clonelength clone length clonelength element changed listener masks elementchangedlistenermasks event mask eventmask grow clone iter ators iterators cached original arrays max boundary add length length element changed listeners elementchangedlisteners length element changed listener count elementchangedlistenercount system arraycopy element changed listeners elementchangedlisteners element changed listeners elementchangedlisteners i element changed listener ielementchangedlistener length length system arraycopy element changed listener masks elementchangedlistenermasks element changed listener masks elementchangedlistenermasks length length element changed listeners elementchangedlisteners element changed listener count elementchangedlistenercount listener element changed listener masks elementchangedlistenermasks element changed listener count elementchangedlistenercount event mask eventmask element changed listener count elementchangedlistenercount adds element list elements scope external jars refresh add for refresh addforrefresh i java element ijavaelement external element externalelement external elements to refresh externalelementstorefresh external elements to refresh externalelementstorefresh hash set hashset external elements to refresh externalelementstorefresh add external element externalelement add pre resource changed listener addpreresourcechangedlistener i resource change listener iresourcechangelistener listener event mask eventmask pre resource change listener count preresourcechangelistenercount pre resource change listeners preresourcechangelisteners listener pre resource change event masks preresourcechangeeventmasks event mask eventmask grow clone iter ators iterators cached original arrays max boundary add length length pre resource change listeners preresourcechangelisteners length pre resource change listener count preresourcechangelistenercount system arraycopy pre resource change listeners preresourcechangelisteners pre resource change listeners preresourcechangelisteners i resource change listener iresourcechangelistener length length system arraycopy pre resource change event masks preresourcechangeeventmasks pre resource change event masks preresourcechangeeventmasks length length pre resource change listeners preresourcechangelisteners pre resource change listener count preresourcechangelistenercount listener pre resource change event masks preresourcechangeeventmasks pre resource change listener count preresourcechangelistenercount event mask eventmask pre resource change listener count preresourcechangelistenercount delta processor deltaprocessor get delta processor getdeltaprocessor delta processor deltaprocessor delta processor deltaprocessor delta processor deltaprocessor delta processors deltaprocessors delta processor deltaprocessor delta processor deltaprocessor delta processor deltaprocessor delta processor deltaprocessor java model manager javamodelmanager get java model manager getjavamodelmanager delta processors deltaprocessors delta processor deltaprocessor delta processor deltaprocessor classpath change classpathchange add classpath change addclasspathchange i project iproject project i classpath entry iclasspathentry old raw classpath oldrawclasspath i path ipath old output location oldoutputlocation i classpath entry iclasspathentry old resolved classpath oldresolvedclasspath classpath changes classpathchanges classpath change classpathchange change classpath change classpathchange classpath changes classpathchanges project change change classpath change classpathchange java project javaproject java model manager javamodelmanager get java model manager getjavamodelmanager get java model getjavamodel get java project getjavaproject project old raw classpath oldrawclasspath old output location oldoutputlocation old resolved classpath oldresolvedclasspath classpath changes classpathchanges project change change old raw classpath oldrawclasspath change old raw classpath oldrawclasspath old raw classpath oldrawclasspath change old output location oldoutputlocation change old output location oldoutputlocation old output location oldoutputlocation change old resolved classpath oldresolvedclasspath change old resolved classpath oldresolvedclasspath old resolved classpath oldresolvedclasspath change classpath change classpathchange get classpath change getclasspathchange i project iproject project classpath changes classpathchanges classpath change classpathchange classpath changes classpathchanges project hash map hashmap remove all classpath changes removeallclasspathchanges classpath changes classpathchanges hash map hashmap result classpath changes classpathchanges classpath changes classpathchanges hash map hashmap result size result classpath validation classpathvalidation add classpath validation addclasspathvalidation java project javaproject project classpath validation classpathvalidation validation classpath validation classpathvalidation classpath valid ations classpathvalidations project validation validation classpath validation classpathvalidation project classpath valid ations classpathvalidations project validation validation add external folder change addexternalfolderchange java project javaproject project i classpath entry iclasspathentry old resolved classpath oldresolvedclasspath external folder change externalfolderchange change external folder change externalfolderchange external folder changes externalfolderchanges project change change external folder change externalfolderchange project old resolved classpath oldresolvedclasspath external folder changes externalfolderchanges project change add project reference change addprojectreferencechange java project javaproject project i classpath entry iclasspathentry old resolved classpath oldresolvedclasspath project reference change projectreferencechange change project reference change projectreferencechange project reference changes projectreferencechanges project change change project reference change projectreferencechange project old resolved classpath oldresolvedclasspath project reference changes projectreferencechanges project change initialize roots initializeroots init after load initafterload recompute root infos hash map hashmap root infos rootinfos roots are stale rootsarestale thread current thread currentthread thread current thread currentthread added current thread addedcurrentthread https bugs eclipse org bugs bug cgi initial izing threads initializingthreads add current thread currentthread added current thread addedcurrentthread class paths classpaths workspace resolved ensure containers initialized batch java model manager javamodelmanager get java model manager getjavamodelmanager force batch initializations forcebatchinitializations init after load initafterload root infos rootinfos get root infos getrootinfos don previous session values added current thread addedcurrentthread initial izing threads initializingthreads remove current thread currentthread old roots oldroots roots old other roots oldotherroots other roots otherroots check roots are stale rootsarestale root infos rootinfos roots root infos rootinfos other roots otherroots root infos rootinfos source attachments sourceattachments root infos rootinfos project dependencies projectdependencies root infos rootinfos roots are stale rootsarestale initialize roots with previous session initializerootswithprevioussession hash map hashmap root infos rootinfos get root infos getrootinfos previous session values root infos rootinfos roots root infos rootinfos other roots otherroots root infos rootinfos source attachments sourceattachments root infos rootinfos project dependencies projectdependencies root infos rootinfos roots are stale rootsarestale hash map hashmap get root infos getrootinfos use previous session useprevioussession hash map hashmap new roots newroots hash map hashmap hash map hashmap new other roots newotherroots hash map hashmap hash map hashmap new source attachments newsourceattachments hash map hashmap hash map hashmap new project dependencies newprojectdependencies hash map hashmap i java model ijavamodel model java model manager javamodelmanager get java model manager getjavamodelmanager get java model getjavamodel i java project ijavaproject projects projects model get java projects getjavaprojects java model exception javamodelexception length projects length length java project javaproject project java project javaproject projects i classpath entry iclasspathentry classpath use previous session useprevioussession per project info perprojectinfo per project info perprojectinfo project get per project info getperprojectinfo project resolve classpath resolveclasspath per project info perprojectinfo previous session values don add classpath change classpath per project info perprojectinfo resolved classpath resolvedclasspath classpath project get resolved classpath getresolvedclasspath java model exception javamodelexception classpath length classpathlength classpath length classpath length classpathlength i classpath entry iclasspathentry entry classpath entry get entry kind getentrykind i classpath entry iclasspathentry cpe project todo jerome reuse handle i java project ijavaproject key model get java project getjavaproject entry get path getpath segment i java project ijavaproject dependents i java project ijavaproject new project dependencies newprojectdependencies key dependents dependents i java project ijavaproject project dependents length dependentslength dependents length system arraycopy dependents dependents i java project ijavaproject dependents length dependentslength dependents length dependentslength dependents dependents length dependentslength project new project dependencies newprojectdependencies key dependents root path i path ipath path entry get path getpath new roots newroots path new roots newroots path delta processor deltaprocessor root info rootinfo project path classpath entry classpathentry entry full inclusion pattern chars fullinclusionpatternchars classpath entry classpathentry entry full exclusion pattern chars fullexclusionpatternchars entry get entry kind getentrykind array list arraylist root list rootlist array list arraylist new other roots newotherroots path root list rootlist root list rootlist array list arraylist new other roots newotherroots path root list rootlist root list rootlist add delta processor deltaprocessor root info rootinfo project path classpath entry classpathentry entry full inclusion pattern chars fullinclusionpatternchars classpath entry classpathentry entry full exclusion pattern chars fullexclusionpatternchars entry get entry kind getentrykind source attachment path entry get entry kind getentrykind i classpath entry iclasspathentry cpe library string property string propertystring property string propertystring util get source attachment property getsourceattachmentproperty path java model exception javamodelexception print stack trace printstacktrace i path ipath source attachment path sourceattachmentpath property string propertystring property string propertystring last index of lastindexof package fragment root packagefragmentroot attachment property delimiter source attachment path sourceattachmentpath path property string propertystring path property string propertystring substring source attachment path sourceattachmentpath entry get source attachment path getsourceattachmentpath source attachment path sourceattachmentpath new source attachments newsourceattachments source attachment path sourceattachmentpath path hash map hashmap new roots newroots new other roots newotherroots new source attachments newsourceattachments new project dependencies newprojectdependencies classpath validation classpathvalidation remove classpath valid ations removeclasspathvalidations length classpath valid ations classpathvalidations size length classpath validation classpathvalidation valid ations validations classpath validation classpathvalidation length classpath valid ations classpathvalidations values to array toarray valid ations validations classpath valid ations classpathvalidations clear valid ations validations external folder change externalfolderchange remove external folder changes removeexternalfolderchanges length external folder changes externalfolderchanges size length external folder change externalfolderchange updates external folder change externalfolderchange length external folder changes externalfolderchanges values to array toarray updates external folder changes externalfolderchanges clear updates project reference change projectreferencechange remove project reference changes removeprojectreferencechanges length project reference changes projectreferencechanges size length project reference change projectreferencechange updates project reference change projectreferencechange length project reference changes projectreferencechanges values to array toarray updates project reference changes projectreferencechanges clear updates hash set hashset remove external elements to refresh removeexternalelementstorefresh hash set hashset result external elements to refresh externalelementstorefresh external elements to refresh externalelementstorefresh result remove element changed listener removeelementchangedlistener i element changed listener ielementchangedlistener listener element changed listener count elementchangedlistenercount element changed listeners elementchangedlisteners listener clone def ensively defensively middle listener not ifications notifications fire length element changed listeners elementchangedlisteners length i element changed listener ielementchangedlistener new listeners newlisteners i element changed listener ielementchangedlistener length system arraycopy element changed listeners elementchangedlisteners new listeners newlisteners new masks newmasks length system arraycopy element changed listener masks elementchangedlistenermasks new masks newmasks copy trailing listeners trailing length trailinglength element changed listener count elementchangedlistenercount trailing length trailinglength system arraycopy element changed listeners elementchangedlisteners new listeners newlisteners trailing length trailinglength system arraycopy element changed listener masks elementchangedlistenermasks new masks newmasks trailing length trailinglength update manager listener fire iter ate iterate original listeners local variable hold original element changed listeners elementchangedlisteners new listeners newlisteners element changed listener masks elementchangedlistenermasks new masks newmasks element changed listener count elementchangedlistenercount remove pre resource changed listener removepreresourcechangedlistener i resource change listener iresourcechangelistener listener pre resource change listener count preresourcechangelistenercount pre resource change listeners preresourcechangelisteners listener clone def ensively defensively middle listener not ifications notifications fire length pre resource change listeners preresourcechangelisteners length i resource change listener iresourcechangelistener new listeners newlisteners i resource change listener iresourcechangelistener length new event masks neweventmasks length system arraycopy pre resource change listeners preresourcechangelisteners new listeners newlisteners system arraycopy pre resource change event masks preresourcechangeeventmasks new event masks neweventmasks copy trailing listeners trailing length trailinglength pre resource change listener count preresourcechangelistenercount trailing length trailinglength system arraycopy pre resource change listeners preresourcechangelisteners new listeners newlisteners trailing length trailinglength system arraycopy pre resource change event masks preresourcechangeeventmasks new event masks neweventmasks trailing length trailinglength update manager listener fire iter ate iterate original listeners local variable hold original pre resource change listeners preresourcechangelisteners new listeners newlisteners pre resource change event masks preresourcechangeeventmasks new event masks neweventmasks pre resource change listener count preresourcechangelistenercount resource changed resourcechanged i resource change event iresourcechangeevent event pre resource change listener count preresourcechangelistenercount wrap call backs callbacks safe runnable subsequent listeners called causing grief i resource change listener iresourcechangelistener listener pre resource change listeners preresourcechangelisteners pre resource change event masks preresourcechangeeventmasks event get type gettype safe runner saferunner i safe runnable isaferunnable handle exception handleexception throwable exception util log exception exception occurred listener pre java resource change not ification notification exception listener resource changed resourcechanged event get delta processor getdeltaprocessor resource changed resourcechanged event todo jerome rid reuse delta processor event get type gettype i resource change event iresourcechangeevent post change delta processors deltaprocessors reuse delta processor thread don hang isn meant reused https bugs eclipse org bugs bug cgi get delta processor getdeltaprocessor override n event type overrideneventtype hashtable get external lib time stamps getexternallibtimestamps external time stamps externaltimestamps hashtable time stamps timestamps hashtable file time stamps file timestampsfile get time stamps file gettimestampsfile data input stream datainputstream data input stream datainputstream buffered input stream bufferedinputstream file input stream fileinputstream time stamps file timestampsfile size read int readint size string key readutf timestamp read long readlong time stamps timestamps path from portable string fromportablestring key value of valueof timestamp io exception ioexception time stamps file timestampsfile exists util log unable read external time stamps close io exception ioexception external time stamps externaltimestamps time stamps timestamps external time stamps externaltimestamps i java project ijavaproject find java project findjavaproject string get old java proj ec names getoldjavaprojecnames java model manager javamodelmanager get java model manager getjavamodelmanager get java model getjavamodel get java project getjavaproject workaround bug circular errors reported returns list java projects resource delta processing started hash set hashset get old java proj ec names getoldjavaprojecnames java project names cache javaprojectnamescache hash set hashset result hash set hashset i java project ijavaproject projects projects java model manager javamodelmanager get java model manager getjavamodelmanager get java model getjavamodel get java projects getjavaprojects java model exception javamodelexception java project names cache javaprojectnamescache length projects length length i java project ijavaproject project projects result add project get element name getelementname java project names cache javaprojectnamescache result java project names cache javaprojectnamescache reset old java project names resetoldjavaprojectnames java project names cache javaprojectnamescache file get time stamps file gettimestampsfile nls java core javacore get plugin getplugin get state location getstatelocation append external libs time stamps externallibstimestamps to file tofile save external lib time stamps saveexternallibtimestamps core exception coreexception external time stamps externaltimestamps cleanup avoid leak https bugs eclipse org bugs bug cgi hash set hashset to remove toremove hash set hashset roots enumeration external time stamps externaltimestamps has more elements hasmoreelements object key next element nextelement roots key to remove toremove add key file time stamps timestamps get time stamps file gettimestampsfile data output stream dataoutputstream data output stream dataoutputstream buffered output stream bufferedoutputstream file output stream fileoutputstream time stamps timestamps write int writeint external time stamps externaltimestamps size to remove toremove size iterator entries external time stamps externaltimestamps entry set entryset iterator entries has next hasnext map entry entry map entry entries i path ipath key i path ipath entry get key getkey to remove toremove key writeutf key to portable string toportablestring timestamp entry get value getvalue write long writelong timestamp long value longvalue io exception ioexception i status istatus status status i status istatus error java core javacore plugin i status istatus error problems saving time stamps timestamps core exception coreexception status close io exception ioexception update roots add ition addition removal container resource update roots updateroots i path ipath container path containerpath i resource delta iresourcedelta container delta containerdelta delta processor deltaprocessor delta processor deltaprocessor map updated roots updatedroots map other updated roots otherupdatedroots container delta containerdelta get kind getkind i resource delta iresourcedelta removed updated roots updatedroots old roots oldroots other updated roots otherupdatedroots old other roots oldotherroots updated roots updatedroots roots other updated roots otherupdatedroots other roots otherroots container segment count containersegmentcount container path containerpath segment count segmentcount container is project containerisproject container segment count containersegmentcount iterator iterator updated roots updatedroots entry set entryset iterator iterator has next hasnext map entry entry map entry iterator i path ipath path i path ipath entry get key getkey container path containerpath is prefix of isprefixof path container path containerpath equals path i resource delta iresourcedelta root delta rootdelta container delta containerdelta find member findmember path remove first segments removefirstsegments container segment count containersegmentcount root delta rootdelta delta processor deltaprocessor root info rootinfo root info rootinfo delta processor deltaprocessor root info rootinfo entry get value getvalue container is project containerisproject folder roots included container root info rootinfo project get path getpath is prefix of isprefixof path delta processor deltaprocessor update current delta and index updatecurrentdeltaandindex root delta rootdelta i java element ijavaelement fragment root root info rootinfo array list arraylist root list rootlist array list arraylist other updated roots otherupdatedroots path root list rootlist iterator other projects otherprojects root list rootlist iterator other projects otherprojects has next hasnext root info rootinfo delta processor deltaprocessor root info rootinfo other projects otherprojects container is project containerisproject folder roots included container root info rootinfo project get path getpath is prefix of isprefixof path delta processor deltaprocessor update current delta and index updatecurrentdeltaandindex root delta rootdelta i java element ijavaelement fragment root root info rootinfo