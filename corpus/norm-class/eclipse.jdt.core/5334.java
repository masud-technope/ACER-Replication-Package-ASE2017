copyright mateusz matela rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors mateusz matela mateusz matela gmail formatter formatter format java code correctly max width https bugs eclipse org mateusz matela mateusz matela gmail formatter follow bug comments https bugs eclipse org mateusz matela mateusz matela gmail npe wrap executor wrapexecutor java text for matting formatting https bugs eclipse org org eclipse jdt internal formatter line wrap linewrap org eclipse jdt internal compiler parser terminal tokens terminaltokens tokennamecomment block org eclipse jdt internal compiler parser terminal tokens terminaltokens tokennamecomment javadoc org eclipse jdt internal compiler parser terminal tokens terminaltokens tokennamecomment java util array list arraylist java util hash map hashmap java util hash set hashset java util list org eclipse jdt internal compiler parser scanner helper scannerhelper org eclipse jdt internal formatter default code formatter options defaultcodeformatteroptions org eclipse jdt internal formatter token org eclipse jdt internal formatter token manager tokenmanager org eclipse jdt internal formatter token traverser tokentraverser org eclipse jdt internal formatter token wrap mode wrapmode org eclipse jdt internal formatter token wrap policy wrappolicy wrap executor wrapexecutor wrap info wrapinfo wrap token index wraptokenindex indent wrap info wrapinfo wrap index wrapindex indent wrap token index wraptokenindex wrap index wrapindex indent indent wrap info wrapinfo empty constructor override hash code hashcode prime result result prime result indent result prime result wrap token index wraptokenindex result override equals object obj obj obj get class getclass obj get class getclass wrap info wrapinfo wrap info wrapinfo obj indent indent wrap token index wraptokenindex wrap token index wraptokenindex wrap result wrapresult wrap result wrapresult wrap needed wrap result wrapresult penalty total extra lines totalextralines wrap result code code wrap key link wrap executor wrapexecutor wrap search results wrapsearchresults retrieve wraps wrap info wrapinfo next wrap nextwrap wrap result wrapresult penalty extra lines extralines wrap info wrapinfo next wrap nextwrap penalty penalty total extra lines totalextralines extra lines extralines next wrap nextwrap next wrap nextwrap wrap restart throwable wraprestartthrowable throwable compatible serialversionuid top priority wrap topprioritywrap wrap restart throwable wraprestartthrowable top priority wrap topprioritywrap top priority wrap topprioritywrap top priority wrap topprioritywrap line analyzer lineanalyzer token traverser tokentraverser comment wrap executor commentwrapexecutor comment wrapper commentwrapper line indent lineindent first potential wrap firstpotentialwrap extra lines extralines line exceeded lineexceeded list integer extra lines per comment extralinespercomment array list arraylist integer list integer top priority group starts topprioritygroupstarts array list arraylist integer current top priority group end currenttopprioritygroupend isnlstaginline line analyzer lineanalyzer token manager tokenmanager token manager tokenmanager default code formatter options defaultcodeformatteroptions options comment wrapper commentwrapper comment wrap executor commentwrapexecutor token manager tokenmanager options token analyze line analyzeline start index startindex indent token start token starttoken wrap executor wrapexecutor start index startindex start token starttoken get line breaks before getlinebreaksbefore counter wrap executor wrapexecutor to indent toindent indent start token starttoken is wrap pable iswrappable line indent lineindent indent first potential wrap firstpotentialwrap extra lines extralines extra lines per comment extralinespercomment clear top priority group starts topprioritygroupstarts clear current top priority group end currenttopprioritygroupend isnlstaginline wrap executor wrapexecutor traverse start index startindex override token token token token token type tokentype tokennamecomment token hasnlstag isnlstaginline token is wrap pable iswrappable wrap policy wrappolicy wrap policy wrappolicy token get wrap policy getwrappolicy wrap policy wrappolicy wrap mode wrapmode wrap mode wrapmode top priority get line breaks before getlinebreaksbefore current top priority group end currenttopprioritygroupend top priority group starts topprioritygroupstarts add current top priority group end currenttopprioritygroupend wrap policy wrappolicy group end index groupendindex first potential wrap firstpotentialwrap get wrap indent getwrapindent token counter first potential wrap firstpotentialwrap token get align getalign counter token get align getalign is space before isspacebefore get line breaks before getlinebreaksbefore counter token is comment iscomment counter comment wrapper commentwrapper wrap multi line comment wrapmultilinecomment token counter isnlstaginline extra lines extralines comment wrapper commentwrapper get lines count getlinescount extra lines per comment extralinespercomment add comment wrapper commentwrapper get lines count getlinescount counter wrap executor wrapexecutor get length getlength token counter line exceeded lineexceeded counter wrap executor wrapexecutor options width line exceeded lineexceeded first potential wrap firstpotentialwrap token set indent setindent line indent lineindent is line end islineend get line breaks after getlinebreaksafter get next getnext get next getnext is next line on wrap isnextlineonwrap wrap executor wrapexecutor wrap executor wrapexecutor find first token in line findfirsttokeninline is wrap pable iswrappable is line end islineend get last position getlastposition counter nls tag handler nlstaghandler token traverser tokentraverser array list arraylist token nls tags nlstags array list arraylist token nls tag handler nlstaghandler override token token token token hasnlstag nls tags nlstags add token getnlstag get line breaks after getlinebreaksafter get next getnext comment nls tags token line comment linecomment token token token type tokentype tokennamecomment nls tags nlstags is empty isempty line comment linecomment token token original end originalend token original end originalend tokennamecomment line comment linecomment break after breakafter line comment linecomment space before spacebefore line comment linecomment set align setalign wrap executor wrapexecutor getnlsalign line comment linecomment set internal structure setinternalstructure array list arraylist token wrap executor wrapexecutor insert line comment linecomment structure changed structurechanged fill comment structure step list token structure line comment linecomment get internal structure getinternalstructure structure nls tags nlstags is empty isempty structure array list arraylist token structure add line comment linecomment line comment linecomment set internal structure setinternalstructure structure is prefix missing isprefixmissing structure size token fragment structure wrapped lines earlier fragment hasnlstag nls tags nlstags remove fragment is prefix missing isprefixmissing structure remove is prefix missing isprefixmissing is prefix missing isprefixmissing remove trailing whitespace pos fragment original start originalstart pos fragment original end originalend scanner helper scannerhelper is whitespace iswhitespace wrap executor wrapexecutor char at charat pos pos pos fragment original end originalend structure remove pos fragment original start originalstart fragment token pos fragment original end originalend tokennamecomment structure fragment string fragment string fragmentstring wrap executor wrapexecutor to string tostring fragment nls fragment string fragmentstring starts with startswith nls for ge forge prefix token prefix token line comment linecomment original start originalstart line comment linecomment original start originalstart tokennamecomment prefix space before spacebefore structure add prefix is prefix missing isprefixmissing add remaining tags comment removed structure add all addall nls tags nlstags tags moved lines structure is empty isempty wrap executor wrapexecutor remove structure changed structurechanged nls tags nlstags clear empty array hash map hashmap wrap info wrapinfo wrap result wrapresult wrap search results wrapsearchresults hash map hashmap wrap info wrapinfo wrap result wrapresult hash set hashset wrap policy wrappolicy used top priority wraps usedtopprioritywraps hash set hashset wrap policy wrappolicy line analyzer lineanalyzer line analyzer lineanalyzer token manager tokenmanager default code formatter options defaultcodeformatteroptions options wrap info wrapinfo wrap info temp wrapinfotemp wrap info wrapinfo wrap executor wrapexecutor token manager tokenmanager token manager tokenmanager default code formatter options defaultcodeformatteroptions options token manager tokenmanager options options line analyzer lineanalyzer line analyzer lineanalyzer token manager tokenmanager options execute wraps executewraps size token token current indent currentindent get wrap indent getwrapindent token wrap search results wrapsearchresults clear apply wraps applywraps current indent currentindent wrap restart throwable wraprestartthrowable handle top priority wraps handletopprioritywraps wrap search results wrapsearchresults clear used top priority wraps usedtopprioritywraps clear traverse nls tag handler nlstaghandler apply wraps applywraps indent wrap restart throwable wraprestartthrowable wrap info wrapinfo wrap info wrapinfo find wraps cached findwrapscached indent next wrap nextwrap token token token set indent setindent indent group end groupend token get wrap policy getwrappolicy token get wrap policy getwrappolicy group end index groupendindex separate lines on wrap from separatelinesonwrapfrom size token token is next line on wrap isnextlineonwrap find first token in line findfirsttokeninline is wrap pable iswrappable token break before breakbefore separate lines on wrap from separatelinesonwrapfrom token separate lines on wrap from separatelinesonwrapfrom get separate lines on wrap until getseparatelinesonwrapuntil separate lines on wrap from separatelinesonwrapfrom separate lines on wrap from separatelinesonwrapfrom token get separate lines on wrap until getseparatelinesonwrapuntil separate lines on wrap from separatelinesonwrapfrom wrap info wrapinfo wrap info wrapinfo wrap token index wraptokenindex wrap info wrapinfo wrap search results wrapsearchresults wrap info wrapinfo next wrap nextwrap wrap info wrapinfo wrap info wrapinfo wrap token index wraptokenindex check separate lines on wrap checkseparatelinesonwrap separate lines on wrap from separatelinesonwrapfrom token break before breakbefore handle on column indent handleoncolumnindent token get wrap policy getwrappolicy check top priority wraps checktopprioritywraps apply wraps applywraps wrap info wrapinfo indent is new line isnewline get line breaks after getlinebreaksafter token get line breaks before getlinebreaksbefore is new line isnewline token get wrap policy getwrappolicy check separate lines on wrap checkseparatelinesonwrap separate lines on wrap from separatelinesonwrapfrom handle on column indent handleoncolumnindent token get wrap policy getwrappolicy check top priority wraps checktopprioritywraps new indent newindent get wrap indent getwrapindent token new indent newindent indent wrap info wrapinfo find wraps cached findwrapscached new indent newindent next wrap nextwrap new indent newindent indent apply wraps applywraps new indent newindent group end groupend check force wrap checkforcewrap token indent token set indent setindent indent wrap result wrapresult find wraps cached findwrapscached start token index starttokenindex indent wrap restart throwable wraprestartthrowable wrap info temp wrapinfotemp wrap token index wraptokenindex start token index starttokenindex wrap info temp wrapinfotemp indent indent wrap result wrapresult wrap result wrapresult wrap search results wrapsearchresults wrap info temp wrapinfotemp wrap result wrapresult wrap search results wrapsearchresults contains key containskey wrap info temp wrapinfotemp wrap needed pre existing result based wrapping earlier tokens wrong wrap result wrapresult wrap result wrapresult next wrap nextwrap wrap info wrapinfo next wrap nextwrap token token wrap token index wraptokenindex token get wrap policy getwrappolicy wrap parent index wrapparentindex start token index starttokenindex get wrap indent getwrapindent token indent wrap result wrapresult wrap search results wrapsearchresults wrap result wrapresult token token start token index starttokenindex was line break waslinebreak token get line breaks before getlinebreaksbefore token break before breakbefore wrap result wrapresult find wraps findwraps start token index starttokenindex indent was line break waslinebreak token clear line breaks before clearlinebreaksbefore wrap info wrapinfo wrap info wrapinfo wrap info wrapinfo start token index starttokenindex indent wrap search results wrapsearchresults wrap info wrapinfo wrap result wrapresult wrap result wrapresult main algorithm opt imal optimal places wrap calls recursively wrapped lines wrap result wrapresult find wraps findwraps wrap token index wraptokenindex indent wrap restart throwable wraprestartthrowable last index lastindex line analyzer lineanalyzer analyze line analyzeline wrap token index wraptokenindex indent line exceeded lineexceeded line analyzer lineanalyzer line exceeded lineexceeded last position lastposition line analyzer lineanalyzer get last position getlastposition extra lines extralines line analyzer lineanalyzer extra lines extralines first potential wrap firstpotentialwrap line analyzer lineanalyzer first potential wrap firstpotentialwrap extra lines per comment extralinespercomment to array toarray line analyzer lineanalyzer extra lines per comment extralinespercomment comment index commentindex extra lines per comment extralinespercomment length top priority group starts topprioritygroupstarts to array toarray line analyzer lineanalyzer top priority group starts topprioritygroupstarts top priority index toppriorityindex top priority group starts topprioritygroupstarts length nearest group end nearestgroupend top priority index toppriorityindex top priority group starts topprioritygroupstarts top priority index toppriorityindex get wrap policy getwrappolicy group end index groupendindex best total penalty besttotalpenalty get wrap penalty getwrappenalty wrap token index wraptokenindex indent last index lastindex wrap result wrapresult wrap needed exc eeded exceeded accept wrap best extra lines bestextralines line exceeded lineexceeded integer max extra lines extralines best next wrap bestnextwrap best indent bestindent line exceeded lineexceeded options join wrapped lines options wrap expressions nested wrap result wrapresult best total penalty besttotalpenalty best extra lines bestextralines line exceeded lineexceeded first potential wrap firstpotentialwrap last index lastindex size token next line token nextlinetoken last index lastindex next line token nextlinetoken get wrap policy getwrappolicy next line token nextlinetoken get wrap policy getwrappolicy wrap mode wrapmode wrap mode wrapmode for ced forced last index lastindex is comment iscomment next line token nextlinetoken is comment iscomment pre existing wrap for ced forced comment calculate penalties normal best indent bestindent get wrap indent getwrapindent next line token nextlinetoken best next wrap bestnextwrap last index lastindex wrap result wrapresult wrap result wrapresult find wraps cached findwrapscached best next wrap bestnextwrap best indent bestindent best total penalty besttotalpenalty get wrap penalty getwrappenalty wrap token index wraptokenindex indent best next wrap bestnextwrap best indent bestindent wrap result wrapresult best extra lines bestextralines extra lines extralines wrap result wrapresult total extra lines totalextralines first potential wrap firstpotentialwrap line exceeded lineexceeded top priority group starts topprioritygroupstarts length check top priority wraps checktopprioritywraps top priority group starts topprioritygroupstarts achieved penalty hard choose good penalty best extra lines bestextralines integer max best extra lines bestextralines extra lines extralines last position lastposition best extra lines bestextralines last position lastposition last index lastindex first potential wrap firstpotentialwrap first potential wrap firstpotentialwrap token token comment index commentindex token token type tokentype tokennamecomment block token token type tokentype tokennamecomment javadoc extra lines extralines extra lines per comment extralinespercomment comment index commentindex top priority index toppriorityindex nearest group end nearestgroupend top priority group starts topprioritygroupstarts top priority index toppriorityindex top priority group starts topprioritygroupstarts top priority index toppriorityindex top priority index toppriorityindex nearest group end nearestgroupend top priority index toppriorityindex top priority group starts topprioritygroupstarts top priority index toppriorityindex get wrap policy getwrappolicy group end index groupendindex token is wrap pable iswrappable next wrap indent nextwrapindent get wrap indent getwrapindent token wrap result wrapresult next wrap result nextwrapresult find wraps cached findwrapscached next wrap indent nextwrapindent total penalty totalpenalty get wrap penalty getwrappenalty wrap token index wraptokenindex indent next wrap indent nextwrapindent next wrap result nextwrapresult total extra lines totalextralines extra lines extralines next wrap result nextwrapresult total extra lines totalextralines is better isbetter total extra lines totalextralines best extra lines bestextralines best extra lines bestextralines integer max is better isbetter total extra lines totalextralines best extra lines bestextralines is better isbetter total penalty totalpenalty best total penalty besttotalpenalty best total penalty besttotalpenalty max is better isbetter best total penalty besttotalpenalty total penalty totalpenalty best extra lines bestextralines total extra lines totalextralines best next wrap bestnextwrap best indent bestindent next wrap indent nextwrapindent options wrap expressions nested best next wrap bestnextwrap line exceeded lineexceeded top priority group starts topprioritygroupstarts length check top priority wraps checktopprioritywraps top priority group starts topprioritygroupstarts wrap result wrapresult best total penalty besttotalpenalty best extra lines bestextralines best next wrap bestnextwrap wrap info wrapinfo best next wrap bestnextwrap best indent bestindent get wrap penalty getwrappenalty line start index linestartindex line indent lineindent wrap index wrapindex wrap indent wrapindent wrap result wrapresult wrap result wrapresult wrap restart throwable wraprestartthrowable wrap policy wrappolicy wrap policy wrappolicy token wrap token wraptoken wrap index wrapindex size wrap token wraptoken wrap index wrapindex wrap policy wrappolicy wrap token wraptoken get wrap policy getwrappolicy wrap indent wrapindent wrap indent wrapindent get wrap indent getwrapindent wrap index wrapindex penalty wrap token wraptoken wrap token wraptoken is wrap pable iswrappable get penalty getpenalty wrap policy wrappolicy bbb bbbb bbbbbbb wrap indent wrapindent line indent lineindent penalty avoid ugly format ions formations bar wrapped foo oooo foooooo bar aaa aaa aaaaaa bbb bar aaa bbb bbb bbbbbb assuming line start index linestartindex bbb unwrapped bar add penalty wrapped token line start token linestarttoken line start index linestartindex wrap policy wrappolicy line start wrap policy linestartwrappolicy line start token linestarttoken get wrap policy getwrappolicy wrap token wraptoken wrap token wraptoken is wrap pable iswrappable line start token linestarttoken is wrap pable iswrappable line start index linestartindex wrap index wrapindex wrap policy wrappolicy int ermediate policy intermediatepolicy get wrap policy getwrappolicy int ermediate policy intermediatepolicy int ermediate policy intermediatepolicy structure depth structuredepth line start wrap policy linestartwrappolicy structure depth structuredepth int ermediate policy intermediatepolicy structure depth structuredepth wrap policy wrappolicy structure depth structuredepth penalty get penalty getpenalty int ermediate policy intermediatepolicy previous bar wrapped emphasize bar bar level assuming wrap index wrapindex bar check higher depth wrap bbb wrap parent bar bar wrapped negative penalty update token higher level depth wrap wrapped wrap token wrap group wrap info wrapinfo next wrap nextwrap wrap result wrapresult next wrap nextwrap check depth checkdepth wrap token wraptoken wrap token wraptoken is wrap pable iswrappable line start wrap policy linestartwrappolicy wrap policy wrappolicy structure depth structuredepth line start wrap policy linestartwrappolicy structure depth structuredepth penalty diff penaltydiff check depth checkdepth next wrap nextwrap wrap policy wrappolicy next policy nextpolicy next wrap nextwrap wrap token index wraptokenindex get wrap policy getwrappolicy next policy nextpolicy wrap parent index wrapparentindex wrap policy wrappolicy wrap parent index wrapparentindex penalty diff penaltydiff wrap policy wrappolicy is first in group isfirstingroup penalty penalty diff penaltydiff next policy nextpolicy structure depth structuredepth wrap policy wrappolicy structure depth structuredepth penalty diff penaltydiff math max penalty diff penaltydiff get penalty getpenalty next policy nextpolicy next wrap nextwrap find wraps cached findwrapscached next wrap nextwrap wrap token index wraptokenindex next wrap nextwrap indent next wrap nextwrap penalty wrap result wrapresult penalty get penalty getpenalty wrap policy wrappolicy policy math exp policy structure depth structuredepth policy penalty multiplier penaltymultiplier check separate lines on wrap checkseparatelinesonwrap separate lines on wrap from separatelinesonwrapfrom wrap restart throwable wraprestartthrowable separate lines on wrap from separatelinesonwrapfrom token separate lines on wrap from separatelinesonwrapfrom token separate lines on wrap from separatelinesonwrapfrom get separate lines on wrap until getseparatelinesonwrapuntil get line breaks before getlinebreaksbefore get line breaks before getlinebreaksbefore get wrap policy getwrappolicy get wrap policy getwrappolicy wrap mode wrapmode wrap mode wrapmode for ced forced set wrap policy setwrappolicy wrap policy wrappolicy wrap mode wrapmode separate lines on wrap from separatelinesonwrapfrom options indentation size break before breakbefore get wrap policy getwrappolicy get wrap policy getwrappolicy wrap mode wrapmode wrap mode wrapmode for ced forced set wrap policy setwrappolicy wrap policy wrappolicy wrap mode wrapmode separate lines on wrap from separatelinesonwrapfrom break before breakbefore wrap restart throwable wraprestartthrowable check force wrap checkforcewrap token token current indent currentindent wrap restart throwable wraprestartthrowable wraps previous lines determined token penalty calculated token is wrap pable iswrappable options wrap expressions nested get wrap indent getwrapindent token current indent currentindent wrap policy wrappolicy line start policy linestartpolicy find first token in line findfirsttokeninline get wrap policy getwrappolicy line start policy linestartpolicy line start policy linestartpolicy wrap mode wrapmode wrap mode wrapmode for ced forced token break before breakbefore wrap restart throwable wraprestartthrowable check top priority wraps checktopprioritywraps wrap index wrapindex wrap restart throwable wraprestartthrowable wrap policy wrappolicy wrap policy wrappolicy wrap index wrapindex get wrap policy getwrappolicy wrap policy wrappolicy wrap policy wrappolicy wrap mode wrapmode wrap mode wrapmode top priority used top priority wraps usedtopprioritywraps wrap policy wrappolicy wrap restart throwable wraprestartthrowable wrap index wrapindex handle top priority wraps handletopprioritywraps wrap restart throwable wraprestartthrowable restart exception restartexception wrap index wrapindex restart exception restartexception top priority wrap topprioritywrap wrap index wrapindex wrap policy wrappolicy wrap policy wrappolicy wrap index wrapindex get wrap policy getwrappolicy parent index parentindex wrap policy wrappolicy wrap parent index wrapparentindex wrap index wrapindex parent index parentindex token token wrap policy wrappolicy token get wrap policy getwrappolicy wrap policy wrappolicy wrap policy wrappolicy wrap parent index wrapparentindex parent index parentindex wrap policy wrappolicy wrap mode wrapmode wrap mode wrapmode top priority token break before breakbefore used top priority wraps usedtopprioritywraps add wrap policy wrappolicy wrap policy wrappolicy is first in group isfirstingroup break after previous breakafterprevious wrap index wrapindex size token token wrap policy wrappolicy token get wrap policy getwrappolicy wrap policy wrappolicy token get line breaks before getlinebreaksbefore break after previous breakafterprevious wrap policy wrappolicy wrap policy wrappolicy wrap parent index wrapparentindex parent index parentindex wrap policy wrappolicy is first in group isfirstingroup wrap policy wrappolicy wrap mode wrapmode wrap mode wrapmode top priority token break before breakbefore used top priority wraps usedtopprioritywraps add wrap policy wrappolicy break after previous breakafterprevious token get line breaks after getlinebreaksafter to array toarray list integer list list is empty isempty empty array result list size item list result item result handle on column indent handleoncolumnindent token index tokenindex wrap policy wrappolicy wrap policy wrappolicy wrap policy wrappolicy wrap policy wrappolicy indent on column indentoncolumn wrap policy wrappolicy is first in group isfirstingroup options tab default code formatter options defaultcodeformatteroptions tab options tabs leading indent ations indentations special wrap group aligned column wrapped token index tokenindex token token wrap policy wrappolicy wrap policy wrappolicy token get wrap policy getwrappolicy wrap policy wrappolicy wrap policy wrappolicy is first in group isfirstingroup wrap policy wrappolicy wrap parent index wrapparentindex wrap policy wrappolicy wrap parent index wrapparentindex token set align setalign get wrap indent getwrapindent token get wrap indent getwrapindent token token wrap policy wrappolicy policy token get wrap policy getwrappolicy policy token get indent getindent options indent comments column token token type tokentype tokennamecomment token get indent getindent options indent block comments column token token type tokentype tokennamecomment block token get indent getindent token wrap parent wrapparent policy wrap parent index wrapparentindex wrap indent wrapindent wrap parent wrapparent get indent getindent policy indent on column indentoncolumn wrap indent wrapindent get position in line getpositioninline policy wrap parent index wrapparentindex wrap indent wrapindent get length getlength wrap parent wrapparent wrap indent wrapindent wrap parent wrapparent is space after isspaceafter policy wrap parent index wrapparentindex is space before isspacebefore wrap indent wrapindent wrap indent wrapindent policy extra indent extraindent to indent toindent wrap indent wrapindent