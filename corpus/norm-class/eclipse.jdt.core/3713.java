copyright bea systems rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors tyeung bea initial api implementation org eclipse jdt apt core internal env java buffered input stream bufferedinputstream java io exception ioexception java input stream inputstream java input stream reader inputstreamreader java util org eclipse core resources i file ifile org eclipse core resources i marker imarker org eclipse core resources i workspace iworkspace org eclipse core resources i workspace runnable iworkspacerunnable org eclipse core runtime core exception coreexception org eclipse core runtime i progress monitor iprogressmonitor org eclipse core runtime i status istatus org eclipse jdt apt core env p has e phase org eclipse jdt apt core internal apt plugin aptplugin org eclipse jdt apt core internal declaration eclipse mirror object eclipsemirrorobject org eclipse jdt apt core internal declaration type declaration impl typedeclarationimpl org eclipse jdt apt core internal env message r impl messagerimpl severity org eclipse jdt apt core internal util factory org eclipse jdt apt core internal util visit ors visitors annotated node visitor annotatednodevisitor org eclipse jdt apt core internal util visit ors visitors annotation visitor annotationvisitor org eclipse jdt core i compilation unit icompilationunit org eclipse jdt core i java project ijavaproject org eclipse jdt core java core javacore org eclipse jdt core compiler categorized problem categorizedproblem org eclipse jdt core compiler build context buildcontext org eclipse jdt core dom sun mirror apt file r filer sun mirror declaration annotation type declaration annotationtypedeclaration sun mirror declaration package declaration packagedeclaration sun mirror declaration type declaration typedeclaration build env buildenv abstract compilation env abstractcompilationenv has raised errors hasraisederrors build file r impl buildfilerimpl file r filer strings type dependencies int roduced introduced file string fully qualified type string type dependencies typedependencies hash set hashset batch mode flipped build flipped batch mode batchmode h olds holds files annotation processed build batch mode code file code holds file processed time build context buildcontext files with annotation fileswithannotation files build annotations batch mode processing files included build context buildcontext add ition files additionfiles int ialized intialized code batch mode batchmode code code code batch processing expected build mode per f perf reason parsing resolving file individually get all annotation types getallannotationtypes map compilation unit compilationunit ast roots astroots list marker info markerinfo marker infos markerinfos constructor creating processor environment build param files with annotations fileswithannotations param additional files additionalfiles param units param java proj javaproj param phase build env buildenv build context buildcontext files with annotations fileswithannotations build context buildcontext additional files additionalfiles i java project ijavaproject java proj javaproj java proj javaproj p has e phase build file r filer build file r impl buildfilerimpl files with annotation fileswithannotation files with annotations fileswithannotations add ition files additionfiles additional files additionalfiles problems array list arraylist marker infos markerinfos array list arraylist apt plugin aptplugin debug compilation env apt plugin aptplugin trace nls nls nls constructed files with annotation fileswithannotation length files file r filer get file r getfiler check valid checkvalid file r filer package declaration packagedeclaration get package getpackage string check valid checkvalid get package getpackage type declaration typedeclaration get type declaration gettypedeclaration string check valid checkvalid type declaration typedeclaration decl get type declaration gettypedeclaration batch mode batchmode add type dependency addtypedependency decl iff errors message r impl messagerimpl severity error pos ted posted environment closed has raised errors hasraisederrors has raised errors hasraisederrors input stream reader inputstreamreader get file reader getfilereader i file ifile file io exception ioexception core exception coreexception input stream reader inputstreamreader get input stream getinputstream file file get charset getcharset input stream inputstream get input stream getinputstream i file ifile file io exception ioexception core exception coreexception buffered input stream bufferedinputstream file get contents getcontents iff files generated environment closed has generated class files hasgeneratedclassfiles file r filer has generated class file hasgeneratedclassfile javadoc environment closed allowed pos ting posting messge generating file retrieving type add remove listeners close is closed isclosed marker infos markerinfos ast root astroot file ast roots astroots files with annotation fileswithannotation problems model comp unit modelcompunit ast comp unit astcompunit clear has raised errors hasraisederrors close param resource current resource param start starting offset marker param unknow offset param severity severity marker param msg message marker param number marker add message addmessage i file ifile resource start severity severity string msg string arguments check valid checkvalid resource resource get file getfile has raised errors hasraisederrors severity message r impl messagerimpl severity error eclipse doesn support info level i problems iproblems send log severity severity info string builder stringbuilder string builder stringbuilder nls append info rmational informational message reported annotation processor append msg nls append resource nls append resource append resource get name getname nls append nls append starting offset append start nls append offset append nls append append arguments nls append arguments string arguments nls append append nls append i status istatus status apt plugin aptplugin create info status createinfostatus to string tostring apt plugin aptplugin log status resource nls batch mode batchmode batch mode don current resource add marker addmarker start severity msg arguments add problem addproblem resource start severity msg arguments add problem addproblem i file ifile resource start severity severity string msg string arguments apt problem aptproblem problem create problem createproblem resource start severity msg arguments problems add problem add marker addmarker start severity severity string msg string arguments note arguments quick markers marker infos markerinfos add marker info markerinfo start severity msg map string annotation type declaration annotationtypedeclaration get annotation types getannotationtypes check valid checkvalid ast root astroot file batch mode batchmode nls operation batch mode get annotation types getannotationtypes annotations declaration level compilation unit environment files environment parsed resolved declaration level elements call param file annotations pop ulated populated method map files annotation types map annotation types environment map string annotation type declaration annotationtypedeclaration get all annotation types getallannotationtypes map build context buildcontext annotation type declaration annotationtypedeclaration file annotations check valid checkvalid files with annotation fileswithannotation get annotation types getannotationtypes list annotation instances array list arraylist map string annotation type declaration annotationtypedeclaration decls hash map hashmap annotation visitor annotationvisitor visitor annotation visitor annotationvisitor instances ast index astindex len ast roots astroots length ast index astindex len ast index astindex ast roots astroots ast roots astroots ast index astindex system err println ast roots astroots ast index astindex accept visitor annotation type declaration annotationtypedeclaration per file annos perfileannos hash set hashset instance index instanceindex size instances size instance index instanceindex size instance index instanceindex annotation instance instances instance index instanceindex i type binding itypebinding anno type annotype instance resolve type binding resolvetypebinding anno type annotype type declaration impl typedeclarationimpl decl factory create reference type createreferencetype anno type annotype decl decl kind eclipse mirror object eclipsemirrorobject mirror kind mirrorkind type annotation annotation type declaration annotationtypedeclaration anno decl annodecl annotation type declaration annotationtypedeclaration decl decls anno decl annodecl get qualified name getqualifiedname anno decl annodecl per file annos perfileannos add anno decl annodecl file annotations per file annos perfileannos is empty isempty file annotations files with annotation fileswithannotation ast index astindex per file annos perfileannos visitor reset decls extra type dependencies files compilation string get type dependencies gettypedependencies type dependencies typedependencies batch processing mode note call method files environment read parsed begin batch processing beginbatchprocessing phase p has e phase build nls illegal state exception illegalstateexception batch processing build batch mode batchmode check valid checkvalid batch mode batchmode file ast root astroot completed batch processing completedbatchprocessing post markers postmarkers completed processing completedprocessing createasts build context buildcontext cp results cpresults len cp results cpresults length i compilation unit icompilationunit units i compilation unit icompilationunit len len creation failed occur file exists units java core javacore create compilation unit from createcompilationunitfrom cp results cpresults get file getfile createasts java project javaproject units requestor callback requestor callbackrequestor units begin file processing beginfileprocessing build context buildcontext result result nls illegal state exception illegalstateexception missing compilation result batch mode batchmode i file ifile file result get file getfile file equals file ast root astroot file match file ast files with annotation fileswithannotation len files with annotation fileswithannotation length len file equals files with annotation fileswithannotation get file getfile file file ast root astroot ast roots astroots file ast root astroot illegal state exception illegalstateexception nls file file get name getname list processed completed file processing completedfileprocessing completed processing completedprocessing override completed processing completedprocessing problems clear type dependencies typedependencies clear completed processing completedprocessing list categorized problem categorizedproblem get problems getproblems problems is empty isempty env util envutil update problem length updateproblemlength problems get ast compilation unit getastcompilationunit problems implementation eclipse annotation processor environment eclipseannotationprocessorenvironment compilation unit compilationunit getast batch mode batchmode ast root astroot add type dependency addtypedependency string fully qualified type name fullyqualifiedtypename batch mode batchmode type dependencies typedependencies add fully qualified type name fullyqualifiedtypename implementation eclipse annotation processor environment eclipseannotationprocessorenvironment include types files files annotations batch mode types file processed list abstract type declaration abstracttypedeclaration search locally for type declarations searchlocallyfortypedeclarations batch mode batchmode search locally for type declarations searchlocallyfortypedeclarations list abstract type declaration abstracttypedeclaration type decls typedecls array list arraylist len ast roots astroots length len type decls typedecls add all addall ast roots astroots types get type declarations from add ition files gettypedeclarationsfromadditionfiles type decls typedecls type decls typedecls get type declarations from add ition files gettypedeclarationsfromadditionfiles list abstract type declaration abstracttypedeclaration type decls typedecls add ition files additionfiles add ition files additionfiles length len add ition files additionfiles length i compilation unit icompilationunit units i compilation unit icompilationunit len len creation failed occur file exists units java core javacore create compilation unit from createcompilationunitfrom add ition files additionfiles get file getfile base requestor baserequestor base requestor baserequestor units createasts java project javaproject units compilation unit compilationunit asts asts compilation unit compilationunit ast asts ast type decls typedecls add all addall ast types map ast node astnode list annotation getastnodeswithannotations batch mode batchmode getastnodeswithannotations map ast node astnode list annotation ast node astnode anno hash map hashmap annotated node visitor annotatednodevisitor visitor annotated node visitor annotatednodevisitor ast node astnode anno len ast roots astroots length len ast roots astroots accept visitor ast node astnode anno i file ifile get file for node getfilefornode ast node astnode node batch mode batchmode get file for node getfilefornode node compilation unit compilationunit curast compilation unit compilationunit node get root getroot len ast roots astroots length len ast roots astroots curast files with annotation fileswithannotation get file getfile illegal state exception illegalstateexception list compilation unit environment declaration node binding param binding compilation unit defines binding match compilation unit compilationunit search locally for binding searchlocallyforbinding i binding ibinding binding batch mode batchmode search locally for binding searchlocallyforbinding binding len ast roots astroots length len ast node astnode node ast roots astroots find declaring node finddeclaringnode binding node ast roots astroots list compilation unit environment declaration node binding param binding compilation unit defines binding match i file ifile search locally for file searchlocallyforifile i binding ibinding binding batch mode batchmode search locally for file searchlocallyforifile binding len ast roots astroots length len ast node astnode node ast roots astroots find declaring node finddeclaringnode binding node files with annotation fileswithannotation get file getfile param file compilation unit file file environment processing compilation unit compilationunit getastfrom i file ifile file file file equals file ast root astroot ast roots astroots len files with annotation fileswithannotation length len file equals files with annotation fileswithannotation get file getfile ast roots astroots current ast processed file mode batch mode asts processed guarantee returned ast get current diet t getcurrentdietast ast root astroot ast root astroot getast ast roots astroots nls illegal state exception illegalstateexception nls ast ast roots astroots getast post markers postmarkers marker infos markerinfos marker infos markerinfos size min imize minimize amount not ification notification i workspace runnable iworkspacerunnable runnable i workspace runnable iworkspacerunnable i progress monitor iprogressmonitor monitor marker info markerinfo marker info markerinfo marker infos markerinfos i marker imarker marker java project javaproject get project getproject create marker createmarker apt plugin aptplugin apt batch processor problem marker marker info markerinfo copy into marker copyintomarker marker core exception coreexception apt plugin aptplugin log failure pos ting posting markers i workspace iworkspace java project javaproject get project getproject get workspace getworkspace runnable core exception coreexception apt plugin aptplugin log failed post markers marker infos markerinfos clear build context buildcontext get files with annotation getfileswithannotation files with annotation fileswithannotation build context buildcontext get files without annotation getfileswithoutannotation add ition files additionfiles callback requestor callbackrequestor base requestor baserequestor callback requestor callbackrequestor i compilation unit icompilationunit parse units parseunits parse units parseunits accept binding acceptbinding string binding key bindingkey i binding ibinding binding rec ieved recieved ast requested assign asts dispatch ast roots astroots asts callback build env buildenv