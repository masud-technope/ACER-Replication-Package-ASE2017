copyright bea systems rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors wharley bea initial api implementation org eclipse jdt compiler apt tests processors base java byte array output stream bytearrayoutputstream java io exception ioexception java output stream outputstream java print stream printstream java string reader stringreader java util hash set hashset java util iterator java util map java util java util tree map treemap java util map entry javax xml parsers document builder factory documentbuilderfactory org dom document org dom element org dom name d node map namednodemap org dom node org xml sax input source inputsource utility compare xml dom trees represent jsr javax lang model language models existing party xml diff xmldiff tools articulate dtd enhanced point maintain ers maintainers app roach approach xml comparison tool specific expect ations expectations structure jsr model declarations annotations vice versa note body code term decl declaration refer entities represented javax lang model element element avoid conf usion confusion xml elements org dom element xml compare r xmlcomparer ixml names ixmlnames structure collect org anize organize contents elements node link javax lang model element element get enclosed elements getenclosedelements method key simple entity reason needed simple names repeated method nested structure holder annotations node convenience searching xml dom discover node time element declarations declaration contents declarationcontents element annotations element superclass element interfaces tree map treemap string element type decls typedecls tree map treemap string element tree map treemap string element executable decls executabledecls tree map treemap string element tree map treemap string element variable decls variabledecls tree map treemap string element todo type parameter compare jsr language models app roximate approximate criteria jsr spec ignore diff erences differences order sibling elements match option ally optionally send detailed mismatch output stream param actual observed language model param expected reference language model param stream detailed mismatches output detailed desired param summary string builder stringbuilder appended summary problem problem encountered summary desired param ignore javac bugs ignorejavacbugs mismatches java c javac bugs models match satisfy spec compare document actual document expected output stream outputstream string builder stringbuilder summary ignore javac bugs ignorejavacbugs xml compare r xmlcomparer compare r comparer xml compare r xmlcomparer actual expected summary ignore javac bugs ignorejavacbugs compare r comparer compare document actual document expected don complain mismatches java c javac bugs represent violation spec running tests reference implementation ignore javac bugs ignorejavacbugs print stream printstream string builder stringbuilder summary clients construct instances object xml compare r xmlcomparer document actual document expected output stream outputstream string builder stringbuilder summary ignore javac bugs ignorejavacbugs actual actual expected expected ignore javac bugs ignorejavacbugs ignore javac bugs ignorejavacbugs output stream outputstream output stream outputstream write io exception ioexception print stream printstream summary summary test creating xml language model compare reference model models match models matched test passed exception test exception string xml framework test model xml version encoding utf standalone model type element kind qname sname superclass type mirror kind declared string java lang object superclass variable element kind field sname type java lang string annotations annotation sname anno annotation values annotation member type java lang string spud annotation values annotation annotations variable element type element model create actual model document builder factory documentbuilderfactory factory document builder factory documentbuilderfactory new instance newinstance document actual model actualmodel factory new document builder newdocumentbuilder new document newdocument element model node modelnode actual model actualmodel create element createelement model tag primary type element type node typenode actual model actualmodel create element createelement type element tag type node typenode set attribute setattribute kind tag type node typenode set attribute setattribute sname tag type node typenode set attribute setattribute qname tag superclass element sc node scnode actual model actualmodel create element createelement superclass tag element tm node tmnode actual model actualmodel create element createelement type mirror tag tm node tmnode set attribute setattribute kind tag declared tm node tmnode set attribute setattribute string tag java lang object sc node scnode append child appendchild tm node tmnode type node typenode append child appendchild sc node scnode field element variable node variablenode actual model actualmodel create element createelement variable element tag variable node variablenode set attribute setattribute kind tag field variable node variablenode set attribute setattribute sname tag variable node variablenode set attribute setattribute type tag java lang string annotation field element annotations node annotationsnode actual model actualmodel create element createelement annotations tag element anno node annonode actual model actualmodel create element createelement annotation tag anno node annonode set attribute setattribute sname tag anno element values node valuesnode actual model actualmodel create element createelement annotation values tag element value node valuenode actual model actualmodel create element createelement annotation tag value node valuenode set attribute setattribute member tag value node valuenode set attribute setattribute type tag java lang string value node valuenode set attribute setattribute tag spud values node valuesnode append child appendchild value node valuenode anno node annonode append child appendchild values node valuesnode annotations node annotationsnode append child appendchild anno node annonode variable node variablenode append child appendchild annotations node annotationsnode type node typenode append child appendchild variable node variablenode model node modelnode append child appendchild type node typenode actual model actualmodel append child appendchild model node modelnode load reference model input source inputsource source input source inputsource string reader stringreader xml framework test model document expected model expectedmodel factory new document builder newdocumentbuilder parse source compare actual reference byte array output stream bytearrayoutputstream byte array output stream bytearrayoutputstream string builder stringbuilder summary string builder stringbuilder summary append testxmlframework failed console details success compare actual model actualmodel expected model expectedmodel summary success system println testxmlframework failed detailed output system print to string tostring system println output success internal comparison routine called link compare document document output stream outputstream models equivalent compare navigate outer most outermost model nodes document element actual model actualmodel find root node findrootnode actual element expected model expectedmodel find root node findrootnode expected actual model actualmodel expected model expectedmodel print problem printproblem actual model contained elements node print differences printdifferences expected model expectedmodel print problem printproblem actual model contained unexpected elements print differences printdifferences compare declarations comparedeclarations actual model actualmodel expected model expectedmodel collect contents annotations node map declarations report error unexpected contents declarations contained annotations node report error todo revisit model dup lications duplications order handle incorrect code param annots node annotsnode param map map annotation type xml node representing annotation instance errors reported collect annotations collectannotations element annots node annotsnode map string element map node annots node annotsnode get first child getfirstchild get next sibling getnextsibling get node type getnodetype node element node element element string node name nodename get node name getnodename sname string sname get attribute getattribute sname tag sname print problem printproblem child annotations node missing sname attribute print differences printdifferences cat egorize categorize element annotation tag equals node name nodename map sname print problem printproblem annotations node unexpectedly contained annotation node name nodename print differences printdifferences print problem printproblem sibling annotation mirrors sname sname print differences printdifferences collect contents declaration including child declarations annotations collection maps declarations type simple report error unexpected contents report error todo revisit model dup lications duplications order handle incorrect code param element node elementnode param contents errors reported collect declaration contents collectdeclarationcontents element declaration node declarationnode declaration contents declarationcontents contents node declaration node declarationnode get first child getfirstchild get next sibling getnextsibling get node type getnodetype node element node element element string node name nodename get node name getnodename annotations tag equals node name nodename contents annotations print problem printproblem xml syntax error declaration contained annotations node print differences printdifferences contents annotations superclass tag equals node name nodename contents superclass print problem printproblem xml syntax error declaration contained superclass node print differences printdifferences contents superclass interfaces tag equals node name nodename contents interfaces print problem printproblem xml syntax error declaration contained interfaces node print differences printdifferences contents interfaces sname string sname get attribute getattribute sname tag sname print problem printproblem child elements node missing sname attribute print differences printdifferences cat egorize categorize element executable element tag equals node name nodename contents executable decls executabledecls sname type element tag equals node name nodename contents type decls typedecls sname variable element tag equals node name nodename contents variable decls variabledecls sname print problem printproblem declaration contained unexpected child node node name nodename print differences printdifferences print problem printproblem elements kind sname sname print differences printdifferences collect type mirror children parent node map keyed sorted canonical ized canonicalized type to string tostring output canonical unspecified implementation dependent reject duplicated types todo revisit model dup lications duplications order handle incorrect code param parent parent node param types map typesmap map presumed empty entry errors reported collect types collecttypes node parent map string element types map typesmap node parent get first child getfirstchild get next sibling getnextsibling get node type getnodetype node element node type mirror tag equals get node name getnodename element type mirror typemirror element string to string attr tostringattr type mirror typemirror get attribute getattribute string tag to string attr tostringattr to string attr tostringattr length print problem printproblem type mirror node missing string attribute print differences printdifferences element types map typesmap to string attr tostringattr type mirror typemirror print problem printproblem type mirror nodes string attribute to string attr tostringattr print differences printdifferences compare actual annotation mirror expected reference assumed annotation sname compared attributes exist actual annotation expected annotation considered mismatch note language model representation xml include values attributes annotation type annotation instance param actual annot actualannot param expected annot expectedannot elements match compare annotation nodes compareannotationnodes element actual annot actualannot element expected annot expectedannot compare attributes annotation instances int entionally intentionally ignore presence additional actual attributes expected model name d node map namednodemap expected attrs expectedattrs expected annot expectedannot get attributes getattributes name d node map namednodemap actual attrs actualattrs actual annot actualannot get attributes getattributes num attrs numattrs expected attrs expectedattrs get length getlength string sname num attrs numattrs node expected attr expectedattr expected attrs expectedattrs item string attr name attrname expected attr expectedattr get node name getnodename node actual attr actualattr actual attrs actualattrs get name d item getnameditem attr name attrname actual attr actualattr print problem printproblem actual annotation mirror missing expected attribute attr name attrname print differences printdifferences string expected value expectedvalue expected attr expectedattr get node value getnodevalue string actual value actualvalue actual attr actualattr get node value getnodevalue expected value expectedvalue equals actual value actualvalue print problem printproblem actual attribute expected attribute attr name attrname expected expected value expectedvalue actual actual value actualvalue print differences printdifferences sname tag equals attr name attrname sname actual value actualvalue examine member pairs element actual values actualvalues find name d child element findnamedchildelement actual annot actualannot annotation values tag element expected values expectedvalues find name d child element findnamedchildelement expected annot expectedannot annotation values tag actual values actualvalues expected values expectedvalues compare annotation values nodes compareannotationvaluesnodes actual values actualvalues expected values expectedvalues actual values actualvalues expected values expectedvalues print problem printproblem unexpected annotation values annotation sname print differences printdifferences expected values expectedvalues actual values actualvalues print problem printproblem missing expected annotation values annotation sname print differences printdifferences compare contents annotations nodes param actual annots actualannots empty param expected annots expectedannots empty contents equivalent compare annotations nodes compareannotationsnodes element actual annots actualannots element expected annots expectedannots group declarations alphabetically compared map string element actual tree map treemap string element map string element expected tree map treemap string element collect annotations collectannotations actual annots actualannots actual collect annotations collectannotations expected annots expectedannots expected compare collections level actual key set keyset equals expected key set keyset print problem printproblem contents annotations nodes match print differences printdifferences compare individual annotations detail map entry string element expected entry expectedentry expected entry set entryset string sname expected entry expectedentry get key getkey element actual element actualelement actual sname compare annotation nodes compareannotationnodes actual element actualelement expected entry expectedentry get value getvalue compare contents annotation values nodes compare actual expected lists annotation member pairs lists typically include annotation defaults attribute annotation type annotation instance ordering list pairs order considered mismatch param actual param expected sets equivalent compare annotation values nodes compareannotationvaluesnodes element actual element expected node n actual nactual actual get first child getfirstchild node n expected nexpected expected get first child getfirstchild n expected nexpected n expected nexpected n expected nexpected get next sibling getnextsibling n expected nexpected get node type getnodetype node element node annotation tag equals n expected nexpected get node name getnodename n actual nactual n actual nactual get node type getnodetype node element node annotation tag equals n actual nactual get node name getnodename n actual nactual n actual nactual get next sibling getnextsibling n actual nactual print problem printproblem annotation member pairs expected pairs print differences printdifferences ignore extra unexpected attributes actual model compare attributes compareattributes n actual nactual n expected nexpected compare attributes nodes ignore attributes actual expected node param actual param expected attribute lists equivalent compare attributes compareattributes node actual node expected name d node map namednodemap expected attrs expectedattrs expected get attributes getattributes name d node map namednodemap actual attrs actualattrs actual get attributes getattributes expected attrs expectedattrs get length getlength node expected attr expectedattr expected attrs expectedattrs item string attr name attrname expected attr expectedattr get node name getnodename optional tag equals attr name attrname optional instruction compare r comparer model attribute node actual attr actualattr actual attrs actualattrs get name d item getnameditem attr name attrname actual attr actualattr print problem printproblem actual element missing expected attribute attr name attrname print differences printdifferences string expected value expectedvalue expected attr expectedattr get node value getnodevalue string actual value actualvalue actual attr actualattr get node value getnodevalue expected value expectedvalue equals actual value actualvalue print problem printproblem actual attribute expected attribute attr name attrname expected expected value expectedvalue actual actual value actualvalue print differences printdifferences compare sets element declarations nested actual expected element note declaration contents declarationcontents object annotations node compared sep arately separately expected element optional attribute allowed missing actual contents mismatch actual contents include element expected contents param actual param expected contents equivalent compare declaration contents comparedeclarationcontents declaration contents declarationcontents actual declaration contents declarationcontents expected optional match optionalmatch actual type decls typedecls expected type decls typedecls print problem printproblem contents elements nodes match sets type elements print differences printdifferences optional match optionalmatch actual executable decls executabledecls expected executable decls executabledecls print problem printproblem contents elements nodes match sets executable elements print differences printdifferences optional match optionalmatch actual variable decls variabledecls expected variable decls variabledecls print problem printproblem contents elements nodes match sets variable elements print differences printdifferences recurse comparing individual elements map entry string element expected entry expectedentry expected type decls typedecls entry set entryset string sname expected entry expectedentry get key getkey element actual element actualelement actual type decls typedecls sname actual element actualelement compare declarations comparedeclarations actual element actualelement expected entry expectedentry get value getvalue map entry string element expected entry expectedentry expected executable decls executabledecls entry set entryset string sname expected entry expectedentry get key getkey element actual element actualelement actual executable decls executabledecls sname actual element actualelement compare declarations comparedeclarations actual element actualelement expected entry expectedentry get value getvalue map entry string element expected entry expectedentry expected variable decls variabledecls entry set entryset string sname expected entry expectedentry get key getkey element actual element actualelement actual variable decls variabledecls sname actual element actualelement compare declarations comparedeclarations actual element actualelement expected entry expectedentry get value getvalue compare actual declaration expected reference assumed element type element variable element sname foo compared attributes exist actual declaration element expected declaration element considered mismatch param actual decl actualdecl param expected decl expecteddecl declarations equivalent compare declarations comparedeclarations element actual decl actualdecl element expected decl expecteddecl expected model compare attributes compareattributes actual decl actualdecl expected decl expecteddecl find nested element annotations nodes declaration contents declarationcontents actual contents actualcontents declaration contents declarationcontents collect declaration contents collectdeclarationcontents actual decl actualdecl actual contents actualcontents declaration contents declarationcontents expected contents expectedcontents declaration contents declarationcontents collect declaration contents collectdeclarationcontents expected decl expecteddecl expected contents expectedcontents compare annotations element actual contents actualcontents annotations expected contents expectedcontents annotations compare annotations nodes compareannotationsnodes actual contents actualcontents annotations expected contents expectedcontents annotations actual contents actualcontents annotations expected annots expectedannots print problem printproblem unexpected annotations element expected decl expecteddecl get attribute getattribute sname tag print differences printdifferences expected contents expectedcontents annotations actual annots actualannots print problem printproblem missing expected annotations element actual decl actualdecl get attribute getattribute sname tag print differences printdifferences compare super classes superclasses ignore reference superclass expected contents expectedcontents superclass actual contents actualcontents superclass print problem printproblem superclass element actual decl actualdecl get attribute getattribute sname tag print differences printdifferences compare superclass nodes comparesuperclassnodes actual contents actualcontents superclass expected contents expectedcontents superclass ignoring java c javac bugs ignore error cases expected contents expectedcontents interfaces ignore javac bugs ignorejavacbugs actual contents actualcontents interfaces print problem printproblem interfaces list element actual decl actualdecl get attribute getattribute sname tag print differences printdifferences compare interfaces nodes compareinterfacesnodes actual contents actualcontents interfaces expected contents expectedcontents interfaces compare child elements compare declaration contents comparedeclarationcontents actual contents actualcontents expected contents expectedcontents compare lists interfaces nodes expected type mirror nodes spec link javax lang model element type element typeelement get interfaces getinterfaces order items returned load map string element keyed type to string tostring output note to string tostring type mirror typemirror guaranteed produce good param actual observed interfaces node param expected reference interfaces node nodes equivalent compare interfaces nodes compareinterfacesnodes element actual element expected map string element expected types expectedtypes tree map treemap string element map string element actual types actualtypes tree map treemap string element collect types collecttypes expected expected types expectedtypes collect types collecttypes actual actual types actualtypes expected types expectedtypes size actual types actualtypes size ignore javac bugs ignorejavacbugs resolved work worth print problem printproblem actual expected lists sizes expected expected types expectedtypes size actual actual types actualtypes size print differences printdifferences iterator entry string element expected iter expectediter expected types expectedtypes entry set entryset iterator iterator entry string element actual iter actualiter actual types actualtypes entry set entryset iterator maps size expected iter expectediter has next hasnext entry string element expected entry expectedentry expected iter expectediter entry string element actual entry actualentry actual iter actualiter compare type mirrors comparetypemirrors actual entry actualentry get value getvalue expected entry expectedentry get value getvalue compare superclass nodes expected type mirror node param actual observed superclass node param expected reference superclass node superclass types equivalent compare superclass nodes comparesuperclassnodes element actual element expected element expected type expectedtype find name d child element findnamedchildelement expected type mirror tag expected type expectedtype syntax error reference model problem test code print problem printproblem bug reference model superclass node missing type mirror element print differences printdifferences element actual type actualtype find name d child element findnamedchildelement actual type mirror tag actual type actualtype problem xml converter xmlconverter print problem printproblem bug test code superclass node missing type mirror element xml model observed language model print differences printdifferences compare type mirrors comparetypemirrors actual type actualtype expected type expectedtype compare type mirrors comparetypemirrors element actual element expected string expected kind expectedkind expected get attribute getattribute kind tag expected kind expectedkind expected kind expectedkind length string actual kind actualkind actual get attribute getattribute kind tag expected kind expectedkind equals actual kind actualkind print problem printproblem super classes superclasses kind expected expected kind expectedkind actual kind actualkind print differences printdifferences type kind typekind error equals expected kind expectedkind string expected to string expectedtostring expected get attribute getattribute string tag expected to string expectedtostring expected to string expectedtostring length string actual to string actualtostring actual get attribute getattribute string tag expected to string expectedtostring equals actual to string actualtostring print problem printproblem super classes superclasses to string tostring output expected expected to string expectedtostring actual to string actualtostring print differences printdifferences parent find child element child element find name d child element findnamedchildelement node parent string node parent get first child getfirstchild get next sibling getnextsibling get node type getnodetype node element node equals get node name getnodename element locate model node node exist model completely empty root model node element find root node findrootnode document doc find name d child element findnamedchildelement doc model tag compare actual expected ignore presence elements expected absent actual iff elements tag ged tagged optional attribute collections match optional match optionalmatch map string element actual map string element expected actual expected string extra actuals extraactuals hash set hashset string actual key set keyset extra actuals extraactuals remove all removeall expected key set keyset extra actuals extraactuals is empty isempty expected actual optional string extra expecteds extraexpecteds hash set hashset string expected key set keyset extra expecteds extraexpecteds remove all removeall actual key set keyset iterator string iter extra expecteds extraexpecteds iterator iter has next hasnext element expected iter optional parse boolean parseboolean get attribute getattribute optional tag optional iter remove extra expecteds extraexpecteds is empty isempty print actual expected doc uments documents string form todo cursor compared difference detected print differences printdifferences println actual println xml converter xmlconverter xml to string xmltostring actual println n and nand expected println xml converter xmlconverter xml to string xmltostring expected report specific problem print problem printproblem string msg summary summary append msg println msg