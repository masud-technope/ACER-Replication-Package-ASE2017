copyright ibm corporation rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors ibm corporation initial api implementation org eclipse jdt core tests util org eclipse jdt core compiler batch batch compiler batchcompiler org eclipse jdt core tests runtime java java net verifies files compilation loaded test verifier testverifier string failure reason failurereason reusevm string classpath cache classpathcache local virtual machine localvirtualmachine string buffer stringbuffer output buffer outputbuffer string buffer stringbuffer error buffer errorbuffer socket socket test verifier testverifier reusevm reusevm reusevm check buffers checkbuffers string output string outputstring string error string errorstring string source file name sourcefilename string expected output string expectedoutputstring string expected error string start expectederrorstringstart did match expectation didmatchexpectation string platform independant string platformindependantstring failure reason failurereason expected output string expectedoutputstring platform independant string platformindependantstring util convert to independant line delimiter converttoindependantlinedelimiter output string outputstring trim util convert to independant line delimiter converttoindependantlinedelimiter expected output string expectedoutputstring equals platform independant string platformindependantstring system println util display string displaystring platform independant string platformindependantstring failure reason failurereason unexpected output running file source file name sourcefilename start output string outputstring did match expectation didmatchexpectation string trimmed error string trimmederrorstring error string errorstring trim expected error string start expectederrorstringstart platform independant string platformindependantstring util convert to independant line delimiter converttoindependantlinedelimiter trimmed error string trimmederrorstring expected error string start expectederrorstringstart length platform independant string platformindependantstring length platform independant string platformindependantstring starts with startswith util convert to independant line delimiter converttoindependantlinedelimiter expected error string start expectederrorstringstart opportunistic heuristic error strings comparison skip test empty empty starts ins ufficient insufficient env is ion envision specific match ers matchers specific system println util display string displaystring platform independant string platformindependantstring failure reason failurereason unexpected error running file source file name sourcefilename start error string errorstring did match expectation didmatchexpectation trimmed error string trimmederrorstring length platform independant string platformindependantstring util convert to independant line delimiter converttoindependantlinedelimiter trimmed error string trimmederrorstring system println util display string displaystring platform independant string platformindependantstring failure reason failurereason unexpected error running file source file name sourcefilename start error string errorstring did match expectation didmatchexpectation did match expectation didmatchexpectation check buffers throwing error checkbuffersthrowingerror string error string errorstring string source file name sourcefilename string expected success output string expectedsuccessoutputstring error string errorstring length error string errorstring index of indexof expected success output string expectedsuccessoutputstring failure reason failurereason expected error thrown source file name sourcefilename expected success output string expectedsuccessoutputstring compile verify tests compileverifytests string verifier dir verifierdir string fully qualified name fullyqualifiedname verify tests verifytests get name getname last dot lastdot fully qualified name fullyqualifiedname last index of lastindexof string package name packagename fully qualified name fullyqualifiedname substring last dot lastdot string simple name simplename fully qualified name fullyqualifiedname substring last dot lastdot string dir name dirname verifier dir verifierdir replace package name packagename replace file dir file dir name dirname replace file separator char separatorchar dir exists dir mkdirs system println create dir string file name filename dir file separator simple name simplename java util write to file writetofile get verify tests code getverifytestscode file name filename batch compiler batchcompiler compile file name filename verifier dir verifierdir warn resource classpath util get java class libs as string getjavaclasslibsasstring print writer printwriter system print writer printwriter system err execute string class name classname string class paths classpaths output buffer outputbuffer string buffer stringbuffer error buffer errorbuffer string buffer stringbuffer launch and run launchandrun class name classname class paths classpaths finalize throwable shut down shutdown string get execution output getexecutionoutput output buffer outputbuffer to string tostring string get execution error getexecutionerror error buffer errorbuffer to string tostring string get verify tests code getverifytestscode copyright ibm corporation rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors ibm corporation initial api implementation org eclipse jdt core tests util java data input stream datainputstream java data output stream dataoutputstream java file java file input stream fileinputstream java file not found exception filenotfoundexception java io exception ioexception java input stream inputstream java lang reflect invocation target exception invocationtargetexception java lang reflect method java net server socket serversocket java net socket java util string tokenizer stringtokenizer note modifying copy source test verifier testverifier get verify tests code getverifytestscode method details verify tests verifytests port number portnumber socket socket note code copied junit util test case class loader testcaseclassloader custom loader enables reloading classes test loader configured list paths excluded loading loading packages delegate d delegated system loader shared test runs list excluded paths properties file excluded properties located place test case class loader testcaseclassloader limitation verify class loader verifyclassloader load classes jar files verify class loader verifyclassloader class loader classloader scanned path string path items pathitems excluded paths string excluded constructs verify class loader verifyclassloader scans path excluded paths verify class loader verifyclassloader string class path classpath system get property getproperty java path string separator system get property getproperty path separator pass count elements string tokenizer stringtokenizer string tokenizer stringtokenizer class path classpath separator has more tokens hasmoretokens next token nexttoken pass split path items pathitems string string tokenizer stringtokenizer class path classpath separator has more tokens hasmoretokens path items pathitems next token nexttoken java net url get resource getresource string class loader classloader get system resource getsystemresource input stream inputstream get resource as stream getresourceasstream string class loader classloader get system resource as stream getsystemresourceasstream is excluded isexcluded string exclude java packages excluded loaded system loader starts with startswith java starts with startswith ljava exclude user defined paths excluded length starts with startswith excluded load class loadclass string resolve class not found exception classnotfoundexception find loaded class findloadedclass delegate loading excluded classes standard loader is excluded isexcluded find system class findsystemclass class not found exception classnotfoundexception searching file file locate file class not found exception classnotfoundexception data load class data loadclassdata file define class defineclass data data length resolve resolve class resolveclass load class data loadclassdata file class not found exception classnotfoundexception file input stream fileinputstream stream system println loading get path getpath stream file input stream fileinputstream stream stream read io exception ioexception class not found exception classnotfoundexception file not found exception filenotfoundexception class not found exception classnotfoundexception stream stream close io exception ioexception ignore locate file returns file could n couldn file locate string file name filename file name filename file name filename file name filename replace file path path items pathitems length path file path items pathitems file name filename path exists path load and run loadandrun string class name classname throwable system println loading class name classname test class testclass verify class loader verifyclassloader load class loadclass class name classname system println loaded class name classname method main test class testclass get method getmethod main string system println running class name classname main invoke object string system println finished running class name classname no such method exception nosuchmethodexception invocation target exception invocationtargetexception get target exception gettargetexception main string args io exception ioexception verify tests verifytests verify verify tests verifytests verify port number portnumber integer parse int parseint args verify io exception ioexception server socket serversocket server server socket serversocket port number portnumber socket server accept socket set tcp no delay settcpnodelay server close data input stream datainputstream data input stream datainputstream socket get input stream getinputstream data output stream dataoutputstream data output stream dataoutputstream socket get output stream getoutputstream string class name classname readutf thread thread thread load and run loadandrun class name classname write boolean writeboolean system err println verify tests verifytests get name getname system println verify tests verifytests get name getname throwable print stack trace printstacktrace system err println verify tests verifytests get name getname system println verify tests verifytests get name getname write boolean writeboolean io exception ioexception print stack trace printstacktrace flush io exception ioexception print stack trace printstacktrace thread start launch and run launchandrun string class name classname string class paths classpaths string program arguments programarguments string vm arguments vmarguments won reuse shut existing running shut down shutdown target exception targetexception classpath cache classpathcache launch localvmlauncher launcher localvmlauncher get launcher getlauncher launcher set class path setclasspath class paths classpaths launcher setvmpath util getjredirectory vm arguments vmarguments string complete vm arguments completevmarguments string vm arguments vmarguments length system arraycopy vm arguments vmarguments complete vm arguments completevmarguments vm arguments vmarguments length complete vm arguments completevmarguments verify launcher setvmarguments complete vm arguments completevmarguments launcher setvmarguments string verify launcher set program class setprogramclass class name classname launcher set program arguments setprogramarguments program arguments programarguments thread output thread outputthread thread error thread errorthread launcher launch input stream inputstream input get input stream getinputstream output thread outputthread thread runnable input read test verifier testverifier output buffer outputbuffer append input read io exception ioexception input stream inputstream error stream errorstream get error stream geterrorstream error thread errorthread thread runnable error stream errorstream read test verifier testverifier error buffer errorbuffer append error stream errorstream read io exception ioexception output thread outputthread start error thread errorthread start target exception targetexception error get message getmessage wait shut shut vm s vms force fully forcefully down stream downstream output thread outputthread join slack error thread errorthread join interrupted exception interruptedexception launch verify tests if needed launchverifytestsifneeded string class paths classpaths string vm arguments vmarguments determine reuse is running isrunning classpath cache classpathcache class paths classpaths length classpath cache classpathcache length same class paths sameclasspaths class paths classpaths length classpath cache classpathcache equals class paths classpaths same class paths sameclasspaths same class paths sameclasspaths reuse shut existing running shut down shutdown target exception targetexception classpath cache classpathcache class paths classpaths launch localvmlauncher launcher localvmlauncher get launcher getlauncher length class paths classpaths length string string length system arraycopy class paths classpaths length string verifier dir verifierdir util get output directory getoutputdirectory file separator verifier compile verify tests compileverifytests verifier dir verifierdir length verifier dir verifierdir launcher set class path setclasspath launcher setvmpath util getjredirectory vm arguments vmarguments string complete vm arguments completevmarguments string vm arguments vmarguments length system arraycopy vm arguments vmarguments complete vm arguments completevmarguments vm arguments vmarguments length complete vm arguments completevmarguments verify launcher setvmarguments complete vm arguments completevmarguments launcher setvmarguments string verify launcher set program class setprogramclass verify tests verifytests get name getname port number portnumber util get free port getfreeport launcher set program arguments setprogramarguments string integer to string tostring port number portnumber launcher launch input stream inputstream input get input stream getinputstream thread output thread outputthread thread runnable input read test verifier testverifier output buffer outputbuffer append input read io exception ioexception io ex ioex input stream inputstream error stream errorstream get error stream geterrorstream thread error thread errorthread thread runnable error stream errorstream read test verifier testverifier error buffer errorbuffer append error stream errorstream read io exception ioexception io ex ioex output thread outputthread start error thread errorthread start target exception targetexception error get message getmessage connect socket isvmrunning socket socket localhost port number portnumber socket set tcp no delay settcpnodelay unknown host exception unknownhostexception io exception ioexception socket thread sleep interrupted exception interruptedexception isvmrunning is running isrunning socket isvmrunning loads runs exception thrown running load and run loadandrun string class name classname socket data output stream dataoutputstream data output stream dataoutputstream socket get output stream getoutputstream writeutf class name classname data input stream datainputstream data input stream datainputstream socket get input stream getinputstream result read boolean readboolean wait for full buffers waitforfullbuffers result socket exception socketexception io exception ioexception print stack trace printstacktrace shut down shutdown close socket resource chance free d freed socket socket close io exception ioexception print stack trace printstacktrace wait shut seconds succesfull force shut retry is running isrunning retry thread sleep interrupted exception interruptedexception is running isrunning shut down shutdown target exception targetexception print stack trace printstacktrace verify files created test file loaded virtual machine verify class files verifyclassfiles string source file path sourcefilepath string class name classname string expected success output string expectedsuccessoutputstring string class paths classpaths verify class files verifyclassfiles source file path sourcefilepath class name classname expected success output string expectedsuccessoutputstring class paths classpaths verify files created test file loaded virtual machine verify class files verifyclassfiles string source file path sourcefilepath string class name classname string expected success output string expectedsuccessoutputstring string class paths classpaths string program arguments programarguments string vm arguments vmarguments verify class files verifyclassfiles source file path sourcefilepath class name classname expected success output string expectedsuccessoutputstring class paths classpaths program arguments programarguments vm arguments vmarguments verify class files verifyclassfiles string source file path sourcefilepath string class name classname string expected output string expectedoutputstring string expected error string start expectederrorstringstart string class paths classpaths string program arguments programarguments string vm arguments vmarguments output buffer outputbuffer string buffer stringbuffer error buffer errorbuffer string buffer stringbuffer reusevm program arguments programarguments launch verify tests if needed launchverifytestsifneeded class paths classpaths vm arguments vmarguments load and run loadandrun class name classname launch and run launchandrun class name classname class paths classpaths program arguments programarguments vm arguments vmarguments failure reason failurereason check buffers checkbuffers output buffer outputbuffer to string tostring error buffer errorbuffer to string tostring source file path sourcefilepath expected output string expectedoutputstring expected error string start expectederrorstringstart verify files created test file loaded expected error contained expected success output string expectedsuccessoutputstring string verify class files throwing error verifyclassfilesthrowingerror string source file path sourcefilepath string class name classname string expected success output string expectedsuccessoutputstring string class paths classpaths string program arguments programarguments string vm arguments vmarguments output buffer outputbuffer string buffer stringbuffer error buffer errorbuffer string buffer stringbuffer reusevm program arguments programarguments launch verify tests if needed launchverifytestsifneeded class paths classpaths vm arguments vmarguments load and run loadandrun class name classname launch and run launchandrun class name classname class paths classpaths program arguments programarguments vm arguments vmarguments failure reason failurereason check buffers throwing error checkbuffersthrowingerror error buffer errorbuffer to string tostring source file path sourcefilepath expected success output string expectedsuccessoutputstring wait read stdout sterr wait for full buffers waitforfullbuffers string end string endstring verify tests verifytests get name getname count error end string start errorendstringstart error buffer errorbuffer to string tostring index of indexof end string endstring output end string start outputendstringstart output buffer outputbuffer to string tostring index of indexof end string endstring error end string start errorendstringstart output end string start outputendstringstart thread sleep interrupted exception interruptedexception count error end string start errorendstringstart error buffer errorbuffer to string tostring index of indexof end string endstring output end string start outputendstringstart output buffer outputbuffer to string tostring index of indexof end string endstring error buffer errorbuffer set length setlength error end string start errorendstringstart output buffer outputbuffer set length setlength output end string start outputendstringstart