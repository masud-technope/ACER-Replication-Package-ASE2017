copyright mateusz matela rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors mateusz matela mateusz matela gmail formatter formatter format java code correctly max width https bugs eclipse org mateusz matela mateusz matela gmail formatter index out of bounds exception indexoutofboundsexception token manager tokenmanager https bugs eclipse org mateusz matela mateusz matela gmail formatter follow bug comments https bugs eclipse org org eclipse jdt internal formatter org eclipse jdt internal compiler parser terminal tokens terminaltokens token name t tokennameat org eclipse jdt internal compiler parser terminal tokens terminaltokens tokennamecolon org eclipse jdt internal compiler parser terminal tokens terminaltokens tokennamecomma org eclipse jdt internal compiler parser terminal tokens terminaltokens tokennamecomment javadoc org eclipse jdt internal compiler parser terminal tokens terminaltokens tokennamelbrace org eclipse jdt internal compiler parser terminal tokens terminaltokens tokennamelparen org eclipse jdt internal compiler parser terminal tokens terminaltokens tokennamerbrace org eclipse jdt internal compiler parser terminal tokens terminaltokens tokennamerparen org eclipse jdt internal compiler parser terminal tokens terminaltokens tokennamesemicolon org eclipse jdt internal compiler parser terminal tokens terminaltokens token name else tokennameelse org eclipse jdt internal compiler parser terminal tokens terminaltokens token name finally tokennamefinally org eclipse jdt internal compiler parser terminal tokens terminaltokens token name package tokennamepackage org eclipse jdt internal compiler parser terminal tokens terminaltokens token name while tokennamewhile java util list org eclipse jdt core dom ast node astnode org eclipse jdt core dom ast visitor astvisitor org eclipse jdt core dom abstract type declaration abstracttypedeclaration org eclipse jdt core dom annotation org eclipse jdt core dom annotation type declaration annotationtypedeclaration org eclipse jdt core dom annotation type member declaration annotationtypememberdeclaration org eclipse jdt core dom anonymous class declaration anonymousclassdeclaration org eclipse jdt core dom array initializer arrayinitializer org eclipse jdt core dom block org eclipse jdt core dom body declaration bodydeclaration org eclipse jdt core dom break statement breakstatement org eclipse jdt core dom catch clause catchclause org eclipse jdt core dom class instance creation classinstancecreation org eclipse jdt core dom compilation unit compilationunit org eclipse jdt core dom constructor invocation constructorinvocation org eclipse jdt core dom continue statement continuestatement org eclipse jdt core dom do statement dostatement org eclipse jdt core dom empty statement emptystatement org eclipse jdt core dom enhanced for statement enhancedforstatement org eclipse jdt core dom enum constant declaration enumconstantdeclaration org eclipse jdt core dom enum declaration enumdeclaration org eclipse jdt core dom field declaration fielddeclaration org eclipse jdt core dom for statement forstatement org eclipse jdt core dom if statement ifstatement org eclipse jdt core dom import declaration importdeclaration org eclipse jdt core dom initializer org eclipse jdt core dom labeled statement labeledstatement org eclipse jdt core dom lambda expression lambdaexpression org eclipse jdt core dom marker annotation markerannotation org eclipse jdt core dom method declaration methoddeclaration org eclipse jdt core dom method invocation methodinvocation org eclipse jdt core dom modifier org eclipse jdt core dom normal annotation normalannotation org eclipse jdt core dom package declaration packagedeclaration org eclipse jdt core dom return statement returnstatement org eclipse jdt core dom single member annotation singlememberannotation org eclipse jdt core dom single variable declaration singlevariabledeclaration org eclipse jdt core dom statement org eclipse jdt core dom super constructor invocation superconstructorinvocation org eclipse jdt core dom super method invocation supermethodinvocation org eclipse jdt core dom switch case switchcase org eclipse jdt core dom switch statement switchstatement org eclipse jdt core dom try statement trystatement org eclipse jdt core dom type declaration typedeclaration org eclipse jdt core dom variable declaration expression variabledeclarationexpression org eclipse jdt core dom variable declaration statement variabledeclarationstatement org eclipse jdt core dom while statement whilestatement org eclipse jdt core formatter default code formatter constants defaultcodeformatterconstants org eclipse jdt internal formatter token wrap mode wrapmode org eclipse jdt internal formatter token wrap policy wrappolicy line breaks preparator linebreakspreparator ast visitor astvisitor token manager tokenmanager default code formatter options defaultcodeformatteroptions options declaration modifier visited declarationmodifiervisited line breaks preparator linebreakspreparator token manager tokenmanager token manager tokenmanager default code formatter options defaultcodeformatteroptions options token manager tokenmanager options options override pre visit previsit ast node astnode node is malformed ismalformed node get flags getflags ast node astnode malformed is malformed ismalformed override visit compilation unit compilationunit node list import declaration importdeclaration imports node imports imports is empty isempty first index in firstindexin imports put line breaks before putlinebreaksbefore options blank lines imports list annotation type declaration annotationtypedeclaration types node types types is empty isempty imports is empty isempty put blank lines before putblanklinesbefore types options blank lines imports types size put blank lines before putblanklinesbefore types options blank lines type declarations override visit package declaration packagedeclaration node blanks options blank lines blanks list annotation annotations node annotations first token index firsttokenindex annotations is empty isempty first index before firstindexbefore node get name getname token name package tokennamepackage first index in firstindexin annotations first token index firsttokenindex put line breaks before putlinebreaksbefore blanks last token in lasttokenin node tokennamesemicolon put line breaks after putlinebreaksafter options blank lines declaration modifier visited declarationmodifiervisited override visit import declaration importdeclaration node break line before breaklinebefore node visit type declaration typedeclaration node handle body declarations handlebodydeclarations node body declarations bodydeclarations node get name getname get start position getstartposition fake type created parsing body mode break line before breaklinebefore node handle brace d code handlebracedcode node node get name getname options brace position type declaration options indent body declarations compare type header options insert empty type declaration declaration modifier visited declarationmodifiervisited handle body declarations handlebodydeclarations list body declaration bodydeclaration body declarations bodydeclarations body declaration bodydeclaration previous body declaration bodydeclaration body declaration bodydeclaration body declarations bodydeclarations previous put blank lines before putblanklinesbefore body declaration bodydeclaration options blank lines body declaration blank lines blanklines body declaration bodydeclaration field declaration fielddeclaration blank lines blanklines options blank lines field body declaration bodydeclaration abstract type declaration abstracttypedeclaration blank lines blanklines options blank lines member type body declaration bodydeclaration method declaration methoddeclaration body declaration bodydeclaration annotation type member declaration annotationtypememberdeclaration blank lines blanklines options blank lines method same chunk samechunk previous body declaration bodydeclaration blank lines blanklines math max blank lines blanklines options blank lines chunk put blank lines before putblanklinesbefore body declaration bodydeclaration blank lines blanklines previous body declaration bodydeclaration same chunk samechunk body declaration bodydeclaration body declaration bodydeclaration get class getclass equals get class getclass abstract type declaration abstracttypedeclaration abstract type declaration abstracttypedeclaration field declaration fielddeclaration initializer field declaration fielddeclaration initializer put blank lines before putblanklinesbefore ast node astnode node lines count linescount first index in firstindexin node token type tokentype tokennamecomment javadoc put line breaks before putlinebreaksbefore lines count linescount override visit enum declaration enumdeclaration node handle brace d code handlebracedcode node node get name getname options brace position enum declaration options indent body declarations compare enum declaration header options insert empty enum declaration handle body declarations handlebodydeclarations node body declarations bodydeclarations list enum constant declaration enumconstantdeclaration enum constants enumconstants node enum constants enumconstants enum constants enumconstants size enum constant declaration enumconstantdeclaration declaration enum constants enumconstants declaration get javadoc getjavadoc first token in firsttokenin declaration tokennamecomment javadoc break before breakbefore declaration get anonymous class declaration getanonymousclassdeclaration enum constants enumconstants size first token after firsttokenafter declaration tokennamecomma break after breakafter breaks semicolons enum constants enumconstants is empty isempty first index after firstindexafter node get name getname tokennamelbrace first index after firstindexafter enum constants enumconstants enum constants enumconstants size token token token is comment iscomment token token type tokentype tokennamesemicolon token break after breakafter declaration modifier visited declarationmodifiervisited override visit annotation type declaration annotationtypedeclaration node handle brace d code handlebracedcode node node get name getname options brace position annotation type declaration options indent body declarations compare annotation declaration header options insert empty annotation declaration handle body declarations handlebodydeclarations node body declarations bodydeclarations node get modifiers getmodifiers first token before firsttokenbefore node get name getname token name t tokennameat break before breakbefore declaration modifier visited declarationmodifiervisited override visit anonymous class declaration anonymousclassdeclaration node node get parent getparent enum constant declaration enumconstantdeclaration handle brace d code handlebracedcode node options brace position enum constant options indent body declarations compare enum constant header options insert empty enum constant handle brace d code handlebracedcode node options brace position anonymous type declaration options indent body declarations compare type header options insert empty anonymous type declaration handle body declarations handlebodydeclarations node body declarations bodydeclarations override visit method declaration methoddeclaration node declaration modifier visited declarationmodifiervisited l paren lparen first index after firstindexafter node get name getname tokennamelparen r paren rparen node get body getbody last index in lastindexin node tokennamerparen first index before firstindexbefore node get body getbody tokennamerparen handle parentheses positions handleparenthesespositions l paren lparen r paren rparen options parenthesis positions method declaration node get body getbody string brace position braceposition node is constructor isconstructor options brace position constructor declaration options brace position method declaration handle brace d code handlebracedcode node get body getbody brace position braceposition options indent statements compare body options insert empty method body token open brace openbrace first token in firsttokenin node get body getbody tokennamelbrace empty braces open brace openbrace get line breaks after getlinebreaksafter open brace openbrace put line breaks after putlinebreaksafter options blank lines method body override visit block node options guardian clause is guard clause isguardclause node list statement statements node statements statement statement statements options empty statement statement empty statement emptystatement break line before breaklinebefore statement node get parent getparent get length getlength fake block created parsing statements mode ast node astnode parent node get parent getparent parent method declaration methoddeclaration braces handled visit method declaration methoddeclaration string brace position braceposition options brace position block parent switch statement switchstatement list statement siblings switch statement switchstatement parent statements block position blockposition siblings index of indexof node is first in case isfirstincase block position blockposition siblings block position blockposition switch case switchcase is first in case isfirstincase brace position braceposition options brace position block parent lambda expression lambdaexpression brace position braceposition options brace position lambda body handle brace d code handlebracedcode node brace position braceposition options indent statements compare block options insert empty block override visit switch statement switchstatement node handle brace d code handlebracedcode node node get expression getexpression options brace position options indent switch statements switchstatements compare list statement statements node statements options indent switch statements switchstatements compare cases non break statement end nonbreakstatementend statement statement statements is breaking isbreaking statement break statement breakstatement statement return statement returnstatement statement continue statement continuestatement statement block is breaking isbreaking statement block adjust empty line after adjustemptylineafter last index in lastindexin statement statement switch case switchcase non break statement end nonbreakstatementend indent comments previous current statement non break statement end nonbreakstatementend indent first token in firsttokenin statement unindent statement break statement breakstatement statement block indent statement non break statement end nonbreakstatementend is breaking isbreaking last index in lastindexin statement non break statement end nonbreakstatementend indent comments statement closing brace non break statement end nonbreakstatementend indent last token in lasttokenin node tokennamerbrace unindent options indent breaks compare cases statement statement statements statement break statement breakstatement indent statement statement statement statements statement block add visit block options empty statement statement empty statement emptystatement break line before breaklinebefore statement l paren lparen first index in firstindexin node tokennamelparen r paren rparen first index after firstindexafter node get expression getexpression tokennamerparen handle parentheses positions handleparenthesespositions l paren lparen r paren rparen options parenthesis positions statement override visit do statement dostatement node statement body node get body getbody handle loop body handleloopbody body options insert statement body block body empty statement emptystatement token while token whiletoken first token before firsttokenbefore node get expression getexpression token name while tokennamewhile while token whiletoken break before breakbefore l paren lparen first index before firstindexbefore node get expression getexpression tokennamelparen r paren rparen first index after firstindexafter node get expression getexpression tokennamerparen handle parentheses positions handleparenthesespositions l paren lparen r paren rparen options parenthesis positions statement override visit labeled statement labeledstatement node options insert label first token in firsttokenin node tokennamecolon break after breakafter override visit array initializer arrayinitializer node open brace index openbraceindex first index in firstindexin node tokennamelbrace close brace index closebraceindex last index in lastindexin node tokennamerbrace is empty isempty open brace index openbraceindex close brace index closebraceindex is empty isempty adjust empty line after adjustemptylineafter open brace index openbraceindex options continuation indentation array initializer close brace index closebraceindex last index in lastindexin node tokennamerbrace token open brace token openbracetoken open brace index openbraceindex token close brace token closebracetoken close brace index closebraceindex node get parent getparent array initializer arrayinitializer token after open brace token afteropenbracetoken open brace index openbraceindex options continuation indentation array initializer after open brace token afteropenbracetoken indent close brace token closebracetoken unindent is empty isempty options empty array initializer handle brace position handlebraceposition open brace token openbracetoken close brace index closebraceindex options brace position array initializer is empty isempty options insert opening brace array initializer open brace token openbracetoken break after breakafter options insert closing brace array initializer close brace token closebracetoken break before breakbefore override visit normal annotation normalannotation node handle annotation handleannotation node override visit single member annotation singlememberannotation node handle annotation handleannotation node override visit marker annotation markerannotation node handle annotation handleannotation node override visit variable declaration statement variabledeclarationstatement node declaration modifier visited declarationmodifiervisited override visit single variable declaration singlevariabledeclaration node declaration modifier visited declarationmodifiervisited node get parent getparent method declaration methoddeclaration special annotations parameters modifiers treated type annotations declaration modifier visited declarationmodifiervisited node get modifiers getmodifiers override visit variable declaration expression variabledeclarationexpression node declaration modifier visited declarationmodifiervisited override visit field declaration fielddeclaration node declaration modifier visited declarationmodifiervisited override visit annotation type member declaration annotationtypememberdeclaration node declaration modifier visited declarationmodifiervisited override visit enum constant declaration enumconstantdeclaration node declaration modifier visited declarationmodifiervisited l paren lparen first index after firstindexafter node get name getname l paren lparen is comment iscomment l paren lparen l paren lparen token type tokentype tokennamelparen r paren rparen node get anonymous class declaration getanonymousclassdeclaration last index in lastindexin node tokennamerparen first index before firstindexbefore node get anonymous class declaration getanonymousclassdeclaration tokennamerparen handle parentheses positions handleparenthesespositions l paren lparen r paren rparen options parenthesis positions enum constant declaration override visit modifier node declaration modifier visited declarationmodifiervisited handle annotation handleannotation annotation node ast node astnode parent node parentnode node get parent getparent break after breakafter is type annotation istypeannotation declaration modifier visited declarationmodifiervisited is type annotation istypeannotation break after breakafter options insert type annotation parent node parentnode package declaration packagedeclaration break after breakafter options insert annotation parent node parentnode abstract type declaration abstracttypedeclaration break after breakafter options insert annotation type parent node parentnode enum constant declaration enumconstantdeclaration break after breakafter options insert annotation enum constant parent node parentnode field declaration fielddeclaration break after breakafter options insert annotation field parent node parentnode method declaration methoddeclaration break after breakafter options insert annotation method parent node parentnode annotation type member declaration annotationtypememberdeclaration break after breakafter options insert annotation method annotation type member declaration annotationtypememberdeclaration parent node parentnode get default getdefault node parent node parentnode variable declaration statement variabledeclarationstatement parent node parentnode variable declaration expression variabledeclarationexpression break after breakafter options insert annotation local variable parent node parentnode single variable declaration singlevariabledeclaration break after breakafter options insert annotation parameter parent node parentnode get parent getparent enhanced for statement enhancedforstatement break after breakafter options insert annotation local variable break after breakafter last token in lasttokenin node break after breakafter node marker annotation markerannotation l paren lparen first index after firstindexafter node get type name gettypename tokennamelparen r paren rparen last index in lastindexin node tokennamerparen handle parentheses positions handleparenthesespositions l paren lparen r paren rparen options parenthesis positions annotation override visit while statement whilestatement node handle loop body handleloopbody node get body getbody l paren lparen first index in firstindexin node tokennamelparen r paren rparen first index after firstindexafter node get expression getexpression tokennamerparen handle parentheses positions handleparenthesespositions l paren lparen r paren rparen options parenthesis positions statement override visit for statement forstatement node handle loop body handleloopbody node get body getbody l paren lparen first index in firstindexin node tokennamelparen r paren rparen first index before firstindexbefore node get body getbody tokennamerparen handle parentheses positions handleparenthesespositions l paren lparen r paren rparen options parenthesis positions statement override visit enhanced for statement enhancedforstatement node handle loop body handleloopbody node get body getbody l paren lparen first index in firstindexin node tokennamelparen r paren rparen first index before firstindexbefore node get body getbody tokennamerparen handle parentheses positions handleparenthesespositions l paren lparen r paren rparen options parenthesis positions statement handle loop body handleloopbody statement body body block body empty statement emptystatement options empty statement body get parent getparent if statement ifstatement break line before breaklinebefore body adjust empty line after adjustemptylineafter last index in lastindexin body indent body override visit if statement ifstatement node statement else node elsenode node get else statement getelsestatement statement then node thennode node get then statement getthenstatement else node elsenode options insert statement then node thennode block first token before firsttokenbefore else node elsenode token name else tokennameelse break before breakbefore keep else on same line keepelseonsameline options statement options compact else node elsenode if statement ifstatement keep else on same line keepelseonsameline handle loop body handleloopbody else node elsenode keep then on same line keepthenonsameline options statement options simple else node elsenode keep then on same line keepthenonsameline handle loop body handleloopbody then node thennode l paren lparen first index in firstindexin node tokennamelparen r paren rparen first index after firstindexafter node get expression getexpression tokennamerparen handle parentheses positions handleparenthesespositions l paren lparen r paren rparen options parenthesis positions statement override visit try statement trystatement node node get finally getfinally options insert statement first token before firsttokenbefore node get finally getfinally token name finally tokennamefinally break before breakbefore node resources is empty isempty l paren lparen first index in firstindexin node tokennamelparen r paren rparen first index before firstindexbefore node get body getbody tokennamerparen handle parentheses positions handleparenthesespositions l paren lparen r paren rparen options parenthesis positions clause override visit catch clause catchclause node options insert statement break line before breaklinebefore node l paren lparen first index in firstindexin node tokennamelparen r paren rparen first index before firstindexbefore node get body getbody tokennamerparen handle parentheses positions handleparenthesespositions l paren lparen r paren rparen options parenthesis positions clause override visit lambda expression lambdaexpression node l paren lparen first index in firstindexin node l paren lparen token type tokentype tokennamelparen r paren rparen first index before firstindexbefore node get body getbody tokennamerparen handle parentheses positions handleparenthesespositions l paren lparen r paren rparen options parenthesis positions lambda declaration override visit method invocation methodinvocation node l paren lparen first index after firstindexafter node get name getname tokennamelparen r paren rparen last index in lastindexin node tokennamerparen handle parentheses positions handleparenthesespositions l paren lparen r paren rparen options parenthesis positions method invocation override visit super method invocation supermethodinvocation node l paren lparen first index after firstindexafter node get name getname tokennamelparen r paren rparen last index in lastindexin node tokennamerparen handle parentheses positions handleparenthesespositions l paren lparen r paren rparen options parenthesis positions method invocation override visit class instance creation classinstancecreation node l paren lparen first index after firstindexafter node get type gettype tokennamelparen r paren rparen node get anonymous class declaration getanonymousclassdeclaration last index in lastindexin node tokennamerparen first index before firstindexbefore node get anonymous class declaration getanonymousclassdeclaration tokennamerparen handle parentheses positions handleparenthesespositions l paren lparen r paren rparen options parenthesis positions method invocation override visit constructor invocation constructorinvocation node l paren lparen node arguments is empty isempty last index in lastindexin node tokennamelparen first index before firstindexbefore ast node astnode node arguments tokennamelparen r paren rparen last index in lastindexin node tokennamerparen handle parentheses positions handleparenthesespositions l paren lparen r paren rparen options parenthesis positions method invocation override visit super constructor invocation superconstructorinvocation node l paren lparen node arguments is empty isempty last index in lastindexin node tokennamelparen first index before firstindexbefore ast node astnode node arguments tokennamelparen r paren rparen last index in lastindexin node tokennamerparen handle parentheses positions handleparenthesespositions l paren lparen r paren rparen options parenthesis positions method invocation break line before breaklinebefore ast node astnode node first token in firsttokenin node break before breakbefore handle brace d code handlebracedcode ast node astnode node ast node astnode node before open brace nodebeforeopenbrace string brace position braceposition indent body indentbody new line in empty newlineinempty open brace index openbraceindex node before open brace nodebeforeopenbrace first index in firstindexin node tokennamelbrace first index after firstindexafter node before open brace nodebeforeopenbrace tokennamelbrace close brace index closebraceindex last index in lastindexin node tokennamerbrace token open brace token openbracetoken open brace index openbraceindex token close brace token closebracetoken close brace index closebraceindex handle brace position handlebraceposition open brace token openbracetoken close brace index closebraceindex brace position braceposition is empty isempty open brace index openbraceindex close brace index closebraceindex is comment iscomment is empty isempty is empty isempty new line in empty newlineinempty open brace token openbracetoken break after breakafter close brace token closebracetoken break before breakbefore indent body indentbody adjust empty line after adjustemptylineafter open brace index openbraceindex open brace index openbraceindex indent close brace token closebracetoken unindent handle brace position handlebraceposition token open brace token openbracetoken close brace index closebraceindex string brace position braceposition brace position braceposition equals default code formatter constants defaultcodeformatterconstants open brace token openbracetoken break before breakbefore brace position braceposition equals default code formatter constants defaultcodeformatterconstants shifted open brace token openbracetoken break before breakbefore open brace token openbracetoken indent close brace index closebraceindex size close brace index closebraceindex unindent brace position braceposition equals default code formatter constants defaultcodeformatterconstants wrap open brace token openbracetoken set next line on wrap setnextlineonwrap adjust empty line after adjustemptylineafter token index tokenindex indentation adjustment indentationadjustment token index tokenindex size token token token index tokenindex token token index tokenindex count line breaks between countlinebreaksbetween token options indent empty lines set empty line indent adjustment setemptylineindentadjustment indentation adjustment indentationadjustment options indentation size indent ast node astnode node start index startindex first index in firstindexin node start index startindex start index startindex is comment iscomment start index startindex start index startindex indent last index lastindex last index in lastindexin node last index lastindex size last index lastindex unindent handle parentheses positions handleparenthesespositions opening paren index openingparenindex closing paren index closingparenindex string positions setting positionssetting positions setting positionssetting default code formatter constants defaultcodeformatterconstants common lines default code formatter constants defaultcodeformatterconstants separate lines wrapped opening paren index openingparenindex set separate lines on wrap until setseparatelinesonwrapuntil closing paren index closingparenindex default code formatter constants defaultcodeformatterconstants separate lines empty is empty isempty opening paren index openingparenindex closing paren index closingparenindex is empty isempty fall default code formatter constants defaultcodeformatterconstants separate lines default code formatter constants defaultcodeformatterconstants preserve positions positions setting positionssetting default code formatter constants defaultcodeformatterconstants preserve positions token after opening afteropening opening paren index openingparenindex count line breaks between countlinebreaksbetween opening paren index openingparenindex after opening afteropening after opening afteropening set wrap policy setwrappolicy wrap policy wrappolicy wrap mode wrapmode opening paren index openingparenindex options indentation size after opening afteropening break before breakbefore token closing paren closingparen closing paren index closingparenindex count line breaks between countlinebreaksbetween closing paren index closingparenindex closing paren closingparen closing paren closingparen set wrap policy setwrappolicy wrap policy wrappolicy wrap mode wrapmode opening paren index openingparenindex closing paren closingparen break before breakbefore nls illegal argument exception illegalargumentexception nls unrecognized parent heses parentheses positions setting positions setting positionssetting finish up finishup visits indents inc rease increase decrease prepare actual indent values current indent currentindent options initial indentation level token token current indent currentindent token get indent getindent token set indent setindent current indent currentindent options indentation size