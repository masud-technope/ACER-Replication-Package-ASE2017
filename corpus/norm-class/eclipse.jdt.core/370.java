copyright software rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors stephan herrmann initial api implementation org eclipse jdt core util java buffered reader bufferedreader java byte array input stream bytearrayinputstream java io exception ioexception java input stream reader inputstreamreader java unsupported encoding exception unsupportedencodingexception org eclipse core resources i container icontainer org eclipse core resources i file ifile org eclipse core resources i folder ifolder org eclipse core resources i resource iresource org eclipse core resources i workspace root iworkspaceroot org eclipse core runtime core exception coreexception org eclipse core runtime i path ipath org eclipse core runtime i progress monitor iprogressmonitor org eclipse core runtime i status istatus org eclipse core runtime status org eclipse jdt core i classpath entry iclasspathentry org eclipse jdt core i java element ijavaelement org eclipse jdt core i java project ijavaproject org eclipse jdt core i package fragment root ipackagefragmentroot org eclipse jdt core i type itype org eclipse jdt core java core javacore org eclipse jdt core compiler char operation charoperation org eclipse jdt core dom i method binding imethodbinding org eclipse jdt core dom i type binding itypebinding org eclipse jdt internal compiler class fmt classfmt external annotation provider externalannotationprovider org eclipse jdt internal compiler lookup signature wrapper signaturewrapper org eclipse jdt internal core classpath entry classpathentry org eclipse jdt internal core util key to signature keytosignature utilities accessing manipulating text files ext ernally externally define annotations java type files assumed eea format text ual textual representation annotated signatures members type noinstantiate intended instantiated clients external annotation util externalannotationutil representation null able nullable annotation independent concrete annotation java sources nullable external annotation provider externalannotationprovider nullable representation non null nonnull annotation independent concrete annotation java sources non null nonnull external annotation provider externalannotationprovider non null nonnull represents absence annotation removing existing annotation character int ernally internally eclipse external annotation file format annotation external annotation provider externalannotationprovider annotation strategy merging signature existing annotated signature enum merge strategy mergestrategy unconditionally replace signature replace signature override existing annotations keeping annotations locations annotated signature overwrite annotations add annotations remove overwrite existing annotations add annotations position type position full signature answer method signature file format param method binding methodbinding binding representing method signature file format string extract generic signature extractgenericsignature i method binding imethodbinding method binding methodbinding note i method binding imethodbinding binding accessible recover signature key key to signature keytosignature parser key to signature keytosignature method binding methodbinding get key getkey key to signature keytosignature signature parser parse parser to string tostring answer types signature file format param type binding representing type signature file format string extract generic type signature extractgenerictypesignature i type binding itypebinding type key to signature keytosignature parser key to signature keytosignature type get key getkey key to signature keytosignature signature parser parse parser to string tostring insert encoded annotation method signature methodsignature type method suitable declaration annotations param method signature methodsignature method signature file format param annotation link nullable link non null nonnull param merge strategy mergestrategy passing link merge strategy mergestrategy add annotations method ref use refuse overwrite existing annotation location modified method signature original signature modification conflict merge str ategy strategy illegal argument exception illegalargumentexception method signature malformed type reference type string insert return annotation insertreturnannotation string method signature methodsignature annotation merge strategy mergestrategy merge strategy mergestrategy close method signature methodsignature index of indexof close close method signature methodsignature length nls illegal argument exception illegalargumentexception malformed method signature method signature methodsignature char at charat close insert at insertat method signature methodsignature close annotation merge strategy mergestrategy nls illegal argument exception illegalargumentexception type reference type insert encoded annotation method signature methodsignature parameters method suitable declaration annotations param method signature methodsignature method signature file format param param idx paramidx based parameter annotation attached param annotation link nullable link non null nonnull param merge strategy mergestrategy passing link merge strategy mergestrategy add annotations method ref use refuse overwrite existing annotation location modified method signature original signature modification conflict merge str ategy strategy illegal argument exception illegalargumentexception method signature malformed parameter type reference type string insert parameter annotation insertparameterannotation string method signature methodsignature param idx paramidx annotation merge strategy mergestrategy merge strategy mergestrategy signature wrapper signaturewrapper wrapper signature wrapper signaturewrapper method signature methodsignature to char array tochararray wrapper start param idx paramidx wrapper start wrapper compute end computeend start wrapper start method signature methodsignature char at charat start insert at insertat method signature methodsignature start annotation merge strategy mergestrategy nls illegal argument exception illegalargumentexception param ter paramter type reference type answer external annotation file type project note manipulation external annotations supported annotation files workspace directory layout zip files param project current project references type jar file param type type external annotations sought param monitor progress monitor passed file operations file assumed checked eea format file exist type contained jar file external annotation path defined context project core exception coreexception sign als signals problem accessing relevant elements project type jar file sought annotation file i file ifile get annotation file getannotationfile i java project ijavaproject project i type binding itypebinding type i progress monitor iprogressmonitor monitor core exception coreexception i type itype target type targettype project find type findtype type get erasure geterasure get qualified name getqualifiedname target type targettype exists string binary type name binarytypename target type targettype get fully qualified name getfullyqualifiedname replace i package fragment root ipackagefragmentroot package root packageroot i package fragment root ipackagefragmentroot target type targettype get ancestor getancestor i java element ijavaelement fragment root i classpath entry iclasspathentry entry package root packageroot get resolved classpath entry getresolvedclasspathentry i path ipath annotation path annotationpath classpath entry classpathentry get external annotation path getexternalannotationpath entry project get project getproject annotation path annotationpath i workspace root iworkspaceroot workspace root workspaceroot project get project getproject get workspace getworkspace get root getroot annotation path annotationpath segment count segmentcount i file ifile annotation zip annotationzip workspace root workspaceroot get file getfile annotation path annotationpath annotation zip annotationzip exists annotation path annotationpath annotation path annotationpath append binary type name binarytypename add file extension addfileextension external annotation provider externalannotationprovider annotation file extension workspace root workspaceroot get file getfile annotation path annotationpath update external annotation file details annotations specific method field member external annotations annotations merged priorities control led controlled parameter merge strategy mergestrategy method suitable declaration annotations type annotations param type name typename binary slash separated type annotated param file file assumed eea format created doesn exist param selector selector method field param original signature originalsignature unannotated signature member ide ntification identification param annotated signature annotatedsignature signatures annotations super imposed superimposed member param merge strategy mergestrategy controls signatures merged param monitor progress monitor passed file operations reporting desired core exception coreexception access file fails io exception ioexception reading file content fails annotate member annotatemember string type name typename i file ifile file string selector string original signature originalsignature string annotated signature annotatedsignature merge strategy mergestrategy merge strategy mergestrategy i progress monitor iprogressmonitor monitor core exception coreexception io exception ioexception annotate member annotatemember type name typename file selector original signature originalsignature annotated signature annotatedsignature position full signature merge strategy mergestrategy monitor update external annotation file details annotations type method method external annotations annotations merged priorities control led controlled parameter merge strategy mergestrategy method suitable declaration annotations type annotations param type name typename binary slash separated type annotated param file file assumed eea format created doesn exist param selector selector method param original signature originalsignature unannotated signature member ide ntification identification param annotated return type annotatedreturntype signature type annotations super imposed superimposed method param merge strategy mergestrategy controls signatures merged param monitor progress monitor passed file operations reporting desired core exception coreexception access file fails io exception ioexception reading file content fails illegal argument exception illegalargumentexception annotated return type annotatedreturntype str ucturally structurally match original signature originalsignature annotate method return type annotatemethodreturntype string type name typename i file ifile file string selector string original signature originalsignature string annotated return type annotatedreturntype merge strategy mergestrategy merge strategy mergestrategy i progress monitor iprogressmonitor monitor core exception coreexception io exception ioexception illegal argument exception illegalargumentexception annotate member annotatemember type name typename file selector original signature originalsignature annotated return type annotatedreturntype position type merge strategy mergestrategy monitor update external annotation file details annotations parameter type method method external annotations annotations merged priorities control led controlled parameter merge strategy mergestrategy method suitable declaration annotations type annotations param type name typename binary slash separated type annotated param file file assumed eea format created doesn exist param selector selector method param original signature originalsignature unannotated signature member ide ntification identification param annotated parameter type annotatedparametertype signature parameter type annotations super imposed superimposed method param param idx paramidx based parameter annotation attached param merge strategy mergestrategy controls signatures merged param monitor progress monitor passed file operations reporting desired core exception coreexception access file fails io exception ioexception reading file content fails illegal argument exception illegalargumentexception annotated parameter type annotatedparametertype str ucturally structurally match original signature originalsignature annotate method parameter type annotatemethodparametertype string type name typename i file ifile file string selector string original signature originalsignature string annotated parameter type annotatedparametertype param idx paramidx merge strategy mergestrategy merge strategy mergestrategy i progress monitor iprogressmonitor monitor core exception coreexception io exception ioexception illegal argument exception illegalargumentexception annotate member annotatemember type name typename file selector original signature originalsignature annotated parameter type annotatedparametertype param idx paramidx merge strategy mergestrategy monitor annotate member annotatemember string type name typename i file ifile file string selector string original signature originalsignature string annotated signature annotatedsignature update position updateposition merge strategy mergestrategy merge strategy mergestrategy i progress monitor iprogressmonitor monitor core exception coreexception io exception ioexception illegal argument exception illegalargumentexception file exists assemble full annotated signature annotatedsignature don bother merging previous signature exists annotated signature annotatedsignature update signature updatesignature original signature originalsignature annotated signature annotatedsignature update position updateposition merge strategy mergestrategy replace signature string buffer stringbuffer new content newcontent string buffer stringbuffer header new content newcontent append external annotation provider externalannotationprovider prefix new content newcontent append type name typename append entry new content newcontent append selector append new content newcontent append append original signature originalsignature append new content newcontent append append annotated signature annotatedsignature append create new file createnewfile file new content newcontent to string tostring monitor buffered reader bufferedreader reader buffered reader bufferedreader input stream reader inputstreamreader file get contents getcontents string buffer stringbuffer new content newcontent string buffer stringbuffer skip new content newcontent append reader read line readline append string reader read line readline is empty isempty new content newcontent append character is java identifier start isjavaidentifierstart char at charat char at charat new content newcontent append append compare selectors relation compare to compareto selector insertion point relation relation new content newcontent append append relation string buffer stringbuffer pending string buffer stringbuffer append pending append reader read line readline selector eof append ignoring pending compare original signatures relation trim compare to compareto original signature originalsignature insertion point relation add entry push pending to string tostring new content newcontent append pending append relation relation update existing entry string annotation line annotationline reader read line readline string next line nextline annotation line annotationline annotation line annotationline is empty isempty nls annotation line annotationline starts with startswith nls push signature next line nextline annotation line annotationline annotated unannotated annotation line annotationline nls annotation line annotationline starts with startswith nls merge strategy mergestrategy replace signature unconditionally annotated signature annotatedsignature overwrite annotations add annotations annotated signature annotatedsignature update signature updatesignature annotation line annotationline trim annotated signature annotatedsignature update position updateposition merge strategy mergestrategy java core javacore get java core getjavacore get log getlog log status i status istatus error java core javacore plugin nls unexpected enum merge strategy mergestrategy write file writefile file new content newcontent annotated signature annotatedsignature next line nextline reader monitor add entry new content newcontent append selector append new content newcontent append append original signature originalsignature append annotated signature annotatedsignature update signature updatesignature original signature originalsignature annotated signature annotatedsignature update position updateposition merge strategy mergestrategy write file writefile file new content newcontent annotated signature annotatedsignature reader monitor reader close string update signature updatesignature string original signature originalsignature string annotated signature annotatedsignature update position updateposition merge strategy mergestrategy merge strategy mergestrategy string buffer stringbuffer buf string buffer stringbuffer string signature to replace signaturetoreplace string postfix update position updateposition position full signature signature to replace signaturetoreplace original signature originalsignature position type original signature originalsignature char at charat original signature originalsignature char at charat signature start close original signature originalsignature index of indexof buf append original signature originalsignature close signature to replace signaturetoreplace original signature originalsignature substring close parameter annotations signature wrapper signaturewrapper wrapper signature wrapper signaturewrapper original signature originalsignature to char array tochararray skip ping skipping type parameters wrapper start char operation charoperation index of indexof wrapper signature update position updateposition wrapper start wrapper skip angle contents skipanglecontents wrapper compute end computeend start wrapper start wrapper skip angle contents skipanglecontents wrapper compute end computeend buf append original signature originalsignature start signature to replace signaturetoreplace original signature originalsignature substring start postfix original signature originalsignature substring original signature originalsignature length update type updatetype buf signature to replace signaturetoreplace to char array tochararray annotated signature annotatedsignature to char array tochararray merge strategy mergestrategy postfix buf append postfix buf to string tostring insert annotation position signature param merge strategy mergestrategy link merge strategy mergestrategy add annotations ref use refuse overwrite existing annotation location string insert at insertat string signature position annotation merge strategy mergestrategy merge strategy mergestrategy string buffer stringbuffer result string buffer stringbuffer result append signature position result append annotation signature char at charat position nullable non null nonnull merge strategy mergestrategy merge strategy mergestrategy add annotations ref use refuse change signature skip annotation position result append signature position signature length result to string tostring update old type oldtype annotations new type newtype guided merge strategy mergestrategy result written buf update type updatetype string buffer stringbuffer buf old type oldtype new type newtype merge strategy mergestrategy merge strategy mergestrategy merge strategy mergestrategy merge strategy mergestrategy replace signature buf append new type newtype annotations signature wrapper signaturewrapper o wrap owrap signature wrapper signaturewrapper old type oldtype annotations signature wrapper signaturewrapper n wrap nwrap signature wrapper signaturewrapper new type newtype match buf o wrap owrap n wrap nwrap match buf o wrap owrap n wrap nwrap merge annotation mergeannotation buf o wrap owrap n wrap nwrap merge strategy mergestrategy buf append o wrap owrap next name nextname skip n wrap nwrap next name nextname match buf o wrap owrap n wrap nwrap o start ostart o wrap owrap start n start nstart n wrap nwrap start o wrap owrap compute end computeend n wrap nwrap compute end computeend update type updatetype buf o wrap owrap get from getfrom o start ostart n wrap nwrap get from getfrom n start nstart merge strategy mergestrategy merge annotation mergeannotation buf o wrap owrap n wrap nwrap merge strategy mergestrategy match buf o wrap owrap n wrap nwrap match buf o wrap owrap n wrap nwrap match buf o wrap owrap n wrap nwrap merge annotation mergeannotation buf o wrap owrap n wrap nwrap merge strategy mergestrategy update type updatetype buf o wrap owrap tail n wrap nwrap tail merge strategy mergestrategy match buf o wrap owrap n wrap nwrap match buf o wrap owrap n wrap nwrap match buf o wrap owrap n wrap nwrap annotation allowed included old type oldtype new type newtype buf append old type oldtype array index out of bounds exception arrayindexoutofboundsexception locations match merge annotation mergeannotation aioobe string builder stringbuilder msg string builder stringbuilder structural mismatch append old type oldtype append append new type newtype illegal argument exception illegalargumentexception msg to string tostring aioobe current signatures match expected print buf answer force raise exception quietly answer updating buf match string buffer stringbuffer buf signature wrapper signaturewrapper sig signature wrapper signaturewrapper sig expected force match sig signature sig start expected match sig signature sig start expected match match string builder stringbuilder msg nls string builder stringbuilder mismatching type str uctures structures append sig signature append nls append nls sig signature illegal argument exception illegalargumentexception msg to string tostring match buf append expected sig start sig start force nls nls illegal argument exception illegalargumentexception expected expected string sig signature current old s olds new s news represents annotation insert buf guided merge strategy mergestrategy annotation str ategy strategy overwrite annotations silently skip annotations old s olds merge annotation mergeannotation string buffer stringbuffer buf signature wrapper signaturewrapper old s olds signature wrapper signaturewrapper new s news merge strategy mergestrategy merge strategy mergestrategy at end atend nullable non null nonnull annotation old ann oldann old s olds at end atend old s olds signature old s olds start new ann newann new s news at end atend new s news signature new s news start merge strategy mergestrategy add annotations old ann oldann nullable non null nonnull old s olds start exists remains buf append old ann oldann new ann newann nullable skip non null nonnull skip new s news start fall overwrite annotations new ann newann nullable non null nonnull new s news start exists suppressed add exists buf append new ann newann old ann oldann nullable skip non null nonnull skip old s olds start annotation don insert new s news start old ann oldann nullable skip non null nonnull skip old s olds start old ann oldann nullable non null nonnull old s olds start buf append old ann oldann replace signature reach point initial check update type updatetype nls illegal argument exception illegalargumentexception unexpected merge str ategy strategy write annotation file annotationfile content head assumed include member original signature annotated signature annotatedsignature next lines nextlines option ally optionally unconsumed content tail reader tailreader write file writefile i file ifile annotation file annotationfile string buffer stringbuffer head string annotated signature annotatedsignature string next lines nextlines buffered reader bufferedreader tail reader tailreader i progress monitor iprogressmonitor monitor core exception coreexception io exception ioexception head append append annotated signature annotatedsignature append next lines nextlines head append next lines nextlines append string tail reader tailreader read line readline head append append nls byte array input stream bytearrayinputstream new content newcontent byte array input stream bytearrayinputstream head to string tostring get bytes getbytes utf annotation file annotationfile set contents setcontents new content newcontent i resource iresource history monitor create new file createnewfile i file ifile file string new content newcontent i progress monitor iprogressmonitor monitor core exception coreexception ensure exists ensureexists file get parent getparent monitor nls file create byte array input stream bytearrayinputstream new content newcontent get bytes getbytes utf monitor unsupported encoding exception unsupportedencodingexception core exception coreexception status i status istatus error java core javacore plugin get message getmessage ensure exists ensureexists i container icontainer container i progress monitor iprogressmonitor monitor core exception coreexception container exists nls container i folder ifolder core exception coreexception status i status istatus error java core javacore plugin folder container i container icontainer parent container get parent getparent parent i folder ifolder ensure exists ensureexists parent monitor i folder ifolder container create monitor retrieve annotated signature member external annotation file param type name typename fully qualified slash separated type file defines external annotations param file file assumed eea format exist param selector member annotation param original signature originalsignature unannotated signature member identified annotated signature file string get annotated signature getannotatedsignature string type name typename i file ifile file string selector string original signature originalsignature file exists buffered reader bufferedreader reader buffered reader bufferedreader input stream reader inputstreamreader file get contents getcontents external annotation provider externalannotationprovider assert class header assertclassheader reader read line readline type name typename string reader read line readline selector selector equals original signature reader read line readline original signature originalsignature equals external annotation provider externalannotationprovider extract signature extractsignature annotated signature external annotation provider externalannotationprovider extract signature extractsignature reader read line readline io exception ioexception core exception coreexception apply type method dry modifying annotation file param original signature originalsignature original type signature annotated param annotated type annotatedtype type signature additional annotations inc l incl link annotation param merge strategy mergestrategy controls signatures merged array length prefix changed type original type changed type postfix changed type empty string string annotate type annotatetype string original signature originalsignature string annotated type annotatedtype merge strategy mergestrategy merge strategy mergestrategy prefix orig replacement postfix string result string string buffer stringbuffer buf nls result buf string buffer stringbuffer result original signature originalsignature update type updatetype buf original signature originalsignature to char array tochararray annotated type annotatedtype to char array tochararray merge strategy mergestrategy result buf to string tostring nls result result apply type signature method dry modifying annotation file param original signature originalsignature original full signature annotated param annotated type annotatedtype type signature additional annotations inc l incl link annotation param merge strategy mergestrategy controls signatures merged array length prefix changed type original type changed type postfix changed type empty string string annotate return type annotatereturntype string original signature originalsignature string annotated type annotatedtype merge strategy mergestrategy merge strategy mergestrategy prefix orig replacement postfix string result string string buffer stringbuffer buf nls original signature originalsignature char at charat original signature originalsignature char at charat signature start close original signature originalsignature index of indexof result original signature originalsignature substring close buf string buffer stringbuffer result original signature originalsignature substring close update type updatetype buf result to char array tochararray annotated type annotatedtype to char array tochararray merge strategy mergestrategy result buf to string tostring nls result result apply parameter signature method dry modifying annotation file param original signature originalsignature original full signature annotated param annotated type annotatedtype type signature additional annotations inc l incl link annotation param param idx paramidx parameter annotated param merge strategy mergestrategy controls signatures merged array length prefix changed type original type changed type postfix changed type string annotate parameter type annotateparametertype string original signature originalsignature string annotated type annotatedtype param idx paramidx merge strategy mergestrategy merge strategy mergestrategy prefix orig replacement postfix string result string string buffer stringbuffer buf annotations signature wrapper signaturewrapper wrapper signature wrapper signaturewrapper original signature originalsignature to char array tochararray skip type parameters wrapper start char operation charoperation index of indexof wrapper signature param idx paramidx wrapper start wrapper skip angle contents skipanglecontents wrapper compute end computeend start wrapper start wrapper skip angle contents skipanglecontents wrapper compute end computeend result original signature originalsignature substring start buf string buffer stringbuffer result original signature originalsignature substring start update type updatetype buf result to char array tochararray annotated type annotatedtype to char array tochararray merge strategy mergestrategy result buf to string tostring result original signature originalsignature substring original signature originalsignature length result