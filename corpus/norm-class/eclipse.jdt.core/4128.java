copyright software ibm corporation rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors stephan herrmann initial api implementation org eclipse jdt internal compiler lookup java util array list arraylist java util hash set hashset java util list java util org eclipse jdt internal compiler ast ast node astnode org eclipse jdt internal compiler ast abstract method declaration abstractmethoddeclaration org eclipse jdt internal compiler ast argument org eclipse jdt internal compiler ast method declaration methoddeclaration org eclipse jdt internal compiler ast null annotation matching nullannotationmatching org eclipse jdt internal compiler ast null annotation matching nullannotationmatching check mode checkmode org eclipse jdt internal compiler impl compiler options compileroptions extra cted extracted slice method verifier methodverifier responsible implicit annotations enabled detects overridden methods annotations inherited nullness filled remaining empty slots implicit annotations filled compatibility checked problems complained suppress warnings suppresswarnings rawtypes unchecked implicit null annotation verifier implicitnullannotationverifier simple record store nullness info argument type iter ating iterating overridden methods inherited non nullness info inheritednonnullnessinfo inherited non nullness inheritednonnullness method binding methodbinding annotation origin annotationorigin complained delegate recursive analysis methods method verifier methodverifier avoid infinite recursion implicit null annotation verifier implicitnullannotationverifier buddy implicit null annotations verifier buddyimplicitnullannotationsverifier inherit null annotations inheritnullannotations lookup environment lookupenvironment environment implicit null annotation verifier implicitnullannotationverifier lookup environment lookupenvironment environment inherit null annotations inheritnullannotations buddy implicit null annotations verifier buddyimplicitnullannotationsverifier inherit null annotations inheritnullannotations inherit null annotations inheritnullannotations environment environment classes implicit null annotation verifier implicitnullannotationverifier lookup environment lookupenvironment environment compiler options compileroptions options environment global options globaloptions buddy implicit null annotations verifier buddyimplicitnullannotationsverifier implicit null annotation verifier implicitnullannotationverifier environment options inherit null annotations inheritnullannotations inherit null annotations inheritnullannotations options inherit null annotations inheritnullannotations environment environment check fill implicit annotations overridden methods precondition caller checked annotation based analysis enabled check implicit null annotations checkimplicitnullannotations method binding methodbinding current method currentmethod abstract method declaration abstractmethoddeclaration src method srcmethod complain scope scope check inherited nullness superclass super interfaces superinterfaces reference binding referencebinding current type currenttype current method currentmethod declaring class declaringclass current type currenttype type ids typeids java lang object javalangobject uses type annotations usestypeannotations scope environment uses null type annotations usesnulltypeannotations need to apply return non null default needtoapplyreturnnonnulldefault current method currentmethod has non null default for hasnonnulldefaultfor binding default location return type defaultlocationreturntype uses type annotations usestypeannotations need to apply parameter non null default needtoapplyparameternonnulldefault current method currentmethod has non null default for hasnonnulldefaultfor binding default location parameter defaultlocationparameter uses type annotations usestypeannotations need to apply non null default needtoapplynonnulldefault need to apply return non null default needtoapplyreturnnonnulldefault need to apply parameter non null default needtoapplyparameternonnulldefault compatibility inheritance constructors methods is instance method isinstancemethod current method currentmethod is constructor isconstructor current method currentmethod is static isstatic complain is instance method isinstancemethod need to apply non null default needtoapplynonnulldefault complain inherit null annotations inheritnullannotations is instance method isinstancemethod cut work is instance method isinstancemethod list super method list supermethodlist array list arraylist types connected current type currenttype source type binding sourcetypebinding current type currenttype is hierarchy connected ishierarchyconnected current type currenttype is anonymous type isanonymoustype source type binding sourcetypebinding current type currenttype scope connect type hierarchy connecttypehierarchy param len paramlen current method currentmethod parameters length find all overridden methods findalloverriddenmethods current method currentmethod original current method currentmethod selector param len paramlen current type currenttype hash set hashset super method list supermethodlist prepare int erim interim storage nullness info don poll ute pollute current method currentmethod conflict free type inherited non nullness info inheritednonnullnessinfo inherited non nullness infos inheritednonnullnessinfos inherited non nullness info inheritednonnullnessinfo param len paramlen param len paramlen inherited non nullness infos inheritednonnullnessinfos inherited non nullness info inheritednonnullnessinfo length super method list supermethodlist size length method binding methodbinding current super currentsuper method binding methodbinding super method list supermethodlist current super currentsuper tag bits tagbits tag bits tagbits is nullness known isnullnessknown recurse prepare current super currentsuper todo stephan complain current super currentsuper source method check implicit null annotations checkimplicitnullannotations current super currentsuper scope check null spec inheritance checknullspecinheritance current method currentmethod src method srcmethod need to apply return non null default needtoapplyreturnnonnulldefault need to apply parameter non null default needtoapplyparameternonnulldefault complain current super currentsuper scope inherited non nullness infos inheritednonnullnessinfos need to apply non null default needtoapplynonnulldefault transfer collected current method currentmethod inherited non nullness info inheritednonnullnessinfo info inherited non nullness infos inheritednonnullnessinfos info complained tag bits tagbits info inherited non nullness inheritednonnullness tag bits tagbits tag bits tagbits annotation non null annotationnonnull info inherited non nullness inheritednonnullness tag bits tagbits tag bits tagbits annotation nullable annotationnullable tag bits tagbits uses type annotations usestypeannotations current method currentmethod tag bits tagbits tag bits tagbits current method currentmethod return type returntype is base type isbasetype lookup environment lookupenvironment env scope environment current method currentmethod return type returntype env create annotated type createannotatedtype current method currentmethod return type returntype env null annotations from tag bits nullannotationsfromtagbits tag bits tagbits param len paramlen info inherited non nullness infos inheritednonnullnessinfos info complained info inherited non nullness inheritednonnullness argument current arg currentarg src method srcmethod src method srcmethod arguments uses type annotations usestypeannotations record arg non nullness recordargnonnullness current method currentmethod param len paramlen current arg currentarg info inherited non nullness inheritednonnullness record arg non nullness recordargnonnullness current method currentmethod current arg currentarg info inherited non nullness inheritednonnullness scope environment need to apply non null default needtoapplynonnulldefault uses type annotations usestypeannotations current method currentmethod fill in default non nullness fillindefaultnonnullness src method srcmethod current method currentmethod fill in default non nullness fillindefaultnonnullness src method srcmethod scope environment current method currentmethod tag bits tagbits tag bits tagbits is nullness known isnullnessknown recursively traverse tree ancestors find matching method prune tree collect matching methods result find all overridden methods findalloverriddenmethods method binding methodbinding original selector suggested parameter length suggestedparameterlength reference binding referencebinding current type currenttype ifcs seen ifcsseen list result current type currenttype type ids typeids java lang object javalangobject superclass reference binding referencebinding superclass current type currenttype superclass superclass pseudo root inheritance eval contexts collect overridden methods collectoverriddenmethods original selector suggested parameter length suggestedparameterlength superclass ifcs seen ifcsseen result super interfaces superinterfaces reference binding referencebinding super interfaces superinterfaces current type currenttype super interfaces superinterfaces ifc len ifclen super interfaces superinterfaces length ifc len ifclen reference binding referencebinding current ifc currentifc super interfaces superinterfaces process ifcs seen ifcsseen add current ifc currentifc original collect overridden methods collectoverriddenmethods original selector suggested parameter length suggestedparameterlength current ifc currentifc ifcs seen ifcsseen result collect matching methods supertype collect overridden methods collectoverriddenmethods method binding methodbinding original selector suggested parameter length suggestedparameterlength reference binding referencebinding super type supertype ifcs seen ifcsseen list result method binding methodbinding ifc methods ifcmethods super type supertype get methods getmethods selector suggested parameter length suggestedparameterlength length ifc methods ifcmethods length length method binding methodbinding current method currentmethod ifc methods ifcmethods current method currentmethod is static isstatic method verifier methodverifier does method override doesmethodoverride original current method currentmethod environment result add current method currentmethod overriding methods super type supertype don traverse transitive super types supertypes find all overridden methods findalloverriddenmethods original selector suggested parameter length suggestedparameterlength super type supertype ifcs seen ifcsseen result main algorithm param current method currentmethod focus method param src method srcmethod ast current method currentmethod param has return non null default hasreturnnonnulldefault non null nonnull applicable type current method currentmethod param has parameter non null default hasparameternonnulldefault non null nonnull applicable parameters current method currentmethod param should complain shouldcomplain report errors comment flows method param inherited method inheritedmethod overridden method type param all inherited methods allinheritedmethods non null nonnull unannotated conflict exists type param scope context error reporting param inherited non nullness infos inheritednonnullnessinfos array elements int erim interim recording nullness inherited method inheritedmethod prematurely updating current method currentmethod position type positions argument check null spec inheritance checknullspecinheritance method binding methodbinding current method currentmethod abstract method declaration abstractmethoddeclaration src method srcmethod has return non null default hasreturnnonnulldefault has parameter non null default hasparameternonnulldefault should complain shouldcomplain method binding methodbinding inherited method inheritedmethod method binding methodbinding all inherited methods allinheritedmethods scope scope inherited non nullness info inheritednonnullnessinfo inherited non nullness infos inheritednonnullnessinfos inherited method inheritedmethod tag bits tagbits tag bits tagbits is nullness known isnullnessknown todo stephan report problems discriminate buddy implicit null annotations verifier buddyimplicitnullannotationsverifier check implicit null annotations checkimplicitnullannotations inherited method inheritedmethod scope use type annotations usetypeannotations environment uses null type annotations usesnulltypeannotations inherited nullness bits inheritednullnessbits get return type nullness tag bits getreturntypenullnesstagbits inherited method inheritedmethod use type annotations usetypeannotations current nullness bits currentnullnessbits get return type nullness tag bits getreturntypenullnesstagbits current method currentmethod use type annotations usetypeannotations should inherit shouldinherit inherit null annotations inheritnullannotations type return type returntype current method currentmethod return type returntype current method currentmethod return type returntype is base type isbasetype nullness primitive types return type returntype current nullness bits currentnullnessbits unspecified fill should inherit shouldinherit inherited nullness bits inheritednullnessbits has return non null default hasreturnnonnulldefault inheritance check conflict should complain shouldcomplain inherited nullness bits inheritednullnessbits tag bits tagbits annotation nullable annotationnullable scope problem reporter problemreporter conflicting null annotations conflictingnullannotations current method currentmethod method declaration methoddeclaration src method srcmethod return type returntype inherited method inheritedmethod inherited bits avoid inc ompatibility incompatibility inherited non nullness infos inheritednonnullnessinfos src method srcmethod record deferred inherited nullness recorddeferredinheritednullness scope method declaration methoddeclaration src method srcmethod return type returntype inherited method inheritedmethod value of valueof inherited nullness bits inheritednullnessbits tag bits tagbits annotation non null annotationnonnull inherited non nullness infos inheritednonnullnessinfos defer record info apply return null bits applyreturnnullbits current method currentmethod inherited nullness bits inheritednullnessbits compatible construction skip complain phase return type returntype conflict inheritance checked has return non null default hasreturnnonnulldefault use type annotations usetypeannotations current method currentmethod return type returntype accepts non null default acceptsnonnulldefault current nullness bits currentnullnessbits tag bits tagbits annotation non null annotationnonnull apply return null bits applyreturnnullbits current method currentmethod current nullness bits currentnullnessbits should complain shouldcomplain inherited nullness bits inheritednullnessbits tag bits tagbits annotation non null annotationnonnull current nullness bits currentnullnessbits tag bits tagbits annotation non null annotationnonnull src method srcmethod scope problem reporter problemreporter illegal return redefinition illegalreturnredefinition src method srcmethod inherited method inheritedmethod environment get non null annotation name getnonnullannotationname return type returntype scope problem reporter problemreporter cannot implement incompatible nullness cannotimplementincompatiblenullness current method currentmethod inherited method inheritedmethod use type annotations usetypeannotations use type annotations usetypeannotations tvb identity checks null annotation matching nullannotationmatching analyze type binding typebinding substitute return type substitutereturntype type variable binding typevariablebinding type variables typevariables inherited method inheritedmethod original type variables typevariables type variables typevariables current method currentmethod return type returntype type ids typeids parameterized generic method binding parameterizedgenericmethodbinding substitute environment create parameterized generic method createparameterizedgenericmethod current method currentmethod type variables typevariables substitute return type substitutereturntype substitute return type returntype null annotation matching nullannotationmatching analyse inherited method inheritedmethod return type returntype current method currentmethod return type returntype substitute return type substitutereturntype check mode checkmode override is any mismatch isanymismatch src method srcmethod scope problem reporter problemreporter illegal return redefinition illegalreturnredefinition src method srcmethod inherited method inheritedmethod environment get non null annotation name getnonnullannotationname scope problem reporter problemreporter cannot implement incompatible nullness cannotimplementincompatiblenullness current method currentmethod inherited method inheritedmethod use type annotations usetypeannotations parameters tvb identity checks null annotation matching nullannotationmatching analyze type binding typebinding substitute parameters substituteparameters should complain shouldcomplain type variable binding typevariablebinding type variables typevariables current method currentmethod original type variables typevariables type variables typevariables binding type variables parameterized generic method binding parameterizedgenericmethodbinding substitute environment create parameterized generic method createparameterizedgenericmethod inherited method inheritedmethod type variables typevariables substitute parameters substituteparameters substitute parameters argument current arguments currentarguments src method srcmethod src method srcmethod arguments length current arguments currentarguments length current arguments currentarguments length type annotations parameters use type annotations usetypeannotations length current method currentmethod parameters length inherited method inheritedmethod parameter non nullness parameternonnullness length inherited method inheritedmethod parameter non nullness parameternonnullness length current method currentmethod parameter non nullness parameternonnullness length current method currentmethod parameter non nullness parameternonnullness length parameter loop parameterloop length current method currentmethod parameters is base type isbasetype argument current argument currentargument current arguments currentarguments current arguments currentarguments inherited non null ness inheritednonnullness get parameter non nullness getparameternonnullness inherited method inheritedmethod use type annotations usetypeannotations current non null ness currentnonnullness get parameter non nullness getparameternonnullness current method currentmethod use type annotations usetypeannotations current non null ness currentnonnullness unspecified fill inherited non null ness inheritednonnullness should inherit shouldinherit has parameter non null default hasparameternonnulldefault inheritance check conflict should complain shouldcomplain inherited non null ness inheritednonnullness current argument currentargument scope problem reporter problemreporter conflicting null annotations conflictingnullannotations current method currentmethod current argument currentargument inherited method inheritedmethod inherited info avoid inc ompatibility incompatibility inherited non nullness infos inheritednonnullnessinfos src method srcmethod record deferred inherited nullness recorddeferredinheritednullness scope src method srcmethod arguments type inherited method inheritedmethod inherited non null ness inheritednonnullness inherited non nullness infos inheritednonnullnessinfos defer record info use type annotations usetypeannotations record arg non nullness recordargnonnullness current method currentmethod length current argument currentargument inherited non null ness inheritednonnullness record arg non nullness recordargnonnullness current method currentmethod current argument currentargument inherited non null ness inheritednonnullness environment compatible construction skip complain phase conflict inheritance checked has parameter non null default hasparameternonnulldefault current non null ness currentnonnullness use type annotations usetypeannotations record arg non nullness recordargnonnullness current method currentmethod length current argument currentargument current method currentmethod parameters accepts non null default acceptsnonnulldefault record arg non nullness recordargnonnullness current method currentmethod current argument currentargument environment cancel parameter doesn accept current non null ness currentnonnullness should complain shouldcomplain annotation name annotationname inherited non null ness inheritednonnullness annotation name annotationname environment get non null annotation name getnonnullannotationname annotation name annotationname environment get nullable annotation name getnullableannotationname parameter restricted non null nonnull inherited non null ness inheritednonnullness current parameter restricted non null nonnull current non null ness currentnonnullness incompatible current argument currentargument scope problem reporter problemreporter illegal redefinition to non null parameter illegalredefinitiontononnullparameter current argument currentargument inherited method inheritedmethod declaring class declaringclass inherited non null ness inheritednonnullness environment get nullable annotation name getnullableannotationname scope problem reporter problemreporter cannot implement incompatible nullness cannotimplementincompatiblenullness current method currentmethod inherited method inheritedmethod current non null ness currentnonnullness unannotated str ictly strictly conflicts inherited nullable inherited non null ness inheritednonnullness current argument currentargument scope problem reporter problemreporter parameter lacking nullable annotation parameterlackingnullableannotation current argument currentargument inherited method inheritedmethod declaring class declaringclass annotation name annotationname scope problem reporter problemreporter cannot implement incompatible nullness cannotimplementincompatiblenullness current method currentmethod inherited method inheritedmethod inherited non null ness inheritednonnullness str ictly strictly conflict config urable configurable warning all inherited methods allinheritedmethods avoid optional warning conflict existed supertype merging methods method binding methodbinding all inherited methods allinheritedmethods type binding typebinding equals equals equalsequals inherited method inheritedmethod declaring class declaringclass declaring class declaringclass get parameter non nullness getparameternonnullness use type annotations usetypeannotations parameter loop parameterloop scope problem reporter problemreporter parameter lacking nonnull annotation parameterlackingnonnullannotation current argument currentargument inherited method inheritedmethod declaring class declaringclass annotation name annotationname use type annotations usetypeannotations type binding typebinding inherited parameter inheritedparameter inherited method inheritedmethod parameters type binding typebinding substitute parameter substituteparameter substitute parameters substituteparameters substitute parameters substituteparameters null annotation matching nullannotationmatching analyse current method currentmethod parameters inherited parameter inheritedparameter substitute parameter substituteparameter check mode checkmode override is any mismatch isanymismatch current argument currentargument scope problem reporter problemreporter illegal parameter redefinition illegalparameterredefinition current argument currentargument inherited method inheritedmethod declaring class declaringclass inherited parameter inheritedparameter scope problem reporter problemreporter cannot implement incompatible nullness cannotimplementincompatiblenullness current method currentmethod inherited method inheritedmethod should complain shouldcomplain use type annotations usetypeannotations src method srcmethod type variable binding typevariablebinding current type variables currenttypevariables current method currentmethod type variables typevariables type variable binding typevariablebinding inherited type variables inheritedtypevariables inherited method inheritedmethod type variables typevariables current type variables currenttypevariables binding type variables current type variables currenttypevariables length inherited type variables inheritedtypevariables length current type variables currenttypevariables length type variable binding typevariablebinding inherited variable inheritedvariable inherited type variables inheritedtypevariables null annotation matching nullannotationmatching analyse inherited variable inheritedvariable current type variables currenttypevariables check mode checkmode bound check is any mismatch isanymismatch scope problem reporter problemreporter cannot redefine type argument nullity cannotredefinetypeargumentnullity inherited variable inheritedvariable inherited method inheritedmethod src method srcmethod type parameters typeparameters apply return null bits applyreturnnullbits method binding methodbinding method nullness bits nullnessbits environment uses null type annotations usesnulltypeannotations method return type returntype is base type isbasetype method return type returntype environment create annotated type createannotatedtype method return type returntype environment null annotations from tag bits nullannotationsfromtagbits nullness bits nullnessbits method tag bits tagbits nullness bits nullnessbits get parameter non nullness getparameternonnullness method binding methodbinding method use type annotations usetypeannotations use type annotations usetypeannotations type binding typebinding parameter method parameters parameter null bits nullbits null annotation matching nullannotationmatching valid null tag bits validnulltagbits parameter tag bits tagbits null bits nullbits value of valueof null bits nullbits tag bits tagbits annotation non null annotationnonnull method parameter non nullness parameternonnullness method parameter non nullness parameternonnullness get return type nullness tag bits getreturntypenullnesstagbits method binding methodbinding method use type annotations usetypeannotations use type annotations usetypeannotations method return type returntype null annotation matching nullannotationmatching valid null tag bits validnulltagbits method return type returntype tag bits tagbits method tag bits tagbits tag bits tagbits annotationnullmask check conflicting annotations record info inherited non nullness inheritednonnullness inherited method inheritedmethod record deferred inherited nullness recorddeferredinheritednullness scope scope ast node astnode location method binding methodbinding inherited method inheritedmethod inherited non nullness inheritednonnullness inherited non nullness info inheritednonnullnessinfo nullness info nullnessinfo nullness info nullnessinfo inherited non nullness inheritednonnullness nullness info nullnessinfo inherited non nullness inheritednonnullness inherited non nullness inheritednonnullness scope problem reporter problemreporter conflicting inherited null annotations conflictinginheritednullannotations location nullness info nullnessinfo inherited non nullness inheritednonnullness boolean value booleanvalue nullness info nullnessinfo annotation origin annotationorigin inherited non nullness inheritednonnullness boolean value booleanvalue inherited method inheritedmethod nullness info nullnessinfo complained leave previous info int act intact subsequent errors reported method nullness info nullnessinfo inherited non nullness inheritednonnullness inherited non nullness inheritednonnullness nullness info nullnessinfo annotation origin annotationorigin inherited method inheritedmethod record declared nullness parameter method argument record arg non nullness recordargnonnullness method binding methodbinding method param count paramcount param idx paramidx argument current argument currentargument non null ness nonnullness method parameter non nullness parameternonnullness method parameter non nullness parameternonnullness param count paramcount method parameter non nullness parameternonnullness param idx paramidx non null ness nonnullness current argument currentargument current argument currentargument binding tag bits tagbits non null ness nonnullness boolean value booleanvalue tag bits tagbits annotation non null annotationnonnull tag bits tagbits annotation nullable annotationnullable record arg non nullness recordargnonnullness method binding methodbinding method param idx paramidx argument current argument currentargument non null ness nonnullness lookup environment lookupenvironment env annotation binding annotationbinding annotation binding annotationbinding non null ness nonnullness boolean value booleanvalue env get non null annotation getnonnullannotation env get nullable annotation getnullableannotation method parameters param idx paramidx env create annotated type createannotatedtype method parameters param idx paramidx annotation binding annotationbinding annotation binding annotationbinding current argument currentargument current argument currentargument binding type method parameters param idx paramidx minimal utility methods method verifier methodverifier are parameters equal areparametersequal method binding methodbinding method binding methodbinding type binding typebinding one args oneargs parameters type binding typebinding two args twoargs parameters one args oneargs two args twoargs length one args oneargs length length two args twoargs length methods raw parameters considered equal inherited methods parameterized parameters compatibility complex check foundraw length are types equal aretypesequal one args oneargs two args twoargs one args oneargs leaf component type leafcomponenttype is raw type israwtype one args oneargs dimensions two args twoargs dimensions one args oneargs leaf component type leafcomponenttype is equivalent to isequivalentto two args twoargs leaf component type leafcomponenttype raw mode apply method defines type variables type variables typevariables binding type variables mismatch check one args oneargs leaf component type leafcomponenttype is parameterized type with actual arguments isparameterizedtypewithactualarguments raw mode foundraw raw mode remaining parameters length are types equal aretypesequal one args oneargs two args twoargs one args oneargs leaf component type leafcomponenttype is raw type israwtype one args oneargs dimensions two args twoargs dimensions one args oneargs leaf component type leafcomponenttype is equivalent to isequivalentto two args twoargs leaf component type leafcomponenttype one args oneargs leaf component type leafcomponenttype is parameterized type with actual arguments isparameterizedtypewithactualarguments remaining parameter parameterized type converted raw types converted are types equal aretypesequal type binding typebinding type binding typebinding type binding typebinding equals equals equalsequals https bugs eclipse org bugs bug cgi kind binding type kind binding parameterized type binding raw type type binding typebinding equals equals equalsequals erasure binding raw type binding parameterized type kind binding type type binding typebinding equals equals equalsequals erasure object type is parameterized type isparameterizedtype is parameterized type isparameterizedtype is equivalent to isequivalentto is equivalent to isequivalentto type bindings identical