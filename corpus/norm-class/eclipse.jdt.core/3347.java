copyright bea systems rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors wharley bea initial api implementation sxenos gmail bug deadlock annotation processor factory loader annotationprocessorfactoryloader org eclipse jdt apt core internal java closeable java file java file not found exception filenotfoundexception java i o exception ioexception java net malformedurlexception java net url java net url class loader urlclassloader java util array list arraylist java util collections java util hash map hashmap java util hash set hashset java util iterator java util linked hash map linkedhashmap java util list java util map java util map entry java util org eclipse core resources i marker imarker org eclipse core resources i project iproject org eclipse core resources i resource iresource org eclipse core resources i resource change event iresourcechangeevent org eclipse core resources i resource change listener iresourcechangelistener org eclipse core resources i resource delta iresourcedelta org eclipse core resources i resource delta visitor iresourcedeltavisitor org eclipse core resources i workspace root iworkspaceroot org eclipse core resources resources plugin resourcesplugin org eclipse core runtime core exception coreexception org eclipse core runtime i path ipath org eclipse core runtime path org eclipse jdt apt core internal util factory container factorycontainer org eclipse jdt apt core internal util factory container factorycontainer factory type factorytype org eclipse jdt apt core internal util factory path factorypath org eclipse jdt apt core internal util factory path factorypath attributes org eclipse jdt apt core internal util factory path util factorypathutil org eclipse jdt core i java project ijavaproject org eclipse jdt core java core javacore sun mirror apt annotation processor factory annotationprocessorfactory stores annotation processor factories handles mapping projects singleton object created call get loader getloader factories contained plugins loaded apt initialization time factories contained jar files loaded project time get factories for project getfactoriesforproject called cached factories loaded custom class load ers classloaders depending factory container batch processing mode normal iterative mode batch class loader classloader project parented iterative class loader classloader project strong processor factories strong compil able compilable java runtime includes support discovering loading java java annotation processors java annotation processors include factory object annotation processor factory annotationprocessorfactory java simply cache factory client code factory produce actual annotation processor annotationprocessor java processors separate factory cache object processor implementation produce instances wrapped i service factory iservicefactory flexibility loading sources actual processor exist java runtime access ref lection reflection strong caches strong factory classes iterative mode class load ers classloaders cached project time classes needed build reconcile cache cleared project factory path resource listed factory path changed project deleted project batch mode processors cache cleared full build batch mode processors reconcile project factory path includes containers located disk problem markers project validation process occurs cache project loaded cache invalid ated invalidated validate workspace level factory path construct project specific factory path projects factory path order efficiently perform validation resources change track projects factory paths mention containers stored map canonical ized canonicalized resource path project entries created updated factory path validation removed project deletion resource presented delta trees change change arrives build list projects perform validation list complete avoid redundant valid ations validations project change note markers factory classes life times lifetimes discarded time markers recreated result validation factory classes reloaded time build reconcile occurs strong synchronization strong loader accessed multiple threads build thread reconcile thread change not ification notification thread main tain maintain consistency cache objects annotation processor factory loader annotationprocessorfactoryloader loader instance holds workspace project data annotation processor factory loader annotationprocessorfactoryloader loader nls string jar extension jar object cache mutex cachemutex object caches factory classes project comments lifecycle items cache guarded cache mutex cachemutex map i java project ijavaproject map annotation processor factory annotationprocessorfactory factory path factorypath attributes project java factories hash map hashmap guarded cache mutex cachemutex map i java project ijavaproject map i service factory iservicefactory factory path factorypath attributes project java factories hash map hashmap caches iterative class load ers classloaders iterative processors reloaded batch build batch processors comments lifecycle items cache guarded cache mutex cachemutex map i java project ijavaproject class loader classloader iterative loaders iterativeloaders hash map hashmap guarded cache mutex cachemutex map i java project ijavaproject class loader classloader batch loaders batchloaders hash map hashmap caches resources affect projects factory paths comments lifecycle items cache guarded cache mutex cachemutex map string i java project ijavaproject container project hash map hashmap listen affect factory caches build markers resource listener resourcelistener i resource change listener iresourcechangelistener override resource changed resourcechanged i resource change event iresourcechangeevent event map i java project ijavaproject load failure handler loadfailurehandler failure handlers failurehandlers hash map hashmap event get type gettype project deletion i resource change event iresourcechangeevent pre delete i resource iresource project event get resource getresource project project i project iproject i java project ijavaproject jproj java core javacore create i project iproject project jproj uncache project uncacheproject jproj jar files factory path factorypath files i resource change event iresourcechangeevent pre build i resource delta iresourcedelta root delta rootdelta event get delta getdelta factory path delta visitor factorypathdeltavisitor visitor factory path delta visitor factorypathdeltavisitor root delta rootdelta accept visitor core exception coreexception apt plugin aptplugin log unable determine resource change annotation processor factory path i java project ijavaproject visitor get affected projects getaffectedprojects process changes processchanges failure handlers failurehandlers load failure handler loadfailurehandler handler failure handlers failurehandlers values handler report failure markers reportfailuremarkers walk delta tree factory path containers references validate projects factory paths factory path delta visitor factorypathdeltavisitor i resource delta visitor iresourcedeltavisitor list projects change lazy construction assume won affect projects i java project ijavaproject add affected addaffected i java project ijavaproject projects hash set hashset add all addall projects list i java project ijavaproject delta visited valid visiting projects empty i java project ijavaproject i java project ijavaproject get affected projects getaffectedprojects visit children override visit i resource delta iresourcedelta delta delta get kind getkind i resource delta iresourcedelta i resource delta iresourcedelta removed i resource delta iresourcedelta changed resource factory path file project belongs i resource iresource res delta get resource getresource res i project iproject proj res get project getproject factory path util factorypathutil is factory path file isfactorypathfile res add affected addaffected collections singleton java core javacore create proj path projects owning factory paths factorypaths res get type gettype i resource iresource file i path ipath relative path relativepath res get full path getfullpath string ext relative path relativepath get file extension getfileextension jar extension equals ext i path ipath absolute path absolutepath res get location getlocation absolute path absolutepath cache mutex cachemutex factory path res embling resembling jar entry string i java project ijavaproject entry container project entry set entryset i path ipath jar path jarpath path entry get key getkey relative path relativepath last segment lastsegment equals jar path jarpath last segment lastsegment add affected addaffected entry get value getvalue lookup key canonical path resource string key key absolute path absolutepath to file tofile get canonical path getcanonicalpath cache mutex cachemutex i java project ijavaproject projects container project key projects add affected addaffected projects exception apt plugin aptplugin log could n couldn determine factory paths change resource res get name getname singleton annotation processor factory loader annotationprocessorfactoryloader get loader getloader loader loader annotation processor factory loader annotationprocessorfactoryloader loader register listener registerlistener loader register listener registerlistener resources plugin resourcesplugin get workspace getworkspace add resource change listener addresourcechangelistener resource listener resourcelistener i resource change event iresourcechangeevent pre delete i resource change event iresourcechangeevent pre build called workspace preferences change resource including project specific factory paths picked resource changed listener resourcechangedlistener mechanism reset all resetall remove apt build problem markers removeaptbuildproblemmarkers class loader classloader to close toclose hash set hashset cache mutex cachemutex to close toclose add all addall iterative loaders iterativeloaders values to close toclose add all addall batch loaders batchloaders values project java factories clear project java factories clear iterative loaders iterativeloaders clear container project clear batch loaders batchloaders clear close iterative batch class load ers classloaders class loader classloader to close toclose try to close class loader trytocloseclassloader validate projects i workspace root iworkspaceroot root resources plugin resourcesplugin get workspace getworkspace get root getroot i project iproject proj root get projects getprojects verify factory path verifyfactorypath java core javacore create proj called clean build res ets resets class load ers classloaders batch processors reset batch processors resetbatchprocessors i java project ijavaproject java proj javaproj iterable attributes attrs map annotation processor factory annotationprocessorfactory attributes factories map i service factory iservicefactory attributes java factories cache mutex cachemutex factories project java factories java proj javaproj java factories project java factories java proj javaproj factories attrs factories values java factories attrs java factories values project factories cleared batch procs found batchprocsfound attributes attr attrs attr run in batch mode runinbatchmode batch procs found batchprocsfound class loader classloader cache mutex cachemutex batch procs found batchprocsfound project java factories remove java proj javaproj project java factories remove java proj javaproj batch loaders batchloaders remove java proj javaproj try to close class loader trytocloseclassloader param jproj order preserving map annotation processor factories attributes order annotation processor factories resp ects respects order factory containers code jproj code map unmodifiable empty map annotation processor factory annotationprocessorfactory factory path factorypath attributes get java getjava factories and attributes for project factoriesandattributesforproject i java project ijavaproject jproj create problem markers synchronization https bugs eclipse org bugs bug cgi load failure handler loadfailurehandler failure handler failurehandler load failure handler loadfailurehandler jproj map annotation processor factory annotationprocessorfactory factory path factorypath attributes factories cache mutex cachemutex factories project java factories jproj factories load project factory path factorypath factory path util factorypathutil get factory path getfactorypath jproj map factory container factorycontainer factory path factorypath attributes containers get enabled containers getenabledcontainers load factories loadfactories containers jproj failure handler failurehandler failure handler failurehandler report failure markers reportfailuremarkers cache mutex cachemutex factories project java factories jproj factories collections unmodifiable map unmodifiablemap factories collections empty map emptymap param jproj order preserving map annotation processor factories attributes order annotation processor factories resp ects respects order factory containers code jproj code map unmodifiable empty map i service factory iservicefactory factory path factorypath attributes get java getjava factories and attributes for project factoriesandattributesforproject i java project ijavaproject jproj create problem markers synchronization https bugs eclipse org bugs bug cgi load failure handler loadfailurehandler failure handler failurehandler load failure handler loadfailurehandler jproj map i service factory iservicefactory factory path factorypath attributes factories cache mutex cachemutex factories project java factories jproj factories load project factory path factorypath factory path util factorypathutil get factory path getfactorypath jproj map factory container factorycontainer factory path factorypath attributes containers get enabled containers getenabledcontainers load factories loadfactories containers jproj failure handler failurehandler cache mutex cachemutex factories project java factories jproj failure handler failurehandler report failure markers reportfailuremarkers factories collections unmodifiable map unmodifiablemap factories collections empty map emptymap convenience method key map returned get java getjava factories and attributes for project factoriesandattributesforproject i java project ijavaproject list list annotation processor factory annotationprocessorfactory get java getjava factories for project factoriesforproject i java project ijavaproject jproj map annotation processor factory annotationprocessorfactory factory path factorypath attributes factories and attrs factoriesandattrs get java getjava factories and attributes for project factoriesandattributesforproject jproj list annotation processor factory annotationprocessorfactory factories array list arraylist factories and attrs factoriesandattrs key set keyset collections unmodifiable list unmodifiablelist factories add resource project pair key jproj container project map param key canonical ized canonicalized path name pathname resource param jproj add to resources map addtoresourcesmap string key i java project ijavaproject jproj cache mutex cachemutex i java project ijavaproject container project key hash set hashset container project key add jproj wrapper class loader classloader load class loadclass new instance newinstance handle reporting errors object load instance loadinstance string factory name factoryname class loader classloader i java project ijavaproject jproj load failure handler loadfailurehandler failure handler failurehandler object load class loadclass factory name factoryname new instance newinstance exception apt plugin aptplugin trace failed load factory factory name factoryname failure handler failurehandler add failed factory addfailedfactory factory name factoryname no class def found error noclassdeffounderror ncdfe apt plugin aptplugin trace failed load factory name factoryname ncdfe failure handler failurehandler add failed factory addfailedfactory factory name factoryname load java java processors factory path res ets resets apt build problem markers saved factory caches param containers ordered map load factories loadfactories map factory container factorycontainer factory path factorypath attributes containers i java project ijavaproject project load failure handler loadfailurehandler failure handler failurehandler map annotation processor factory annotationprocessorfactory factory path factorypath attributes java factories linked hash map linkedhashmap map i service factory iservicefactory factory path factorypath attributes java factories linked hash map linkedhashmap remove apt build problem markers removeaptbuildproblemmarkers project factory container factorycontainer bad containers badcontainers verify factory path verifyfactorypath project bad containers badcontainers factory container factorycontainer badfc bad containers badcontainers failure handler failurehandler add failed factory addfailedfactory badfc get id getid containers remove badfc cached class loader classloader class loader classloader iterative class loader iterativeclassloader cache mutex cachemutex iterative class loader iterativeclassloader iterative loaders iterativeloaders project iterative class loader iterativeclassloader iterative class loader iterativeclassloader create iterative class loader createiterativeclassloader containers iterative loaders iterativeloaders project iterative class loader iterativeclassloader class loader classloader batch class loader batchclassloader create batch class loader createbatchclassloader containers project map entry factory container factorycontainer factory path factorypath attributes entry containers entry set entryset factory container factorycontainer entry get key getkey factory path factorypath attributes attr entry get value getvalue attr run in batch mode runinbatchmode batch class loader batchclassloader class loader classloader attr run in batch mode runinbatchmode batch class loader batchclassloader iterative class loader iterativeclassloader java factories container list annotation processor factory annotationprocessorfactory java factories in container factoriesincontainer java factories in container factoriesincontainer load java loadjava factory classes factoryclasses project failure handler failurehandler annotation processor factory annotationprocessorfactory apf java factories in container factoriesincontainer java factories apf entry get value getvalue apt plugin aptplugin can run java canrunjava processors java factories class loader classloader sake sanity list i service factory iservicefactory java factories in container factoriesincontainer java factories in container factoriesincontainer load java loadjava factory classes factoryclasses project failure handler failurehandler i service factory iservicefactory isf java factories in container factoriesincontainer java factories isf entry get value getvalue file not found exception filenotfoundexception fnfe apt plugin aptplugin log fnfe messages annotation processor factory loader annotationprocessorfactoryloader jar not found jarnotfound fnfe get local ized message getlocalizedmessage i o exception ioexception ioe apt plugin aptplugin log ioe messages annotation processor factory loader annotationprocessorfactoryloader io error ioerror ioe get local ized message getlocalizedmessage cache mutex cachemutex project java factories project java factories project java factories project java factories list annotation processor factory annotationprocessorfactory load java loadjava factory classes factoryclasses factory container factorycontainer class loader classloader class loader classloader i java project ijavaproject jproj load failure handler loadfailurehandler failure handler failurehandler i o exception ioexception map string string factory names factorynames get factory names getfactorynames list annotation processor factory annotationprocessorfactory factories array list arraylist entry string string entry factory names factorynames entry set entryset apt plugin aptplugin java factory equals entry get value getvalue string factory name factoryname entry get key getkey annotation processor factory annotationprocessorfactory factory get type gettype factory type factorytype plugin factory factory plugin manager factorypluginmanager get java getjava factory from plugin factoryfromplugin factory name factoryname factory annotation processor factory annotationprocessorfactory load instance loadinstance factory name factoryname class loader classloader jproj failure handler failurehandler factory factories add factory factories list i service factory iservicefactory load java loadjava factory classes factoryclasses factory container factorycontainer class loader classloader class loader classloader i java project ijavaproject jproj load failure handler loadfailurehandler failure handler failurehandler i o exception ioexception map string string factory names factorynames get factory names getfactorynames list i service factory iservicefactory factories array list arraylist entry string string entry factory names factorynames entry set entryset apt plugin aptplugin java factory equals entry get value getvalue string factory name factoryname entry get key getkey i service factory iservicefactory factory get type gettype factory type factorytype plugin factory factory plugin manager factorypluginmanager get java getjava factory from plugin factoryfromplugin factory name factoryname clazz clazz class loader classloader load class loadclass factory name factoryname factory class service factory classservicefactory clazz class not found exception classnotfoundexception class format error classformaterror apt plugin aptplugin trace unable load annotation processor factory name factoryname failure handler failurehandler add failed factory addfailedfactory factory name factoryname factory factories add factory factories validate projects factory paths resource change adding absent jar file build problem markers removed reg enerated regenerated factory caches cleared process changes processchanges i java project ijavaproject map i java project ijavaproject load failure handler loadfailurehandler handlers i java project ijavaproject jproj remove apt build problem markers removeaptbuildproblemmarkers jproj uncache project uncacheproject jproj resource build problem i java project ijavaproject jproj jproj exists factory container factorycontainer bad containers badcontainers verify factory path verifyfactorypath jproj bad containers badcontainers load failure handler loadfailurehandler handler handlers jproj handler handler load failure handler loadfailurehandler jproj handlers jproj handler factory container factorycontainer container bad containers badcontainers handler add missing library addmissinglibrary container get id getid todo flag projects rebuild project deleted remove factory path loader param jproj uncache project uncacheproject i java project ijavaproject jproj class loader classloader class loader classloader cache mutex cachemutex project java factories remove jproj project java factories remove jproj iterative loaders iterativeloaders remove jproj batch loaders batchloaders remove jproj try to close class loader trytocloseclassloader try to close class loader trytocloseclassloader remove project from resource map removeprojectfromresourcemap jproj remove apt build problem markers missing factory jar param jproj remove markers projects factory paths remove apt build problem markers removeaptbuildproblemmarkers i java project ijavaproject jproj not e note project java factories key set keyset java i java project ijavaproject jproj ects jprojects cache mutex cachemutex jproj ects jprojects jproj hash set hashset project java factories key set keyset collections singleton jproj i java project ijavaproject jproj ects jprojects exists i project iproject get project getproject i marker imarker markers find markers findmarkers apt plugin aptplugin apt loader problem marker i resource iresource depth markers i marker imarker marker markers marker delete core exception coreexception apt plugin aptplugin log unable delete apt build problem marker remove references project container project project deleted verifying project factory path remove project from resource map removeprojectfromresourcemap i java project ijavaproject jproj cache mutex cachemutex iterator entry string i java project ijavaproject container project entry set entryset iterator has next hasnext entry string i java project ijavaproject i java project ijavaproject get value getvalue remove jproj remove orphaned resources is empty isempty remove check factory path project ensure containers lists adds jar factory container resources container project cache resource param jproj project check projects cache invalid containers containers path valid factory container factorycontainer verify factory path verifyfactorypath i java project ijavaproject jproj factory container factorycontainer bad containers badcontainers factory path factorypath factory path util factorypathutil get factory path getfactorypath jproj map factory container factorycontainer factory path factorypath attributes containers get enabled containers getenabledcontainers factory container factorycontainer containers key set keyset jar factory container jarfactorycontainer file jar file jarfile jar factory container jarfactorycontainer get jar file getjarfile add bad container jar file jarfile string key jar file jarfile get canonical path getcanonicalpath add to resources map addtoresourcesmap key jproj i o exception ioexception exists bad containers badcontainers bad containers badcontainers hash set hashset bad containers badcontainers add bad containers badcontainers param containers ordered map class loader classloader create iterative class loader createiterativeclassloader map factory container factorycontainer factory path factorypath attributes containers array list arraylist file file list filelist array list arraylist containers size map entry factory container factorycontainer factory path factorypath attributes entry containers entry set entryset factory path factorypath attributes attr entry get value getvalue factory container factorycontainer entry get key getkey attr run in batch mode runinbatchmode jar factory container jarfactorycontainer jar factory container jarfactorycontainer jfc jar factory container jarfactorycontainer file list filelist add jfc get jar file getjarfile class loader classloader file list filelist size create class loader createclassloader file list filelist get parent class loader getparentclassloader get parent class loader getparentclassloader returns batch loader class loader classloader create batch class loader createbatchclassloader map factory container factorycontainer factory path factorypath attributes containers i java project ijavaproject array list arraylist file file list filelist array list arraylist containers size map entry factory container factorycontainer factory path factorypath attributes entry containers entry set entryset factory path factorypath attributes attr entry get value getvalue factory container factorycontainer entry get key getkey attr run in batch mode runinbatchmode jar factory container jarfactorycontainer jar factory container jarfactorycontainer jfc jar factory container jarfactorycontainer file jfc get jar file getjarfile file list filelist add class loader classloader result iterative parent resolve classes cache mutex cachemutex class loader classloader parentcl iterative loaders iterativeloaders parentcl parentcl get parent class loader getparentclassloader file list filelist size result create class loader createclassloader file list filelist parentcl batch loaders batchloaders result result class loader classloader get parent class loader getparentclassloader class loader classloader loader for com sun mirror classes loaderforcomsunmirrorclasses annotation processor factory loader annotationprocessorfactoryloader get class loader getclassloader class loader classloader loader for everything else loaderforeverythingelse class loader classloader get system class loader getsystemclassloader class loader classloader override find class findclass string class not found exception classnotfoundexception nls starts with startswith sun mirror starts with startswith sun mirror apt starts with startswith sun mirror declaration nls starts with startswith nls sun mirror type nls starts with startswith nls sun mirror util loader for com sun mirror classes loaderforcomsunmirrorclasses load class loadclass loader for everything else loaderforeverythingelse load class loadclass class loader classloader create class loader createclassloader list file files class loader classloader parentcl jar class loader jarclassloader files parentcl list url urls array list arraylist files size files size urls add files touri tourl malformedurlexception mue url url array urlarray urls to array toarray url urls size url class loader urlclassloader url array urlarray parentcl try to close class loader trytocloseclassloader class loader classloader class loader classloader class loader classloader closeable closeable class loader classloader close i o exception ioexception apt plugin aptplugin log unable close loader