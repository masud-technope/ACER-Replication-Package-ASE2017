copyright ibm corporation rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors ibm corporation initial api implementation stephan herrmann contribution bug ordering comments imports preserved john glassmyer jogl google group sorting broken https bugs eclipse org org eclipse jdt internal core dom rewrite imports java util array list arraylist java util collection java util collections java util hash set hashset java util identity hash map identityhashmap java util iterator java util linked hash set linkedhashset java util list java util map java util map entry java util navigable map navigablemap java util java util tree map treemap org eclipse core runtime i progress monitor iprogressmonitor org eclipse core runtime i status istatus org eclipse core runtime status org eclipse jdt core i compilation unit icompilationunit org eclipse jdt core i java project ijavaproject org eclipse jdt core java core javacore org eclipse jdt core java model exception javamodelexception org eclipse jdt core dom ast node astnode org eclipse jdt core dom comment org eclipse jdt core dom compilation unit compilationunit org eclipse jdt core dom import declaration importdeclaration org eclipse jdt core dom package declaration packagedeclaration org eclipse jdt core formatter default code formatter constants defaultcodeformatterconstants org eclipse jdt core search search engine searchengine org eclipse jdt internal core java project javaproject org eclipse jdt internal core dom rewrite imports conflict identifier conflictidentifier conflicts org eclipse jdt internal core util util org eclipse jface text i region iregion org eclipse jface text region org eclipse text edits text edit textedit caller imports removed compilation unit creates text edit textedit applied compilation unit effects add itions additions removals operates modes selected link import rewrite configuration importrewriteconfiguration builder factory methods discarding original imports totally sorting imports mode organize imports operation preserving original imports placing adjacent closely matching mode content assist adds completed import rewrite analyzer importrewriteanalyzer enc apsulates encapsulates computed rewrite code text edit textedit applied rewrite names imports created rewrite rewrite result rewriteresult text edit textedit text edit textedit import name importname created imports createdimports rewrite result rewriteresult text edit textedit text edit textedit import name importname created imports createdimports text edit textedit text edit textedit created imports createdimports collections unmodifiable set unmodifiableset created imports createdimports returns link text edit textedit describing perform rewrite text edit textedit get text edit gettextedit text edit textedit string get created imports getcreatedimports extract qualified names extractqualifiednames created imports createdimports string get created static imports getcreatedstaticimports extract qualified names extractqualifiednames created imports createdimports string extract qualified names extractqualifiednames collection import name importname imports list string names array list arraylist string imports size import name importname import name importname imports import name importname is static isstatic names add import name importname qualified name qualifiedname names to array toarray string names size returns formatter option blank lines insert groups get blank lines between import groups getblanklinesbetweenimportgroups i java project ijavaproject java project javaproject num string blank lines option value blanklinesoptionvalue java project javaproject get option getoption default code formatter constants defaultcodeformatterconstants formatter blank lines groups num integer parse int parseint blank lines option value blanklinesoptionvalue number format exception numberformatexception string message string format parse int eger integer default code formatter constants defaultcodeformatterconstants formatter blank lines groups blank lines option value blanklinesoptionvalue util log status i status istatus warning java core javacore plugin message num num returns formatter option insert space imported semicolon declaration should insert space before semicolon shouldinsertspacebeforesemicolon i java project ijavaproject java project javaproject java core javacore insert equals java project javaproject get option getoption default code formatter constants defaultcodeformatterconstants formatter insert space semicolon reads positions existing declaration comments returns list iteration order ref lects reflects existing order imports compilation unit list original import entry originalimportentry read original imports readoriginalimports compilation unit compilationunit compilation unit compilationunit list import declaration importdeclaration import declarations importdeclarations compilation unit compilationunit imports import declarations importdeclarations is empty isempty collections empty list emptylist list comment comments compilation unit compilationunit get comment list getcommentlist current comment index currentcommentindex skip file header comments https bugs eclipse org import declaration importdeclaration first import firstimport import declarations importdeclarations package declaration packagedeclaration package declaration packagedeclaration compilation unit compilationunit get package getpackage first import start position firstimportstartposition package declaration packagedeclaration first import firstimport get start position getstartposition compilation unit compilationunit get extended start position getextendedstartposition package declaration packagedeclaration compilation unit compilationunit get extended length getextendedlength package declaration packagedeclaration current comment index currentcommentindex comments size comments current comment index currentcommentindex get start position getstartposition first import start position firstimportstartposition current comment index currentcommentindex list original import entry originalimportentry imports array list arraylist original import entry originalimportentry import declarations importdeclarations size previous extended end position previousextendedendposition import declaration importdeclaration current import currentimport import declarations importdeclarations extended end position extendedendposition compilation unit compilationunit get extended start position getextendedstartposition current import currentimport compilation unit compilationunit get extended length getextendedlength current import currentimport comment after import index commentafterimportindex current comment index currentcommentindex comment after import index commentafterimportindex comments size comments comment after import index commentafterimportindex get start position getstartposition extended end position extendedendposition comment after import index commentafterimportindex list import comment importcomment import comments importcomments comment after import index commentafterimportindex current comment index currentcommentindex import comments importcomments collections empty list emptylist import comments importcomments select import comments selectimportcomments compilation unit compilationunit comments current import currentimport get start position getstartposition current comment index currentcommentindex comment after import index commentafterimportindex import and comments start position importandcommentsstartposition import comments importcomments is empty isempty current import currentimport get start position getstartposition math min current import currentimport get start position getstartposition import comments importcomments region get offset getoffset i region iregion leading whitespace region leadingwhitespaceregion preceding line delimiters precedinglinedelimiters previous extended end position previousextendedendposition leading whitespace region leadingwhitespaceregion region import and comments start position importandcommentsstartposition preceding line delimiters precedinglinedelimiters leading whitespace region leadingwhitespaceregion region previous extended end position previousextendedendposition import and comments start position importandcommentsstartposition previous extended end position previousextendedendposition import and comments first line importandcommentsfirstline compilation unit compilationunit get line number getlinenumber import and comments start position importandcommentsstartposition last line of previous lastlineofprevious compilation unit compilationunit get line number getlinenumber previous extended end position previousextendedendposition preceding line delimiters precedinglinedelimiters import and comments first line importandcommentsfirstline last line of previous lastlineofprevious i region iregion import and comments region importandcommentsregion region import and comments start position importandcommentsstartposition extended end position extendedendposition import and comments start position importandcommentsstartposition imports add original import entry originalimportentry import name importname create for createfor current import currentimport import comments importcomments preceding line delimiters precedinglinedelimiters leading whitespace region leadingwhitespaceregion import and comments region importandcommentsregion current comment index currentcommentindex comment after import index commentafterimportindex previous extended end position previousextendedendposition extended end position extendedendposition imports list import comment importcomment select import comments selectimportcomments compilation unit compilationunit compilation unit compilationunit list comment comments import declaration start position importdeclarationstartposition comment start index commentstartindex comment end index commentendindex list import comment importcomment import comments importcomments array list arraylist import comment importcomment comments size iterator comment comment iterator commentiterator comments sub list sublist comment start index commentstartindex comment end index commentendindex iterator comment current comment currentcomment comment iterator commentiterator has next hasnext comment iterator commentiterator current comment currentcomment current comment start position currentcommentstartposition current comment currentcomment get start position getstartposition current comment length currentcommentlength current comment currentcomment get length getlength comment next comment nextcomment comment iterator commentiterator has next hasnext comment iterator commentiterator succeeding line delims succeedinglinedelims next comment start position nextcommentstartposition next comment nextcomment integer max next comment nextcomment get start position getstartposition next start position nextstartposition math min import declaration start position importdeclarationstartposition next comment start position nextcommentstartposition next start position nextstartposition integer max trailing comment located extended range don care delimiters follow succeeding line delims succeedinglinedelims current comment end line currentcommentendline compilation unit compilationunit get line number getlinenumber current comment start position currentcommentstartposition current comment length currentcommentlength next start line nextstartline compilation unit compilationunit get line number getlinenumber next start position nextstartposition succeeding line delims succeedinglinedelims next start line nextstartline current comment end line currentcommentendline import comments importcomments add import comment importcomment region current comment start position currentcommentstartposition current comment length currentcommentlength succeeding line delims succeedinglinedelims current comment currentcomment next comment nextcomment import comments importcomments rewrite site rewritesite determine rewrite site determinerewritesite compilation unit compilationunit compilation unit compilationunit list original import entry originalimportentry original imports originalimports i region iregion imports region importsregion determine imports region determineimportsregion original imports originalimports i region iregion surrounding region surroundingregion determine surrounding region determinesurroundingregion compilation unit compilationunit imports region importsregion has preceding elements hasprecedingelements surrounding region surroundingregion get offset getoffset has succeeding elements hassucceedingelements surrounding region surroundingregion get offset getoffset surrounding region surroundingregion get length getlength compilation unit compilationunit get length getlength rewrite site rewritesite surrounding region surroundingregion imports region importsregion has preceding elements hasprecedingelements has succeeding elements hassucceedingelements determines region originally occupied imports comments returns original imports originalimports empty i region iregion determine imports region determineimportsregion list original import entry originalimportentry original imports originalimports original imports originalimports original imports originalimports is empty isempty original import entry originalimportentry first import firstimport original imports originalimports start first import firstimport declaration and comments declarationandcomments get offset getoffset original import entry originalimportentry last import lastimport original imports originalimports original imports originalimports size last import lastimport declaration and comments declarationandcomments get offset getoffset last import lastimport declaration and comments declarationandcomments get length getlength region start start determines region occupied imports comments surrounding whitespace i region iregion determine surrounding region determinesurroundingregion compilation unit compilationunit compilation unit compilationunit i region iregion imports region importsregion navigable map navigablemap integer ast node astnode nodes tree map nodestreemap map top level nodes maptoplevelnodes compilation unit compilationunit surrounding start surroundingstart position after imports positionafterimports imports region importsregion package declaration packagedeclaration package declaration packagedeclaration compilation unit compilationunit get package getpackage package declaration packagedeclaration surrounding start surroundingstart compilation unit compilationunit get extended start position getextendedstartposition package declaration packagedeclaration compilation unit compilationunit get extended length getextendedlength package declaration packagedeclaration surrounding start surroundingstart position after imports positionafterimports surrounding start surroundingstart entry integer ast node astnode lower entry lowerentry nodes tree map nodestreemap lower entry lowerentry imports region importsregion get offset getoffset lower entry lowerentry ast node astnode preceding node precedingnode lower entry lowerentry get value getvalue surrounding start surroundingstart preceding node precedingnode get start position getstartposition preceding node precedingnode get length getlength surrounding start surroundingstart position after imports positionafterimports imports region importsregion get offset getoffset imports region importsregion get length getlength integer ceiling key ceilingkey nodes tree map nodestreemap ceiling key ceilingkey position after imports positionafterimports surrounding end surroundingend ceiling key ceilingkey ceiling key ceilingkey compilation unit compilationunit get length getlength region surrounding start surroundingstart surrounding end surroundingend surrounding start surroundingstart builds navigable map navigablemap compilation unit top level nodes declaration declarations type declarations doc comments keyed start position navigable map navigablemap integer ast node astnode map top level nodes maptoplevelnodes compilation unit compilationunit compilation unit compilationunit navigable map navigablemap integer ast node astnode map tree map treemap integer ast node astnode collection ast node astnode nodes array list arraylist ast node astnode compilation unit compilationunit get package getpackage nodes add compilation unit compilationunit get package getpackage nodes add all addall compilation unit compilationunit imports nodes add all addall compilation unit compilationunit types comment comment list comment compilation unit compilationunit get comment list getcommentlist doc comments contained parent nodes ranges comment get parent getparent nodes add comment ast node astnode node nodes map node get start position getstartposition node map builds code identity hash map identityhashmap elements code imports values element code import name importname key map rec all recall code import entry importentry code import name importname instance duplicate declarations multiple code import entry importentry equal identical code import name importname map import name importname original import entry originalimportentry map imports by name identity mapimportsbynameidentity list original import entry originalimportentry imports map import name importname original import entry originalimportentry imports by name importsbyname identity hash map identityhashmap import name importname original import entry originalimportentry original import entry originalimportentry current import currentimport imports imports by name importsbyname current import currentimport import name importname current import currentimport collections unmodifiable map unmodifiablemap imports by name importsbyname returns code list elements code imports existing order contained code imports to sub tract importstosubtract list import name importname sub tract imports subtractimports collection import name importname existing imports existingimports import name importname imports to sub tract importstosubtract list import name importname remaining imports remainingimports array list arraylist import name importname existing imports existingimports size import name importname existing import existingimport existing imports existingimports imports to sub tract importstosubtract existing import existingimport remaining imports remainingimports add existing import existingimport remaining imports remainingimports list original import entry originalimportentry original import entries originalimportentries list import name importname original imports list originalimportslist import name importname original imports set originalimportsset import declaration writer importdeclarationwriter import declaration writer importdeclarationwriter import adder importadder import adder importadder import name importname imports to add importstoadd import name importname imports to remove importstoremove report all result ant imports as created reportallresultantimportsascreated string type explicit simple names typeexplicitsimplenames string static explicit simple names staticexplicitsimplenames string implicit import container names implicitimportcontainernames conflict identifier conflictidentifier conflict identifier conflictidentifier on demand computer ondemandcomputer on demand computer ondemandcomputer map import name importname original import entry originalimportentry imports by name identity importsbynameidentity string line delimiter linedelimiter import editor importeditor import editor importeditor import rewrite analyzer importrewriteanalyzer i compilation unit icompilationunit compilation unit compilationunit ast root astroot import rewrite configuration importrewriteconfiguration configuration java model exception javamodelexception original import entries originalimportentries collections unmodifiable list unmodifiablelist read original imports readoriginalimports ast root astroot list import name importname imports list importslist array list arraylist import name importname original import entries originalimportentries size import name importname imports set importsset hash set hashset import name importname import entry importentry original import entry originalimportentry original import entries originalimportentries import name importname import name importname original import entry originalimportentry import name importname imports list importslist add import name importname imports set importsset add import name importname original imports list originalimportslist collections unmodifiable list unmodifiablelist imports list importslist original imports set originalimportsset collections unmodifiable set unmodifiableset imports set importsset imports to add importstoadd linked hash set linkedhashset import name importname imports to remove importstoremove linked hash set linkedhashset import name importname configuration original import handling originalimporthandling should remove original imports shouldremoveoriginalimports imports to remove importstoremove add all addall imports set importsset report all result ant imports as created reportallresultantimportsascreated report all result ant imports as created reportallresultantimportsascreated type explicit simple names typeexplicitsimplenames hash set hashset string static explicit simple names staticexplicitsimplenames hash set hashset string import group comparator importgroupcomparator import group comparator importgroupcomparator import group comparator importgroupcomparator configuration import order importorder java project javaproject java project javaproject java project javaproject get java project getjavaproject import adder importadder configuration original import handling originalimporthandling create import adder createimportadder import comparator importcomparator import group comparator importgroupcomparator configuration type container sorting typecontainersorting create container comparator createcontainercomparator java project javaproject configuration static container sorting staticcontainersorting create container comparator createcontainercomparator java project javaproject implicit import container names implicitimportcontainernames configuration implicit import identification implicitimportidentification determine implicit import containers determineimplicitimportcontainers on demand computer ondemandcomputer on demand computer ondemandcomputer configuration type on demand threshold typeondemandthreshold configuration static on demand threshold staticondemandthreshold conflict identifier conflictidentifier conflict identifier conflictidentifier on demand computer ondemandcomputer type conflicting simple name finder typeconflictingsimplenamefinder java project javaproject search engine searchengine static conflicting simple name finder staticconflictingsimplenamefinder java project javaproject implicit import container names implicitimportcontainernames imports by name identity importsbynameidentity map imports by name identity mapimportsbynameidentity original import entries originalimportentries import declaration writer importdeclarationwriter import declaration writer importdeclarationwriter should insert space before semicolon shouldinsertspacebeforesemicolon java project javaproject line delimiter linedelimiter find recommended line separator findrecommendedlineseparator import editor importeditor import editor importeditor line delimiter linedelimiter configuration original import handling originalimporthandling should fix all line delimiters shouldfixalllinedelimiters get blank lines between import groups getblanklinesbetweenimportgroups java project javaproject import group comparator importgroupcomparator original import entries originalimportentries determine rewrite site determinerewritesite ast root astroot original import entries originalimportentries import declaration writer importdeclarationwriter specifies app lying applying rewrite result compilation unit compilation unit overrides previous call link remove import removeimport add import addimport is static isstatic string qualified name qualifiedname import name importname import to add importtoadd import name importname create for createfor is static isstatic qualified name qualifiedname imports to add importstoadd add import to add importtoadd imports to remove importstoremove remove import to add importtoadd specifies app lying applying rewrite result compilation unit compilation unit overrides previous call link add import addimport remove import removeimport is static isstatic string qualified name qualifiedname import name importname import to remove importtoremove import name importname create for createfor is static isstatic qualified name qualifiedname imports to add importstoadd remove import to remove importtoremove imports to remove importstoremove add import to remove importtoremove specifies simple explicit reduced demand filtered implicit java lang require explicit import requireexplicitimport is static isstatic string simple name simplename is static isstatic static explicit simple names staticexplicitsimplenames add simple name simplename type explicit simple names typeexplicitsimplenames add simple name simplename computes returns result performing rewrite inc orporating incorporating calls link add import addimport link remove import removeimport link require explicit import requireexplicitimport method side effects rewrite result rewriteresult analyze rewrite analyzerewrite i progress monitor iprogressmonitor monitor java model exception javamodelexception list import name importname computed import order computedimportorder compute import order computeimportorder monitor list import entry importentry resulting import entries resultingimportentries match existing or create new matchexistingorcreatenew computed import order computedimportorder text edit textedit edit import editor importeditor create text edit createtextedit resulting import entries resultingimportentries import name importname created imports createdimports hash set hashset import name importname computed import order computedimportorder report all result ant imports as created reportallresultantimportsascreated created imports createdimports remove all removeall original imports set originalimportsset rewrite result rewriteresult edit created imports createdimports list import name importname compute import order computeimportorder i progress monitor iprogressmonitor progress monitor progressmonitor java model exception javamodelexception import name importname imports with add itions and removals importswithadditionsandremovals hash set hashset import name importname original imports set originalimportsset imports with add itions and removals importswithadditionsandremovals add all addall imports to add importstoadd imports with add itions and removals importswithadditionsandremovals remove all removeall imports to remove importstoremove import name importname touched containers touchedcontainers determine to uched containers determinetouchedcontainers conflicts conflicts conflict identifier conflictidentifier identify conflicts identifyconflicts imports with add itions and removals importswithadditionsandremovals touched containers touchedcontainers type explicit simple names typeexplicitsimplenames static explicit simple names staticexplicitsimplenames progress monitor progressmonitor string all type explicit simple names alltypeexplicitsimplenames hash set hashset string type explicit simple names typeexplicitsimplenames all type explicit simple names alltypeexplicitsimplenames add all addall conflicts type conflicts typeconflicts string all static explicit simple names allstaticexplicitsimplenames hash set hashset string static explicit simple names staticexplicitsimplenames all static explicit simple names allstaticexplicitsimplenames add all addall conflicts static conflicts staticconflicts import name importname implicit imports implicitimports identify implicit imports identifyimplicitimports imports to add importstoadd all type explicit simple names alltypeexplicitsimplenames list import name importname imports without impl icits importswithoutimplicits sub tract imports subtractimports imports with add itions and removals importswithadditionsandremovals implicit imports implicitimports collection on demand reduction ondemandreduction on demand reductions ondemandreductions on demand computer ondemandcomputer identify possible reductions identifypossiblereductions hash set hashset import name importname imports without impl icits importswithoutimplicits touched containers touchedcontainers all type explicit simple names alltypeexplicitsimplenames all static explicit simple names allstaticexplicitsimplenames imports delta importsdelta delta compute delta computedelta implicit imports implicitimports on demand reductions ondemandreductions list import name importname imports with removals importswithremovals sub tract imports subtractimports original imports list originalimportslist delta imports to remove importstoremove list import name importname imports with add itions importswithadditions import adder importadder add imports addimports imports with removals importswithremovals delta imports to add importstoadd imports with add itions importswithadditions import name importname determine to uched containers determinetouchedcontainers collection import name importname touched containers touchedcontainers array list arraylist import name importname imports to add importstoadd size imports to remove importstoremove size import name importname added import addedimport imports to add importstoadd touched containers touchedcontainers add added import addedimport get container on demand getcontainerondemand import name importname removed import removedimport imports to remove importstoremove touched containers touchedcontainers add removed import removedimport get container on demand getcontainerondemand collections unmodifiable set unmodifiableset hash set hashset import name importname touched containers touchedcontainers import name importname identify implicit imports identifyimplicitimports collection import name importname added imports addedimports string all type explicit simple names alltypeexplicitsimplenames implicit import container names implicitimportcontainernames is empty isempty collections empty set emptyset collection import name importname impl icits implicits array list arraylist import name importname added imports addedimports size import name importname added import addedimport added imports addedimports is implicit isimplicit implicit import container names implicitimportcontainernames added import addedimport container name containername all type explicit simple names alltypeexplicitsimplenames added import addedimport simple name simplename is implicit isimplicit impl icits implicits add added import addedimport impl icits implicits is empty isempty collections empty set emptyset hash set hashset import name importname impl icits implicits list import entry importentry match existing or create new matchexistingorcreatenew collection import name importname import names importnames list import entry importentry import entries importentries array list arraylist import entry importentry import names importnames size import name importname import name importname import names importnames import entry importentry import entry importentry imports by name identity importsbynameidentity import name importname import entry importentry import entry importentry new import entry newimportentry import name importname import entries importentries add import entry importentry import entries importentries imports delta importsdelta compute delta computedelta collection import name importname implicit imports implicitimports collection on demand reduction ondemandreduction on demand reductions ondemandreductions collection import name importname add itions additions array list arraylist import name importname original imports list originalimportslist size add itions additions add all addall imports to add importstoadd collection import name importname removals array list arraylist import name importname original imports list originalimportslist size removals add all addall imports to remove importstoremove removals add all addall implicit imports implicitimports add itions additions remove all removeall removals on demand reduction ondemandreduction on demand reduction ondemandreduction on demand reductions ondemandreductions add itions additions remove all removeall on demand reduction ondemandreduction reducible imports reducibleimports removals add all addall on demand reduction ondemandreduction reducible imports reducibleimports add itions additions add on demand reduction ondemandreduction container on demand containerondemand removals remove on demand reduction ondemandreduction container on demand containerondemand imports delta importsdelta add itions additions removals