copyright software rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors stephan herrmann initial api implementation lars vogel lars vogel vogella contributions bug org eclipse jdt internal compiler lookup java util array list arraylist java util collection java util collections java util hash set hashset java util list java util org eclipse jdt internal compiler ast argument org eclipse jdt internal compiler ast conditional expression conditionalexpression org eclipse jdt internal compiler ast expression org eclipse jdt internal compiler ast expression context expressioncontext org eclipse jdt internal compiler ast invocation org eclipse jdt internal compiler ast lambda expression lambdaexpression org eclipse jdt internal compiler ast message send messagesend org eclipse jdt internal compiler ast reference expression referenceexpression org eclipse jdt internal compiler lookup inference context inferencecontext suspended inference record suspendedinferencerecord implementation jls expression constraint expression formula constraintexpressionformula constraint formula constraintformula expression left flag contributes work around workaround control led controlled inference context inferencecontext argument const raints constraints soft is soft issoft constraint expression formula constraintexpressionformula expression expression type binding typebinding type relation left expression type relation relation constraint expression formula constraintexpressionformula expression expression type binding typebinding type relation is soft issoft expression type relation is soft issoft is soft issoft object reduce inference context inferencecontext inference context inferencecontext inference failure exception inferencefailureexception relation compatible left is potentially compatible with ispotentiallycompatiblewith inference context inferencecontext scope jls is proper type ispropertype left is compatible with iscompatiblewith inference context inferencecontext scope left is boxing compatible with isboxingcompatiblewith inference context inferencecontext scope can be poly expression canbepolyexpression left type binding typebinding expr type exprtype left resolved type resolvedtype expr type exprtype expr type exprtype is valid binding isvalidbinding left message send messagesend message send messagesend left actual receiver type actualreceivertype inference variable inferencevariable val uable valuable infer constraint type formula constrainttypeformula create expr type exprtype compatible is soft issoft parenthesized expression tra nsparent transparent ast left invocation invocation invocation invocation left method binding methodbinding previous method previousmethod invocation binding happen copied lambda errors previous method previousmethod proceed constraints method binding methodbinding method previous method previousmethod ignore previous inference result fresh start avoid original discard level instantiation method type variables type variables method previous method previousmethod shallow original shalloworiginal suspended inference record suspendedinferencerecord prev invocation previnvocation inference context inferencecontext enter poly invocation enterpolyinvocation invocation invocation arguments invocation applicability inference invocation type inference expression arguments invocation arguments type binding typebinding argument types argumenttypes arguments binding parameters type binding typebinding arguments length argument types argumenttypes length argument types argumenttypes arguments resolved type resolvedtype previous method previousmethod parameterized generic method binding parameterizedgenericmethodbinding find previous inference context inference kind invocation inference context inferencecontext inner ctx innerctx invocation get inference context getinferencecontext parameterized generic method binding parameterizedgenericmethodbinding previous method previousmethod inner ctx innerctx inference context method manufactured scope find exact method findexactmethod assume was n wasn poly proceed poly expressions type binding typebinding expr type exprtype left resolved type resolvedtype expr type exprtype expr type exprtype is valid binding isvalidbinding constraint type formula constrainttypeformula create expr type exprtype compatible is soft issoft inner ctx innerctx step completed stepcompleted inference context inferencecontext app licability applicability inf erred inferred inference context inferencecontext int egrate inner inference b integrateinnerinferenceb inner ctx innerctx reach lifted inferring poly invocation type amounts lifting inference context inferencecontext inference kind inferencekind inference context inferencecontext get inference kind getinferencekind previous method previousmethod argument types argumenttypes is diamond isdiamond method is constructor isconstructor left is poly expression ispolyexpression method infer invocation applicability inferinvocationapplicability inference context inferencecontext method argument types argumenttypes is diamond isdiamond inference context inferencecontext inference kind inferencekind lifted inferring poly invocation type amounts lifting infer poly invocation type inferpolyinvocationtype inference context inferencecontext invocation method inc orporated incorporated inference context inferencecontext resume suspended inference resumesuspendedinference prev invocation previnvocation left conditional expression conditionalexpression conditional expression conditionalexpression conditional conditional expression conditionalexpression left constraint formula constraintformula constraint expression formula constraintexpressionformula conditional value if true valueiftrue relation is soft issoft constraint expression formula constraintexpressionformula conditional value if false valueiffalse relation is soft issoft left lambda expression lambdaexpression lambda expression lambdaexpression lambda lambda expression lambdaexpression left block scope blockscope scope lambda enclosing scope enclosingscope is functional interface isfunctionalinterface scope reference binding referencebinding reference binding referencebinding parameterized type binding parameterizedtypebinding with wild cards withwildcards inference context inferencecontext parameterized with wildcard parameterizedwithwildcard with wild cards withwildcards find ground target type findgroundtargettype inference context inferencecontext scope lambda with wild cards withwildcards method binding methodbinding function type functiontype get single abstract method getsingleabstractmethod scope function type functiontype type binding typebinding parameters function type functiontype parameters parameters length lambda arguments length lambda arguments type elided argumentstypeelided parameters length parameters is proper type ispropertype lambda lambda resolve expression expecting resolveexpressionexpecting inference context inferencecontext scope inference context inferencecontext lambda str ictly strictly unreduceable proc eeding proceeding produce secondary errors function type functiontype return type returntype type binding typebinding lambda is void compatible isvoidcompatible lambda is value compatible isvaluecompatible list constraint formula constraintformula result array list arraylist lambda arguments type elided argumentstypeelided argument arguments lambda arguments parameters length result add constraint type formula constrainttypeformula create parameters arguments type resolved type resolvedtype add ition addition âÿ¨t tâÿ© lambda resolved type resolvedtype result add constraint type formula constrainttypeformula create lambda resolved type resolvedtype subtype function type functiontype return type returntype type binding typebinding type binding typebinding function type functiontype return type returntype expression exprs lambda result expressions resultexpressions length exprs exprs length length expression expr exprs is proper type ispropertype expr resolved type resolvedtype type binding typebinding expr type exprtype expr resolved type resolvedtype compatible assignment context expr is constant value of type assignable to type isconstantvalueoftypeassignabletotype expr type exprtype expr type exprtype is compatible with iscompatiblewith expr is boxing compatible isboxingcompatible expr type exprtype expr scope result add constraint expression formula constraintexpressionformula expr compatible is soft issoft result size result to array toarray constraint formula constraintformula result size left reference expression referenceexpression reduce reference expression compatibility reducereferenceexpressioncompatibility reference expression referenceexpression left inference context inferencecontext reference binding referencebinding find ground target type findgroundtargettype inference context inferencecontext inference context inferencecontext block scope blockscope scope lambda expression lambdaexpression lambda parameterized type binding parameterizedtypebinding target type with wild cards targettypewithwildcards lambda arguments type elided argumentstypeelided lambda find ground target type for elided lambda findgroundtargettypeforelidedlambda scope target type with wild cards targettypewithwildcards suspended inference record suspendedinferencerecord previous inference context inferencecontext enter lambda enterlambda lambda inference context inferencecontext infer functional interface param eterization inferfunctionalinterfaceparameterization lambda scope target type with wild cards targettypewithwildcards inference context inferencecontext resume suspended inference resumesuspendedinference previous can be poly expression canbepolyexpression expression expr inferring compatibility type check is poly expression ispolyexpression assume expr occurs assignment context expression context expressioncontext previous expression context previousexpressioncontext expr get expression context getexpressioncontext previous expression context previousexpressioncontext expression context expressioncontext vanilla context left set expression context setexpressioncontext expression context expressioncontext assignment context expr is poly expression ispolyexpression expr set expression context setexpressioncontext previous expression context previousexpressioncontext object reduce reference expression compatibility reducereferenceexpressioncompatibility reference expression referenceexpression reference inference context inferencecontext inference context inferencecontext type binding typebinding is proper type ispropertype nls illegal state exception illegalstateexception reach proper type is functional interface isfunctionalinterface inference context inferencecontext scope method binding methodbinding function type functiontype get single abstract method getsingleabstractmethod inference context inferencecontext scope function type functiontype applicable method method reference targeting reference reference resolve expression expecting resolveexpressionexpecting inference context inferencecontext scope inference context inferencecontext method binding methodbinding potentially applicable potentiallyapplicable reference reference binding potentially applicable potentiallyapplicable reference is exact method reference isexactmethodreference list constraint formula constraintformula new constraints newconstraints array list arraylist type binding typebinding function type functiontype parameters length type binding typebinding p prime pprime potentially applicable potentiallyapplicable parameters p prime pprime length offset new constraints newconstraints add constraint type formula constrainttypeformula create reference lhs resolved type resolvedtype compatible offset offset new constraints newconstraints add constraint type formula constrainttypeformula create p prime pprime offset compatible type binding typebinding function type functiontype return type returntype type binding typebinding type binding typebinding r app l rappl potentially applicable potentiallyapplicable is constructor isconstructor reference is array constructor reference isarrayconstructorreference potentially applicable potentiallyapplicable declaring class declaringclass potentially applicable potentiallyapplicable return type returntype r app l rappl type binding typebinding type binding typebinding r prime rprime r app l rappl capture inference context inferencecontext scope reference source start sourcestart reference source end sourceend new constraints newconstraints add constraint type formula constrainttypeformula create r prime rprime compatible new constraints newconstraints to array toarray constraint formula constraintformula new constraints newconstraints size inexact function type functiontype parameters length function type functiontype parameters is proper type ispropertype search compile time declaration performed defined note don distinguish search applicable method searching compiler time declaration reusing method binding method binding methodbinding compile time decl compiletimedecl potentially applicable potentiallyapplicable compile time decl compiletimedecl is valid binding isvalidbinding type binding typebinding function type functiontype is constructor isconstructor function type functiontype declaring class declaringclass function type functiontype return type returntype type ids typeids ignore param eterization parameterization resolve result fresh start method binding methodbinding original compile time decl compiletimedecl shallow original shalloworiginal needs inference needsinference reference original type binding typebinding argument types argumenttypes is parameterized type isparameterizedtype method binding methodbinding captured function type capturedfunctiontype parameterized type binding parameterizedtypebinding get single abstract method getsingleabstractmethod inference context inferencecontext scope reference source start sourcestart reference source end sourceend argument types argumenttypes captured function type capturedfunctiontype parameters argument types argumenttypes function type functiontype parameters suspended inference record suspendedinferencerecord prev invocation previnvocation inference context inferencecontext enter poly invocation enterpolyinvocation reference reference create pseudo expressions createpseudoexpressions argument types argumenttypes invocation applicability inference invocation type inference inference context inferencecontext inner context innercontext reference get inference context getinferencecontext parameterized method binding parameterizedmethodbinding compile time decl compiletimedecl inner inference kind innerinferencekind determine inference kind determineinferencekind compile time decl compiletimedecl argument types argumenttypes inner context innercontext infer invocation applicability inferinvocationapplicability inference context inferencecontext original argument types argumenttypes original is constructor isconstructor mimic diamond inner inference kind innerinferencekind infer poly invocation type inferpolyinvocationtype inference context inferencecontext reference original inc orporated incorporated inference failure exception inferencefailureexception inference context inferencecontext resume suspended inference resumesuspendedinference prev invocation previnvocation type binding typebinding r prime rprime compile time decl compiletimedecl is constructor isconstructor compile time decl compiletimedecl declaring class declaringclass compile time decl compiletimedecl return type returntype capture inference context inferencecontext scope reference source start sourcestart reference source end sourceend r prime rprime type ids typeids constraint type formula constrainttypeformula create r prime rprime compatible is soft issoft needs inference needsinference reference expression referenceexpression reference method binding methodbinding original reference type arguments typearguments type binding typebinding compile time return compiletimereturn original is constructor isconstructor fact type expressions shape depend type variable original declaring class declaringclass type variables typevariables binding type variables reference receiver type receivertype is raw type israwtype diamond compile time return compiletimereturn original declaring class declaringclass compile time return compiletimereturn original return type returntype original type variables typevariables binding type variables compile time return compiletimereturn mentions any mentionsany original type variables typevariables determine inference kind determineinferencekind method binding methodbinding original type binding typebinding argument types argumenttypes inference context inferencecontext inner context innercontext inner context innercontext inner context innercontext inference kind inferencekind original is varargs isvarargs expected len expectedlen original parameters length provided len providedlen argument types argumenttypes length expected len expectedlen provided len providedlen inference context inferencecontext check vararg expected len expectedlen provided len providedlen type binding typebinding provided last providedlast argument types argumenttypes expected len expectedlen type binding typebinding expected last expectedlast original parameters expected len expectedlen provided last providedlast is compatible with iscompatiblewith expected last expectedlast expected last expectedlast is array type isarraytype expected last expectedlast expected last expectedlast leaf component type leafcomponenttype provided last providedlast is compatible with iscompatiblewith expected last expectedlast inference context inferencecontext check vararg inference context inferencecontext check strict infer invocation applicability inferinvocationapplicability inference context inferencecontext inference context inferencecontext method binding methodbinding method type binding typebinding arguments is diamond isdiamond check type checktype type variable binding typevariablebinding type variables typevariables method get all type variables getalltypevariables is diamond isdiamond creates initial bound inference variable inferencevariable inference variables inferencevariables inference context inferencecontext create initial bound set createinitialboundset type variables typevariables check varargs special treatment param length paramlength method parameters length type binding typebinding var args type varargstype method is varargs isvarargs var arg pos varargpos param length paramlength var args type varargstype method parameters var arg pos varargpos inference context inferencecontext create initial constraints for parameters createinitialconstraintsforparameters method parameters check type checktype inference context inferencecontext check vararg var args type varargstype method inference context inferencecontext add throws contraints addthrowscontraints type variables typevariables inference variables inferencevariables method thrown exceptions thrownexceptions perform steps jls needed computing bound infer poly invocation type inferpolyinvocationtype inference context inferencecontext inference context inferencecontext invocation site invocationsite invocation site invocationsite type binding typebinding target type targettype method binding methodbinding method inference failure exception inferencefailureexception type binding typebinding type arguments typearguments invocation site invocationsite generic type arguments generictypearguments type arguments typearguments invocation type inference type binding typebinding return type returntype method is constructor isconstructor method declaring class declaringclass method return type returntype return type returntype type binding typebinding nls inference failure exception inferencefailureexception nls expression inference context inferencecontext uses unchecked conversion usesuncheckedconversion spec erasure don compatibility rules erasure raw type type binding typebinding erasure inference context inferencecontext environment convert to raw type converttorawtype return type returntype constraint type formula constrainttypeformula new constraint newconstraint constraint type formula constrainttypeformula create erasure target type targettype compatible inference context inferencecontext reduce and inc orporate reduceandincorporate new constraint newconstraint type binding typebinding r the ta rtheta inference context inferencecontext substitute return type returntype parameterized type binding parameterizedtypebinding parameterized type parameterizedtype inference context inferencecontext parameterized with wildcard parameterizedwithwildcard r the ta rtheta parameterized type parameterizedtype parameterized type parameterizedtype arguments type binding typebinding arguments parameterized type parameterizedtype arguments inference variable inferencevariable betas inference context inferencecontext add type variable substitutions addtypevariablesubstitutions arguments parameterized type binding parameterizedtypebinding gbeta inference context inferencecontext environment create parameterized type createparameterizedtype parameterized type parameterizedtype generic type generictype betas parameterized type parameterizedtype enclosing type enclosingtype parameterized type parameterizedtype get type annotations gettypeannotations established types nonnull arguments inference context inferencecontext current bounds currentbounds captures gbeta parameterized type parameterizedtype inference context inferencecontext work around workaround bug jdk parameterized type parameterizedtype parameterized type parameterizedtype capture inference context inferencecontext scope invocation site invocationsite source start sourcestart invocation site invocationsite source end sourceend arguments parameterized type parameterizedtype arguments length arguments length length arguments is capture iscapture arguments is proper type ispropertype capture binding capturebinding capture capture binding capturebinding arguments inference context inferencecontext current bounds currentbounds add bound addbound type bound typebound betas capture inference context inferencecontext environment constraint type formula constrainttypeformula new constraint newconstraint constraint type formula constrainttypeformula create gbeta target type targettype compatible inference context inferencecontext reduce and inc orporate reduceandincorporate new constraint newconstraint https bugs open jdk openjdk java net browse jdk r the ta rtheta leaf component type leafcomponenttype inference variable inferencevariable inference variable inferencevariable alpha inference variable inferencevariable r the ta rtheta leaf component type leafcomponenttype type binding typebinding target leaf type targetleaftype target type targettype leaf component type leafcomponenttype to resolve toresolve inference context inferencecontext current bounds currentbounds condition bullet alpha target leaf type targetleaftype to resolve toresolve inference context inferencecontext current bounds currentbounds condition bullet alpha target leaf type targetleaftype inference context inferencecontext to resolve toresolve target leaf type targetleaftype is primitive type isprimitivetype type binding typebinding wrapper inference context inferencecontext current bounds currentbounds find wrapper type bound findwrappertypebound alpha wrapper to resolve toresolve to resolve toresolve bound set boundset solution inference context inferencecontext solve inference variable inferencevariable alpha solution type binding typebinding solution get instantiation getinstantiation alpha capture inference context inferencecontext scope invocation site invocationsite source start sourcestart invocation site invocationsite source end sourceend r the ta rtheta dimensions inference context inferencecontext environment create array type createarraytype r the ta rtheta dimensions constraint type formula constrainttypeformula new constraint newconstraint constraint type formula constrainttypeformula create target type targettype compatible inference context inferencecontext reduce and inc orporate reduceandincorporate new constraint newconstraint constraint type formula constrainttypeformula new constraint newconstraint constraint type formula constrainttypeformula create r the ta rtheta target type targettype compatible inference context inferencecontext reduce and inc orporate reduceandincorporate new constraint newconstraint collection inference variable inferencevariable input variables inputvariables inference context inferencecontext context left lambda expression lambdaexpression inference variable inferencevariable collections singleton list singletonlist inference variable inferencevariable is functional interface isfunctionalinterface context scope lambda expression lambdaexpression lambda lambda expression lambdaexpression left todo derive target type method binding methodbinding sam get single abstract method getsingleabstractmethod context scope inference variable inferencevariable variables hash set hashset lambda arguments type elided argumentstypeelided len sam parameters length len sam parameters collect inference variables collectinferencevariables variables sam return type returntype type binding typebinding type binding typebinding sam return type returntype lambda expression lambdaexpression resolved lambda resolve expression expecting resolveexpressionexpecting context scope context expression result expressions resultexpressions resolved resolved result expressions resultexpressions length result expressions resultexpressions result expressions resultexpressions length length variables add all addall constraint expression formula constraintexpressionformula result expressions resultexpressions compatible input variables inputvariables context variables left reference expression referenceexpression inference variable inferencevariable collections singleton list singletonlist inference variable inferencevariable is functional interface isfunctionalinterface context scope left is exact method reference isexactmethodreference method binding methodbinding sam get single abstract method getsingleabstractmethod context scope inference variable inferencevariable variables hash set hashset len sam parameters length len sam parameters collect inference variables collectinferencevariables variables variables left conditional expression conditionalexpression left is poly expression ispolyexpression conditional expression conditionalexpression expr conditional expression conditionalexpression left inference variable inferencevariable variables hash set hashset variables add all addall constraint expression formula constraintexpressionformula expr value if true valueiftrue compatible input variables inputvariables context variables add all addall constraint expression formula constraintexpressionformula expr value if false valueiffalse compatible input variables inputvariables context variables empty variable list debug ging debugging string to string tostring string buffer stringbuffer buf string buffer stringbuffer append left angle bracket left print expression printexpression buf buf append relation to string relationtostring relation append type name appendtypename buf buf append angle bracket buf to string tostring