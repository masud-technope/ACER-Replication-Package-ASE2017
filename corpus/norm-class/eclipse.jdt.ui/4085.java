copyright ibm corporation rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors ibm corporation initial api implementation dmitry stalnov dst alnov dstalnov f usionone fusionone contributed fixes constructor inlined https bugs eclipse org bugs bug cgi org eclipse jdt internal corext refactoring code java util array list arraylist java util hash map hashmap java util hash set hashset java util list java util map java util java util stack org eclipse core runtime org eclipse core runtime core exception coreexception org eclipse core runtime i progress monitor iprogressmonitor org eclipse core runtime sub progress monitor subprogressmonitor org eclipse ltk core refactoring refactoring status refactoringstatus org eclipse jdt core i compilation unit icompilationunit org eclipse jdt core i method imethod org eclipse jdt core i type itype org eclipse jdt core java model exception javamodelexception org eclipse jdt core source range sourcerange org eclipse jdt core dom ast node astnode org eclipse jdt core dom ast visitor astvisitor org eclipse jdt core dom abstract type declaration abstracttypedeclaration org eclipse jdt core dom annotation type declaration annotationtypedeclaration org eclipse jdt core dom block org eclipse jdt core dom body declaration bodydeclaration org eclipse jdt core dom class instance creation classinstancecreation org eclipse jdt core dom constructor invocation constructorinvocation org eclipse jdt core dom enum constant declaration enumconstantdeclaration org eclipse jdt core dom enum declaration enumdeclaration org eclipse jdt core dom field declaration fielddeclaration org eclipse jdt core dom i binding ibinding org eclipse jdt core dom i method binding imethodbinding org eclipse jdt core dom i type binding itypebinding org eclipse jdt core dom initializer org eclipse jdt core dom method declaration methoddeclaration org eclipse jdt core dom method invocation methodinvocation org eclipse jdt core dom super method invocation supermethodinvocation org eclipse jdt core dom type declaration typedeclaration org eclipse jdt core search i java search constants ijavasearchconstants org eclipse jdt core search i java search scope ijavasearchscope org eclipse jdt core search search engine searchengine org eclipse jdt core search search match searchmatch org eclipse jdt core search search pattern searchpattern org eclipse jdt internal corext dom ast nodes astnodes org eclipse jdt internal corext refactoring collecting search requestor collectingsearchrequestor org eclipse jdt internal corext refactoring refactoring core messages refactoringcoremessages org eclipse jdt internal corext refactoring refactoring scope factory refactoringscopefactory org eclipse jdt internal corext refactoring base java status context javastatuscontext org eclipse jdt internal corext refactoring base references in binary context referencesinbinarycontext org eclipse jdt internal corext util search utils searchutils org eclipse jdt sharedastprovider target provider targetprovider targets adapted method invocations inlined target provider targetprovider initialize i compilation unit icompilationunit get affected compilation units getaffectedcompilationunits refactoring status refactoringstatus status references in binary context referencesinbinarycontext binary refs binaryrefs i progress monitor iprogressmonitor core exception coreexception body declaration bodydeclaration get affected body declarations getaffectedbodydeclarations i compilation unit icompilationunit unit i progress monitor iprogressmonitor constructor invocation expression statement ast node astnode get invocations getinvocations body declaration bodydeclaration declaration i progress monitor iprogressmonitor refactoring status refactoringstatus check activation checkactivation java model exception javamodelexception get status severity getstatusseverity is single issingle target provider targetprovider create i compilation unit icompilationunit method invocation methodinvocation invocation single call target provider singlecalltargetprovider invocation target provider targetprovider create i compilation unit icompilationunit super method invocation supermethodinvocation invocation single call target provider singlecalltargetprovider invocation target provider targetprovider create i compilation unit icompilationunit constructor invocation constructorinvocation invocation single call target provider singlecalltargetprovider invocation target provider targetprovider create method declaration methoddeclaration declaration i method binding imethodbinding method declaration resolve binding resolvebinding method error target provider errortargetprovider refactoring status refactoringstatus create fatal error status createfatalerrorstatus refactoring core messages refactoringcoremessages target provider targetprovider method declaration unique i type binding itypebinding type method get declaring class getdeclaringclass type is local islocal i type itype type get java element getjavaelement is binary isbinary error target provider errortargetprovider refactoring status refactoringstatus create fatal error status createfatalerrorstatus refactoring core messages refactoringcoremessages target provider targetprovider local method binary i type itype declaring class of local declaringclassoflocal i type itype type get declaring class getdeclaringclass get java element getjavaelement local type target provider localtypetargetprovider declaring class of local declaringclassoflocal get compilation unit getcompilationunit declaration member type target provider membertypetargetprovider declaration resolve binding resolvebinding target provider targetprovider create i method binding imethodbinding method binding methodbinding member type target provider membertypetargetprovider method binding methodbinding fast done fastdone i progress monitor iprogressmonitor nls begin task begintask worked error target provider errortargetprovider target provider targetprovider refactoring status refactoringstatus f error status ferrorstatus error target provider errortargetprovider refactoring status refactoringstatus status f error status ferrorstatus status override refactoring status refactoringstatus check activation checkactivation java model exception javamodelexception f error status ferrorstatus override initialize override i compilation unit icompilationunit get affected compilation units getaffectedcompilationunits refactoring status refactoringstatus status references in binary context referencesinbinarycontext binary refs binaryrefs i progress monitor iprogressmonitor java model exception javamodelexception override body declaration bodydeclaration get affected body declarations getaffectedbodydeclarations i compilation unit icompilationunit unit i progress monitor iprogressmonitor override ast node astnode get invocations getinvocations body declaration bodydeclaration declaration i progress monitor iprogressmonitor override get status severity getstatusseverity single call target provider singlecalltargetprovider target provider targetprovider i compilation unit icompilationunit fcunit ast node astnode f invocation finvocation f iter ated fiterated single call target provider singlecalltargetprovider i compilation unit icompilationunit ast node astnode invocation is not null isnotnull is not null isnotnull invocation is true istrue invocations is invocation isinvocation invocation fcunit f invocation finvocation invocation override initialize f iter ated fiterated override i compilation unit icompilationunit get affected compilation units getaffectedcompilationunits refactoring status refactoringstatus status references in binary context referencesinbinarycontext binary refs binaryrefs i progress monitor iprogressmonitor i compilation unit icompilationunit fcunit override body declaration bodydeclaration get affected body declarations getaffectedbodydeclarations i compilation unit icompilationunit unit i progress monitor iprogressmonitor is true istrue unit fcunit f iter ated fiterated body declaration bodydeclaration fast done fastdone body declaration bodydeclaration body declaration bodydeclaration ast nodes astnodes get parent getparent f invocation finvocation body declaration bodydeclaration override ast node astnode get invocations getinvocations body declaration bodydeclaration declaration i progress monitor iprogressmonitor fast done fastdone f iter ated fiterated f iter ated fiterated ast node astnode f invocation finvocation override refactoring status refactoringstatus check activation checkactivation java model exception javamodelexception refactoring status refactoringstatus override get status severity getstatusseverity refactoring status refactoringstatus fatal override is single issingle body data bodydata list ast node astnode f invocations finvocations body data bodydata add invocation addinvocation ast node astnode node f invocations finvocations f invocations finvocations array list arraylist f invocations finvocations add node ast node astnode get invocations getinvocations f invocations finvocations to array toarray ast node astnode f invocations finvocations size has invocations hasinvocations f invocations finvocations f invocations finvocations is empty isempty invocation finder invocationfinder ast visitor astvisitor map body declaration bodydeclaration body data bodydata result hash map hashmap stack body data bodydata f bodies fbodies stack body data bodydata f current fcurrent i method binding imethodbinding f binding fbinding invocation finder invocationfinder i method binding imethodbinding binding is not null isnotnull binding f binding fbinding binding get method declaration getmethoddeclaration is not null isnotnull f binding fbinding override visit enum constant declaration enumconstantdeclaration node visit non type body declaration visitnontypebodydeclaration override end visit endvisit enum constant declaration enumconstantdeclaration node f current fcurrent has invocations hasinvocations result node f current fcurrent end visit body declaration endvisitbodydeclaration override visit method invocation methodinvocation node node resolve type binding resolvetypebinding matches node resolve method binding resolvemethodbinding f current fcurrent f current fcurrent add invocation addinvocation node override visit super method invocation supermethodinvocation node matches node get name getname resolve binding resolvebinding f current fcurrent f current fcurrent add invocation addinvocation node override visit constructor invocation constructorinvocation node matches node resolve constructor binding resolveconstructorbinding f current fcurrent f current fcurrent add invocation addinvocation node override visit class instance creation classinstancecreation node matches node resolve constructor binding resolveconstructorbinding f current fcurrent f current fcurrent add invocation addinvocation node override visit type declaration typedeclaration node visit type visittype override end visit endvisit type declaration typedeclaration node end visit body declaration endvisitbodydeclaration override visit enum declaration enumdeclaration node visit type visittype override end visit endvisit enum declaration enumdeclaration node end visit body declaration endvisitbodydeclaration override visit annotation type declaration annotationtypedeclaration node visit type visittype override end visit endvisit annotation type declaration annotationtypedeclaration node end visit body declaration endvisitbodydeclaration visit type visittype f bodies fbodies add f current fcurrent f current fcurrent visit non type body declaration visitnontypebodydeclaration f bodies fbodies add f current fcurrent f current fcurrent body data bodydata end visit body declaration endvisitbodydeclaration f current fcurrent f bodies fbodies remove f bodies fbodies size override visit field declaration fielddeclaration node visit non type body declaration visitnontypebodydeclaration override end visit endvisit field declaration fielddeclaration node f current fcurrent has invocations hasinvocations result node f current fcurrent end visit body declaration endvisitbodydeclaration override visit method declaration methoddeclaration node visit non type body declaration visitnontypebodydeclaration override end visit endvisit method declaration methoddeclaration node f current fcurrent has invocations hasinvocations result node f current fcurrent end visit body declaration endvisitbodydeclaration override visit initializer node visit non type body declaration visitnontypebodydeclaration override end visit endvisit initializer node f current fcurrent has invocations hasinvocations result node f current fcurrent end visit body declaration endvisitbodydeclaration matches i binding ibinding binding binding i method binding imethodbinding f binding fbinding is equal to isequalto i method binding imethodbinding binding get method declaration getmethoddeclaration local type target provider localtypetargetprovider target provider targetprovider i compilation unit icompilationunit fcunit method declaration methoddeclaration f declaration fdeclaration map body declaration bodydeclaration body data bodydata f bodies fbodies local type target provider localtypetargetprovider i compilation unit icompilationunit unit method declaration methoddeclaration declaration is not null isnotnull unit is not null isnotnull declaration fcunit unit f declaration fdeclaration declaration override initialize i method binding imethodbinding method binding methodbinding f declaration fdeclaration resolve binding resolvebinding invocation finder invocationfinder finder ast node astnode type ast nodes astnodes get parent getparent f declaration fdeclaration abstract type declaration abstracttypedeclaration method binding methodbinding get declaring class getdeclaringclass is anonymous isanonymous finder invocation finder invocationfinder method binding methodbinding type accept finder scope local enclosing block ast node astnode block type get parent getparent get parent getparent finder invocation finder invocationfinder method binding methodbinding override visit block node visit non type body declaration visitnontypebodydeclaration override end visit endvisit block node f current fcurrent has invocations hasinvocations result body declaration bodydeclaration ast nodes astnodes get parent getparent node body declaration bodydeclaration f current fcurrent end visit body declaration endvisitbodydeclaration block accept finder f bodies fbodies finder result override i compilation unit icompilationunit get affected compilation units getaffectedcompilationunits refactoring status refactoringstatus status references in binary context referencesinbinarycontext binary refs binaryrefs i progress monitor iprogressmonitor fast done fastdone i compilation unit icompilationunit fcunit override body declaration bodydeclaration get affected body declarations getaffectedbodydeclarations i compilation unit icompilationunit unit i progress monitor iprogressmonitor is true istrue unit fcunit body declaration bodydeclaration result f bodies fbodies key set keyset fast done fastdone result to array toarray body declaration bodydeclaration result size override ast node astnode get invocations getinvocations body declaration bodydeclaration declaration i progress monitor iprogressmonitor body data bodydata data f bodies fbodies declaration is not null isnotnull data fast done fastdone data get invocations getinvocations override refactoring status refactoringstatus check activation checkactivation java model exception javamodelexception refactoring status refactoringstatus override get status severity getstatusseverity refactoring status refactoringstatus error member type target provider membertypetargetprovider target provider targetprovider i method binding imethodbinding f method binding fmethodbinding map body declaration bodydeclaration body data bodydata f current bodies fcurrentbodies member type target provider membertypetargetprovider i method binding imethodbinding method binding methodbinding is not null isnotnull method binding methodbinding f method binding fmethodbinding method binding methodbinding override initialize override i compilation unit icompilationunit get affected compilation units getaffectedcompilationunits refactoring status refactoringstatus status references in binary context referencesinbinarycontext binary refs binaryrefs i progress monitor iprogressmonitor core exception coreexception i method imethod method i method imethod f method binding fmethodbinding get java element getjavaelement is true istrue method search pattern searchpattern pattern search pattern searchpattern create pattern createpattern method i java search constants ijavasearchconstants references search utils searchutils generics agnostic match rule i java search scope ijavasearchscope scope refactoring scope factory refactoringscopefactory create method hash set hashset i compilation unit icompilationunit affected compilation units affectedcompilationunits hash set hashset collecting search requestor collectingsearchrequestor requestor collecting search requestor collectingsearchrequestor binary refs binaryrefs i compilation unit icompilationunit f last u flastcu override accept search match acceptsearchmatch search match searchmatch match core exception coreexception filter match filtermatch match match is inside doc comment isinsidedoccomment todo warn user references in binary context referencesinbinarycontext i compilation unit icompilationunit unit search utils searchutils get compilation unit getcompilationunit match match get acc uracy getaccuracy search match searchmatch inaccurate unit status add error adderror refactoring core messages refactoringcoremessages target provider targetprovider inaccurate match java status context javastatuscontext create unit source range sourcerange match get offset getoffset match get length getlength status add error adderror refactoring core messages refactoringcoremessages target provider targetprovider inaccurate match unit unit equals f last u flastcu f last u flastcu unit affected compilation units affectedcompilationunits add unit search engine searchengine search pattern search utils searchutils get default search participants getdefaultsearchparticipants scope requestor sub progress monitor subprogressmonitor affected compilation units affectedcompilationunits to array toarray i compilation unit icompilationunit affected compilation units affectedcompilationunits size override body declaration bodydeclaration get affected body declarations getaffectedbodydeclarations i compilation unit icompilationunit unit i progress monitor iprogressmonitor ast node astnode root sharedastprovider getast unit sharedastprovider wait invocation finder invocationfinder finder invocation finder invocationfinder f method binding fmethodbinding root accept finder f current bodies fcurrentbodies finder result body declaration bodydeclaration result f current bodies fcurrentbodies key set keyset fast done fastdone result to array toarray body declaration bodydeclaration result size override ast node astnode get invocations getinvocations body declaration bodydeclaration declaration i progress monitor iprogressmonitor body data bodydata data f current bodies fcurrentbodies declaration is not null isnotnull data fast done fastdone data get invocations getinvocations override refactoring status refactoringstatus check activation checkactivation java model exception javamodelexception refactoring status refactoringstatus override get status severity getstatusseverity refactoring status refactoringstatus error