copyright ibm corporation rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors ibm corporation initial api implementation org eclipse jdt internal text correction java util array list arraylist java util iterator java util list org eclipse core runtime core exception coreexception org eclipse jdt core i compilation unit icompilationunit org eclipse jdt core dom ast org eclipse jdt core dom ast node astnode org eclipse jdt core dom assignment org eclipse jdt core dom block org eclipse jdt core dom body declaration bodydeclaration org eclipse jdt core dom compilation unit compilationunit org eclipse jdt core dom expression org eclipse jdt core dom i extended modifier iextendedmodifier org eclipse jdt core dom i type binding itypebinding org eclipse jdt core dom i variable binding ivariablebinding org eclipse jdt core dom modifier org eclipse jdt core dom simple name simplename org eclipse jdt core dom single variable declaration singlevariabledeclaration org eclipse jdt core dom statement org eclipse jdt core dom switch statement switchstatement org eclipse jdt core dom this expression thisexpression org eclipse jdt core dom type org eclipse jdt core dom variable declaration variabledeclaration org eclipse jdt core dom variable declaration expression variabledeclarationexpression org eclipse jdt core dom variable declaration fragment variabledeclarationfragment org eclipse jdt core dom variable declaration statement variabledeclarationstatement org eclipse jdt core dom rewrite ast rewrite astrewrite org eclipse jdt core dom rewrite i tracked node position itrackednodeposition org eclipse jdt core dom rewrite import rewrite importrewrite org eclipse jdt core dom rewrite import rewrite importrewrite import rewrite context importrewritecontext org eclipse jdt core dom rewrite list rewrite listrewrite org eclipse jdt internal corext code manipulation codemanipulation context sensitive import rewrite context contextsensitiveimportrewritecontext org eclipse jdt internal corext code manipulation codemanipulation stub utility stubutility org eclipse jdt internal corext dom ast nodes astnodes org eclipse jdt internal corext dom generic visitor genericvisitor org eclipse jdt internal corext dom local variable index localvariableindex org eclipse jdt internal corext dom modifier rewrite modifierrewrite org eclipse jdt internal corext dom selection org eclipse jdt internal corext dom variable declaration rewrite variabledeclarationrewrite org eclipse jdt internal corext refactoring code flow flow context flowcontext org eclipse jdt internal corext refactoring code flow flow info flowinfo org eclipse jdt internal corext refactoring code flow in out flow analyzer inoutflowanalyzer org eclipse jdt internal corext refactoring surround surround with analyzer surroundwithanalyzer org eclipse jdt sharedastprovider org eclipse jdt text java i invocation context iinvocationcontext surround with surroundwith split selected operator splitselectedoperator i split operation isplitoperation list variable declaration variabledeclaration f accessed inside faccessedinside list ast node astnode f statements fstatements list variable declaration fragment variabledeclarationfragment f accessed after faccessedafter ast rewrite astrewrite f rewrite frewrite list rewrite listrewrite f block rewrite fblockrewrite variable declaration statement variabledeclarationstatement f last statement flaststatement split selected operator splitselectedoperator list variable declaration variabledeclaration list variable declaration fragment variabledeclarationfragment list rewrite listrewrite block rewrite blockrewrite ast rewrite astrewrite rewrite list ast node astnode statements f accessed inside faccessedinside f statements fstatements statements f accessed after faccessedafter f rewrite frewrite rewrite f block rewrite fblockrewrite block rewrite blockrewrite override needs split needssplit variable declaration fragment variabledeclarationfragment variable declaration fragment variabledeclarationfragment current f accessed inside faccessedinside f accessed inside faccessedinside current f accessed after faccessedafter f accessed after faccessedafter current override initialize statement initializestatement variable declaration statement variabledeclarationstatement statement variable declaration fragment variabledeclarationfragment current f accessed after faccessedafter current f accessed inside faccessedinside current make final makefinal statement f rewrite frewrite handle initializer handleinitializer current f last statement flaststatement f block rewrite fblockrewrite insert after insertafter statement f last statement flaststatement f last statement flaststatement statement f last statement flaststatement handle new statement handlenewstatement statement handle statement handlestatement statement f last statement flaststatement statement handle statement handlestatement statement statement f statements fstatements add f rewrite frewrite create move target createmovetarget statement handle new statement handlenewstatement statement statement f statements fstatements add statement handle initializer handleinitializer variable declaration fragment variabledeclarationfragment fragment split off initializer splitoffinitializer f statements fstatements fragment f rewrite frewrite split unselected operator splitunselectedoperator i split operation isplitoperation list variable declaration variabledeclaration f accessed inside faccessedinside list rewrite listrewrite f block rewrite fblockrewrite ast rewrite astrewrite f rewrite frewrite variable declaration statement variabledeclarationstatement f last statement flaststatement split unselected operator splitunselectedoperator list variable declaration variabledeclaration accessed inside accessedinside list rewrite listrewrite block rewrite blockrewrite ast rewrite astrewrite rewrite f accessed inside faccessedinside accessed inside accessedinside f block rewrite fblockrewrite block rewrite blockrewrite f rewrite frewrite rewrite f last statement flaststatement override needs split needssplit variable declaration fragment variabledeclarationfragment variable declaration fragment variabledeclarationfragment current f accessed inside faccessedinside f accessed inside faccessedinside current override initialize statement initializestatement variable declaration statement variabledeclarationstatement statement variable declaration fragment variabledeclarationfragment current f accessed inside faccessedinside current make final makefinal statement f rewrite frewrite f last statement flaststatement f block rewrite fblockrewrite insert after insertafter statement f last statement flaststatement f last statement flaststatement statement i split operation isplitoperation needs split needssplit variable declaration fragment variabledeclarationfragment variable declaration fragment variabledeclarationfragment current initialize statement initializestatement variable declaration statement variabledeclarationstatement statement variable declaration fragment variabledeclarationfragment current compilation unit compilationunit f root node frootnode ast node astnode f selected nodes fselectednodes f is new context fisnewcontext i tracked node position itrackednodeposition f first inserted position ffirstinsertedposition i tracked node position itrackednodeposition f last inserted position flastinsertedposition surround with surroundwith compilation unit compilationunit root ast node astnode selected nodes selectednodes f root node frootnode root f selected nodes fselectednodes selected nodes selectednodes is applicable isapplicable i invocation context iinvocationcontext context core exception coreexception i compilation unit icompilationunit unit context get compilation unit getcompilationunit compilation unit compilationunit ast sharedastprovider getast unit sharedastprovider wait ast selection selection selection create from start length createfromstartlength context get selection offset getselectionoffset context get selection length getselectionlength surround with analyzer surroundwithanalyzer analyzer surround with analyzer surroundwithanalyzer unit selection context getastroot accept analyzer analyzer get status getstatus isok analyzer has selected nodes hasselectednodes selected nodes code context code code selection code valid selection param context context proposal applied selected nodes valid selection core exception coreexception analyzer created ast node astnode get valid selected nodes getvalidselectednodes i invocation context iinvocationcontext context core exception coreexception selection selection selection create from start length createfromstartlength context get selection offset getselectionoffset context get selection length getselectionlength surround with analyzer surroundwithanalyzer analyzer surround with analyzer surroundwithanalyzer context get compilation unit getcompilationunit selection context getastroot accept analyzer analyzer get status getstatus isok analyzer has selected nodes hasselectednodes analyzer get valid selected nodes getvalidselectednodes get body start getbodystart f first inserted position ffirstinsertedposition get start position getstartposition get body length getbodylength f last inserted position flastinsertedposition get start position getstartposition f last inserted position flastinsertedposition get length getlength get body start getbodystart returns rewriter returns rewriter core exception coreexception core exception thrown created ast rewrite astrewrite get rewrite getrewrite core exception coreexception ast node astnode selected nodes selectednodes f selected nodes fselectednodes ast ast get ast getast ast rewrite astrewrite rewrite ast rewrite astrewrite create ast body declaration bodydeclaration enclosing body declaration enclosingbodydeclaration body declaration bodydeclaration ast nodes astnodes get parent getparent selected nodes selectednodes body declaration bodydeclaration max variable id maxvariableid local variable index localvariableindex perform enclosing body declaration enclosingbodydeclaration f is new context fisnewcontext is new context isnewcontext list variable declaration fragment variabledeclarationfragment accessed after accessedafter get variable declarations accessed after getvariabledeclarationsaccessedafter selected nodes selectednodes selected nodes selectednodes length max variable id maxvariableid list variable declaration variabledeclaration read inside readinside read inside readinside get variable declaration reads inside getvariabledeclarationreadsinside selected nodes selectednodes max variable id maxvariableid list ast node astnode inserted array list arraylist move to block movetoblock selected nodes selectednodes inserted accessed after accessedafter read inside readinside rewrite f is new context fisnewcontext import rewrite importrewrite import rewrite importrewrite stub utility stubutility create import rewrite createimportrewrite compilation unit compilationunit selected nodes selectednodes get root getroot import rewrite context importrewritecontext import rewrite context importrewritecontext context sensitive import rewrite context contextsensitiveimportrewritecontext selected nodes selectednodes import rewrite importrewrite selected nodes selectednodes length qualify this expressions qualifythisexpressions selected nodes selectednodes rewrite import rewrite importrewrite import rewrite context importrewritecontext selected nodes selectednodes length ast nodes astnodes is control statement body iscontrolstatementbody selected nodes selectednodes get location in parent getlocationinparent block wrap ast new block newblock rewrite replace selected nodes selectednodes wrap list rewrite listrewrite list rewrite listrewrite rewrite get list rewrite getlistrewrite wrap block statements property iterator ast node astnode iterator inserted iterator iterator has next hasnext ast node astnode node iterator list rewrite listrewrite insert last insertlast node list rewrite listrewrite list rewrite listrewrite get list rewrite getlistrewrite selected nodes selectednodes rewrite ast node astnode current selected nodes selectednodes selected nodes selectednodes length iterator ast node astnode iterator inserted iterator iterator has next hasnext ast node astnode node iterator list rewrite listrewrite insert after insertafter node current current node f first inserted position ffirstinsertedposition rewrite track inserted f last inserted position flastinsertedposition rewrite track inserted inserted size rewrite code moved context is new context isnewcontext list variable declaration variabledeclaration variables read code selected nodes selectednodes code param max variable id maxvariableid maximum number variable declarations block param selected nodes selectednodes selected nodes selectednodes list variable declaration variabledeclaration list variable declaration variabledeclaration get variable declaration reads inside getvariabledeclarationreadsinside ast node astnode selected nodes selectednodes max variable id maxvariableid array list arraylist variable declaration variabledeclaration result array list arraylist f is new context fisnewcontext result i variable binding ivariablebinding reads get reads getreads selected nodes selectednodes max variable id maxvariableid reads length i variable binding ivariablebinding read reads read is field isfield ast node astnode read decl readdecl get root node getrootnode find declaring node finddeclaringnode read read decl readdecl variable declaration variabledeclaration result add variable declaration variabledeclaration read decl readdecl result list variable declaration fragments variabledeclarationfragments accessed code start node startnode code param start node startnode node inspect param max variable id maxvariableid maximum number variable declarations list variable declaration fragments variabledeclarationfragments moved block list variable declaration fragment variabledeclarationfragment get variable declarations accessed after getvariabledeclarationsaccessedafter ast node astnode start node startnode max variable id maxvariableid list statement statements start node startnode get location in parent getlocationinparent switch statement switchstatement statements property switch statement switchstatement block switch statement switchstatement ast nodes astnodes get parent getparent start node startnode switch statement switchstatement statements block statements block block block ast nodes astnodes get parent getparent start node startnode block statements block statements list statement body after selection bodyafterselection statements sub list sublist statements index of indexof start node startnode statements size list variable declaration fragment variabledeclarationfragment result array list arraylist body after selection bodyafterselection is empty isempty i variable binding ivariablebinding accesses get acc esses getaccesses body after selection bodyafterselection to array toarray ast node astnode body after selection bodyafterselection size max variable id maxvariableid accesses length i variable binding ivariablebinding cur var curvar accesses cur var curvar is field isfield ast node astnode read decl readdecl ast nodes astnodes find declaration finddeclaration cur var curvar get root node getrootnode read decl readdecl variable declaration fragment variabledeclarationfragment result add variable declaration fragment variabledeclarationfragment read decl readdecl result param region region inspect param max variable id maxvariableid max number variables region variables read access region i variable binding ivariablebinding get reads getreads ast node astnode region max variable id maxvariableid flow context flowcontext flow context flowcontext flow context flowcontext max variable id maxvariableid flow context flowcontext set consider access mode setconsideraccessmode flow context flowcontext set compute mode setcomputemode flow context flowcontext arguments flow info flowinfo arg info arginfo in out flow analyzer inoutflowanalyzer flow context flowcontext perform region i variable binding ivariablebinding reads arg info arginfo flow context flowcontext flow info flowinfo read flow info flowinfo read potential flow info flowinfo unknown reads param region region inspect param max variable id maxvariableid max number variables region variables read write access region i variable binding ivariablebinding get acc esses getaccesses ast node astnode region max variable id maxvariableid flow context flowcontext flow context flowcontext flow context flowcontext max variable id maxvariableid flow context flowcontext set consider access mode setconsideraccessmode flow context flowcontext set compute mode setcomputemode flow context flowcontext arguments flow info flowinfo arg info arginfo in out flow analyzer inoutflowanalyzer flow context flowcontext perform region i variable binding ivariablebinding vars accessed after varsaccessedafter arg info arginfo flow context flowcontext flow info flowinfo read flow info flowinfo read potential flow info flowinfo write flow info flowinfo write potential flow info flowinfo unknown vars accessed after varsaccessedafter moves nodes to move tomove code block code variable declaration fragments variabledeclarationfragments code accessed after accessedafter code initializers variable declarations code accessed after accessedafter code moved block variable declaration code to move tomove code variable declarations variabledeclarations code accessed inside accessedinside code moved code block code code code element code accessed after accessedafter code code code code code code code declarations fragments splited required code code code code param to move tomove nodes moved block param statements list move param accessed after accessedafter variable declaration fragments variabledeclarationfragments moved block param accessed inside accessedinside variable declaration variabledeclaration param rewrite rewrite move to block movetoblock ast node astnode to move tomove list ast node astnode statements list variable declaration fragment variabledeclarationfragment accessed after accessedafter list variable declaration variabledeclaration accessed inside accessedinside ast rewrite astrewrite rewrite to move tomove length ast node astnode node to move tomove node variable declaration statement variabledeclarationstatement variable declaration statement variabledeclarationstatement statement variable declaration statement variabledeclarationstatement node list rewrite listrewrite block rewrite blockrewrite get list rewrite getlistrewrite statement rewrite split variable declaration statement splitvariabledeclarationstatement statement create split selected operator createsplitselectedoperator accessed after accessedafter accessed inside accessedinside rewrite statements block rewrite blockrewrite rewrite iterator variable declaration fragment variabledeclarationfragment iter statement fragments iterator iter has next hasnext accessed inside accessedinside remove iter insert node at end insertnodeatend rewrite statements node accessed inside accessedinside is empty isempty variable declaration variabledeclaration variable declaration variabledeclaration accessed inside accessedinside variable declaration variabledeclaration single variable declaration singlevariabledeclaration ast nodes astnodes find modifier node findmodifiernode modifier ast nodes astnodes get modifiers getmodifiers variable declaration variabledeclaration modifier rewrite modifierrewrite create rewrite variable declaration variabledeclaration set modifiers setmodifiers modifier modifier accessed inside accessedinside remove variable declaration variabledeclaration get parent getparent variable declaration statement variabledeclarationstatement variable declaration statement variabledeclarationstatement statement variable declaration statement variabledeclarationstatement variable declaration variabledeclaration get parent getparent list rewrite listrewrite block rewrite blockrewrite get list rewrite getlistrewrite statement rewrite split variable declaration statement splitvariabledeclarationstatement statement create split unselected operator createsplitunselectedoperator accessed inside accessedinside rewrite block rewrite blockrewrite rewrite iterator variable declaration fragment variabledeclarationfragment iter statement fragments iterator iter has next hasnext variable declaration fragment variabledeclarationfragment fragment iter accessed inside accessedinside remove fragment variable declaration variabledeclaration get parent getparent variable declaration expression variabledeclarationexpression variable declaration expression variabledeclarationexpression expression variable declaration expression variabledeclarationexpression variable declaration variabledeclaration get parent getparent variable declaration rewrite variabledeclarationrewrite rewrite modifiers rewritemodifiers expression modifier rewrite iterator variable declaration fragment variabledeclarationfragment iter expression fragments iterator iter has next hasnext variable declaration fragment variabledeclarationfragment fragment iter accessed inside accessedinside remove fragment insert node at end insertnodeatend ast rewrite astrewrite rewrite list ast node astnode statements ast node astnode node statements add rewrite create move target createmovetarget node i split operation isplitoperation create split unselected operator createsplitunselectedoperator list variable declaration variabledeclaration accessed inside accessedinside ast rewrite astrewrite rewrite list rewrite listrewrite block rewrite blockrewrite split unselected operator splitunselectedoperator accessed inside accessedinside block rewrite blockrewrite rewrite i split operation isplitoperation create split selected operator createsplitselectedoperator list variable declaration fragment variabledeclarationfragment accessed after accessedafter list variable declaration variabledeclaration accessed inside accessedinside ast rewrite astrewrite rewrite list ast node astnode statements list rewrite listrewrite block rewrite blockrewrite split selected operator splitselectedoperator accessed inside accessedinside accessed after accessedafter block rewrite blockrewrite rewrite statements split fragments code statement code multiple variable declaration statements variabledeclarationstatements code split operator splitoperator needs split needssplit code returns code code split operator splitoperator needs split needssplit param statement variable declaration statement variabledeclarationstatement split param split operator splitoperator split param rewrite rewriter generate variable declaration statements variabledeclarationstatements split variable declaration statement splitvariabledeclarationstatement variable declaration statement variabledeclarationstatement statement i split operation isplitoperation split operator splitoperator ast rewrite astrewrite rewrite list variable declaration fragment variabledeclarationfragment fragments statement fragments iterator variable declaration fragment variabledeclarationfragment iter fragments iterator variable declaration fragment variabledeclarationfragment last fragment lastfragment iter variable declaration statement variabledeclarationstatement last statement laststatement statement split operator splitoperator initialize statement initializestatement last statement laststatement last fragment lastfragment list rewrite listrewrite fragments rewrite fragmentsrewrite iter has next hasnext variable declaration fragment variabledeclarationfragment current fragment currentfragment iter split operator splitoperator needs split needssplit last fragment lastfragment current fragment currentfragment variable declaration statement variabledeclarationstatement new statement newstatement get ast getast new variable declaration statement newvariabledeclarationstatement variable declaration fragment variabledeclarationfragment rewrite create move target createmovetarget current fragment currentfragment list rewrite listrewrite modifier rewrite modifierrewrite rewrite get list rewrite getlistrewrite new statement newstatement variable declaration statement variabledeclarationstatement modifiers property iterator i extended modifier iextendedmodifier iterator statement modifiers iterator iterator has next hasnext modifier rewrite modifierrewrite insert last insertlast rewrite create copy target createcopytarget ast node astnode iterator new statement newstatement set type settype type rewrite create copy target createcopytarget statement get type gettype split operator splitoperator initialize statement initializestatement new statement newstatement current fragment currentfragment fragments rewrite fragmentsrewrite rewrite get list rewrite getlistrewrite new statement newstatement variable declaration statement variabledeclarationstatement fragments property last statement laststatement new statement newstatement fragments rewrite fragmentsrewrite ast node astnode fragment rewrite create move target createmovetarget current fragment currentfragment fragments rewrite fragmentsrewrite insert last insertlast fragment last fragment lastfragment current fragment currentfragment statement param statement statment param rewrite ast rewrite make final makefinal variable declaration statement variabledeclarationstatement statement ast rewrite astrewrite rewrite variable declaration variabledeclaration fragment variable declaration variabledeclaration statement fragments ast nodes astnodes find modifier node findmodifiernode modifier ast nodes astnodes get modifiers getmodifiers fragment modifier rewrite modifierrewrite create rewrite statement set modifiers setmodifiers modifier modifier qualify this expressions qualifythisexpressions ast node astnode node ast rewrite astrewrite rewrite import rewrite importrewrite import rewrite importrewrite import rewrite context importrewritecontext import rewrite context importrewritecontext node accept generic visitor genericvisitor override visit this expression thisexpression this expr thisexpr this expr thisexpr get qualifier getqualifier i type binding itypebinding type binding typebinding this expr thisexpr resolve type binding resolvetypebinding type binding typebinding string type name typename import rewrite importrewrite add import addimport type binding typebinding get type declaration gettypedeclaration import rewrite context importrewritecontext simple name simplename simple name simplename this expr thisexpr getast new simple name newsimplename type name typename rewrite this expr thisexpr this expression thisexpression qualifier property simple name simplename visit this expr thisexpr split initializer code fragment code add expression code statements code param statements expression param fragment fragment split param rewrite rewrite split off initializer splitoffinitializer list ast node astnode statements variable declaration fragment variabledeclarationfragment fragment ast rewrite astrewrite rewrite expression initializer fragment get initializer getinitializer initializer ast ast rewrite getast assignment assignment ast new assignment newassignment assignment set left hand side setlefthandside expression rewrite create copy target createcopytarget fragment get name getname assignment set right hand side setrighthandside expression rewrite create move target createmovetarget initializer statements add ast new expression statement newexpressionstatement assignment list rewrite statement sequence node element param node ast node param rewrite ast rewrite list rewrite list rewrite listrewrite get list rewrite getlistrewrite ast node astnode node ast rewrite astrewrite rewrite node get location in parent getlocationinparent switch statement switchstatement statements property ast node astnode block ast nodes astnodes get parent getparent node switch statement switchstatement rewrite get list rewrite getlistrewrite block switch statement switchstatement statements property ast node astnode block ast nodes astnodes get parent getparent node block rewrite get list rewrite getlistrewrite block block statements property ast get ast getast get root node getrootnode getast compilation unit compilationunit get root node getrootnode f selected nodes fselectednodes length compilation unit compilationunit f selected nodes fselectednodes get root getroot f root node frootnode