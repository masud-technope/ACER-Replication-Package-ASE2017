copyright ibm corporation rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors ibm corporation initial api implementation org eclipse jdt internal corext refactoring generics java util array list arraylist java util arrays java util collection java util collections java util comparator java util hash set hashset java util iterator java util linked hash map linkedhashmap java util linked list linkedlist java util list java util map org eclipse core runtime i progress monitor iprogressmonitor org eclipse core runtime operation canceled exception operationcanceledexception org eclipse core runtime sub progress monitor subprogressmonitor org eclipse jdt core java model exception javamodelexception org eclipse jdt internal corext refactoring type constraints typeconstraints types array type arraytype org eclipse jdt internal corext refactoring type constraints typeconstraints types hierarchy type hierarchytype org eclipse jdt internal corext refactoring type constraints typeconstraints types t type ttype org eclipse jdt internal corext refactoring type constraints typeconstraints types ets typesets enum erated type set enumeratedtypeset org eclipse jdt internal corext refactoring type constraints typeconstraints types ets typesets singleton type set singletontypeset org eclipse jdt internal corext refactoring type constraints typeconstraints types ets typesets type set typeset org eclipse jdt internal corext refactoring type constraints typeconstraints types ets typesets type set environment typesetenvironment org eclipse jdt internal corext refactoring type constraints typeconstraints array element variable arrayelementvariable org eclipse jdt internal corext refactoring type constraints typeconstraints array type variable arraytypevariable org eclipse jdt internal corext refactoring type constraints typeconstraints cast variable castvariable org eclipse jdt internal corext refactoring type constraints typeconstraints collection element variable collectionelementvariable org eclipse jdt internal corext refactoring type constraints typeconstraints constraint variable constraintvariable org eclipse jdt internal corext refactoring type constraints typeconstraints i type constraint itypeconstraint org eclipse jdt internal corext refactoring type constraints typeconstraints independent type variable independenttypevariable org eclipse jdt internal corext refactoring type constraints typeconstraints t types ttypes org eclipse jdt internal corext refactoring type constraints typeconstraints type equivalence set typeequivalenceset infer type arguments constraints solver infertypeargumentsconstraintssolver t type comparator ttypecomparator comparator t type ttype override compare t type ttype t type ttype get pretty signature getprettysignature compare to compareto get pretty signature getprettysignature t type comparator ttypecomparator instance t type comparator ttypecomparator nls string chosen type chosen type chosentype infer type arguments model infertypeargumentstcmodel ftcmodel type set environment typesetenvironment f type set environment ftypesetenvironment work list type constraint solver hold nodes constraint graph remain processed entries code constraint variable constraintvariable code linked list linkedlist constraint variable constraintvariable f work list fworklist infer type arguments update infertypeargumentsupdate f update fupdate infer type arguments constraints solver infertypeargumentsconstraintssolver infer type arguments model infertypeargumentstcmodel type constraint factory typeconstraintfactory ftcmodel type constraint factory typeconstraintfactory f work list fworklist linked list linkedlist infer type arguments update infertypeargumentsupdate solve constraints solveconstraints i progress monitor iprogressmonitor nls begin task begintask f update fupdate infer type arguments update infertypeargumentsupdate constraint variable constraintvariable all constraint variables allconstraintvariables ftcmodel get all constraint variables getallconstraintvariables all constraint variables allconstraintvariables length f update fupdate f type set environment ftypesetenvironment type set environment typesetenvironment ftcmodel get type environment gettypeenvironment parametric structure computer parametricstructurecomputer param etric structure computer parametricstructurecomputer parametric structure computer parametricstructurecomputer all constraint variables allconstraintvariables ftcmodel collection collection element variable collectionelementvariable new vars newvars param etric structure computer parametricstructurecomputer create elem constraint variables createelemconstraintvariables array list arraylist constraint variable constraintvariable new all constraint variables newallconstraintvariables array list arraylist new all constraint variables newallconstraintvariables add all addall arrays as list aslist all constraint variables allconstraintvariables new all constraint variables newallconstraintvariables add all addall new vars newvars all constraint variables allconstraintvariables new all constraint variables newallconstraintvariables to array toarray constraint variable constraintvariable new all constraint variables newallconstraintvariables size loop type equivalence sets typeequivalencesets unify elements f elem structure env felemstructureenv existing type equivalence sets typeequivalencesets hash set hashset type equivalence set typeequivalenceset all type equivalence sets alltypeequivalencesets hash set hashset all constraint variables allconstraintvariables length type equivalence set typeequivalenceset type equivalence set typeequivalenceset all constraint variables allconstraintvariables get type equivalence set gettypeequivalenceset type equivalence set typeequivalenceset all type equivalence sets alltypeequivalencesets add type equivalence set typeequivalenceset iterator type equivalence set typeequivalenceset iter all type equivalence sets alltypeequivalencesets iterator iter has next hasnext type equivalence set typeequivalenceset type equivalence set typeequivalenceset iter constraint variable constraintvariable contributing variables contributingvariables type equivalence set typeequivalenceset get contributing variables getcontributingvariables contributing variables contributingvariables length contributing variables contributingvariables length constraint variable constraintvariable contributing variables contributingvariables constraint variable constraintvariable contributing variables contributingvariables recursively ftcmodel create element equals constraints createelementequalsconstraints recursively recursively i type constraint itypeconstraint all type constraints alltypeconstraints ftcmodel get all type constraints getalltypeconstraints all type constraints alltypeconstraints length i type constraint itypeconstraint type constraint typeconstraint all type constraints alltypeconstraints ftcmodel create element equals constraints createelementequalsconstraints type constraint typeconstraint get left getleft type constraint typeconstraint get right getright initialize type estimates initializetypeestimates all constraint variables allconstraintvariables is canceled iscanceled operation canceled exception operationcanceledexception f work list fworklist add all addall arrays as list aslist all constraint variables allconstraintvariables run solver runsolver sub progress monitor subprogressmonitor choose types choosetypes all constraint variables allconstraintvariables sub progress monitor subprogressmonitor find c asts to remove findcaststoremove ftcmodel get cast variables getcastvariables f update fupdate initialize type estimates initializetypeestimates constraint variable constraintvariable all constraint variables allconstraintvariables all constraint variables allconstraintvariables length constraint variable constraintvariable all constraint variables allconstraintvariables todo types type constraint typeconstraint type collection element variable collectionelementvariable todo handle nested element variables parametric structure computer parametricstructurecomputer create and init vars createandinitvars type equivalence set typeequivalenceset get type equivalence set gettypeequivalenceset type equivalence set typeequivalenceset set type estimate settypeestimate create initial estimate createinitialestimate set type equivalence set settypeequivalenceset type set typeset type estimate typeestimate type set typeset get type estimate gettypeestimate type estimate typeestimate constraint variable constraintvariable cvs get contributing variables getcontributingvariables type estimate typeestimate f type set environment ftypesetenvironment get universe type set getuniversetypeset todo optimize find immutable universe todo optimize find immutable universe cvs length todo optimize find immutable universe type estimate typeestimate type estimate typeestimate int ersected with intersectedwith create initial estimate createinitialestimate cvs set type estimate settypeestimate type estimate typeestimate type set typeset create initial estimate createinitialestimate constraint variable constraintvariable todo check assumption immutable cv s cvs type parametric structure parametricstructure param etric structure parametricstructure f elem structure env felemstructureenv elem structure elemstructure param etric structure parametricstructure param etric structure parametricstructure parametric structure computer parametricstructurecomputer parametric structure parametricstructure sub types of singleton subtypesofsingleton create param etric structure parametricstructure get base getbase t type ttype type get type gettype type f type set environment ftypesetenvironment get universe type set getuniversetypeset independent type variable independenttypevariable f type set environment ftypesetenvironment get universe type set getuniversetypeset todo solve problem recursive bounds type variable typevariable type variable typevariable type t type ttype bounds get bounds getbounds type set typeset result sub types of singleton subtypesofsingleton create bounds get erasure geterasure bounds length result result int ersected with intersectedwith sub types of singleton subtypesofsingleton create bounds get erasure geterasure result array type variable arraytypevariable f type set environment ftypesetenvironment get universe type set getuniversetypeset array element variable arrayelementvariable get type gettype get type gettype is type variable istypevariable f type set environment ftypesetenvironment get universe type set getuniversetypeset singleton type set singletontypeset type f type set environment ftypesetenvironment type is void type isvoidtype f type set environment ftypesetenvironment get empty type set getemptytypeset singleton type set singletontypeset type f type set environment ftypesetenvironment run solver runsolver sub progress monitor subprogressmonitor nls begin task begintask f work list fworklist size f work list fworklist is empty isempty variable type estimate changed constraint variable constraintvariable f work list fworklist remove first removefirst list i type constraint itypeconstraint used in usedin ftcmodel get used in getusedin process constraints processconstraints used in usedin worked is canceled iscanceled operation canceled exception operationcanceledexception list code i type constraint itypeconstraint code refer code constraint variable constraintvariable code type bound changed process code i type constraint itypeconstraint code prop agating propagating type bound constraint needed param used in usedin code list code code i type constraint itypeconstraint code process process constraints processconstraints list i type constraint itypeconstraint used in usedin iterator i type constraint itypeconstraint iter used in usedin iterator iter has next hasnext i type constraint itypeconstraint iter main tain simple constraint maintainsimpleconstraint todo prune tcs pruned special loop constraint variables constraintvariables happen work list is constant constraint isconstantconstraint stc f type constraint factory ftypeconstraintfactory remove used in removeusedin stc changed cv changedcv main tain simple constraint maintainsimpleconstraint i type constraint itypeconstraint stc constraint variable constraintvariable left stc get left getleft constraint variable constraintvariable stc get right getright type equivalence set typeequivalenceset left set leftset left get type equivalence set gettypeequivalenceset type equivalence set typeequivalenceset right set rightset get type equivalence set gettypeequivalenceset type set typeset left estimate leftestimate type set typeset left set leftset get type estimate gettypeestimate type set typeset right estimate rightestimate type set typeset right set rightset get type estimate gettypeestimate left estimate leftestimate is universe isuniverse right estimate rightestimate is universe isuniverse left estimate leftestimate equals right estimate rightestimate type set typeset lhs super types lhssupertypes left estimate leftestimate super types supertypes type set typeset rhs sub types rhssubtypes right estimate rightestimate sub types subtypes rhs sub types rhssubtypes contains all containsall left estimate leftestimate type set typeset xsection left estimate leftestimate int ersected with intersectedwith rhs sub types rhssubtypes xsection is empty isempty bad happen illegal state exception illegalstateexception type estimate empty lhs left estimates left estimate leftestimate right estimate rightestimate nls nls nls nls left set leftset set type estimate settypeestimate xsection f work list fworklist add all addall arrays as list aslist left set leftset get contributing variables getcontributingvariables lhs super types lhssupertypes contains all containsall right estimate rightestimate type set typeset xsection right estimate rightestimate int ersected with intersectedwith lhs super types lhssupertypes xsection is empty isempty illegal state exception illegalstateexception type estimate empty rhs left estimates left estimate leftestimate right estimate rightestimate nls nls nls nls right set rightset set type estimate settypeestimate xsection f work list fworklist add all addall arrays as list aslist right set rightset get contributing variables getcontributingvariables choose types choosetypes constraint variable constraintvariable all constraint variables allconstraintvariables sub progress monitor subprogressmonitor nls begin task begintask all constraint variables allconstraintvariables length all constraint variables allconstraintvariables length constraint variable constraintvariable all constraint variables allconstraintvariables type equivalence set typeequivalenceset get type equivalence set gettypeequivalenceset todo happen iff unused constraint variables pruned todo calculate equivalence rep res entative equivalencerepresentative estimate type set typeset todo universe type set typeset t type ttype type choose single type choosesingletype type set typeset get type estimate gettypeestimate set chosen type setchosentype type collection element variable collectionelementvariable collection element variable collectionelementvariable element cv elementcv collection element variable collectionelementvariable f update fupdate add declaration adddeclaration element cv elementcv worked is canceled iscanceled operation canceled exception operationcanceledexception t type ttype choose single type choosesingletype type set typeset type estimate typeestimate type estimate typeestimate is universe isuniverse type estimate typeestimate is empty isempty type estimate typeestimate has unique lower bound hasuniquelowerbound type estimate typeestimate unique lower bound uniquelowerbound enum erated type set enumeratedtypeset lower bound lowerbound type estimate typeestimate lower bound lowerbound enum erate enumerate array list arraylist t type ttype interface candidates interfacecandidates iterator t type ttype iter lower bound lowerbound iterator iter has next hasnext t type ttype type iter type is interface isinterface type interface candidates interfacecandidates interface candidates interfacecandidates array list arraylist interface candidates interfacecandidates add type interface candidates interfacecandidates interface candidates interfacecandidates size interface candidates interfacecandidates size interface candidates interfacecandidates array list arraylist t type ttype non tag ging candidates nontaggingcandidates get non tag ging interfaces getnontagginginterfaces interface candidates interfacecandidates non tag ging candidates nontaggingcandidates size collections min non tag ging candidates nontaggingcandidates t type comparator ttypecomparator instance collections min interface candidates interfacecandidates t type comparator ttypecomparator instance max cache map t type ttype f interface tag ging cache finterfacetaggingcache linked hash map linkedhashmap t type ttype max cache serialversionuid override remove eldest entry removeeldestentry map entry t type ttype eldest size max cache array list arraylist t type ttype get non tag ging interfaces getnontagginginterfaces array list arraylist t type ttype interface candidates interfacecandidates array list arraylist t type ttype unresolved types unresolvedtypes array list arraylist array list arraylist t type ttype non tag ging nontagging array list arraylist interface candidates interfacecandidates size t type ttype int erf interf interface candidates interfacecandidates object is tag ging istagging f interface tag ging cache finterfacetaggingcache int erf interf is tag ging istagging unresolved types unresolvedtypes add int erf interf is tag ging istagging non tag ging nontagging add int erf interf unresolved types unresolvedtypes size t type ttype interfaces unresolved types unresolvedtypes to array toarray t type ttype unresolved types unresolvedtypes size interfaces length t type ttype int erf interf interfaces is tag ging interface istagginginterface int erf interf f interface tag ging cache finterfacetaggingcache int erf interf f interface tag ging cache finterfacetaggingcache int erf interf non tag ging nontagging add int erf interf non tag ging nontagging is tag ging interface istagginginterface t type ttype int erf interf int erf interf hierarchy type hierarchytype hierarchy type hierarchytype int erf interf get java element type getjavaelementtype get methods getmethods length java model exception javamodelexception find c asts to remove findcaststoremove cast variable castvariable cast variables castvariables cast variables castvariables length cast variable castvariable cast cv castcv cast variables castvariables constraint variable constraintvariable expression variable expressionvariable cast cv castcv get expression variable getexpressionvariable t type ttype chosen type chosentype infer type arguments constraints solver infertypeargumentsconstraintssolver get chosen type getchosentype expression variable expressionvariable t type ttype cast type casttype cast cv castcv get type gettype t type ttype expression type expressiontype expression variable expressionvariable get type gettype chosen type chosentype t types ttypes can assign to canassignto chosen type chosentype cast type casttype chosen type chosentype equals expression type expressiontype type changed don remove access visible members unify types conditional expressions f update fupdate add cast to remove addcasttoremove cast cv castcv bug expression variable expressionvariable array type variable arraytypevariable cast type casttype is array type isarraytype array element variable arrayelementvariable array element cv arrayelementcv ftcmodel get array element variable getarrayelementvariable expression variable expressionvariable array element cv arrayelementcv t type ttype chosen array element type chosenarrayelementtype infer type arguments constraints solver infertypeargumentsconstraintssolver get chosen type getchosentype array element cv arrayelementcv chosen array element type chosenarrayelementtype t types ttypes can assign to canassignto chosen array element type chosenarrayelementtype array type arraytype cast type casttype get component type getcomponenttype expression type expressiontype array type arraytype chosen array element type chosenarrayelementtype equals array type arraytype expression type expressiontype get component type getcomponenttype type changed don remove unify types conditional expressions f update fupdate add cast to remove addcasttoremove cast cv castcv t type ttype get chosen type getchosentype constraint variable constraintvariable t type ttype type t type ttype get data getdata chosen type type type type equivalence set typeequivalenceset get type equivalence set gettypeequivalenceset todo clean caching chosen type rep res entative representative restriction type equivalence set typeequivalenceset set type estimate settypeestimate type universe set typeuniverseset create set type equivalence set settypeequivalenceset get type estimate gettypeestimate choose single type choosesingletype set chosen type setchosentype constraint variable constraintvariable t type ttype type set data setdata chosen type type