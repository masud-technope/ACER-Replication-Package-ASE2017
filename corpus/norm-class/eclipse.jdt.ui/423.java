copyright ibm corporation rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors ibm corporation initial api implementation org eclipse ltk core refactoring tests resource java buffered reader bufferedreader java i o exception ioexception java input stream inputstream java input stream reader inputstreamreader java net uri java util array list arraylist java util hash set hashset java util list java util map java util org eclipse core commands execution exception executionexception org eclipse core commands operations i operation history ioperationhistory org eclipse core commands operations i undo context iundocontext org eclipse core commands operations operation history factory operationhistoryfactory org eclipse core file system filesystem efs org eclipse core file system filesystem i file store ifilestore org eclipse core file system filesystem uri util uriutil org eclipse core runtime core exception coreexception org eclipse core runtime i path ipath org eclipse core runtime i progress monitor iprogressmonitor org eclipse core runtime i status istatus org eclipse core runtime status org eclipse core resources i file ifile org eclipse core resources i folder ifolder org eclipse core resources i marker imarker org eclipse core resources i project iproject org eclipse core resources i resource iresource org eclipse core resources i workspace root iworkspaceroot org eclipse core resources resources plugin resourcesplugin org eclipse ltk core refactoring check conditions operation checkconditionsoperation org eclipse ltk core refactoring perform refactoring operation performrefactoringoperation org eclipse ltk core refactoring refactoring org eclipse ltk core refactoring refactoring contribution refactoringcontribution org eclipse ltk core refactoring refactoring core refactoringcore org eclipse ltk core refactoring refactoring status refactoringstatus org eclipse ltk core refactoring resource delete resources descriptor deleteresourcesdescriptor org eclipse ltk core refactoring resource rename resource descriptor renameresourcedescriptor org eclipse ltk core refactoring tests file system helper filesystemhelper org eclipse ltk core refactoring tests refactoring core test plugin refactoringcoretestplugin org eclipse ltk core refactoring tests participants element rename processor elementrenameprocessor org eclipse ltk core refactoring tests participants element rename refactoring elementrenamerefactoring org eclipse ltk core refactoring tests util simple test project simpletestproject org eclipse ltk internal core refactoring refactoring core plugin refactoringcoreplugin junit framework test junit framework test case testcase junit framework test suite testsuite resource refactoring undo tests resourcerefactoringundotests test case testcase string test new project newproject project test new projecttestnew string test folder test string test new folder newfolder test new testnew string test file my file myfile txt string test new file newfile new file newfile txt string test link edfolder linkedfolder linked folder linkedfolder string test link edfile linkedfile linked file linkedfile txt string test subfolder sub folder subfolder list string file name excludes filenameexcludes array list arraylist file name excludes filenameexcludes add project test suite test suite testsuite suite test suite testsuite resource refactoring undo tests resourcerefactoringundotests get name getname suite add test suite addtestsuite resource refactoring undo tests resourcerefactoringundotests suite string content simple test project simpletestproject f project fproject i folder ifolder test folder testfolder i file ifile test file testfile i operation history ioperationhistory history i undo context iundocontext context i file store ifilestore stores to delete storestodelete hash set hashset i folder ifolder test linked folder testlinkedfolder i file ifile test linked file testlinkedfile i folder ifolder test sub folder testsubfolder override set up setup exception f project fproject simple test project simpletestproject test folder testfolder f project fproject create folder createfolder test folder test file testfile f project fproject create file createfile test folder testfolder test file content create links creating backing content i file store ifilestore folder store folderstore get temp store gettempstore i file store ifilestore file store filestore get temp store gettempstore i path ipath folder location folderlocation uri util uriutil to path topath folder store folderstore touri i path ipath file location filelocation uri util uriutil to path topath file store filestore touri folder store folderstore mkdir efs get monitor getmonitor file store filestore open output stream openoutputstream efs get monitor getmonitor close create workspace objects test linked folder testlinkedfolder test folder testfolder get folder getfolder test link edfolder linkedfolder test linked folder testlinkedfolder create link createlink folder location folderlocation i resource iresource get monitor getmonitor assert true asserttrue test linked folder testlinkedfolder exists test linked file testlinkedfile test folder testfolder get file getfile test link edfile linkedfile test linked file testlinkedfile create link createlink file location filelocation i resource iresource get monitor getmonitor sub folder subfolder test sub folder testsubfolder test folder testfolder get folder getfolder test subfolder test sub folder testsubfolder create get monitor getmonitor history operation history factory operationhistoryfactory get operation history getoperationhistory context refactoring core plugin refactoringcoreplugin get undo context getundocontext override tear down teardown exception f project fproject delete i file store ifilestore to delete todelete stores to delete storestodelete to array toarray i file store ifilestore stores to delete storestodelete size stores to delete storestodelete clear to delete todelete length clear to delete todelete test file rename undo redo k testfilerenameundoredoltk execution exception executionexception core exception coreexception refactoring contribution refactoringcontribution rename contribution renamecontribution refactoring core refactoringcore get refactoring contribution getrefactoringcontribution rename resource descriptor renameresourcedescriptor rename resource descriptor renameresourcedescriptor desc rename resource descriptor renameresourcedescriptor rename contribution renamecontribution create descriptor createdescriptor desc set resource path setresourcepath test file testfile get full path getfullpath desc set new name setnewname test new file newfile perform refactoring operation performrefactoringoperation perform refactoring operation performrefactoringoperation desc create refactoring context createrefactoringcontext refactoring status refactoringstatus check conditions operation checkconditionsoperation conditions file snapshot filesnapshot snap file snapshot filesnapshot test file testfile execute i file ifile renamed file renamedfile test folder testfolder get file getfile test new file newfile assert true asserttrue file rename failed renamed file renamedfile exists snap test new file newfile assert true asserttrue file content altered rename snap is valid isvalid test folder testfolder undo snap test file assert true asserttrue file content altered undo rename snap is valid isvalid test folder testfolder assert false assertfalse undo rename failed renamed file renamedfile exists redo snap test new file newfile assert true asserttrue file content altered redo rename snap is valid isvalid test folder testfolder test folder rename undo redo k testfolderrenameundoredoltk execution exception executionexception core exception coreexception refactoring contribution refactoringcontribution rename contribution renamecontribution refactoring core refactoringcore get refactoring contribution getrefactoringcontribution rename resource descriptor renameresourcedescriptor rename resource descriptor renameresourcedescriptor desc rename resource descriptor renameresourcedescriptor rename contribution renamecontribution create descriptor createdescriptor desc set resource path setresourcepath test folder testfolder get full path getfullpath desc set new name setnewname test new folder newfolder perform refactoring operation performrefactoringoperation perform refactoring operation performrefactoringoperation desc create refactoring context createrefactoringcontext refactoring status refactoringstatus check conditions operation checkconditionsoperation conditions folder snapshot foldersnapshot snap folder snapshot foldersnapshot test folder testfolder execute i folder ifolder renamed folder renamedfolder f project fproject get project getproject get folder getfolder test new folder newfolder assert true asserttrue project rename failed renamed folder renamedfolder exists snap test new folder newfolder assert true asserttrue folder content altered rename snap is valid isvalid f project fproject get project getproject undo snap test folder assert true asserttrue folder content altered undo rename snap is valid isvalid f project fproject get project getproject assert false assertfalse undo rename failed renamed folder renamedfolder exists redo snap test new folder newfolder assert true asserttrue folder content altered redo rename snap is valid isvalid f project fproject get project getproject test project rename undo redo k testprojectrenameundoredoltk execution exception executionexception core exception coreexception i project iproject renamed project renamedproject refactoring contribution refactoringcontribution rename contribution renamecontribution refactoring core refactoringcore get refactoring contribution getrefactoringcontribution rename resource descriptor renameresourcedescriptor rename resource descriptor renameresourcedescriptor desc rename resource descriptor renameresourcedescriptor rename contribution renamecontribution create descriptor createdescriptor desc set resource path setresourcepath f project fproject get project getproject get full path getfullpath desc set new name setnewname test new project newproject perform refactoring operation performrefactoringoperation perform refactoring operation performrefactoringoperation desc create refactoring context createrefactoringcontext refactoring status refactoringstatus check conditions operation checkconditionsoperation conditions project snapshot projectsnapshot snap project snapshot projectsnapshot f project fproject get project getproject execute renamed project renamedproject get workspace root getworkspaceroot get project getproject test new project newproject assert true asserttrue project rename failed renamed project renamedproject exists snap test new project newproject assert true asserttrue project content altered rename snap is valid isvalid undo snap simple test project simpletestproject test project assert true asserttrue project content altered undo rename snap is valid isvalid assert false assertfalse undo rename failed renamed project renamedproject exists redo snap test new project newproject assert true asserttrue project content altered redo rename snap is valid isvalid renamed project renamedproject delete test file delete undo redo k testfiledeleteundoredoltk execution exception executionexception core exception coreexception refactoring contribution refactoringcontribution rename contribution renamecontribution refactoring core refactoringcore get refactoring contribution getrefactoringcontribution delete resources descriptor deleteresourcesdescriptor delete resources descriptor deleteresourcesdescriptor desc delete resources descriptor deleteresourcesdescriptor rename contribution renamecontribution create descriptor createdescriptor desc set resource paths setresourcepaths i path ipath test file testfile get full path getfullpath perform refactoring operation performrefactoringoperation perform refactoring operation performrefactoringoperation desc create refactoring context createrefactoringcontext refactoring status refactoringstatus check conditions operation checkconditionsoperation conditions file snapshot filesnapshot snap file snapshot filesnapshot test file testfile execute assert false assertfalse file delete failed test file testfile exists undo assert true asserttrue file recreation failed test file testfile exists assert true asserttrue file content altered undo snap is valid isvalid test file testfile get parent getparent redo assert false assertfalse redo delete failed test file testfile exists test file linked delete undo redo k testfilelinkeddeleteundoredoltk execution exception executionexception core exception coreexception refactoring contribution refactoringcontribution rename contribution renamecontribution refactoring core refactoringcore get refactoring contribution getrefactoringcontribution delete resources descriptor deleteresourcesdescriptor delete resources descriptor deleteresourcesdescriptor desc delete resources descriptor deleteresourcesdescriptor rename contribution renamecontribution create descriptor createdescriptor desc set resource paths setresourcepaths i path ipath test linked file testlinkedfile get full path getfullpath perform refactoring operation performrefactoringoperation perform refactoring operation performrefactoringoperation desc create refactoring context createrefactoringcontext refactoring status refactoringstatus check conditions operation checkconditionsoperation conditions file snapshot filesnapshot snap file snapshot filesnapshot test linked file testlinkedfile execute assert false assertfalse file delete failed test linked file testlinkedfile exists undo assert true asserttrue file recreation failed test linked file testlinkedfile exists assert true asserttrue file content altered undo snap is valid isvalid test linked file testlinkedfile get parent getparent redo assert false assertfalse redo delete failed test linked file testlinkedfile exists test folder delete undo redo k testfolderdeleteundoredoltk execution exception executionexception core exception coreexception refactoring contribution refactoringcontribution rename contribution renamecontribution refactoring core refactoringcore get refactoring contribution getrefactoringcontribution delete resources descriptor deleteresourcesdescriptor delete resources descriptor deleteresourcesdescriptor desc delete resources descriptor deleteresourcesdescriptor rename contribution renamecontribution create descriptor createdescriptor desc set resource paths setresourcepaths i path ipath test sub folder testsubfolder get full path getfullpath perform refactoring operation performrefactoringoperation perform refactoring operation performrefactoringoperation desc create refactoring context createrefactoringcontext refactoring status refactoringstatus check conditions operation checkconditionsoperation conditions folder snapshot foldersnapshot snap folder snapshot foldersnapshot test sub folder testsubfolder execute assert false assertfalse folder delete failed test sub folder testsubfolder exists undo assert true asserttrue folder recreation failed test sub folder testsubfolder exists assert true asserttrue folder content altered undo snap is valid isvalid test sub folder testsubfolder get parent getparent redo assert false assertfalse redo delete failed test sub folder testsubfolder exists test folder delete linked undo redo k testfolderdeletelinkedundoredoltk execution exception executionexception core exception coreexception refactoring contribution refactoringcontribution rename contribution renamecontribution refactoring core refactoringcore get refactoring contribution getrefactoringcontribution delete resources descriptor deleteresourcesdescriptor delete resources descriptor deleteresourcesdescriptor desc delete resources descriptor deleteresourcesdescriptor rename contribution renamecontribution create descriptor createdescriptor desc set resource paths setresourcepaths i path ipath test linked folder testlinkedfolder get full path getfullpath perform refactoring operation performrefactoringoperation perform refactoring operation performrefactoringoperation desc create refactoring context createrefactoringcontext refactoring status refactoringstatus check conditions operation checkconditionsoperation conditions folder snapshot foldersnapshot snap folder snapshot foldersnapshot test linked folder testlinkedfolder execute assert false assertfalse folder delete failed test linked folder testlinkedfolder exists undo assert true asserttrue folder recreation failed test linked folder testlinkedfolder exists assert true asserttrue folder content altered undo snap is valid isvalid test linked folder testlinkedfolder get parent getparent redo assert false assertfalse redo delete failed test linked folder testlinkedfolder exists test project delete undo redo k testprojectdeleteundoredoltk execution exception executionexception core exception coreexception refactoring contribution refactoringcontribution rename contribution renamecontribution refactoring core refactoringcore get refactoring contribution getrefactoringcontribution delete resources descriptor deleteresourcesdescriptor delete resources descriptor deleteresourcesdescriptor desc delete resources descriptor deleteresourcesdescriptor rename contribution renamecontribution create descriptor createdescriptor desc set resource paths setresourcepaths i path ipath f project fproject get project getproject get full path getfullpath perform refactoring operation performrefactoringoperation perform refactoring operation performrefactoringoperation desc create refactoring context createrefactoringcontext refactoring status refactoringstatus check conditions operation checkconditionsoperation conditions execute assert false assertfalse project delete failed f project fproject get project getproject exists undo assert true asserttrue project recreation failed f project fproject get project getproject exists ideally test every time everytime fails int ermittently intermittently opening recreated project occurs background creation workspace representation disk contents happened test passes debug timing control led controlled assert true asserttrue project content altered undo snap is valid isvalid redo assert false assertfalse redo delete failed f project fproject get project getproject exists undo project exist tear down teardown cleaned content left disk undo test project closed delete undo redo k testprojectcloseddeleteundoredoltk execution exception executionexception core exception coreexception f project fproject get project getproject close get monitor getmonitor test project delete undo redo k testprojectdeleteundoredoltk test project delete with content undo redo k testprojectdeletewithcontentundoredoltk execution exception executionexception core exception coreexception refactoring contribution refactoringcontribution rename contribution renamecontribution refactoring core refactoringcore get refactoring contribution getrefactoringcontribution delete resources descriptor deleteresourcesdescriptor delete resources descriptor deleteresourcesdescriptor desc delete resources descriptor deleteresourcesdescriptor rename contribution renamecontribution create descriptor createdescriptor desc set resource paths setresourcepaths i path ipath f project fproject get project getproject get full path getfullpath desc set delete contents setdeletecontents perform refactoring operation performrefactoringoperation perform refactoring operation performrefactoringoperation desc create refactoring context createrefactoringcontext refactoring status refactoringstatus check conditions operation checkconditionsoperation conditions don snapshot content deleted execute assert false assertfalse project delete failed f project fproject get project getproject exists undo assert true asserttrue project recreated f project fproject get project getproject exists redo assert false assertfalse redo delete failed f project fproject get project getproject exists test project closed delete with content undo redo k testprojectcloseddeletewithcontentundoredoltk execution exception executionexception core exception coreexception f project fproject get project getproject close get monitor getmonitor test project delete with content undo redo k testprojectdeletewithcontentundoredoltk test pre change undo redo k testprechangeundoredoltk execution exception executionexception core exception coreexception refactoring element rename refactoring elementrenamerefactoring element rename refactoring elementrenamerefactoring working element rename refactoring elementrenamerefactoring enabled element rename refactoring elementrenamerefactoring pre change perform refactoring operation performrefactoringoperation perform refactoring operation performrefactoringoperation check conditions operation checkconditionsoperation conditions execute list string element rename processor elementrenameprocessor f history fhistory strictly speaking execution order easy check dependencies order participant pre exec main exec participant exec assert equals assertequals element rename processor elementrenameprocessor main create assert equals assertequals element rename processor elementrenameprocessor working create assert equals assertequals element rename processor elementrenameprocessor workingpre create pre createpre assert equals assertequals element rename processor elementrenameprocessor workingpre create assert equals assertequals element rename processor elementrenameprocessor workingpre execpre assert equals assertequals element rename processor elementrenameprocessor main exec assert equals assertequals element rename processor elementrenameprocessor working exec assert equals assertequals element rename processor elementrenameprocessor workingpre exec undo assert equals assertequals element rename processor elementrenameprocessor workingpre exec undo assert equals assertequals element rename processor elementrenameprocessor working exec undo assert equals assertequals element rename processor elementrenameprocessor main exec undo assert equals assertequals element rename processor elementrenameprocessor workingpre execpre undo redo assert equals assertequals element rename processor elementrenameprocessor workingpre execpre assert equals assertequals element rename processor elementrenameprocessor main exec assert equals assertequals element rename processor elementrenameprocessor working exec assert equals assertequals element rename processor elementrenameprocessor workingpre exec execute perform refactoring operation performrefactoringoperation core exception coreexception resources plugin resourcesplugin get workspace getworkspace get monitor getmonitor i workspace root iworkspaceroot get workspace root getworkspaceroot resources plugin resourcesplugin get workspace getworkspace get root getroot undo execution exception executionexception assert true asserttrue operation undo ne undone history can undo canundo context i status istatus status history undo context get monitor getmonitor assert true asserttrue undo status status isok redo execution exception executionexception assert true asserttrue operation redo ne redone history can redo canredo context i status istatus status history redo context get monitor getmonitor assert true asserttrue redo status status isok i progress monitor iprogressmonitor get monitor getmonitor resource snapshot resourcesnapshot snapshot from resource snapshotfromresource i resource iresource resource core exception coreexception resource i file ifile file snapshot filesnapshot i file ifile resource resource i folder ifolder folder snapshot foldersnapshot i folder ifolder resource resource i project iproject project snapshot projectsnapshot i project iproject resource fail unknown resource type making compiler happy file snapshot filesnapshot i file ifile resource reads test file testfile content returns string string read content readcontent i file ifile file core exception coreexception input stream inputstream file get contents getcontents string encoding file get charset getcharset buffered reader bufferedreader reader buffered reader bufferedreader input stream reader inputstreamreader encoding string buffer stringbuffer buffer string buffer stringbuffer read read reader read buffer append read buffer to string tostring i o exception ioexception core exception coreexception status i status istatus error refactoring core test plugin refactoringcoretestplugin get plugin i d getpluginid get message getmessage returns file store filestore instance backed storage temporary location returned store exist belong existing parent tear down teardown method ensure location deleted test completed temp files to re filestore i file store ifilestore get temp store gettempstore i file store ifilestore store efs get local file system getlocalfilesystem get store getstore file system helper filesystemhelper get random location getrandomlocation file system helper filesystemhelper get temp dir gettempdir stores to delete storestodelete add store store clear i file store ifilestore store store delete efs core exception coreexception file snapshot filesnapshot resource snapshot resourcesnapshot string content uri location marker snapshot markersnapshot marker snapshots markersnapshots file snapshot filesnapshot i file ifile file core exception coreexception content read content readcontent file file get name getname file is linked islinked location file getlocationuri i marker imarker markers file find markers findmarkers i resource iresource depth infinite marker snapshots markersnapshots marker snapshot markersnapshot markers length markers length marker snapshots markersnapshots marker snapshot markersnapshot markers override is valid isvalid i resource iresource parent core exception coreexception i resource iresource resource get workspace root getworkspaceroot find member findmember parent get full path getfullpath append resource resource i file ifile i file ifile file i file ifile resource content match contentmatch read content readcontent file equals content file is linked islinked content match contentmatch content match contentmatch file getlocationuri equals location content match contentmatch marker snapshots markersnapshots length marker snapshots markersnapshots exists on existson resource folder snapshot foldersnapshot resource snapshot resourcesnapshot uri location resource snapshot resourcesnapshot member snapshots membersnapshots folder snapshot foldersnapshot i folder ifolder folder core exception coreexception folder get name getname folder is linked islinked location folder getlocationuri i resource iresource members folder members member snapshots membersnapshots resource snapshot resourcesnapshot members length members length member snapshots membersnapshots snapshot from resource snapshotfromresource members override is valid isvalid i resource iresource parent core exception coreexception i resource iresource resource get workspace root getworkspaceroot find member findmember parent get full path getfullpath append resource resource i folder ifolder i folder ifolder folder i folder ifolder resource folder is linked islinked folder getlocationuri equals location member snapshots membersnapshots length file name excludes filenameexcludes member snapshots membersnapshots member snapshots membersnapshots is valid isvalid folder marker snapshot markersnapshot string type map string object attributes marker snapshot markersnapshot i marker imarker marker core exception coreexception type marker get type gettype attributes marker get attributes getattributes exists on existson i resource iresource resource core exception coreexception comparison based equality attributes change create delete recreate sequence i marker imarker markers resource find markers findmarkers type i resource iresource depth markers length markers get attributes getattributes equals attributes project snapshot projectsnapshot resource snapshot resourcesnapshot resource snapshot resourcesnapshot member snapshots membersnapshots project snapshot projectsnapshot i project iproject project core exception coreexception project get name getname open project is open isopen open project open i resource iresource members project members member snapshots membersnapshots resource snapshot resourcesnapshot members length members length member snapshots membersnapshots snapshot from resource snapshotfromresource members open project close override is valid isvalid i resource iresource parent core exception coreexception i resource iresource resource get workspace root getworkspaceroot find member findmember parent get full path getfullpath append resource resource i project iproject i project iproject project i project iproject resource open validate content open project is open isopen open project open member snapshots membersnapshots length file name excludes filenameexcludes member snapshots membersnapshots member snapshots membersnapshots is valid isvalid resource open project close is valid isvalid core exception coreexception is valid isvalid get workspace root getworkspaceroot resource snapshot resourcesnapshot string is valid isvalid i resource iresource parent core exception coreexception i workspace root iworkspaceroot get workspace root getworkspaceroot resources plugin resourcesplugin get workspace getworkspace get root getroot