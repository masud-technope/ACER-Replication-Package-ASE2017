copyright ibm corporation rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors ibm corporation initial api implementation org eclipse jdt internal corext refactoring nls java buffered reader bufferedreader java io exception ioexception java input stream inputstream java input stream reader inputstreamreader java util array list arraylist java util arrays java util iterator java util list ibm icu text collator org eclipse core runtime org eclipse core runtime core exception coreexception org eclipse text edits insert edit insertedit org eclipse text edits text edit textedit org eclipse jface text bad location exception badlocationexception org eclipse jface text region org eclipse jdt core i buffer ibuffer org eclipse jdt core i compilation unit icompilationunit org eclipse jdt core java model exception javamodelexception org eclipse jdt core compiler invalid input exception invalidinputexception org eclipse jdt core formatter indent manipulation indentmanipulation nls util nlsutil instances nls util nlsutil reads stream string closes stream param input stream param encoding encoding contents code code error occurred string read string readstring input stream inputstream string encoding buffered reader bufferedreader reader string buffer stringbuffer buffer string buffer stringbuffer read reader buffered reader bufferedreader input stream reader inputstreamreader encoding read reader read buffer append read buffer to string tostring io exception ioexception reader reader close io exception ioexception creates returns nls tag edit string position compilation unit param compilation unit param position position string edit code code string nl sed nlsed edit created reason core exception coreexception scanning fails text edit textedit createnlsedit i compilation unit icompilationunit position core exception coreexception nls line nlsline nls line nlsline scan current line scancurrentline position nls line nlsline nls element nlselement element find element findelement nls line nlsline position element has tag hastag nls element nlselement elements nls line nlsline get elements getelements index in element list indexinelementlist arrays as list aslist elements index of indexof element edit offset editoffset compute insert offset computeinsertoffset elements index in element list indexinelementlist tags based string edit text edittext nls element nlselement create tag text createtagtext index in element list indexinelementlist insert edit insertedit edit offset editoffset edit text edittext creates returns nls tag edits strings positions compilation unit param compilation unit param positions positions strings edit code code strings nl sed nlsed edits created reason core exception coreexception scanning fails text edit textedit createnlsedits i compilation unit icompilationunit positions core exception coreexception list insert edit insertedit result array list arraylist nls line nlsline all lines alllines nls scanner nlsscanner scan all lines alllines length nls line nlsline all lines alllines nls element nlselement elements get elements getelements elements length nls element nlselement element elements element has tag hastag positions length is position in element ispositioninelement element positions edit offset editoffset elements length edit offset editoffset elements get tag position gettagposition get offset getoffset edit offset editoffset find line end findlineend element get position getposition get offset getoffset region previous position previousposition elements get tag position gettagposition edit offset editoffset previous position previousposition get offset getoffset previous position previousposition get length getlength string edit text edittext tags based nls element nlselement create tag text createtagtext tags based result add insert edit insertedit edit offset editoffset edit text edittext invalid input exception invalidinputexception bad location exception badlocationexception result is empty isempty result to array toarray text edit textedit result size nls line nlsline scan current line scancurrentline i compilation unit icompilationunit position java model exception javamodelexception is true istrue position position get buffer getbuffer get length getlength nls line nlsline all lines alllines nls scanner nlsscanner scan all lines alllines length nls line nlsline all lines alllines find element findelement position invalid input exception invalidinputexception bad location exception badlocationexception is position in element ispositioninelement nls element nlselement element position region element position elementposition element get position getposition element position elementposition get offset getoffset position position element position elementposition get offset getoffset element position elementposition get length getlength nls element nlselement find element findelement nls line nlsline position nls element nlselement elements get elements getelements elements length nls element nlselement element elements is position in element ispositioninelement element position element find good place nls tag find previous nlsed string put ting putting tag string exists finding nlsed string put ting putting tag find tag compute insert offset computeinsertoffset nls element nlselement elements i compilation unit icompilationunit core exception coreexception nls element nlselement previous tag ged previoustagged find previous tag ged findprevioustagged elements previous tag ged previoustagged previous tag ged previoustagged get tag position gettagposition get offset getoffset previous tag ged previoustagged get tag position gettagposition get length getlength nls element nlselement next tag ged nexttagged find next tag ged findnexttagged elements next tag ged nexttagged next tag ged nexttagged get tag position gettagposition get offset getoffset find line end findlineend elements get position getposition get offset getoffset nls element nlselement find previous tag ged findprevioustagged start index startindex nls element nlselement elements start index startindex elements has tag hastag elements nls element nlselement find next tag ged findnexttagged start index startindex nls element nlselement elements start index startindex elements length elements has tag hastag elements find line end findlineend i compilation unit icompilationunit position java model exception javamodelexception i buffer ibuffer buffer get buffer getbuffer length buffer get length getlength position length indent manipulation indentmanipulation is line delimiter char islinedelimiterchar buffer get char getchar length determine good insertion position code key code list code code param key key insert param list link string position code code key inserted returns get insertion position getinsertionposition string key list string result invert distance invertdistance integer min iterator string iterator iterator iterator has next hasnext string string iterator current invert distance currentinvertdistance invert distance invertdistance key string current invert distance currentinvertdistance invert distance invertdistance invert distance invertdistance current invert distance currentinvertdistance collator get instance getinstance compare key string result result current invert distance currentinvertdistance invert distance invertdistance collator get instance getinstance compare key string result result param insert key insertkey key insert param existing key existingkey existing key invert distance code insert key insertkey code code existing key existingkey code higher close r closer invert distance invertdistance string insert key insertkey string existing key existingkey existing key length existingkeylength existing key existingkey length insert key length insertkeylength insert key insertkey length min len minlen math min insert key length insertkeylength existing key length existingkeylength prefix match count prefixmatchcount min len minlen insert key insertkey char at charat existing key existingkey char at charat prefix match count prefixmatchcount prefix match count prefixmatchcount insert key length insertkeylength existing key length existingkeylength is separator isseparator insert key insertkey char at charat existing key length existingkeylength insert existing key prefix match prefix match count prefixmatchcount existing longer existinglonger existing key length existingkeylength insert key length insertkeylength insertion key preferred insertion positions prefix match count prefixmatchcount math max existing longer existinglonger is separator isseparator