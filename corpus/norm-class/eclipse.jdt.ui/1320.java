copyright ibm corporation rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors ibm corporation initial api implementation org eclipse jdt internal corext refactoring generics java util array list arraylist java util arrays java util collection java util collections java util hash set hashset java util iterator java util list java util stack org eclipse core runtime org eclipse jdt internal corext refactoring type constraints typeconstraints types generic type generictype org eclipse jdt internal corext refactoring type constraints typeconstraints types t type ttype org eclipse jdt internal corext refactoring type constraints typeconstraints collection element variable collectionelementvariable org eclipse jdt internal corext refactoring type constraints typeconstraints constraint variable constraintvariable org eclipse jdt internal corext refactoring type constraints typeconstraints i type constraint itypeconstraint org eclipse jdt internal corext refactoring type constraints typeconstraints sub type constraint subtypeconstraint org eclipse jdt internal corext refactoring type constraints typeconstraints type equivalence set typeequivalenceset parametric structure computer parametricstructurecomputer parametric structure parametricstructure parametric structure parametricstructure parametric structure parametricstructure generic type generictype f base fbase parametric structure parametricstructure f parameters fparameters parametric structure parametricstructure generic type generictype base base null pointer exception nullpointerexception f base fbase base f parameters fparameters parametric structure parametricstructure base get type parameters gettypeparameters length parametric structure parametricstructure f base fbase f parameters fparameters parametric structure parametricstructure parametric structure parametricstructure get parameters getparameters f parameters fparameters generic type generictype get base getbase f base fbase override string to string tostring nls nls param structure paramstructure f base fbase to string tostring arrays as list aslist f parameters fparameters nls debug initialization maps constraint variable constraintvariable i type itype instance abstract type parameter abstracttypeparameter constraint variable constraintvariable refer param etric parametric type instance parametric structure parametricstructure structure element structure environment elementstructureenvironment f elem structure env felemstructureenv element structure environment elementstructureenvironment constraint variable constraintvariable f all constraint variables fallconstraintvariables infer type arguments model infertypeargumentstcmodel ftcmodel parametric structure computer parametricstructurecomputer constraint variable constraintvariable all constraint variables allconstraintvariables infer type arguments model infertypeargumentstcmodel tc model tcmodel f all constraint variables fallconstraintvariables all constraint variables allconstraintvariables ftcmodel tc model tcmodel element structure environment elementstructureenvironment get elem structure env getelemstructureenv f elem structure env felemstructureenv dump container structure dumpcontainerstructure nls system println container structure f all constraint variables fallconstraintvariables length constraint variable constraintvariable f all constraint variables fallconstraintvariables elem structure elemstructure elem structure elemstructure parametric structure parametricstructure nls nls system println elem structure elemstructure to string tostring elem structure elemstructure system println stack constraint variable constraintvariable f work list fworklist stack set structure and push setstructureandpush constraint variable constraintvariable parametric structure parametricstructure structure set elem structure setelemstructure structure f work list fworklist push todo hard wired collect ions collections initialize container structure initializecontainerstructure debug initialization nls system println see ding seeding container structure f all constraint variables fallconstraintvariables length constraint variable constraintvariable f all constraint variables fallconstraintvariables t type ttype var type vartype declared type of declaredtypeof var type vartype list string binary method raw list is parametric type isparametrictype var type vartype is unmodifiable field or method isunmodifiablefieldormethod debug initialization system println nls entity container structure nls set structure and push setstructureandpush new parametric type newparametrictype var type vartype might be parametric mightbeparametric var type vartype supertype container type container structure debug initialization system println nls entity container structure nls set structure and push setstructureandpush parametric structure parametricstructure container structure t type ttype expr type exprtype get type gettype todo is array access isarrayaccess debug initialization system println entity container structure set structure and push setstructureandpush structure container structure java generics arrays is parametric type isparametrictype expr type exprtype debug initialization system println entity container structure set structure and push setstructureandpush new parametric type newparametrictype expr type exprtype expr type exprtype might be parametric mightbeparametric expr type exprtype supertype container type container structure debug initialization system println entity container structure set structure and push setstructureandpush structure todo mark us markus updates child element variables parent variable main tain maintain automatically code needed collection element variable collectionelementvariable collection element variable collectionelementvariable collection element variable collectionelementvariable idx get declaration type variable index getdeclarationtypevariableindex todo type variable supertype collection constraint variable constraintvariable vars ftcmodel get element variables getelementvariables values vars vars constraint variable constraintvariable get num container type params getnumcontainertypeparams vars idx f variable element env fvariableelementenv set element variables setelementvariables get parent constraint variable getparentconstraintvariable vars container structure variable f all variables fallvariables elem structure elemstructure param etric parametric type container structure structure elem structure elemstructure abstract type parameter abstracttypeparameter container structure elem structure elemstructure structure t type ttype declared type of declaredtypeof constraint variable constraintvariable todo record original type collection element variable collectionelementvariable iff source type parameter get type gettype context ual expression variable contextualexpressionvariable context ual expression variable contextualexpressionvariable context ual expression variable contextualexpressionvariable get binding getbinding return type variable returntypevariable return type variable returntypevariable return type variable returntypevariable get binding getbinding raw binding variable rawbindingvariable raw binding variable rawbindingvariable raw binding variable rawbindingvariable get binding getbinding parameter type variable parametertypevariable parameter type variable parametertypevariable parameter type variable parametertypevariable get binding getbinding might be parametric mightbeparametric t type ttype type todo check is parametric type isparametrictype type compute container structure computecontainerstructure debug initialization nls system println comp uting computing container structure initialize container structure initializecontainerstructure debug initialization dump container structure dumpcontainerstructure f work list fworklist is empty isempty constraint variable constraintvariable f work list fworklist pop list i type constraint itypeconstraint used in usedin ftcmodel get used in getusedin iterator i type constraint itypeconstraint iter used in usedin iterator iter has next hasnext sub type constraint subtypeconstraint stc sub type constraint subtypeconstraint iter constraint variable constraintvariable lhs stc get left getleft constraint variable constraintvariable rhs stc get right getright unify container structure unifycontainerstructure lhs rhs type equivalence set typeequivalenceset type equivalence set typeequivalenceset get type equivalence set gettypeequivalenceset type equivalence set typeequivalenceset constraint variable constraintvariable contributing variables contributingvariables type equivalence set typeequivalenceset get contributing variables getcontributingvariables contributing variables contributingvariables length constraint variable constraintvariable contributing variables contributingvariables constraint variable constraintvariable contributing variables contributingvariables unify container structure unifycontainerstructure debug initialization dump container structure dumpcontainerstructure unify container structure unifycontainerstructure constraint variable constraintvariable lhs constraint variable constraintvariable rhs rmf exclude prop agation propagation unmodifiable fields methods is unmodifiable field or method isunmodifiablefieldormethod lhs is unmodifiable field or method isunmodifiablefieldormethod rhs debug initialization nls nls nls nls nls system println exam ini ng examining constraint lhs elem structure elemstructure lhs rhs elem structure elemstructure rhs update structure of var updatestructureofvar lhs elem structure elemstructure rhs type operator typeoperator sub type subtype lhs collection element variable collectionelementvariable update parent container structure from updateparentcontainerstructurefrom collection element variable collectionelementvariable lhs rhs update element var structure from parent updateelementvarstructurefromparent lhs update structure of var updatestructureofvar rhs elem structure elemstructure lhs type operator typeoperator super type supertype rhs collection element variable collectionelementvariable update parent container structure from updateparentcontainerstructurefrom collection element variable collectionelementvariable rhs lhs update element var structure from parent updateelementvarstructurefromparent rhs parametric structure parametricstructure new parametric type newparametrictype t type ttype var type vartype todo create collection element variable collectionelementvariable generic type generictype generic type generictype generic type generictype var type vartype get type declaration gettypedeclaration parametric structure parametricstructure generic type generictype is unmodifiable field or method isunmodifiablefieldormethod constraint variable constraintvariable todo find declared binary type is parametric type isparametrictype t type ttype type type is parameterized type isparameterizedtype type is generic type isgenerictype type is raw type israwtype type get type declaration gettypedeclaration is generic type isgenerictype updates structure type parameter parametric structure parametricstructure consistent other structure otherstructure update structure of ith param from updatestructureofithparamfrom parametric structure parametricstructure structure parametric structure parametricstructure other structure otherstructure structure info update structure other structure otherstructure nls is true istrue structure other structure otherstructure update structure of ith param from updatestructureofithparamfrom attempt unify ith param param etric parametric type parametric structure parametricstructure param structure get parameters getparameters param unknown param param unknown debug initialization nls nls nls system println setting param structure other structure otherstructure structure get parameters getparameters other structure otherstructure param structured paramstructured param parametric structure parametricstructure other structured otherstructured other structure otherstructure parametric structure parametricstructure param etric parametric param structured paramstructured other structured otherstructured conservatively type param structure unstructured param get base getbase equals other structure otherstructure get base getbase update structure of type updatestructureoftype param other structure otherstructure structure get parameters getparameters parametric structure parametricstructure updates structure sub sidiary subsidiary element variables constraint variable constraintvariable fact container update element var structure from parent updateelementvarstructurefromparent constraint variable constraintvariable propagate structure container variable sub sidiary subsidiary element variables elem structure elemstructure parametric structure parametricstructure ftcmodel get element variables getelementvariables size parametric structure parametricstructure elem structure elemstructure iterator collection element variable collectionelementvariable iterator ftcmodel get element variables getelementvariables values iterator iterator has next hasnext collection element variable collectionelementvariable type var typevar iterator declaration type variable index declarationtypevariableindex type var typevar get declaration type variable index getdeclarationtypevariableindex declaration type variable index declarationtypevariableindex collection element variable collectionelementvariable declared type variable update structure of var updatestructureofvar type var typevar get parameters getparameters declaration type variable index declarationtypevariableindex type operator typeoperator equals updates structure parent container variable collection element variable collectionelementvariable structure param elem var elemvar param update parent container structure from updateparentcontainerstructurefrom collection element variable collectionelementvariable elem var elemvar constraint variable constraintvariable constraint variable constraintvariable elem container elemcontainer elem var elemvar get parent constraint variable getparentconstraintvariable appears container structure doesn array access array containers jdk disallows arrays param etric parametric types doesn container structure ignore parametric structure parametricstructure elem container structure elemcontainerstructure elem structure elemstructure elem container elemcontainer elem container structure elemcontainerstructure parametric structure parametricstructure handle clone elem container structure elemcontainerstructure elem container structure elemcontainerstructure new parametric type newparametrictype elem container elemcontainer get type gettype set structure and push setstructureandpush elem container elemcontainer elem container structure elemcontainerstructure parametric structure parametricstructure structure elem structure elemstructure todo declared type variable type variable supertype parm idx parmidx elem var elemvar get declaration type variable index getdeclarationtypevariableindex parm idx parmidx collection element variable collectionelementvariable declared type variable todo parametric structure parametricstructure type variable avoid creating cyclic structure elem container structure elemcontainerstructure structure contains sub structure containssubstructure structure elem container structure elemcontainerstructure elem structure elemstructure elem var elemvar parametric structure parametricstructure set structure and push setstructureandpush elem var elemvar parametric structure parametricstructure elem container structure elemcontainerstructure get parameters getparameters parm idx parmidx elem container structure elemcontainerstructure get parameters getparameters parm idx parmidx parametric structure parametricstructure f work list fworklist push elem container elemcontainer update structure of ith param from updatestructureofithparamfrom elem container structure elemcontainerstructure parm idx parmidx structure set structure and push setstructureandpush elem var elemvar elem container structure elemcontainerstructure get parameters getparameters parm idx parmidx f work list fworklist push elem container elemcontainer debug initialization nls nls system println updated structure elem container elemcontainer elem container structure elemcontainerstructure contains sub structure containssubstructure parametric structure parametricstructure containing structure containingstructure parametric structure parametricstructure sub structure substructure containing structure containingstructure parametric structure parametricstructure parameters containing structure containingstructure get parameters getparameters parameters length parametric structure parametricstructure parameter parameters parameter sub structure substructure contains sub structure containssubstructure parameter sub structure substructure type structure detailed type copying structure type parameters parameters parameters type parameters update structure of type updatestructureoftype parametric structure parametricstructure type parametric structure parametricstructure type type type parametric structure parametricstructure parms type get parameters getparameters parametric structure parametricstructure parms type get parameters getparameters some change somechange is true istrue parms length parms length parms length avoid creating cyclic str uctures structures type parms parms parametric structure parametricstructure parms parametric structure parametricstructure some change somechange update structure of ith param from updatestructureofithparamfrom type parms some change somechange some change somechange type operator typeoperator constraint operator constraintoperator supertype string f op fop type operator typeoperator string f op fop nls type operator typeoperator equals type operator typeoperator nls type operator typeoperator sub type subtype type operator typeoperator nls type operator typeoperator super type supertype type operator typeoperator override string to string tostring f op fop updates structure constraint variable constraintvariable consistent structure type type operator typeoperator pushes variable f work list fworklist update structure of var updatestructureofvar constraint variable constraintvariable parametric structure parametricstructure type type operator typeoperator structure info update type parametric structure parametricstructure v structure vstructure elem structure elemstructure v structure unknown vstructureunknown v structure vstructure type structured type parametric structure parametricstructure v structure unknown vstructureunknown debug initialization nls nls system println setting structure type set structure and push setstructureandpush type v structured vstructured v structure vstructure parametric structure parametricstructure v structured vstructured type structured supertype equal unstructured type operator typeoperator equals type operator typeoperator super type supertype set structure and push setstructureandpush type str uctured structured param etric parametric types v structured vstructured type structured conservatively unstructured param etric parametric types v structure vstructure get base getbase equals type get base getbase param etric parametric structure type operator typeoperator super type supertype set structure and push setstructureandpush parametric structure parametricstructure update structure of type updatestructureoftype v structure vstructure type f work list fworklist push set elem structure setelemstructure constraint variable constraintvariable parametric structure parametricstructure f elem structure env felemstructureenv set elem structure setelemstructure parametric structure parametricstructure elem structure elemstructure constraint variable constraintvariable f elem structure env felemstructureenv elem structure elemstructure collection collection element variable collectionelementvariable create elem constraint variables createelemconstraintvariables collection collection element variable collectionelementvariable new vars newvars hash set hashset compute container structure computecontainerstructure debug initialization nls system println creating element variables f all constraint variables fallconstraintvariables length new vars newvars add all addall create variables for createvariablesfor f all constraint variables fallconstraintvariables f all constraint variables fallconstraintvariables add all addall new vars newvars new vars newvars collection collection element variable collectionelementvariable create variables for createvariablesfor constraint variable constraintvariable parametric structure parametricstructure elem structure elemstructure parametric structure parametricstructure collections empty list emptylist parametric structure parametricstructure parm type parmtype t type ttype base parm type parmtype get base getbase is parametric type isparametrictype base create and init vars createandinitvars parm type parmtype nls illegal state exception illegalstateexception attempt create element variables param etric parametric variable unknown type parm type parmtype collection collection element variable collectionelementvariable get element variables getelementvariables generic type generictype base constraint variable constraintvariable parent ftcmodel make element variables makeelementvariables parent base ftcmodel get element variables getelementvariables parent values collection collection element variable collectionelementvariable create and init vars createandinitvars constraint variable constraintvariable parametric structure parametricstructure parm type parmtype todo infer type arguments constraints solver infertypeargumentsconstraintssolver create initial estimate createinitialestimate f type estimates ftypeestimates set estimate of setestimateof sub types of singleton subtypesofsingleton create parametric structure parametricstructure get base container type getbasecontainertype parm type parmtype get base getbase s hierarchy shierarchy collection collection element variable collectionelementvariable element vars elementvars get element variables getelementvariables parm type parmtype get base getbase set new type param estimate for each setnewtypeparamestimateforeach element vars elementvars collection collection element variable collectionelementvariable result create vars createvars element vars elementvars parm type parmtype get parameters getparameters result collection collection element variable collectionelementvariable create vars createvars collection collection element variable collectionelementvariable cvs parametric structure parametricstructure parms properties param etric parametric parms length is true istrue cvs size parms length cvs length cvs size parms length parms length assumption wrong presence declared type variable iterator collection element variable collectionelementvariable iter cvs iterator iter has next hasnext collection element variable collectionelementvariable child var childvar iter declaration type variable index declarationtypevariableindex child var childvar get declaration type variable index getdeclarationtypevariableindex declaration type variable index declarationtypevariableindex collection element variable collectionelementvariable declared type variable set elem structure setelemstructure child var childvar parms declaration type variable index declarationtypevariableindex iterator collection element variable collectionelementvariable iter cvs iterator iter has next hasnext collection element variable collectionelementvariable child var childvar iter declaration type variable index declarationtypevariableindex child var childvar get declaration type variable index getdeclarationtypevariableindex declaration type variable index declarationtypevariableindex collection element variable collectionelementvariable declared type variable set elem structure setelemstructure child var childvar parametric structure parametricstructure roughly list collection element variable collectionelementvariable result array list arraylist cvs size iterator collection element variable collectionelementvariable iter cvs iterator iter has next hasnext collection element variable collectionelementvariable child var childvar iter declaration type variable index declarationtypevariableindex child var childvar get declaration type variable index getdeclarationtypevariableindex declaration type variable index declarationtypevariableindex collection element variable collectionelementvariable declared type variable result add child var childvar result add all addall create variables for createvariablesfor child var childvar result