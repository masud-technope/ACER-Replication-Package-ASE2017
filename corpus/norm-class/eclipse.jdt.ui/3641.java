copyright software rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors stephan herrmann initial api implementation org eclipse jdt internal text correction proposals java util collection java util list org eclipse core runtime core exception coreexception org eclipse text edits text edit group texteditgroup org eclipse jdt core i compilation unit icompilationunit org eclipse jdt core i java project ijavaproject org eclipse jdt core compiler i problem iproblem org eclipse jdt core dom ast org eclipse jdt core dom ast node astnode org eclipse jdt core dom block org eclipse jdt core dom compilation unit compilationunit org eclipse jdt core dom empty statement emptystatement org eclipse jdt core dom expression org eclipse jdt core dom field access fieldaccess org eclipse jdt core dom i type binding itypebinding org eclipse jdt core dom if statement ifstatement org eclipse jdt core dom infix expression infixexpression org eclipse jdt core dom modifier org eclipse jdt core dom parameterized type parameterizedtype org eclipse jdt core dom primitive type primitivetype org eclipse jdt core dom qualified name qualifiedname org eclipse jdt core dom return statement returnstatement org eclipse jdt core dom simple name simplename org eclipse jdt core dom statement org eclipse jdt core dom type org eclipse jdt core dom variable declaration fragment variabledeclarationfragment org eclipse jdt core dom variable declaration statement variabledeclarationstatement org eclipse jdt core dom rewrite ast rewrite astrewrite org eclipse jdt core dom rewrite import rewrite importrewrite org eclipse jdt core dom rewrite list rewrite listrewrite org eclipse jdt internal corext code manipulation codemanipulation stub utility stubutility org eclipse jdt internal corext dom ast node factory astnodefactory org eclipse jdt internal corext dom ast nodes astnodes org eclipse jdt internal corext dom scope analyzer scopeanalyzer org eclipse jdt internal corext fix messages fixmessages org eclipse jdt internal corext linked proposal position group linkedproposalpositiongroup org eclipse jdt internal java plugin images javapluginimages field issues link i problem iproblem nullable field reference nullablefieldreference link i problem iproblem required non null but provided spec d nullable requirednonnullbutprovidedspecdnullable rel ating relating field link i problem iproblem required non null but provided unknown requirednonnullbutprovidedunknown rel ating relating field extract field reference fresh local variable add check local variable move dereference block check pre code nullable exception test print stack trace printstacktrace pre converted pre code nullable exception test exception print stack trace printstacktrace todo handle pre code code keyword remind user writing local variable original field r resp ects rrespects scoping problem occurs initialization local variable moving statements block extract to null checked local proposal extracttonullcheckedlocalproposal linked correction proposal linkedcorrectionproposal nls string local position group local name localname protocol rearranging bits pieces code structure rearrange strategy rearrangestrategy statement orig stmt origstmt block block text edit group texteditgroup group rearrange strategy rearrangestrategy statement orig stmt origstmt block block text edit group texteditgroup group orig stmt origstmt orig stmt origstmt block block group group step protocol insert local variable param local decl localdecl local variable initialized original expression insert local decl insertlocaldecl variable declaration statement variabledeclarationstatement local decl localdecl step protocol create move target repos itioning repositioning original enclosing statement move target representing original statement statement create move target for orig stmt createmovetargetfororigstmt step protocol int egrate integrate statement existing structure param if stmt ifstmt statement fully created param then block thenblock statement statement block construction insert if statement insertifstatement if statement ifstatement if stmt ifstmt block then block thenblock rearrange strategy rearrangestrategy create statement orig stmt origstmt ast rewrite astrewrite rewrite text edit group texteditgroup group ast node astnode parent orig stmt origstmt get parent getparent parent block block block block parent orig stmt origstmt variable declaration statement variabledeclarationstatement modify block with local decl modifyblockwithlocaldecl orig stmt origstmt block rewrite group modify block modifyblock orig stmt origstmt block rewrite group replace statement replacestatement orig stmt origstmt rewrite group strategy implementation modifying statement list parent block modify block modifyblock rearrange strategy rearrangestrategy list rewrite listrewrite block rewrite blockrewrite modify block modifyblock statement orig stmt origstmt block enclosing block enclosingblock ast rewrite astrewrite rewrite text edit group texteditgroup group orig stmt origstmt enclosing block enclosingblock group modify block create rewrite task block rewrite blockrewrite rewrite get list rewrite getlistrewrite enclosing block enclosingblock block statements property override insert local decl insertlocaldecl variable declaration statement variabledeclarationstatement local decl localdecl block rewrite blockrewrite insert before insertbefore local decl localdecl orig stmt origstmt group override statement create move target for orig stmt createmovetargetfororigstmt statement block rewrite blockrewrite create move target createmovetarget orig stmt origstmt orig stmt origstmt group override insert if statement insertifstatement if statement ifstatement if stmt ifstmt block then block thenblock block replace statement wrapping statement block rewrite blockrewrite replace orig stmt origstmt if stmt ifstmt group var iant variant resp ects respects scoping existing local variable declaration modify block with local decl modifyblockwithlocaldecl modify block modifyblock modify block with local decl modifyblockwithlocaldecl statement orig stmt origstmt block enclosing block enclosingblock ast rewrite astrewrite rewrite text edit group texteditgroup group orig stmt origstmt enclosing block enclosingblock rewrite group override insert if statement insertifstatement if statement ifstatement if stmt ifstmt block then block thenblock stmt declares local variable rearrange strategy rearrangestrategy create move subsequent statements block ensure existing declared local visible list ast node astnode block stmts blockstmts block statements stmt idx stmtidx block stmts blockstmts index of indexof orig stmt origstmt last idx lastidx block stmts blockstmts size stmt idx stmtidx stmt idx stmtidx last idx lastidx then block thenblock statements add block rewrite blockrewrite create move target createmovetarget block stmts blockstmts stmt idx stmtidx block stmts blockstmts last idx lastidx group insert if statement insertifstatement if stmt ifstmt then block thenblock strategy implementation replacing single statement block replace statement replacestatement rearrange strategy rearrangestrategy ast rewrite astrewrite rewrite replace statement replacestatement statement orig stmt origstmt ast rewrite astrewrite rewrite text edit group texteditgroup group block create hold statements orig stmt origstmt rewrite getast new block newblock group rewrite rewrite override insert local decl insertlocaldecl variable declaration statement variabledeclarationstatement local decl localdecl block statements add local decl localdecl override statement create move target for orig stmt createmovetargetfororigstmt group unused statement rewrite create move target createmovetarget orig stmt origstmt override insert if statement insertifstatement if statement ifstatement if stmt ifstmt block then block thenblock block add statement block block statements add if stmt ifstmt replace single statement block rewrite replace orig stmt origstmt block group simple name simplename field reference fieldreference compilation unit compilationunit compilation unit compilationunit method declaration methoddeclaration initializer ast node astnode enclosing method enclosingmethod extract to null checked local proposal extracttonullcheckedlocalproposal i compilation unit icompilationunit compilation unit compilationunit compilation unit compilationunit simple name simplename field reference fieldreference ast node astnode enclosing method enclosingmethod fix messages fixmessages extract to null checked local proposal extracttonullcheckedlocalproposal extract to checked local extracttocheckedlocal proposal name proposalname java plugin images javapluginimages java plugin images javapluginimages img correction change compilation unit compilationunit compilation unit compilationunit field reference fieldreference field reference fieldreference enclosing method enclosingmethod enclosing method enclosingmethod override ast rewrite astrewrite get rewrite getrewrite core exception coreexception infrastructure ast ast compilation unit compilationunit getast ast rewrite astrewrite rewrite ast rewrite astrewrite create ast import rewrite importrewrite imports import rewrite importrewrite create compilation unit compilationunit text edit group texteditgroup group text edit group texteditgroup fix messages fixmessages extract to null checked local proposal extracttonullcheckedlocalproposal extract checked local extractcheckedlocal edit name editname linked proposal position group linkedproposalpositiongroup local name group localnamegroup linked proposal position group linkedproposalpositiongroup local position group get linked proposal model getlinkedproposalmodel add position group addpositiongroup local name group localnamegroup ast context statement orig stmt origstmt statement ast nodes astnodes get parent getparent field reference fieldreference statement determine suitable str ategy strategy rearranging elements code structure rearrange strategy rearrangestrategy rearrange strategy rearrangestrategy rearrange strategy rearrangestrategy create orig stmt origstmt rewrite group expression to replace toreplace ast node astnode direct parent directparent field reference fieldreference get parent getparent direct parent directparent field access fieldaccess to replace toreplace expression direct parent directparent direct parent directparent qualified name qualifiedname field reference fieldreference get location in parent getlocationinparent qualified name qualifiedname property to replace toreplace expression direct parent directparent to replace toreplace field reference fieldreference local declaration initialized field reference variable declaration fragment variabledeclarationfragment local frag localfrag ast new variable declaration fragment newvariabledeclarationfragment variable declaration statement variabledeclarationstatement local decl localdecl ast new variable declaration statement newvariabledeclarationstatement local frag localfrag type local decl localdecl set type settype new type newtype to replace toreplace resolve type binding resolvetypebinding ast imports local decl localdecl modifiers add ast new modifier newmodifier modifier modifier keyword modifierkeyword keyword string local name localname propose local name proposelocalname field reference fieldreference compilation unit compilationunit get compilation unit getcompilationunit get java project getjavaproject local frag localfrag set name setname ast new simple name newsimplename local name localname initialization local frag localfrag set initializer setinitializer expression ast node astnode copy subtree copysubtree ast to replace toreplace rearrange strategy rearrangestrategy insert local decl insertlocaldecl local decl localdecl statement if statement ifstatement if stmt ifstmt ast new if statement newifstatement condition infix expression infixexpression null check nullcheck ast new infix expression newinfixexpression null check nullcheck set left operand setleftoperand ast new simple name newsimplename local name localname null check nullcheck set right operand setrightoperand ast new null literal newnullliteral null check nullcheck set operator setoperator infix expression infixexpression equals if stmt ifstmt set expression setexpression null check nullcheck block original statement block then block thenblock ast new block newblock then block thenblock statements add rearrange strategy rearrangestrategy create move target for orig stmt createmovetargetfororigstmt if stmt ifstmt set then statement setthenstatement then block thenblock field reference replaced local simple name simplename dereferenced name dereferencedname ast new simple name newsimplename local name localname rewrite replace to replace toreplace dereferenced name dereferencedname group block todo comment block else block elseblock ast new block newblock nls string else statement elsestatement todo fix messages fixmessages extract to null checked local proposal extracttonullcheckedlocalproposal todo handle null description todohandlenulldescription orig stmt origstmt return statement returnstatement type return type returntype new type newtype return statement returnstatement orig stmt origstmt get expression getexpression resolve type binding resolvetypebinding ast imports return statement returnstatement return statement returnstatement ast new return statement newreturnstatement return statement returnstatement set expression setexpression ast node factory astnodefactory new default expression newdefaultexpression ast return type returntype else statement elsestatement ast nodes astnodes as for matted string asformattedstring return statement returnstatement string value of valueof get compilation unit getcompilationunit get java project getjavaproject get options getoptions empty statement emptystatement todo node todonode empty statement emptystatement rewrite create string placeholder createstringplaceholder else statement elsestatement ast node astnode empty statement else block elseblock statements add todo node todonode if stmt ifstmt set else statement setelsestatement else block elseblock link occurrences local variable add linked position addlinkedposition rewrite track local frag localfrag get name getname local position group add linked position addlinkedposition rewrite track null check nullcheck get left operand getleftoperand local position group add linked position addlinkedposition rewrite track dereferenced name dereferencedname local position group rearrange strategy rearrangestrategy insert if statement insertifstatement if stmt ifstmt then block thenblock rewrite string propose local name proposelocalname simple name simplename field name fieldname compilation unit compilationunit root i java project ijavaproject java project javaproject don propose names collection string variable names variablenames scope analyzer scopeanalyzer root get used variable names getusedvariablenames enclosing method enclosingmethod get start position getstartposition enclosing method enclosingmethod get length getlength string names string variable names variablenames size variable names variablenames to array toarray names don propose field string identifier field name fieldname get identifier getidentifier names names length identifier stub utility stubutility get local name suggestions getlocalnamesuggestions java project javaproject identifier names create fresh type reference param type binding typebinding type refer param ast ast creating nodes param imports opt imal optimal type names fully features type reference parameterized array type new type newtype i type binding itypebinding type binding typebinding ast ast import rewrite importrewrite imports unwrap array type dimensions type binding typebinding get dimensions getdimensions dimensions type binding typebinding type binding typebinding get element type getelementtype unwrap parameterized type i type binding itypebinding type arguments typearguments type binding typebinding get type arguments gettypearguments type binding typebinding type binding typebinding get erasure geterasure create leaf type type element type elementtype type binding typebinding is primitive isprimitive ast new primitive type newprimitivetype primitive type primitivetype to code tocode type binding typebinding get name getname ast new simple type newsimpletype ast new name newname imports add import addimport type binding typebinding wrap parameterized type type arguments typearguments length parameterized type parameterizedtype parameterized type parameterizedtype ast new parameterized type newparameterizedtype element type elementtype i type binding itypebinding type argument typeargument type arguments typearguments parameterized type parameterizedtype type arguments typearguments add new type newtype type argument typeargument ast imports element type elementtype parameterized type parameterizedtype wrap array type dimensions ast new array type newarraytype element type elementtype dimensions element type elementtype