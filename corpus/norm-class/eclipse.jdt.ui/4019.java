copyright ibm corporation rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors ibm corporation initial api implementation org eclipse jdt internal java editor javaeditor org eclipse jface text bad location exception badlocationexception org eclipse jface text i document idocument org eclipse jface text i region iregion org eclipse jface text i type d region itypedregion org eclipse jface text text utilities textutilities org eclipse jface text source i line range ilinerange org eclipse jdt core i java project ijavaproject org eclipse jdt internal corext util code formatter util codeformatterutil org eclipse jdt text i java partitions ijavapartitions org eclipse jdt internal text java heuristic scanner javaheuristicscanner org eclipse jdt internal text java indenter javaindenter utility indents number lines document indent util indentutil nls string slashes result indentation operation result passed subsequent calls link indent util indentutil indent lines indentlines i document idocument i line range ilinerange i java project ijavaproject indent result indentresult indent lines indentlines consistent resp ect respect indentation comments indent result indentresult indent result indentresult comment lines commentlines comment lines at column zero commentlinesatcolumnzero comment lines commentlines comment lines at column zero commentlinesatcolumnzero has changed haschanged left most line leftmostline returns code code indentation operation changed document code code code code document changed has changed haschanged has changed haschanged indent util indentutil instantiate indents range code lines code code document code passed java project code code solely formatter preferences param document document changed param lines range indented param project java project formatter preferences code code global preferences param result result previous call code indent lines indentlines code order main tain maintain comment properties code code note passed result changed call indent result queried reused subsequent indentation operations bad location exception badlocationexception code lines code valid range code document code indent result indentresult indent lines indentlines i document idocument document i line range ilinerange lines i java project ijavaproject project indent result indentresult result bad location exception badlocationexception number of lines numberoflines lines get number of lines getnumberoflines number of lines numberoflines indent result indentresult result reuse or create token reuseorcreatetoken result number of lines numberoflines java heuristic scanner javaheuristicscanner scanner java heuristic scanner javaheuristicscanner document java indenter javaindenter indenter java indenter javaindenter document scanner project changed tab size tabsize code formatter util codeformatterutil get tab width gettabwidth project lines get start line getstartline number of lines numberoflines changed indent line indentline document indenter scanner result comment lines at column zero commentlinesatcolumnzero tab size tabsize result has changed haschanged changed result s hifts shifts range code lines code code document code amount lines shifted determined range subsequent lines adjusted passed java project code code solely formatter preferences param document document changed param lines range shifted param project java project formatter preferences code code global preferences param result result previous call code shift lines shiftlines code order main tain maintain comment properties code code note passed result changed call indent result queried reused subsequent indentation operations bad location exception badlocationexception code lines code valid range code document code indent result indentresult shift lines shiftlines i document idocument document i line range ilinerange lines i java project ijavaproject project indent result indentresult result bad location exception badlocationexception number of lines numberoflines lines get number of lines getnumberoflines number of lines numberoflines indent result indentresult result reuse or create token reuseorcreatetoken result number of lines numberoflines result has changed haschanged java heuristic scanner javaheuristicscanner scanner java heuristic scanner javaheuristicscanner document java indenter javaindenter indenter java indenter javaindenter document scanner project string current get current indent getcurrentindent document lines get start line getstartline string buffer stringbuffer correct indenter compute indentation computeindentation document get line offset getlineoffset lines get start line getstartline correct bail result tab size tabsize code formatter util codeformatterutil get tab width gettabwidth project string buffer stringbuffer add ition addition string buffer stringbuffer difference sub tract indent subtractindent correct current add ition addition tab size tabsize difference result result left most line leftmostline result left most line leftmostline get left most line getleftmostline document lines tab size tabsize max reduction maxreduction compute visual length computevisuallength get current indent getcurrentindent document result left most line leftmostline lines get start line getstartline tab size tabsize difference lines get start line getstartline number of lines numberoflines add indent addindent document add ition addition result comment lines at column zero commentlinesatcolumnzero reduction math min difference max reduction maxreduction lines get start line getstartline number of lines numberoflines cut indent cutindent document reduction tab size tabsize result comment lines at column zero commentlinesatcolumnzero result has changed haschanged result indents code code code document code code indent code leaves leading comment sig ns signs param document document param param indent indentation insert param comment lines commentlines bad location exception badlocationexception concurrent document modification add indent addindent i document idocument document char sequence charsequence indent comment lines commentlines relative bad location exception badlocationexception i region iregion region document get line information getlineinformation insert region get offset getoffset end offset endoffset region get offset getoffset region get length getlength comments comment lines commentlines relative insert end offset endoffset document insert equals slashes insert insert indent document replace insert indent to string tostring cuts visual equivalent code to delete todelete code characters indentation code code code document code leaves leading comment sig ns signs param document document param param to delete todelete number space equivalents delete bad location exception badlocationexception concurrent document modification cut indent cutindent i document idocument document to delete todelete tab size tabsize comment lines commentlines relative bad location exception badlocationexception i region iregion region document get line information getlineinformation region get offset getoffset end offset endoffset region get offset getoffset region get length getlength comments end offset endoffset document equals slashes to delete todelete end offset endoffset document get char getchar character is whitespace iswhitespace to delete todelete compute visual length computevisuallength tab size tabsize to delete todelete end offset endoffset document equals slashes comment lines commentlines relative document replace computes difference indent ations indentations returns difference length current correct positive code add ition addition code initialized substring length code correct code param correct correct indentation param current current indentation migth whitespace param difference string buffer positive cleared substring code current code length difference len ght lenght code correct code code current code sub tract indent subtractindent char sequence charsequence correct char sequence charsequence current string buffer stringbuffer difference tab size tabsize compute visual length computevisuallength correct tab size tabsize compute visual length computevisuallength current tab size tabsize diff diff diff difference set length setlength len len diff correct char at charat difference append len compute visual length computevisuallength tab size tabsize diff compute visual length computevisuallength tab size tabsize tab size tabsize returns visual length code char sequence charsequence code account visual tab ulator tabulator length param seq string measure visual length code seq code compute visual length computevisuallength char sequence charsequence seq table n tablen size seq length seq char at charat table n tablen size table n tablen size table n tablen size stays size size returns indentation code code code document code returned string pairs leading slashes considered indentation space ast erix asterix javadoc comment considered indentation param document document param indentation code code code document code bad location exception badlocationexception document changed concurrently string get current indent getcurrentindent i document idocument document bad location exception badlocationexception i region iregion region document get line information getlineinformation region get offset getoffset end offset endoffset region get offset getoffset region get length getlength comments end offset endoffset document equals slashes end offset endoffset document get char getchar character is whitespace iswhitespace don count space javadoc ast erix asterix style comment lines nls end offset endoffset document equals string type text utilities textutilities get content type getcontenttype document i java partitions ijavapartitions java partitioning type equals i java partitions ijavapartitions java doc type equals i java partitions ijavapartitions java multi comment document get left most line getleftmostline i document idocument document i line range ilinerange lines tab size tabsize bad location exception badlocationexception number of lines numberoflines lines get number of lines getnumberoflines lines get start line getstartline min line minline min indent minindent integer max number of lines numberoflines length compute visual length computevisuallength get current indent getcurrentindent document tab size tabsize length min indent minindent min indent minindent length min line minline min line minline indent result indentresult reuse or create token reuseorcreatetoken indent result indentresult token number of lines numberoflines token token indent result indentresult number of lines numberoflines token comment lines at column zero commentlinesatcolumnzero token comment lines at column zero commentlinesatcolumnzero number of lines numberoflines token comment lines at column zero commentlinesatcolumnzero length number of lines numberoflines comment bool eans commentbooleans number of lines numberoflines system arraycopy token comment lines at column zero commentlinesatcolumnzero comment bool eans commentbooleans math min number of lines numberoflines token comment lines at column zero commentlinesatcolumnzero length token comment lines at column zero commentlinesatcolumnzero comment bool eans commentbooleans token indents single java heuristic scanner javadoc multi comments indented code java doc auto indent strategy javadocautoindentstrategy code param document document param indented param indenter java indenter param scanner heuristic scanner param comment lines commentlines indent token comment booleans param line index lineindex based code code document modified code code bad location exception badlocationexception document changed concurrently indent line indentline i document idocument document java indenter javaindenter indenter java heuristic scanner javaheuristicscanner scanner comment lines commentlines line index lineindex tab size tabsize bad location exception badlocationexception i region iregion current line currentline document get line information getlineinformation offset current line currentline get offset getoffset start searching single comments ws start wsstart offset string indent offset document get length getlength i type d region itypedregion partition text utilities textutilities get partition getpartition document i java partitions ijavapartitions java partitioning offset i type d region itypedregion starting partition startingpartition text utilities textutilities get partition getpartition document i java partitions ijavapartitions java partitioning offset string type partition get type gettype type equals i java partitions ijavapartitions java doc type equals i java partitions ijavapartitions java multi comment indent compute javadoc indent computejavadocindent document scanner starting partition startingpartition comment lines commentlines line index lineindex starting partition startingpartition get offset getoffset offset starting partition startingpartition get type gettype equals i java partitions ijavapartitions java single comment standard java indentation indent string buffer stringbuffer computed indenter compute indentation computeindentation offset computed indent computed to string tostring indent string change document current white space line length linelength current line currentline get length getlength scanner find non whitespace for ward in any partition findnonwhitespaceforwardinanypartition ws start wsstart offset line length linelength java heuristic scanner javaheuristicscanner offset line length linelength length offset string current indent currentindent document offset length opposed commented code slashes column length i type d region itypedregion partition text utilities textutilities get partition getpartition document i java partitions ijavapartitions java partitioning partition get offset getoffset i java partitions ijavapartitions java single comment equals partition get type gettype comment lines commentlines line index lineindex change document real change indent equals current indent currentindent document replace offset length indent computes returns indentation javadoc javadoc comment param document document param document param scanner scanner param partition comment partition indent code code comp utable computable bad location exception badlocationexception string compute javadoc indent computejavadocindent i document idocument document java heuristic scanner javaheuristicscanner scanner i type d region itypedregion partition bad location exception badlocationexception impossible javadoc comment don assumptions start commented code don change indent i region iregion line info lineinfo document get line information getlineinformation line start linestart line info lineinfo get offset getoffset line length linelength line info lineinfo get length getlength line end lineend line start linestart line length linelength nonws scanner find non whitespace for ward in any partition findnonwhitespaceforwardinanypartition line start linestart line end lineend nonws java heuristic scanner javaheuristicscanner document get char getchar nonws nonws java heuristic scanner javaheuristicscanner document line start linestart line length linelength document line start linestart nonws line start linestart indent previous reuse i region iregion previous line previousline document get line information getlineinformation previous line start previouslinestart previous line previousline get offset getoffset previous line length previouslinelength previous line previousline get length getlength previous line end previouslineend previous line start previouslinestart previous line length previouslinelength string buffer stringbuffer buf string buffer stringbuffer previous line non s previouslinenonws scanner find non whitespace for ward in any partition findnonwhitespaceforwardinanypartition previous line start previouslinestart previous line end previouslineend previous line non s previouslinenonws java heuristic scanner javaheuristicscanner document get char getchar previous line non s previouslinenonws align comment start previous ast erix asterix previous line previousline document get line information of offset getlineinformationofoffset partition get offset getoffset previous line start previouslinestart previous line previousline get offset getoffset previous line length previouslinelength previous line previousline get length getlength previous line end previouslineend previous line start previouslinestart previous line length previouslinelength previous line non s previouslinenonws scanner find non whitespace for ward in any partition findnonwhitespaceforwardinanypartition previous line start previouslinestart previous line end previouslineend previous line non s previouslinenonws java heuristic scanner javaheuristicscanner previous line non s previouslinenonws previous line end previouslineend add initial space todo control led controlled formatter preference buf append string indentation document previous line start previouslinestart previous line non s previouslinenonws previous line start previouslinestart buf insert indentation buf to string tostring