copyright ibm corporation rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors ibm corporation initial api implementation org eclipse jdt internal corext refactoring util java util hash map hashmap java util list java util map org eclipse core runtime core exception coreexception org eclipse jdt core i buffer ibuffer org eclipse jdt core i java project ijavaproject org eclipse jdt core java core javacore org eclipse jdt core tool factory toolfactory org eclipse jdt core compiler i scanner iscanner org eclipse jdt core compiler i terminal symbols iterminalsymbols org eclipse jdt core dom ast node astnode org eclipse jdt core dom compilation unit compilationunit org eclipse jdt core dom rewrite target source range computer targetsourcerangecomputer org eclipse jdt core formatter indent manipulation indentmanipulation org eclipse jdt internal corext dom ast nodes astnodes org eclipse jdt internal corext dom token scanner tokenscanner selection aware source range computer selectionawaresourcerangecomputer target source range computer targetsourcerangecomputer ast node astnode f selected nodes fselectednodes f selection start fselectionstart f selection length fselectionlength map ast node astnode source range sourcerange f ranges franges string f document port ion to scan fdocumentportiontoscan selection aware source range computer selectionawaresourcerangecomputer ast node astnode selected nodes selectednodes i buffer ibuffer buffer selection start selectionstart selection length selectionlength f selected nodes fselectednodes selected nodes selectednodes f selection start fselectionstart selection start selectionstart f selection length fselectionlength selection length selectionlength f document port ion to scan fdocumentportiontoscan buffer get text gettext f selection start fselectionstart f selection length fselectionlength override source range sourcerange compute source range computesourcerange ast node astnode node f ranges franges initialize ranges initializeranges source range sourcerange result f ranges franges node result result compute source range computesourcerange node core exception coreexception f ranges franges hash map hashmap compute source range computesourcerange node initialize ranges initializeranges core exception coreexception f ranges franges hash map hashmap f selected nodes fselectednodes length f ranges franges f selected nodes fselectednodes compute source range computesourcerange f selected nodes fselectednodes f selected nodes fselectednodes length f ranges franges f selected nodes fselectednodes compute source range computesourcerange f selected nodes fselectednodes i java project ijavaproject java project javaproject compilation unit compilationunit f selected nodes fselectednodes get root getroot get type root gettyperoot get java project getjavaproject string source level sourcelevel java project javaproject get option getoption java core javacore compiler source string compliance level compliancelevel java project javaproject get option getoption java core javacore compiler compliance i scanner iscanner scanner tool factory toolfactory create scanner createscanner source level sourcelevel compliance level compliancelevel source f document port ion to scan fdocumentportiontoscan to char array tochararray scanner set source setsource source initialize ranges initializeranges called f document port ion to scan fdocumentportiontoscan token scanner tokenscanner tokenizer token scanner tokenscanner scanner pos tokenizer get next start offset getnextstartoffset ast node astnode current node currentnode f selected nodes fselectednodes new start newstart math min f selection start fselectionstart pos current node currentnode get start position getstartposition source range sourcerange range f ranges franges current node currentnode f ranges franges current node currentnode source range sourcerange new start newstart range get length getlength range get start position getstartposition new start newstart current node currentnode f selected nodes fselectednodes scanner start scannerstart current node currentnode get start position getstartposition current node currentnode get length getlength f selection start fselectionstart tokenizer set offset setoffset scanner start scannerstart pos scanner start scannerstart token token tokenizer read next readnext pos tokenizer get current end offset getcurrentendoffset core exception coreexception token i terminal symbols iterminalsymbols tokennamecomment pos indent manipulation indentmanipulation is line delimiter char islinedelimiterchar source pos new end newend math max f selection start fselectionstart pos current node currentnode get start position getstartposition current node currentnode get length getlength range f ranges franges current node currentnode f ranges franges current node currentnode source range sourcerange range get start position getstartposition new end newend range get start position getstartposition selection extended range transform node includes list ast node astnode children ast nodes astnodes get children getchildren current node currentnode children is empty isempty ast node astnode last child lastchild children children size source range sourcerange ext range extrange compute source range computesourcerange last child lastchild ext range extrange get start position getstartposition ext range extrange get length getlength new end newend f ranges franges last child lastchild source range sourcerange ext range extrange get start position getstartposition new end newend ext range extrange get start position getstartposition current node currentnode last child lastchild