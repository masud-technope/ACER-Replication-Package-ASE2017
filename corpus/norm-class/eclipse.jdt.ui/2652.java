copyright ibm corporation rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors ibm corporation initial api implementation org eclipse jdt internal text org eclipse core runtime org eclipse jface text bad location exception badlocationexception org eclipse jface text i document idocument org eclipse jface text i region iregion org eclipse jdt core i java project ijavaproject org eclipse jdt core java core javacore org eclipse jdt core formatter default code formatter constants defaultcodeformatterconstants org eclipse jdt internal corext util code formatter util codeformatterutil org eclipse jdt internal java plugin javaplugin link org eclipse jdt internal text java heuristic scanner javaheuristicscanner indentation level position document instance holds internal position document threads afe threadsafe java indenter javaindenter jdt core preferences core prefs coreprefs pref use tabs prefusetabs pref tab size preftabsize pref indentation size prefindentationsize pref array dimensions deep indent prefarraydimensionsdeepindent pref array indent prefarrayindent pref array deep indent prefarraydeepindent pref ternary deep align prefternarydeepalign pref ternary indent prefternaryindent pref case indent prefcaseindent pref case block indent prefcaseblockindent pref simple indent prefsimpleindent pref bracket indent prefbracketindent pref method decl deep indent prefmethoddecldeepindent pref method decl indent prefmethoddeclindent pref method call deep indent prefmethodcalldeepindent pref method call indent prefmethodcallindent pref parent hesis deep indent prefparenthesisdeepindent pref parent hesis indent prefparenthesisindent pref block indent prefblockindent pref method body indent prefmethodbodyindent pref type indent preftypeindent pref indent braces for blocks prefindentbracesforblocks pref indent braces for arrays prefindentbracesforarrays pref indent braces for methods prefindentbracesformethods pref indent braces for types prefindentbracesfortypes pref continuation indent prefcontinuationindent pref has generics prefhasgenerics string pref tab char preftabchar i java project ijavaproject f project fproject returns code code workbench code code normal mode code code plug ins is standalone isstandalone java core javacore get plugin getplugin returns project specific core preference defined code key code param key key preference preference string get core formatter option getcoreformatteroption string key f project fproject java core javacore get option getoption key f project fproject get option getoption key core prefs coreprefs i java project ijavaproject project f project fproject project is standalone isstandalone pref use tabs prefusetabs pref tab size preftabsize pref indentation size prefindentationsize pref array dimensions deep indent prefarraydimensionsdeepindent pref continuation indent prefcontinuationindent pref block indent prefblockindent pref array indent prefarrayindent pref continuation indent prefcontinuationindent pref array deep indent prefarraydeepindent pref ternary deep align prefternarydeepalign pref ternary indent prefternaryindent pref continuation indent prefcontinuationindent pref case indent prefcaseindent pref case block indent prefcaseblockindent pref block indent prefblockindent pref indent braces for blocks prefindentbracesforblocks pref simple indent prefsimpleindent pref indent braces for blocks prefindentbracesforblocks pref block indent prefblockindent pref block indent prefblockindent pref bracket indent prefbracketindent pref block indent prefblockindent pref method decl deep indent prefmethoddecldeepindent pref method decl indent prefmethoddeclindent pref method call deep indent prefmethodcalldeepindent pref method call indent prefmethodcallindent pref parent hesis deep indent prefparenthesisdeepindent pref parent hesis indent prefparenthesisindent pref continuation indent prefcontinuationindent pref method body indent prefmethodbodyindent pref type indent preftypeindent pref indent braces for arrays prefindentbracesforarrays pref indent braces for methods prefindentbracesformethods pref indent braces for types prefindentbracesfortypes pref has generics prefhasgenerics pref tab char preftabchar java core javacore tab pref use tabs prefusetabs pref use tabs prefusetabs pref tab size preftabsize pref tab size preftabsize pref indentation size prefindentationsize pref indentation size prefindentationsize pref array dimensions deep indent prefarraydimensionsdeepindent pref array dimensions deep indent prefarraydimensionsdeepindent pref continuation indent prefcontinuationindent pref continuation indent prefcontinuationindent pref block indent prefblockindent pref block indent prefblockindent pref array indent prefarrayindent pref array indent prefarrayindent pref array deep indent prefarraydeepindent pref array deep indent prefarraydeepindent pref ternary deep align prefternarydeepalign pref ternary deep align prefternarydeepalign pref ternary indent prefternaryindent pref ternary indent prefternaryindent pref case indent prefcaseindent pref case indent prefcaseindent pref case block indent prefcaseblockindent pref case block indent prefcaseblockindent pref indent braces for blocks prefindentbracesforblocks pref indent braces for blocks prefindentbracesforblocks pref simple indent prefsimpleindent pref simple indent prefsimpleindent pref bracket indent prefbracketindent pref bracket indent prefbracketindent pref method decl deep indent prefmethoddecldeepindent pref method decl deep indent prefmethoddecldeepindent pref method decl indent prefmethoddeclindent pref method decl indent prefmethoddeclindent pref method call deep indent prefmethodcalldeepindent pref method call deep indent prefmethodcalldeepindent pref method call indent prefmethodcallindent pref method call indent prefmethodcallindent pref parent hesis deep indent prefparenthesisdeepindent pref parent hesis deep indent prefparenthesisdeepindent pref parent hesis indent prefparenthesisindent pref parent hesis indent prefparenthesisindent pref method body indent prefmethodbodyindent pref method body indent prefmethodbodyindent pref type indent preftypeindent pref type indent preftypeindent pref indent braces for arrays prefindentbracesforarrays pref indent braces for arrays prefindentbracesforarrays pref indent braces for methods prefindentbracesformethods pref indent braces for methods prefindentbracesformethods pref indent braces for types prefindentbracesfortypes pref indent braces for types prefindentbracesfortypes pref has generics prefhasgenerics has generics hasgenerics pref tab char preftabchar get core formatter option getcoreformatteroption default code formatter constants defaultcodeformatterconstants formatter tab pref use tabs prefusetabs java core javacore space equals get core formatter option getcoreformatteroption default code formatter constants defaultcodeformatterconstants formatter tab pref tab size preftabsize code formatter util codeformatterutil get tab width gettabwidth f project fproject pref indentation size prefindentationsize code formatter util codeformatterutil get indent width getindentwidth f project fproject pref array dimensions deep indent prefarraydimensionsdeepindent formatter setting pref array indent prefarrayindent string option get core formatter option getcoreformatteroption default code formatter constants defaultcodeformatterconstants formatter alignment expressions array initializer default code formatter constants defaultcodeformatterconstants get indent style getindentstyle option default code formatter constants defaultcodeformatterconstants indent illegal argument exception illegalargumentexception pref continuation indent for array initializer prefcontinuationindentforarrayinitializer pref array deep indent prefarraydeepindent string option get core formatter option getcoreformatteroption default code formatter constants defaultcodeformatterconstants formatter alignment expressions array initializer default code formatter constants defaultcodeformatterconstants get indent style getindentstyle option default code formatter constants defaultcodeformatterconstants indent column illegal argument exception illegalargumentexception pref ternary deep align prefternarydeepalign string option get core formatter option getcoreformatteroption default code formatter constants defaultcodeformatterconstants formatter alignment conditional expression default code formatter constants defaultcodeformatterconstants get indent style getindentstyle option default code formatter constants defaultcodeformatterconstants indent column illegal argument exception illegalargumentexception pref ternary indent prefternaryindent string option get core formatter option getcoreformatteroption default code formatter constants defaultcodeformatterconstants formatter alignment conditional expression default code formatter constants defaultcodeformatterconstants get indent style getindentstyle option default code formatter constants defaultcodeformatterconstants indent pref continuation indent prefcontinuationindent illegal argument exception illegalargumentexception pref continuation indent prefcontinuationindent pref case indent prefcaseindent default code formatter constants defaultcodeformatterconstants equals get core formatter option getcoreformatteroption default code formatter constants defaultcodeformatterconstants formatter indent switchstatements compare pref block indent prefblockindent pref case block indent prefcaseblockindent default code formatter constants defaultcodeformatterconstants equals get core formatter option getcoreformatteroption default code formatter constants defaultcodeformatterconstants formatter indent switchstatements compare cases pref block indent prefblockindent pref simple indent prefsimpleindent pref indent braces for blocks prefindentbracesforblocks pref block indent prefblockindent pref block indent prefblockindent pref bracket indent prefbracketindent pref block indent prefblockindent pref method decl deep indent prefmethoddecldeepindent string option get core formatter option getcoreformatteroption default code formatter constants defaultcodeformatterconstants formatter alignment parameters method declaration default code formatter constants defaultcodeformatterconstants get indent style getindentstyle option default code formatter constants defaultcodeformatterconstants indent column illegal argument exception illegalargumentexception pref method decl indent prefmethoddeclindent string option get core formatter option getcoreformatteroption default code formatter constants defaultcodeformatterconstants formatter alignment parameters method declaration default code formatter constants defaultcodeformatterconstants get indent style getindentstyle option default code formatter constants defaultcodeformatterconstants indent pref continuation indent prefcontinuationindent illegal argument exception illegalargumentexception pref method call deep indent prefmethodcalldeepindent string option get core formatter option getcoreformatteroption default code formatter constants defaultcodeformatterconstants formatter alignment arguments method invocation default code formatter constants defaultcodeformatterconstants get indent style getindentstyle option default code formatter constants defaultcodeformatterconstants indent column illegal argument exception illegalargumentexception pref method call indent prefmethodcallindent string option get core formatter option getcoreformatteroption default code formatter constants defaultcodeformatterconstants formatter alignment arguments method invocation default code formatter constants defaultcodeformatterconstants get indent style getindentstyle option default code formatter constants defaultcodeformatterconstants indent pref continuation indent prefcontinuationindent illegal argument exception illegalargumentexception pref parent hesis deep indent prefparenthesisdeepindent don parenthesis deep indentation check rev exp erimental experimental code pref parent hesis indent prefparenthesisindent pref continuation indent prefcontinuationindent pref block indent prefblockindent string option get core formatter option getcoreformatteroption default code formatter constants defaultcodeformatterconstants formatter indent statements compare block default code formatter constants defaultcodeformatterconstants equals option pref method body indent prefmethodbodyindent default code formatter constants defaultcodeformatterconstants equals get core formatter option getcoreformatteroption default code formatter constants defaultcodeformatterconstants formatter indent statements compare body pref type indent preftypeindent string option get core formatter option getcoreformatteroption default code formatter constants defaultcodeformatterconstants formatter indent body declarations compare type header default code formatter constants defaultcodeformatterconstants equals option pref indent braces for blocks prefindentbracesforblocks default code formatter constants defaultcodeformatterconstants shifted equals get core formatter option getcoreformatteroption default code formatter constants defaultcodeformatterconstants formatter brace position block pref indent braces for arrays prefindentbracesforarrays default code formatter constants defaultcodeformatterconstants shifted equals get core formatter option getcoreformatteroption default code formatter constants defaultcodeformatterconstants formatter brace position array initializer pref indent braces for methods prefindentbracesformethods default code formatter constants defaultcodeformatterconstants shifted equals get core formatter option getcoreformatteroption default code formatter constants defaultcodeformatterconstants formatter brace position method declaration pref indent braces for types prefindentbracesfortypes default code formatter constants defaultcodeformatterconstants shifted equals get core formatter option getcoreformatteroption default code formatter constants defaultcodeformatterconstants formatter brace position type declaration pref continuation indent prefcontinuationindent integer parse int parseint get core formatter option getcoreformatteroption default code formatter constants defaultcodeformatterconstants formatter continuation indentation number format exception numberformatexception pref continuation indent for array initializer prefcontinuationindentforarrayinitializer integer parse int parseint get core formatter option getcoreformatteroption default code formatter constants defaultcodeformatterconstants formatter continuation indentation array initializer number format exception numberformatexception has generics hasgenerics java core javacore version compare to compareto get core formatter option getcoreformatteroption java core javacore compiler source document scanned i document idocument f document fdocument indentation accumulated code find reference position findreferenceposition code f indent findent absolute character counted indentation offset special cases method defs array initializers f align falign stat eful stateful scanpos ition scanposition indentation methods f position fposition previous position f previous pos fpreviouspos token f token ftoken code f position fposition code f line fline scanner scan document installed document java heuristic scanner javaheuristicscanner f scanner fscanner jdt core preferences core prefs coreprefs f prefs fprefs creates instance param document document scan param scanner link java heuristic scanner javaheuristicscanner scanning document installed code i document idocument code java indenter javaindenter i document idocument document java heuristic scanner javaheuristicscanner scanner document scanner creates instance param document document scan param scanner link java heuristic scanner javaheuristicscanner scanning document installed code i document idocument code param project java project formatter preferences code code workspace settings java indenter javaindenter i document idocument document java heuristic scanner javaheuristicscanner scanner i java project ijavaproject project is not null isnotnull document is not null isnotnull scanner f document fdocument document f scanner fscanner scanner f prefs fprefs core prefs coreprefs project computes indentation reference point code position code param offset offset document string ref lects reflects indentation reference position code offset code res ides resides code code determined string buffer stringbuffer get reference indentation getreferenceindentation offset get reference indentation getreferenceindentation offset computes indentation reference point code position code param offset offset document param assume opening brace assumeopeningbrace code code opening brace assumed string ref lects reflects indentation reference position code offset code res ides resides code code determined string buffer stringbuffer get reference indentation getreferenceindentation offset assume opening brace assumeopeningbrace unit assume opening brace assumeopeningbrace unit find reference position findreferenceposition offset symbols tokenlbrace unit find reference position findreferenceposition offset peek char peekchar offset unable find unit java heuristic scanner javaheuristicscanner get leading whitespace getleadingwhitespace unit computes indentation code offset code param offset offset document string ref lects reflects correct indentation offset res ides resides code code determined string buffer stringbuffer compute indentation computeindentation offset compute indentation computeindentation offset computes indentation code offset code param offset offset document param assume opening brace assumeopeningbrace code code opening brace assumed string ref lects reflects correct indentation offset res ides resides code code determined string buffer stringbuffer compute indentation computeindentation offset assume opening brace assumeopeningbrace string buffer stringbuffer reference get reference indentation getreferenceindentation offset assume opening brace assumeopeningbrace handle special alignment f align falign java heuristic scanner javaheuristicscanner special detected i region iregion f document fdocument get line information of offset getlineinformationofoffset f align falign line offset lineoffset get offset getoffset create indent createindent line offset lineoffset f align falign bad location exception badlocationexception reference add additional indent create r eusing indent createreusingindent reference f indent findent computes length code character sequence charactersequence code counting tab character size tab character param indent string measure visual length characters compute visual length computevisuallength char sequence charsequence indent tab size tabsize f prefs fprefs pref tab size preftabsize length indent length indent char at charat tab size tabsize reminder length tab size tabsize length tab size tabsize reminder length length str ips strips characters code reference code exc eed exceed code indent length indentlength code param reference string measure param indent length indentlength maximum visual indentation length str ipped stripped code reference code string buffer stringbuffer str ip e xceeding chars stripexceedingchars string buffer stringbuffer reference indent length indentlength tab size tabsize f prefs fprefs pref tab size preftabsize measured chars reference length measured indent length indentlength chars reference char at charat tab size tabsize reminder measured tab size tabsize measured tab size tabsize reminder measured delete from deletefrom measured indent length indentlength reference delete delete from deletefrom chars returns indentation code offset code code string buffer stringbuffer code offset valid empty string returned param offset offset document indentation leading whitespace code offset code located string buffer stringbuffer get leading whitespace getleadingwhitespace offset string buffer stringbuffer indent string buffer stringbuffer i region iregion f document fdocument get line information of offset getlineinformationofoffset offset line offset lineoffset get offset getoffset nonws f scanner fscanner find non whitespace for ward in any partition findnonwhitespaceforwardinanypartition line offset lineoffset line offset lineoffset get length getlength indent append f document fdocument line offset lineoffset nonws line offset lineoffset indent bad location exception badlocationexception indent creates indentation string length indent start consisting content code f document fdocument code range start indent character replaced space tabs code convert space runs to tabs convertspacerunstotabs code code code number spaces tab replaced tab character conversion takes place tabs original range copied verbatim param start start document region copy indent param indent exclusive document region copy indent param convert space runs to tabs convertspacerunstotabs convert consecutive runs spaces tabs indentation document content code start code code indent code string buffer stringbuffer create indent createindent start indent convert space runs to tabs convertspacerunstotabs convert tabs converttabs f prefs fprefs pref use tabs prefusetabs convert space runs to tabs convertspacerunstotabs tab len tablen f prefs fprefs pref tab size preftabsize string buffer stringbuffer ret string buffer stringbuffer spaces start indent f document fdocument get char getchar start ret append spaces convert tabs converttabs spaces spaces tab len tablen ret append spaces ret append start remainder spaces ret append bad location exception badlocationexception ret creates string visual length code indentation size indentationsize code param buffer original indent reuse param additional additional indentation units add sub tract subtract reference modified code buffer code ref lecting reflecting indentation adapted code additional code string buffer stringbuffer create r eusing indent createreusingindent string buffer stringbuffer buffer additional ref length reflength compute visual length computevisuallength buffer add length addlength f prefs fprefs pref indentation size prefindentationsize additional total length totallength math max ref length reflength add length addlength copy reference indentation indent tab max copy maxcopy area min length minlength math min total length totallength ref length reflength tab size tabsize f prefs fprefs pref tab size preftabsize maximum indent copy max copy length maxcopylength tab size tabsize min length minlength min length minlength tab size tabsize min length minlength str ip e xceeding chars stripexceedingchars buffer max copy length maxcopylength add additional indent missing total length totallength max copy length maxcopylength tabs spaces java core javacore space equals f prefs fprefs pref tab char preftabchar tabs spaces missing java core javacore tab equals f prefs fprefs pref tab char preftabchar tabs tab size tabsize missing tab size tabsize spaces tab size tabsize missing tab size tabsize missing default code formatter constants defaultcodeformatterconstants mixed equals f prefs fprefs pref tab char preftabchar tabs tab size tabsize missing tab size tabsize spaces tab size tabsize missing tab size tabsize missing is true istrue tabs buffer append spaces buffer append buffer returns reference position indentation code offset code code code method calls link find reference position findreferenceposition find reference position findreferenceposition offset next char nextchar code next char nextchar code character code offset code param offset offset reference computed reference statement relative code offset code indented link java heuristic scanner javaheuristicscanner find reference position findreferenceposition offset find reference position findreferenceposition offset peek char peekchar offset peeks document code offset code code offset code param offset offset document token symbol element tokeneof peek char peekchar offset offset f document fdocument get length getlength i region iregion f document fdocument get line information of offset getlineinformationofoffset offset line offset lineoffset get offset getoffset f scanner fscanner next token nexttoken offset line offset lineoffset get length getlength bad location exception badlocationexception symbols tokeneof returns reference position indentation code position code code code code peek next char peeknextchar code code code token code offset code read account computing indentation token token preceded whitespace tokens spec ially specially handled code code labels indented relative block opening curly braces aligned correctly int roducing introducing code closing curly braces aligned properly int roducing introducing code matching opening brace closing parenthesis aligned opening peer code code keyword aligned code code aligned base int roducing introducing statements token code offset code indentation code code keyword param offset offset reference computed param next token nexttoken token assume document reference statement relative code offset code indented link java heuristic scanner javaheuristicscanner find reference position findreferenceposition offset next token nexttoken dangling else danglingelse unindent indent match brace matchbrace match paren matchparen match case matchcase throws clause throwsclause account dangling offset f document fdocument get length getlength i region iregion f document fdocument get line information of offset getlineinformationofoffset offset line offset lineoffset get offset getoffset prev pos prevpos math max offset is first token on line isfirsttokenonline f document fdocument line offset lineoffset prev pos prevpos line offset lineoffset trim length prev token prevtoken f scanner fscanner previous token previoustoken prev pos prevpos java heuristic scanner javaheuristicscanner unbound brace less block start bracelessblockstart f scanner fscanner is brace less block start isbracelessblockstart prev pos prevpos java heuristic scanner javaheuristicscanner unbound next token nexttoken symbols tokenelse dangling else danglingelse symbols tokendefault f scanner fscanner next token nexttoken offset line offset lineoffset get length getlength f scanner fscanner next token nexttoken f scanner fscanner get position getposition java heuristic scanner javaheuristicscanner unbound symbols tokencolon fall symbols tokencase is first token on line isfirsttokenonline match case matchcase opening brace style symbols tokenlbrace brace less block start bracelessblockstart f prefs fprefs pref indent braces for blocks prefindentbracesforblocks unindent prev token prevtoken symbols tokencolon prev token prevtoken symbols tokenequal f prefs fprefs pref indent braces for arrays prefindentbracesforarrays unindent brace less block start bracelessblockstart f prefs fprefs pref indent braces for methods prefindentbracesformethods indent closing braces unindented symbols tokenrbrace is first token on line isfirsttokenonline match brace matchbrace symbols tokenrparen is first token on line isfirsttokenonline match paren matchparen symbols tokenthrows throws clause throwsclause symbols tokenplus is string continuation isstringcontinuation offset is second line of string continuation issecondlineofstringcontinuation offset f align falign java heuristic scanner javaheuristicscanner f indent findent f prefs fprefs pref continuation indent prefcontinuationindent previous line offset previouslineoffset f document fdocument get line offset getlineoffset f document fdocument get line of offset getlineofoffset offset f align falign f scanner fscanner find non whitespace for ward in any partition findnonwhitespaceforwardinanypartition previous line offset previouslineoffset java heuristic scanner javaheuristicscanner unbound f position fposition bad location exception badlocationexception don assume file dangling else danglingelse find reference position findreferenceposition offset dangling else danglingelse match brace matchbrace match paren matchparen match case matchcase throws clause throwsclause unindent f indent findent indent f indent findent tells string continuation expression param offset offset check code code offset string continuation code code is string continuation isstringcontinuation offset next non char position nextnonwscharposition f scanner fscanner find non whitespace backward in any partition findnonwhitespacebackwardinanypartition offset java heuristic scanner javaheuristicscanner unbound next non char position nextnonwscharposition java heuristic scanner javaheuristicscanner f document fdocument get char getchar next non char position nextnonwscharposition bad location exception badlocationexception java plugin javaplugin log checks extra indentation string continuation required param offset offset check returns code code extra indentation string continuation required is second line of string continuation issecondlineofstringcontinuation offset offset line offsetline f document fdocument get line of offset getlineofoffset offset f position fposition offset next token nexttoken f token ftoken scopes skip symbols tokenrparen symbols tokenrbracket symbols tokenrbrace symbols tokengreaterthan skip scope skipscope symbols tokenplus offset line offsetline f line fline symbols tokencomma symbols tokenlparen symbols tokenlbrace symbols tokenequal string starting offset stringstartingoffset f scanner fscanner find non whitespace for ward in any partition findnonwhitespaceforwardinanypartition f position fposition java heuristic scanner javaheuristicscanner unbound string starting line stringstartingline f document fdocument get line of offset getlineofoffset string starting offset stringstartingoffset offset line offsetline string starting line stringstartingline f position fposition string starting offset stringstartingoffset symbols tokenlbracket symbols tokeneof offset line offsetline f line fline bad location exception badlocationexception java plugin javaplugin log returns reference position indentation code position code code code code f indent findent code relative indentation indentation units characters call special alignment method declaration parameters aligned code f align falign code absolute position alignment reference code f document fdocument code code f align falign code code java heuristic scanner javaheuristicscanner code method calls link find reference position findreferenceposition find reference position findreferenceposition offset dangling else danglingelse match brace matchbrace match paren matchparen match case matchcase throws clause throwsclause code throws clause throwsclause code clause code position code param offset offset reference computed param dangling else danglingelse dangling assumed code position code param match brace matchbrace position matching brace returned code analysis param match paren matchparen position matching parenthesis returned code analysis param match case matchcase position statement reference returned earlier statement block brace reference statement relative code position code indented link java heuristic scanner javaheuristicscanner find reference position findreferenceposition offset dangling else danglingelse match brace matchbrace match paren matchparen match case matchcase find reference position findreferenceposition offset dangling else danglingelse match brace matchbrace match paren matchparen match case matchcase returns reference position indentation code position code code code code f indent findent code relative indentation indentation units characters call special alignment method declaration parameters aligned code f align falign code absolute position alignment reference code f document fdocument code code f align falign code code java heuristic scanner javaheuristicscanner code param offset offset reference computed param dangling else danglingelse dangling assumed code position code param match brace matchbrace position matching brace returned code analysis param match paren matchparen position matching parenthesis returned code analysis param match case matchcase position statement reference returned earlier statement block brace param throws clause throwsclause clause code position code reference statement relative code position code indented link java heuristic scanner javaheuristicscanner find reference position findreferenceposition offset dangling else danglingelse match brace matchbrace match paren matchparen match case matchcase throws clause throwsclause indentation modification f indent findent f align falign java heuristic scanner javaheuristicscanner f position fposition offset opening brace match brace matchbrace skip scope skipscope symbols tokenlbrace symbols tokenrbrace align opening brace line offset lineoffset f document fdocument get line offset getlineoffset f line fline line offset lineoffset f position fposition f document fdocument line offset lineoffset f position fposition line offset lineoffset trim length f position fposition bad location exception badlocationexception opening brace start skip start pos skip to statement start skiptostatementstart indent aligned reference position f indent findent pos find matching brace heuristic unindent normal position pos find reference position findreferenceposition offset dangling else danglingelse match paren matchparen match case matchcase throws clause throwsclause f indent findent pos align parenthesis match paren matchparen skip scope skipscope symbols tokenlparen symbols tokenrparen f indent findent f prefs fprefs pref continuation indent prefcontinuationindent f position fposition find matching paren heuristic unindent normal position pos find reference position findreferenceposition offset dangling else danglingelse match brace matchbrace match case matchcase throws clause throwsclause f indent findent pos statement scope opening brace match case matchcase match case alignment matchcasealignment stored pos storedpos f position fposition peek char peekchar offset symbols tokenlbrace looks like method decl brace lookslikemethoddecllbrace offset skip to statement start skiptostatementstart dangling else danglingelse f position fposition stored pos storedpos next token nexttoken f token ftoken symbols tokengreaterthan symbols tokenrbrace skip block fall complete scope reset scan position pos f position fposition skip scope skipscope f position fposition pos skip to statement start skiptostatementstart dangling else danglingelse symbols tokensemicolon statement block previous statement block previous search statement block previous token previous start pos f position fposition is semicolon part of for statement issemicolonpartofforstatement f indent findent f prefs fprefs pref continuation indent prefcontinuationindent f position fposition f position fposition pos is try with resources istrywithresources f indent findent f prefs fprefs pref continuation indent prefcontinuationindent f position fposition f position fposition pos is semicolon part of enum body declaration issemicolonpartofenumbodydeclaration f indent findent get block indent getblockindent f position fposition f position fposition pos skip to statement start skiptostatementstart dangling else danglingelse scope int roduction introduction special treat special symbols tokenlparen symbols tokenlbrace symbols tokenlbracket handle scope int roduction handlescopeintroduction offset symbols tokeneof trap hit ting hitting start document java heuristic scanner javaheuristicscanner symbols tokenequal indent assignments handle equal handleequal symbols tokencolon todo handle ternary deep indentation f indent findent f prefs fprefs pref case block indent prefcaseblockindent f position fposition symbols tokenquestionmark f prefs fprefs pref ternary deep align prefternarydeepalign set first element alignment setfirstelementalignment f position fposition offset f position fposition f indent findent f prefs fprefs pref ternary indent prefternaryindent f position fposition indentation block less blockless intro ducers introducers symbols tokendo symbols tokenwhile symbols tokenelse f indent findent f prefs fprefs pref simple indent prefsimpleindent f position fposition symbols tokentry skip to statement start skiptostatementstart dangling else danglingelse symbols tokenrbracket f indent findent f prefs fprefs pref continuation indent prefcontinuationindent f position fposition symbols tokenrparen throws clause throwsclause f indent findent f prefs fprefs pref continuation indent prefcontinuationindent f position fposition f line fline r paren rparen f position fposition skip scope skipscope symbols tokenlparen symbols tokenrparen scope f position fposition next token nexttoken f token ftoken symbols tokenif f token ftoken symbols tokenwhile f token ftoken symbols tokenfor f indent findent f prefs fprefs pref simple indent prefsimpleindent f position fposition f position fposition scope f token ftoken symbols tokencatch skip to statement start skiptostatementstart dangling else danglingelse f position fposition scope looks like anonymous type decl lookslikeanonymoustypedecl r paren rparen skip to statement start skiptostatementstart dangling else danglingelse f position fposition scope looks like annotation lookslikeannotation skip to statement start skiptostatementstart dangling else danglingelse f position fposition scope looks like string continuation lookslikestringcontinuation f position fposition restore f position fposition offset f line fline skip to previous list item or list start skiptopreviouslistitemorliststart symbols tokenreturn f indent findent f prefs fprefs pref continuation indent prefcontinuationindent f position fposition symbols tokenplus is string continuation isstringcontinuation f position fposition is second line of string continuation issecondlineofstringcontinuation offset f align falign java heuristic scanner javaheuristicscanner f indent findent f prefs fprefs pref continuation indent prefcontinuationindent previous line offset previouslineoffset f document fdocument get line offset getlineoffset f document fdocument get line of offset getlineofoffset offset f align falign f scanner fscanner find non whitespace for ward in any partition findnonwhitespaceforwardinanypartition previous line offset previouslineoffset java heuristic scanner javaheuristicscanner unbound bad location exception badlocationexception java plugin javaplugin log f position fposition f position fposition offset skip to previous list item or list start skiptopreviouslistitemorliststart symbols tokencomma indent list indent indent expression start scope int roducer introducer start expr skip to previous list item or list start skiptopreviouslistitemorliststart checks symbols tokenlbrace code offset code represents method body declaration param offset document offset link peek char peekchar peek char peekchar offset returns symbols tokenlbrace code code left brace code offset code method body declaration code code looks like method decl brace lookslikemethoddecllbrace offset next token nexttoken f token ftoken symbols tokenthrows identifier exception annotation annotation symbols tokenident symbols tokencomma symbols tokenat array value d valued type symbols tokenlbracket symbols tokenrbracket tokens method declaration dot qualification symbols tokenother f document fdocument get char getchar f position fposition bad location exception badlocationexception parenthesis annotation method declaration symbols tokenrparen skip scope skipscope stored pos storedpos f position fposition looks like method decl lookslikemethoddecl f position fposition stored pos storedpos symbols tokeneof next token nexttoken checks statement position continuation previous sets indentation continuation indent position token handle equal handleequal continuation previous i region iregion f document fdocument get line information of offset getlineinformationofoffset f position fposition nonws f scanner fscanner find non whitespace backward findnonwhitespacebackward get offset getoffset java heuristic scanner javaheuristicscanner unbound nonws symbols tokeneof token at previous line tokenatpreviousline f scanner fscanner next token nexttoken nonws nonws token at previous line tokenatpreviousline symbols tokensemicolon token at previous line tokenatpreviousline symbols tokenrbrace token at previous line tokenatpreviousline symbols tokenlbrace token at previous line tokenatpreviousline symbols tokeneof f position fposition bad location exception badlocationexception f position fposition f indent findent f prefs fprefs pref continuation indent prefcontinuationindent f position fposition checks semicolon current position statement returns code code current position statement is semicolon part of for statement issemicolonpartofforstatement semi colon count semicoloncount next token nexttoken f token ftoken symbols tokenfor symbols tokenlbrace symbols tokensemicolon semi colon count semicoloncount semi colon count semicoloncount symbols tokencolon symbols tokeneof checks semicolon current position resources statement returns code code current position resources statement is try with resources istrywithresources next token nexttoken f token ftoken symbols tokentry symbols tokenlbrace symbols tokeneof skips start statement ends current position param dangling else danglingelse indent aligned code code param is in block isinblock current position block limits search scope scope int roducer introducer reference offset start statement skip to statement start skiptostatementstart dangling else danglingelse is in block isinblock read parens read ident may be method body maybemethodbody is type body istypebody next token nexttoken is in block isinblock f token ftoken exit block intro ducers introducers symbols tokenif symbols tokenelse symbols tokencatch symbols tokendo symbols tokenwhile symbols tokenfinally symbols tokenfor symbols tokentry f position fposition symbols tokenstatic treat blocks methods may be method body maybemethodbody read ident symbols tokensynchronized block indentation may be method body maybemethodbody read ident f position fposition symbols tokenclass symbols tokeninterface symbols tokenenum is type body istypebody symbols tokenswitch f indent findent f prefs fprefs pref case indent prefcaseindent f position fposition f token ftoken token start statement previous pos previouspos scanning symbols tokenlparen symbols tokenlbrace symbols tokenlbracket symbols tokensemicolon symbols tokeneof is in block isinblock f indent findent get block indent getblockindent may be method body maybemethodbody read ident is type body istypebody f indent findent previous calls f previous pos fpreviouspos symbols tokencolon pos f previous pos fpreviouspos is conditional isconditional pos symbols tokenrbrace rbrace tricky array definition previous block store pos f previous pos fpreviouspos skip scope skipscope looks like array initializer intro lookslikearrayinitializerintro array is in block isinblock f indent findent get block indent getblockindent may be method body maybemethodbody read ident is type body istypebody pos scopes skip symbols tokenrparen is in block isinblock may be method body maybemethodbody read parens fall symbols tokenrbracket symbols tokengreaterthan pos f previous pos fpreviouspos skip scope skipscope pos order work skip symbols tokenif dangling else danglingelse f position fposition symbols tokenelse skip covered pos f position fposition skip next f skipnextif pos symbols tokencatch symbols tokenfinally pos f position fposition skipnexttry pos symbols tokendo align position f position fposition symbols tokenwhile tricky start loop pos f position fposition has matching do hasmatchingdo searching searching f position fposition pos symbols tokenident may be method body maybemethodbody read parens may be method body maybemethodbody read ident get block indent getblockindent is method body ismethodbody is type body istypebody is type body istypebody f prefs fprefs pref type indent preftypeindent f prefs fprefs pref indent braces for types prefindentbracesfortypes is method body ismethodbody f prefs fprefs pref method body indent prefmethodbodyindent f prefs fprefs pref indent braces for methods prefindentbracesformethods f indent findent returns colon current position conditional ternary expression colon current position conditional is conditional isconditional next token nexttoken f token ftoken search labels consist qualified identifiers numbers symbols tokenident dots qualified constants symbols tokenother symbols tokencase symbols tokendefault returns reference previous code code labels code code code code offset brace scopes statement sets code f indent findent code code pref case indent prefcaseindent code match reference offset code code label match case alignment matchcasealignment next token nexttoken f token ftoken bail current position symbols tokenlparen symbols tokenlbracket symbols tokeneof f position fposition symbols tokenlbrace opening brace statement f indent findent f prefs fprefs pref case indent prefcaseindent f position fposition symbols tokencase symbols tokendefault align previous label f indent findent f position fposition scopes skip symbols tokenrparen symbols tokenrbracket symbols tokenrbrace symbols tokengreaterthan skip scope skipscope searching returns reference position list element algorithm match previous indentation list reference position returned determined depending type list indentation match list scope int roducer introducer method declarations called deep indents simply inc rease increase indentation number standard indents link handle scope int roduction handlescopeintroduction reference position list item previous list item indentation list int roduction introduction start skip to previous list item or list start skiptopreviouslistitemorliststart start line startline f line fline start position startposition f position fposition next token nexttoken item indentation adapt f line fline start line startline line offset lineoffset f document fdocument get line offset getlineoffset start line startline bound math min f document fdocument get length getlength start position startposition f align falign f scanner fscanner find non whitespace for ward in any partition findnonwhitespaceforwardinanypartition line offset lineoffset bound bad location exception badlocationexception start position startposition f token ftoken scopes skip symbols tokenrparen symbols tokenrbracket symbols tokenrbrace symbols tokengreaterthan skip scope skipscope start line startline f line fline start position startposition f position fposition scope int roduction introduction special treat special symbols tokenlparen symbols tokenlbrace symbols tokenlbracket handle scope int roduction handlescopeintroduction start position startposition symbols tokensemicolon saved position savedposition f position fposition is semicolon part of for statement issemicolonpartofforstatement f indent findent f prefs fprefs pref continuation indent prefcontinuationindent f position fposition saved position savedposition f position fposition symbols tokenquestionmark f prefs fprefs pref ternary deep align prefternarydeepalign set first element alignment setfirstelementalignment f position fposition f position fposition f position fposition f indent findent f prefs fprefs pref ternary indent prefternaryindent f position fposition symbols tokenreturn f indent findent f prefs fprefs pref continuation indent prefcontinuationindent f position fposition symbols tokenequal handle equal handleequal symbols tokeneof skips scope positions cursor code f position fposition code token opens scope returns code code matching peer code code current token calling code symbols tokenrparen code code symbols tokenrbrace code code symbols tokenrbracket code code code matching peer code code skip scope skipscope f token ftoken symbols tokenrparen skip scope skipscope symbols tokenlparen symbols tokenrparen symbols tokenrbracket skip scope skipscope symbols tokenlbracket symbols tokenrbracket symbols tokenrbrace skip scope skipscope symbols tokenlbrace symbols tokenrbrace symbols tokengreaterthan f prefs fprefs pref has generics prefhasgenerics stored position storedposition f position fposition stored token storedtoken f token ftoken next token nexttoken f token ftoken symbols tokenlessthan symbols tokenident is generic starter isgenericstarter is generic starter isgenericstarter java heuristic scanner javaheuristicscanner is generic starter isgenericstarter get token content gettokencontent bad location exception badlocationexception is generic starter isgenericstarter fall symbols tokenquestionmark symbols tokengreaterthan skip scope skipscope symbols tokenlessthan symbols tokengreaterthan harder detect restore position fail f position fposition stored position storedposition f token ftoken stored token storedtoken is true istrue returns contents current token contents current token bad location exception badlocationexception indices bounds char sequence charsequence get token content gettokencontent bad location exception badlocationexception document character iterator documentcharacteriterator f document fdocument f position fposition f previous pos fpreviouspos handles int roduction introduction scope current token code symbols tokenlparen code code symbols tokenlbrace code code symbols tokenlbracket code returns reference position token int roducing introducing scope java token depending type scope int roduction introduction indentation align deep indenting reference position code f align falign code reference position code f indent findent code number indentation units param bound bound search token scope int roduction introduction indent handle scope int roduction handlescopeintroduction bound f token ftoken scope int roduction introduction special treat special symbols tokenlparen store pos store f position fposition special method declaration deep indentation looks like method decl lookslikemethoddecl f prefs fprefs pref method decl deep indent prefmethoddecldeepindent set first element alignment setfirstelementalignment pos bound f indent findent f prefs fprefs pref method decl indent prefmethoddeclindent pos f position fposition pos looks like method call lookslikemethodcall f prefs fprefs pref method call deep indent prefmethodcalldeepindent set first element alignment setfirstelementalignment pos bound f indent findent f prefs fprefs pref method call indent prefmethodcallindent pos f prefs fprefs pref parent hesis deep indent prefparenthesisdeepindent set first element alignment setfirstelementalignment pos bound normal parenthesis reference f indent findent f prefs fprefs pref parent hesis indent prefparenthesisindent pos symbols tokenlbrace store pos store f position fposition special array initializer looks like array initializer intro lookslikearrayinitializerintro f prefs fprefs pref array deep indent prefarraydeepindent set first element alignment setfirstelementalignment pos bound f indent findent f prefs fprefs pref array indent prefarrayindent pos f indent findent f prefs fprefs pref block indent prefblockindent opening braces diff erently differently indents method definition looks like array initializer intro lookslikearrayinitializerintro f prefs fprefs pref indent braces for arrays prefindentbracesforarrays f prefs fprefs pref indent braces for blocks prefindentbracesforblocks restore f position fposition pos match skip to statement start skiptostatementstart pos symbols tokenlbracket store pos store f position fposition special method declaration deep indentation f prefs fprefs pref array dimensions deep indent prefarraydimensionsdeepindent set first element alignment setfirstelementalignment pos bound normal bracket reference f indent findent f prefs fprefs pref bracket indent prefbracketindent restore pos is true istrue dummy sets deep indent offset code f align falign code offset code scope introduce r offset scopeintroduceroffset code java token code scope introduce r offset scopeintroduceroffset code code bound code param scope introduce r offset scopeintroduceroffset offset scope int roducer introducer param bound bound search element reference position set first element alignment setfirstelementalignment scope introduce r offset scopeintroduceroffset bound align position scope int ro intro first possible firstpossible scope introduce r offset scopeintroduceroffset f align falign f scanner fscanner find non whitespace for ward in any partition findnonwhitespaceforwardinanypartition first possible firstpossible bound f align falign java heuristic scanner javaheuristicscanner f align falign first possible firstpossible f align falign returns code code token received calling code next token nexttoken code equal sign array designator preceded array creation code code elements start array definition looks like array initializer intro lookslikearrayinitializerintro next token nexttoken f token ftoken symbols tokenequal skip scope skipscope symbols tokenlbracket symbols tokenrbracket next token nexttoken type f token ftoken symbols tokenident next token nexttoken dot qualification f token ftoken symbols tokenother next token nexttoken qualifying f token ftoken symbols tokenident next token nexttoken f token ftoken symbols tokennew returns code code current position enum declaration header calls link next token nexttoken scan code code current position enum declaration header looks like enum declaration lookslikeenumdeclaration next token nexttoken f token ftoken symbols tokenenum symbols tokenident symbols tokencomma symbols tokenat symbols tokenother f document fdocument get char getchar f position fposition bad location exception badlocationexception symbols tokenrparen symbols tokenrbracket symbols tokenrbrace symbols tokengreaterthan skip scope skipscope symbols tokeneof checks semicolon current position enum body declaration returns code code semicolon current position enum body declaration is semicolon part of enum body declaration issemicolonpartofenumbodydeclaration next token nexttoken f token ftoken symbols tokenlbrace looks like enum declaration lookslikeenumdeclaration symbols tokenident symbols tokencomma symbols tokenrparen symbols tokenrbracket symbols tokenrbrace symbols tokengreaterthan skip scope skipscope symbols tokeneof skips code code keyword current token calling method code code keyword returns code code matching code code code code cursor code f position fposition code offset code code token code code matching code code token code code skip next f skipnextif is true istrue f token ftoken symbols tokenelse next token nexttoken f token ftoken scopes skip symbols tokenrparen symbols tokenrbracket symbols tokenrbrace symbols tokengreaterthan skip scope skipscope symbols tokenif symbols tokenelse recursively skip blocks skip next f skipnextif short cut shortcut scope starts symbols tokenlparen symbols tokenlbrace symbols tokenlbracket symbols tokeneof skips code code keyword current token calling method code code code code keyword returns code code matching code code code code cursor code f position fposition code offset code code token code code matching code code token code code skipnexttry is true istrue f token ftoken symbols tokencatch f token ftoken symbols tokenfinally next token nexttoken f token ftoken scopes skip symbols tokenrparen symbols tokenrbracket symbols tokenrbrace symbols tokengreaterthan skip scope skipscope symbols tokentry short cut shortcut scope starts symbols tokenlparen symbols tokenlbrace symbols tokenlbracket symbols tokeneof condition ambiguous parsed back war dly backwardly valid statement check matching code code separated block single statement limits search distance code code code code code f token ftoken code matching code code has matching do hasmatchingdo is true istrue f token ftoken symbols tokenwhile next token nexttoken f token ftoken symbols tokenrbrace skip scope skipscope fall symbols tokensemicolon skip to statement start skiptostatementstart f token ftoken symbols tokendo skips brackets current token rbracket whitespace code code elements code code code code scanned current token left lbracket skip brackets skipbrackets f token ftoken symbols tokenrbracket next token nexttoken f token ftoken symbols tokenlbracket reads token direction heuristic scanner sets fields code f token ftoken f previous position fpreviousposition code code f position fposition code next token nexttoken next token nexttoken f position fposition reads token direction code start code heuristic scanner sets fields code f token ftoken f previous position fpreviousposition code code f position fposition code param start start offset scan next token nexttoken start f token ftoken f scanner fscanner previous token previoustoken start java heuristic scanner javaheuristicscanner unbound f previous pos fpreviouspos start f position fposition f scanner fscanner get position getposition f line fline f document fdocument get line of offset getlineofoffset f position fposition bad location exception badlocationexception f line fline checks current position represents method call string continuation current token represent left parenthesis method call code code current position method call string continuation code code looks like string continuation lookslikestringcontinuation next token nexttoken method f token ftoken symbols tokenident next token nexttoken type arguments f token ftoken symbols tokengreaterthan skip scope skipscope symbols tokenlessthan symbols tokengreaterthan next token nexttoken dot qualification f token ftoken symbols tokenother next token nexttoken qualifying f token ftoken symbols tokenident next token nexttoken f token ftoken symbols tokenrparen skip scope skipscope symbols tokenlparen symbols tokenrparen next token nexttoken f token ftoken symbols tokenplus returns code code current tokens method declaration header type method heuristic calls code next token nexttoken code expects identifier method type declaration identifier optional brackets covers visibility modifier constructors recognize visible constructors code code current position method declaration header looks like method decl lookslikemethoddecl todo heuristic recognize constructors type visibility key words keywords option parameter list empty type d typed hard ast next token nexttoken method f token ftoken symbols tokenident next token nexttoken optional brackets array value d valued types skip brackets skipbrackets f token ftoken symbols tokengreaterthan parameterized type skip scope skipscope symbols tokenlessthan symbols tokengreaterthan next token nexttoken type f token ftoken symbols tokenident returns code code current tokens annotation annotation qualified preceded sign code code current position annotation looks like annotation lookslikeannotation next token nexttoken annotation f token ftoken symbols tokenident next token nexttoken dot qualification f token ftoken symbols tokenother next token nexttoken qualifying f token ftoken symbols tokenident next token nexttoken f token ftoken symbols tokenat returns code code current tokens anonymous type declaration header type qualified keyword heuristic calls code next token nexttoken code expects qualified identifier type keyword param r paren rparen offset parenthesis code code current position anonymous type declaration header looks like anonymous type decl lookslikeanonymoustypedecl r paren rparen non ws f wd nonwsfwd f scanner fscanner find non whitespace for ward in any partition findnonwhitespaceforwardinanypartition r paren rparen java heuristic scanner javaheuristicscanner unbound non ws f wd nonwsfwd java heuristic scanner javaheuristicscanner f document fdocument get char getchar non ws f wd nonwsfwd bad location exception badlocationexception next token nexttoken f token ftoken symbols tokengreaterthan parameterized type skip scope skipscope symbols tokenlessthan symbols tokengreaterthan next token nexttoken type f token ftoken symbols tokenident next token nexttoken dot qualification f token ftoken symbols tokenother next token nexttoken qualifying f token ftoken symbols tokenident next token nexttoken f token ftoken symbols tokennew returns code code current tokens method call header identifier opposed keyword parenthesized parameters code code heuristic calls code next token nexttoken code expects identifier method code code current position method call header looks like method call lookslikemethodcall todo add awareness constructor calls types array list arraylist string next token nexttoken method f token ftoken symbols tokenident s cans scans tokens matching opening peer internal cursor code f position fposition code offset opening peer param open token opentoken opening peer token param close token closetoken closing peer token code code matching token code code skip scope skipscope open token opentoken close token closetoken depth next token nexttoken f token ftoken close token closetoken depth f token ftoken open token opentoken depth depth f token ftoken symbols tokeneof