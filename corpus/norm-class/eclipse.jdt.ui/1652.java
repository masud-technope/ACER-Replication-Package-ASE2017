copyright ibm corporation rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors ibm corporation initial api implementation matt chapman mpchapman gmail jdt java agnostic org eclipse jdt internal wizards java io exception ioexception java input stream inputstream java util array list arraylist java util collections java util comparator java util hash map hashmap java util hash set hashset java util iterator java util list java util ibm icu text collator org eclipse core runtime core exception coreexception org eclipse core runtime i path ipath org eclipse core runtime i progress monitor iprogressmonitor org eclipse core runtime i status istatus org eclipse core runtime null progress monitor nullprogressmonitor org eclipse core runtime operation canceled exception operationcanceledexception org eclipse core runtime path org eclipse core runtime status org eclipse core resources i file ifile org eclipse core resources i project iproject org eclipse core resources i resource iresource org eclipse core resources i resource proxy iresourceproxy org eclipse core resources i resource proxy visitor iresourceproxyvisitor org eclipse jdt core i classpath entry iclasspathentry org eclipse jdt core i compilation unit icompilationunit org eclipse jdt core java conventions javaconventions org eclipse jdt core java core javacore org eclipse jdt core tool factory toolfactory org eclipse jdt core compiler char operation charoperation org eclipse jdt core dom ast parser astparser org eclipse jdt core dom compilation unit compilationunit org eclipse jdt core dom package declaration packagedeclaration org eclipse jdt core util i class file reader iclassfilereader org eclipse jdt core util i source attribute isourceattribute org eclipse jdt internal corext util java conventions util javaconventionsutil org eclipse jdt internal corext util messages org eclipse jdt preference constants preferenceconstants org eclipse jdt internal java plugin javaplugin org eclipse jdt internal java editor javaeditor ast provider astprovider org eclipse jdt internal viewsupport basic element labels basicelementlabels class path detector classpathdetector i resource proxy visitor iresourceproxyvisitor hash map hashmap i path ipath list i path ipath f source folders fsourcefolders list i resource iresource f class files fclassfiles hash set hashset i path ipath fjarfiles i project iproject f project fproject i path ipath f result output folder fresultoutputfolder i classpath entry iclasspathentry f result classpath fresultclasspath i progress monitor iprogressmonitor f monitor fmonitor cp sorter cpsorter comparator i classpath entry iclasspathentry collator f collator fcollator collator get instance getinstance override compare i classpath entry iclasspathentry i classpath entry iclasspathentry f collator fcollator compare get path getpath to string tostring get path getpath to string tostring class path detector classpathdetector i project iproject project i progress monitor iprogressmonitor monitor core exception coreexception f source folders fsourcefolders hash map hashmap fjarfiles hash set hashset f class files fclassfiles array list arraylist f project fproject project f result classpath fresultclasspath f result output folder fresultoutputfolder monitor monitor null progress monitor nullprogressmonitor detect classpath detectclasspath monitor is nested isnested i path ipath path iterator i path ipath iter iter has next hasnext i path ipath iter is prefix of isprefixof path method detect classpath detectclasspath param monitor progress monitor core exception coreexception failure detect classpath detectclasspath i progress monitor iprogressmonitor monitor core exception coreexception monitor begin task begintask new wizard messages newwizardmessages class path detector classpathdetector operation description f monitor fmonitor monitor f project fproject accept i resource iresource monitor worked array list arraylist i classpath entry iclasspathentry cp entries cpentries array list arraylist detect source folders detectsourcefolders cp entries cpentries monitor is canceled iscanceled operation canceled exception operationcanceledexception monitor worked i path ipath output location outputlocation detect output folder detectoutputfolder monitor is canceled iscanceled operation canceled exception operationcanceledexception monitor worked detect libraries detectlibraries cp entries cpentries output location outputlocation monitor is canceled iscanceled operation canceled exception operationcanceledexception monitor worked cp entries cpentries is empty isempty f class files fclassfiles is empty isempty i classpath entry iclasspathentry jre entries jreentries preference constants preferenceconstants getdefaultjrelibrary jre entries jreentries length cp entries cpentries add jre entries jreentries i classpath entry iclasspathentry entries cp entries cpentries to array toarray i classpath entry iclasspathentry cp entries cpentries size java conventions javaconventions validate classpath validateclasspath java core javacore create f project fproject entries output location outputlocation isok f result classpath fresultclasspath entries f result output folder fresultoutputfolder output location outputlocation monitor i path ipath find in source folders findinsourcefolders i path ipath path iterator i path ipath iter f source folders fsourcefolders key set keyset iterator iter has next hasnext object key iter list i path ipath cus f source folders fsourcefolders key cus path i path ipath key i path ipath detect output folder detectoutputfolder core exception coreexception hash set hashset i path ipath class folders classfolders hash set hashset iterator i resource iresource iter f class files fclassfiles iterator iter has next hasnext i file ifile file i file ifile iter i class file reader iclassfilereader reader input stream inputstream content content file get contents getcontents reader tool factory toolfactory create default class file reader createdefaultclassfilereader content i class file reader iclassfilereader class file classfile attributes content content close io exception ioexception core exception coreexception status i status istatus error java plugin javaplugin get plugin id getpluginid i status istatus error messages format new wizard messages newwizardmessages class path detector classpathdetector error closing file basic element labels basicelementlabels get path label getpathlabel file get full path getfullpath reader problem atic problematic file class name classname reader get class name getclassname i source attribute isourceattribute source attribute sourceattribute reader get source file attribute getsourcefileattribute class name classname source attribute sourceattribute source attribute sourceattribute get source file name getsourcefilename i path ipath pack path packpath file get parent getparent get full path getfullpath idx char operation charoperation last index of lastindexof class name classname i path ipath rel path relpath path string class name classname idx i path ipath cu path cupath rel path relpath append string source attribute sourceattribute get source file name getsourcefilename i path ipath res path respath idx res path respath pack path packpath i path ipath folder path folderpath get folder path getfolderpath pack path packpath rel path relpath folder path folderpath res path respath folder path folderpath res path respath i path ipath path find in source folders findinsourcefolders cu path cupath path res path respath class folders classfolders add res path respath i path ipath proj path projpath f project fproject get full path getfullpath f source folders fsourcefolders size class folders classfolders is empty isempty f source folders fsourcefolders proj path projpath proj path projpath i path ipath path proj path projpath append preference constants preferenceconstants get preference store getpreferencestore get string getstring preference constants preferenceconstants srcbin binname class folders classfolders path path path path to string tostring path detect libraries detectlibraries array list arraylist i classpath entry iclasspathentry cp entries cpentries i path ipath output location outputlocation array list arraylist i classpath entry iclasspathentry res array list arraylist i path ipath source folder set sourcefolderset f source folders fsourcefolders key set keyset iterator i path ipath iter fjarfiles iterator iter has next hasnext i path ipath path iter is nested isnested path source folder set sourcefolderset iterator output location outputlocation output location outputlocation is prefix of isprefixof path i classpath entry iclasspathentry entry java core javacore new library entry newlibraryentry path res add entry collections sort res cp sorter cpsorter cp entries cpentries add all addall res detect source folders detectsourcefolders array list arraylist i classpath entry iclasspathentry res entries resentries array list arraylist i classpath entry iclasspathentry res array list arraylist i path ipath source folder set sourcefolderset f source folders fsourcefolders key set keyset iterator i path ipath iter source folder set sourcefolderset iterator iter has next hasnext i path ipath path iter array list arraylist i path ipath excluded array list arraylist iterator i path ipath source folder set sourcefolderset iterator has next hasnext i path ipath path equals path is prefix of isprefixof i path ipath path to exclude pathtoexclude remove first segments removefirstsegments path segment count segmentcount add trailing separator addtrailingseparator excluded add path to exclude pathtoexclude i path ipath excluded paths excludedpaths excluded to array toarray i path ipath excluded size i classpath entry iclasspathentry entry java core javacore new source entry newsourceentry path excluded paths excludedpaths res add entry collections sort res cp sorter cpsorter res entries resentries add all addall res visit compilation unit visitcompilationunit i file ifile file i compilation unit icompilationunit java core javacore create compilation unit from createcompilationunitfrom file ast parser astparser parser ast parser astparser new parser newparser ast provider astprovider shared ast level parser set source setsource parser set focal position setfocalposition compilation unit compilationunit root compilation unit compilationunit parser createast package declaration packagedeclaration pack decl packdecl root get package getpackage i path ipath pack path packpath file get parent getparent get full path getfullpath string cu name cuname file get name getname pack decl packdecl add to map addtomap f source folders fsourcefolders pack path packpath path cu name cuname i path ipath rel path relpath path pack decl packdecl get name getname get fully qualified name getfullyqualifiedname replace i path ipath folder path folderpath get folder path getfolderpath pack path packpath rel path relpath folder path folderpath add to map addtomap f source folders fsourcefolders folder path folderpath rel path relpath append cu name cuname add to map addtomap hash map hashmap i path ipath list i path ipath map i path ipath folder path folderpath i path ipath rel path relpath list i path ipath list map folder path folderpath list list array list arraylist map folder path folderpath list list add rel path relpath i path ipath get folder path getfolderpath i path ipath pack path packpath i path ipath relpath remaining segments remainingsegments pack path packpath segment count segmentcount relpath segment count segmentcount remaining segments remainingsegments i path ipath common pack path packpath remove first segments removefirstsegments remaining segments remainingsegments common equals relpath pack path packpath upto segment uptosegment remaining segments remainingsegments has extension hasextension string string ext ends with endswith ext ext length length isvalidcuname string java conventions util javaconventionsutil validate compilation unit name validatecompilationunitname java core javacore create f project fproject matches i status istatus error override visit i resource proxy iresourceproxy proxy f monitor fmonitor is canceled iscanceled operation canceled exception operationcanceledexception proxy get type gettype i resource iresource file string proxy get name getname isvalidcuname visit compilation unit visitcompilationunit i file ifile proxy request resource requestresource nls has extension hasextension f class files fclassfiles add proxy request resource requestresource nls has extension hasextension jar fjarfiles add proxy request full path requestfullpath i path ipath get output location getoutputlocation f result output folder fresultoutputfolder i classpath entry iclasspathentry get classpath getclasspath f result classpath fresultclasspath i classpath entry iclasspathentry f result classpath fresultclasspath