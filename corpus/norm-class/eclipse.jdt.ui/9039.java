copyright ibm corporation rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors ibm corporation initial api implementation org eclipse jdt tests refactoring infra java byte array output stream bytearrayoutputstream java io exception ioexception java unsupported encoding exception unsupportedencodingexception java util array list arraylist java util zip zip entry zipentry java util zip zip input stream zipinputstream org junit org eclipse jdt core i compilation unit icompilationunit org eclipse jdt core i java element ijavaelement org eclipse jdt core i package fragment ipackagefragment org eclipse jdt core i package fragment root ipackagefragmentroot org eclipse jdt core java model exception javamodelexception org eclipse jdt tests refactoring refactoring test refactoringtest zip tools ziptools string get source file name getsourcefilename string file name filename file name filename last index of lastindexof file name filename file name filename substring file name filename last index of lastindexof string get package name getpackagename string file name filename string package name packagename file name filename last index of lastindexof package name packagename package name packagename file name filename substring file name filename last index of lastindexof replace package name packagename compare with zipped comparewithzipped i package fragment root ipackagefragmentroot src zip input stream zipinputstream zip input stream zipinputstream string zip file encoding zipfileencoding io exception ioexception unsupported encoding exception unsupportedencodingexception java model exception javamodelexception array list arraylist string zip cus zipcus array list arraylist zip entry zipentry zip input stream zipinputstream get next entry getnextentry string file name filename get name getname file name filename ends with endswith java string package name packagename get package name getpackagename file name filename string source file name sourcefilename get source file name getsourcefilename file name filename zip cus zipcus add package name packagename source file name sourcefilename byte array output stream bytearrayoutputstream bout byte array output stream bytearrayoutputstream data count count zip input stream zipinputstream read data data length bout write data count string zip contents zipcontents bout to string tostring zip file encoding zipfileencoding i package fragment ipackagefragment pack src get package fragment getpackagefragment package name packagename i compilation unit icompilationunit pack get compilation unit getcompilationunit source file name sourcefilename string cu contents cucontents get source getsource refactoring test refactoringtest assert equal lines assertequallines package name packagename source file name sourcefilename zip contents zipcontents cu contents cucontents todo compare binary files i java element ijavaelement package fragments packagefragments src get children getchildren package fragments packagefragments length i package fragment ipackagefragment package fragment packagefragment i package fragment ipackagefragment package fragments packagefragments i compilation unit icompilationunit cus package fragment packagefragment get compilation units getcompilationunits cus length i compilation unit icompilationunit cus string cu desc r cudescr package fragment packagefragment get element name getelementname get element name getelementname assert true asserttrue cu desc r cudescr zip cus zipcus remove cu desc r cudescr assert equals assertequals zip cus zipcus to string tostring zip cus zipcus size zip input stream zipinputstream close