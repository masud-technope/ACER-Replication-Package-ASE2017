licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling sling bucks slingbucks server java util array list arraylist java util arrays java util calendar java util hash set hashset java util list java util javax jcr item javax jcr node javax jcr property javax jcr repository javax jcr repository exception repositoryexception javax jcr session javax jcr observation event javax jcr observation event iterator eventiterator javax jcr observation event listener eventlistener javax jcr observation observation manager observationmanager org apache felix scr annotations component org apache felix scr annotations properties org apache felix scr annotations reference org apache felix scr annotations service org apache sling jcr api sling repository slingrepository org osgi service component component context componentcontext org slf logger org slf logger factory loggerfactory move conf irmed confirmed orders confirmed orders path observing orders path execute method per iodically periodically check orders ready move sling scheduler service whiteboard pattern registering runnable service adding property define running schedule sufficient execute method reg ularly regularly component service runnable properties org apache felix scr annotations property scheduler period long value longvalue org apache felix scr annotations property scheduler concurrent bool value boolvalue confirmed orders observer confirmedordersobserver event listener eventlistener runnable logger log logger factory loggerfactory get logger getlogger get class getclass reference sling repository slingrepository repository session session observation manager observationmanager observation manager observationmanager string changed property paths changedpropertypaths hash set hashset string wait change msec activate component context componentcontext context exception session repository login administrative loginadministrative listen orders repository get descriptor getdescriptor repository option observation supported equals observation manager observationmanager session get workspace getworkspace get observation manager getobservationmanager string types unstructured is deep isdeep no local nolocal string path sling bucks constants slingbucksconstants orders path observation manager observationmanager add event listener addeventlistener event property changed event property path is deep isdeep types no local nolocal log info observing property nodes arrays as list aslist types path deactivate component context componentcontext component context componentcontext repository exception repositoryexception observation manager observationmanager observation manager observationmanager remove event listener removeeventlistener session session log out logout session on event onevent event iterator eventiterator has next hasnext separate event method string path next event nextevent get path getpath path ends with endswith sling bucks constants slingbucksconstants confirmed order property changed property paths changedpropertypaths log debug on event onevent property changed path changed property paths changedpropertypaths add path exception log warn get class getclass get name getname on event onevent meant called sling scheduler changed property paths changedpropertypaths is empty isempty list string paths array list arraylist string list string to retry toretry array list arraylist string changed property paths changedpropertypaths paths add all addall changed property paths changedpropertypaths changed property paths changedpropertypaths clear paths is empty isempty string path paths remove session item exists itemexists path item session get item getitem path is node isnode property property node get parent getparent has property hasproperty sling bucks constants slingbucksconstants modified property log debug node doesn property get path getpath sling bucks constants slingbucksconstants modified property calendar last mod lastmod get property getproperty sling bucks constants slingbucksconstants modified property get date getdate system current time millis currenttimemillis last mod lastmod get time gettime get time gettime wait change msec log debug node modified msec get path getpath wait change msec to retry toretry add path string target path targetpath sling bucks constants slingbucksconstants confirmed orders path get name getname session get workspace getworkspace move get path getpath target path targetpath log info confirmed order node moved get path getpath target path targetpath exception log error exception add paths didn process changed property paths changedpropertypaths changed property paths changedpropertypaths add all addall paths changed property paths changedpropertypaths add all addall to retry toretry