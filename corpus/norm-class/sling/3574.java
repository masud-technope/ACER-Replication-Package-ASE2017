licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling discovery oak org junit assert equals assertequals org junit assert not null assertnotnull org junit assert true asserttrue java util uuid org apache sling api resource resource resolver resourceresolver org apache sling api resource resource resolver factory resourceresolverfactory org apache sling discovery base setup virtual instance virtualinstance org apache sling discovery commons providers base dummy listener dummylistener org apache sling discovery commons providers spi base descriptor helper descriptorhelper org apache sling discovery commons providers spi base discovery lite config discoveryliteconfig org apache sling discovery commons providers spi base discovery lite descriptor builder discoverylitedescriptorbuilder org apache sling discovery commons providers spi base dummy sling settings service dummyslingsettingsservice org apache sling discovery commons providers spi base id map service idmapservice org apache sling discovery oak setup oak virtual instance builder oakvirtualinstancebuilder org apache sling discovery oak setup simulated lease collection simulatedleasecollection org junit test org slf logger org slf logger factory loggerfactory oak discovery service test oakdiscoveryservicetest logger logger logger factory loggerfactory get logger getlogger get class getclass simple commons config simplecommonsconfig discovery lite config discoveryliteconfig bg interval millis bgintervalmillis bg timeout millis bgtimeoutmillis simple commons config simplecommonsconfig bg interval millis bgintervalmillis bg timeout millis bgtimeoutmillis bg interval millis bgintervalmillis bg interval millis bgintervalmillis bg timeout millis bgtimeoutmillis bg timeout millis bgtimeoutmillis override string get sync token path getsynctokenpath sync tokens synctokens override string get id map path getidmappath idmap override get cluster sync service timeout millis getclustersyncservicetimeoutmillis bg timeout millis bgtimeoutmillis override get cluster sync service interval millis getclustersyncserviceintervalmillis bg interval millis bgintervalmillis test test bind before activate testbindbeforeactivate exception oak virtual instance builder oakvirtualinstancebuilder builder oak virtual instance builder oakvirtualinstancebuilder oak virtual instance builder oakvirtualinstancebuilder set debug name setdebugname test new repository newrepository foo bar string sling id slingid uuid randomuuid to string tostring discovery lite descriptor builder discoverylitedescriptorbuilder disco builder discobuilder discovery lite descriptor builder discoverylitedescriptorbuilder disco builder discobuilder active ids activeids discovery lite descriptor marked view disco builder discobuilder set final setfinal descriptor helper descriptorhelper set discovery lite descriptor setdiscoverylitedescriptor builder get resource resolver factory getresourceresolverfactory disco builder discobuilder id map service idmapservice id map service idmapservice id map service idmapservice test constructor testconstructor simple commons config simplecommonsconfig dummy sling settings service dummyslingsettingsservice sling id slingid builder get resource resolver factory getresourceresolverfactory assert true asserttrue id map service idmapservice wait for init waitforinit oak discovery service oakdiscoveryservice discovery service discoveryservice oak discovery service oakdiscoveryservice builder get discover service getdiscoverservice assert not null assertnotnull discovery service discoveryservice dummy listener dummylistener listener dummy listener dummylistener discovery service discoveryservice bind topology event listener bindtopologyeventlistener listener discovery service discoveryservice unbind topology event listener unbindtopologyeventlistener listener discovery service discoveryservice bind topology event listener bindtopologyeventlistener listener assert equals assertequals listener count events countevents discovery service discoveryservice activate assert equals assertequals listener count events countevents conf usion confusion discovery service discoveryservice unbind topology event listener unbindtopologyeventlistener listener discovery service discoveryservice bind topology event listener bindtopologyeventlistener listener flag handle potential topology change handlepotentialtopologychange detect valid view send event disco builder discobuilder set final setfinal descriptor helper descriptorhelper set discovery lite descriptor setdiscoverylitedescriptor builder get resource resolver factory getresourceresolverfactory disco builder discobuilder discovery service discoveryservice check for topology change checkfortopologychange assert equals assertequals discovery service discoveryservice get view state manager getviewstatemanager wait for async events waitforasyncevents assert equals assertequals listener count events countevents discovery service discoveryservice unbind topology event listener unbindtopologyeventlistener listener assert equals assertequals listener count events countevents discovery service discoveryservice bind topology event listener bindtopologyeventlistener listener assert equals assertequals discovery service discoveryservice get view state manager getviewstatemanager wait for async events waitforasyncevents init assert equals assertequals listener count events countevents test test descriptor seq num change testdescriptorseqnumchange exception logger info test descriptor seq num change testdescriptorseqnumchange start oak virtual instance builder oakvirtualinstancebuilder builder oak virtual instance builder oakvirtualinstancebuilder oak virtual instance builder oakvirtualinstancebuilder set debug name setdebugname instance new repository newrepository foo barry foo set connector ping interval setconnectorpinginterval set connector ping timeout setconnectorpingtimeout virtual instance virtualinstance instance builder build oak virtual instance builder oakvirtualinstancebuilder builder oak virtual instance builder oakvirtualinstancebuilder oak virtual instance builder oakvirtualinstancebuilder set debug name setdebugname instance use repository of userepositoryof instance set connector ping interval setconnectorpinginterval set connector ping timeout setconnectorpingtimeout virtual instance virtualinstance instance builder build logger info test descriptor seq num change testdescriptorseqnumchange created instances binding listener dummy listener dummylistener listener dummy listener dummylistener oak discovery service oakdiscoveryservice discovery service discoveryservice oak discovery service oakdiscoveryservice instance get discovery service getdiscoveryservice discovery service discoveryservice bind topology event listener bindtopologyeventlistener listener logger info test descriptor seq num change testdescriptorseqnumchange waiting listener assert equals assertequals discovery service discoveryservice get view state manager getviewstatemanager wait for async events waitforasyncevents assert equals assertequals listener count events countevents logger info test descriptor seq num change testdescriptorseqnumchange issuing heartbeats instance topology established instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview logger info test descriptor seq num change testdescriptorseqnumchange listener event latest assert equals assertequals discovery service discoveryservice get view state manager getviewstatemanager wait for async events waitforasyncevents assert equals assertequals listener count events countevents resource resolver factory resourceresolverfactory factory instance get resource resolver factory getresourceresolverfactory resource resolver resourceresolver resolver factory get administrative resource resolver getadministrativeresourceresolver instance heartbeats and check view heartbeatsandcheckview assert equals assertequals discovery service discoveryservice get view state manager getviewstatemanager wait for async events waitforasyncevents assert equals assertequals listener count events countevents increment seq num seqnum simulating coming instance sleeping simulated lease collection simulatedleasecollection builder get simulated lease collection getsimulatedleasecollection inc seq num incseqnum logger info test descriptor seq num change testdescriptorseqnumchange inc remented incremented seq num seqnum issuing heartbeat trigger topology change instance heartbeats and check view heartbeatsandcheckview nature sync service syncservice min event delay mineventdelay explicitly sleep waiting async events logger info test descriptor seq num change testdescriptorseqnumchange sleeping topology change happen thread sleep logger info test descriptor seq num change testdescriptorseqnumchange ensuring async events pipe assert equals assertequals discovery service discoveryservice get view state manager getviewstatemanager wait for async events waitforasyncevents logger info test descriptor seq num change testdescriptorseqnumchange listener received events listener count events countevents assert equals assertequals listener count events countevents