licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling discovery commons providers base java util java util concurrent locks lock org apache sling commons scheduler scheduler org apache sling discovery discovery service discoveryservice org apache sling discovery topology view topologyview org apache sling discovery commons providers base topology view basetopologyview org slf logger org slf logger factory loggerfactory hooks view state manager impl viewstatemanagerimpl adds delay topology changing topology changed idea avoid bundle multiple topology changed events happen amount time min event delay handler mineventdelayhandler logger logger logger factory loggerfactory get logger getlogger min event delay handler mineventdelayhandler is delaying isdelaying scheduler scheduler min event delay secs mineventdelaysecs discovery service discoveryservice discovery service discoveryservice view state manager impl viewstatemanagerimpl view state manager viewstatemanager lock lock cancel cnt cancelcnt min event delay handler mineventdelayhandler view state manager impl viewstatemanagerimpl view state manager viewstatemanager lock lock discovery service discoveryservice discovery service discoveryservice scheduler scheduler min event delay secs mineventdelaysecs view state manager viewstatemanager view state manager viewstatemanager lock lock discovery service discoveryservice illegal argument exception illegalargumentexception discovery service discoveryservice discovery service discoveryservice discovery service discoveryservice scheduler illegal argument exception illegalargumentexception scheduler scheduler scheduler min event delay secs mineventdelaysecs illegal argument exception illegalargumentexception min event delay secs mineventdelaysecs greater min event delay secs mineventdelaysecs min event delay secs mineventdelaysecs min event delay secs mineventdelaysecs asks min event delay handler mineventdelayhandler handle view caller should n shouldn worry follow action method returns caller usual handle new view handlenewview action handles new view handlesnewview base topology view basetopologyview new view newview is delaying isdelaying delaying discovery service impl discoveryserviceimpl latest view logger info handle new view handlenewview delaying ignoring view view state manager viewstatemanager had previous view hadpreviousview logger info handles new view handlesnewview previous view delaying applicable view state manager viewstatemanager only differs in properties onlydiffersinproperties new view newview logger info handles new view handlesnewview properties differ delaying applicable view state manager viewstatemanager unchanged new view newview frequent log trace logger trace handles new view handlesnewview view unchanged delaying applicable force trigger async delaying triggerasyncdelaying new view newview logger info handle new view handlenewview trigger async delaying sending view view state manager viewstatemanager handle new view non delayed handlenewviewnondelayed new view newview triggering async event successful ensure topology changing delayed event hits lock lock safe handle changing handlechanging pos sibility possibility async delay thread comp ete compete lock lock safe handle changing handlechanging view state manager viewstatemanager handle changing handlechanging trigger async delaying triggerasyncdelaying base topology view basetopologyview new view newview valid cancel cnt validcancelcnt cancel cnt cancelcnt triggered run after runafter min event delay secs mineventdelaysecs seconds runnable lock lock cancel cnt cancelcnt valid cancel cnt validcancelcnt logger info async delay asyncdelay can celled cancelled valid cancel cnt validcancelcnt valid cancel cnt validcancelcnt cancel cnt cancelcnt cancel cnt cancelcnt quitting unlock changed event subsequent call handle topology changed handletopologychanged is delaying isdelaying check topology ready topology view topologyview discovery service discoveryservice get topology gettopology base topology view basetopologyview logger error async delay asyncdelay delaying topology type base topology view basetopologyview base topology view basetopologyview topology base topology view basetopologyview topology is current iscurrent logger info async delay asyncdelay delaying view topology to short string toshortstring view state manager viewstatemanager handle new view non delayed handlenewviewnondelayed topology logger info async delay asyncdelay delaying view current delaying trigger async delaying triggerasyncdelaying topology int erested interested result async failed rely handle new view handlenewview send view cos current stuck waiting handle new view handlenewview runtime exception runtimeexception logger error runtime exception runtimeexception error logger error error lock unlock logger info trigger async delaying triggerasyncdelaying async h asynch delaying min event delay secs mineventdelaysecs triggered triggered triggered is delaying isdelaying triggered runnable number seconds scheduling runnable worked run after runafter seconds runnable runnable scheduler the scheduler thescheduler scheduler the scheduler thescheduler logger info run after runafter scheduler logger trace run after runafter scheduler fire job firejob system current time millis currenttimemillis seconds the scheduler thescheduler fire job at firejobat runnable exception logger info run after runafter schedule job testing is delaying isdelaying is delaying isdelaying cancel delaying canceldelaying logger info cancel delaying canceldelaying flag ging flagging cancel cnt cancelcnt invalid cancel cnt cancelcnt cancel cnt cancelcnt is delaying isdelaying