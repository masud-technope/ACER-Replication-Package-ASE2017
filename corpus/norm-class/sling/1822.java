licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling discovery base org junit assert equals assertequals org junit assert false assertfalse org junit assert not equals assertnotequals org junit assert not null assertnotnull org junit assert null assertnull org junit assert true asserttrue org junit fail java util hash set hashset java util iterator java util linked list linkedlist java util list java util java util uuid java util concurrent semaphore org apache log level org apache log log manager logmanager org apache sling discovery cluster view clusterview org apache sling discovery instance description instancedescription org apache sling discovery topology event topologyevent org apache sling discovery topology event topologyevent type org apache sling discovery topology event listener topologyeventlistener org apache sling discovery topology view topologyview org apache sling discovery base commons cluster view helper clusterviewhelper org apache sling discovery base commons cluster view service clusterviewservice org apache sling discovery base commons undefined cluster view exception undefinedclusterviewexception org apache sling discovery base connectors announcement announcement org apache sling discovery base connectors announcement announcement filter announcementfilter org apache sling discovery base connectors announcement announcement registry announcementregistry org apache sling discovery base setup virtual instance virtualinstance org apache sling discovery base setup virtual instance builder virtualinstancebuilder org apache sling discovery base setup mock acc epts multiple acceptsmultiple org apache sling discovery base setup mock asserting topology event listener assertingtopologyeventlistener org apache sling discovery base setup mock property provider impl propertyproviderimpl org junit org junit org junit test org slf logger org slf logger factory loggerfactory abstract cluster test abstractclustertest logger logger logger factory loggerfactory get logger getlogger get class getclass simple cluster view simpleclusterview virtual instance virtualinstance instances simple cluster view simpleclusterview virtual instance virtualinstance instances instances instances override string to string tostring string instance sling ids instanceslingids instances length instance sling ids instanceslingids instance sling ids instanceslingids instances sling id slingid expected cluster instances length instances instance sling ids instanceslingids virtual instance virtualinstance instance virtual instance virtualinstance instance virtual instance virtualinstance instance string property string property string property string property virtual instance virtualinstance instance virtual instance virtualinstance instance virtual instance virtualinstance instance restarted level log level loglevel virtual instance builder virtualinstancebuilder new builder newbuilder setup exception org apache log logger discovery logger discoverylogger log manager logmanager get root logger getrootlogger get logger getlogger org apache sling discovery log level loglevel discovery logger discoverylogger get level getlevel discovery logger discoverylogger set level setlevel level trace logger debug instance new builder newbuilder set debug name setdebugname first instance firstinstance new repository newrepository discovery impl build instance new builder newbuilder set debug name setdebugname second instance secondinstance use repository of userepositoryof instance build tear down teardown exception instance instance instance instance instance instance instance instance instance instance instance instance instance restarted instance restarted instance restarted instance instance instance instance instance org apache log logger discovery logger discoverylogger log manager logmanager get root logger getrootlogger get logger getlogger org apache sling discovery discovery logger discoverylogger set level setlevel log level loglevel test leader behaviour ascending sling ids slingids sling test test leader asc testleaderasc throwable logger info test leader asc testleaderasc start do test leader dotestleader logger info test leader asc testleaderasc test leader behaviour desc ending descending sling ids slingids sling test test leader desc testleaderdesc throwable logger info test leader desc testleaderdesc start do test leader dotestleader logger info test leader desc testleaderdesc do test leader dotestleader string sling id slingid string sling id slingid throwable logger info do test leader dotestleader sling id slingid sling id slingid start create heartbeat timeout instance stop view checker stopviewchecker instance stop view checker stopviewchecker instance instance instance new builder newbuilder set debug name setdebugname first instance firstinstance new repository newrepository discovery impl set connector ping timeout setconnectorpingtimeout set min event delay setmineventdelay set sling id setslingid sling id slingid build sleep dont startup time leader election id leaderelectionid instance logger info do test leader dotestleader sleep thread sleep instance new builder newbuilder set debug name setdebugname second instance secondinstance use repository of userepositoryof instance set connector ping timeout setconnectorpingtimeout set min event delay setmineventdelay set sling id setslingid sling id slingid build assert not null assertnotnull instance assert not null assertnotnull instance instances isolated exception instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview fail complain undefined cluster view exception undefinedclusterviewexception instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview fail complain undefined cluster view exception undefinedclusterviewexception sync voting happen instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview logger info do test leader dotestleader sleep thread sleep instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview cluster cluster size assert equals assertequals instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get instances getinstances size assert equals assertequals instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get instances getinstances size instance leader started assert true asserttrue instance get local instance description getlocalinstancedescription is leader isleader assert false assertfalse instance get local instance description getlocalinstancedescription is leader isleader logger info do test leader dotestleader sling id slingid sling id slingid tests stale announcement reported sling instance crashes announcements cleans announcements restart announcements connector longer point effects tested method peers cluster crashed stopped instance rest arts restarts assume stale announcements correct include topology reporting stale instances instances duplicates test test stale announcements visible to cluster peers teststaleannouncementsvisibletoclusterpeers throwable logger info test stale announcements visible to cluster peers teststaleannouncementsvisibletoclusterpeers start string instance sling id slingid prepare remove topology connector instance instance corresponds pinging add itionally additionally start instance instance restarted new builder newbuilder set debug name setdebugname first instance firstinstance use repository of userepositoryof instance set connector ping timeout setconnectorpingtimeout integer max set min event delay setmineventdelay set sling id setslingid instance sling id slingid build run heartbeat once with runheartbeatoncewith instance restarted instance instance thread sleep run heartbeat once with runheartbeatoncewith instance restarted instance instance thread sleep run heartbeat once with runheartbeatoncewith instance restarted instance instance facts connector exist act ively actively instance build cluster instance isolated logger info instance restarted dump instance restarted sling id slingid instance restarted dump repo dumprepo logger info instance dump instance sling id slingid instance dump repo dumprepo logger info instance dump instance sling id slingid instance dump repo dumprepo assert topology asserttopology instance restarted simple cluster view simpleclusterview instance restarted instance assert topology asserttopology instance simple cluster view simpleclusterview instance assert topology asserttopology instance simple cluster view simpleclusterview instance restarted instance instance restarted logger info test stale announcements visible to cluster peers teststaleannouncementsvisibletoclusterpeers tests situation connector instance event ually eventually crashed connector instance instance res tarted restarted test assures instance reported topology happen test test duplicate instance in testduplicateinstancein clusters throwable logger info test duplicate instance in testduplicateinstancein clusters start string instance sling id slingid prepare remove topology connector instance instance corresponds pinging add itionally additionally start connector instance instance ping connector pingconnector instance instance start instance instance restarted new builder newbuilder set debug name setdebugname first instance firstinstance use repository of userepositoryof instance set connector ping timeout setconnectorpingtimeout integer max set min event delay setmineventdelay set sling id setslingid instance sling id slingid build run heartbeat once with runheartbeatoncewith instance restarted instance instance ping connector pingconnector instance instance run heartbeat once with runheartbeatoncewith instance restarted instance instance ping connector pingconnector instance instance logger info iteration logger info instance restarted sling id slingid instance restarted sling id slingid logger info instance sling id slingid instance sling id slingid logger info instance sling id slingid instance sling id slingid instance restarted dump repo dumprepo assert same topology assertsametopology simple cluster view simpleclusterview instance restarted instance simple cluster view simpleclusterview instance thread sleep run heartbeat once with runheartbeatoncewith instance restarted instance instance ping connector pingconnector instance instance run heartbeat once with runheartbeatoncewith instance restarted instance instance ping connector pingconnector instance instance logger info iteration logger info instance restarted sling id slingid instance restarted sling id slingid logger info instance sling id slingid instance sling id slingid logger info instance sling id slingid instance sling id slingid instance restarted dump repo dumprepo assert same topology assertsametopology simple cluster view simpleclusterview instance restarted instance simple cluster view simpleclusterview instance instance restarted logger info test duplicate instance in testduplicateinstancein clusters test cluster instance instance cluster instance instance cluster instance init ially initially instance pinging instance instance pinging instance mac hub result instance inherit instance simulate load balancer switching instance instance pings instance test test connector switching testconnectorswitching throwable min event delay reset setup start setup tear down teardown org apache log logger discovery logger discoverylogger log manager logmanager get root logger getrootlogger get logger getlogger org apache sling discovery log level loglevel discovery logger discoverylogger get level getlevel discovery logger discoverylogger set level setlevel level debug instance new builder newbuilder set debug name setdebugname instance new repository newrepository discovery cluster a clustera set connector ping timeout setconnectorpingtimeout set connector ping interval setconnectorpinginterval set min event delay setmineventdelay min event delay build instance new builder newbuilder set debug name setdebugname instance use repository of userepositoryof instance set connector ping timeout setconnectorpingtimeout set connector ping interval setconnectorpinginterval set min event delay setmineventdelay min event delay build launch remote instance instance new builder newbuilder set debug name setdebugname instance new repository newrepository discovery cluster b clusterb set connector ping timeout setconnectorpingtimeout set connector ping interval setconnectorpinginterval set min event delay setmineventdelay min event delay build instance new builder newbuilder set debug name setdebugname instance use repository of userepositoryof instance set connector ping timeout setconnectorpingtimeout set connector ping interval setconnectorpinginterval set min event delay setmineventdelay min event delay build instance new builder newbuilder set debug name setdebugname instance new repository newrepository discovery cluster c clusterc set connector ping timeout setconnectorpingtimeout set connector ping interval setconnectorpinginterval set min event delay setmineventdelay min event delay build join instances form cluster sending heartbeats run heartbeat once with runheartbeatoncewith instance instance instance instance instance thread sleep run heartbeat once with runheartbeatoncewith instance instance instance instance instance thread sleep run heartbeat once with runheartbeatoncewith instance instance instance instance instance thread sleep assert same topology assertsametopology simple cluster view simpleclusterview instance instance assert same topology assertsametopology simple cluster view simpleclusterview instance instance assert same topology assertsametopology simple cluster view simpleclusterview instance create topology connector instance instance corresponds starting ping run heartbeat once with runheartbeatoncewith instance instance instance instance instance ping connector pingconnector instance instance ping connector pingconnector instance instance thread sleep run heartbeat once with runheartbeatoncewith instance instance instance instance instance ping connector pingconnector instance instance ping connector pingconnector instance instance thread sleep asserts topology logger info test connector switching testconnectorswitching instance sling id slingid instance sling id slingid logger info test connector switching testconnectorswitching instance sling id slingid instance sling id slingid logger info test connector switching testconnectorswitching instance sling id slingid instance sling id slingid logger info test connector switching testconnectorswitching instance sling id slingid instance sling id slingid logger info test connector switching testconnectorswitching instance sling id slingid instance sling id slingid instance dump repo dumprepo assert same topology assertsametopology simple cluster view simpleclusterview instance instance simple cluster view simpleclusterview instance instance simple cluster view simpleclusterview instance simulate crash instance load balancer pings success loop max times min times run heartbeat once with runheartbeatoncewith instance instance instance instance ping ping connector pingconnector instance instance ping ping connector pingconnector instance instance ping ping pings fine success logger info test connector switching testconnectorswitching switched pings instance rounds logger info test connector switching testconnectorswitching min loop cnt reached max timeout timing thread sleep logger info test connector switching testconnectorswitching looping cos ping ping ping ping max timeout thread sleep assert true asserttrue success heartbeat run heartbeat once with runheartbeatoncewith instance instance instance instance assert true asserttrue ping connector pingconnector instance instance assert true asserttrue ping connector pingconnector instance instance instance dump repo dumprepo assert same topology assertsametopology simple cluster view simpleclusterview instance simple cluster view simpleclusterview instance instance simple cluster view simpleclusterview instance restart instance crash instance instance stop view checker stopviewchecker instance restarted new builder newbuilder set debug name setdebugname instance use repository of userepositoryof instance set connector ping timeout setconnectorpingtimeout integer max set min event delay setmineventdelay set sling id setslingid instance get sling id getslingid build run heartbeat once with runheartbeatoncewith instance restarted instance instance instance heartbeats votes time sleep timeout safe thread sleep assert true asserttrue ping connector pingconnector instance instance assert true asserttrue ping connector pingconnector instance instance success run heartbeat once with runheartbeatoncewith instance restarted instance instance instance instance get view checker getviewchecker check view checkview instance undefined cluster view ping connector pingconnector instance instance undefined cluster view exception undefinedclusterviewexception ucve ping connector pingconnector instance instance topology view topologyview topology instance get discovery service getdiscoveryservice get topology gettopology instance description instancedescription iterator instance description instancedescription topology get instances getinstances iterator has next hasnext instance description instancedescription get sling id getslingid equals instance sling id slingid assert not null assertnotnull assert equals assertequals instance sling id slingid get sling id getslingid cluster view clusterview cluster get cluster view getclusterview cluster size clustersize cluster get instances getinstances size cluster size clustersize logger info test connector switching testconnectorswitching min loop cnt reached max sleep timeout timing thread sleep success logger info test connector switching testconnectorswitching cluster size clustersize cluster size clustersize success logger info test connector switching testconnectorswitching cluster size clustersize cluster size clustersize thread sleep logger info test connector switching testconnectorswitching instance restarted sling id slingid instance restarted sling id slingid logger info test connector switching testconnectorswitching instance sling id slingid instance sling id slingid logger info test connector switching testconnectorswitching instance sling id slingid instance sling id slingid logger info test connector switching testconnectorswitching instance sling id slingid instance sling id slingid logger info test connector switching testconnectorswitching instance sling id slingid instance sling id slingid instance restarted dump repo dumprepo assert true asserttrue success assert same topology assertsametopology simple cluster view simpleclusterview instance restarted instance simple cluster view simpleclusterview instance simple cluster view simpleclusterview instance instance restarted test test duplicate instance testduplicateinstance throwable logger info test duplicate instance testduplicateinstance start min event delay reset setup start setup tear down teardown org apache log logger discovery logger discoverylogger log manager logmanager get root logger getrootlogger get logger getlogger org apache sling discovery log level loglevel discovery logger discoverylogger get level getlevel discovery logger discoverylogger set level setlevel level debug instance new builder newbuilder set debug name setdebugname instance new repository newrepository discovery cluster a clustera set connector ping timeout setconnectorpingtimeout set min event delay setmineventdelay min event delay build instance new builder newbuilder set debug name setdebugname instance use repository of userepositoryof instance set connector ping timeout setconnectorpingtimeout set min event delay setmineventdelay min event delay build launch remote instance instance new builder newbuilder set debug name setdebugname instance new repository newrepository discovery cluster b clusterb set connector ping timeout setconnectorpingtimeout set min event delay setmineventdelay min event delay build instance new builder newbuilder set debug name setdebugname instance new repository newrepository discovery cluster c clusterc set connector ping timeout setconnectorpingtimeout set min event delay setmineventdelay min event delay build join instances form cluster sending heartbeats run heartbeat once with runheartbeatoncewith instance instance instance instance thread sleep run heartbeat once with runheartbeatoncewith instance instance instance instance thread sleep run heartbeat once with runheartbeatoncewith instance instance instance instance thread sleep assert same topology assertsametopology simple cluster view simpleclusterview instance instance assert same topology assertsametopology simple cluster view simpleclusterview instance assert same topology assertsametopology simple cluster view simpleclusterview instance create topology connector instance instance corresponds starting ping ping connector pingconnector instance instance ping connector pingconnector instance instance ping connector pingconnector instance instance ping connector pingconnector instance instance asserts topology logger info test duplicate instance testduplicateinstance instance sling id slingid instance sling id slingid logger info test duplicate instance testduplicateinstance instance sling id slingid instance sling id slingid logger info test duplicate instance testduplicateinstance instance sling id slingid instance sling id slingid logger info test duplicate instance testduplicateinstance instance sling id slingid instance sling id slingid instance dump repo dumprepo assert same topology assertsametopology simple cluster view simpleclusterview instance instance simple cluster view simpleclusterview instance simple cluster view simpleclusterview instance simulate crash instance load balancer pings instance stop view checker stopviewchecker success loop max times min times run heartbeat once with runheartbeatoncewith instance instance instance instance ping ping connector pingconnector instance instance ping ping connector pingconnector instance instance ping ping pings fine success logger info test duplicate instance testduplicateinstance switched pings instance rounds logger info test duplicate instance testduplicateinstance min loop cnt reached max timeout timing thread sleep logger info test duplicate instance testduplicateinstance looping max timeout thread sleep assert true asserttrue success heartbeat run heartbeat once with runheartbeatoncewith instance instance instance assert true asserttrue ping connector pingconnector instance instance assert true asserttrue ping connector pingconnector instance instance instance dump repo dumprepo assert same topology assertsametopology simple cluster view simpleclusterview instance simple cluster view simpleclusterview instance simple cluster view simpleclusterview instance restart instance start instance instance restarted new builder newbuilder set debug name setdebugname instance use repository of userepositoryof instance set connector ping timeout setconnectorpingtimeout integer max set min event delay setmineventdelay set sling id setslingid instance get sling id getslingid build instance new builder newbuilder set debug name setdebugname instance use repository of userepositoryof instance set connector ping timeout setconnectorpingtimeout set min event delay setmineventdelay min event delay build run heartbeat once with runheartbeatoncewith instance restarted instance instance instance instance thread sleep ping connector pingconnector instance instance undefined cluster view exception undefinedclusterviewexception ucve assert true asserttrue ping connector pingconnector instance instance instance restarted dump repo dumprepo logger info test duplicate instance testduplicateinstance instance restarted sling id slingid instance restarted sling id slingid logger info test duplicate instance testduplicateinstance instance sling id slingid instance sling id slingid logger info test duplicate instance testduplicateinstance instance sling id slingid instance sling id slingid logger info test duplicate instance testduplicateinstance instance sling id slingid instance sling id slingid logger info test duplicate instance testduplicateinstance instance sling id slingid instance sling id slingid assert true asserttrue success assert same topology assertsametopology simple cluster view simpleclusterview instance restarted instance simple cluster view simpleclusterview instance instance simple cluster view simpleclusterview instance instance restarted logger info test duplicate instance testduplicateinstance assert same topology assertsametopology simple cluster view simpleclusterview clusters undefined cluster view exception undefinedclusterviewexception clusters clusters length clusters simple cluster view simpleclusterview a cluster acluster clusters assert same cluster ids assertsameclusterids a cluster acluster instances a cluster acluster instances length instances virtual instance virtualinstance an instance aninstance a cluster acluster instances verify assert topology asserttopology an instance aninstance clusters clusters length simple cluster view simpleclusterview other cluster othercluster clusters a cluster acluster other cluster othercluster ignore other cluster othercluster instances length assert not same cluster ids assertnotsameclusterids an instance aninstance other cluster othercluster instances run heartbeat once with runheartbeatoncewith virtual instance virtualinstance instances instances instances length instances heartbeats and check view heartbeatsandcheckview tests situation connector instance event ually eventually crashed connector instance separate cluster instance res tarted restarted test assures instance reported topology happen prior sling test test stale instance in teststaleinstancein clusters throwable logger info test stale instance in teststaleinstancein clusters start string instance sling id slingid prepare remove topology connector instance instance corresponds pinging add itionally additionally start instance separate cluster instance new builder newbuilder set debug name setdebugname remote instance remoteinstance new repository newrepository discovery impl remote implremote set connector ping timeout setconnectorpingtimeout integer max set min event delay setmineventdelay build instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview fail complain undefined cluster view exception undefinedclusterviewexception start connector instance instance instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview ping connector pingconnector instance instance start instance instance restarted new builder newbuilder set debug name setdebugname first instance firstinstance use repository of userepositoryof instance set connector ping timeout setconnectorpingtimeout integer max set min event delay setmineventdelay set sling id setslingid instance sling id slingid build run heartbeat once with runheartbeatoncewith instance restarted instance instance instance ping connector pingconnector instance instance run heartbeat once with runheartbeatoncewith instance restarted instance instance instance ping connector pingconnector instance instance logger info iteration logger info instance restarted sling id slingid instance restarted sling id slingid logger info instance sling id slingid instance sling id slingid logger info instance sling id slingid instance sling id slingid logger info instance sling id slingid instance sling id slingid instance restarted dump repo dumprepo assert same topology assertsametopology simple cluster view simpleclusterview instance simple cluster view simpleclusterview instance assert same topology assertsametopology simple cluster view simpleclusterview instance restarted instance thread sleep run heartbeat once with runheartbeatoncewith instance restarted instance instance instance ping connector pingconnector instance instance run heartbeat once with runheartbeatoncewith instance restarted instance instance instance ping connector pingconnector instance instance logger info iteration logger info instance restarted sling id slingid instance restarted sling id slingid logger info instance sling id slingid instance sling id slingid logger info instance sling id slingid instance sling id slingid logger info instance sling id slingid instance sling id slingid instance restarted dump repo dumprepo assert same topology assertsametopology simple cluster view simpleclusterview instance restarted instance assert same topology assertsametopology simple cluster view simpleclusterview instance simple cluster view simpleclusterview instance thread sleep run heartbeat once with runheartbeatoncewith instance restarted instance instance instance ping connector pingconnector instance instance situation logger info iteration logger info instance restarted sling id slingid instance restarted sling id slingid logger info instance sling id slingid instance sling id slingid logger info instance sling id slingid instance sling id slingid logger info instance sling id slingid instance sling id slingid instance restarted dump repo dumprepo assert same topology assertsametopology simple cluster view simpleclusterview instance restarted instance assert same topology assertsametopology simple cluster view simpleclusterview instance simple cluster view simpleclusterview instance instance restarted logger info test stale instance in teststaleinstancein clusters preparation steps sling tests creates clusters instance instance instance creates connector instance instance killed crashes sling id slingid original crashed instance string prepare throwable exception interrupted exception interruptedexception running tear down teardown instance new builder newbuilder set debug name setdebugname first instance firstinstance new repository newrepository discovery impl set connector ping timeout setconnectorpingtimeout integer max set min event delay setmineventdelay build instance new builder newbuilder set debug name setdebugname second instance secondinstance use repository of userepositoryof instance set connector ping timeout setconnectorpingtimeout integer max set min event delay setmineventdelay build join instances form cluster sending heartbeats run heartbeat once with runheartbeatoncewith instance instance thread sleep run heartbeat once with runheartbeatoncewith instance instance thread sleep run heartbeat once with runheartbeatoncewith instance instance assert same cluster ids assertsameclusterids instance instance launch remote instance instance new builder newbuilder set debug name setdebugname remote instance remoteinstance new repository newrepository discovery impl remote implremote set connector ping timeout setconnectorpingtimeout integer max set min event delay setmineventdelay build assert same cluster ids assertsameclusterids instance instance instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview fail complain undefined cluster view exception undefinedclusterviewexception assert equals assertequals instance get announcement registry getannouncementregistry list local announcements listlocalannouncements size assert equals assertequals instance get announcement registry getannouncementregistry list local incoming announcements listlocalincomingannouncements size assert equals assertequals instance get announcement registry getannouncementregistry list local announcements listlocalannouncements size assert equals assertequals instance get announcement registry getannouncementregistry list local incoming announcements listlocalincomingannouncements size assert equals assertequals instance get announcement registry getannouncementregistry list local announcements listlocalannouncements size assert equals assertequals instance get announcement registry getannouncementregistry list local incoming announcements listlocalincomingannouncements size create topology connector instance instance corresponds starting ping instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview thread sleep ping connector pingconnector instance instance asserts topology instance dump repo dumprepo assert same topology assertsametopology simple cluster view simpleclusterview instance instance simple cluster view simpleclusterview instance kill instance logger info instance sling id slingid instance sling id slingid logger info instance sling id slingid instance sling id slingid logger info instance sling id slingid instance sling id slingid string instance sling id slingid instance sling id slingid instance longer pinging instance instance stop view checker stopviewchecker registered observation manager fiddle events instance early fail assumes original instance form instance instance heartbeat timeout heartbeattimeout time instance instance get config getconfig set view check timeout setviewchecktimeout instance heartbeat timeout heartbeattimeout time instance instance get config getconfig set view check timeout setviewchecktimeout thread sleep run heartbeat once with runheartbeatoncewith instance instance thread sleep run heartbeat once with runheartbeatoncewith instance instance thread sleep run heartbeat once with runheartbeatoncewith instance instance instance fact instance dump repo dumprepo assert topology asserttopology instance simple cluster view simpleclusterview instance assert topology asserttopology instance simple cluster view simpleclusterview instance instance heartbeat timeout heartbeattimeout integer max timeout instance get config getconfig set view check timeout setviewchecktimeout integer max instance heartbeat timeout heartbeattimeout integer max timeout instance get config getconfig set view check timeout setviewchecktimeout integer max instance sling id slingid assert not same cluster ids assertnotsameclusterids virtual instance virtualinstance instances undefined cluster view exception undefinedclusterviewexception instances fail pass empty instances instances length fail pass instance string cluster id clusterid instances get cluster view service getclusterviewservice get local cluster view getlocalclusterview get id getid instances length string other cluster id otherclusterid instances get cluster view service getclusterviewservice get local cluster view getlocalclusterview get id getid cluster ids assert not equals assertnotequals cluster id clusterid other cluster id otherclusterid instances length virtual instance virtualinstance subset virtual instance virtualinstance instances length system arraycopy instances subset instances length assert not same cluster ids assertnotsameclusterids subset assert same cluster ids assertsameclusterids virtual instance virtualinstance instances undefined cluster view exception undefinedclusterviewexception instances compare instances length compare string cluster id clusterid instances get cluster view service getclusterviewservice get local cluster view getlocalclusterview get id getid instances length string other cluster id otherclusterid instances get cluster view service getclusterviewservice get local cluster view getlocalclusterview get id getid cluster ids cluster id clusterid equals other cluster id otherclusterid logger error assert same cluster ids assertsameclusterids instances instances logger error assert same cluster ids assertsameclusterids instances instances fail mismatch cluster ids clusterids expected equal cluster id clusterid cluster id clusterid other cluster id otherclusterid other cluster id otherclusterid assert topology asserttopology virtual instance virtualinstance instance simple cluster view simpleclusterview asserted cluster views assertedclusterviews topology view topologyview topology instance get discovery service getdiscoveryservice get topology gettopology logger info assert topology asserttopology instance instance sling id slingid sees topology topology expected asserted cluster views assertedclusterviews assert not null assertnotnull topology asserted cluster views assertedclusterviews length topology get cluster views getclusterviews size dump failure details dumpfailuredetails topology asserted cluster views assertedclusterviews fail instance instance sling id slingid expected asserted cluster views assertedclusterviews length topology get cluster views getclusterviews size cluster view clusterview actual clusters actualclusters hash set hashset cluster view clusterview topology get cluster views getclusterviews asserted cluster views assertedclusterviews length simple cluster view simpleclusterview asserted cluster view assertedclusterview asserted cluster views assertedclusterviews found match foundmatch iterator cluster view clusterview actual clusters actualclusters iterator has next hasnext cluster view clusterview actual cluster view actualclusterview matches asserted cluster view assertedclusterview actual cluster view actualclusterview remove found match foundmatch found match foundmatch dump failure details dumpfailuredetails topology asserted cluster views assertedclusterviews fail instance instance sling id slingid find match topology instance instance sling id slingid cluster views clusterviews asserted cluster views assertedclusterviews length assert equals assertequals asserted cluster views clusterviews actual view instance instance cluster views clusterviews asserted cluster views assertedclusterviews actual clusters actualclusters size dump failure details dumpfailuredetails topology view topologyview topology simple cluster view simpleclusterview asserted cluster views assertedclusterviews logger error assert topology asserttopology expected asserted cluster views assertedclusterviews length asserted cluster views assertedclusterviews length logger error assert topology asserttopology asserted cluster views assertedclusterviews to string tostring cluster view clusterview cluster views clusterviews topology get cluster views getclusterviews instance description instancedescription instances topology get instances getinstances logger error assert topology asserttopology actual cluster views clusterviews size clusters total instances size instances iterator cluster view clusterview cluster views clusterviews iterator has next hasnext cluster view clusterview a cluster acluster logger error assert topology asserttopology cluster a cluster acluster get id getid iterator instance description instancedescription a cluster acluster get instances getinstances iterator has next hasnext instance description instancedescription logger error assert topology asserttopology instance get sling id getslingid logger error assert topology asserttopology list instances instances size iterator instance description instancedescription instances iterator has next hasnext instance description instancedescription logger error assert topology asserttopology instance get sling id getslingid matches simple cluster view simpleclusterview asserted cluster view assertedclusterview cluster view clusterview actual cluster view actualclusterview assert not null assertnotnull asserted cluster view assertedclusterview assert not null assertnotnull actual cluster view actualclusterview asserted cluster view assertedclusterview instances length actual cluster view actualclusterview get instances getinstances size instance description instancedescription actual instances actualinstances hash set hashset instance description instancedescription actual cluster view actualclusterview get instances getinstances outer loop outerloop asserted cluster view assertedclusterview instances length virtual instance virtualinstance asserted instance assertedinstance asserted cluster view assertedclusterview instances iterator instance description instancedescription actual instances actualinstances iterator has next hasnext instance description instancedescription an actual instance anactualinstance asserted instance assertedinstance sling id slingid equals an actual instance anactualinstance get sling id getslingid outer loop outerloop ping connector pingconnector virtual instance virtualinstance virtual instance virtualinstance undefined cluster view exception undefinedclusterviewexception announcement from announcement fromannouncement create from announcement createfromannouncement announcement reply announcement replyannouncement reply announcement replyannouncement ping from announcement fromannouncement assertion error assertionerror logger warn ping connector pingconnector ping failed assert ion error assertionerror undefined cluster view exception undefinedclusterviewexception logger warn ping connector pingconnector ping failed cluster view undefined register reply announcement registerreplyannouncement reply announcement replyannouncement register reply announcement registerreplyannouncement virtual instance virtualinstance announcement inherited announcement inheritedannouncement announcement registry announcementregistry announcement registry announcementregistry get announcement registry getannouncementregistry inherited announcement inheritedannouncement is loop isloop fail loop detected dont support loops junit tests inherited announcement inheritedannouncement set inherited setinherited announcement registry announcementregistry register announcement registerannouncement inherited announcement inheritedannouncement logger info ping connector response instance topology inherited announcement inheritedannouncement resulting announcement resultingannouncement inherited announcement inheritedannouncement status details statusdetails announcement ping virtual instance virtualinstance announcement incoming topology announcement incomingtopologyannouncement undefined cluster view exception undefinedclusterviewexception string sling id slingid sling id slingid cluster view service clusterviewservice cluster view service clusterviewservice get cluster view service getclusterviewservice announcement registry announcementregistry announcement registry announcementregistry get announcement registry getannouncementregistry incoming topology announcement incomingtopologyannouncement remove inherited removeinherited sling id slingid announcement reply announcement replyannouncement announcement sling id slingid backoff interval backoffinterval cluster view clusterview cluster view clusterview cluster view service clusterviewservice get local cluster view getlocalclusterview incoming topology announcement incomingtopologyannouncement is correct version iscorrectversion fail incorrect version reached cluster view helper clusterviewhelper cluster view clusterview incoming topology announcement incomingtopologyannouncement get owner id getownerid fail loop reached cluster view helper clusterviewhelper contains any containsany cluster view clusterview incoming topology announcement incomingtopologyannouncement list instances listinstances fail incoming announcement instances cluster reached backoff interval backoffinterval announcement registry announcementregistry register announcement registerannouncement incoming topology announcement incomingtopologyannouncement backoff interval backoffinterval fail rejecting announcement instance topology reached normal successful rep lying replying topology instance sees reply announcement replyannouncement set local cluster setlocalcluster cluster view clusterview announcement registry announcementregistry add all except addallexcept reply announcement replyannouncement cluster view clusterview announcement filter announcementfilter accept string receiving sling id receivingslingid announcement announcement announcement get primary key getprimarykey equals incoming topology announcement incomingtopologyannouncement get primary key getprimarykey reply announcement replyannouncement announcement create from announcement createfromannouncement virtual instance virtualinstance undefined cluster view exception undefinedclusterviewexception todo ref actor refactor topology connector client topologyconnectorclient avoid dup licating duplicating code ping announcement topology announcement topologyannouncement announcement sling id slingid topology announcement topologyannouncement set server info setserverinfo sling id slingid cluster view clusterview cluster view clusterview get cluster view service getclusterviewservice get local cluster view getlocalclusterview topology announcement topologyannouncement set local cluster setlocalcluster cluster view clusterview get announcement registry getannouncementregistry add all except addallexcept topology announcement topologyannouncement cluster view clusterview announcement filter announcementfilter accept string receiving sling id receivingslingid announcement announcement filter announcements cluster instances dont cluster view moment iterator instance description instancedescription cluster view clusterview get instances getinstances iterator has next hasnext instance description instancedescription instance instance get sling id getslingid equals receiving sling id receivingslingid fine propagate announcement topology announcement topologyannouncement test test stable cluster id teststableclusterid throwable logger info test stable cluster id teststableclusterid start create heartbeat timeout instance stop view checker stopviewchecker instance stop view checker stopviewchecker instance instance sling heartbeat timeout heartbeattimeout large work instances instance new builder newbuilder set debug name setdebugname first instance firstinstance new repository newrepository discovery impl set connector ping timeout setconnectorpingtimeout set min event delay setmineventdelay build instance new builder newbuilder set debug name setdebugname second instance secondinstance use repository of userepositoryof instance set connector ping timeout setconnectorpingtimeout set min event delay setmineventdelay build assert not null assertnotnull instance assert not null assertnotnull instance instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview fail complain undefined cluster view exception undefinedclusterviewexception instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview fail complain undefined cluster view exception undefinedclusterviewexception sync voting happen instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview thread sleep instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview thread sleep instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview string new cluster id newclusterid instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get id getid string new cluster id newclusterid instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get id getid cluster ids assert equals assertequals new cluster id newclusterid new cluster id newclusterid instance dump repo dumprepo assert equals assertequals instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get instances getinstances size assert equals assertequals instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get instances getinstances size instance die longer heartbeats sling heartbeat time outs heartbeattimeouts properly time sleeps applied instance get config getconfig set view check timeout setviewchecktimeout instance get config getconfig set view check timeout setviewchecktimeout started test runs heartbeats manually instance stop view checker stopviewchecker instance heartbeats and check view heartbeatsandcheckview thread sleep instance heartbeats and check view heartbeatsandcheckview thread sleep instance heartbeats and check view heartbeatsandcheckview thread sleep instance heartbeats and check view heartbeatsandcheckview thread sleep instance heartbeats and check view heartbeatsandcheckview thread sleep instance heartbeats and check view heartbeatsandcheckview cluster size assert equals assertequals instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get instances getinstances size instance get view checker getviewchecker check view checkview instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview fail complain undefined cluster view exception undefinedclusterviewexception cluster remained stable instance dump repo dumprepo string actual cluster id actualclusterid instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get id getid logger info expected cluster new cluster id newclusterid logger info actual cluster actual cluster id actualclusterid assert equals assertequals new cluster id newclusterid actual cluster id actualclusterid logger info test stable cluster id teststableclusterid test test cluster view testclusterview exception logger info test cluster view testclusterview start assert not null assertnotnull instance assert not null assertnotnull instance assert null assertnull instance instance new builder newbuilder set debug name setdebugname third instance thirdinstance use repository of userepositoryof instance build assert not null assertnotnull instance assert equals assertequals instance get sling id getslingid instance get cluster view service getclusterviewservice get sling id getslingid assert equals assertequals instance get sling id getslingid instance get cluster view service getclusterviewservice get sling id getslingid assert equals assertequals instance get sling id getslingid instance get cluster view service getclusterviewservice get sling id getslingid instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview fail complain undefined cluster view exception undefinedclusterviewexception instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview fail complain undefined cluster view exception undefinedclusterviewexception instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview fail complain undefined cluster view exception undefinedclusterviewexception instance dump repo dumprepo instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview instance dump repo dumprepo logger info test cluster view testclusterview sleep thread sleep instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview logger info test cluster view testclusterview sleep thread sleep instance dump repo dumprepo string cluster id clusterid instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get id getid logger info cluster id clusterid cluster id clusterid string cluster id clusterid instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get id getid logger info cluster id clusterid cluster id clusterid string cluster id clusterid instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get id getid logger info cluster id clusterid cluster id clusterid assert equals assertequals cluster id clusterid cluster id clusterid assert equals assertequals cluster id clusterid cluster id clusterid assert equals assertequals instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get instances getinstances size assert equals assertequals instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get instances getinstances size assert equals assertequals instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get instances getinstances size logger info test cluster view testclusterview test test additional instance testadditionalinstance throwable logger info test additional instance testadditionalinstance start assert not null assertnotnull instance assert not null assertnotnull instance assert equals assertequals instance get sling id getslingid instance get cluster view service getclusterviewservice get sling id getslingid assert equals assertequals instance get sling id getslingid instance get cluster view service getclusterviewservice get sling id getslingid instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview fail complain undefined cluster view exception undefinedclusterviewexception instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview fail complain undefined cluster view exception undefinedclusterviewexception instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview instance dump repo dumprepo logger info test additional instance testadditionalinstance sleep thread sleep instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview logger info test additional instance testadditionalinstance sleep thread sleep instance dump repo dumprepo string cluster id clusterid instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get id getid logger info cluster id clusterid cluster id clusterid string cluster id clusterid instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get id getid logger info cluster id clusterid cluster id clusterid assert equals assertequals cluster id clusterid cluster id clusterid assert equals assertequals instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get instances getinstances size assert equals assertequals instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get instances getinstances size asserting topology event listener assertingtopologyeventlistener asserting topology event listener assertingtopologyeventlistener asserting topology event listener assertingtopologyeventlistener asserting topology event listener assertingtopologyeventlistener add expected addexpected type topology init assert equals assertequals asserting topology event listener assertingtopologyeventlistener get remaining expected count getremainingexpectedcount instance bind topology event listener bindtopologyeventlistener asserting topology event listener assertingtopologyeventlistener sling async event sending requires minimal wait time now adays nowadays thread sleep assert equals assertequals asserting topology event listener assertingtopologyeventlistener get remaining expected count getremainingexpectedcount startup instance acc epts multiple acceptsmultiple accepts multiple acceptsmultiple acc epts multiple acceptsmultiple type topology changing type topology changed asserting topology event listener assertingtopologyeventlistener add expected addexpected accepts multiple acceptsmultiple asserting topology event listener assertingtopologyeventlistener add expected addexpected accepts multiple acceptsmultiple instance new builder newbuilder set debug name setdebugname third instance thirdinstance use repository of userepositoryof instance build instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview logger info test additional instance testadditionalinstance sleep thread sleep assert equals assertequals accepts multiple acceptsmultiple get event cnt geteventcnt type topology changing assert equals assertequals accepts multiple acceptsmultiple get event cnt geteventcnt type topology changed logger info test additional instance testadditionalinstance test test property providers testpropertyproviders throwable logger info test property providers testpropertyproviders start instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview assert null assertnull instance instance new builder newbuilder set debug name setdebugname third instance thirdinstance use repository of userepositoryof instance build instance heartbeats and check view heartbeatsandcheckview logger info test property providers testpropertyproviders sleep thread sleep instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview logger info test property providers testpropertyproviders sleep thread sleep instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview logger info test property providers testpropertyproviders sleep thread sleep property uuid randomuuid to string tostring property uuid randomuuid to string tostring property provider impl propertyproviderimpl property provider impl propertyproviderimpl set property setproperty property property instance bind property provider bindpropertyprovider property property uuid randomuuid to string tostring property uuid randomuuid to string tostring property provider impl propertyproviderimpl property provider impl propertyproviderimpl set property setproperty property property instance bind property provider bindpropertyprovider property assert property values assertpropertyvalues property uuid randomuuid to string tostring set property setproperty property property instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview assert property values assertpropertyvalues assert null assertnull instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get instances getinstances get property getproperty uuid randomuuid to string tostring assert null assertnull instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get instances getinstances get property getproperty uuid randomuuid to string tostring logger info test property providers testpropertyproviders assert property values assertpropertyvalues undefined cluster view exception undefinedclusterviewexception assert property values assertpropertyvalues instance get sling id getslingid property property assert property values assertpropertyvalues instance get sling id getslingid property property assert property values assertpropertyvalues string sling id slingid string string undefined cluster view exception undefinedclusterviewexception assert equals assertequals get instance getinstance instance sling id slingid get property getproperty assert equals assertequals get instance getinstance instance sling id slingid get property getproperty instance description instancedescription get instance getinstance virtual instance virtualinstance instance string sling id slingid undefined cluster view exception undefinedclusterviewexception iterator instance description instancedescription instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get instances getinstances iterator has next hasnext instance description instancedescription get sling id getslingid equals sling id slingid illegal state exception illegalstateexception instance instance instance sling id slingid sling id slingid long running listener longrunninglistener topology event listener topologyeventlistener string fail msg failmsg init received initreceived non init received noninitreceived semaphore changed semaphore changedsemaphore semaphore assert no fail assertnofail fail msg failmsg fail fail msg failmsg semaphore get changed semaphore getchangedsemaphore changed semaphore changedsemaphore handle topology event handletopologyevent topology event topologyevent event fail msg failmsg fail msg failmsg failed event event init received initreceived event get type gettype type topology init fail msg failmsg expected topology init event get type gettype init received initreceived event get type gettype type topology changed changed semaphore changedsemaphore acquire interrupted exception interruptedexception error don int errupt interrupt pls non init received noninitreceived test plan discovery service discoveryservice listeners registered running topology hit deactivate discovery service deactivation block sling lock blocked running listener async hronous asynchronous event sending longer asserted deactivation finished listener busy listener fin ishes finishes listener event throwable test test long running listener testlongrunninglistener throwable instance instance idle instance get config getconfig set view check timeout setviewchecktimeout instance get config getconfig set view check timeout setviewchecktimeout logger info test long running listener testlongrunninglistener let ting letting instance remain silent instance heartbeats and check view heartbeatsandcheckview thread sleep instance heartbeats and check view heartbeatsandcheckview thread sleep instance heartbeats and check view heartbeatsandcheckview thread sleep instance heartbeats and check view heartbeatsandcheckview logger info test long running listener testlongrunninglistener instance considered dead instance dump repo dumprepo long running listener longrunninglistener long running listener longrunninglistener long running listener longrunninglistener asserting topology event listener assertingtopologyeventlistener fast listener fastlistener asserting topology event listener assertingtopologyeventlistener fast listener fastlistener add expected addexpected type topology init long running listener longrunninglistener assert no fail assertnofail assert equals assertequals fast listener fastlistener get remaining expected count getremainingexpectedcount logger info test long running listener testlongrunninglistener binding long running listener longrunninglistener instance bind topology event listener bindtopologyeventlistener long running listener longrunninglistener logger info test long running listener testlongrunninglistener binding fast listener fastlistener instance bind topology event listener bindtopologyeventlistener fast listener fastlistener logger info test long running listener testlongrunninglistener waiting bit long running listener longrunninglistener receive topology init event sling async event sending requires minimal wait time now adays nowadays thread sleep assert equals assertequals fast listener fastlistener get remaining expected count getremainingexpectedcount assert true asserttrue long running listener longrunninglistener init received initreceived init actual change listener running handling fast listener fastlistener add expected addexpected type topology changing fast listener fastlistener add expected addexpected type topology changed instance get config getconfig set view check timeout setviewchecktimeout instance get config getconfig set view check timeout setviewchecktimeout instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview thread sleep instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview thread sleep instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview thread sleep instance dump repo dumprepo long running listener longrunninglistener assert no fail assertnofail unexpected arrive listener assert equals assertequals fast listener fastlistener get unexpected count getunexpectedcount listener changing event cos changed event blocked assert equals assertequals fast listener fastlistener get remaining expected count getremainingexpectedcount listener changing changed blocked changed semaphore changedsemaphore assert equals assertequals long running listener longrunninglistener non init received noninitreceived thread sleep assert true asserttrue long running listener longrunninglistener get changed semaphore getchangedsemaphore has queue d threads hasqueuedthreads thread sleep sleep unchanged assert equals assertequals fast listener fastlistener get unexpected count getunexpectedcount assert equals assertequals fast listener fastlistener get remaining expected count getremainingexpectedcount assert equals assertequals long running listener longrunninglistener non init received noninitreceived assert true asserttrue long running listener longrunninglistener get changed semaphore getchangedsemaphore has queue d threads hasqueuedthreads simulate sling deactivation long running listener longrunninglistener processing simulate d simulated waiting changed semaphore changedsemaphore list exception async exception asyncexception linked list linkedlist exception thread thread runnable instance exception async exception asyncexception async exception asyncexception add start logger info waiting max join logger info waiting max is alive isalive logger warn thread alive is alive isalive release issuing fail test block long running listener longrunninglistener get changed semaphore getchangedsemaphore release fail thread alive logger info thread longer alive is alive isalive async exception asyncexception logger info async exceptions async exception asyncexception size async exception asyncexception size release issuing fail test block long running listener longrunninglistener get changed semaphore getchangedsemaphore release fail async exceptions async exception asyncexception size async exception asyncexception test consists fact reached place unlocking changed semaphore changedsemaphore unlock changed semaphore changedsemaphore remaining events flush long running listener longrunninglistener get changed semaphore getchangedsemaphore release should n shouldn flushed thread sleep assert equals assertequals fast listener fastlistener get unexpected count getunexpectedcount assert equals assertequals fast listener fastlistener get remaining expected count getremainingexpectedcount assert equals assertequals long running listener longrunninglistener non init received noninitreceived assert false assertfalse long running listener longrunninglistener get changed semaphore getchangedsemaphore has queue d threads hasqueuedthreads