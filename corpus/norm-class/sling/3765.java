licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling installer org junit assert equals assertequals org junit assert not null assertnotnull org junit fail org ops pax exam core options coreoptions junit bundles junitbundles org ops pax exam core options coreoptions maven bundle mavenbundle org ops pax exam core options coreoptions options org ops pax exam core options coreoptions provision org ops pax exam core options coreoptions system property systemproperty org ops pax exam core options coreoptions java file java file input stream fileinputstream java io exception ioexception java input stream inputstream java util array list arraylist java util dictionary java util enumeration java util hashtable java util list javax inject inject org apache sling installer api installable resource installableresource org apache sling installer api osgi installer osgiinstaller org apache sling installer api resource change listener resourcechangelistener org apache sling installer api info info provider infoprovider org apache sling installer api info installation state installationstate org apache sling installer api info resource org apache sling installer api info resource group resourcegroup org apache sling installer api tasks resource state resourcestate org junit org ops pax exam option org osgi framework bundle org osgi framework bundle context bundlecontext org osgi framework bundle exception bundleexception org osgi framework constants org osgi framework framework event frameworkevent org osgi framework framework listener frameworklistener org osgi framework service reference servicereference org osgi framework sync hronous bundle listener synchronousbundlelistener org osgi framework version org osgi framework namespace package name space packagenamespace org osgi framework wiring bundle capability bundlecapability org osgi framework wiring bundle wiring bundlewiring org osgi service configuration org osgi service configuration admin configurationadmin org osgi service log log service logservice org osgi service package admin packageadmin package admin packageadmin org osgi util tracker service tracker servicetracker base osgi installer osgiinstaller testing osgi installer test base osgiinstallertestbase framework listener frameworklistener string pom version system get property getproperty osgi installer pom version pom version string config version system get property getproperty installer configuration version installer version string jar ext jar package refresh events count packagerefresheventscount service tracker servicetracker config admin tracker configadmintracker osgi installer osgiinstaller installer resource change listener resourcechangelistener resource change listener resourcechangelistener info provider infoprovider info provider infoprovider wait change timeout wait action timeout msec string bundle base org apache sling installer pom version inject bundle context bundlecontext bundle context bundlecontext string url scheme osgi installer test osgiinstallertest condition is true istrue exception string additional info additionalinfo on failure onfailure get msec between eval uations getmsecbetweenevaluations helper method service type suppress warnings suppresswarnings unchecked get service getservice clazz service reference servicereference bundle context bundlecontext get service reference getservicereference clazz get name getname assert not null assertnotnull get service getservice clazz get name getname find service reference servicereference result bundle context bundlecontext get service getservice assert not null assertnotnull get service getservice clazz get name getname find service result result installer service setup installer setupinstaller installer get service getservice osgi installer osgiinstaller resource change listener resourcechangelistener get service getservice resource change listener resourcechangelistener info provider infoprovider get service getservice info provider infoprovider setup config admin tracker configadmintracker service tracker servicetracker bundle context bundlecontext configuration admin configurationadmin get name getname config admin tracker configadmintracker open tear tear down teardown config admin tracker configadmintracker config admin tracker configadmintracker close config admin tracker configadmintracker restart installer restart installer restartinstaller bundle exception bundleexception string symbolic name symbolicname org apache sling installer core bundle find bundle findbundle symbolic name symbolicname fail bundle symbolic name symbolicname log log service logservice log info res tarting restarting symbolic name symbolicname bundle start setup installer setupinstaller generate bundle event generatebundleevent exception install bundle manually generate bundle event file get test bundle gettestbundle org apache sling installer pom version test bundle testbundle jar input stream inputstream file input stream fileinputstream bundle bundle context bundlecontext install bundle installbundle get class getclass get name getname start timeout system current time millis currenttimemillis get state getstate bundle active system current time millis currenttimemillis timeout sleep close uninstall org osgi framework framework listener frameworklistener framework event frameworkevent org osgi framework framework event frameworkevent framework event frameworkevent framework event frameworkevent event event get type gettype framework event frameworkevent packages ref res hed refreshed package refresh events count packagerefresheventscount refresh packages refreshpackages bundle context bundlecontext add framework listener addframeworklistener max ref resh refresh packages wait seconds target event count targeteventcount package refresh events count packagerefresheventscount timeout system current time millis currenttimemillis max ref resh refresh packages wait seconds package admin packageadmin get service getservice package admin packageadmin refresh packages refreshpackages system current time millis currenttimemillis timeout package refresh events count packagerefresheventscount target event count targeteventcount sleep bundle context bundlecontext remove framework listener removeframeworklistener encode ldap filter escaped string encode string replace replace replace replace configuration find configuration findconfiguration string pid exception configuration admin configurationadmin wait for config admin waitforconfigadmin configuration cfgs list configurations listconfigurations constants service pid encode pid cfgs cfgs length cfgs length cfgs illegal state exception illegalstateexception configuration pid configuration find factory configuration findfactoryconfiguration string factory pid factorypid exception configuration admin configurationadmin wait for config admin waitforconfigadmin configuration cfgs list configurations listconfigurations configuration admin configurationadmin service factory pid factorypid encode factory pid factorypid cfgs cfgs length cfgs length cfgs illegal state exception illegalstateexception factory configuration factory pid factorypid wait for condition waitforcondition string info condition exception wait for condition waitforcondition info wait change timeout wait for condition waitforcondition string info condition time out timeout exception system current time millis currenttimemillis time out timeout is true istrue sleep get msec between eval uations getmsecbetweenevaluations system current time millis currenttimemillis additional info additionalinfo info additional info additionalinfo on failure onfailure fail wait for condition waitforcondition failed info configuration wait for factory config value waitforfactoryconfigvalue string info string factory pid factorypid string key string exception system current time millis currenttimemillis wait change timeout configuration wait for factory configuration waitforfactoryconfiguration info factory pid factorypid equals get properties getproperties key sleep system current time millis currenttimemillis fail key factory config factory pid factorypid configuration wait for config value waitforconfigvalue string info string pid string key string exception system current time millis currenttimemillis wait change timeout configuration wait for configuration waitforconfiguration info pid equals get properties getproperties key sleep system current time millis currenttimemillis fail key config pid configuration wait for configuration waitforconfiguration string info string pid should be present shouldbepresent exception wait for configuration waitforconfiguration info pid should be present shouldbepresent configuration wait for factory configuration waitforfactoryconfiguration string info string factory pid factorypid should be present shouldbepresent exception wait for configuration waitforconfiguration info factory pid factorypid should be present shouldbepresent configuration wait for configuration waitforconfiguration string info string pid string factory pid factorypid should be present shouldbepresent exception string log key logkey factory pid factorypid config factory config string msg info msg msg info configuration result start system current time millis currenttimemillis start wait change timeout log log service logservice log debug starting log key logkey check start factory pid factorypid result find factory configuration findfactoryconfiguration factory pid factorypid result find configuration findconfiguration pid should be present shouldbepresent result should be present shouldbepresent result log log service logservice log debug log key logkey check failed system current time millis currenttimemillis sleeping sleep system current time millis currenttimemillis should be present shouldbepresent result fail msg log key logkey factory pid factorypid factory pid factorypid pid should be present shouldbepresent result fail msg log key logkey factory pid factorypid factory pid factorypid pid result bundle find bundle findbundle string symbolic name symbolicname bundle bundle context bundlecontext get bundles getbundles symbolic name symbolicname equals get symbolic name getsymbolicname bundle assert bundle assertbundle string info string symbolic name symbolicname string version bundle find bundle findbundle symbolic name symbolicname info info info assert not null assertnotnull info expected bundle symbolic name symbolicname installed version assert equals assertequals info expected bundle symbolic name symbolicname version version version get headers getheaders constants bundle version assert equals assertequals info expected bundle symbolic name symbolicname get state getstate file get test bundle gettestbundle string bundle name bundlename file system get property getproperty osgi installer base dir bundle name bundlename installable resource installableresource get installable resource getinstallableresource file test bundle testbundle io exception ioexception get installable resource getinstallableresource test bundle testbundle string get non installable resource url getnoninstallableresourceurl file test bundle testbundle io exception ioexception string test bundle testbundle get absolute path getabsolutepath installable resource installableresource get installable resource getinstallableresource file test bundle testbundle string digest io exception ioexception get installable resource getinstallableresource test bundle testbundle digest installable resource installableresource priority installable resource installableresource get installable resource getinstallableresource file test bundle testbundle string digest priority io exception ioexception string url test bundle testbundle get absolute path getabsolutepath digest digest string value of valueof test bundle testbundle last modified lastmodified installable resource installableresource result mock installable resource mockinstallableresource url file input stream fileinputstream test bundle testbundle digest priority installable resource installableresource result installable resource installableresource get installable resource getinstallableresource string config pid configpid dictionary string object data get installable resource getinstallableresource config pid configpid copy data installable resource installableresource priority installable resource installableresource get installable resource getinstallableresource string config pid configpid dictionary string object data priority installable resource installableresource result mock installable resource mockinstallableresource config pid configpid copy data priority installable resource installableresource result dictionary string object copy dictionary string object data dictionary string object copy hashtable string object enumeration string data has more elements hasmoreelements string key next element nextelement copy key data key copy configuration admin configurationadmin wait for config admin waitforconfigadmin should be present shouldbepresent configuration admin configurationadmin result timeout wait until waituntil system current time millis currenttimemillis timeout is present ispresent result configuration admin configurationadmin config admin tracker configadmintracker get service getservice is present ispresent result should be present shouldbepresent is present ispresent result system current time millis currenttimemillis wait until waituntil assert equals assertequals expected configuration admin configurationadmin should be present shouldbepresent absent should be present shouldbepresent is present ispresent result bundle get config admin bundle getconfigadminbundle wait for config admin waitforconfigadmin config admin tracker configadmintracker get service reference getservicereference get bundle getbundle sleep msec thread sleep msec interrupted exception interruptedexception log level string msg log service logservice log get service getservice log service logservice log log level msg option default configuration defaultconfiguration string vm opt vmopt dosgi installer testing object system get properties getproperties key set keyset string key string key starts with startswith osgi installer vm opt vmopt key system get property getproperty key string pax debug level paxdebuglevel system get property getproperty pax exam log level info string pax debug port paxdebugport system get property getproperty pax exam debug port pax debug port paxdebugport pax debug port paxdebugport length vm opt vmopt xrunjdwp transport socket server suspend add ress address pax debug port paxdebugport string local repo localrepo system get property getproperty maven repo local options junit bundles junitbundles local repo localrepo length use options useoptions system property systemproperty org ops pax url mvn local repository localrepository local repo localrepo system property systemproperty org ops pax logging default service log defaultservicelog level pax debug level paxdebuglevel provision maven bundle mavenbundle org apache sling org apache sling commons log maven bundle mavenbundle org apache sling org apache sling commons logs ervice logservice maven bundle mavenbundle org slf slf api maven bundle mavenbundle org slf jcl slf maven bundle mavenbundle org slf log slf maven bundle mavenbundle org apache felix org apache felix scr maven bundle mavenbundle org apache felix org apache felix config admin configadmin maven bundle mavenbundle org apache felix org apache felix metatype maven bundle mavenbundle org apache sling org apache sling installer core pom version start level startlevel maven bundle mavenbundle org apache sling org apache sling installer factory configuration config version start level startlevel object start observing bundle events startobservingbundleevents bundle event listener bundleeventlistener listener bundle event listener bundleeventlistener bundle context bundlecontext add bundle listener addbundlelistener listener listener bundle event bundleevent string symbolic name symbolicname version version bundle event bundleevent string string symbolic name symbolicname version version parse version parseversion bundle event bundleevent string override string to string tostring bundle event bundleevent symbolic name symbolicname version version wait for bundle events waitforbundleevents string msg object bundle event bundleevent events exception bundle event listener bundleeventlistener listener bundle event listener bundleeventlistener listener wait msg events wait action timeout msec bundle context bundlecontext remove bundle listener removebundlelistener listener wait for bundle events waitforbundleevents string msg object timeout bundle event bundleevent events exception bundle event listener bundleeventlistener listener bundle event listener bundleeventlistener listener wait msg events timeout bundle context bundlecontext remove bundle listener removebundlelistener listener assert no bundle events assertnobundleevents string msg object string symbolic name symbolicname bundle event listener bundleeventlistener listener bundle event listener bundleeventlistener listener assert no bundle events assertnobundleevents msg symbolic name symbolicname bundle context bundlecontext remove bundle listener removebundlelistener listener is package exported ispackageexported bundle string package name packagename bundle wiring bundlewiring wiring adapt bundle wiring bundlewiring assert not null assertnotnull expecting bundle wiring bundlewiring bundle wiring bundle capability bundlecapability wiring get capabilities getcapabilities package name space packagenamespace name space namespace package name packagename equals get attributes getattributes package name space packagenamespace name space namespace log installed bundles loginstalledbundles bundle bundle context bundlecontext get bundles getbundles log log service logservice log debug installed bundle get symbolic name getsymbolicname resource wait for resource waitforresource string url resource state resourcestate start system current time millis currenttimemillis start wait change timeout installation state installationstate info provider infoprovider get installation state getinstallationstate resource group resourcegroup resource state resourcestate install resource state resourcestate uninstall get active resources getactiveresources get installed resources getinstalledresources resource rsrc get resources getresources url equals rsrc geturl rsrc get state getstate rsrc sleep system current time millis currenttimemillis fail resource url info provider infoprovider get installation state getinstallationstate bundle event listener bundleeventlistener sync hronous bundle listener synchronousbundlelistener list bundle event bundleevent events array list arraylist bundle event bundleevent bundle changed bundlechanged org osgi framework bundle event bundleevent event events add bundle event bundleevent event get bundle getbundle get symbolic name getsymbolicname event get bundle getbundle get version getversion to string tostring event get type gettype wait string msg bundle event bundleevent check events checkevents timeout msec timeoutmsec exception check events checkevents check events checkevents length start system current time millis currenttimemillis start timeout msec timeoutmsec log log service logservice log debug starting event check start system current time millis currenttimemillis events size check events checkevents length bundle event bundleevent check events checkevents start index startindex old found oldfound old found oldfound start index startindex events size bundle event bundleevent bundle event bundleevent events start index startindex symbolic name symbolicname symbolic name symbolicname equals bundle event bundleevent symbolic name symbolicname version version equals bundle event bundleevent version bundle event bundleevent old found oldfound start index startindex check events checkevents length sleep log installed bundles loginstalledbundles string builder stringbuilder string builder stringbuilder append msg append expected events bundle event bundleevent check events checkevents append append append nreceived events bundle event bundleevent events append append append fail to string tostring assert no bundle events assertnobundleevents string msg string symbolic name symbolicname symbolic name symbolicname events size bundle event bundleevent events symbolic name symbolicname equals symbolic name symbolicname fail msg expected receive bundle events bundle symbolic name symbolicname