licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling discovery oak org junit assert equals assertequals org junit assert false assertfalse org junit assert true asserttrue org apache log level org apache log log manager logmanager org apache sling discovery topology event topologyevent type org apache sling discovery topology view topologyview org apache sling discovery base abstract discovery service test abstractdiscoveryservicetest org apache sling discovery base setup virtual instance virtualinstance org apache sling discovery base setup virtual instance builder virtualinstancebuilder org apache sling discovery base setup mock asserting topology event listener assertingtopologyeventlistener org apache sling discovery oak oak discovery service oakdiscoveryservice org apache sling discovery oak setup oak virtual instance builder oakvirtualinstancebuilder org junit org junit org junit test org slf logger org slf logger factory loggerfactory oak discovery service test oakdiscoveryservicetest abstract discovery service test abstractdiscoveryservicetest logger logger logger factory loggerfactory get logger getlogger get class getclass level log level loglevel virtual instance virtualinstance instance virtual instance virtualinstance instance oak virtual instance builder oakvirtualinstancebuilder new builder newbuilder oak virtual instance builder oakvirtualinstancebuilder set up setup exception org apache log logger discovery logger discoverylogger log manager logmanager get root logger getrootlogger get logger getlogger org apache sling discovery log level loglevel discovery logger discoverylogger get level getlevel discovery logger discoverylogger set level setlevel level info tear t down teartdown throwable org apache log logger discovery logger discoverylogger log manager logmanager get root logger getrootlogger get logger getlogger org apache sling discovery discovery logger discoverylogger set level setlevel log level loglevel instance instance stop view checker stopviewchecker instance instance instance instance stop view checker stopviewchecker instance instance tests current view returned get topology gettopology matches listeners topology changing basic ally basically test test old view testoldview throwable org apache log logger discovery logger discoverylogger log manager logmanager get root logger getrootlogger get logger getlogger org apache sling discovery info discovery logger discoverylogger set level setlevel level info oak virtual instance builder oakvirtualinstancebuilder builder new builder newbuilder builder set debug name setdebugname first instance a firstinstancea new repository newrepository discovery oak set connector ping timeout setconnectorpingtimeout set min event delay setmineventdelay instance builder build instance stop view checker stopviewchecker instance stop voting stopvoting topology view topologyview instance get discovery service getdiscoveryservice get topology gettopology current assert false assertfalse is current iscurrent local instance assert equals assertequals get instances getinstances size asserting topology event listener assertingtopologyeventlistener asserting topology event listener assertingtopologyeventlistener instance add expected addexpected type topology init instance bind topology event listener bindtopologyeventlistener logger info test old view testoldview instance created events expected sling id slingid instance sling id slingid instance heartbeats and check view heartbeatsandcheckview thread sleep instance heartbeats and check view heartbeatsandcheckview thread sleep instance heartbeats and check view heartbeatsandcheckview thread sleep logger info test old view testoldview heartbeat expecting topology init instance dump repo dumprepo event assert equals assertequals get events getevents size expected assert equals assertequals get remaining expected count getremainingexpectedcount assert equals assertequals get unexpected count getunexpectedcount instance get discovery service getdiscoveryservice get topology gettopology current assert true asserttrue is current iscurrent local instance assert equals assertequals get instances getinstances size logger info test old view testoldview creating instance builder get simulated lease collection getsimulatedleasecollection set final setfinal add expected addexpected type topology changing virtual instance builder virtualinstancebuilder builder new builder newbuilder builder set debug name setdebugname second instance b secondinstanceb use repository of userepositoryof instance set connector ping timeout setconnectorpingtimeout set min event delay setmineventdelay instance builder build instance stop view checker stopviewchecker instance stop voting stopvoting logger info test old view testoldview instance created issuing heartbeat instance instance not e note instance get view checker getviewchecker check view checkview oak discovery service oakdiscoveryservice oak disco oakdisco oak discovery service oakdiscoveryservice instance get discovery service getdiscoveryservice oak disco oakdisco check for topology change checkfortopologychange logger info test old view testoldview instance heartbeat instance instance get view checker getviewchecker check view checkview oak discovery service oakdiscoveryservice oak disco oakdisco oak discovery service oakdiscoveryservice instance get discovery service getdiscoveryservice oak disco oakdisco check for topology change checkfortopologychange logger info test old view testoldview sleep time changing thread sleep logger info test old view testoldview sleep init changing assert equals assertequals get events getevents size remaining expected assert equals assertequals get remaining expected count getremainingexpectedcount unexpected assert equals assertequals get unexpected count getunexpectedcount instance get discovery service getdiscoveryservice get topology gettopology current assert false assertfalse is current iscurrent local instance assert equals assertequals get instances getinstances size builder get simulated lease collection getsimulatedleasecollection set final setfinal add expected addexpected type topology changed logger info test old view testoldview issuing rounds heartbeats checks expecting topology changed instance heartbeats and check view heartbeatsandcheckview instance analyze votings analyzevotings instance heartbeats and check view heartbeatsandcheckview instance analyze votings analyzevotings thread sleep instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview thread sleep instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview thread sleep init changing changed assert equals assertequals get events getevents size remaining expected assert equals assertequals get remaining expected count getremainingexpectedcount unexpected assert equals assertequals get unexpected count getunexpectedcount instance get discovery service getdiscoveryservice get topology gettopology current assert true asserttrue is current iscurrent instances assert equals assertequals get instances getinstances size timeout heartbeats instance instance crash builder get simulated lease collection getsimulatedleasecollection set final setfinal add expected addexpected type topology changing instance heartbeats and check view heartbeatsandcheckview thread sleep init changing changed changing assert equals assertequals get events getevents size remaining expected assert equals assertequals get remaining expected count getremainingexpectedcount unexpected assert equals assertequals get unexpected count getunexpectedcount instance get discovery service getdiscoveryservice get topology gettopology current assert false assertfalse is current iscurrent instances assert equals assertequals get instances getinstances size