licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling scripting sightly impl engine java io exception ioexception java input stream inputstream java net url java util map javax script bindings org apache commons io utils ioutils org apache commons lang string escape utils stringescapeutils org apache commons lang string utils stringutils org apache felix scr annotations activate org apache felix scr annotations component org apache felix scr annotations reference org apache felix scr annotations service org apache sling api sling http servlet response slinghttpservletresponse org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling api scripting sling bindings slingbindings org apache sling commons class loader classloader class loader writer classloaderwriter org apache sling scripting sightly sightly exception sightlyexception org apache sling scripting sightly impl compiled compilation output compilationoutput org apache sling scripting sightly impl compiled java class backend javaclassbackend org apache sling scripting sightly impl compiler sightly compiler service sightlycompilerservice org apache sling scripting sightly impl compiler sightly java compiler service sightlyjavacompilerservice org apache sling scripting sightly impl compiler sightly parsing exception sightlyparsingexception org apache sling scripting sightly impl compiler unit change monitor unitchangemonitor org apache sling scripting sightly impl compiler util global shadow check backend globalshadowcheckbackend org apache sling scripting sightly impl engine compiled java class template javaclasstemplate org apache sling scripting sightly impl engine compiled source identifier sourceidentifier org apache sling scripting sightly impl engine runtime render unit renderunit org apache sling scripting sightly render render context rendercontext org osgi service component component context componentcontext org slf logger org slf logger factory loggerfactory create rendering units resources component service unit loader unitloader unit loader unitloader string prefix sightly java sightlyjava logger log logger factory loggerfactory get logger getlogger unit loader unitloader string main template path templates compiled unit template txt string child template path templates sub template subtemplate txt string main template maintemplate string child template childtemplate reference sightly compiler service sightlycompilerservice sightly compiler service sightlycompilerservice reference sightly java compiler service sightlyjavacompilerservice sightly java compiler service sightlyjavacompilerservice reference sightly engine configuration sightlyengineconfiguration sightly engine configuration sightlyengineconfiguration reference class loader writer classloaderwriter class loader writer classloaderwriter reference unit change monitor unitchangemonitor unit change monitor unitchangemonitor create render unit resource param script resource scriptresource resource param bindings bindings param render context rendercontext rendering context render unit exception unit creation fails render unit renderunit create unit createunit resource script resource scriptresource bindings bindings render context rendercontext render context rendercontext exception resource resolver resourceresolver admin resolver adminresolver render context rendercontext get script resource resolver getscriptresourceresolver source identifier sourceidentifier source identifier sourceidentifier source identifier sourceidentifier sightly engine configuration sightlyengineconfiguration unit change monitor unitchangemonitor class loader writer classloaderwriter script resource scriptresource prefix object obj string encoding source identifier sourceidentifier needs update needsupdate encoding unit change monitor unitchangemonitor get script encoding getscriptencoding script resource scriptresource get path getpath string source code sourcecode get source code for script getsourcecodeforscript admin resolver adminresolver source identifier sourceidentifier bindings encoding obj sightly java compiler service sightlyjavacompilerservice compile source compilesource source identifier sourceidentifier source code sourcecode source identifier sourceidentifier get fully qualified name getfullyqualifiedname encoding unit change monitor unitchangemonitor get script encoding getscriptencoding script resource scriptresource get path getpath obj sightly java compiler service sightlyjavacompilerservice get instance getinstance admin resolver adminresolver source identifier sourceidentifier get fully qualified name getfullyqualifiedname obj render unit renderunit sightly exception sightlyexception render unit renderunit instance sling http servlet response slinghttpservletresponse response sling http servlet response slinghttpservletresponse bindings sling bindings slingbindings response response set character encoding setcharacterencoding encoding render unit renderunit obj activate suppress warnings suppresswarnings unused activate component context componentcontext component context componentcontext main template maintemplate resource file resourcefile component context componentcontext main template path child template childtemplate resource file resourcefile component context componentcontext child template path string get source code for script getsourcecodeforscript resource resolver resourceresolver resolver source identifier sourceidentifier identifier bindings bindings string encoding string script source scriptsource resource script resource scriptresource resolver get resource getresource identifier get resource getresource get path getpath script resource scriptresource script source scriptsource io utils ioutils to string tostring script resource scriptresource adapt to adaptto input stream inputstream encoding obtain result source obtainresultsource script source scriptsource identifier bindings sightly exception sightlyexception find template identifier get resource getresource get path getpath repository sightly parsing exception sightlyparsingexception string offending input offendinginput get off ending input getoffendinginput string utils stringutils is not empty isnotempty offending input offendinginput offending input offendinginput string escape utils stringescapeutils unescape html unescapehtml offending input offendinginput trim error line errorline get line where error occurred getlinewhereerroroccurred script source scriptsource offending input offendinginput sightly exception sightlyexception parsing error template identifier get resource getresource get path getpath error line errorline get message getmessage expression offending input offendinginput io exception ioexception sightly exception sightlyexception unable read contents identifier get resource getresource get path getpath string obtain result source obtainresultsource string script source scriptsource source identifier sourceidentifier identifier bindings bindings java class template javaclasstemplate class template classtemplate new main template newmaintemplate class template classtemplate set class name setclassname identifier get class name getclassname class template classtemplate set package name setpackagename identifier get package name getpackagename compilation output compilationoutput compilation output compilationoutput obtain output obtainoutput script source scriptsource bindings process compilation result processcompilationresult compilation output compilationoutput class template classtemplate class template classtemplate to string tostring compilation output compilationoutput obtain output obtainoutput string source bindings bindings java class backend javaclassbackend back end backend java class backend javaclassbackend sightly compiler service sightlycompilerservice compile source global shadow check backend globalshadowcheckbackend back end backend bindings key set keyset back end backend build process compilation result processcompilationresult compilation output compilationoutput result java class template javaclasstemplate main template maintemplate main template maintemplate write main body writemainbody result get main body getmainbody map entry string compilation output compilationoutput entry result get sub templates getsubtemplates entry set entryset java class template javaclasstemplate child template childtemplate new child template newchildtemplate process compilation result processcompilationresult entry get value getvalue child template childtemplate main template maintemplate write sub template writesubtemplate entry get key getkey child template childtemplate to string tostring java class template javaclasstemplate new main template newmaintemplate java class template javaclasstemplate main template maintemplate java class template javaclasstemplate new child template newchildtemplate java class template javaclasstemplate child template childtemplate string resource file resourcefile component context componentcontext component context componentcontext string path input stream inputstream input stream inputstream url url component context componentcontext get bundle context getbundlecontext get bundle getbundle get entry getentry path url sightly exception sightlyexception bundle resource res ides resides path input stream inputstream component context componentcontext get bundle context getbundlecontext get bundle getbundle get entry getentry path open stream openstream io utils ioutils to string tostring input stream inputstream io exception ioexception sightly exception sightlyexception java templates input stream inputstream input stream inputstream close io exception ioexception log error error closing bundle resource stream get line where error occurred getlinewhereerroroccurred string document fragment documentfragment string offending input offendinginput offending input index offendinginputindex document fragment documentfragment index of indexof offending input offendinginput string text before error textbeforeerror document fragment documentfragment substring offending input index offendinginputindex new line newline text before error textbeforeerror length new line newline new line newline text before error textbeforeerror index of indexof new line newline text before error textbeforeerror text before error textbeforeerror substring new line newline text before error textbeforeerror length