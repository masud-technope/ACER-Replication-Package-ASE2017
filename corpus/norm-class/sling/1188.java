licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling resource resolver resourceresolver impl java util arrays as list aslist org apache sling resource resolver resourceresolver impl mocked resource resolver impl test mockedresourceresolverimpltest createrphandler org junit assert equals assertequals org junit assert false assertfalse org junit assert not null assertnotnull org junit assert null assertnull org junit assert true asserttrue org junit fail org mockito mockito mock org mockito mockito spy org mockito mockito java util array list arraylist java util hash map hashmap java util hash set hashset java util iterator java util list java util map javax jcr session javax servlet http http servlet request httpservletrequest org apache sling api sling exception slingexception org apache sling api resource login exception loginexception org apache sling api resource non existing resource nonexistingresource org apache sling api resource persistence exception persistenceexception org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling api resource resource resolver factory resourceresolverfactory org apache sling api resource synthetic resource syntheticresource org apache sling resource resolver resourceresolver impl providers resource provider handler resourceproviderhandler org apache sling resource resolver resourceresolver impl providers resource provider storage resourceproviderstorage org apache sling resource resolver resourceresolver impl providers resource provider tracker resourceprovidertracker org apache sling spi resource provider resolver context resolvercontext org apache sling spi resource provider resource context resourcecontext org apache sling spi resource provider resource provider resourceprovider org junit org junit test org mockito internal util ref lection reflection white box whitebox resource resolver impl test resourceresolverimpltest common resource resolver factory impl commonresourceresolverfactoryimpl common factory commonfactory resource resolver resourceresolver res resolver resresolver resource resolver factory impl resourceresolverfactoryimpl res fac resfac resource provider tracker resourceprovidertracker resource provider tracker resourceprovidertracker setup login exception loginexception resource provider resourceprovider resource provider resourceprovider object override resource get resource getresource resolver context resolvercontext object ctx string path resource context resourcecontext r ctx rctx resource parent override iterator resource list children listchildren resolver context resolvercontext object ctx resource parent list resource provider handler resourceproviderhandler handlers as list aslist createrphandler resource provider tracker resourceprovidertracker mock resource provider tracker resourceprovidertracker resource provider storage resourceproviderstorage storage resource provider storage resourceproviderstorage handlers resource provider tracker resourceprovidertracker get resource provider storage getresourceproviderstorage then return thenreturn storage resource resolver factory activator resourceresolverfactoryactivator activator resource resolver factory activator resourceresolverfactoryactivator activator resource provider tracker resourceprovidertracker resource provider tracker resourceprovidertracker common factory commonfactory common resource resolver factory impl commonresourceresolverfactoryimpl activator res fac resfac resource resolver factory impl resourceresolverfactoryimpl common factory commonfactory todo bundle res resolver resresolver res fac resfac get administrative resource resolver getadministrativeresourceresolver suppress warnings suppresswarnings deprecation test test close testclose exception resource resolver resourceresolver resource resolver impl resourceresolverimpl common factory commonfactory resource provider tracker resourceprovidertracker get resource provider storage getresourceproviderstorage assert true asserttrue is live islive close assert false assertfalse is live islive close allowed called close assert false assertfalse is live islive check method adapt t o adaptto session fail illegal state exception illegalstateexception ise clone fail illegal state exception illegalstateexception ise find resources findresources fail illegal state exception illegalstateexception ise get attribute getattribute fail illegal state exception illegalstateexception ise get attribute names getattributenames fail illegal state exception illegalstateexception ise get resource getresource fail illegal state exception illegalstateexception ise get resource getresource fail illegal state exception illegalstateexception ise get search path getsearchpath fail illegal state exception illegalstateexception ise get user d getuserid fail illegal state exception illegalstateexception ise list children listchildren fail illegal state exception illegalstateexception ise map some path somepath fail illegal state exception illegalstateexception ise map some path somepath fail illegal state exception illegalstateexception ise query resources queryresources fail illegal state exception illegalstateexception ise resolve http servlet request httpservletrequest fail illegal state exception illegalstateexception ise resolve path fail illegal state exception illegalstateexception ise resolve path fail illegal state exception illegalstateexception ise suppress warnings suppresswarnings deprecation test test close with stack trace logging testclosewithstacktracelogging exception resource resolver factory activator resourceresolverfactoryactivator rrfa spy resource resolver factory activator resourceresolverfactoryactivator white box whitebox set internal state setinternalstate rrfa log resource resolver closing logresourceresolverclosing common resource resolver factory impl commonresourceresolverfactoryimpl crrfi common resource resolver factory impl commonresourceresolverfactoryimpl rrfa resource resolver resourceresolver resource resolver impl resourceresolverimpl crrfi resource provider tracker resourceprovidertracker get resource provider storage getresourceproviderstorage assert true asserttrue is live islive close assert false assertfalse is live islive close allowed called close assert false assertfalse is live islive check method adapt t o adaptto session fail illegal state exception illegalstateexception ise clone fail illegal state exception illegalstateexception ise find resources findresources fail illegal state exception illegalstateexception ise get attribute getattribute fail illegal state exception illegalstateexception ise get attribute names getattributenames fail illegal state exception illegalstateexception ise get resource getresource fail illegal state exception illegalstateexception ise get resource getresource fail illegal state exception illegalstateexception ise get search path getsearchpath fail illegal state exception illegalstateexception ise get user d getuserid fail illegal state exception illegalstateexception ise list children listchildren fail illegal state exception illegalstateexception ise map some path somepath fail illegal state exception illegalstateexception ise map some path somepath fail illegal state exception illegalstateexception ise query resources queryresources fail illegal state exception illegalstateexception ise resolve http servlet request httpservletrequest fail illegal state exception illegalstateexception ise resolve path fail illegal state exception illegalstateexception ise resolve path fail illegal state exception illegalstateexception ise suppress warnings suppresswarnings deprecation test testbasicapiassumptions exception resource accessing exists resource res res resolver resresolver resolve string assert not null assertnotnull res assert true asserttrue resource non existing resource nonexistingresource res non existing resource nonexistingresource assert equals assertequals path expected root res get path getpath relative paths treated absolute string path rel path relpath rel path relpath resource res res resolver resresolver resolve path assert not null assertnotnull res assert equals assertequals expecting absolute path relative path path res get path getpath assert true asserttrue resource non existing resource nonexistingresource res non existing resource nonexistingresource string resource path resource location resource res res resolver resresolver resolve resource path assert not null assertnotnull res assert equals assertequals expecting absolute path relative path resource path res get path getpath assert true asserttrue resource non existing resource nonexistingresource res non existing resource nonexistingresource res resolver resresolver resolve http servlet request httpservletrequest fail expected null pointer exception nullpointerexception resolve request null pointer exception nullpointerexception npe resource res res resolver resresolver resolve resource path assert not null assertnotnull expecting resource resolution fails res assert true asserttrue resource non existing resource nonexistingresource res non existing resource nonexistingresource assert equals assertequals path original path resource path res get path getpath http servlet request httpservletrequest req mock http servlet request httpservletrequest req get protocol getprotocol then return thenreturn http req get server name getservername then return thenreturn localhost req get path info getpathinfo then return thenreturn resource path resource res res resolver resresolver resolve req assert not null assertnotnull expecting resource resolution fails res assert true asserttrue resource non existing resource nonexistingresource res non existing resource nonexistingresource assert equals assertequals path original path resource path res get path getpath http servlet request httpservletrequest req mock http servlet request httpservletrequest req get protocol getprotocol then return thenreturn http req get server name getservername then return thenreturn localhost req get path info getpathinfo then return thenreturn resource res res resolver resresolver resolve req assert not null assertnotnull expecting resource resolution fails res assert true asserttrue resource non existing resource nonexistingresource res non existing resource nonexistingresource assert equals assertequals path root path res get path getpath resource res res resolver resresolver get resource getresource assert null assertnull expected resource path res resource res res resolver resresolver get resource getresource assert null assertnull expected resource path res resource res res resolver resresolver get resource getresource res assert null assertnull expected resource path res test test clone based anonymous exception resource resolver resourceresolver anon res fac resfac get resource resolver getresourceresolver map string object session session anon session anon adapt t o adaptto session assert null assertnull session anon session user user assert equals assertequals anon get user d getuserid user workspace resource resolver resourceresolver anon anon clone session anon session anon adapt t o adaptto session assert equals assertequals anon get user d getuserid anon get user d getuserid assert null assertnull session anon session anon close workspace admin user map string object admin cred hash map hashmap string object admin cred resource resolver factory resourceresolverfactory user admin admin cred resource resolver factory resourceresolverfactory password admin to char array tochararray resource resolver resourceresolver admin anon clone admin cred assert equals assertequals admin admin get user d getuserid admin close anon close test test clone based admin exception resource resolver resourceresolver admin res fac resfac get administrative resource resolver getadministrativeresourceresolver map string object user user assert equals assertequals admin get user d getuserid user workspace resource resolver resourceresolver admin admin clone assert equals assertequals admin get user d getuserid admin get user d getuserid admin close workspace anonymous user map string object anon cred hash map hashmap string object anon cred resource resolver factory resourceresolverfactory user anonymous resource resolver resourceresolver anon admin clone anon cred assert equals assertequals anonymous anon get user d getuserid anon close admin close test test attributes auth info authinfo exception map string object auth info authinfo hash map hashmap string object auth info authinfo resource resolver factory resourceresolverfactory user admin auth info authinfo resource resolver factory resourceresolverfactory password admin to char array tochararray auth info authinfo test attribute string testattributestring a string value astringvalue auth info authinfo test attribute number testattributenumber resource resolver resourceresolver res fac resfac get resource resolver getresourceresolver auth info authinfo assert equals assertequals a string value astringvalue get attribute getattribute test attribute string testattributestring assert equals assertequals get attribute getattribute test attribute number testattributenumber assert equals assertequals admin get attribute getattribute resource resolver factory resourceresolverfactory user assert null assertnull get attribute getattribute resource resolver factory resourceresolverfactory password hash set hashset string valid names validnames hash set hashset string valid names validnames add resource resolver factory resourceresolverfactory user valid names validnames add test attribute string testattributestring valid names validnames add test attribute number testattributenumber iterator string names get attribute names getattributenames assert true asserttrue valid names validnames remove names assert true asserttrue valid names validnames remove names assert true asserttrue valid names validnames remove names assert false assertfalse expect names names has next hasnext assert true asserttrue expect valid names validnames empty valid names validnames is empty isempty close test test basic crud testbasiccrud exception resource mock resource get path getpath then return thenreturn res resolver resresolver create fail parent resource npe null pointer exception nullpointerexception npe res resolver resresolver create fail npe null pointer exception nullpointerexception npe res resolver resresolver create fail slash illegal argument exception illegal argument exception illegalargumentexception res resolver resresolver create fail unsupported persistence exception persistenceexception uoe test test get resource super type getresourcesupertype path based resource resolver impl pathbasedresourceresolverimpl resolver get path based resource resolver getpathbasedresourceresolver resources test resource resolver add synthetic resource syntheticresource resolver resource resolver add synthetic resource syntheticresource resolver resolver add synthetic resource with supertype syntheticresourcewithsupertype resolver assert equals assertequals resolver get parent resource type getparentresourcetype get resource type getresourcetype assert null assertnull resolver get parent resource type getparentresourcetype get resource type getresourcetype test test is resource type testisresourcetype path based resource resolver impl pathbasedresourceresolverimpl resolver get path based resource resolver getpathbasedresourceresolver resource resolver add synthetic resource with supertype syntheticresourcewithsupertype resolver resolver add synthetic resource with supertype syntheticresourcewithsupertype resolver assert true asserttrue resolver is resource type isresourcetype assert true asserttrue resolver is resource type isresourcetype assert false assertfalse resolver is resource type isresourcetype assert true asserttrue resolver is resource type isresourcetype assert false assertfalse resolver is resource type isresourcetype test test is resource type with paths testisresourcetypewithpaths path based resource resolver impl pathbasedresourceresolverimpl resolver get path based resource resolver getpathbasedresourceresolver prepare resource type hierarchy types types types resolver add synthetic resource with supertype syntheticresourcewithsupertype resolver types types component types resolver add synthetic resource with supertype syntheticresourcewithsupertype resolver types types component types resolver add synthetic resource syntheticresource resolver types types component resource resource t resourcet resolver add synthetic resource syntheticresource resolver resource t resourcet types resource resource t resourcet resolver add synthetic resource syntheticresource resolver resource t resourcet types resource resource t resourcet resolver add synthetic resource syntheticresource resolver resource t resourcet types assert true asserttrue resolver is resource type isresourcetype resource t resourcet types assert true asserttrue resolver is resource type isresourcetype resource t resourcet types assert true asserttrue resolver is resource type isresourcetype resource t resourcet types assert false assertfalse resolver is resource type isresourcetype resource t resourcet types component assert false assertfalse resolver is resource type isresourcetype resource t resourcet types unknown assert false assertfalse resolver is resource type isresourcetype resource t resourcet types assert true asserttrue resolver is resource type isresourcetype resource t resourcet types assert true asserttrue resolver is resource type isresourcetype resource t resourcet types assert false assertfalse resolver is resource type isresourcetype resource t resourcet types component assert false assertfalse resolver is resource type isresourcetype resource t resourcet types unknown assert false assertfalse resolver is resource type isresourcetype resource t resourcet types assert false assertfalse resolver is resource type isresourcetype resource t resourcet types assert true asserttrue resolver is resource type isresourcetype resource t resourcet types assert false assertfalse resolver is resource type isresourcetype resource t resourcet types component assert false assertfalse resolver is resource type isresourcetype resource t resourcet types unknown test expected sling exception slingexception test is resource cyclic hierarchy direct testisresourcecyclichierarchydirect path based resource resolver impl pathbasedresourceresolverimpl resolver get path based resource resolver getpathbasedresourceresolver prepare resource type hierarchy types types resolver add synthetic resource with supertype syntheticresourcewithsupertype resolver types types component types resolver add synthetic resource with supertype syntheticresourcewithsupertype resolver types types component types resource resource resolver add synthetic resource syntheticresource resolver resource t resourcet types assert true asserttrue resolver is resource type isresourcetype resource types assert true asserttrue resolver is resource type isresourcetype resource types sling exception slingexception detecting cyclic hierarchy resolver is resource type isresourcetype resource types unknown test expected sling exception slingexception test is resource cyclic hierarchy indirect testisresourcecyclichierarchyindirect path based resource resolver impl pathbasedresourceresolverimpl resolver get path based resource resolver getpathbasedresourceresolver prepare resource type hierarchy types types types resolver add synthetic resource with supertype syntheticresourcewithsupertype resolver types types component types resolver add synthetic resource with supertype syntheticresourcewithsupertype resolver types types component types resolver add synthetic resource with supertype syntheticresourcewithsupertype resolver types types component types resource resource resolver add synthetic resource syntheticresource resolver resource t resourcet types assert true asserttrue resolver is resource type isresourcetype resource types assert true asserttrue resolver is resource type isresourcetype resource types assert true asserttrue resolver is resource type isresourcetype resource types sling exception slingexception detecting cyclic hierarchy resolver is resource type isresourcetype resource types unknown path based resource resolver impl pathbasedresourceresolverimpl get path based resource resolver getpathbasedresourceresolver list resource resolver resourceresolver resolve rs resolvers array list arraylist resource resolver resourceresolver path based resource resolver impl pathbasedresourceresolverimpl resolver path based resource resolver impl pathbasedresourceresolverimpl resolve rs resolvers resource provider tracker resourceprovidertracker resolve rs resolvers add resolver resolver login exception loginexception runtime exception runtimeexception path based resource resolver impl pathbasedresourceresolverimpl resource resolver impl resourceresolverimpl map string resource resources hash map hashmap string resource path based resource resolver impl pathbasedresourceresolverimpl list resource resolver resourceresolver resolve rs resolvers resource provider tracker resourceprovidertracker resource provider tracker resourceprovidertracker login exception loginexception common resource resolver factory impl commonresourceresolverfactoryimpl resource resolver factory activator resourceresolverfactoryactivator override resource resolver resourceresolver get administrative resource resolver getadministrativeresourceresolver map string object authentication info authenticationinfo login exception loginexception resolve rs resolvers resource provider tracker resourceprovidertracker path based resource resolver impl pathbasedresourceresolverimpl common resource resolver factory impl commonresourceresolverfactoryimpl factory resource provider tracker resourceprovidertracker resource provider tracker resourceprovidertracker login exception loginexception factory resource provider tracker resourceprovidertracker get resource provider storage getresourceproviderstorage resource add resource resources get path getpath override string get search path getsearchpath string override resource get resource getresource string path string path starts with startswith path path resources synthetic resource with supertype syntheticresourcewithsupertype synthetic resource syntheticresource string resource super type resourcesupertype synthetic resource with supertype syntheticresourcewithsupertype resource resolver resourceresolver resource resolver resourceresolver string path string resource type resourcetype string resource super type resourcesupertype resource resolver resourceresolver path resource type resourcetype resource super type resourcesupertype resource super type resourcesupertype override string get resource super type getresourcesupertype resource super type resourcesupertype