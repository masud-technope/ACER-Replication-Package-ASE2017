licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling distribution trigger impl javax annotation nonnull javax jcr repository exception repositoryexception javax jcr session javax jcr observation event javax jcr observation event iterator eventiterator javax jcr observation event listener eventlistener java util array list arraylist java util arrays java util list java util map java util java util tree set treeset java util concurrent concurrent hash map concurrenthashmap org apache sling api resource login exception loginexception org apache sling api resource resource resolver resourceresolver org apache sling api resource resource resolver factory resourceresolverfactory org apache sling commons scheduler scheduler org apache sling distribution distribution request distributionrequest org apache sling distribution distribution request type distributionrequesttype org apache sling distribution simple distribution request simpledistributionrequest org apache sling distribution common distribution exception distributionexception org apache sling distribution trigger distribution request handler distributionrequesthandler org apache sling distribution trigger distribution trigger distributiontrigger org apache sling distribution util distribution jcr utils distributionjcrutils org apache sling distribution util impl distribution utils distributionutils org apache sling jcr api sling repository slingrepository org slf logger org slf logger factory loggerfactory implementation link org apache sling distribution trigger distribution trigger distributiontrigger list ens listens safe events triggers link org apache sling distribution distribution request distributionrequest abstract jcr event trigger abstractjcreventtrigger distribution trigger distributiontrigger logger log logger factory loggerfactory get logger getlogger get class getclass map string jcr event distribution trigger listener jcreventdistributiontriggerlistener registered listeners registeredlisteners concurrent hash map concurrenthashmap string jcr event distribution trigger listener jcreventdistributiontriggerlistener string path string service user serviceuser sling repository slingrepository repository resource resolver factory resourceresolverfactory resolver factory resolverfactory session cached session cachedsession scheduler scheduler abstract jcr event trigger abstractjcreventtrigger sling repository slingrepository repository scheduler scheduler resource resolver factory resourceresolverfactory resolver factory resolverfactory string path string service user serviceuser resolver factory resolverfactory resolver factory resolverfactory path service user serviceuser illegal argument exception illegalargumentexception path service required repository repository path path service user serviceuser service user serviceuser scheduler scheduler register nonnull distribution request handler distributionrequesthandler request handler requesthandler distribution exception distributionexception session session session get session getsession jcr event distribution trigger listener jcreventdistributiontriggerlistener listener jcr event distribution trigger listener jcreventdistributiontriggerlistener request handler requesthandler registered listeners registeredlisteners request handler requesthandler to string tostring listener session get workspace getworkspace get observation manager getobservationmanager add event listener addeventlistener listener get event types geteventtypes path repository exception repositoryexception distribution exception distributionexception unable register handler request handler requesthandler unregister nonnull distribution request handler distributionrequesthandler request handler requesthandler distribution exception distributionexception jcr event distribution trigger listener jcreventdistributiontriggerlistener listener registered listeners registeredlisteners request handler requesthandler to string tostring listener session session session get session getsession session get workspace getworkspace get observation manager getobservationmanager remove event listener removeeventlistener listener repository exception repositoryexception distribution exception distributionexception unable unregister handler request handler requesthandler jcr event distribution trigger listener jcreventdistributiontriggerlistener event listener eventlistener distribution request handler distributionrequesthandler request handler requesthandler jcr event distribution trigger listener jcreventdistributiontriggerlistener distribution request handler distributionrequesthandler request handler requesthandler request handler requesthandler request handler requesthandler on event onevent event iterator eventiterator event iterator eventiterator log info jcr trigger one vent onevent list distribution request distributionrequest request list requestlist array list arraylist distribution request distributionrequest event iterator eventiterator has next hasnext event event event iterator eventiterator next event nextevent log info handling event event distribution jcr utils distributionjcrutils is safe issafe event distribution request distributionrequest request process event processevent event request add to list addtolist request request list requestlist log info skip unsafe event event repository exception repositoryexception log error error handling event event request list requestlist size scheduled scheduler schedule distribution executor distributionexecutor request list requestlist request handler requesthandler scheduler log info scheduled distributions scheduled request list requestlist size add to list addtolist distribution request distributionrequest request list distribution request distributionrequest request list requestlist distribution request distributionrequest last request lastrequest request list requestlist is empty isempty request list requestlist request list requestlist size last request lastrequest last request lastrequest get request type getrequesttype equals request get request type getrequesttype request list requestlist add request has deep paths hasdeeppaths request has deep paths hasdeeppaths last request lastrequest request list requestlist add request string all paths allpaths tree set treeset string all paths allpaths add all addall arrays as list aslist last request lastrequest get paths getpaths all paths allpaths add all addall arrays as list aslist request get paths getpaths last request lastrequest simple distribution request simpledistributionrequest last request lastrequest get request type getrequesttype all paths allpaths to array toarray string all paths allpaths size request list requestlist request list requestlist size last request lastrequest enable disable jcr event distribution trigger listener jcreventdistributiontriggerlistener listener registered listeners registeredlisteners values session session session get session getsession session get workspace getworkspace get observation manager getobservationmanager remove event listener removeeventlistener listener repository exception repositoryexception log error unable unregister handler listener registered listeners registeredlisteners clear cached session cachedsession cached session cachedsession log out logout cached session cachedsession process received event generates distribution request param event link javax jcr observation event processed link org apache sling distribution distribution request distributionrequest originated processing event code code request generated repository exception repositoryexception distribution request distributionrequest process event processevent event event repository exception repositoryexception binary event types handled jcr event listener code code generated code event node event node removed code get event types geteventtypes event node event node removed event property changed event property event property removed newly init iated initiated jcr session register link javax jcr observation event listener eventlistener link javax jcr session repository exception repositoryexception session get session getsession repository exception repositoryexception cached session cachedsession cached session cachedsession cached session cachedsession repository login service loginservice service user serviceuser string get node path from event getnodepathfromevent event event repository exception repositoryexception string event path eventpath event get path getpath type event get type gettype event path eventpath event property removed type event property changed type event property type event path eventpath event path eventpath substring event path eventpath last index of lastindexof event path eventpath has deep paths hasdeeppaths distribution request distributionrequest distribution request distributionrequest distribution request type distributionrequesttype add equals distribution request distributionrequest get request type getrequesttype string path distribution request distributionrequest get paths getpaths distribution request distributionrequest is deep isdeep path distribution executor distributionexecutor runnable list distribution request distributionrequest request list requestlist distribution request handler distributionrequesthandler request handler requesthandler distribution executor distributionexecutor list distribution request distributionrequest request list requestlist distribution request handler distributionrequesthandler request handler requesthandler request list requestlist request list requestlist request handler requesthandler request handler requesthandler distribution request distributionrequest request request list requestlist service user serviceuser request handler requesthandler handle request resource resolver resourceresolver resource resolver resourceresolver resource resolver resourceresolver distribution utils distributionutils login service loginservice resolver factory resolverfactory service user serviceuser request handler requesthandler handle resource resolver resourceresolver request login exception loginexception log error resource resolver service user serviceuser distribution utils distributionutils safely log out safelylogout resource resolver resourceresolver