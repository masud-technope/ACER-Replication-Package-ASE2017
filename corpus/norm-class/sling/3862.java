licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling launchpad webapp int egrationtest integrationtest java io exception ioexception java input stream inputstream java net url java util array list arraylist java util list javax servlet http http servlet response httpservletresponse org apache commons http client httpclient credentials org apache commons http client httpclient header org apache commons http client httpclient http exception httpexception org apache commons http client httpclient name value pair namevaluepair org apache commons http client httpclient username password credentials usernamepasswordcredentials org apache commons http client httpclient auth scope authscope org apache commons http client httpclient methods get method getmethod org apache commons http client httpclient methods post method postmethod org apache sling commons testing int egration integration http test httptest utility tests authentication authenticated test util authenticatedtestutil http test httptest execute post request check status assert authenticated admin post status assertauthenticatedadminpoststatus string url expected status code expectedstatuscode list name value pair namevaluepair post params postparams string assert message assertmessage io exception ioexception credentials default creds defaultcreds username password credentials usernamepasswordcredentials admin admin assert authenticated post status assertauthenticatedpoststatus default creds defaultcreds url expected status code expectedstatuscode post params postparams assert message assertmessage execute post request check status assert authenticated post status assertauthenticatedpoststatus credentials creds string url expected status code expectedstatuscode list name value pair namevaluepair post params postparams string assert message assertmessage io exception ioexception post method postmethod post post method postmethod url post set follow redirects setfollowredirects url base url baseurl url http base url auth scope authscope auth scope authscope auth scope authscope base url baseurl get host gethost base url baseurl get port getport auth scope authscope realm post set do authentication setdoauthentication credentials old credentials oldcredentials http client httpclient get state getstate get credentials getcredentials auth scope authscope http client httpclient get state getstate set credentials setcredentials auth scope authscope creds post params postparams name value pair namevaluepair nvp post set request body setrequestbody post params postparams to array toarray nvp status http client httpclient execute method executemethod post assert message assertmessage assert equals assertequals expected status code expectedstatuscode status assert equals assertequals assert message assertmessage expected status code expectedstatuscode status http client httpclient get state getstate set credentials setcredentials auth scope authscope old credentials oldcredentials verify url returns expected status code expectedstatuscode io exception ioexception assert authenticated http status assertauthenticatedhttpstatus credentials creds string url string urlstring expected status code expectedstatuscode string assert message assertmessage io exception ioexception url base url baseurl url http base url auth scope authscope auth scope authscope auth scope authscope base url baseurl get host gethost base url baseurl get port getport auth scope authscope realm get method getmethod get method getmethod get method getmethod url string urlstring get method getmethod set do authentication setdoauthentication credentials old credentials oldcredentials http client httpclient get state getstate get credentials getcredentials auth scope authscope http client httpclient get state getstate set credentials setcredentials auth scope authscope creds status http client httpclient execute method executemethod get method getmethod assert message assertmessage assert equals assertequals url string urlstring expected status code expectedstatuscode status assert equals assertequals assert message assertmessage expected status code expectedstatuscode status http client httpclient get state getstate set credentials setcredentials auth scope authscope old credentials oldcredentials retrieve contents url content type param expected content type expectedcontenttype content type dontcare checked io exception ioexception http exception httpexception string get authenticated content getauthenticatedcontent credentials creds string url string expected content type expectedcontenttype list name value pair namevaluepair params expected status code expectedstatuscode io exception ioexception get method getmethod get method getmethod url url base url baseurl url http base url auth scope authscope auth scope authscope auth scope authscope base url baseurl get host gethost base url baseurl get port getport auth scope authscope realm set do authentication setdoauthentication credentials old credentials oldcredentials http client httpclient get state getstate get credentials getcredentials auth scope authscope http client httpclient get state getstate set credentials setcredentials auth scope authscope creds params name value pair namevaluepair nvp name value pair namevaluepair set query string setquerystring params to array toarray nvp status http client httpclient execute method executemethod input stream inputstream get response body as stream getresponsebodyasstream string buffer stringbuffer content string buffer stringbuffer string charset get response char set getresponsecharset buffer read buffer buffer length content append string buffer charset assert equals assertequals expected status expected status code expectedstatuscode url content content expected status code expectedstatuscode status header get response header getresponseheader content type expected content type expectedcontenttype fail expected content type get value getvalue content type dontcare equals expected content type expectedcontenttype check fail expected content type starts expected content type expectedcontenttype content type header url assert true asserttrue expected content type starts expected content type expectedcontenttype url get value getvalue get value getvalue starts with startswith expected content type expectedcontenttype content to string tostring http client httpclient get state getstate set credentials setcredentials auth scope authscope old credentials oldcredentials retrieve contents url content type param expected content type expectedcontenttype content type dontcare checked io exception ioexception http exception httpexception string get authenticated post content getauthenticatedpostcontent credentials creds string url string expected content type expectedcontenttype list name value pair namevaluepair post params postparams expected status code expectedstatuscode io exception ioexception post method postmethod post post method postmethod url url base url baseurl url http base url auth scope authscope auth scope authscope auth scope authscope base url baseurl get host gethost base url baseurl get port getport auth scope authscope realm post set do authentication setdoauthentication credentials old credentials oldcredentials http client httpclient get state getstate get credentials getcredentials auth scope authscope http client httpclient get state getstate set credentials setcredentials auth scope authscope creds post params postparams name value pair namevaluepair nvp post set request body setrequestbody post params postparams to array toarray nvp status http client httpclient execute method executemethod post input stream inputstream post get response body as stream getresponsebodyasstream string buffer stringbuffer content string buffer stringbuffer string charset post get response char set getresponsecharset buffer read buffer buffer length content append string buffer charset assert equals assertequals expected status expected status code expectedstatuscode url content content expected status code expectedstatuscode status header post get response header getresponseheader content type expected content type expectedcontenttype fail expected content type get value getvalue content type dontcare equals expected content type expectedcontenttype check fail expected content type starts expected content type expectedcontenttype content type header url assert true asserttrue expected content type starts expected content type expectedcontenttype url get value getvalue get value getvalue starts with startswith expected content type expectedcontenttype content to string tostring http client httpclient get state getstate set credentials setcredentials auth scope authscope old credentials oldcredentials random id randomid system current time millis currenttimemillis get next int getnextint val random id randomid random id randomid val string create test user createtestuser io exception ioexception string post url posturl http base url system user manager usermanager user create html string test user id testuserid test user testuser get next int getnextint list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair test user id testuserid post params postparams add name value pair namevaluepair pwd test pwd testpwd post params postparams add name value pair namevaluepair pwd confirm pwdconfirm test pwd testpwd credentials creds username password credentials usernamepasswordcredentials admin admin string msg unexpected status attempting create test user post url posturl assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams msg string session info url sessioninfourl http base url system sling info session info sessioninfo json assert authenticated http status assertauthenticatedhttpstatus creds session info url sessioninfourl http servlet response httpservletresponse session info failed user test user id testuserid test user id testuserid string create test group createtestgroup io exception ioexception string post url posturl http base url system user manager usermanager group create html string test group id testgroupid test group testgroup get next int getnextint list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair test group id testgroupid success redirect webapp assert authenticated admin post status assertauthenticatedadminpoststatus post url posturl http servlet response httpservletresponse post params postparams test group id testgroupid