licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling testing tools sling org junit fail java file java util array list arraylist java util collections java util linked list linkedlist java util list java util properties java util tree set treeset org apache http client http client httpclient org apache http impl client default http client defaulthttpclient org apache sling testing tools http request builder requestbuilder org apache sling testing tools http request executor requestexecutor org apache sling testing tools jar exec jarexec jar executor jarexecutor org apache sling testing tools junit test description interceptor testdescriptioninterceptor org apache sling testing tools osgi web console client webconsoleclient org junit org junit run ners runners parent runner parentrunner org slf logger org slf logger factory loggerfactory base running tests sling instance takes care starting sling waiting ready sling test base slingtestbase sling instance slinginstance string test server url prop test server url string test server use rname username test server username string test server password test server password string server ready timeout prop server ready timeout seconds string server ready prop prefix server ready path string jar running prop keep jar running keepjarrunning string server hostname prop test server host name hostname string additonal bundles path additional bundles path string additonal bundles uninstall additional bundles uninstall string bundle install prefix sling additional bundle string start bundles timeout seconds start bundles timeout seconds string bundle install timeout seconds bundle install timeout seconds string admin admin keep jar running keepjarrunning uninstall additional bundles uninstalladditionalbundles string server username serverusername string server password serverpassword sling instance state slinginstancestate sling test state slingteststate properties system properties systemproperties request builder requestbuilder builder default http client defaulthttpclient http client httpclient default http client defaulthttpclient request executor requestexecutor executor request executor requestexecutor http client httpclient web console client webconsoleclient webconsole client webconsoleclient bundles installer bundlesinstaller bundles installer bundlesinstaller server started by this class serverstartedbythisclass logger log logger factory loggerfactory get logger getlogger get class getclass sling test base slingtestbase sling instance state slinginstancestate get instance getinstance sling instance state slinginstancestate instance system get properties getproperties configuration start server demand sling test base slingtestbase sling instance state slinginstancestate sling test state slingteststate properties system properties systemproperties sling test state slingteststate sling test state slingteststate system properties systemproperties system properties systemproperties keep jar running keepjarrunning equals system properties systemproperties get property getproperty jar running prop http client httpclient add request interceptor addrequestinterceptor test description interceptor testdescriptioninterceptor string configured url configuredurl system properties systemproperties get property getproperty test server url prop system properties systemproperties get property getproperty launchpad http server url configured url configuredurl configured url configuredurl trim length sling test state slingteststate set server base url setserverbaseurl configured url configuredurl sling test state slingteststate set server started setserverstarted uninstall additional bundles uninstalladditionalbundles equals system properties systemproperties get property getproperty additonal bundles uninstall sling test state slingteststate sling test state slingteststate get jar executor getjarexecutor sling test state slingteststate set jar executor setjarexecutor jar executor jarexecutor system properties systemproperties exception log error jar executor jarexecutor setup failed fail jar executor jarexecutor setup failed string server host serverhost system properties systemproperties get property getproperty server hostname prop server host serverhost server host serverhost trim length server host serverhost localhost sling test state slingteststate set server base url setserverbaseurl http server host serverhost sling test state slingteststate get jar executor getjarexecutor get server port getserverport undeploy additional bundles server pro vis ioned provisioned uninstall additional bundles uninstalladditionalbundles configured username admin credential string configured username configuredusername system properties systemproperties get property getproperty test server use rname username configured username configuredusername configured username configuredusername trim length server username serverusername configured username configuredusername server username serverusername admin configured password admin credential string configured password configuredpassword system properties systemproperties get property getproperty test server password configured password configuredpassword configured password configuredpassword trim length server password serverpassword configured password configuredpassword server password serverpassword admin builder request builder requestbuilder sling test state slingteststate get server base url getserverbaseurl webconsole client webconsoleclient web console client webconsoleclient sling test state slingteststate get server base url getserverbaseurl server username serverusername server password serverpassword builder request builder requestbuilder sling test state slingteststate get server base url getserverbaseurl bundles installer bundlesinstaller bundles installer bundlesinstaller webconsole client webconsoleclient sling test state slingteststate is server info log ged isserverinfologged log info server base url sling test state slingteststate get server base url getserverbaseurl sling test state slingteststate set server info log ged setserverinfologged auto matically automatically link sling remote test runner slingremotetestrunner version uninstall additional bundles if necessary uninstalladditionalbundlesifnecessary uninstall additional bundles uninstalladditionalbundles log info uninstalling additional bundles uninstall additional bundles uninstalladditionalbundles start server start server if needed startserverifneeded sling test state slingteststate is server started isserverstarted server started by this class serverstartedbythisclass sling test state slingteststate is startup info provided isstartupinfoprovided log info test server url prop starting server jar sling test state slingteststate get server base url getserverbaseurl sling test state slingteststate is server started isserverstarted sling test state slingteststate sling test state slingteststate is server started isserverstarted sling test state slingteststate get jar executor getjarexecutor start server started by this class serverstartedbythisclass sling test state slingteststate set server started setserverstarted fail server started sling test state slingteststate get server base url getserverbaseurl sling test state slingteststate set startup info provided setstartupinfoprovided wait for server ready waitforserverready install additional bundles installadditionalbundles block if requested blockifrequested exception log error exception may be start server maybestartserver fail may be start server maybestartserver failed install additional bundles installadditionalbundles sling test state slingteststate is install bundles failed isinstallbundlesfailed fail bundles installed tests sling test state slingteststate is extra bundles installed isextrabundlesinstalled list file to install toinstall get bundles to install getbundlestoinstall to install toinstall is empty isempty install bundles check installed start bundles installer bundlesinstaller install bundles installbundles to install toinstall list string symbolic names symbolicnames linked list linkedlist string file to install toinstall symbolic names symbolicnames add bundles installer bundlesinstaller get bundle symbolic name getbundlesymbolicname bundles installer bundlesinstaller wait for bundles installed waitforbundlesinstalled symbolic names symbolicnames time outs provider timeoutsprovider get instance getinstance get timeout gettimeout bundle install timeout seconds bundles installer bundlesinstaller start all bundles startallbundles symbolic names symbolicnames time outs provider timeoutsprovider get instance getinstance get timeout gettimeout start bundles timeout seconds assertion error assertionerror log info exception installing additional bundles sling test state slingteststate set install bundles failed setinstallbundlesfailed exception log info exception installing additional bundles sling test state slingteststate set install bundles failed setinstallbundlesfailed sling test state slingteststate is install bundles failed isinstallbundlesfailed fail start installed bundles to install toinstall log info installing additional bundles system property additonal bundles path sling test state slingteststate set extra bundles installed setextrabundlesinstalled sling test state slingteststate is install bundles failed isinstallbundlesfailed uninstall additional bundles uninstalladditionalbundles uninstall independent installation status bundles installer bundlesinstaller uninstall bundles uninstallbundles get bundles to install getbundlestoinstall exception log info exception uninstalling additional bundles start server needed request builder requestbuilder points request builder requestbuilder get request builder getrequestbuilder start server if needed startserverifneeded builder start server needed base url string get server base url getserverbaseurl start server if needed startserverifneeded sling test state slingteststate get server base url getserverbaseurl username configured execution http requests string get server username getserverusername server username serverusername password configured execution http requests string get server password getserverpassword server password serverpassword option ally optionally block runnable jar stays tests block if requested blockifrequested keep jar running keepjarrunning log info jar running prop entering infinite loop runnable jar stays kill process exit sling test state slingteststate sling test state slingteststate wait interrupted exception interruptedexception iex log info interrupted exception interruptedexception block if requested blockifrequested check number server url s urls read yness readyness wait for server ready waitforserverready exception sling test state slingteststate is server ready isserverready sling test state slingteststate is server ready test failed isserverreadytestfailed fail server ready previous tests timeout read iness readiness test string system properties systemproperties get property getproperty server ready timeout prop timeout sec timeoutsec time outs provider timeoutsprovider get instance getinstance get timeout gettimeout integer value of valueof log info wait timeout sec timeoutsec seconds server ready end time endtime system current time millis currenttimemillis timeout sec timeoutsec list paths test expected content regex ps regexps list string test paths testpaths array list arraylist string tree set treeset object property names propertynames tree set treeset object property names propertynames add all addall system properties systemproperties key set keyset object property names propertynames string key string key starts with startswith server ready prop prefix test paths testpaths add system properties systemproperties get property getproperty key server ready resp onds responds configured request paths result content pattern option ally optionally supplied path separated colon log info checking requests expected content timeout seconds timeout sec timeoutsec test paths testpaths system current time millis currenttimemillis end time endtime errors string test paths testpaths string split string path string pattern length executor execute builder build get request buildgetrequest path with credentials withcredentials server username serverusername server password serverpassword assert status assertstatus assert content contains assertcontentcontains pattern assertion error assertionerror errors log debug request failed retry object server username serverusername sling test state slingteststate get server base url getserverbaseurl path exception errors log debug request failed retry object server username serverusername sling test state slingteststate get server base url getserverbaseurl path pattern errors sling test state slingteststate set server ready setserverready log info paths expected content server ready test paths testpaths size thread sleep time outs provider timeoutsprovider get instance getinstance get timeout gettimeout sling test state slingteststate is server ready isserverready sling test state slingteststate set server ready test failed setserverreadytestfailed string msg server ready timeout sec timeoutsec seconds log info msg fail msg list additional bundles install system property link additonal bundles path list link file pointing bundle jar s jars empty list additional bundles installed code list file get bundles to install getbundlestoinstall string paths system properties systemproperties get property getproperty additonal bundles path paths collections empty list emptylist list file to install toinstall array list arraylist file paths comma separated list string all paths allpaths paths split string path all paths allpaths to install toinstall add all addall get bundles to install getbundlestoinstall path trim to install toinstall list additional bundles install additional bundles path additionalbundlespath parameter list file get bundles to install getbundlestoinstall string additional bundles path additionalbundlespath list file result linked list linkedlist file additional bundles path additionalbundlespath result file dir file additional bundles path additionalbundlespath dir is directory isdirectory dir can read canread log info read additional bundles directory dir get absolute path getabsolutepath result collect file names filenames candidate bundles list string bundle names bundlenames array list arraylist string string files dir list files string file files file ends with endswith jar bundle names bundlenames add file install system properties order list string sorted property keys sortedpropertykeys array list arraylist string object key system properties systemproperties key set keyset string str key to string tostring str starts with startswith bundle install prefix sorted property keys sortedpropertykeys add str collections sort sorted property keys sortedpropertykeys string key sorted property keys sortedpropertykeys string filename prefix filenameprefix system properties systemproperties get property getproperty key string bundle file name bundlefilename bundle names bundlenames bundle file name bundlefilename starts with startswith filename prefix filenameprefix result add file dir bundle file name bundlefilename result is server started by this class isserverstartedbythisclass server started by this class serverstartedbythisclass http client httpclient get http client gethttpclient http client httpclient request executor requestexecutor get request executor getrequestexecutor executor web console client webconsoleclient get web console client getwebconsoleclient start server if needed startserverifneeded webconsole client webconsoleclient