licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling mail archive mailarchive stats impl java io exception ioexception java print writer printwriter java util java util sorted set sortedset java util tree set treeset javax servlet servlet exception servletexception org apache felix scr annotations sling sling servlet slingservlet org apache sling api sling http servlet request slinghttpservletrequest org apache sling api sling http servlet response slinghttpservletresponse org apache sling api resource resource org apache sling api resource value map valuemap org apache sling api servlets sling safe methods servlet slingsafemethodsservlet org apache sling commons json json exception jsonexception org apache sling commons json json writer jsonwriter suppress warnings suppresswarnings serial sling servlet slingservlet resource types resourcetypes mail server mailserver stats destination methods extensions json selectors stats data statsdata stats data servlet statsdataservlet generates json data destination esp script produces output pre stats data statsdata period send ers senders net env iron netenviron builds apache org period send ers senders yahoo net env iron netenviron builds apache org layers yahoo net env iron netenviron builds apache org pre sling safe methods servlet slingsafemethodsservlet override do get doget sling http servlet request slinghttpservletrequest request sling http servlet response slinghttpservletresponse response servlet exception servletexception io exception ioexception response set character encoding setcharacterencoding utf print writer printwriter response get writer getwriter write data get class getclass get name getname sorted set sortedset string layers tree set treeset string visit child resources build stats data statsdata object stats data resource type json writer jsonwriter json writer jsonwriter response get writer getwriter set tidy settidy write stats data statsdata array dump stats data dumpstatsdata request get resource getresource layers end array endarray flush write output layers array json json writer jsonwriter json writer jsonwriter response get writer getwriter set tidy settidy write layers array string layer layers layer end array endarray write json exception jsonexception servlet exception servletexception json exception jsonexception do get doget dump stats data stats data resource recurse children dump stats data dumpstatsdata resource json writer jsonwriter string layers json exception jsonexception mail stats processor impl mailstatsprocessorimpl data resource type equals get resource type getresourcetype value map valuemap adapt to adaptto value map valuemap object key period mail stats processor impl mailstatsprocessorimpl period prop period key send ers senders object string key key set keyset key starts with startswith mail stats processor impl mailstatsprocessorimpl source prop prefix string source key substring mail stats processor impl mailstatsprocessorimpl source prop prefix length layers add source key source key end object endobject end object endobject resource child get children getchildren dump stats data dumpstatsdata child layers