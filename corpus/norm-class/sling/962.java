licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling jcr jackrabbit access manager accessmanager post java io exception ioexception java security principal java util array list arraylist java util arrays java util hash map hashmap java util hash set hashset java util linked hash map linkedhashmap java util linked hash set linkedhashset java util list java util map java util map entry java util javax jcr access denied exception accessdeniedexception javax jcr item javax jcr repository exception repositoryexception javax jcr session javax jcr security access control entry accesscontrolentry javax jcr security access control manager accesscontrolmanager javax jcr security privilege javax servlet servlet exception servletexception javax servlet http http servlet response httpservletresponse org apache sling api sling http servlet request slinghttpservletrequest org apache sling api sling http servlet response slinghttpservletresponse org apache sling api resource resource not found exception resourcenotfoundexception org apache sling api servlets sling all methods servlet slingallmethodsservlet org apache sling commons json json exception jsonexception org apache sling commons json json object jsonobject org apache sling jcr base util access control util accesscontrolutil org slf logger org slf logger factory loggerfactory suppress warnings suppresswarnings serial abstract get acl servlet abstractgetaclservlet sling all methods servlet slingallmethodsservlet log logger log logger factory loggerfactory get logger getlogger get class getclass javadoc org apache sling api servlets sling safe methods servlet slingsafemethodsservlet do get doget org apache sling api sling http servlet request slinghttpservletrequest org apache sling api sling http servlet response slinghttpservletresponse override do get doget sling http servlet request slinghttpservletrequest request sling http servlet response slinghttpservletresponse response servlet exception servletexception io exception ioexception session session request get resource resolver getresourceresolver adapt to adaptto session string resource path resourcepath request get resource getresource get path getpath json object jsonobject acl internal get acl internalgetacl session resource path resourcepath response set content type setcontenttype application json response set character encoding setcharacterencoding utf is tidy istidy string selectors request get request path info getrequestpathinfo get selectors getselectors selectors selectors length string level selectors tidy equals level is tidy istidy is tidy istidy response get writer getwriter append acl to string tostring acl write response get writer getwriter access denied exception accessdeniedexception ade response send error senderror http servlet response httpservletresponse resource not found exception resourcenotfoundexception rnfe response send error senderror http servlet response httpservletresponse rnfe get message getmessage throwable throwable log debug exception handling request get resource getresource get path getpath get class getclass get name getname throwable servlet exception servletexception throwable suppress warnings suppresswarnings unchecked json object jsonobject internal get acl internalgetacl session jcr session jcrsession string resource path resourcepath repository exception repositoryexception json exception jsonexception jcr session jcrsession repository exception repositoryexception jcr session item item jcr session jcrsession get item getitem resource path resourcepath item resource path resourcepath item get path getpath resource not found exception resourcenotfoundexception resource jcr node calculate map privileges aggregate privileges contained fast lookup merge privilege sets mergeprivilegesets calls access control manager accesscontrolmanager access control manager accesscontrolmanager access control util accesscontrolutil get access control manager getaccesscontrolmanager jcr session jcrsession map privilege privilege privilege to ancestor map privilegetoancestormap hash map hashmap privilege privilege privilege supported privileges supportedprivileges access control manager accesscontrolmanager get supported privileges getsupportedprivileges item get path getpath privilege privilege supported privileges supportedprivileges privilege is aggregate isaggregate privilege privilege get aggregate privileges getaggregateprivileges privilege privilege privilege privilege to ancestor map privilegetoancestormap privilege hash set hashset privilege privilege to ancestor map privilegetoancestormap privilege add privilege access control entry accesscontrolentry declared access control entries declaredaccesscontrolentries get access control entries getaccesscontrolentries jcr session jcrsession resource path resourcepath map string map string object acl map aclmap linked hash map linkedhashmap string map string object sequence access control entry accesscontrolentry ace declared access control entries declaredaccesscontrolentries principal principal ace get principal getprincipal map string object map acl map aclmap principal get name getname map map linked hash map linkedhashmap string object acl map aclmap principal get name getname map map order sequence evaluate reverse order entries highest spec ificity specificity declared access control entries declaredaccesscontrolentries length access control entry accesscontrolentry ace declared access control entries declaredaccesscontrolentries principal principal ace get principal getprincipal map string object map acl map aclmap principal get name getname privilege granted set grantedset privilege map granted granted set grantedset granted set grantedset linked hash set linkedhashset privilege map granted granted set grantedset privilege denied set deniedset privilege map denied denied set deniedset denied set deniedset linked hash set linkedhashset privilege map denied denied set deniedset access control util accesscontrolutil is allow isallow ace privilege privileges ace get privileges getprivileges privilege privilege privileges merge privilege sets mergeprivilegesets privilege privilege to ancestor map privilegetoancestormap granted set grantedset denied set deniedset privilege privileges ace get privileges getprivileges privilege privilege privileges merge privilege sets mergeprivilegesets privilege privilege to ancestor map privilegetoancestormap denied set deniedset granted set grantedset list json object jsonobject acl list acllist array list arraylist json object jsonobject entry string map string object entry set entryset acl map aclmap entry set entryset entry string map string object entry entry set entryset string principal name principalname entry get key getkey map string object entry get value getvalue json object jsonobject ace object aceobject json object jsonobject ace object aceobject principal principal name principalname string granted set grantedset string granted granted set grantedset granted set grantedset is empty isempty ace object aceobject granted granted set grantedset string denied set deniedset string denied denied set deniedset denied set deniedset is empty isempty ace object aceobject denied denied set deniedset ace object aceobject order order acl list acllist add ace object aceobject json object jsonobject json acl map jsonaclmap json object jsonobject acl map aclmap json object jsonobject json obj jsonobj acl list acllist json acl map jsonaclmap json obj jsonobj get string getstring principal json obj jsonobj json acl map jsonaclmap update granted denied privilege sets merging result adding supplied privilege merge privilege sets mergeprivilegesets privilege privilege map privilege privilege privilege to ancestor map privilegetoancestormap privilege first set firstset privilege second set secondset remove duplicates invalid privileges list privilege is aggregate isaggregate privilege aggregate privileges aggregateprivileges privilege get aggregate privileges getaggregateprivileges remove duplicates granted list privilege as list aslist arrays as list aslist aggregate privileges aggregateprivileges first set firstset remove all removeall as list aslist remove denied second set secondset remove all removeall as list aslist second set secondset remove privilege check privilege contained granted privilege is already granted isalreadygranted privilege ancestor set ancestorset privilege to ancestor map privilegetoancestormap privilege ancestor set ancestorset privilege privilege ancestor set ancestorset first set firstset privilege is already granted isalreadygranted add privilege is already granted isalreadygranted first set firstset add privilege deal exp anding expanding existing aggregate privileges remove invalid items add valid privilege filter set filterset privilege to ancestor map privilegetoancestormap privilege filter set filterset pack denied comp ensate compensate privilege privilege filter set filterset second set secondset privilege second set secondset remove privilege privilege is aggregate isaggregate filter and merge privileges from aggregate filterandmergeprivilegesfromaggregate privilege first set firstset second set secondset filter set filterset privilege add declared aggregate privileges supplied privilege second set secondset privilege first set firstset contained supplied filter set filterset filter and merge privileges from aggregate filterandmergeprivilegesfromaggregate privilege privilege privilege first set firstset privilege second set secondset privilege filter set filterset privilege ignore privilege ignoreprivilege privilege declared aggregate privileges declaredaggregateprivileges privilege get declared aggregate privileges getdeclaredaggregateprivileges privilege privilege declared aggregate privileges declaredaggregateprivileges ignore privilege ignoreprivilege equals privilege skip first set firstset privilege filter set filterset privilege second set secondset add privilege privilege is aggregate isaggregate privilege declared aggregate privileges declaredaggregateprivileges privilege get declared aggregate privileges getdeclaredaggregateprivileges privilege privilege declared aggregate privileges declaredaggregateprivileges ignore privilege ignoreprivilege equals privilege privilege is aggregate isaggregate filter and merge privileges from aggregate filterandmergeprivilegesfromaggregate privilege first set firstset second set secondset filter set filterset ignore privilege ignoreprivilege access control entry accesscontrolentry get access control entries getaccesscontrolentries session session string abs path abspath repository exception repositoryexception