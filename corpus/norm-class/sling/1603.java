licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling distribution transport impl javax annotation nonnull java input stream inputstream java net uri java util array list arraylist java util arrays java util hash map hashmap java util list java util map org apache commons i o utils ioutils org apache http http host httphost org apache http client fluent content org apache http client fluent executor org apache http client fluent request org apache http client fluent response org apache http conn http host connect exception httphostconnectexception org apache http entity content type contenttype org apache sling api resource resource resolver resourceresolver org apache sling distribution distribution request distributionrequest org apache sling distribution distribution request type distributionrequesttype org apache sling distribution common distribution exception distributionexception org apache sling distribution log impl default distribution log defaultdistributionlog org apache sling distribution serialization distribution package distributionpackage org apache sling distribution serialization distribution package builder distributionpackagebuilder org apache sling distribution transport distribution transport secret distributiontransportsecret org apache sling distribution transport distribution transport secret provider distributiontransportsecretprovider org apache sling distribution transport core distribution transport distributiontransport org apache sling distribution util request utils requestutils http implementation link distribution transport distributiontransport simple http distribution transport simplehttpdistributiontransport distribution transport distributiontransport string use rname username username string password password distribution origin uri string info property origin uri internal origin uri default distribution log defaultdistributionlog log distribution endpoint distributionendpoint distribution endpoint distributionendpoint distribution package builder distributionpackagebuilder package builder packagebuilder distribution transport secret provider distributiontransportsecretprovider secret provider secretprovider max pull items maxpullitems simple http distribution transport simplehttpdistributiontransport default distribution log defaultdistributionlog log distribution endpoint distributionendpoint distribution endpoint distributionendpoint distribution package builder distributionpackagebuilder package builder packagebuilder distribution transport secret provider distributiontransportsecretprovider secret provider secretprovider max pull items maxpullitems log log distribution endpoint distributionendpoint distribution endpoint distributionendpoint package builder packagebuilder package builder packagebuilder secret provider secretprovider secret provider secretprovider max pull items maxpullitems max pull items maxpullitems deliver package deliverpackage nonnull resource resolver resourceresolver resource resolver resourceresolver nonnull distribution package distributionpackage distribution package distributionpackage distribution exception distributionexception string host and port hostandport get host and port gethostandport distribution endpoint distributionendpoint get uri geturi uri package origin packageorigin distribution package distributionpackage get info getinfo info property origin uri uri package origin packageorigin host and port hostandport equals get host and port gethostandport package origin packageorigin log debug skip ping skipping distribution â to origin distribution package distributionpackage get id getid host and port hostandport executor executor executor new instance newinstance distribution transport secret distributiontransportsecret secret secret provider secretprovider get secret getsecret distribution endpoint distributionendpoint get uri geturi log debug delivering user distribution package distributionpackage get id getid distribution endpoint distributionendpoint get uri geturi secret as credentials map ascredentialsmap use rname username executor authenticate secret executor request req request post distribution endpoint distributionendpoint get uri geturi use expect continue useexpectcontinue input stream inputstream input stream inputstream response response input stream inputstream distribution package distributionpackage create input stream createinputstream req req body stream bodystream input stream inputstream content type contenttype application octet stream response executor execute req i o utils ioutils close quietly closequietly input stream inputstream content content response return content returncontent log debug delivered distribution package distributionpackage get id getid distribution endpoint distributionendpoint get uri geturi throwable distribution exception distributionexception nonnull list distribution package distributionpackage retrieve packages retrievepackages nonnull resource resolver resourceresolver resource resolver resourceresolver nonnull distribution request distributionrequest distribution request distributionrequest distribution exception distributionexception log debug pulling distribution endpoint distributionendpoint get uri geturi list distribution package distributionpackage result array list arraylist distribution package distributionpackage uri distributionuri request utils requestutils append distribution request appenddistributionrequest distribution endpoint distributionendpoint get uri geturi distribution request distributionrequest todo executor cached reused executor executor executor new instance newinstance distribution transport secret distributiontransportsecret secret secret provider secretprovider get secret getsecret distribution endpoint distributionendpoint get uri geturi executor authenticate secret executor request req request post distributionuri use expect continue useexpectcontinue todo add queue parameter cont inuously continuously requests str eams streams type header received response meaning type input stream inputstream input stream inputstream map string string headers hash map hashmap string string pulls max number of packages maxnumberofpackages distribution request type distributionrequesttype pull equals distribution request distributionrequest get request type getrequesttype max pull items maxpullitems pulls max number of packages maxnumberofpackages input stream inputstream http transport utils httptransportutils fetch next package fetchnextpackage executor distributionuri headers distribution package distributionpackage response package responsepackage package builder packagebuilder read package readpackage resource resolver resourceresolver input stream inputstream response package responsepackage response package responsepackage get info getinfo info property origin uri distributionuri log debug pulled info pulls response package responsepackage get info getinfo result add response package responsepackage string original id originalid headers http transport utils httptransportutils header distribution original http transport utils httptransportutils delete package deletepackage executor distributionuri original id originalid log warn response package responsepackage pulls http host connect exception httphostconnectexception log info connect skip ping skipping distribution endpoint distributionendpoint get uri geturi exception log error retrieve packages log info pulled order log result size log debug pulled packages result size distribution endpoint distributionendpoint get uri geturi log info pulled packages result size distribution endpoint distributionendpoint get uri geturi result executor authenticate distribution transport secret distributiontransportsecret secret executor executor map string string credentials map credentialsmap secret as credentials map ascredentialsmap credentials map credentialsmap executor executor http host httphost distribution endpoint distributionendpoint get uri geturi get host gethost distribution endpoint distributionendpoint get uri geturi get port getport credentials map credentialsmap use rname username credentials map credentialsmap password auth preemptive authpreemptive http host httphost distribution endpoint distributionendpoint get uri geturi get host gethost distribution endpoint distributionendpoint get uri geturi get port getport log debug authenticated executor http client user password executor string get host and port gethostandport uri uri uri get host gethost uri get port getport