licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling jcr jackrabbit server impl java file java file input stream fileinputstream java file not found exception filenotfoundexception java file output stream fileoutputstream java io exception ioexception java input stream inputstream java output stream outputstream java net malformedurlexception java net url java util dictionary java util hashtable java util map java util tree map treemap java util concurrent concurrent hash map concurrenthashmap javax jcr repository javax jcr repository exception repositoryexception javax management dynamicmbean org apache felix scr annotations activate org apache felix scr annotations component org apache felix scr annotations deactivate org apache felix scr annotations properties org apache felix scr annotations property org apache felix scr annotations reference org apache felix scr annotations reference cardinality referencecardinality org apache felix scr annotations reference policy referencepolicy org apache jackrabbit api management repository manager repositorymanager org apache jackrabbit core repository impl repositoryimpl org apache jackrabbit core config repository config repositoryconfig org apache sling commons osgi properties util propertiesutil org apache sling jcr api name space mapper namespacemapper org apache sling jcr api sling repository slingrepository org apache sling jcr base abstract sling repository abstractslingrepository org apache sling jcr base abstract sling repository manager abstractslingrepositorymanager org apache sling jcr base util repository accessor repositoryaccessor org apache sling jcr jackrabbit server impl jmx statistics bean impl statisticsmbeanimpl org apache sling service user mapping serviceusermapping service user mapper serviceusermapper org osgi framework bundle org osgi framework bundle context bundlecontext org osgi framework constants org osgi framework service registration serviceregistration org osgi service component component context componentcontext org slf logger org slf logger factory loggerfactory code sling server repository slingserverrepository code creates config ures configures jackrabbit repository instances component label repository description repository description metatype org apache sling jcr jackrabbit server sling server repository slingserverrepository configuration factory configurationfactory reference namespace mapper namespacemapper reference interface referenceinterface name space mapper namespacemapper cardinality reference cardinality referencecardinality optional multiple policy reference policy referencepolicy dynamic properties property service vendor apache software foundation property service description factory embedded jackrabbit repository instances sling server repository manager slingserverrepositorymanager abstract sling repository manager abstractslingrepositorymanager log logger log logger factory loggerfactory get logger getlogger get class getclass configuration property defining url repository configuration file config configuration file located local file system file scheme parameter mandatory activator start repository property string repository config url config configuration property defining file system directory repository files located parameter mandatory activator start repository property string repository dir property string repository registration compatibility login administrative loginadministrative enabled releases change login admin enabled property string property workspace default workspace defaultworkspace property bool value boolvalue login admin enabled string property login admin enabled admin login enabled string admin user admin property admin user string property admin user admin reference service user mapper serviceusermapper service user mapper serviceusermapper name space mapper namespacemapper namespace map pers namespacemappers component context componentcontext component context componentcontext string admin user name adminusername map string service registration serviceregistration statistics services statisticsservices concurrent hash map concurrenthashmap string service registration serviceregistration map name space mapper namespacemapper namespace mapper refs namespacemapperrefs tree map treemap name space mapper namespacemapper repository management override repository acquire repository acquirerepository bundle context bundlecontext bundle context bundlecontext get component context getcomponentcontext get bundle context getbundlecontext string override url overrideurl bundle context bundlecontext get property getproperty repository accessor repositoryaccessor repository url override property configure repository override url sling override url overrideurl override url overrideurl is empty isempty string sling home path slinghomepath bundle context bundlecontext get property getproperty sling file home file homefile string configurlobj home file homefile get or init repository home getorinitrepositoryhome bundle context bundlecontext sling home path slinghomepath configurlobj get or init config file url getorinitconfigfileurl bundle context bundlecontext home file homefile get absolute path getabsolutepath io exception ioexception runtime exception runtimeexception get class getclass get name getname init ialisation initialisation failed ensure absolute path string home file homefile get absolute path getabsolutepath location don overwrite system get property getproperty derby stream error file string derby log derbylog derby log system set property setproperty derby stream error file derby log derbylog input stream inputstream ins repository config repositoryconfig crc configurlobj configurlobj length check url file path file config file configfile file configurlobj config file configfile can read canread ins file input stream fileinputstream config file configfile log info configuration file config file configfile get absolute path getabsolutepath url configurl url configurlobj ins configurl open stream openstream log info configuration url configurl malformedurlexception mue log info configuration file config file configfile get absolute path getabsolutepath lost recreate bundle bundle bundle context bundlecontext get bundle getbundle sling server repository manager slingserverrepositorymanager copy file copyfile bundle repository xml config file configfile ins file input stream fileinputstream config file configfile log info configuration file config file configfile get absolute path getabsolutepath crc repository config repositoryconfig create ins crc repository config repositoryconfig create home file homefile register statistics registerstatistics repository impl repositoryimpl create crc io exception ioexception ioe log error acquire repository acquirerepository problem starting repository configurlobj ioe repository exception repositoryexception log error acquire repository acquirerepository repository problem starting repository configurlobj ins ins close io exception ioexception ioe repository file get or init repository home getorinitrepositoryhome bundle context bundlecontext bundle context bundlecontext string sling home path slinghomepath io exception ioexception string repo home path repohomepath string get component context getcomponentcontext get properties getproperties repository dir repo home path repohomepath repo home path repohomepath is empty isempty repo home path repohomepath bundle context bundlecontext get property getproperty sling repository file home dir homedir repo home path repohomepath repo home path repohomepath is empty isempty home dir homedir file repo home path repohomepath get repository name getrepositoryname bundle context bundlecontext sling home path slinghomepath home dir homedir file sling home path slinghomepath get repository name getrepositoryname bundle context bundlecontext home dir homedir file get repository name getrepositoryname bundle context bundlecontext jackrabbit exists home dir homedir is directory isdirectory log info creating config jackrabbit home dir homedir home dir homedir mkdirs io exception ioexception verify configuration verifyconfiguration create jackrabbit home dir homedir failed creating configuration home dir homedir string get repository name getrepositoryname bundle context bundlecontext bundle context bundlecontext string repo name reponame bundle context bundlecontext get property getproperty sling repository repo name reponame repository repo name reponame jackrabbit repository register statistics registerstatistics repository repository repository repository impl repositoryimpl repository impl repositoryimpl repository impl repositoryimpl repository impl repositoryimpl repository statistics bean impl statisticsmbeanimpl mbean statistics bean impl statisticsmbeanimpl repository impl repositoryimpl dictionary string object properties hashtable string object string mbean name mbeanname statistics bean impl statisticsmbeanimpl get bean name getmbeanname repository impl repositoryimpl properties jmx object name objectname mbean name mbeanname properties constants service vendor apache statistics services statisticsservices mbean name mbeanname get component context getcomponentcontext get bundle context getbundlecontext register service registerservice dynamicmbean get name getname mbean properties exception log error unable register statistics repository suppress warnings suppresswarnings unchecked override dictionary string object get service registration properties getserviceregistrationproperties get component context getcomponentcontext get properties getproperties returns jackrabbit code repository manager repositorymanager implemented jackrabbit repository add ition addition code sling repository slingrepository code repository interfaces implemented base bundle version replacing over writing overwriting code abstract sling repository abstractslingrepository register service registerservice method override string get service registration interfaces getserviceregistrationinterfaces string sling repository slingrepository get name getname repository get name getname repository manager repositorymanager get name getname override abstract sling repository abstractslingrepository create bundle using bundle usingbundle sling server repository slingserverrepository using bundle usingbundle admin user name adminusername override destroy abstract sling repository abstractslingrepository repository service instance repositoryserviceinstance override name space mapper namespacemapper get name space mapper services getnamespacemapperservices namespace map pers namespacemappers override service user mapper serviceusermapper get service user mapper getserviceusermapper service user mapper serviceusermapper override dispose repository disposerepository repository repository unregister statistics unregisterstatistics repository repository repository impl repositoryimpl repository impl repositoryimpl repository shutdown throwable log error deactivate unexpected problem shutting repository log error repository repository impl repositoryimpl unregister statistics unregisterstatistics repository repository repository repository impl repositoryimpl string mbean name mbeanname statistics bean impl statisticsmbeanimpl get bean name getmbeanname repository impl repositoryimpl repository service registration serviceregistration service registration serviceregistration statistics services statisticsservices mbean name mbeanname service registration serviceregistration service registration serviceregistration unregister exception log warn failed unregister statistics jmx bean get message getmessage statistics services statisticsservices remove mbean name mbeanname scr int egration integration component context componentcontext get component context getcomponentcontext component context componentcontext method called overwritten implementations activate activate component context componentcontext component context componentcontext exception component context componentcontext component context componentcontext suppress warnings suppresswarnings unchecked dictionary string object properties component context componentcontext get properties getproperties string default workspace defaultworkspace properties util propertiesutil to string tostring properties property workspace disable login administrative disableloginadministrative properties util propertiesutil to boolean toboolean properties property login admin enabled login admin enabled admin user name adminusername properties util propertiesutil to string tostring properties property admin user admin user start component context componentcontext get bundle context getbundlecontext default workspace defaultworkspace disable login administrative disableloginadministrative method called overwritten implementations param component context componentcontext deactivate deactivate component context componentcontext component context componentcontext admin user name adminusername component context componentcontext namespace mapper refs namespacemapperrefs clear namespace map pers namespacemappers suppress warnings suppresswarnings unused bind name space mapper bindnamespacemapper name space mapper namespacemapper namespace mapper namespacemapper map string object props namespace mapper refs namespacemapperrefs namespace mapper refs namespacemapperrefs props constants service namespace mapper namespacemapper namespace map pers namespacemappers namespace mapper refs namespacemapperrefs values to array toarray name space mapper namespacemapper namespace mapper refs namespacemapperrefs size suppress warnings suppresswarnings unused unbind name space mapper unbindnamespacemapper name space mapper namespacemapper namespace mapper namespacemapper map string object props namespace mapper refs namespacemapperrefs namespace mapper refs namespacemapperrefs remove props constants service namespace map pers namespacemappers namespace mapper refs namespacemapperrefs values to array toarray name space mapper namespacemapper namespace mapper refs namespacemapperrefs size helper attempts retrieve url repository configuration file creating url configured param bundle context bundlecontext bundle context param repository url location io exception ioexception error initial ising initialising config file url string get or init config file url getorinitconfigfileurl bundle context bundlecontext bundle context bundlecontext string io exception ioexception string repo config file url repoconfigfileurl string get component context getcomponentcontext get properties getproperties repository config url repo config file url repoconfigfileurl repo config file url repoconfigfileurl is empty isempty repo config file url repoconfigfileurl bundle context bundlecontext get property getproperty sling repository config file url repo config file url repoconfigfileurl repository config file url config file url configfileurl verify good url config file url configfileurl url repo config file url repoconfigfileurl repo config file url repoconfigfileurl malformedurlexception config file url configfileurl url file repo config file url repoconfigfileurl file config file configfile file config file url configfileurl get file getfile config file configfile can read canread config file url configfileurl to string tostring ensure configuration file exists dir file config file configfile file repository xml copied url contextconfigurl url context repository xml input stream inputstream context config stream contextconfigstream contextconfigurl open stream openstream context config stream contextconfigstream sling server repository manager slingserverrepositorymanager copy stream copystream context config stream contextconfigstream config file configfile copied exception copied sling server repository manager slingserverrepositorymanager copy file copyfile bundle context bundlecontext get bundle getbundle repository xml config file configfile config file repository xml home dir homedir copy file copyfile bundle bundle string entry path entrypath file dest file destfile file not found exception filenotfoundexception io exception ioexception dest file destfile can read canread file exists copy property url entryurl bundle get entry getentry entry path entrypath entryurl file not found exception filenotfoundexception entry path entrypath check file property input stream inputstream source entryurl open stream openstream copy stream copystream source dest file destfile copy stream copystream input stream inputstream source file dest file destfile file not found exception filenotfoundexception io exception ioexception output stream outputstream dest ensure path parent folder lic file licfile dest file destfile get parent file getparentfile mkdirs dest file output stream fileoutputstream dest file destfile buf source read buf dest write buf dest dest close io exception ioexception ignore lic source licsource source close io exception ioexception ignore