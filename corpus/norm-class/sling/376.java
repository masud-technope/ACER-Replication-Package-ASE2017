licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling event dea impl java util calendar java util dictionary java util hash map hashmap java util hash set hashset java util hashtable java util iterator java util map java util java util concurrent blocking queue blockingqueue java util concurrent linked blocking queue linkedblockingqueue java util concurrent atomic atomic long atomiclong org apache sling api resource login exception loginexception org apache sling api resource persistence exception persistenceexception org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling api resource resource resolver factory resourceresolverfactory org apache sling api resource resource util resourceutil org apache sling discovery instance description instancedescription org apache sling discovery topology event topologyevent org apache sling discovery topology event topologyevent type org apache sling discovery topology event listener topologyeventlistener org apache sling event dea dea constants deaconstants org apache sling settings sling settings service slingsettingsservice org osgi framework bundle context bundlecontext org osgi framework constants org osgi framework service registration serviceregistration org osgi service event event org osgi service event event constants eventconstants org osgi service event event handler eventhandler org slf logger org slf logger factory loggerfactory distributed event receiver list ens listens distributable events stores repository cluster instance pick component scheduled clean tasks background per iodically periodically distributed event receiver distributedeventreceiver event handler eventhandler runnable topology event listener topologyeventlistener special topic queue string topic stopped org apache sling event dea impl stopped logger logger logger logger factory loggerfactory get logger getlogger get class getclass local queue writing received events repository blocking queue blockingqueue event write queue writequeue linked blocking queue linkedblockingqueue event resource resolver factory resource resolver factory resourceresolverfactory resource resolver factory resourceresolverfactory current instance string sling id slingid root path events string root path rootpath root path events written instance string own root path ownrootpath cleanup period cleanup period cleanupperiod resolver writing resource resolver resourceresolver writer resolver writerresolver background task running running current instances leader string instances service registration service registration serviceregistration service registration serviceregistration distributed event receiver distributedeventreceiver bundle context bundlecontext bundle context bundlecontext string root path rootpath string own root path ownrootpath cleanup period cleanupperiod resource resolver factory resourceresolverfactory rr factory rrfactory sling settings service slingsettingsservice settings root path rootpath root path rootpath own root path ownrootpath own root path ownrootpath resource resolver factory resourceresolverfactory rr factory rrfactory sling id slingid settings get sling id getslingid cleanup period cleanupperiod cleanup period cleanupperiod running start writer thread thread writer thread writerthread thread runnable override create service registration properties dictionary string object props hashtable string object props constants service vendor apache software foundation listen osg i osgi events distributable flag props event constants eventconstants event topic props event constants eventconstants event filter dea constants deaconstants property distribute schedule service minutes props scheduler period props scheduler concurrent service registration serviceregistration reg bundle context bundlecontext register service registerservice string event handler eventhandler get name getname runnable get name getname topology event listener topologyeventlistener get name getname distributed event receiver distributedeventreceiver props distributed event receiver distributedeventreceiver service registration serviceregistration reg writer resolver writerresolver resource resolver factory resourceresolverfactory get administrative resource resolver getadministrativeresourceresolver resource util resourceutil get or create resource getorcreateresource writer resolver writerresolver own root path ownrootpath distributed event admin impl distributedeventadminimpl resource type folder distributed event admin impl distributedeventadminimpl resource type folder exception logger error error resource resolver creation running process write queue processwritequeue throwable nosonar logger error writer thread stopped exception get message getmessage running writer resolver writerresolver writer resolver writerresolver close writer resolver writerresolver writer thread writerthread start deactivate component service registration serviceregistration service registration serviceregistration unregister service registration serviceregistration background threads put ting putting empty objects queue running write queue writequeue event topic stopped dictionary string object interrupted exception interruptedexception ignore exception ignoreexception thread current thread currentthread int errupt interrupt background thread writing events queue process write queue processwritequeue running wait event queue event event event write queue writequeue interrupted exception interruptedexception ignore exception ignoreexception thread current thread currentthread int errupt interrupt running event running write event writeevent event exception logger error exception writing event resource tree counter events atomic long atomiclong event counter eventcounter atomic long atomiclong write event resource tree param event event persistence exception persistenceexception write event writeevent event event persistence exception persistenceexception calendar calendar get instance getinstance string builder stringbuilder string builder stringbuilder own root path ownrootpath append append calendar year append append calendar month append append calendar day month append append calendar hour day append append calendar minute append append event append string value of valueof event counter eventcounter get and increment getandincrement create properties map string object properties hash map hashmap string object string prop names propnames event get property names getpropertynames prop names propnames prop names propnames length string prop name propname prop names propnames properties prop name propname event get property getproperty prop name propname properties remove dea constants deaconstants property distribute properties event constants eventconstants event topic event get topic gettopic properties dea constants deaconstants property application sling id slingid object oldrt properties resource resolver resourceresolver property resource type oldrt properties event dea resource resolver resourceresolver property resource type oldrt properties resource resolver resourceresolver property resource type distributed event admin impl distributedeventadminimpl resource type event resource util resourceutil get or create resource getorcreateresource writer resolver writerresolver to string tostring properties distributed event admin impl distributedeventadminimpl resource type folder org osgi service event event handler eventhandler handle event handleevent org osgi service event event override handle event handleevent event event write queue writequeue event interrupted exception interruptedexception ignore exception ignoreexception thread current thread currentthread int errupt interrupt helper method logs exception debug mode param ignore exception ignoreexception exception logger is debug enabled isdebugenabled logger debug exception get message getmessage method invoked per iodically periodically java lang runnable override clean up obsolete instances cleanupobsoleteinstances clean up obsolete events cleanupobsoleteevents clean up obsolete instances cleanupobsoleteinstances string sling ids slingids instances sling ids slingids instances logger debug checking instance trees distributed events resource resolver resourceresolver resolver resolver resource resolver factory resourceresolverfactory get administrative resource resolver getadministrativeresourceresolver resource base resource baseresource resolver get resource getresource root path rootpath sanity check base resource baseresource resource helper resourcehelper batch resource remove r batchresourceremover brr resource helper resourcehelper get batch resource remove r getbatchresourceremover iterator resource iter base resource baseresource list children listchildren iter has next hasnext resource root resource rootresource iter sling ids slingids root resource rootresource get name getname brr delete root resource rootresource commit out standing outstanding deletes resolver commit persistence exception persistenceexception logger warn exception job resource tree cleanup login exception loginexception ignore ignore exception ignoreexception ignore resolver resolver close clean up obsolete events cleanupobsoleteevents cleanup period cleanupperiod logger debug cleaning distributed events removing entries older minutes cleanup period cleanupperiod resource resolver resourceresolver resolver resolver resource resolver factory resourceresolverfactory get administrative resource resolver getadministrativeresourceresolver resource helper resourcehelper batch resource remove r batchresourceremover brr resource helper resourcehelper get batch resource remove r getbatchresourceremover resource base resource baseresource resolver get resource getresource own root path ownrootpath sanity check base resource baseresource calendar old date olddate calendar get instance getinstance old date olddate add calendar minute cleanup period cleanupperiod check years old year oldyear old date olddate calendar year iterator resource year iter yeariter base resource baseresource list children listchildren year iter yeariter has next hasnext resource year resource yearresource year iter yeariter year integer value of valueof year resource yearresource get name getname year old year oldyear brr delete year resource yearresource year old year oldyear year check months old month oldmonth old date olddate calendar month iterator resource month iter monthiter year resource yearresource list children listchildren month iter monthiter has next hasnext resource month resource monthresource month iter monthiter month integer value of valueof month resource monthresource get name getname month old month oldmonth brr delete month resource monthresource month old month oldmonth month check days old day oldday old date olddate calendar day month iterator resource day iter dayiter month resource monthresource list children listchildren day iter dayiter has next hasnext resource day resource dayresource day iter dayiter day integer value of valueof day resource dayresource get name getname day old day oldday brr delete day resource dayresource day old day oldday day check hours old hour oldhour old date olddate calendar hour day iterator resource hour iter houriter day resource dayresource list children listchildren hour iter houriter has next hasnext resource hour resource hourresource hour iter houriter hour integer value of valueof hour resource hourresource get name getname hour old hour oldhour brr delete hour resource hourresource hour old hour oldhour hour check minutes old min ute oldminute old date olddate calendar minute iterator resource minute iter minuteiter hour resource hourresource list children listchildren minute iter minuteiter has next hasnext resource minute resource minuteresource minute iter minuteiter minute integer value of valueof minute resource minuteresource get name getname minute old min ute oldminute brr delete minute resource minuteresource commit out standing outstanding resources resolver commit persistence exception persistenceexception logger warn exception job resource tree cleanup login exception loginexception ignore ignore exception ignoreexception ignore resolver resolver close org apache sling discovery topology event listener topologyeventlistener handle topology event handletopologyevent org apache sling discovery topology event topologyevent override handle topology event handletopologyevent topology event topologyevent event event get type gettype type topology changing instances event get type gettype type topology changed event get type gettype type topology init event get new view getnewview get local instance getlocalinstance is leader isleader string hash set hashset string instance description instancedescription desc event get new view getnewview get instances getinstances add desc get sling id getslingid instances