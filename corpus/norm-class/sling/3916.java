licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling ide eclipse internal java byte array input stream bytearrayinputstream java file java io exception ioexception java input stream inputstream java lang reflect invocation target exception invocationtargetexception java util hash set hashset java util iterator java util linked list linkedlist java util list java util org apache commons io utils ioutils org apache jackrabbit util text org apache sling ide eclipse core project util projectutil org apache sling ide eclipse core resource util resourceutil org apache sling ide eclipse core server util serverutil org apache sling ide eclipse core internal resource and info resourceandinfo org apache sling ide eclipse core internal resource change command factory resourcechangecommandfactory org apache sling ide eclipse core progress progress utils progressutils org apache sling ide filter filter org apache sling ide filter filter result filterresult org apache sling ide filter ignored resources ignoredresources org apache sling ide log logger org apache sling ide serialization serialization data serializationdata org apache sling ide serialization serialization data builder serializationdatabuilder org apache sling ide serialization serialization exception serializationexception org apache sling ide serialization serialization kind serializationkind org apache sling ide serialization serialization kind manager serializationkindmanager org apache sling ide serialization serialization manager serializationmanager org apache sling ide transport command org apache sling ide transport repository org apache sling ide transport repository exception repositoryexception org apache sling ide transport resource proxy resourceproxy org apache sling ide transport result org eclipse core resources i container icontainer org eclipse core resources i file ifile org eclipse core resources i folder ifolder org eclipse core resources i project iproject org eclipse core resources i resource iresource org eclipse core resources i resource visitor iresourcevisitor org eclipse core runtime core exception coreexception org eclipse core runtime i path ipath org eclipse core runtime i progress monitor iprogressmonitor org eclipse core runtime i status istatus org eclipse core runtime null progress monitor nullprogressmonitor org eclipse core runtime operation canceled exception operationcanceledexception org eclipse core runtime status org eclipse wst server core i server iserver int entionally intentionally implement i runnable with progress irunnablewithprogress cut dependency j face jface import repository content action importrepositorycontentaction i server iserver server i path ipath project relative path projectrelativepath i project iproject project logger logger serialization manager serializationmanager serialization manager serializationmanager serialization data builder serializationdatabuilder builder ignored resources ignoredresources ignored resources ignoredresources i progress monitor iprogressmonitor monitor repository repository filter filter file content sync root contentsyncroot i folder ifolder content sync root dir contentsyncrootdir i resource iresource current resources currentresources i path ipath repository import root repositoryimportroot param server param project relative path projectrelativepath param project serialization exception serializationexception import repository content action importrepositorycontentaction i server iserver server i path ipath project relative path projectrelativepath i project iproject project serialization manager serializationmanager serialization manager serializationmanager serialization exception serializationexception logger activator get default getdefault get plugin logger getpluginlogger server server project relative path projectrelativepath project relative path projectrelativepath project project serialization manager serializationmanager serialization manager serializationmanager ignored resources ignoredresources ignored resources ignoredresources current resources currentresources hash set hashset i progress monitor iprogressmonitor monitor invocation target exception invocationtargetexception interrupted exception interruptedexception serialization exception serializationexception core exception coreexception todo nice progress feedback aka processing monitor begin task begintask repository i progress monitor iprogressmonitor unknown monitor monitor repository server util serverutil get connected repository getconnectedrepository server monitor builder serialization manager serializationmanager new builder newbuilder repository project util projectutil get sync directory file getsyncdirectoryfile project serialization kind manager serializationkindmanager skm skm serialization kind manager serializationkindmanager skm init repository repository exception repositoryexception invocation target exception invocationtargetexception filter project util projectutil load filter loadfilter project progress utils progressutils advance monitor content sync root dir contentsyncrootdir project util projectutil get sync directory getsyncdirectory project repository import root repositoryimportroot project relative path projectrelativepath make relative to makerelativeto content sync root dir contentsyncrootdir get project relative path getprojectrelativepath make absolute makeabsolute content sync root contentsyncroot project util projectutil get sync directory full path getsyncdirectoryfullpath project to file tofile read vlt ignores not under import root readvltignoresnotunderimportroot content sync root dir contentsyncrootdir repository import root repositoryimportroot progress utils progressutils advance monitor activator get default getdefault get plugin logger getpluginlogger trace starting repository start point workspace start point repository import root repositoryimportroot project relative path projectrelativepath record not ignored resources recordnotignoredresources progress utils progressutils advance monitor crawl children and import crawlchildrenandimport repository import root repositoryimportroot to portable string toportablestring remove not ignored and not updated resources removenotignoredandnotupdatedresources null progress monitor nullprogressmonitor progress utils progressutils advance monitor operation canceled exception operationcanceledexception exception invocation target exception invocationtargetexception builder builder destroy builder monitor read vlt ignores not under import root readvltignoresnotunderimportroot i folder ifolder sync dir syncdir i path ipath repository import root repositoryimportroot io exception ioexception core exception coreexception i folder ifolder current sync dir syncdir repository import root repositoryimportroot segment count segmentcount i path ipath repo path repopath current get project relative path getprojectrelativepath make relative to makerelativeto sync dir syncdir get project relative path getprojectrelativepath make absolute makeabsolute parse ignore files parseignorefiles current repo path repopath to portable string toportablestring current i folder ifolder current find member findmember repository import root repositoryimportroot segment record not ignored resources recordnotignoredresources core exception coreexception resource change command factory resourcechangecommandfactory rccf resource change command factory resourcechangecommandfactory serialization manager serializationmanager i resource iresource import starting point importstartingpoint content sync root dir contentsyncrootdir find member findmember repository import root repositoryimportroot import starting point importstartingpoint import starting point importstartingpoint accept i resource visitor iresourcevisitor override visit i resource iresource resource core exception coreexception resource and info resourceandinfo rai rccf build resource and info buildresourceandinfo resource repository rai prerequisite string repository path repositorypath rai get resource getresource get path getpath filter result filterresult filter result filterresult filter filter repository path repositorypath ignored resources ignoredresources is ignored isignored repository path repositorypath filter result filterresult filter result filterresult current resources currentresources add resource io exception ioexception core exception coreexception status i status istatus error activator plugin failed reading current project resources logger trace local resources current resources currentresources size remove not ignored and not updated resources removenotignoredandnotupdatedresources i progress monitor iprogressmonitor monitor core exception coreexception logger trace resources clean current resources currentresources size i resource iresource resource current resources currentresources resource exists logger trace deleting resource resource delete monitor crawls repository recursively imports founds resources param path current path param tracer json exception jsonexception repository exception repositoryexception core exception coreexception io exception ioexception todo pushed service layer crawl children and import crawlchildrenandimport string path repository exception repositoryexception core exception coreexception io exception ioexception serialization exception serializationexception logger trace crawl children and import crawlchildrenandimport repository path project project relative path projectrelativepath resource proxy resourceproxy resource execute command executecommand repository new list children node command newlistchildrennodecommand path serialization data serializationdata serialization data serializationdata builder build serialization data buildserializationdata content sync root contentsyncroot resource logger trace resource path serialization data resource get path getpath serialization data serializationdata list resource proxy resourceproxy resource children resourcechildren linked list linkedlist resource get children getchildren serialization data serializationdata i path ipath serialization folder path serializationfolderpath content sync root dir contentsyncrootdir get project relative path getprojectrelativepath append serialization data serializationdata get folder path getfolderpath serialization data serializationdata get serialization kind getserializationkind file contents execute command executecommand repository new get node command newgetnodecommand path create file createfile project get path for plain file node getpathforplainfilenode resource serialization folder path serializationfolderpath contents serialization data serializationdata has contents hascontents create folder createfolder project serialization folder path serializationfolderpath create file createfile project serialization folder path serializationfolderpath append serialization data serializationdata get file name getfilename serialization data serializationdata get contents getcontents special processing resource nodes iterator resource proxy resourceproxy resource children resourcechildren iterator has next hasnext resource proxy resourceproxy child repository resource equals child get properties getproperties repository jcr primary type resource proxy resourceproxy reloaded child resource reloadedchildresource execute command executecommand repository new list children node command newlistchildrennodecommand child get path getpath logger trace skip ping skipping direct handling node addition ally additionally handle direct children repository resource child get path getpath reloaded child resource reloadedchildresource get children getchildren size reloaded child resource reloadedchildresource get children getchildren size string path name pathname text get name getname reloaded child resource reloadedchildresource get path getpath path name pathname serialization manager serializationmanager get os path getospath path name pathname create folder createfolder project serialization folder path serializationfolderpath append path name pathname recursively handle resources resource proxy resourceproxy grand child grandchild reloaded child resource reloadedchildresource get children getchildren crawl children and import crawlchildrenandimport grand child grandchild get path getpath remove folder metadata partial i folder ifolder folder create folder createfolder project serialization folder path serializationfolderpath parse ignore files parseignorefiles folder path serialization data serializationdata has contents hascontents create file createfile project serialization folder path serializationfolderpath append serialization data serializationdata get file name getfilename serialization data serializationdata get contents getcontents metadata full serialization data serializationdata has contents hascontents create file createfile project serialization folder path serializationfolderpath append serialization data serializationdata get file name getfilename serialization data serializationdata get contents getcontents logger trace resource children resource get path getpath resource children resourcechildren serialization data serializationdata get serialization kind getserializationkind serialization kind serializationkind metadata full logger trace serialization data resource get path getpath progress utils progressutils advance monitor resource proxy resourceproxy child resource children resourcechildren ignored resources ignoredresources is ignored isignored child get path getpath filter filter result filterresult filter result filterresult filter filter child get path getpath filter result filterresult filter result filterresult deny crawl children and import crawlchildrenandimport child get path getpath returns path serial izing serializing resource data file node path level serialization folder path serializationfolderpath path segment resource param resource resource param serialization folder path serializationfolderpath folder serialization data stored path plain file node i path ipath get path for plain file node getpathforplainfilenode resource proxy resourceproxy resource i path ipath serialization folder path serializationfolderpath todo serialization folder path serializationfolderpath string serialization manager serializationmanager get os path getospath text get name getname resource get path getpath serialization folder path serializationfolderpath remove last segments removelastsegments append parse ignore files parseignorefiles i folder ifolder folder string path io exception ioexception core exception coreexception todo parsing extracted i resource iresource vlt ignore vltignore folder find member findmember vlt ignore vltignore vlt ignore vltignore vlt ignore vltignore i file ifile logger trace ignore file vlt ignore vltignore get full path getfullpath input stream inputstream contents i file ifile vlt ignore vltignore get contents getcontents list string ignore lines ignorelines io utils ioutils read lines readlines contents string ignore line ignoreline ignore lines ignorelines logger trace registering ignore rule path ignore line ignoreline ignored resources ignoredresources register reg exp ignore rule registerregexpignorerule path ignore line ignoreline execute command executecommand command command repository exception repositoryexception result result command execute result i folder ifolder create folder createfolder i project iproject project i path ipath destination path destinationpath core exception coreexception i folder ifolder destination folder destinationfolder project get folder getfolder destination path destinationpath destination folder destinationfolder exists logger trace creating folder destination folder destinationfolder get full path getfullpath create parents createparents destination folder destinationfolder get parent getparent destination folder destinationfolder create destination folder destinationfolder set session property setsessionproperty resource util resourceutil modification timestamp destination folder destinationfolder get modification stamp getmodificationstamp remove touched resource removetouchedresource destination folder destinationfolder destination folder destinationfolder create parents createparents i container icontainer container core exception coreexception container exists container get type gettype i resource iresource folder create parents createparents container get parent getparent create folder createfolder container get project getproject container get project relative path getprojectrelativepath remove touched resource removetouchedresource i resource iresource resource i resource iresource current resource current resources currentresources remove current current current get parent getparent create file createfile i project iproject project i path ipath path node core exception coreexception node illegal argument exception illegalargumentexception node i file ifile destination file destinationfile project get file getfile path logger trace writing content file path destination file destinationfile exists todo progress monitor destination file destinationfile set contents setcontents byte array input stream bytearrayinputstream node i resource iresource history todo progress monitor destination file destinationfile get parent getparent exists create parents createparents destination file destinationfile get parent getparent destination file destinationfile create byte array input stream bytearrayinputstream node remove touched resource removetouchedresource destination file destinationfile destination file destinationfile set session property setsessionproperty resource util resourceutil modification timestamp destination file destinationfile get modification stamp getmodificationstamp