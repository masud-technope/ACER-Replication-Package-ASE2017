licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling discovery base connectors ping java byte array output stream bytearrayoutputstream java i o exception ioexception java net url java util java util iterator java util uuid java util zip gzip output stream gzipoutputstream javax servlet http http servlet response httpservletresponse org apache http header org apache http auth scope authscope org apache http credentials org apache http username password credentials usernamepasswordcredentials org apache http client config request config requestconfig org apache http client methods closeable http response closeablehttpresponse org apache http client methods http delete httpdelete org apache http client methods http put httpput org apache http client protocol http client context httpclientcontext org apache http config socket config socketconfig org apache http entity byte array entity bytearrayentity org apache http entity content type contenttype org apache http entity string entity stringentity org apache http impl client closeable http client closeablehttpclient org apache http impl client default http request retry handler defaulthttprequestretryhandler org apache http impl client http client builder httpclientbuilder org apache sling commons json json exception jsonexception org apache sling discovery cluster view clusterview org apache sling discovery instance description instancedescription org apache sling discovery base commons cluster view service clusterviewservice org apache sling discovery base commons undefined cluster view exception undefinedclusterviewexception org apache sling discovery base connectors base config baseconfig org apache sling discovery base connectors announcement announcement org apache sling discovery base connectors announcement announcement filter announcementfilter org apache sling discovery base connectors announcement announcement registry announcementregistry org slf logger org slf logger factory loggerfactory topology connector client sending pinging remote topology connector servlet exc hanging exchanging announcements topology connector client topologyconnectorclient topology connector client information topologyconnectorclientinformation logger logger logger factory loggerfactory get logger getlogger get class getclass endpoint url url connector url connectorurl cluster view service cluster view service clusterviewservice cluster view service clusterviewservice config service user base config baseconfig config connection uuid announcement registry announcement registry announcementregistry announcement registry announcementregistry inherited announcement announcement last inherited announcement lastinheritedannouncement time announcement inherited webconsole last pinged at lastpingedat server string server info serverinfo status code post last status code laststatuscode sling connector auto stopped auto stopped autostopped details connection failures string status details statusdetails sling suppress ping warnings suppress ping warnings suppresspingwarnings topology request validator topologyrequestvalidator request validator requestvalidator content encoding request string last request encoding lastrequestencoding content encoding rep sonse repsonse string last response encoding lastresponseencoding sling unix time point backoff period ends pings backoff period end backoffperiodend topology connector client topologyconnectorclient cluster view service clusterviewservice cluster view service clusterviewservice announcement registry announcementregistry announcement registry announcementregistry base config baseconfig config url connector url connectorurl string server info serverinfo cluster view service clusterviewservice illegal argument exception illegalargumentexception cluster view service clusterviewservice announcement registry announcementregistry illegal argument exception illegalargumentexception announcement registry announcementregistry config illegal argument exception illegalargumentexception config connector url connectorurl illegal argument exception illegalargumentexception connector url connectorurl request validator requestvalidator topology request validator topologyrequestvalidator config cluster view service clusterviewservice cluster view service clusterviewservice announcement registry announcementregistry announcement registry announcementregistry config config connector url connectorurl connector url connectorurl server info serverinfo server info serverinfo uuid randomuuid ping server pass announcements ping force auto stopped autostopped suppress pings logger debug ping auto stopped autostopped suppressing pings force backoff period end backoffperiodend backoff period end backoffperiodend system current time millis currenttimemillis backoff period end backoffperiodend logger debug ping iss ueing issueing heartbeat backoff instruction peer logger debug ping backoff period ended issuing ping string uri connector url connectorurl to string tostring cluster view service clusterviewservice get sling id getslingid json logger is debug enabled isdebugenabled logger debug ping connector url connectorurl connector url connectorurl complete uri uri http client context httpclientcontext client context clientcontext http client context httpclientcontext create closeable http client closeablehttpclient http client httpclient create http client createhttpclient http put httpput put request putrequest http put httpput uri setting connection timeout idle connection configured seconds put request putrequest set config setconfig request config requestconfig custom set connect timeout setconnecttimeout config get socket connect timeout getsocketconnecttimeout build announcement resulting announcement resultingannouncement string user info userinfo connector url connectorurl get user info getuserinfo user info userinfo credentials username password credentials usernamepasswordcredentials user info userinfo client context clientcontext get credentials provider getcredentialsprovider set credentials setcredentials auth scope authscope put request putrequest geturi get host gethost put request putrequest geturi get port getport announcement topology announcement topologyannouncement announcement cluster view service clusterviewservice get sling id getslingid topology announcement topologyannouncement set server info setserverinfo server info serverinfo cluster view clusterview cluster view clusterview cluster view clusterview cluster view service clusterviewservice get local cluster view getlocalclusterview undefined cluster view exception undefinedclusterviewexception logger warn ping cluster view clusterview moment ping topology announcement topologyannouncement set local cluster setlocalcluster cluster view clusterview force logger debug ping sending reset backoff resetbackoff topology announcement topologyannouncement set reset backoff setresetbackoff announcement registry announcementregistry add all except addallexcept topology announcement topologyannouncement cluster view clusterview announcement filter announcementfilter accept string receiving sling id receivingslingid announcement announcement filter announcements cluster instances don t dont cluster view moment iterator instance description instancedescription cluster view clusterview get instances getinstances iterator has next hasnext instance description instancedescription instance instance get sling id getslingid equals receiving sling id receivingslingid fine propagate announcement string request validator requestvalidator encode message encodemessage topology announcement topologyannouncement asjson logger is debug enabled isdebugenabled logger debug ping topology announcement topologyannouncement json request validator requestvalidator trust message trustmessage put request putrequest config is gzip connector requests enabled isgzipconnectorrequestsenabled server content gzipped put request putrequest add header addheader content encoding gzip gzip body byte array output stream bytearrayoutputstream baos byte array output stream bytearrayoutputstream gzip output stream gzipoutputstream gzip out gzipout gzip output stream gzipoutputstream baos gzip out gzipout write get bytes getbytes utf gzip out gzipout close gzipped encoded json gzippedencodedjson baos to byte array tobytearray put request putrequest set entity setentity byte array entity bytearrayentity gzipped encoded json gzippedencodedjson content type contenttype application json last request encoding lastrequestencoding gzip plaintext string entity stringentity plaintext string entity stringentity utf plaintext set content type setcontenttype content type contenttype application json get mime type getmimetype put request putrequest set entity setentity plaintext last request encoding lastrequestencoding plaintext independent request gzip ping gzipping accept response gzipped server put request putrequest add header addheader accept encoding gzip closeable http response closeablehttpresponse response http client httpclient execute put request putrequest client context clientcontext logger is debug enabled isdebugenabled logger debug ping code response get status line getstatusline get status code getstatuscode response get status line getstatusline get reason phrase getreasonphrase last status code laststatuscode response get status line getstatusline get status code getstatuscode last response encoding lastresponseencoding response get status line getstatusline get status code getstatuscode http servlet response httpservletresponse header content encoding contentencoding response get first header getfirstheader content encoding content encoding contentencoding content encoding contentencoding get value getvalue content encoding contentencoding get value getvalue gzip last response encoding lastresponseencoding gzip last response encoding lastresponseencoding plaintext limiting string response body responsebody request validator requestvalidator decode message decodemessage put request putrequest geturi get path getpath response logger is debug enabled isdebugenabled logger debug ping response body response body responsebody response body responsebody response body responsebody length announcement inherited announcement inheritedannouncement announcement fromjson response body responsebody backoff interval backoffinterval inherited announcement inheritedannouncement get backoff interval getbackoffinterval backoff interval backoffinterval reset backoff period end backoffperiodend avoid slipping int erval interval millis backoff period end backoffperiodend system current time millis currenttimemillis backoff interval backoffinterval logger debug ping servlet ins truc ted instructed backoff backoff interval backoffinterval backoff interval backoffinterval period backoff period end backoffperiodend logger debug ping servlet inst ruct instruct backoff ing stage backoff period end backoffperiodend inherited announcement inheritedannouncement is loop isloop logger is debug enabled isdebugenabled logger debug ping connector response loop detected registering announcement inherited announcement inheritedannouncement get owner id getownerid inherited announcement inheritedannouncement get owner id getownerid equals cluster view service clusterviewservice get sling id getslingid config is auto stop local loop enabled isautostoplocalloopenabled connected represents loop representsloop inherited announcement inheritedannouncement is auto stopped isautostopped auto stopped autostopped inherited announcement inheritedannouncement set inherited setinherited announcement registry announcementregistry register announcement registerannouncement inherited announcement inheritedannouncement logger is debug enabled isdebugenabled logger debug ping connector response instance topology inherited announcement inheritedannouncement status details statusdetails receiving side path connector cluster loop resulting announcement resultingannouncement inherited announcement inheritedannouncement status details statusdetails status details statusdetails response body received status details statusdetails http status code last status code laststatuscode sling reset suppress ping warnings suppresspingwarnings flag success suppress ping warnings suppresspingwarnings i o exception ioexception suppress ping warnings suppresspingwarnings logger is debug enabled isdebugenabled logger debug ping i o exception ioexception uri uri suppress ping warnings suppresspingwarnings logger warn ping i o exception ioexception suppressing war ns warns uri uri status details statusdetails to string tostring json exception jsonexception logger warn ping json exception jsonexception status details statusdetails to string tostring runtime exception runtimeexception logger warn ping runtime exception runtimeexception status details statusdetails to string tostring put request putrequest release connection releaseconnection last inherited announcement lastinheritedannouncement resulting announcement resultingannouncement last pinged at lastpingedat system current time millis currenttimemillis http client httpclient close i o exception ioexception logger error disconnect close http client httpclient closeable http client closeablehttpclient create http client createhttpclient http client builder httpclientbuilder builder http client builder httpclientbuilder create setting so timeout sotimeout configured seconds builder set default socket config setdefaultsocketconfig socket config socketconfig custom set so timeout setsotimeout config get so timeout getsotimeout build builder set retry handler setretryhandler default http request retry handler defaulthttprequestretryhandler builder build get status code getstatuscode last status code laststatuscode url get connector url getconnectorurl connector url connectorurl represents loop representsloop auto stopped autostopped last inherited announcement lastinheritedannouncement last inherited announcement lastinheritedannouncement is loop isloop is connected isconnected auto stopped autostopped last inherited announcement lastinheritedannouncement announcement registry announcementregistry has active announcement hasactiveannouncement last inherited announcement lastinheritedannouncement get owner id getownerid string get status details getstatusdetails auto stopped autostopped auto stopped last inherited announcement lastinheritedannouncement status details statusdetails announcement registry announcementregistry has active announcement hasactiveannouncement last inherited announcement lastinheritedannouncement get owner id getownerid active status details received announcement expired renewed last pinged at lastpingedat inc reasing increasing heartbeat timeout get last ping sent getlastpingsent last pinged at lastpingedat get next ping due getnextpingdue abs due absdue backoff period end backoffperiodend abs due absdue backoff period end backoffperiodend abs due absdue last pinged at lastpingedat config get connector ping interval getconnectorpinginterval rel due reldue abs due absdue system current time millis currenttimemillis rel due reldue rel due reldue is auto stopped isautostopped auto stopped autostopped string get last request encoding getlastrequestencoding last request encoding lastrequestencoding last request encoding lastrequestencoding string get last response encoding getlastresponseencoding last response encoding lastresponseencoding last response encoding lastresponseencoding string get remote sling id getremoteslingid last inherited announcement lastinheritedannouncement last inherited announcement lastinheritedannouncement get owner id getownerid string get id getid to string tostring disconnect connector disconnect string uri connector url connectorurl to string tostring cluster view service clusterviewservice get sling id getslingid json logger is debug enabled isdebugenabled logger debug disconnect connector url connectorurl connector url connectorurl complete uri uri last inherited announcement lastinheritedannouncement announcement registry announcementregistry unregister announcement unregisterannouncement last inherited announcement lastinheritedannouncement get owner id getownerid http client context httpclientcontext client context clientcontext http client context httpclientcontext create closeable http client closeablehttpclient http client httpclient create http client createhttpclient http delete httpdelete delete request deleterequest http delete httpdelete uri setting connection timeout idle connection configured seconds delete request deleterequest set config setconfig request config requestconfig custom set connect timeout setconnecttimeout config get socket connect timeout getsocketconnecttimeout build string user info userinfo connector url connectorurl get user info getuserinfo user info userinfo credentials username password credentials usernamepasswordcredentials user info userinfo client context clientcontext get credentials provider getcredentialsprovider set credentials setcredentials auth scope authscope delete request deleterequest geturi get host gethost delete request deleterequest geturi get port getport request validator requestvalidator trust message trustmessage delete request deleterequest closeable http response closeablehttpresponse response http client httpclient execute delete request deleterequest client context clientcontext logger is debug enabled isdebugenabled logger debug disconnect code response get status line getstatusline get status code getstatuscode response get status line getstatusline get reason phrase getreasonphrase ignoring actual status code statuscode point i o exception ioexception logger warn disconnect i o exception ioexception runtime exception runtimeexception logger error disconnect runtime exception runtimeexception delete request deleterequest release connection releaseconnection http client httpclient close i o exception ioexception logger error disconnect close http client httpclient