licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling maven sling start slingstart java file java io exception ioexception java input stream inputstream java string reader stringreader java lang reflect field java net url java nio file files java nio file path java util hash set hashset java util java util jar attributes java util jar jar file jarfile java util jar manifest java util zip zip entry zipentry org apache commons file utils fileutils org apache commons io utils ioutils org apache maven artifact default artifact defaultartifact org apache maven artifact handler artifact handler artifacthandler org apache maven artifact handler manager artifact handler manager artifacthandlermanager org apache maven artifact resolver artifact resolver artifactresolver org apache maven execution maven session mavensession org apache maven model build org apache maven project maven project mavenproject org apache sling provisioning model model org apache sling provisioning model model reader modelreader org code haus codehaus plexus archiver un archiver unarchiver org code haus codehaus plexus archiver manager archiver manager archivermanager org junit test org mockito mockito org junit assert array equals assertarrayequals org junit assert equals assertequals prepare package mojo test preparepackagemojotest test test subsystem base generation testsubsystembasegeneration exception provide system artifacts local repo explicitly included test pom xml prepare package mojo preparepackagemojo ppm get mojo under test getmojoundertest org apache sling org apache sling commons class loader classloader org apache sling org apache sling commons class loader classloader app org apache sling org apache sling commons content detection contentdetection org apache sling org apache sling commons json org apache sling org apache sling commons mime org apache sling org apache sling commons osgi org apache sling org apache sling commons threads launchpad feature prerequisite model string model txt modeltxt feature launchpad artifacts org apache sling org apache sling commons class loader classloader feature test type osgi subsystem composite subsystem manifest start level startlevel subsystem description extra subsystem headers including span multiple lines manifest subsystem copyright yeah artifacts org apache sling org apache sling commons osgi artifacts start level startlevel org apache sling org apache sling commons json org apache sling org apache sling commons mime artifacts start level startlevel run modes runmodes foo bar org apache sling org apache sling commons threads artifacts start level startlevel run modes runmodes bar org apache sling org apache sling commons content detection contentdetection model model model reader modelreader read string reader stringreader model txt modeltxt ppm execute model file generated file generatedfile file ppm get tmp dir gettmpdir test subsystem base jar file jarfile jar file jarfile generated file generatedfile test meta inf manifest manifest get manifest getmanifest attributes attrs get main attributes getmainattributes string expected potential bundles org apache sling commons osgi jar potential bundles org apache sling commons json jar potential bundles org apache sling commons mime jar assert equals assertequals expected attrs get value getvalue assert equals assertequals potential bundles org apache sling commons threads jar attrs get value getvalue foo assert equals assertequals potential bundles org apache sling commons threads jar potential bundles org apache sling commons content detection contentdetection jar attrs get value getvalue bar test subsystem manifest base zip entry zipentry smbze get entry getentry subsystem manifest base input stream inputstream smbis get input stream getinputstream smbze manifest smbmf manifest smbis attributes smb attrs smbattrs smbmf get main attributes getmainattributes assert equals assertequals test smb attrs smbattrs get value getvalue subsystem symbolic name symbolicname assert equals assertequals osgi subsystem composite smb attrs smbattrs get value getvalue subsystem type assert equals assertequals yeah smb attrs smbattrs get value getvalue subsystem copyright assert equals assertequals extra subsystem headers including span multiple lines manifest smb attrs smbattrs get value getvalue subsystem description test embedded bundles file mrr get maven repo root getmavenreporoot file soj get maven artifact file getmavenartifactfile mrr org apache sling org apache sling commons osgi zip entry zipentry sojze get entry getentry potential bundles org apache sling commons osgi jar input stream inputstream get input stream getinputstream sojze assert artifacts equal assertartifactsequal soj file sjj get maven artifact file getmavenartifactfile mrr org apache sling org apache sling commons json zip entry zipentry sjze get entry getentry potential bundles org apache sling commons json jar input stream inputstream get input stream getinputstream sjze assert artifacts equal assertartifactsequal sjj file smj get maven artifact file getmavenartifactfile mrr org apache sling org apache sling commons mime zip entry zipentry smjze get entry getentry potential bundles org apache sling commons mime jar input stream inputstream get input stream getinputstream smjze assert artifacts equal assertartifactsequal smj file stj get maven artifact file getmavenartifactfile mrr org apache sling org apache sling commons threads zip entry zipentry stjze get entry getentry potential bundles org apache sling commons threads jar input stream inputstream get input stream getinputstream stjze assert artifacts equal assertartifactsequal stj file ctj get maven artifact file getmavenartifactfile mrr org apache sling org apache sling commons content detection contentdetection zip entry zipentry ctjze get entry getentry potential bundles org apache sling commons content detection contentdetection jar input stream inputstream get input stream getinputstream ctjze assert artifacts equal assertartifactsequal ctj file utils fileutils delete directory deletedirectory file ppm project get build getbuild get directory getdirectory assert artifacts equal assertartifactsequal file input stream inputstream io exception ioexception bytes files read all bytes readallbytes to path topath bytes io utils ioutils to byte array tobytearray assert array equals assertarrayequals bytes equal file get name getname bytes bytes prepare package mojo preparepackagemojo get mojo under test getmojoundertest string known artifacts knownartifacts exception file mrr get maven repo root getmavenreporoot artifact handler artifacthandler mockito mock artifact handler artifacthandler artifact handler manager artifacthandlermanager ahm mockito mock artifact handler manager artifacthandlermanager mockito ahm get artifact handler getartifacthandler mockito any string anystring then return thenreturn org apache maven artifact artifact artifacts hash set hashset string known artifacts knownartifacts string parts split parts length artifacts add get maven artifact getmavenartifact mrr parts parts parts artifacts add get maven artifact getmavenartifact mrr parts parts parts parts illegal state exception illegalstateexception maven project mavenproject maven prj mavenprj maven project mavenproject build build build path temp dir tempdir files create temp directory createtempdirectory get class getclass get simple name getsimplename build set output directory setoutputdirectory temp dir tempdir to string tostring build set directory setdirectory temp dir tempdir to string tostring maven prj mavenprj set build setbuild build maven prj mavenprj set dependency artifacts setdependencyartifacts artifacts prepare package mojo preparepackagemojo ppm prepare package mojo preparepackagemojo ppm maven session mavensession mockito mock maven session mavensession ppm project maven prj mavenprj archiver manager archivermanager mockito mock archiver manager archivermanager un archiver unarchiver mockito mock un archiver unarchiver mockito get un archiver getunarchiver mockito is a isa file then return thenreturn set private field setprivatefield ppm archiver manager archivermanager set private field setprivatefield ppm artifact handler manager artifacthandlermanager ahm set private field setprivatefield ppm resolver mockito mock artifact resolver artifactresolver ppm org apache maven artifact artifact get maven artifact getmavenartifact file repo root reporoot artifact handler artifacthandler string gid string aid string ver get maven artifact getmavenartifact repo root reporoot gid aid ver org apache maven artifact artifact get maven artifact getmavenartifact file repo root reporoot artifact handler artifacthandler string gid string aid string ver string class ifier classifier default artifact defaultartifact art default artifact defaultartifact gid aid ver compile jar class ifier classifier art set file setfile get maven artifact file getmavenartifactfile repo root reporoot gid aid ver art file get maven artifact file getmavenartifactfile file repo root reporoot string gid string aid string ver file repo root reporoot gid replace aid ver aid ver jar file get maven repo root getmavenreporoot io exception ioexception url res get class getclass get class loader getclassloader get resource getresource test get name getname replace string res to external form toexternalform starts with startswith jar substring idx index of indexof junit idx illegal state exception illegalstateexception infer maven repo root res file url substring idx get file getfile set private field setprivatefield object obj string object val exception field obj get class getclass get declared field getdeclaredfield set accessible setaccessible obj val