licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling testing mock osgi java i o exception ioexception java input stream inputstream java net url java util array list arraylist java util enumeration java util hash map hashmap java util hash set hashset java util iterator java util list java util map java util java util concurrent execution exception executionexception javax xml namespace name space context namespacecontext javax xml parsers document builder documentbuilder javax xml parsers document builder factory documentbuilderfactory javax xml parsers parser configuration exception parserconfigurationexception javax xml xpath x path xpath javax xml xpath x path constants xpathconstants javax xml xpath x path expression exception xpathexpressionexception javax xml xpath x path factory xpathfactory org apache commons lang string utils stringutils org apache felix framework filter impl filterimpl org osgi framework filter org osgi framework invalid syntax exception invalidsyntaxexception org osgi framework service reference servicereference org slf logger org slf logger factory loggerfactory org dom document org dom node org dom node list nodelist org xml sax sax exception saxexception google common cache cache builder cachebuilder google common cache cache loader cacheloader google common cache loading cache loadingcache google common collect bi map bimap google common collect hash bi map hashbimap google common collect immutable list immutablelist helper methods parse osg i osgi metadata osgi metadata util osgimetadatautil logger log logger factory loggerfactory get logger getlogger osgi metadata util osgimetadatautil document builder factory documentbuilderfactory document builder factory document builder factory document builder factory documentbuilderfactory new instance newinstance document builder factory set name space aware setnamespaceaware x path factory xpathfactory xpath factory x path factory xpathfactory new instance newinstance bi map bimap string string name spaces namespaces hash bi map hashbimap create name spaces namespaces scr http osgi org xml ns xmlns scr osgi metadata osgimetadata metadata osgi metadata osgimetadata osgi metadata xml files change unit test runs classpath cache parsing step multiple times loading cache loadingcache osgi metadata osgimetadata metadata cache cache builder cachebuilder new builder newbuilder build cache loader cacheloader osgi metadata osgimetadata override osgi metadata osgimetadata load clazz exception list document metadata doc uments metadatadocuments osgi metadata util osgimetadatautil get metadata document getmetadatadocument clazz metadata doc uments metadatadocuments document metadata document metadatadocument metadata doc uments metadatadocuments matches service matchesservice clazz metadata document metadatadocument osgi metadata osgimetadata clazz metadata document metadatadocument metadata osgi metadata util osgimetadatautil methods name space context namespacecontext name space namespace context name space context namespacecontext override string get name space i getnamespaceuri string prefix name spaces namespaces prefix override string get prefix getprefix string namespaceuri name spaces namespaces inverse namespaceuri override iterator get prefixes getprefixes string namespaceuri name spaces namespaces key set keyset iterator string get metadata path getmetadatapath clazz osgi inf string utils stringutils substring before substringbefore clazz get name getname xml string get old metadata multi path getoldmetadatamultipath osgi inf service components servicecomponents xml read osgi metadata osgi inf read implemented interfaces service properties metadata cached initial read problem call method multiple time param clazz osg i osgi service implementation metadata object metadata classpath osgi metadata osgimetadata get metadata getmetadata clazz osgi metadata osgimetadata metadata metadata cache clazz metadata metadata metadata execution exception executionexception runtime exception runtimeexception error loading osg i osgi metadata loader cache list document get metadata document getmetadatadocument clazz string metadata path metadatapath get metadata path getmetadatapath clazz input stream inputstream metadata stream metadatastream osgi metadata util osgimetadatautil get class loader getclassloader get resource as stream getresourceasstream metadata path metadatapath metadata stream metadatastream string old metadata path oldmetadatapath get old metadata multi path getoldmetadatamultipath log debug osg i osgi metadata fallback metadata path metadatapath old metadata path oldmetadatapath enumeration url metadata urls metadataurls osgi metadata util osgimetadatautil get class loader getclassloader get resources getresources old metadata path oldmetadatapath list document docs array list arraylist document metadata urls metadataurls has more elements hasmoreelements url metadata url metadataurl metadata urls metadataurls next element nextelement metadata stream metadatastream metadata url metadataurl open stream openstream docs add to xml document toxmldocument metadata stream metadatastream old metadata path oldmetadatapath docs size docs i o exception ioexception runtime exception runtimeexception unable read classpath resource old metadata path oldmetadatapath immutable list immutablelist to xml document toxmldocument metadata stream metadatastream metadata path metadatapath document to xml document toxmldocument input stream inputstream input stream inputstream string path document builder factory documentbuilderfactory document builder factory documentbuilderfactory document builder factory documentbuilderfactory new instance newinstance document builder documentbuilder document builder documentbuilder document builder factory documentbuilderfactory new document builder newdocumentbuilder document builder documentbuilder parse input stream inputstream parser configuration exception parserconfigurationexception runtime exception runtimeexception unable read classpath resource path sax exception saxexception runtime exception runtimeexception unable read classpath resource path i o exception ioexception runtime exception runtimeexception unable read classpath resource path input stream inputstream close i o exception ioexception param clazz osg i osgi component x path xpath query fragment find matching xml node scr metadata string get component path query getcomponentxpathquery clazz string class name classname string utils stringutils substring before substringbefore clazz get name getname enhancer implementation class name classname class name classname matches service matchesservice clazz document metadata string query get component path query getcomponentxpathquery clazz node list nodelist nodes query nodes querynodes metadata query nodes nodes get length getlength string get service interfaces getserviceinterfaces clazz document metadata string service interfaces serviceinterfaces hash set hashset string string query get component path query getcomponentxpathquery clazz service provide node list nodelist nodes query nodes querynodes metadata query nodes nodes get length getlength node node nodes item string service interface serviceinterface get attribute value getattributevalue node string utils stringutils is not blank isnotblank service interface serviceinterface service interfaces serviceinterfaces add service interface serviceinterface service interfaces serviceinterfaces map string object get properties getproperties clazz document metadata map string object props hash map hashmap string object string query get component path query getcomponentxpathquery clazz property node list nodelist nodes query nodes querynodes metadata query nodes nodes get length getlength node node nodes item string get attribute value getattributevalue node string get attribute value getattributevalue node string type get attribute value getattributevalue node type string utils stringutils equals integer type props integer parse int parseint string utils stringutils equals type props parse long parselong string utils stringutils equals type props parse boolean parseboolean props query get component path query getcomponentxpathquery clazz property text nodes query nodes querynodes metadata query nodes nodes get length getlength node node nodes item string get attribute value getattributevalue node string string utils stringutils split string utils stringutils trim node get text content gettextcontent length string utils stringutils trim props props list reference get references getreferences clazz document metadata list reference references array list arraylist reference string query get component path query getcomponentxpathquery clazz reference node list nodelist nodes query nodes querynodes metadata query nodes nodes get length getlength node node nodes item references add reference clazz node references string get lifecycle method name getlifecyclemethodname clazz document metadata string method name methodname string query get component path query getcomponentxpathquery clazz node node query node querynode metadata query node get attribute value getattributevalue node method name methodname node list nodelist query nodes querynodes document metadata string xpath query xpathquery x path xpath xpath xpath factory newxpath xpath set name space context setnamespacecontext name space namespace context node list nodelist xpath evaluate xpath query xpathquery metadata x path constants xpathconstants node set nodeset x path expression exception xpathexpressionexception runtime exception runtimeexception error eval uating evaluating x path xpath xpath query xpathquery node query node querynode document metadata string xpath query xpathquery x path xpath xpath xpath factory newxpath xpath set name space context setnamespacecontext name space namespace context node xpath evaluate xpath query xpathquery metadata x path constants xpathconstants node x path expression exception xpathexpressionexception runtime exception runtimeexception error eval uating evaluating x path xpath xpath query xpathquery string get attribute value getattributevalue node node string attribute name attributename node named item nameditem node get attributes getattributes get name d item getnameditem attribute name attributename named item nameditem named item nameditem get node value getnodevalue osgi metadata osgimetadata clazz string service interfaces serviceinterfaces map string object properties list reference references string activate method name activatemethodname string deactivate method name deactivatemethodname string modified method name modifiedmethodname osgi metadata osgimetadata clazz document metadata document metadatadocument clazz clazz service interfaces serviceinterfaces osgi metadata util osgimetadatautil get service interfaces getserviceinterfaces clazz metadata document metadatadocument properties osgi metadata util osgimetadatautil get properties getproperties clazz metadata document metadatadocument references osgi metadata util osgimetadatautil get references getreferences clazz metadata document metadatadocument activate method name activatemethodname osgi metadata util osgimetadatautil get lifecycle method name getlifecyclemethodname clazz metadata document metadatadocument activate deactivate method name deactivatemethodname osgi metadata util osgimetadatautil get lifecycle method name getlifecyclemethodname clazz metadata document metadatadocument deactivate modified method name modifiedmethodname osgi metadata util osgimetadatautil get lifecycle method name getlifecyclemethodname clazz metadata document metadatadocument modified osgi metadata osgimetadata clazz service interfaces serviceinterfaces properties references activate method name activatemethodname deactivate method name deactivatemethodname modified method name modifiedmethodname get service class getserviceclass clazz string get service interfaces getserviceinterfaces service interfaces serviceinterfaces map string object get properties getproperties properties list reference get references getreferences references string get activate method name getactivatemethodname activate method name activatemethodname string get deactivate method name getdeactivatemethodname deactivate method name deactivatemethodname string get modified method name getmodifiedmethodname modified method name modifiedmethodname reference clazz string string interface type interfacetype reference cardinality referencecardinality cardinality reference policy referencepolicy policy reference policy option referencepolicyoption policy option policyoption string bind string unbind string field field collection type fieldcollectiontype field collection type fieldcollectiontype string target filter target filter targetfilter reference clazz node node clazz clazz get attribute value getattributevalue node interface type interfacetype get attribute value getattributevalue node cardinality to cardinality tocardinality get attribute value getattributevalue node cardinality policy to policy topolicy get attribute value getattributevalue node policy policy option policyoption to policy option topolicyoption get attribute value getattributevalue node policy option bind get attribute value getattributevalue node bind unbind get attribute value getattributevalue node unbind field get attribute value getattributevalue node field field collection type fieldcollectiontype to field collection type tofieldcollectiontype get attribute value getattributevalue node field collection type target get attribute value getattributevalue node target string utils stringutils is not empty isnotempty target target filter targetfilter filter impl filterimpl target invalid syntax exception invalidsyntaxexception runtime exception runtimeexception invalid target file t filet reference clazz get name getname target filter targetfilter get service class getserviceclass clazz string get name getname string get interface type getinterfacetype interface type interfacetype get interface type as class getinterfacetypeasclass for name forname get interface type getinterfacetype class not found exception classnotfoundexception runtime exception runtimeexception service reference type get interface type getinterfacetype reference cardinality referencecardinality get cardinality getcardinality cardinality is cardinality multiple iscardinalitymultiple cardinality reference cardinality referencecardinality optional multiple cardinality reference cardinality referencecardinality mandatory multiple is cardinality optional iscardinalityoptional cardinality reference cardinality referencecardinality optional unary cardinality reference cardinality referencecardinality optional multiple reference policy referencepolicy get policy getpolicy policy reference policy option referencepolicyoption get policy option getpolicyoption policy option policyoption string get bind getbind bind string get unbind getunbind unbind string get field getfield field string get target gettarget target matches target filter matchestargetfilter service reference servicereference service reference servicereference target filter targetfilter target filter targetfilter match service reference servicereference field collection type fieldcollectiontype get field collection type getfieldcollectiontype field collection type fieldcollectiontype reference cardinality referencecardinality to cardinality tocardinality string reference cardinality referencecardinality item reference cardinality referencecardinality values string utils stringutils equals item get cardinality string getcardinalitystring item reference cardinality referencecardinality mandatory unary reference policy referencepolicy to policy topolicy string reference policy referencepolicy item reference policy referencepolicy values string utils stringutils equals ignore case equalsignorecase item item reference policy referencepolicy reference policy option referencepolicyoption to policy option topolicyoption string reference policy option referencepolicyoption item reference policy option referencepolicyoption values string utils stringutils equals ignore case equalsignorecase item item reference policy option referencepolicyoption reluctant field collection type fieldcollectiontype to field collection type tofieldcollectiontype string field collection type fieldcollectiontype item field collection type fieldcollectiontype values string utils stringutils equals ignore case equalsignorecase item item options link reference cardinality property enum reference cardinality referencecardinality optional unary reference service required reference satisfied single service reference optional unary mandatory unary reference service reference satisfied single service reference mandatory unary optional multiple reference service required reference satisfied matching services reference optional multiple mandatory multiple reference service reference satisfied matching services reference mandatory multiple string cardinality string cardinalitystring reference cardinality referencecardinality string cardinality string cardinalitystring cardinality string cardinalitystring cardinality string cardinalitystring string representation cardinality string get cardinality string getcardinalitystring cardinality string cardinalitystring options link reference policy property enum reference policy referencepolicy component deactivated activated service service component dynamic options link reference policy option policyoption property enum reference policy option referencepolicyoption rel uctant reluctant policy option policy option target service reference references rel uctant reluctant policy option policy dynamic policy unary cardinality ignore target service references dynamic policy multiple cardinality bind target service reluctant target service reference references greedy policy option bind target service greedy options link reference policy option policyoption property enum field collection type fieldcollectiontype bound service object field collection type service service reference bound service reference component service objects bound service service obj ects serviceobjects unmodifiable map service properties bound service map implement comparable properties unmodifiable map entry key unmodifiable map service properties bound service bound service object map entry implement comparable tuple