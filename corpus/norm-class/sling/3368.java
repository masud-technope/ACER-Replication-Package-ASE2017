licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling discovery base org junit assert equals assertequals org junit fail java util iterator java util linked list linkedlist java util list java util random org apache sling discovery base commons undefined cluster view exception undefinedclusterviewexception org apache sling discovery base setup virtual instance virtualinstance org apache sling discovery base setup virtual instance builder virtualinstancebuilder org apache sling discovery base setup with holding appender withholdingappender org apache sling testing tools retry retry loop retryloop org junit org junit test org slf logger org slf logger factory loggerfactory migrated org apache sling discovery impl cluster cluster load test clusterloadtest abstract cluster load test abstractclusterloadtest wait wait int ervals intervals instance view timeout seconds instance view poll interval millis random random random logger logger logger factory loggerfactory get logger getlogger get class getclass list virtual instance virtualinstance instances linked list linkedlist virtual instance virtualinstance tear down teardown exception instances instances size iterator virtual instance virtualinstance instances iterator has next hasnext virtual instance virtualinstance remove virtual instance builder virtualinstancebuilder new builder newbuilder test test framework testframework exception logger info test framework testframework building instance virtual instance builder virtualinstancebuilder builder new builder newbuilder new repository newrepository discovery impl cluster load test clusterloadtest test framework testframework set debug name setdebugname first instance firstinstance set connector ping timeout setconnectorpingtimeout set connector ping interval setconnectorpinginterval set min event delay setmineventdelay virtual instance virtualinstance first instance firstinstance builder build instances add first instance firstinstance thread sleep called isolated mode test first instance firstinstance get cluster view service getclusterviewservice get local cluster view getlocalclusterview fail complain undefined cluster view exception undefinedclusterviewexception first instance firstinstance start view checker startviewchecker thread sleep heartbeat let ting letting set tle settle discovery service established view test first instance firstinstance dump repo dumprepo first instance firstinstance assert established view assertestablishedview virtual instance builder virtualinstancebuilder builder new builder newbuilder use repository of userepositoryof builder set debug name setdebugname second instance secondinstance set connector ping timeout setconnectorpingtimeout set connector ping interval setconnectorpinginterval set min event delay setmineventdelay first instance firstinstance dump repo dumprepo logger info test framework testframework building instance virtual instance virtualinstance second instance secondinstance builder build instances add second instance secondinstance second instance secondinstance start view checker startviewchecker thread sleep first instance firstinstance dump repo dumprepo assert equals assertequals first instance firstinstance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get instances getinstances size assert equals assertequals second instance secondinstance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get instances getinstances size test test two instances testtwoinstances throwable do test dotest test test three instances testthreeinstances throwable do test dotest test test four instances testfourinstances throwable do test dotest test test five instances testfiveinstances throwable do test dotest test test six instances testsixinstances throwable do test dotest test test seven instances testseveninstances throwable do test dotest test test eight instances testeightinstances throwable do test dotest do test dotest size loop cnt loopcnt throwable with holding appender withholdingappender with holding appender withholdingappender failure logger info do test dotest size loop cnt loopcnt muting log output with holding appender withholdingappender with holding appender withholdingappender install do do test dodotest size loop cnt loopcnt failure with holding appender withholdingappender failure logger info do test dotest size loop cnt loopcnt writing muted log output failure with holding appender withholdingappender release failure failure logger info do test dotest size loop cnt loopcnt writing muted log output success logger info do test dotest size loop cnt loopcnt unmuted log output do do test dodotest size loop cnt loopcnt throwable size fail test instances virtual instance builder virtualinstancebuilder builder new builder newbuilder new repository newrepository discovery impl cluster load test clusterloadtest do test dotest size loop cnt loopcnt set debug name setdebugname first instance firstinstance size loop cnt loopcnt set connector ping timeout setconnectorpingtimeout set connector ping interval setconnectorpinginterval set min event delay setmineventdelay virtual instance virtualinstance first instance firstinstance builder build first instance firstinstance start view checker startviewchecker instances add first instance firstinstance size virtual instance builder virtualinstancebuilder builder new builder newbuilder use repository of userepositoryof builder set debug name setdebugname subsequent instance subsequentinstance size loop cnt loopcnt set connector ping timeout setconnectorpingtimeout set min event delay setmineventdelay set connector ping interval setconnectorpinginterval virtual instance virtualinstance subsequent instance subsequentinstance builder build instances add subsequent instance subsequentinstance subsequent instance subsequentinstance start view checker startviewchecker loop cnt loopcnt logger info logger info start loop logger info count instances heartbeats running place alive cnt alivecnt iterator virtual instance virtualinstance instances iterator has next hasnext virtual instance virtualinstance instance instance is view checker running isviewcheckerrunning alive cnt alivecnt logger info logger info original alive cnt alivecnt alive cnt alivecnt logger info alive cnt alivecnt sending heartbeats instances isolated mode alive cnt alivecnt alive cnt final alivecntfinal alive cnt alivecnt iterator virtual instance virtualinstance instances iterator has next hasnext virtual instance virtualinstance instance instance dump repo dumprepo exception logger error failed dumping repo instance instance get sling id getslingid verify instance sees instances iterator virtual instance virtualinstance instances iterator has next hasnext virtual instance virtualinstance instance instance is view checker running isviewcheckerrunning heartbeat running instance considered dead count valid heartbeat check view checkview running test retry loop retryloop condition implementation conditionimplementation instance alive cnt final alivecntfinal instance view timeout seconds instance view poll interval millis start heartbeats logger info starting stopping heartbeats count instances size iterator virtual instance virtualinstance instances iterator has next hasnext virtual instance virtualinstance instance random next boolean nextboolean logger info starting heartbeats instance sling id slingid instance start view checker startviewchecker logger info started heartbeats instance sling id slingid logger info stopping heartbeats instance sling id slingid instance stop view checker stopviewchecker logger info stopped heartbeats instance sling id slingid condition implementation conditionimplementation retry loop retryloop condition expected alive count expectedalivecount virtual instance virtualinstance instance condition implementation conditionimplementation virtual instance virtualinstance instance expected alive count expectedalivecount expected alive count expectedalivecount expected alive count expectedalivecount instance instance is true istrue exception result actual alive count actualalivecount actual alive count actualalivecount instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get instances getinstances size result expected alive count expectedalivecount actual alive count actualalivecount undefined cluster view exception undefinedclusterviewexception logger info view moment exception logger error is true istrue exception result logger info is true istrue expected expected alive count expectedalivecount actual actual alive count actualalivecount result result result string get description getdescription waiting instance instance get sling id getslingid expected alive count expectedalivecount instances