licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling event impl jobs config java util array list arraylist java util collections java util comparator java util hash map hashmap java util list java util map java util tree map treemap org apache sling discovery instance description instancedescription org apache sling discovery topology view topologyview org apache sling event impl jobs config queue configuration manager queueconfigurationmanager queue info queueinfo org apache sling event impl support environment org apache sling event jobs queue configuration queueconfiguration org slf logger org slf logger factory loggerfactory capabilities topology topology capabilities topologycapabilities string property topics org apache sling event jobs consumer topics logger logger logger logger factory loggerfactory get logger getlogger get class getclass map key topic sling id s ids map string list instance description instancedescription instance capabilities instancecapabilities robin map map string integer round robin map roundrobinmap hash map hashmap string integer instance map map string instance description instancedescription instance map instancemap hash map hashmap string instance description instancedescription leader cluster is leader isleader active active instances map string string all instances allinstances instance comparator instance description comparator instancedescriptioncomparator instance comparator instancecomparator job manager configuration jobmanagerconfiguration job manager configuration jobmanagerconfiguration job manager configuration jobmanagerconfiguration topology view topology view topologyview view instance description comparator instancedescriptioncomparator comparator instance description instancedescription string local cluster id localclusterid instance description comparator instancedescriptioncomparator string cluster id clusterid local cluster id localclusterid cluster id clusterid override compare instance description instancedescription instance description instancedescription get sling id getslingid equals get sling id getslingid is local cluster islocalcluster local cluster id localclusterid equals get cluster view getclusterview get id getid is local cluster islocalcluster local cluster id localclusterid equals get cluster view getclusterview get id getid is local cluster islocalcluster is local cluster islocalcluster is local cluster islocalcluster is local cluster islocalcluster is local cluster islocalcluster is leader isleader is leader isleader is leader isleader is leader isleader get sling id getslingid compare to compareto get sling id getslingid map string string get all instances map getallinstancesmap topology view topologyview view map string string all instances allinstances tree map treemap string string instance description instancedescription desc view get instances getinstances string topics desc get property getproperty property topics topics topics length all instances allinstances desc get sling id getslingid topics all instances allinstances desc get sling id getslingid all instances allinstances create instance param view view param config current job manager configuration topology capabilities topologycapabilities topology view topologyview view job manager configuration jobmanagerconfiguration config job manager configuration jobmanagerconfiguration config instance comparator instancecomparator instance description comparator instancedescriptioncomparator view get local instance getlocalinstance get cluster view getclusterview get id getid is leader isleader view get local instance getlocalinstance is leader isleader all instances allinstances get all instances map getallinstancesmap view map string list instance description instancedescription new caps newcaps hash map hashmap string list instance description instancedescription instance description instancedescription desc view get instances getinstances string topics desc get property getproperty property topics topics topics length logger debug detected capabilities desc get sling id getslingid topics string topic topics split list instance description instancedescription list new caps newcaps topic list list array list arraylist instance description instancedescription new caps newcaps topic list list add desc collections sort list instance comparator instancecomparator instance map instancemap desc get sling id getslingid desc instance capabilities instancecapabilities new caps newcaps view view capabilities represented instance map param new all instances map newallinstancesmap instance map code represent is same issame map string string new all instances map newallinstancesmap all instances allinstances equals new all instances map newallinstancesmap deactivate object deactivate active object active active code active is active isactive active job manager configuration jobmanagerconfiguration is active isactive view is current iscurrent instance active param instance id instanceid instance code instance active is active isactive string instance id instanceid all instances allinstances contains key containskey instance id instanceid current instance leader is leader isleader is leader isleader add instances list included add all addall list instance description instancedescription potential targets potentialtargets list instance description instancedescription new targets newtargets new targets newtargets instance description instancedescription desc new targets newtargets instance description instancedescription existing desc existingdesc potential targets potentialtargets desc get sling id getslingid equals existing desc existingdesc get sling id getslingid potential targets potentialtargets add desc potential targets sling id s ids sorted list instance descriptions list empty list instance description instancedescription get potential targets getpotentialtargets string job topic jobtopic calculate potential targets list instance description instancedescription potential targets potentialtargets array list arraylist instance description instancedescription topic targets handling topic add all addall potential targets potentialtargets instance capabilities instancecapabilities job topic jobtopic category targets handling topic category pos job topic jobtopic last index of lastindexof pos string category job topic jobtopic substring pos concat add all addall potential targets potentialtargets instance capabilities instancecapabilities category search deep consume rs consumers consumer string sub category subcategory job topic jobtopic substring pos concat add all addall potential targets potentialtargets instance capabilities instancecapabilities sub category subcategory pos job topic jobtopic last index of lastindexof pos pos collections sort potential targets potentialtargets instance comparator instancecomparator potential targets potentialtargets detect target instance string detect target detecttarget string job topic jobtopic map string object job properties jobproperties queue info queueinfo queue info queueinfo list instance description instancedescription potential targets potentialtargets get potential targets getpotentialtargets job topic jobtopic logger debug potential targets job topic jobtopic potential targets potentialtargets string created on createdon job properties jobproperties created on createdon string job properties jobproperties org apache sling event jobs job property job created instance created on createdon created on createdon environment application instance description instancedescription created on instance createdoninstance instance map instancemap created on createdon potential targets potentialtargets potential targets potentialtargets size created on instance createdoninstance create list local targets list instance description instancedescription local targets localtargets array list arraylist instance description instancedescription instance description instancedescription desc potential targets potentialtargets desc get cluster view getclusterview get id getid equals created on instance createdoninstance get cluster view getclusterview get id getid job manager configuration jobmanagerconfiguration disable distribution disabledistribution desc is leader isleader local targets localtargets add desc local targets localtargets size potential targets potentialtargets clear potential targets potentialtargets add all addall local targets localtargets logger debug potential targets filtered job topic jobtopic potential targets potentialtargets check prefer creation instance queue info queueinfo queue configuration queueconfiguration is prefer run on creation instance ispreferrunoncreationinstance instance description instancedescription creation desc creationdesc instance description instancedescription desc potential targets potentialtargets desc get sling id getslingid equals created on createdon creation desc creationdesc desc creation desc creationdesc potential targets potentialtargets clear potential targets potentialtargets add creation desc creationdesc logger debug potential targets reduced creation instance job topic jobtopic potential targets potentialtargets queue info queueinfo queue configuration queueconfiguration get type gettype queue configuration queueconfiguration type ordered ordered queues pick pick target cluster view instances todo robin queue string result potential targets potentialtargets get sling id getslingid logger debug target job topic jobtopic result result todo simple robin based actual load instances integer round robin map roundrobinmap job topic jobtopic potential targets potentialtargets size round robin map roundrobinmap job topic jobtopic string result potential targets potentialtargets get sling id getslingid logger debug target job topic jobtopic result result instance capabilities map instance capabilities map string list instance description instancedescription get instance capabilities getinstancecapabilities instance capabilities instancecapabilities