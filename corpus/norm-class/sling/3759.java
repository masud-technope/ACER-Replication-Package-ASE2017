licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling event impl jobs config org junit assert equals assertequals org junit assert false assertfalse org junit assert true asserttrue java serializable java util array list arraylist java util collections java util java util list java util map java util no such element exception nosuchelementexception java util timer java util timer task timertask java util concurrent count down latch countdownlatch java util concurrent time unit timeunit java util concurrent atomic atomic boolean atomicboolean org apache sling commons scheduler schedule options scheduleoptions org apache sling commons scheduler scheduler org apache sling discovery cluster view clusterview org apache sling discovery instance description instancedescription org apache sling discovery topology event topologyevent org apache sling discovery topology view topologyview org junit test org mockito mockito junit x junitx util private accessor privateaccessor job manager configuration test jobmanagerconfigurationtest topology view topologyview create view createview topology view topologyview view mockito mock topology view topologyview mockito view is current iscurrent then return thenreturn instance description instancedescription local mockito mock instance description instancedescription mockito local is leader isleader then return thenreturn mockito local is local islocal then return thenreturn mockito local get sling id getslingid then return thenreturn mockito view get local instance getlocalinstance then return thenreturn local cluster view clusterview local view localview mockito mock cluster view clusterview mockito local view localview get id getid then return thenreturn mockito local view localview get instances getinstances then return thenreturn collections singleton list singletonlist local mockito view get cluster views getclusterviews then return thenreturn collections singleton local view localview mockito local get cluster view getclusterview then return thenreturn local view localview view change listener changelistener configuration change listener configurationchangelistener list events array list arraylist count down latch countdownlatch latch init count events clear latch count down latch countdownlatch count await exception latch await time unit timeunit milliseconds exception configuration event seconds override configuration changed configurationchanged active events add active latch count down countdown scheduler create scheduler createscheduler scheduler override unschedule string job name jobname todo auto generated method stub override schedule object job schedule options scheduleoptions options job runnable timer timer schedule timer task timertask override runnable job override remove job removejob string no such element exception nosuchelementexception todo auto generated method stub override fire job at firejobat string object job map string serializable config times period todo auto generated method stub override fire job at firejobat string object job map string serializable config exception todo auto generated method stub override fire job firejob object job map string serializable config times period todo auto generated method stub override fire job firejob object job map string serializable config exception todo auto generated method stub override add per iodic job addperiodicjob string object job map string serializable config period can run concurrently canrunconcurrently start immediate startimmediate exception todo auto generated method stub override add per iodic job addperiodicjob string object job map string serializable config period can run concurrently canrunconcurrently exception todo auto generated method stub override add job addjob string object job map string serializable config string scheduling expression schedulingexpression can run concurrently canrunconcurrently exception todo auto generated method stub override schedule options scheduleoptions times period todo auto generated method stub override schedule options scheduleoptions todo auto generated method stub override schedule options scheduleoptions expr string expression todo auto generated method stub override schedule options scheduleoptions times period todo auto generated method stub override schedule options scheduleoptions todo auto generated method stub test test topology change testtopologychange exception mock scheduler scheduler scheduler create scheduler createscheduler change listener changelistener ccl change listener changelistener add change listener verify ccl init job manager configuration jobmanagerconfiguration config job manager configuration jobmanagerconfiguration private accessor privateaccessor set field setfield config scheduler scheduler atomic boolean atomicboolean private accessor privateaccessor get field getfield config active config add listener addlistener ccl ccl await assert equals assertequals ccl events size assert false assertfalse ccl events create init view ccl init topology view topologyview init view initview create view createview topology event topologyevent init topology event topologyevent topology event topologyevent type topology init init view initview config handle topology event handletopologyevent init ccl await assert equals assertequals ccl events size assert true asserttrue ccl events change view change props ccl init topology view topologyview view create view createview mockito init view initview is current iscurrent then return thenreturn topology event topologyevent change topology event topologyevent topology event topologyevent type topology changed init view initview view topology view topologyview view create view createview topology event topologyevent change topology event topologyevent topology event topologyevent type properties changed view view config handle topology event handletopologyevent change mockito view is current iscurrent then return thenreturn config handle topology event handletopologyevent change ccl await assert equals assertequals ccl events size assert false assertfalse ccl events assert false assertfalse ccl events assert true asserttrue ccl events wait secs event thread sleep assert equals assertequals ccl events size