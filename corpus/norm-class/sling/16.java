licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling discovery commons providers base java util linked list linkedlist java util list org apache sling discovery topology event topologyevent org apache sling discovery topology event listener topologyeventlistener org slf logger org slf logger factory loggerfactory sling background runnable takes care async hronously asynchronously sending events api enqueue puts listener event tuple internal processed loop uninterruptably cat ching catching throw ables throwables safe sleeps error flush then stop flushthenstop called puts sender pending events flush stops automatically argument flush event originally meant bundle stopped bundle stopped doesn undo event listeners receive topology event deactivate guess change asynchronous async event sender asynceventsender runnable logger logger logger factory loggerfactory get logger getlogger async event sender asynceventsender stopped flush then stop flushthenstop called stopped event q eventq async event asyncevent objects order list async event asyncevent event q eventq linked list linkedlist async event asyncevent flag track event is sending issending enqueues event asynchronous sending listener enqueue topology event listener topologyeventlistener listener topology event topologyevent event async topology event asynctopologyevent async event asyncevent async topology event asynctopologyevent listener event enqueue async event asyncevent enqueues async event asyncevent order execution enqueue async event asyncevent async event asyncevent event q eventq event q eventq add async event asyncevent logger is debug enabled isdebugenabled logger debug enqueue enqueue d enqueued event async sending size async event asyncevent event q eventq size event q eventq notify all notifyall s tops stops async event sender asynceventsender queue empty flush then stop flushthenstop event q eventq logger info async event sender asynceventsender flush then stop flushthenstop flushing size stop ping stopping event q eventq size stopped event q eventq notify all notifyall main worker loop dequeues event q eventq calls send topology event sendtopologyevent logger info async event sender asynceventsender started async event asyncevent async event asyncevent event q eventq is sending issending stopped event q eventq is empty isempty event q eventq wait interrupted exception interruptedexception logger debug async event sender asynceventsender int errupted interrupted waiting async events stopped event q eventq is empty isempty flushed logger info async event sender asynceventsender flush finished stopped event q eventq empty flush mode logger info async event sender asynceventsender flushing event pending event q eventq size async event asyncevent event q eventq remove logger is debug enabled isdebugenabled logger debug async event sender asynceventsender dequeued event remaining async event asyncevent event q eventq size is sending issending async event asyncevent async event asyncevent async event asyncevent trigger throwable logger error async event sender asynceventsender throwable occurred sleeping throwable thread sleep interrupted exception interruptedexception logger warn async event sender asynceventsender int errupted interrupted sleeping logger info async event sender asynceventsender quits testing checks events queue d queued has in flight event hasinflightevent event q eventq is sending issending event q eventq is empty isempty get in flight event cnt getinflighteventcnt event q eventq cnt event q eventq size is sending issending cnt cnt