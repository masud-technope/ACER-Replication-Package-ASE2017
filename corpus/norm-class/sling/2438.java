licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling ide impl vlt org apache sling ide transport repository command execution flag commandexecutionflag create missing org hamcrest core matchers corematchers equal to equalto org junit assert that assertthat java file java io exception ioexception java input stream inputstream java input stream reader inputstreamreader java util concurrent callable javax jcr credentials javax jcr node javax jcr property javax jcr repository javax jcr repository exception repositoryexception javax jcr session javax jcr simple credentials simplecredentials javax jcr unsupported repository operation exception unsupportedrepositoryoperationexception javax jcr javax jcr node type nodetype invalid node type definition exception invalidnodetypedefinitionexception javax jcr node type nodetype node type nodetype javax jcr node type nodetype node type exists exception nodetypeexistsexception org apache jackrabbit commons cnd cnd importer cndimporter org apache jackrabbit commons cnd parse exception parseexception org apache jackrabbit core transient repository transientrepository org apache sling ide filter filter org apache sling ide filter filter result filterresult org apache sling ide log logger org apache sling ide transport command context commandcontext org apache sling ide transport resource proxy resourceproxy org junit ignore org junit test add or update node command test addorupdatenodecommandtest command context commandcontext context command context commandcontext filter override filter result filterresult filter string repository path repositorypath filter result filterresult string prop jcr title logger logger slf j logger jlogger test set property setproperty exception do property change test dopropertychangetest title do property change test dopropertychangetest object initial property values initialpropertyvalues object new property values newpropertyvalues exception do with transient repository dowithtransientrepository callable with session callablewithsession override call exception node content node contentnode session get root node getrootnode add node addnode content initial property values initialpropertyvalues string content node contentnode set property setproperty prop string initial property values initialpropertyvalues initial property values initialpropertyvalues string content node contentnode set property setproperty prop string initial property values initialpropertyvalues session save resource proxy resourceproxy resource new resource newresource content node type nodetype unstructured new property values newpropertyvalues resource add property addproperty prop new property values newpropertyvalues add or update node command addorupdatenodecommand cmd add or update node command addorupdatenodecommand repo credentials context resource logger cmd execute session refresh new property values newpropertyvalues assert that assertthat session get node getnode content has property hasproperty prop equal to equalto property new prop newprop session get node getnode content get property getproperty prop new property values newpropertyvalues string assert that assertthat property is multiple ismultiple new prop newprop is multiple ismultiple equal to equalto assert that assertthat new prop newprop get string getstring equal to equalto string new property values newpropertyvalues string expected values expectedvalues string new property values newpropertyvalues assert that assertthat property is multiple ismultiple new prop newprop is multiple ismultiple equal to equalto values session get node getnode content get property getproperty prop get values getvalues assert that assertthat values length equal to equalto expected values expectedvalues length values length assert that assertthat values get string getstring equal to equalto expected values expectedvalues test remove property removeproperty exception do property change test dopropertychangetest title test single property to multi value d singlepropertytomultivalued exception do property change test dopropertychangetest title string title title test multi values property to single multivaluespropertytosingle exception do property change test dopropertychangetest string title title title test change nt folder to sling folder with added property changentfoldertoslingfolderwithaddedproperty exception do with transient repository dowithtransientrepository callable with session callablewithsession override call exception session get root node getrootnode add node addnode content folder session save resource proxy resourceproxy resource new resource newresource content sling folder resource get properties getproperties new property newproperty add or update node command addorupdatenodecommand cmd add or update node command addorupdatenodecommand repo credentials context resource logger cmd execute session refresh node content session get root node getrootnode get node getnode content assert that assertthat content get primary node type getprimarynodetype get name getname equal to equalto sling folder test change sling folder to nt folder with existing property changeslingfoldertontfolderwithexistingproperty exception do with transient repository dowithtransientrepository callable with session callablewithsession override call exception node content session get root node getrootnode add node addnode content sling folder content set property setproperty new property newproperty session save resource proxy resourceproxy resource new resource newresource content folder add or update node command addorupdatenodecommand cmd add or update node command addorupdatenodecommand repo credentials context resource logger cmd execute session refresh content session get root node getrootnode get node getnode content assert that assertthat content get primary node type getprimarynodetype get name getname equal to equalto folder test ignore sling update nt unstructured to node with required property updatentunstructuredtonodewithrequiredproperty exception do with transient repository dowithtransientrepository callable with session callablewithsession override call exception node content session get root node getrootnode add node addnode content unstructured session save resource proxy resourceproxy resource new resource newresource content custom resource get properties getproperties attribute add or update node command addorupdatenodecommand cmd add or update node command addorupdatenodecommand repo credentials context resource logger cmd execute session refresh content session get root node getrootnode get node getnode content assert that assertthat content get primary node type getprimarynodetype get name getname equal to equalto custom test node not present but out side of filter is not removed nodenotpresentbutoutsideoffilterisnotremoved exception command context commandcontext context command context commandcontext filter override filter result filterresult filter string repository path repositorypath repository path repositorypath equals content included child filter result filterresult deny filter result filterresult do with transient repository dowithtransientrepository callable with session callablewithsession override call exception node content session get root node getrootnode add node addnode content unstructured content add node addnode included child content add node addnode included child session save resource proxy resourceproxy resource new resource newresource content unstructured resource add child addchild new resource newresource content included child unstructured add or update node command addorupdatenodecommand cmd add or update node command addorupdatenodecommand repo credentials context resource logger cmd execute session refresh content session get root node getrootnode get node getnode content content get node getnode included child content get node getnode included child resource proxy resourceproxy new resource newresource string path string primary type primarytype resource proxy resourceproxy resource resource proxy resourceproxy path resource add property addproperty jcr primary type primarytype primary type primarytype resource test create if required flag skips existing resources createifrequiredflagskipsexistingresources exception do with transient repository dowithtransientrepository callable with session callablewithsession override call exception node content session get root node getrootnode add node addnode content folder session save resource proxy resourceproxy resource new resource newresource content unstructured add or update node command addorupdatenodecommand cmd add or update node command addorupdatenodecommand repo credentials context resource logger create missing cmd execute session refresh content session get root node getrootnode get node getnode content assert that assertthat content get primary node type getprimarynodetype get name getname equal to equalto folder test create if required flag creates needed resources createifrequiredflagcreatesneededresources exception do with transient repository dowithtransientrepository callable with session callablewithsession override call exception resource proxy resourceproxy resource new resource newresource content unstructured add or update node command addorupdatenodecommand cmd add or update node command addorupdatenodecommand repo credentials context resource logger create missing cmd execute session refresh node content session get root node getrootnode get node getnode content assert that assertthat content get primary node type getprimarynodetype get name getname equal to equalto unstructured test create if required flag creates needed resources even when primary type is missing createifrequiredflagcreatesneededresourcesevenwhenprimarytypeismissing exception do with transient repository dowithtransientrepository callable with session callablewithsession override call exception resource proxy resourceproxy resource resource proxy resourceproxy content add or update node command addorupdatenodecommand cmd add or update node command addorupdatenodecommand repo credentials context resource logger create missing cmd execute session refresh node content session get root node getrootnode get node getnode content assert that assertthat content get primary node type getprimarynodetype get name getname equal to equalto unstructured test auto created properties are not removed autocreatedpropertiesarenotremoved exception do with transient repository dowithtransientrepository callable with session callablewithsession override call exception node content session get root node getrootnode add node addnode content folder session save resource proxy resourceproxy resource new resource newresource content folder resource add property addproperty jcr mixin types mixintypes mix last modified lastmodified add or update node command addorupdatenodecommand cmd add or update node command addorupdatenodecommand repo credentials context resource logger cmd execute time mixins processed properties cmd execute executions expose problem session refresh content session get root node getrootnode get node getnode content assert that assertthat jcr last modified lastmodified property content has property hasproperty jcr last modified lastmodified equal to equalto assert that assertthat jcr last modified by lastmodifiedby property content has property hasproperty jcr last modified by lastmodifiedby equal to equalto test auto created properties are updated if present autocreatedpropertiesareupdatedifpresent exception do with transient repository dowithtransientrepository callable with session callablewithsession override call exception node content session get root node getrootnode add node addnode content folder session save resource proxy resourceproxy resource new resource newresource content folder resource add property addproperty jcr mixin types mixintypes mix last modified lastmodified resource add property addproperty jcr last modified by lastmodifiedby admin add or update node command addorupdatenodecommand cmd add or update node command addorupdatenodecommand repo credentials context resource logger cmd execute time mixins processed properties cmd execute executions expose problem session refresh content session get root node getrootnode get node getnode content assert that assertthat jcr last modified by lastmodifiedby property modified content get property getproperty jcr last modified by lastmodifiedby get string getstring equal to equalto admin do with transient repository dowithtransientrepository callable with session callablewithsession call able callable exception file file file target jackrabbit transient repository transientrepository repo transient repository transientrepository file repository xml file repository simple credentials simplecredentials credentials simple credentials simplecredentials admin admin to char array tochararray session session repo login credentials import node type definitions importnodetypedefinitions session test definitions cnd import node type definitions importnodetypedefinitions session folder cnd call able callable set credentials setcredentials credentials call able callable set session setsession session call able callable call session item exists itemexists content session remove item removeitem content session save session log out logout import node type definitions importnodetypedefinitions session session string cnd file cndfile invalid node type definition exception invalidnodetypedefinitionexception node type exists exception nodetypeexistsexception unsupported repository operation exception unsupportedrepositoryoperationexception parse exception parseexception repository exception repositoryexception io exception ioexception input stream inputstream cnd input cndinput get class getclass get resource as stream getresourceasstream cnd file cndfile cnd input cndinput illegal argument exception illegalargumentexception unable read classpath resource cnd file cndfile cnd importer cndimporter register node types registernodetypes input stream reader inputstreamreader cnd input cndinput session callable with session callablewithsession callable session session credentials credentials set session setsession session session session session set credentials setcredentials credentials credentials credentials credentials session session session illegal state exception illegalstateexception session session credentials credentials credentials illegal state exception illegalstateexception credentials credentials repository repo session get repository getrepository