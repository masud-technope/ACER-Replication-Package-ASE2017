licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license sandroboehme jsnodetypes down load default binary downloaddefaultbinary org mockito matchers any int anyint org mockito mockito mock org mockito mockito org mockito mockito verify org mockito mockito java byte array output stream bytearrayoutputstream java i o exception ioexception java print writer printwriter javax jcr node javax jcr repository exception repositoryexception javax jcr session javax jcr value format exception valueformatexception javax jcr workspace javax jcr node type nodetype no such node type exception nosuchnodetypeexception javax jcr node type nodetype node type nodetype javax jcr node type nodetype node type manager nodetypemanager javax jcr node type nodetype property definition propertydefinition javax servlet servlet exception servletexception javax servlet http http servlet response httpservletresponse org apache sling api sling http servlet request slinghttpservletrequest org apache sling api sling http servlet response slinghttpservletresponse org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling api servlets http constants httpconstants org apache sling commons node types nodetypes down load default binary downloaddefaultbinary down load default binary value servlet downloaddefaultbinaryvalueservlet org junit org junit org junit test sandroboehme jsnodetypes generation constants generationconstants sandroboehme jsnodetypes mock mock property def generator mockpropertydefgenerator tests down load default binary value servlet downloaddefaultbinaryvalueservlet down load default binary value test downloaddefaultbinaryvaluetest mock classes sling http servlet request slinghttpservletrequest request sling http servlet response slinghttpservletresponse response resource resource node root node rootnode session session workspace workspace node type manager nodetypemanager nt manager ntmanager byte array output stream bytearrayoutputstream out stream outstream resource resolver resourceresolver resource resolver resourceresolver mock property def generator mockpropertydefgenerator prop def generator propdefgenerator set up setup repository exception repositoryexception i o exception ioexception create mocks request mock sling http servlet request slinghttpservletrequest response mock sling http servlet response slinghttpservletresponse resource resolver resourceresolver mock resource resolver resourceresolver resource mock resource root node rootnode mock node session mock session workspace mock workspace nt manager ntmanager mock node type manager nodetypemanager out stream outstream byte array output stream bytearrayoutputstream stub bin g stubbing request get method getmethod then return thenreturn http constants httpconstants method request get resource resolver getresourceresolver then return thenreturn resource resolver resourceresolver resource resolver resourceresolver get resource getresource then return thenreturn resource resource adapt to adaptto node then return thenreturn root node rootnode root node rootnode get session getsession then return thenreturn session session get workspace getworkspace then return thenreturn workspace workspace get node type manager getnodetypemanager then return thenreturn nt manager ntmanager response get writer getwriter then return thenreturn print writer printwriter out stream outstream prop def generator propdefgenerator mock property def generator mockpropertydefgenerator invoke servlet with different property defs invokeservletwithdifferentpropertydefs no such node type exception nosuchnodetypeexception repository exception repositoryexception value format exception valueformatexception servlet exception servletexception i o exception ioexception node type nodetype node type nodetype mock node type nodetype nt manager ntmanager get node type getnodetype nt name ntname then return thenreturn node type nodetype property definition propertydefinition prop defs propdefs prop def generator propdefgenerator get different property definitions getdifferentpropertydefinitions node type nodetype get property definitions getpropertydefinitions then return thenreturn prop defs propdefs down load default binary value servlet downloaddefaultbinaryvalueservlet download servlet downloadservlet down load default binary value servlet downloaddefaultbinaryvalueservlet download servlet downloadservlet service request response invoke servlet with equal property defs invokeservletwithequalpropertydefs no such node type exception nosuchnodetypeexception repository exception repositoryexception value format exception valueformatexception servlet exception servletexception i o exception ioexception node type nodetype node type nodetype mock node type nodetype nt manager ntmanager get node type getnodetype nt name ntname then return thenreturn node type nodetype property definition propertydefinition prop defs propdefs prop def generator propdefgenerator get equal property definitions getequalpropertydefinitions node type nodetype get property definitions getpropertydefinitions then return thenreturn prop defs propdefs down load default binary value servlet downloaddefaultbinaryvalueservlet download servlet downloadservlet down load default binary value servlet downloaddefaultbinaryvalueservlet download servlet downloadservlet service request response test test successful single match with index testsuccessfulsinglematchwithindex servlet exception servletexception i o exception ioexception no such node type exception nosuchnodetypeexception repository exception repositoryexception request getrequesturi then return thenreturn nt name ntname bin prop def binpropdef binary version binary bin invoke servlet with different property defs invokeservletwithdifferentpropertydefs verify response send error senderror any int anyint assert equals assertequals generation constants generationconstants binary string out stream outstream to byte array tobytearray test test successful single match without index testsuccessfulsinglematchwithoutindex servlet exception servletexception i o exception ioexception no such node type exception nosuchnodetypeexception repository exception repositoryexception request getrequesturi then return thenreturn nt name ntname bin prop def binpropdef binary version binary bin invoke servlet with different property defs invokeservletwithdifferentpropertydefs verify response send error senderror any int anyint assert equals assertequals generation constants generationconstants binary string out stream outstream to byte array tobytearray test test successful short ened single match without index testsuccessfulshortenedsinglematchwithoutindex servlet exception servletexception i o exception ioexception no such node type exception nosuchnodetypeexception repository exception repositoryexception request getrequesturi then return thenreturn nt name ntname bin prop def binpropdef binary binary bin test different property defs with expected binary testdifferentpropertydefswithexpectedbinary request getrequesturi then return thenreturn nt name ntname bin prop def binpropdef binary binary bin test different property defs with expected binary testdifferentpropertydefswithexpectedbinary request getrequesturi then return thenreturn nt name ntname bin prop def binpropdef binary binary bin test different property defs with expected binary testdifferentpropertydefswithexpectedbinary request getrequesturi then return thenreturn nt name ntname bin prop def binpropdef binary bin test different property defs with expected binary testdifferentpropertydefswithexpectedbinary request getrequesturi then return thenreturn nt name ntname bin prop def binpropdef binary bin test different property defs with expected binary testdifferentpropertydefswithexpectedbinary test different property defs with expected binary testdifferentpropertydefswithexpectedbinary no such node type exception nosuchnodetypeexception repository exception repositoryexception value format exception valueformatexception servlet exception servletexception i o exception ioexception invoke servlet with different property defs invokeservletwithdifferentpropertydefs verify response send error senderror any int anyint assert equals assertequals generation constants generationconstants binary string out stream outstream to byte array tobytearray test test successful single match with invalid index testsuccessfulsinglematchwithinvalidindex servlet exception servletexception i o exception ioexception no such node type exception nosuchnodetypeexception repository exception repositoryexception request getrequesturi then return thenreturn nt name ntname bin prop def binpropdef binary version binary bin invoke servlet with different property defs invokeservletwithdifferentpropertydefs verify response send error senderror http servlet response httpservletresponse test test unsuccessful multiple matches testunsuccessfulmultiplematches servlet exception servletexception i o exception ioexception no such node type exception nosuchnodetypeexception repository exception repositoryexception request getrequesturi then return thenreturn nt name ntname bin prop def binpropdef binary version binary bin invoke servlet with equal property defs invokeservletwithequalpropertydefs verify response send error senderror http servlet response httpservletresponse test test unsuccessful no matches testunsuccessfulnomatches servlet exception servletexception i o exception ioexception no such node type exception nosuchnodetypeexception repository exception repositoryexception request getrequesturi then return thenreturn nt name ntname bin prop def binpropdef binary ignore binary bin invoke servlet with different property defs invokeservletwithdifferentpropertydefs verify response send error senderror http servlet response httpservletresponse