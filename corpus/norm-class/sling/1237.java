licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling resource resolver resourceresolver impl java lang reference queue referencequeue java lang weak reference weakreference java util array list arraylist java util collections java util hash map hashmap java util iterator java util list java util map java util stack java util concurrent concurrent hash map concurrenthashmap java util concurrent atomic atomic boolean atomicboolean org apache commons collect ions collections bidi map bidimap org apache sling api resource login exception loginexception org apache sling api resource resource resolver resourceresolver org apache sling api resource resource resolver factory resourceresolverfactory org apache sling resource resolver resourceresolver impl console resource resolver web console plugin resourceresolverwebconsoleplugin org apache sling resource resolver resourceresolver impl helper resource decorator tracker resourcedecoratortracker org apache sling resource resolver resourceresolver impl helper resource resolver context resourceresolvercontext org apache sling resource resolver resourceresolver impl mapping map configuration provider mapconfigurationprovider org apache sling resource resolver resourceresolver impl mapping map entries mapentries org apache sling resource resolver resourceresolver impl mapping mapping org apache sling resource resolver resourceresolver impl providers resource provider tracker resourceprovidertracker org apache sling spi resource provider resource provider resourceprovider org osgi framework bundle context bundlecontext org slf logger org slf logger factory loggerfactory code common resource resolver factory impl commonresourceresolverfactoryimpl code singleton implementing shared common functionality resource resolver factories common resource resolver factory impl commonresourceresolverfactoryimpl resource resolver factory resourceresolverfactory map configuration provider mapconfigurationprovider helper resource resolver map entries mapentries map entries mapentries map entries mapentries empty web console plugin resource resolver web console plugin resourceresolverwebconsoleplugin plugin activator resource resolver factory activator resourceresolverfactoryactivator activator thread local holding resource resolver stack thread local threadlocal stack weak reference weakreference resource resolver resourceresolver resolver stack holder resolverstackholder thread local threadlocal stack weak reference weakreference resource resolver resourceresolver flag indicating factory active atomic boolean atomicboolean is active isactive atomic boolean atomicboolean reference queue handle disposing resource resolver instances reference queue referencequeue resource resolver resourceresolver resolver reference queue resolverreferencequeue reference queue referencequeue resource resolver resourceresolver weak references resource resolver instances map integer resolver weak reference resolverweakreference concurrent hash map concurrenthashmap integer common resource resolver factory impl commonresourceresolverfactoryimpl resolver weak reference resolverweakreference background thread handling disposing resource resolver instances thread ref queue thread refqueuethread log resource resolver closing logresourceresolverclosing create common resource resolver factory common resource resolver factory impl commonresourceresolverfactoryimpl resource resolver factory activator resourceresolverfactoryactivator activator activator activator log resource resolver closing logresourceresolverclosing activator should log resource resolver closing shouldlogresourceresolverclosing ref queue thread refqueuethread thread apache sling resource resolver final izer finalizer thread override is active isactive resolver weak reference resolverweakreference resolver weak reference resolverweakreference resolver reference queue resolverreferencequeue remove close throwable remove context hash code hashcode interrupted exception interruptedexception thread current thread currentthread int errupt interrupt resolver weak reference resolverweakreference values close clear ref queue thread refqueuethread set daemon setdaemon ref queue thread refqueuethread start resource resolver factory org apache sling api resource resource resolver factory resourceresolverfactory get administrative resource resolver getadministrativeresourceresolver java util map override resource resolver resourceresolver get administrative resource resolver getadministrativeresourceresolver map string object passed authentication info passedauthenticationinfo login exception loginexception is active isactive login exception loginexception resource resolver factory resourceresolverfactory deactivated create copy passed authentication info modify map map string object authentication info authenticationinfo hash map hashmap string object authentication info authenticationinfo resource provider resourceprovider admin passed authentication info passedauthenticationinfo authentication info authenticationinfo put all putall passed authentication info passedauthenticationinfo leaking service bundle info props authentication info authenticationinfo remove resource provider resourceprovider service bundle authentication info authenticationinfo remove subservice get resource resolver internal getresourceresolverinternal authentication info authenticationinfo org apache sling api resource resource resolver factory resourceresolverfactory get resource resolver getresourceresolver java util map override resource resolver resourceresolver get resource resolver getresourceresolver map string object passed authentication info passedauthenticationinfo login exception loginexception is active isactive login exception loginexception resource resolver factory resourceresolverfactory deactivated create copy passed authentication info modify map map string object authentication info authenticationinfo hash map hashmap string object passed authentication info passedauthenticationinfo authentication info authenticationinfo put all putall passed authentication info passedauthenticationinfo leaking service bundle info props authentication info authenticationinfo remove resource provider resourceprovider service bundle authentication info authenticationinfo remove subservice resource resolver resourceresolver result get resource resolver internal getresourceresolverinternal authentication info authenticationinfo stack weak reference weakreference resource resolver resourceresolver resolver stack resolverstack resolver stack holder resolverstackholder resolver stack resolverstack resolver stack resolverstack stack weak reference weakreference resource resolver resourceresolver resolver stack holder resolverstackholder resolver stack resolverstack resolver stack resolverstack push weak reference weakreference resource resolver resourceresolver result result org apache sling api resource resource resolver factory resourceresolverfactory get thread resource resolver getthreadresourceresolver override resource resolver resourceresolver get thread resource resolver getthreadresourceresolver is active isactive resource resolver resourceresolver result stack weak reference weakreference resource resolver resourceresolver resolver stack resolverstack resolver stack holder resolverstackholder resolver stack resolverstack result resolver stack resolverstack is empty isempty result resolver stack resolverstack peek result resolver stack resolverstack pop result implementation helpers info rm inform resource resolver instance create weak reference close resolver close resource resolver called param resolver resource resolver param ctx resource resolver context register resource resolver resourceresolver resolver resource resolver context resourceresolvercontext ctx create weak reference ctx hash code hashcode resolver weak reference resolverweakreference resolver resolver reference queue resolverreferencequeue ctx info rm inform closed resource resolver remove current thread context param resource resolver impl resourceresolverimpl resource resolver param ctx resource resolver context unregister resource resolver resourceresolver resource resolver impl resourceresolverimpl resource resolver context resourceresolvercontext ctx close context ctx close remove weak references remove ctx hash code hashcode shutdown factory closed resolve rs resolvers close check thread local threadlocal stack weak reference weakreference resource resolver resourceresolver resolver stack holder resolverstackholder stack weak reference weakreference resource resolver resourceresolver resolver stack resolverstack resolver stack resolverstack iterator weak reference weakreference resource resolver resourceresolver resolver stack resolverstack iterator has next hasnext weak reference weakreference resource resolver resourceresolver resource resolver impl resourceresolverimpl remove resolver stack resolverstack is empty isempty remove create resource resolver resourceresolver param authentication info authenticationinfo authentication map param is admin isadmin admin istrative administrative resolver requested resource resolver login exception loginexception login required resource providers fails resource resolver resourceresolver get resource resolver internal getresourceresolverinternal map string object authentication info authenticationinfo is admin isadmin login exception loginexception is active isactive login exception loginexception resource resolver factory resourceresolverfactory deactivated resource resolver impl resourceresolverimpl is admin isadmin authentication info authenticationinfo map entries mapentries get map entries getmapentries map entries mapentries activates component activate bundle context bundlecontext bundle context bundlecontext logger logger logger factory loggerfactory get logger getlogger get class getclass plugin resource resolver web console plugin resourceresolverwebconsoleplugin bundle context bundlecontext activator get runtime service getruntimeservice throwable ignore logger debug activate unable setup web console plugin ignore map entries configuration map entries mapentries map entries mapentries bundle context bundlecontext activator get event admin geteventadmin exception logger error activate access repository failed setting mapping support deactivates component deactivate is active isactive ref queue thread refqueuethread int errupt interrupt plugin plugin dispose plugin map entries mapentries map entries mapentries dispose map entries mapentries map entries mapentries empty resolver stack holder resolverstackholder resource decorator tracker resourcedecoratortracker get resource decorator tracker getresourcedecoratortracker activator get resource decorator tracker getresourcedecoratortracker string get search path getsearchpath activator get search path getsearchpath is mangle name space prefixes ismanglenamespaceprefixes activator is mangle name space prefixes ismanglenamespaceprefixes override string get map root getmaproot activator get map root getmaproot override mapping get map pings getmappings activator get map pings getmappings override bidi map bidimap getvirtualurlmap activator getvirtualurlmap override get default vanity path redirect status getdefaultvanitypathredirectstatus activator get default vanity path redirect status getdefaultvanitypathredirectstatus service tracker servicetracker resource access security resourceaccesssecurity service resource access security tracker resourceaccesssecuritytracker get resource access security tracker getresourceaccesssecuritytracker activator get resource access security tracker getresourceaccesssecuritytracker override resource resolver resourceresolver get service resource resolver getserviceresourceresolver map string object authentication info authenticationinfo login exception loginexception illegal state exception illegalstateexception method implemented override is vanity path enabled isvanitypathenabled activator is vanity path enabled isvanitypathenabled override get max cached vanity path entries getmaxcachedvanitypathentries activator get max cached vanity path entries getmaxcachedvanitypathentries override is max cached vanity path entries startup ismaxcachedvanitypathentriesstartup activator is max cached vanity path entries startup ismaxcachedvanitypathentriesstartup override get vanity bloom filter max bytes getvanitybloomfiltermaxbytes activator get vanity bloom filter max bytes getvanitybloomfiltermaxbytes override is optimize alias resolution enabled isoptimizealiasresolutionenabled activator is optimize alias resolution enabled isoptimizealiasresolutionenabled override has vanity path precedence hasvanitypathprecedence activator has vanity path precedence hasvanitypathprecedence override list vanity path config vanitypathconfig get vanity path config getvanitypathconfig string includes activator get vanity path white list getvanitypathwhitelist string excludes activator get vanity path black list getvanitypathblacklist includes excludes list vanity path config vanitypathconfig configs array list arraylist vanity path config vanitypathconfig includes string val includes configs add vanity path config vanitypathconfig val excludes string val excludes configs add vanity path config vanitypathconfig val collections sort configs configs factory alive is live islive is active isactive should log resource resolver closing shouldlogresourceresolverclosing log resource resolver closing logresourceresolverclosing resource provider tracker resourceprovidertracker get resource provider tracker getresourceprovidertracker activator get resource provider tracker getresourceprovidertracker extension weak reference context object cleaning resolver weak reference resolverweakreference weak reference weakreference resource resolver resourceresolver resource resolver context resourceresolvercontext context resolver weak reference resolverweakreference resource resolver resourceresolver ref erent referent reference queue referencequeue resource resolver resourceresolver resource resolver context resourceresolvercontext ctx ref erent referent context ctx close context close