licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling installer factories sub systems subsystems impl java io exception ioexception java input stream inputstream java util collection java util hash map hashmap java util map java util jar manifest java util zip zip entry zipentry java util zip zip input stream zipinputstream org apache sling installer api installable resource installableresource org apache sling installer api tasks change state task changestatetask org apache sling installer api tasks install task installtask org apache sling installer api tasks install task factory installtaskfactory org apache sling installer api tasks registered resource registeredresource org apache sling installer api tasks resource state resourcestate org apache sling installer api tasks resource transformer resourcetransformer org apache sling installer api tasks task resource taskresource org apache sling installer api tasks task resource group taskresourcegroup org apache sling installer api tasks transformation result transformationresult org osgi framework bundle context bundlecontext org osgi framework invalid syntax exception invalidsyntaxexception org osgi framework service reference servicereference org osgi framework version org osgi service subsystem subsystem org osgi service subsystem subsystem org osgi service subsystem subsystem constants subsystemconstants org slf logger org slf logger factory loggerfactory extension osg i osgi installer list ens listens files esa proper subsystem manifest sub systems subsystems require complete manifest installer supports sub systems subsystems basic info version sub systems subsystems support update uninstall install lose bundle data bound configurations subsystem installer subsysteminstaller resource transformer resourcetransformer install task factory installtaskfactory string type subsystem esa logger logger logger factory loggerfactory get logger getlogger get class getclass subsystem root subsystem rootsubsystem bundle context bundlecontext bundle context bundlecontext subsystem installer subsysteminstaller subsystem root bundle context bundlecontext bundle context bundlecontext root subsystem rootsubsystem root bundle context bundlecontext bundle context bundlecontext org apache sling installer api tasks resource transformer resourcetransformer transform org apache sling installer api tasks registered resource registeredresource transformation result transformationresult transform registered resource registeredresource resource resource get type gettype equals installable resource installableresource type file resource geturl ends with endswith type subsystem logger info potential subsystem resource resource subsystem info subsysteminfo headers read subsystem headers readsubsystemheaders resource headers check version val idity validity valid version validversion version headers version illegal argument exception illegalargumentexception iae logger info rejecting subsystem invalid version object headers symbolic name symbolicname resource headers version valid version validversion valid version validversion map string object attr hash map hashmap string object attr subsystem constants subsystemconstants subsystem symbolicname headers symbolic name symbolicname attr subsystem constants subsystemconstants subsystem version headers version transformation result transformationresult transformation result transformationresult set id setid headers symbolic name symbolicname set resource type setresourcetype type subsystem set attributes setattributes attr set version setversion version headers version transformation result transformationresult logger info subsystem resource required headers check required attributes sanity check subsystem info subsysteminfo check resource checkresource task resource group taskresourcegroup to activate toactivate task resource taskresource rsrc to activate toactivate get active resource getactiveresource subsystem info subsysteminfo result string symbolic name symbolicname string rsrc get attribute getattribute subsystem constants subsystemconstants subsystem symbolicname symbolic name symbolicname logger error subsystem resource missing symbolic rsrc string version string rsrc get attribute getattribute subsystem constants subsystemconstants subsystem version version logger error subsystem resource missing version rsrc check version val idity validity valid version validversion version version illegal argument exception illegalargumentexception iae logger info rejecting subsystem invalid version object symbolic name symbolicname rsrc version valid version validversion valid version validversion result subsystem info subsysteminfo result symbolic name symbolicname symbolic name symbolicname result version version result service reference servicereference subsystem get subsystem reference getsubsystemreference string symbolic name symbolicname search subsystem symbolic service reference servicereference subsystem collection service reference servicereference subsystem bundle context bundlecontext get service references getservicereferences subsystem subsystem symbolic name symbolicname symbolic name symbolicname size iterator invalid syntax exception invalidsyntaxexception logger error problem searching subsystem symbolic symbolic name symbolicname org apache sling installer api tasks install task factory installtaskfactory create task createtask org apache sling installer api tasks task resource group taskresourcegroup install task installtask create task createtask task resource group taskresourcegroup to activate toactivate install task installtask result task resource taskresource rsrc to activate toactivate get active resource getactiveresource rsrc get type gettype equals type subsystem check required info subsystem info subsysteminfo info check resource checkresource to activate toactivate info ignore info missing result change state task changestatetask to activate toactivate resource state resourcestate search subsystem symbolic service reference servicereference subsystem get subsystem reference getsubsystemreference info symbolic name symbolicname subsystem current subsystem currentsubsystem bundle context bundlecontext get service getservice version new version newversion version info version version old version oldversion version get property getproperty subsystem version install rsrc get state getstate resource state resourcestate install old version oldversion compare old version oldversion compare to compareto new version newversion compare installed version update result update subsystem task updatesubsystemtask to activate toactivate bundle context bundlecontext root subsystem rootsubsystem compare is snapshot issnapshot new version newversion version snapshot update result update subsystem task updatesubsystemtask to activate toactivate bundle context bundlecontext root subsystem rootsubsystem compare current subsystem currentsubsystem current subsystem currentsubsystem get state getstate active start version result start subsystem task startsubsystemtask to activate toactivate current subsystem currentsubsystem logger info installed subsystem higher version installed info new version newversion result change state task changestatetask to activate toactivate resource state resourcestate result install subsystem task installsubsystemtask to activate toactivate root subsystem rootsubsystem uninstall rsrc get state getstate resource state resourcestate uninstall old version oldversion logger error uninstall installed info result change state task changestatetask to activate toactivate resource state resourcestate compare old version oldversion compare to compareto new version newversion compare result uninstall subsystem task uninstallsubsystemtask to activate toactivate bundle context bundlecontext logger error uninstall installed version installed info old version oldversion result change state task changestatetask to activate toactivate resource state resourcestate result current subsystem currentsubsystem bundle context bundlecontext unget service ungetservice result result read manifest supplied input stream closed manifest get manifest getmanifest registered resource registeredresource rsrc logger logger io exception ioexception input stream inputstream ins rsrc get input stream getinputstream manifest result ins zip input stream zipinputstream jis jis zip input stream zipinputstream ins zip entry zipentry entry entry jis get next entry getnextentry entry get name getname equals osgi inf subsystem result manifest jis closing jar stream closes input stream jis jis close io exception ioexception ignore ins close io exception ioexception ignore result subsystem info subsysteminfo string symbolic name symbolicname string version override string to string tostring subsystem symbolic name symbolicname symbolic name symbolicname version version read subsystem info manifest subsystem info subsysteminfo read subsystem headers readsubsystemheaders registered resource registeredresource resource manifest subsystem installer subsysteminstaller get manifest getmanifest resource logger string get main attributes getmainattributes get value getvalue subsystem constants subsystemconstants subsystem symbolicname string get main attributes getmainattributes get value getvalue subsystem constants subsystemconstants subsystem version param pos parampos index of indexof string symbolic name symbolicname param pos parampos substring param pos parampos subsystem info subsysteminfo headers subsystem info subsysteminfo headers symbolic name symbolicname symbolic name symbolicname headers version version version headers version headers version headers io exception ioexception ignore string maven snapshot marker snapshot check version snapshot version is snapshot issnapshot version to string tostring index of indexof maven snapshot marker