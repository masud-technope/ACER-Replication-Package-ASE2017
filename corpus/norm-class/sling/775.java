licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling openid impl java i o exception ioexception java net unknown host exception unknownhostexception java util dictionary java util hash map hashmap java util iterator java util properties javax jcr credentials javax jcr repository exception repositoryexception javax jcr session javax jcr simple credentials simplecredentials javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse org apache felix scr annotations component org apache felix scr annotations property org apache felix scr annotations property unbounded propertyunbounded org apache felix scr annotations reference org apache felix scr annotations service org apache jackrabbit api jackrabbit session jackrabbitsession org apache jackrabbit api security user user org apache jackrabbit api security user user manager usermanager org apache sling api authenticator org apache sling core auth util authutil org apache sling core spi abstract authentication handler abstractauthenticationhandler org apache sling core spi authentication handler authenticationhandler org apache sling core spi authentication info authenticationinfo org apache sling core spi default authentication feedback handler defaultauthenticationfeedbackhandler org apache sling openid openidconstants org apache sling openid openidfailure org apache sling commons osgi osgi util osgiutil org apache sling jcr api sling repository slingrepository org osgi framework constants org osgi framework service registration serviceregistration org osgi service component component context componentcontext org slf logger org slf logger factory loggerfactory dyuproject openid open id user openiduser dyuproject openid relying party relyingparty dyuproject openid manager cookie based user manager cookiebasedusermanager code authorization header authentication handler authorizationheaderauthenticationhandler code authorization steps based authorization header http request authenticator event ually eventually support basic digest authentication methods component metatype label openid description openid description org apache sling openid openidauthenticationhandler service org apache felix scr annotations properties property constants service vendor apache software foundation property constants service description apache sling openid authentication handler property authentication handler authenticationhandler path property unbounded property unbounded propertyunbounded array property authentication handler authenticationhandler type property openidconstants openid property private propertyprivate openidauthenticationhandler abstract authentication handler abstractauthenticationhandler log logger log logger factory loggerfactory get logger getlogger get class getclass property authentication form servlet authenticationformservlet servlet path string prop login form openid login form string login identifier form field relying party relyingparty identifier parameter property login identifier form field string prop login identifier form field openid login identifier string external url prefix property external url prefix string prop external url prefix openid external url prefix cookie property bool value boolvalue cookie string prop cookie openid cookie string cookie domain property cookie domain string prop cookie domain openid cookie domain string cookie sling openid property cookie string prop cookie openid cookie string cookie secret key secret property cookie secret key string prop cookie secret key openid cookie secret key string openid user attr openid user property openid user attr string prop openid user attr openid user attr string open identifier property openid identity property open identifier property string prop open identifier property openid property identity attribute openid user object cache mapping openid identifier jcr user prevent repeated time consuming search matching user string attr user jcr user id userid string slash reference sling repository slingrepository repository session session user manager usermanager user manager usermanager component context componentcontext context string login form loginform prefix create external url resource client returned auth enticating authenticating openid provider parameter basis code code parameter openid authentication request defaults created request pre request get scheme getscheme request get server name getservername request get server port getserverport request get context path getcontextpath code pre port port scheme string external url prefix externalurlprefix openid realm authenticate string presented client auth enticating authenticating openid provider info rm inform site wishing authenticate user parameter code realm code code trust root code parameter openid authentication request link external url prefix externalurlprefix realm field convey wildcard realm code http apache org code string realm use cookie usecookie string cookie domain cookiedomain cookie secret cookiesecret string cookie name cookiename request parameter provide openid identifier configured link prop login identifier form field defaults link login identifier form field string identifier param identifierparam jcr user property listing openid ident ities identities user configured link prop open identifier property defaults link open identifier property property multi value d valued user openid identifiers get user name getusername open id user openiduser string identity property identityproperty string open id attribute openidattribute relying party relyingparty relying party relyingparty service registration serviceregistration login module loginmodule openidauthenticationhandler log info openidauthenticationhandler created authentication handler authenticationhandler extra cts extracts credential data request contained check based original request object uri translation place method returns values table description code code user details contained request link authentication info authenticationinfo handler ongoing authentication exc hange exchange client request handling terminated valid credentials user credentials table method request credential client request note implementation pay special att ention attention fact request included servlet values uri specific values contained javax servlet include request attributes param request request object authentication param response response object send request failure user valid credentials instance identifying request user handler authentication transaction client request authentication method response indicating fact client authentication info authenticationinfo extract credentials extractcredentials http servlet request httpservletrequest request http servlet response httpservletresponse response relying party relyingparty relying party relyingparty get relying party getrelyingparty request class cast exception classcastexception update bundle http session object holds open id user openiduser instance created bundle open id user openiduser user discover relying party relyingparty request openid response user relying party relyingparty is auth response isauthresponse request log debug openid authentication timeout response send redirect sendredirect request getrequesturi authentication info authenticationinfo relying party relyingparty is auth cancel isauthcancel request log info openid authentication can celled cancelled user handle auth failure handleauthfailure openidfailure authentication request check request openid identifier request parameter leading valid openid transaction fail authentication string identifier request get parameter getparameter identifier param identifierparam identifier log info openid authentication failed failed discover openid provider handle auth failure handleauthfailure openidfailure discovery request user is authenticated isauthenticated user authenticated get auth info from user getauthinfofromuser user user is associated isassociated relying party relyingparty is auth response isauthresponse request relying party relyingparty verify auth verifyauth user request response authenticated response send redirect sendredirect get return to resource getreturntoresource request authentication info authenticationinfo failed verification handle auth failure handleauthfailure openidfailure verification request assume cancel successful response provider failed verification relying party relyingparty invalid ate invalidate request response handle auth failure handleauthfailure openidfailure authentication request associate authenticate user prepare url parameter string url get base url getbaseurl request realm trust root trustroot configuration root url string trust root trustroot realm url realm append resource url return to returnto add ress address string return to returnto url get return to path getreturntopath request relying party relyingparty associate and auth enticate associateandauthenticate user request response trust root trustroot trust root trustroot return to returnto provider authentication authentication info authenticationinfo failed association request generation handle auth failure handleauthfailure openidfailure association request class cast exception classcastexception cce log warn extract credentials extractcredentials openid user data http session failing credentials extract ion extraction log debug extract credentials extractcredentials dump cce drop credentials dropcredentials request response handle auth failure handleauthfailure openidfailure request exception log error error processing openid request s ends sends status code code unauthorized code auth enticate authenticate code req uesting requesting standard http header authentication code basic code scheme configured realm response committed error message log ged logged status param request request object param response response object send request code code returned handler i o exception ioexception error occurs sending response request credentials requestcredentials http servlet request httpservletrequest request http servlet response httpservletresponse response i o exception ioexception ignore handler authentication handler requested ignore request credentials ignorerequestcredentials request handler check ref erer referer request handler auth util authutil check ref erer checkreferer request login form loginform handler request authentication requestauthentication called failed authentication failedauthentication sense remove existing login relying party relyingparty relying party relyingparty get relying party getrelyingparty request relying party relyingparty invalid ate invalidate request response hash map hashmap string string params hash map hashmap string string params authenticator login resource get login resource getloginresource request append indication previous login failure request get attribute getattribute failure reason object j reason jreason request get attribute getattribute failure reason suppress warnings suppresswarnings rawtypes string reason j reason jreason enum enum j reason jreason j reason jreason to string tostring params failure reason reason object param identifier paramidentifier request get attribute getattribute openidconstants openid identity param identifier paramidentifier string params openidconstants openid identity string param identifier paramidentifier send redirect sendredirect request response login form loginform params i o exception ioexception log error failed redirect login form login form loginform invalid ates invalidates request relying party user request drop credentials dropcredentials http servlet request httpservletrequest request http servlet response httpservletresponse response get relying party getrelyingparty request invalid ate invalidate request response exception log warn drop authentication dropauthentication problem checking user log ged logged assuming log ged logged logging override authentication failed authenticationfailed http servlet request httpservletrequest request http servlet response httpservletresponse response authentication info authenticationinfo auth info authinfo called extract credentials extractcredentials authenticated openid user mapped valid repository user invalid ate invalidate cur ren curren openid user failure reason open id user openiduser user user get relying party getrelyingparty request discover request exception drop credentials dropcredentials request response request set attribute setattribute openidconstants openid failure reason openidfailure repository user user get identity getidentity request set attribute setattribute openidconstants openid identity user get identity getidentity override authentication succeeded authenticationsucceeded http servlet request httpservletrequest request http servlet response httpservletresponse response authentication info authenticationinfo auth info authinfo fixme check redirect login default authentication feedback handler defaultauthenticationfeedbackhandler handle redirect handleredirect request response internal discover openid user request involves steps user request attribute user http session openid cookie user identifier openid identifier supplied link identifier param identifierparam request parameter user request user error occurs discover user request code code returned param relying party relyingparty code relying party relyingparty code object discover openid user request param request code http servlet request httpservletrequest code user discovered code open id user openiduser code discovered request code code user discovered discovery failed class cast exception classcastexception thrown openid user object stored http session authentication handler bundle updated open id user openiduser discover relying party relyingparty relying party relyingparty http servlet request httpservletrequest request open id user openiduser instance created bundle relying party relyingparty discover request unknown host exception unknownhostexception uhe log info discover openid identifier resolved designates unknown host uhe get message getmessage i o exception ioexception ioe log info discover failure communicate openid provider ioe class cast exception classcastexception cce cce exception log warn discover unexpected failure discovering openid user exception discovering identifier authentication info authenticationinfo handle auth failure handleauthfailure openidfailure failure http servlet request httpservletrequest request request set attribute setattribute openidconstants openid failure reason failure authentication info authenticationinfo fail scr int egration integration activate component context componentcontext component context componentcontext context component context componentcontext dictionary props context get properties getproperties login form loginform osgi util osgiutil to string tostring props prop login form authentication form servlet authenticationformservlet servlet path external url prefix externalurlprefix osgi util osgiutil to string tostring props prop external url prefix external url prefix jcr user properties match openid users identity property identityproperty osgi util osgiutil to string tostring props prop open identifier property open identifier property d yu dyu openid properties use cookie usecookie osgi util osgiutil to boolean toboolean props prop cookie cookie cookie domain cookiedomain osgi util osgiutil to string tostring props prop cookie domain cookie domain cookie name cookiename osgi util osgiutil to string tostring props prop cookie cookie identifier param identifierparam osgi util osgiutil to string tostring props prop login identifier form field login identifier form field cookie secret cookiesecret osgi util osgiutil to string tostring props prop cookie secret key cookie secret key to char array tochararray open id attribute openidattribute osgi util osgiutil to string tostring props prop openid user attr openid user attr login module loginmodule login module loginmodule open login module plugin openidloginmoduleplugin register component context componentcontext get bundle context getbundlecontext throwable log info register open login module plugin openidloginmoduleplugin expected sling login module plugin loginmoduleplugin services supported log debug dump deactivate suppress warnings suppresswarnings unused component context componentcontext component context componentcontext login module loginmodule login module loginmodule unregister login module loginmodule session session is live islive session log out logout throwable log error deactivate unexpected problem logging session user manager usermanager session internal returns code code authentication handler ignore call link request credentials requestcredentials http servlet request httpservletrequest http servlet response httpservletresponse method returns code code link request login parameter form http servlet request httpservletrequest form ignore request credentials ignorerequestcredentials http servlet request httpservletrequest request string request login requestlogin request get parameter getparameter request login parameter request login requestlogin openidconstants openid equals request login requestlogin authentication info authenticationinfo get auth info from user getauthinfofromuser open id user openiduser user authentication info authenticationinfo info authentication info authenticationinfo openidconstants openid get user name getusername user actual openiduser object login module loginmodule info open id attribute openidattribute user get identity getidentity info open id attribute openidattribute user info open id user openiduser get open id user getopeniduser credentials credentials credentials simple credentials simplecredentials simple credentials simplecredentials creds simple credentials simplecredentials credentials open id user openiduser creds get attribute getattribute open id attribute openidattribute find jcr repository user open id user openiduser d erives derives user identifier string get user name getusername open id user openiduser user object nickname user get attribute getattribute attr user nickname string string nickname string identity user get identity getidentity string user id userid user manager usermanager user manager usermanager get user manager getusermanager user manager usermanager user id userid get user id by property getuseridbyproperty user manager usermanager identity property identityproperty identity associate user user id userid user id userid valid login store attribute user set attribute setattribute attr user user id userid user id userid user manager usermanager get user manager getusermanager user manager usermanager session session repository login administrative loginadministrative session jackrabbit session jackrabbitsession user manager usermanager jackrabbit session jackrabbitsession session get user manager getusermanager repository exception repositoryexception log error get user manager getusermanager user manager usermanager user manager usermanager string get user id by property getuseridbyproperty user manager usermanager user manager usermanager string prop name propname string prop value propvalue string user id userid iterator users user manager usermanager find author izables findauthorizables prop name propname prop value propvalue user manager usermanager search type user user users has next hasnext user id userid user users getid warn user users has next hasnext log warn get user name getusername multiple users property object prop name propname prop value propvalue user id userid repository exception repositoryexception log warn get user name getusername problem finding user property object prop name propname prop value propvalue user id userid relying party relyingparty get relying party getrelyingparty http servlet request httpservletrequest request relying party relyingparty properties open id props openidprops properties open id props openidprops set property setproperty openid identifier parameter identifier param identifierparam use cookie usecookie string ctx path ctxpath request get context path getcontextpath string cookie path cookiepath ctx path ctxpath ctx path ctxpath length ctx path ctxpath open id props openidprops set property setproperty openid user manager cookie based user manager cookiebasedusermanager get name getname open id props openidprops set property setproperty openid user manager cookie cookie name cookiename open id props openidprops set property setproperty openid user manager cookie path cookie path cookiepath cookie domain cookiedomain open id props openidprops set property setproperty openid user manager cookie domain cookie domain cookiedomain open id props openidprops set property setproperty openid user manager cookie security secret key string cookie secret cookiesecret class loader classloader oldtccl thread current thread currentthread get context class loader getcontextclassloader thread current thread currentthread set context class loader setcontextclassloader get class getclass get class loader getclassloader relying party relyingparty relying party relyingparty new instance newinstance open id props openidprops thread current thread currentthread set context class loader setcontextclassloader oldtccl relying party relyingparty string get base url getbaseurl http servlet request httpservletrequest request unit testing external url prefix externalurlprefix external url prefix externalurlprefix length string scheme request get scheme getscheme string host request get server name getservername port request get server port getserverport string ctx request get context path getcontextpath string builder stringbuilder url string builder stringbuilder url append scheme append url append host port http equals scheme port https equals scheme port url append append port url append ctx url to string tostring external url prefix externalurlprefix returns resource openid return to returnto path resource resource request attribute parameter derived current request uri query string resource prefixed request context path ensure properly tra nsmitted transmitted accross openid redirect ion redirection series param request request providing return to returnto url properly setup return to returnto url path string get return to path getreturntopath http servlet request httpservletrequest request find parameter optional request parameters string resource get login resource getloginresource request resource resource request getrequesturi request get query string getquerystring resource request get query string getquerystring prefix context path empty string prefix request get context path getcontextpath prefix length prefix concat resource resource returns target resource client redirected path return to returnto parameter initial openid redirect encoded link get encoded return to resource getencodedreturntoresource http servlet request httpservletrequest method reverse operations cut ting cutting request context path prefix param request request providing request url context path path client redirected successful openid authentication string get return to resource getreturntoresource http servlet request httpservletrequest request string resource request getrequesturi request get query string getquerystring resource request get query string getquerystring resource