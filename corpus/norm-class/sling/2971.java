licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling discovery commons providers spi base java util dictionary java util hash map hashmap java util hash set hashset java util hashtable java util map java util map entry java util org apache felix scr annotations activate org apache felix scr annotations component org apache felix scr annotations deactivate org apache felix scr annotations reference org apache felix scr annotations service org apache sling api sling constants slingconstants org apache sling api resource login exception loginexception org apache sling api resource modifiable value map modifiablevaluemap org apache sling api resource persistence exception persistenceexception org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling api resource resource resolver factory resourceresolverfactory org apache sling api resource value map valuemap org apache sling commons json json exception jsonexception org apache sling discovery commons providers util resource helper resourcehelper org apache sling settings sling settings service slingsettingsservice org osgi framework bundle context bundlecontext org osgi framework constants org osgi framework service registration serviceregistration org osgi service event event org osgi service event event constants eventconstants org osgi service event event handler eventhandler id map service idmapservice responsible storing sling id slingid cluster node id clusternodeid pair repository instances cluster map cluster node ids clusternodeids sling ids slingids vice versa component service id map service idmapservice id map service idmapservice abstract service with background check abstractservicewithbackgroundcheck event handler eventhandler reference resource resolver factory resourceresolverfactory resource resolver factory resourceresolverfactory reference sling settings service slingsettingsservice settings service settingsservice reference discovery lite config discoveryliteconfig commons config commonsconfig initialized string sling id slingid map integer string old id map cache oldidmapcache hash map hashmap integer string map integer string id map cache idmapcache hash map hashmap integer string last cache invalidation lastcacheinvalidation bundle context bundlecontext bundle context bundlecontext service registration serviceregistration event handler registration eventhandlerregistration test constructor id map service idmapservice test constructor testconstructor discovery lite config discoveryliteconfig commons config commonsconfig sling settings service slingsettingsservice settings service settingsservice resource resolver factory resourceresolverfactory resource resolver factory resourceresolverfactory id map service idmapservice service id map service idmapservice service commons config commonsconfig commons config commonsconfig service settings service settingsservice settings service settingsservice service resource resolver factory resourceresolverfactory resource resolver factory resourceresolverfactory service activate service activate activate bundle context bundlecontext bundle context bundlecontext bundle context bundlecontext bundle context bundlecontext register event handler registereventhandler start background check startbackgroundcheck id map service idmapservice initializer background check backgroundcheck override check init exception logger error initializer init deactivate deactivate event handler registration eventhandlerregistration event handler registration eventhandlerregistration unregister event handler registration eventhandlerregistration register event handler registereventhandler bundle context bundlecontext logger info register event handler registereventhandler bundle context bundlecontext register dictionary string object properties hashtable string object properties constants service description id map idmap change listener string topics string sling constants slingconstants topic resource sling constants slingconstants topic resource changed sling constants slingconstants topic resource removed properties event constants eventconstants event topic topics string path get id map path getidmappath path ends with endswith path path substring path length properties event constants eventconstants event filter path path event handler registration eventhandlerregistration bundle context bundlecontext register service registerservice event handler eventhandler get name getname properties create resource resolver resourceresolver resource resolver resourceresolver get resource resolver getresourceresolver login exception loginexception resource resolver factory resourceresolverfactory get administrative resource resolver getadministrativeresourceresolver get my id getmyid initialized testing wait for init waitforinit timeout start system current time millis currenttimemillis initialized timeout timeout diff start timeout system current time millis currenttimemillis diff wait diff wait interrupted exception interruptedexception initialized is initialized isinitialized initialized init login exception loginexception json exception jsonexception persistence exception persistenceexception initialized sling id slingid settings service settingsservice get sling id getslingid resource resolver resourceresolver resource resolver resourceresolver resource resolver resourceresolver get resource resolver getresourceresolver discovery lite descriptor discoverylitedescriptor descriptor discovery lite descriptor discoverylitedescriptor get descriptor from getdescriptorfrom resource resolver resourceresolver descriptor get my id getmyid resource resource resource helper resourcehelper get or create resource getorcreateresource resource resolver resourceresolver get id map path getidmappath modifiable value map modifiablevaluemap idmap resource adapt to adaptto modifiable value map modifiablevaluemap check sling id slingid mapped cluster node id clusternodeid cluster node id clusternodeid mapped sling id slingid cases clean found me foundme string a key akey hash set hashset string idmap key set keyset object idmap a key akey number number number long value longvalue check key sling id slingid a key akey equals sling id slingid per fect perfect found me foundme cleanup logger info init cluster node id clusternodeid mapped sling id slingid deleting entry key a key akey mapped idmap remove a key akey a key akey equals sling id slingid cleanup logger info init sling id slingid mapped cluster node id clusternodeid deleting entry key a key akey mapped idmap remove a key akey sling id slingid cluster node id clusternodeid mapping leave unchanged found me foundme logger info init mapping sling id slingid sling id slingid discovery lite idmap sling id slingid logger info init mapping existed left unchanged sling id slingid sling id slingid discovery lite resource resolver resourceresolver commit initialized notify all notifyall exception logger info init init failed resource resolver resourceresolver resource resolver resourceresolver close clear cache clearcache id map cache idmapcache is empty isempty logger debug clear cache clearcache clearing idmap cache old id map cache oldidmapcache clear old id map cache oldidmapcache put all putall id map cache idmapcache id map cache idmapcache clear logger debug clear cache clearcache cache emtpy last cache invalidation lastcacheinvalidation system current time millis currenttimemillis string to sling id toslingid cluster node id clusternodeid resource resolver resourceresolver resource resolver resourceresolver persistence exception persistenceexception system current time millis currenttimemillis last cache invalidation lastcacheinvalidation restart instance opt changed sling id slingid change notice d noticed view change view change force cache invalidation rely observation combine invalidation minute not e note reading discovery oak id map idmap minute sounds perf ectly perfectly fine clear cache clearcache string sling id slingid id map cache idmapcache cluster node id clusternodeid sling id slingid cache hit sling id slingid cache logger debug to sling id toslingid cache ref res hing refreshing idmap cache map integer string read map readmap read id map readidmap resource resolver resourceresolver entry integer string new entries newentries read map readmap entry set entryset entry integer string new entry newentry new entries newentries string old value oldvalue old id map cache oldidmapcache new entry newentry get key getkey old value oldvalue old value oldvalue equals new entry newentry get value getvalue logger info to sling id toslingid mapping new entry newentry get key getkey new entry newentry get value getvalue newly old value oldvalue equals new entry newentry get value getvalue logger info to sling id toslingid mapping new entry newentry get key getkey changed old value oldvalue new entry newentry get value getvalue id map cache idmapcache new entry newentry get key getkey new entry newentry get value getvalue entry integer string old entries oldentries old id map cache oldidmapcache entry set entryset entry integer string old entry oldentry old entries oldentries id map cache idmapcache contains key containskey old entry oldentry get key getkey logger info to sling id toslingid mapping old entry oldentry get key getkey old entry oldentry get value getvalue disappeared id map cache idmapcache cluster node id clusternodeid map integer string read id map readidmap resource resolver resourceresolver resource resolver resourceresolver persistence exception persistenceexception resource resource resource helper resourcehelper get or create resource getorcreateresource resource resolver resourceresolver get id map path getidmappath value map valuemap idmap value map idmapvaluemap resource adapt to adaptto value map valuemap map integer string idmap hash map hashmap integer string string sling id slingid idmap value map idmapvaluemap key set keyset object idmap value map idmapvaluemap sling id slingid number number number number idmap number int value intvalue sling id slingid idmap string get id map path getidmappath commons config commonsconfig get id map path getidmappath override handle event handleevent event event string resource path resourcepath string event get property getproperty path resource path resourcepath business resource path resourcepath starts with startswith get id map path getidmappath business logger debug handle event handleevent event path event resource path resourcepath event clear cache clearcache