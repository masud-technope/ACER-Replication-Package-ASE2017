licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling distribution pack aging packaging impl importer java input stream inputstream javax jcr node javax jcr session javax jcr value factory valuefactory javax jcr node type nodetype node type nodetype javax jcr security access control manager accesscontrolmanager javax jcr security privilege org apache jackrabbit jcr constants jcrconstants org apache sling api resource resource resolver resourceresolver org apache sling distribution common distribution exception distributionexception org apache sling distribution serialization distribution package distributionpackage org apache sling jcr api sling repository slingrepository org junit test org junit fail org mockito matchers org mockito mockito mock org mockito mockito test case testcase link org apache sling distribution pack aging packaging impl importer repository distribution package importer repositorydistributionpackageimporter repository distribution package importer test repositorydistributionpackageimportertest test test import package with unauthorized service user testimportpackagewithunauthorizedserviceuser exception sling repository slingrepository repository mock sling repository slingrepository string service name servicename admin string path string privilege name privilegename jcr read repository distribution package importer repositorydistributionpackageimporter repository distribution package importer repositorydistributionpackageimporter repository distribution package importer repositorydistributionpackageimporter repository service name servicename path privilege name privilegename resource resolver resourceresolver resource resolver resourceresolver mock resource resolver resourceresolver distribution package distributionpackage distribution package distributionpackage mock distribution package distributionpackage distribution package distributionpackage get id getid then return thenreturn some id someid repository distribution package importer repositorydistributionpackageimporter import package importpackage resource resolver resourceresolver distribution package distributionpackage fail succeed service user unable session distribution exception distributionexception test test import package without required privileges testimportpackagewithoutrequiredprivileges exception sling repository slingrepository repository mock sling repository slingrepository string service name servicename admin session session mock session access control manager accesscontrolmanager acm mock access control manager accesscontrolmanager string privilege name privilegename jcr read privilege privilege mock privilege acm privilege from name privilegefromname privilege name privilegename then return thenreturn privilege session get access control manager getaccesscontrolmanager then return thenreturn acm repository login service loginservice service name servicename then return thenreturn session string path repository distribution package importer repositorydistributionpackageimporter repository distribution package importer repositorydistributionpackageimporter repository distribution package importer repositorydistributionpackageimporter repository service name servicename path privilege name privilegename resource resolver resourceresolver resource resolver resourceresolver mock resource resolver resourceresolver distribution package distributionpackage distribution package distributionpackage mock distribution package distributionpackage distribution package distributionpackage get id getid then return thenreturn some id someid repository distribution package importer repositorydistributionpackageimporter import package importpackage resource resolver resourceresolver distribution package distributionpackage fail succeed privileges sufficient distribution exception distributionexception test test import package with required privileges testimportpackagewithrequiredprivileges exception sling repository slingrepository repository mock sling repository slingrepository string service name servicename admin session session mock session value factory valuefactory mock value factory valuefactory session get value factory getvaluefactory then return thenreturn access control manager accesscontrolmanager acm mock access control manager accesscontrolmanager string privilege name privilegename jcr read privilege privilege mock privilege string path node root node rootnode mock node node created node creatednode mock node node jcr content node jcrcontentnode mock node created node creatednode add node addnode jcr constants jcrconstants jcr content node type nodetype resource then return thenreturn jcr content node jcrcontentnode root node rootnode add node addnode string string then return thenreturn created node creatednode session get node getnode path then return thenreturn root node rootnode acm has privileges hasprivileges path privilege privilege then return thenreturn acm privilege from name privilegefromname privilege name privilegename then return thenreturn privilege session get access control manager getaccesscontrolmanager then return thenreturn acm repository login service loginservice service name servicename then return thenreturn session repository distribution package importer repositorydistributionpackageimporter repository distribution package importer repositorydistributionpackageimporter repository distribution package importer repositorydistributionpackageimporter repository service name servicename path privilege name privilegename resource resolver resourceresolver resource resolver resourceresolver mock resource resolver resourceresolver distribution package distributionpackage distribution package distributionpackage mock distribution package distributionpackage distribution package distributionpackage get id getid then return thenreturn some id someid input stream inputstream stream mock input stream inputstream distribution package distributionpackage create input stream createinputstream then return thenreturn stream repository distribution package importer repositorydistributionpackageimporter import package importpackage resource resolver resourceresolver distribution package distributionpackage