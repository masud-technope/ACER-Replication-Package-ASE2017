licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling event impl jobs config java sql java util array list arraylist java util calendar java util hash map hashmap java util list java util map java util concurrent atomic atomic boolean atomicboolean java util concurrent atomic atomic long atomiclong org apache felix scr annotations activate org apache felix scr annotations component org apache felix scr annotations deactivate org apache felix scr annotations modified org apache felix scr annotations properties org apache felix scr annotations property org apache felix scr annotations reference org apache felix scr annotations service org apache sling api resource login exception loginexception org apache sling api resource persistence exception persistenceexception org apache sling api resource resource resolver resourceresolver org apache sling api resource resource resolver factory resourceresolverfactory org apache sling commons osgi properties util propertiesutil org apache sling commons scheduler scheduler org apache sling discovery topology event topologyevent org apache sling discovery topology event topologyevent type org apache sling discovery topology event listener topologyeventlistener org apache sling event impl environment component environmentcomponent org apache sling event impl jobs utility org apache sling event impl jobs tasks check topology task checktopologytask org apache sling event impl jobs tasks find unfinished jobs task findunfinishedjobstask org apache sling event impl jobs tasks upgrade task upgradetask org apache sling event impl support environment org apache sling event impl support resource helper resourcehelper org apache sling event jobs job org slf logger org slf logger factory loggerfactory configuration job handling component metatype label apache sling job manager description central service job handling org apache sling event impl jobs jcr persistence handler persistencehandler service job manager configuration jobmanagerconfiguration properties property job manager configuration jobmanagerconfiguration property disable distribution bool value boolvalue job manager configuration jobmanagerconfiguration disable distribution label disable distribution description distribution disabled jobs processed leader care property job manager configuration jobmanagerconfiguration property log deprecation warnings bool value boolvalue job manager configuration jobmanagerconfiguration log deprecation warnings label deprecation warnings description enabled deprecation warnings log ged logged info level property job manager configuration jobmanagerconfiguration property repository path job manager configuration jobmanagerconfiguration repository path property private propertyprivate property job manager configuration jobmanagerconfiguration property scheduled jobs path job manager configuration jobmanagerconfiguration scheduled jobs path property private propertyprivate property job manager configuration jobmanagerconfiguration property background load delay long value longvalue job manager configuration jobmanagerconfiguration background load delay property private propertyprivate job manager configuration jobmanagerconfiguration topology event listener topologyeventlistener logger logger logger logger factory loggerfactory get logger getlogger org apache sling event impl jobs audit logger logger audit logger auditlogger logger factory loggerfactory get logger getlogger org apache sling event jobs audit resource path jobs string repository path even ting eventing jobs background load delay background load delay disabling distribution disable distribution resource path scheduled jobs string scheduled jobs path even ting eventing scheduled jobs path jobs stored string property repository path repository path background loader waits time seconds startup loading events repository secs string property background load delay load delay configuration distributing jobs string property disable distribution job consumer manager consumermanager disable distribution disabledistribution configuration property scheduled jobs path string property scheduled jobs path job scheduled jobs path background loading background load search configuration property deprecation warnings string property log deprecation warnings job log deprecation deprecation warnings log deprecation warnings jobs base path slash string jobs base path with slash jobsbasepathwithslash base path assigned jobs string assigned jobs path assignedjobspath base path unassigned jobs string unassigned jobs path unassignedjobspath base path assigned jobs current instance string local jobs path localjobspath base path assigned jobs current instance slash string local jobs path with slash localjobspathwithslash base path locks string locks path lockspath string previous version anon path previousversionanonpath string previous version identified path previousversionidentifiedpath base path locks slash string locks path with slash lockspathwithslash background load delay backgroundloaddelay disabled distribution disableddistribution string stored cancelled jobs path storedcancelledjobspath string stored successful jobs path storedsuccessfuljobspath resource path scheduled jobs stored string scheduled jobs path scheduledjobspath resource path scheduled jobs stored slash string scheduled jobs path with slash scheduledjobspathwithslash list topology awares list configuration change listener configurationchangelistener listeners array list arraylist configuration change listener configurationchangelistener environment component reference environment component environmentcomponent environment reference resource resolver factory resourceresolverfactory resource resolver factory resourceresolverfactory reference queue configuration manager queueconfigurationmanager queue config manager queueconfigmanager reference scheduler scheduler active atomic boolean atomicboolean active atomic boolean atomicboolean topology capabilities topology capabilities topologycapabilities topology capabilities topologycapabilities atomic boolean atomicboolean first topology event firsttopologyevent atomic boolean atomicboolean activate component param props configuration properties runtime exception runtimeexception paths created activate activate map string object props update props jobs base path with slash jobsbasepathwithslash properties util propertiesutil to string tostring props property repository path repository path create initial resources assigned jobs path assignedjobspath jobs base path with slash jobsbasepathwithslash assigned unassigned jobs path unassignedjobspath jobs base path with slash jobsbasepathwithslash unassigned locks path lockspath jobs base path with slash jobsbasepathwithslash locks locks path with slash lockspathwithslash locks path lockspath concat local jobs path localjobspath assigned jobs path assignedjobspath concat concat environment application local jobs path with slash localjobspathwithslash local jobs path localjobspath concat previous version anon path previousversionanonpath jobs base path with slash jobsbasepathwithslash anon previous version identified path previousversionidentifiedpath jobs base path with slash jobsbasepathwithslash identified stored cancelled jobs path storedcancelledjobspath jobs base path with slash jobsbasepathwithslash can celled cancelled stored successful jobs path storedsuccessfuljobspath jobs base path with slash jobsbasepathwithslash finished scheduled jobs path scheduledjobspath properties util propertiesutil to string tostring props property scheduled jobs path scheduled jobs path scheduled jobs path with slash scheduledjobspathwithslash scheduled jobs path scheduledjobspath create initial resources resource resolver resourceresolver resolver create resource resolver createresourceresolver resource helper resourcehelper get or create base path getorcreatebasepath resolver get local jobs path getlocaljobspath resource helper resourcehelper get or create base path getorcreatebasepath resolver get unassigned jobs path getunassignedjobspath resource helper resourcehelper get or create base path getorcreatebasepath resolver get locks path getlockspath persistence exception persistenceexception logger error unable create paths get message getmessage runtime exception runtimeexception resolver close active queue config manager queueconfigmanager add listener addlistener update configuration modified update map string object props disabled distribution disableddistribution properties util propertiesutil to boolean toboolean props property disable distribution disable distribution background load delay backgroundloaddelay properties util propertiesutil to long tolong props property background load delay background load delay utility log deprecation warnings properties util propertiesutil to boolean toboolean props property log deprecation warnings log deprecation warnings deactivate deactivate deactivate active stop processing stopprocessing queue config manager queueconfigmanager remove listener removelistener is active isactive active create resource resolver reading writing resource tree resolver closed client resource resolver code component deactivated runtime exception runtimeexception resolver created resource resolver resourceresolver create resource resolver createresourceresolver resource resolver resourceresolver resolver resource resolver factory resourceresolverfactory factory resource resolver factory resourceresolverfactory factory resolver resource resolver factory resourceresolverfactory get administrative resource resolver getadministrativeresourceresolver login exception loginexception logger error unable create resource resolver get message getmessage runtime exception runtimeexception resolver current topology capabilities capabilities code topology capabilities topologycapabilities get topology capabilities gettopologycapabilities topology capabilities topologycapabilities queue configuration manager queueconfigurationmanager get queue configuration manager getqueueconfigurationmanager queue config manager queueconfigmanager main logger main logger logger get main logger getmainlogger logger resource path assigned jobs path slash string get ass gined jobs path getassginedjobspath assigned jobs path assignedjobspath resource path unassigned jobs path slash string get unassigned jobs path getunassignedjobspath unassigned jobs path unassignedjobspath resource path jobs assigned current instance path slash string get local jobs path getlocaljobspath local jobs path localjobspath resource path locks path slash string get locks path getlockspath locks path lockspath counter jobs atomic long atomiclong job counter jobcounter atomic long atomiclong create unique job path folder job string get unique path getuniquepath string target id targetid string topic string job id jobid map string object job properties jobproperties string topic name topicname topic replace string builder stringbuilder string builder stringbuilder target id targetid append assigned jobs path assignedjobspath append append target id targetid append unassigned jobs path unassignedjobspath append append topic name topicname append append job id jobid to string tostring unique job string get unique id getuniqueid string job topic jobtopic calendar calendar get instance getinstance string builder stringbuilder string builder stringbuilder append calendar year append append calendar month append append calendar day month append append calendar hour day append append calendar minute append append environment application append append job counter jobcounter get and increment getandincrement to string tostring is local job islocaljob string job path jobpath job path jobpath job path jobpath starts with startswith local jobs path with slash localjobspathwithslash is job isjob string job path jobpath job path jobpath starts with startswith jobs base path with slash jobsbasepathwithslash string get jobs base path with slash getjobsbasepathwithslash jobs base path with slash jobsbasepathwithslash is lock islock string lock path lockpath lock path lockpath starts with startswith locks path with slash lockspathwithslash string get previous version anon path getpreviousversionanonpath previous version anon path previousversionanonpath string get previous version identified path getpreviousversionidentifiedpath previous version identified path previousversionidentifiedpath disable distribution disabledistribution disabled distribution disableddistribution string get stored cancelled jobs path getstoredcancelledjobspath stored cancelled jobs path storedcancelledjobspath string get stored successful jobs path getstoredsuccessfuljobspath stored successful jobs path storedsuccessfuljobspath storage path finished jobs param topic topic finished job param job id jobid job finished job param is success issuccess processing successful complete storage path string get storage path getstoragepath string topic string job id jobid is success issuccess string topic name topicname topic replace string builder stringbuilder string builder stringbuilder is success issuccess append stored successful jobs path storedsuccessfuljobspath append stored cancelled jobs path storedcancelledjobspath append append topic name topicname append append job id jobid to string tostring check storage path is storage path isstoragepath string path path starts with startswith stored cancelled jobs path storedcancelledjobspath path starts with startswith stored successful jobs path storedsuccessfuljobspath scheduled jobs path param slash code path returned code path appended slash returned path scheduled jobs string get scheduled jobs path getscheduledjobspath slash slash scheduled jobs path with slash scheduledjobspathwithslash scheduled jobs path scheduledjobspath method invoked queue configuration manager queue configuration queue configuration changed queueconfigurationchanged topology capabilities topologycapabilities caps topology capabilities topologycapabilities caps is active isactive start processing startprocessing type properties changed caps processing param deactivate deactivate capabilities stop processing stopprocessing logger debug stopping job processing topology capabilities topologycapabilities caps topology capabilities topologycapabilities caps deactivate capabilities stops background processes caps deactivate topology capabilities topologycapabilities listeners not ifiy listeners notifiylisteners logger debug job processing stopped start processing param event type eventtype event type param new caps newcaps capabilities param is config change isconfigchange configuration change occured start processing startprocessing type event type eventtype topology capabilities topologycapabilities new caps newcaps is config change isconfigchange run main tenance tasks runmaintenancetasks logger debug starting job processing create capabilities update view topology capabilities topologycapabilities new caps newcaps propagate topology main tenance maintenance event type eventtype type topology init upgrade task upgradetask task upgrade task upgradetask task find unfinished jobs task findunfinishedjobstask find unfinished jobs task findunfinishedjobstask check topology task checktopologytask check topology task checktopologytask run main tenance tasks runmaintenancetasks checker task shortly topology changed full run fullrun is config change isconfigchange is config change isconfigchange event type eventtype type topology init not ifiy listeners notifiylisteners checker seconds leader notify listeners scheduler local scheduler local local schedule runnable override new caps newcaps topology capabilities topologycapabilities run main tenance tasks runmaintenancetasks new caps newcaps is leader isleader new caps newcaps is active isactive assign unassigned jobs assignunassignedjobs start listeners new caps newcaps is active isactive listeners not ifiy listeners notifiylisteners local system current time millis currenttimemillis background load delay backgroundloaddelay logger debug job processing started not ifiy listeners notifiylisteners configuration change listener configurationchangelistener listeners configuration changed configurationchanged topology capabilities topologycapabilities org apache sling discovery topology event listener topologyeventlistener handle topology event handletopologyevent org apache sling discovery topology event topologyevent override handle topology event handletopologyevent topology event topologyevent event logger debug received topology event event run main tenance tasks runmaintenancetasks check change properties doesn affect event get type gettype type properties changed map string string new all instances newallinstances topology capabilities topologycapabilities get all instances map getallinstancesmap event get new view getnewview topology capabilities topologycapabilities topology capabilities topologycapabilities is same issame new all instances newallinstances logger debug capabilities rest arting restarting main tenance maintenance tasks run main tenance tasks runmaintenancetasks topology event topologyevent type event type eventtype event get type gettype first topology event firsttopologyevent compare and set compareandset event type eventtype type topology changed event type eventtype type topology init listeners event type eventtype type topology changing stop processing stopprocessing event type eventtype type topology init event get type gettype type topology changed event get type gettype type properties changed stop processing stopprocessing start processing startprocessing event type eventtype topology capabilities topologycapabilities event get new view getnewview run main tenance tasks runmaintenancetasks add topology aware listener param service listener notify add listener addlistener configuration change listener configurationchangelistener service listeners listeners add service service configuration changed configurationchanged topology capabilities topologycapabilities remove topology aware listener param service listener notify remove listener removelistener configuration change listener configurationchangelistener service listeners listeners remove service map string job retry list retrylist hash map hashmap string job add job to retry list addjobtoretrylist job job retry list retrylist retry list retrylist job get id getid job list job clear job retry list clearjobretrylist list job result array list arraylist job retry list retrylist result add all addall retry list retrylist values retry list retrylist clear result remove job from retry list removejobfromretrylist job job retry list retrylist retry list retrylist remove job get id getid job get job from retry list getjobfromretrylist string job id jobid retry list retrylist retry list retrylist job id jobid audit logger logging actions auditing logger logger get audit logger getauditlogger audit logger auditlogger