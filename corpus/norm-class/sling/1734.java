licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling super imposing superimposing impl org junit org mockito mockito java util arrays java util dictionary java util iterator javax jcr repository exception repositoryexception javax jcr session org apache sling api resource resource org apache sling api resource resource metadata resourcemetadata org apache sling api resource resource resolver resourceresolver org apache sling api resource resource wrapper resourcewrapper org junit org junit org junit test org junit runner run with runwith org mockito mock org mockito invocation invocation on mock invocationonmock org mockito run ners runners mockito unit runner mockitojunitrunner org mockito stub bin g stubbing answer org osgi framework bundle context bundlecontext org osgi framework service registration serviceregistration run with runwith mockito unit runner mockitojunitrunner superimposing resource provider impl test superimposingresourceproviderimpltest superimposing resource provider impl superimposingresourceproviderimpl under test undertest superimposing resource provider impl superimposingresourceproviderimpl under test overlay undertestoverlay mock bundle context bundlecontext bundle context bundlecontext mock service registration serviceregistration service registration serviceregistration mock service registration serviceregistration service registration overlay serviceregistrationoverlay mock resource resolver resourceresolver resource resolver resourceresolver mock session session mock resource original root resource originalrootresource mock resource original sub resource originalsubresource string original path root path string superimposed path root path string resource type resource type resourcetype set up setup setup super imposing superimposing resource provider overlay under test undertest superimposing resource provider impl superimposingresourceproviderimpl superimposed path original path bundle context bundlecontext register service registerservice any string anystring under test undertest dictionary then return thenreturn service registration serviceregistration under test undertest register service registerservice bundle context bundlecontext overlay under test overlay undertestoverlay superimposing resource provider impl superimposingresourceproviderimpl superimposed path original path bundle context bundlecontext register service registerservice any string anystring under test overlay undertestoverlay dictionary then return thenreturn service registration overlay serviceregistrationoverlay under test overlay undertestoverlay register service registerservice bundle context bundlecontext prepare test resources prepare original resource prepareoriginalresource original root resource originalrootresource original path prepare original resource prepareoriginalresource original sub resource originalsubresource original path resource resolver resourceresolver list children listchildren original root resource originalrootresource then answer thenanswer answer iterator resource iterator resource answer invocation on mock invocationonmock invocation arrays as list aslist resource original sub resource originalsubresource iterator prepare original resource prepareoriginalresource resource mock resource mockresource string path prepare resource mock resource mockresource get path getpath then return thenreturn path mock resource mockresource get resource type getresourcetype then return thenreturn resource type mock resource mockresource get resource super type getresourcesupertype then return thenreturn resource metadata resourcemetadata resource metadata resourcemetadata resource metadata resourcemetadata resource metadata resourcemetadata set resolution path setresolutionpath path mock resource mockresource get resource metadata getresourcemetadata then return thenreturn resource metadata resourcemetadata mock resource mockresource get resource resolver getresourceresolver then return thenreturn resource resolver resourceresolver mount resource tree resource resolver resourceresolver get resource getresource path then return thenreturn mock resource mockresource tear down teardown under test undertest unregister service unregisterservice verify service registration serviceregistration unregister under test overlay undertestoverlay unregister service unregisterservice verify service registration overlay serviceregistrationoverlay unregister test test getter testgetter assert equals assertequals superimposed path under test undertest get root path getrootpath assert equals assertequals original path under test undertest get source path getsourcepath assert false assertfalse under test undertest is overlay able isoverlayable test test getter overlay testgetteroverlay assert equals assertequals superimposed path under test overlay undertestoverlay get root path getrootpath assert equals assertequals original path under test overlay undertestoverlay get source path getsourcepath assert true asserttrue under test overlay undertestoverlay is overlay able isoverlayable test test equals testequals assert true asserttrue under test undertest equals under test undertest assert false assertfalse under test undertest equals under test overlay undertestoverlay assert true asserttrue under test overlay undertestoverlay equals under test overlay undertestoverlay assert false assertfalse under test undertest equals under test overlay undertestoverlay test test get mapped root resource testgetmappedrootresource resource resource under test undertest get resource getresource resource resolver resourceresolver superimposed path assert true asserttrue resource superimposing resource superimposingresource assert equals assertequals superimposed path resource get path getpath resource under test overlay undertestoverlay get resource getresource resource resolver resourceresolver superimposed path assert true asserttrue resource superimposing resource superimposingresource assert equals assertequals superimposed path resource get path getpath test test get mapped root resource with overlay testgetmappedrootresourcewithoverlay repository exception repositoryexception resource resolver resourceresolver adapt to adaptto session then return thenreturn session session item exists itemexists superimposed path then return thenreturn resource resource under test undertest get resource getresource resource resolver resourceresolver superimposed path assert true asserttrue resource superimposing resource superimposingresource assert equals assertequals superimposed path resource get path getpath root path over layed overlayed resource under test overlay undertestoverlay get resource getresource resource resolver resourceresolver superimposed path assert true asserttrue resource superimposing resource superimposingresource assert equals assertequals superimposed path resource get path getpath test test get mapped sub resource testgetmappedsubresource resource resource under test undertest get resource getresource resource resolver resourceresolver superimposed path assert true asserttrue resource superimposing resource superimposingresource assert equals assertequals superimposed path resource get path getpath resource under test overlay undertestoverlay get resource getresource resource resolver resourceresolver superimposed path assert true asserttrue resource superimposing resource superimposingresource assert equals assertequals superimposed path resource get path getpath test test get mapped sub resource with overlay testgetmappedsubresourcewithoverlay repository exception repositoryexception resource resolver resourceresolver adapt to adaptto session then return thenreturn session session item exists itemexists superimposed path then return thenreturn resource resource under test undertest get resource getresource resource resolver resourceresolver superimposed path assert true asserttrue resource superimposing resource superimposingresource assert equals assertequals superimposed path resource get path getpath overlay item exists underlying resource provider step resource under test overlay undertestoverlay get resource getresource resource resolver resourceresolver superimposed path assert null assertnull resource test test get mapped non existing resource testgetmappednonexistingresource resource resource under test undertest get resource getresource resource resolver resourceresolver superimposed path assert null assertnull resource resource under test overlay undertestoverlay get resource getresource resource resolver resourceresolver superimposed path assert null assertnull resource test test get mapped non existing resource with overlay testgetmappednonexistingresourcewithoverlay repository exception repositoryexception resource resolver resourceresolver adapt to adaptto session then return thenreturn session session item exists itemexists superimposed path then return thenreturn resource resource under test undertest get resource getresource resource resolver resourceresolver superimposed path assert null assertnull resource resource under test overlay undertestoverlay get resource getresource resource resolver resourceresolver superimposed path assert null assertnull resource test test get mapped resource root invalid path testgetmappedresourcerootinvalidpath resource resource under test undertest get resource getresource resource resolver resourceresolver invalid path assert null assertnull resource resource under test overlay undertestoverlay get resource getresource resource resolver resourceresolver invalid path assert null assertnull resource test test list children testlistchildren resource resource under test undertest get resource getresource resource resolver resourceresolver superimposed path iterator resource iterator under test undertest list children listchildren resource assert true asserttrue iterator has next hasnext assert equals assertequals superimposed path iterator get path getpath test test list children with resource wrapper testlistchildrenwithresourcewrapper resource resource under test undertest get resource getresource resource resolver resourceresolver superimposed path iterator resource iterator under test undertest list children listchildren resource wrapper resourcewrapper resource assert true asserttrue iterator has next hasnext assert equals assertequals superimposed path iterator get path getpath test test list children non superimposing resource testlistchildrennonsuperimposingresource iterator resource iterator under test undertest list children listchildren mock resource assert null assertnull iterator