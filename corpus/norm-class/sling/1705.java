licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling scripting sightly impl compiler java input stream inputstream java util array list arraylist java util map java util concurrent concurrent hash map concurrenthashmap org apache commons io utils ioutils org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling commons class loader classloader class loader writer classloaderwriter org apache sling commons compiler compilation result compilationresult org apache sling commons compiler compilation unit compilationunit org apache sling commons compiler compiler message compilermessage org apache sling commons compiler java compiler javacompiler org apache sling commons compiler options org apache sling scripting sightly impl engine sightly engine configuration sightlyengineconfiguration org junit org junit org junit test org mockito mockito org mockito invocation invocation on mock invocationonmock org mockito stub bin g stubbing answer org powermock reflect whitebox org junit assert true asserttrue org mockito mockito mock org mockito mockito spy org mockito mockito verify org mockito mockito sightly java compiler service test sightlyjavacompilerservicetest sightly java compiler service sightlyjavacompilerservice compiler unit change monitor unitchangemonitor ucm set up setup exception compiler sightly java compiler service sightlyjavacompilerservice ucm spy unit change monitor unitchangemonitor sightly engine configuration sightlyengineconfiguration sightly engine configuration sightlyengineconfiguration mock sightly engine configuration sightlyengineconfiguration sightly engine configuration sightlyengineconfiguration is dev mode isdevmode then return thenreturn whitebox set internal state setinternalstate compiler sightly engine configuration sightlyengineconfiguration sightly engine configuration sightlyengineconfiguration whitebox set internal state setinternalstate compiler unit change monitor unitchangemonitor ucm tear down teardown exception compiler ucm test tests names packages under scores underscores correctly expanded jcr paths symbols replaced under scores underscores order obey java naming conventions test get instance for pojo from repo with ambigous path testgetinstanceforpojofromrepowithambigouspath exception string pojo path pojopath apps project test components pojo java string class name classname apps project test components pojo get instance pojo test getinstancepojotest pojo path pojopath class name classname test tests names names don under scores underscores correctly expanded jcr paths test get instance for pojo from repo testgetinstanceforpojofromrepo exception string pojo path pojopath apps myproject test components testcomponents pojo java string class name classname apps myproject test components testcomponents pojo get instance pojo test getinstancepojotest pojo path pojopath class name classname test test get instance for cached pojo from repo testgetinstanceforcachedpojofromrepo exception string pojo path pojopath apps project test components pojo java string class name classname apps project test components pojo map string sly java use map slyjavausemap concurrent hash map concurrenthashmap string class name classname system current time millis currenttimemillis whitebox set internal state setinternalstate ucm sly java use map slyjavausemap sly java use map slyjavausemap get instance pojo test getinstancepojotest pojo path pojopath class name classname verify ucm clear java use object clearjavauseobject class name classname get instance pojo test getinstancepojotest string pojo path pojopath string class name classname exception resource pojo resource pojoresource mockito mock resource resource resolver resourceresolver resolver mockito mock resource resolver resourceresolver resolver get resource getresource pojo path pojopath then return thenreturn pojo resource pojoresource pojo resource pojoresource adapt to adaptto input stream inputstream then return thenreturn io utils ioutils to input stream toinputstream dummy java compiler javacompiler java compiler javacompiler mockito mock java compiler javacompiler compilation result compilationresult compilation result compilationresult mockito mock compilation result compilationresult compilation result compilationresult get errors geterrors then return thenreturn array list arraylist compiler message compilermessage java compiler javacompiler compile mockito compilation unit compilationunit mockito options then return thenreturn compilation result compilationresult compilation result compilationresult load compiled class loadcompiledclass class name classname then answer thenanswer answer object override object answer invocation on mock invocationonmock invocation throwable mock pojo mockpojo class loader writer classloaderwriter clw mockito mock class loader writer classloaderwriter class loader classloader class loader classloader mockito mock class loader classloader clw get class loader getclassloader then return thenreturn class loader classloader class loader classloader load class loadclass class name classname then answer thenanswer answer object override object answer invocation on mock invocationonmock invocation throwable mock pojo mockpojo whitebox set internal state setinternalstate compiler class loader writer classloaderwriter clw whitebox set internal state setinternalstate compiler java compiler javacompiler java compiler javacompiler object obj compiler get instance getinstance resolver class name classname assert true asserttrue expected mock pojo mockpojo get name getname object obj mock pojo mockpojo