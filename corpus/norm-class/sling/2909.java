licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling discovery base org junit assert equals assertequals org junit assert not null assertnotnull org junit assert true asserttrue org junit fail java util linked list linkedlist java util list java util random org apache sling discovery instance description instancedescription org apache sling discovery topology event topologyevent org apache sling discovery topology event topologyevent type org apache sling discovery topology event listener topologyeventlistener org apache sling discovery topology view topologyview org apache sling discovery base setup virtual instance virtualinstance org apache sling discovery base setup virtual instance builder virtualinstancebuilder org apache sling testing tools retry retry loop retryloop org apache sling testing tools retry retry loop retryloop condition org junit org junit org junit test org slf logger org slf logger factory loggerfactory base tests discovery impl oak simulates instances coming slow repository bad weather scenarios assumptions get topology gettopology correct handle topology event handletopologyevent properly delivered abstract discovery service test abstractdiscoveryservicetest logger logger logger factory loggerfactory get logger getlogger get class getclass tester topology event listener topologyeventlistener runnable virtual instance virtualinstance instance thread thread topology event topologyevent previous event previousevent list string failures linked list linkedlist string stopped polling sleep pollingsleep running tester virtual instance virtualinstance instance polling sleep pollingsleep throwable instance instance polling sleep pollingsleep polling sleep pollingsleep instance bind topology event listener bindtopologyeventlistener thread thread thread set name setname tester instance get debug name getdebugname thread thread set daemon setdaemon thread start assert no failures assertnofailures failures size fail failures size failures failures has failures hasfailures failures size async fail asyncfail string msg failures add msg override stopped topology view topologyview top o topo instance get discovery service getdiscoveryservice get topology gettopology thread sleep polling sleep pollingsleep throwable async fail asyncfail throwable override handle topology event handletopologyevent topology event topologyevent event has failures hasfailures logger info handle topology event handletopologyevent instance get debug name getdebugname event previous event previousevent expecting topology init event get type gettype type topology init async fail asyncfail expected init event previous event previousevent get type gettype type topology changed previous event previousevent get type gettype type properties changed expecting topology changing properties changed event get type gettype type topology changing per fect perfect event get type gettype type properties changed per fect perfect async fail asyncfail expected changing properties changed event previous event previousevent get type gettype type topology changing expecting topology changed event get type gettype type topology changed async fail asyncfail expected changed changing event previous event previousevent event shutdown exception stopped instance running restart exception instance start view checker startviewchecker instance get config getconfig get connector ping interval getconnectorpinginterval running pause throwable instance stop view checker stopviewchecker running list tester test ers testers linked list linkedlist tester virtual instance builder virtualinstancebuilder new builder newbuilder set up setup exception test ers testers clear tear down teardown exception tester tester test ers testers tester shutdown tester new instance newinstance string debug name debugname int erval interval timeout polling sleep pollingsleep virtual instance virtualinstance base throwable virtual instance builder virtualinstancebuilder builder new builder newbuilder builder set debug name setdebugname debug name debugname base builder new repository newrepository discovery testing builder use repository of userepositoryof base builder set connector ping interval setconnectorpinginterval int erval interval builder set connector ping timeout setconnectorpingtimeout timeout builder set min event delay setmineventdelay virtual instance virtualinstance instance builder build tester tester instance polling sleep pollingsleep test ers testers add instance start view checker startviewchecker int erval interval assert stable topology assertstabletopology tester instances tester tester instances logger info asserting tester tester instance get debug name getdebugname topology event topologyevent last event lastevent tester previous event previousevent type type last event lastevent get type gettype type type topology changed type type topology init fine fail wrong type expected changed init type assert not null assertnotnull last event lastevent get new view getnewview assert equals assertequals instances length last event lastevent get new view getnewview get instances getinstances size topology view topologyview tester instance get discovery service getdiscoveryservice get topology gettopology assert true asserttrue is current iscurrent assert equals assertequals instances length get instances getinstances size is stable topology isstabletopology tester instances tester tester instances topology event topologyevent last event lastevent tester previous event previousevent last event lastevent type type last event lastevent get type gettype type type topology changed type type topology init fine topology view topologyview new view newview last event lastevent get new view getnewview new view newview instances length new view newview get instances getinstances size topology view topologyview tester instance get discovery service getdiscoveryservice get topology gettopology is current iscurrent instances length get instances getinstances size tester instances found match foundmatch instance description instancedescription get instances getinstances instance get sling id getslingid equals get sling id getslingid found match foundmatch found match foundmatch test test single instance testsingleinstance throwable logger info test single instances testsingleinstances start tester single new instance newinstance single single instance dump repo dumprepo logger info test single instances testsingleinstances starting retry loop max start retry loop startretryloop test ers testers single assert no failures assertnofailures assert stable topology assertstabletopology single logger info test single instances testsingleinstances test test two instances testtwoinstances throwable logger info test two instances testtwoinstances start tester new instance newinstance tester new instance newinstance instance logger info test two instances testtwoinstances starting retry loop max start retry loop startretryloop test ers testers instance dump repo dumprepo assert no failures assertnofailures assert no failures assertnofailures assert stable topology assertstabletopology logger info test two instances testtwoinstances test test ten instances testteninstances throwable logger info test ten instances testteninstances start tester new instance newinstance tester new instance newinstance instance logger info test ten instances testteninstances starting retry loop max start retry loop startretryloop test ers testers instance dump repo dumprepo assert no failures assertnofailures assert stable topology assertstabletopology test ers testers to array toarray tester logger info test ten instances testteninstances test test twenty instances testtwentyinstances throwable logger info test twenty instances testtwentyinstances start tester new instance newinstance tester new instance newinstance instance logger info test thirty instances testthirtyinstances starting retry loop max start retry loop startretryloop test ers testers instance dump repo dumprepo assert no failures assertnofailures assert stable topology assertstabletopology test ers testers to array toarray tester logger info test twenty instances testtwentyinstances test test twenty four instances testtwentyfourinstances throwable logger info test twenty four instances testtwentyfourinstances start tester new instance newinstance tester new instance newinstance instance thread sleep logger info test twenty four instances testtwentyfourinstances starting retry loop max start retry loop startretryloop test ers testers instance dump repo dumprepo assert no failures assertnofailures assert stable topology assertstabletopology test ers testers to array toarray tester logger info test twenty four instances testtwentyfourinstances start retry loop startretryloop list tester test ers testers retry timeout seconds retrytimeoutseconds start retry loop startretryloop retry timeout seconds retrytimeoutseconds test ers testers to array toarray tester start retry loop startretryloop retry timeout seconds retrytimeoutseconds tester test ers testers retry loop retryloop condition override string get description getdescription todo auto generated method stub override is true istrue exception is stable topology isstabletopology test ers testers tester tester test ers testers tester assert no failures assertnofailures logger info retry loop retryloop declaring stable topology test ers testers length retry timeout seconds retrytimeoutseconds seconds test test start stop fiesta teststartstopfiesta throwable tester instances tester instances new instance newinstance instances new instance newinstance instances instance thread sleep start retry loop startretryloop instances tester tester instances tester assert no failures assertnofailures assert stable topology assertstabletopology test ers testers to array toarray tester random random logger info test start stop fiesta teststartstopfiesta loop list tester alive linked list linkedlist tester keep alive keepalive next int nextint instances length instances length keep alive keepalive next boolean nextboolean instances restart alive add instances instances pause logger info test start stop fiesta teststartstopfiesta loop alive cnt alive size start retry loop startretryloop alive tester tester instances tester assert no failures assertnofailures assert stable topology assertstabletopology alive to array toarray tester