licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling discovery base connectors ping java i o exception ioexception java unsupported encoding exception unsupportedencodingexception java security algorithm parameters algorithmparameters java security invalid algorithm parameter exception invalidalgorithmparameterexception java security invalid key exception invalidkeyexception java security key java security message digest messagedigest java security no such algorithm exception nosuchalgorithmexception java security secure random securerandom java security spec invalid key spec exception invalidkeyspecexception java security spec invalid parameter spec exception invalidparameterspecexception java security spec key spec keyspec java util array list arraylist java util collections java util list java util map java util concurrent concurrent hash map concurrenthashmap java util zip gzip input stream gzipinputstream javax crypto bad padding exception badpaddingexception javax crypto cipher javax crypto illegal block size exception illegalblocksizeexception javax crypto mac javax crypto no such padding exception nosuchpaddingexception javax crypto secret key secretkey javax crypto secret key factory secretkeyfactory javax crypto spec iv parameter spec ivparameterspec javax crypto spec pbe key spec pbekeyspec javax crypto spec secret key spec secretkeyspec javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse org apache commons code c codec binary base org apache commons i o utils ioutils org apache http header org apache http http response httpresponse org apache http client methods http uri request httpurirequest org apache sling commons json json array jsonarray org apache sling commons json json exception jsonexception org apache sling commons json json object jsonobject org apache sling discovery base connectors base config baseconfig request validator helper topology request validator topologyrequestvalidator string sig header sling topology trust slingtopologytrust string hash header sling topology hash slingtopologyhash maximum number memory max keys maxkeys minimum number memory min keys minkeys trust request headers trust enabled trustenabled encryption message payload encrypted encryption enabled encryptionenabled map hmac keyed key number map integer key concurrent hash map concurrenthashmap integer key shared key string shared key sharedkey ttl shared key generation int erval interval deactivated deactivated secure random securerandom random secure random securerandom create topology request validator topologyrequestvalidator param config config uation configuation object topology request validator topologyrequestvalidator base config baseconfig config trust enabled trustenabled encryption enabled encryptionenabled config is hmac enabled ishmacenabled trust enabled trustenabled shared key sharedkey config get shared key getsharedkey int erval interval config get key interval getkeyinterval encryption enabled encryptionenabled config is encrypt ion enabled isencryptionenabled deactivated encodes request returning encoded body param body encoded body i o exception ioexception string encode message encodemessage string body i o exception ioexception check active checkactive encryption enabled encryptionenabled json object jsonobject json json object jsonobject json payload json array jsonarray encrypt body json to string tostring invalid key exception invalidkeyexception print stack trace printstacktrace i o exception ioexception unable encrypt message get message getmessage illegal block size exception illegalblocksizeexception i o exception ioexception unable encrypt message get message getmessage bad padding exception badpaddingexception i o exception ioexception unable encrypt message get message getmessage unsupported encoding exception unsupportedencodingexception i o exception ioexception unable encrypt message get message getmessage no such algorithm exception nosuchalgorithmexception i o exception ioexception unable encrypt message get message getmessage no such padding exception nosuchpaddingexception i o exception ioexception unable encrypt message get message getmessage json exception jsonexception i o exception ioexception unable encrypt message get message getmessage invalid key spec exception invalidkeyspecexception i o exception ioexception unable encrypt message get message getmessage invalid parameter spec exception invalidparameterspecexception i o exception ioexception unable encrypt message get message getmessage body decode message client param request request object message message clear text i o exception ioexception problem decoding message message invalid string decode message decodemessage http servlet request httpservletrequest request i o exception ioexception check active checkactive decode message decodemessage request request getrequesturi get request body getrequestbody request request get header getheader hash header decode response server param response response message clear text i o exception ioexception problem decoding message string decode message decodemessage string uri http response httpresponse response i o exception ioexception check active checkactive decode message decodemessage response uri get response body getresponsebody response get response header getresponseheader response hash header decode message param prefix prefix message request response message param url url message param body body message param request hash requesthash hash message message clear text i o exception ioexception message decrypted string decode message decodemessage string prefix string url string body string request hash requesthash i o exception ioexception trust enabled trustenabled string body hash bodyhash hash prefix url body body hash bodyhash equals request hash requesthash encryption enabled encryptionenabled json object jsonobject json json object jsonobject body json payload decrypt json getjsonarray payload json exception jsonexception i o exception ioexception encrypted message correct json format invalid key exception invalidkeyexception i o exception ioexception encrypted message correct json format illegal block size exception illegalblocksizeexception i o exception ioexception encrypted message correct json format bad padding exception badpaddingexception i o exception ioexception encrypted message correct json format no such algorithm exception nosuchalgorithmexception i o exception ioexception encrypted message correct json format no such padding exception nosuchpaddingexception i o exception ioexception encrypted message correct json format invalid algorithm parameter exception invalidalgorithmparameterexception i o exception ioexception encrypted message correct json format invalid key spec exception invalidkeyspecexception i o exception ioexception encrypted message correct json format i o exception ioexception message valid hash match message body request client trusted based signature headers param request request trusted component disabled is trusted istrusted http servlet request httpservletrequest request check active checkactive trust enabled trustenabled check trust header checktrustheader request get header getheader hash header request get header getheader sig header response server trusted client param response response trusted component disabled is trusted istrusted http response httpresponse response check active checkactive trust enabled trustenabled check trust header checktrustheader get response header getresponseheader response hash header get response header getresponseheader response sig header trust message client sending trust enabled param method method headers call param body body trust message trustmessage http uri request httpurirequest method string body check active checkactive trust enabled trustenabled string body hash bodyhash hash request method geturi get path getpath body method set header setheader hash header body hash bodyhash method set header setheader sig header create trust header createtrustheader body hash bodyhash trust response message server client param response response param request request param body body response trust message trustmessage http servlet response httpservletresponse response http servlet request httpservletrequest request string body check active checkactive trust enabled trustenabled string body hash bodyhash hash response request getrequesturi body response set header setheader hash header body hash bodyhash response set header setheader sig header create trust header createtrustheader body hash bodyhash param body hash body base encoded string hash string to hash tohash message digest messagedigest message digest messagedigest get instance getinstance sha string base encode base encodebase digest to hash tohash get bytes getbytes utf utf no such algorithm exception nosuchalgorithmexception runtime exception runtimeexception get message getmessage unsupported encoding exception unsupportedencodingexception runtime exception runtimeexception get message getmessage generate signature body hash bodyhash encode key number generate signature param body hash bodyhash hash signature string create trust header createtrustheader string body hash bodyhash key no keyno get current key getcurrentkey key no keyno hmac key no keyno body hash bodyhash unsupported encoding exception unsupportedencodingexception runtime exception runtimeexception get message getmessage invalid key exception invalidkeyexception runtime exception runtimeexception get message getmessage illegal state exception illegalstateexception runtime exception runtimeexception get message getmessage no such algorithm exception nosuchalgorithmexception runtime exception runtimeexception get message getmessage check signature signature body hash param body hash bodyhash body hash param signature signature signature trusted check trust header checktrustheader string body hash bodyhash string signature body hash bodyhash signature string parts signature split key no keyno integer parse int parseint parts hmac key no keyno body hash bodyhash equals parts array index out of bounds exception arrayindexoutofboundsexception illegal argument exception illegalargumentexception invalid key exception invalidkeyexception runtime exception runtimeexception get message getmessage unsupported encoding exception unsupportedencodingexception runtime exception runtimeexception get message getmessage illegal state exception illegalstateexception runtime exception runtimeexception get message getmessage no such algorithm exception nosuchalgorithmexception runtime exception runtimeexception get message getmessage exception runtime exception runtimeexception get message getmessage mac instance key number param key no keyno key number mac instance no such algorithm exception nosuchalgorithmexception invalid key exception invalidkeyexception unsupported encoding exception unsupportedencodingexception mac get mac getmac key no keyno no such algorithm exception nosuchalgorithmexception invalid key exception invalidkeyexception unsupported encoding exception unsupportedencodingexception mac mac get instance getinstance hmacsha init get key getkey key no keyno perform hmac body key param key no keyno key number param body hash bodyhash hash body hmac signature invalid key exception invalidkeyexception unsupported encoding exception unsupportedencodingexception illegal state exception illegalstateexception no such algorithm exception nosuchalgorithmexception string hmac key no keyno string body hash bodyhash invalid key exception invalidkeyexception unsupported encoding exception unsupportedencodingexception illegal state exception illegalstateexception no such algorithm exception nosuchalgorithmexception string base encode base encodebase get mac getmac key no keyno do final dofinal body hash bodyhash get bytes getbytes utf utf dec rypt decrypt body param json array jsonarray encrypted payload decrypted payload illegal block size exception illegalblocksizeexception bad padding exception badpaddingexception unsupported encoding exception unsupportedencodingexception invalid key exception invalidkeyexception no such algorithm exception nosuchalgorithmexception no such padding exception nosuchpaddingexception invalid key spec exception invalidkeyspecexception invalid algorithm parameter exception invalidalgorithmparameterexception json exception jsonexception string decrypt json array jsonarray json array jsonarray illegal block size exception illegalblocksizeexception bad padding exception badpaddingexception unsupported encoding exception unsupportedencodingexception invalid key exception invalidkeyexception no such algorithm exception nosuchalgorithmexception no such padding exception nosuchpaddingexception invalid algorithm parameter exception invalidalgorithmparameterexception invalid key spec exception invalidkeyspecexception json exception jsonexception cipher cipher cipher get instance getinstance aes cbc pkcs padding cipher init cipher decrypt mode get ciper key getciperkey base decode base decodebase json array jsonarray get string getstring get bytes getbytes utf iv parameter spec ivparameterspec base decode base decodebase json array jsonarray get string getstring get bytes getbytes utf string cipher do final dofinal base decode base decodebase json array jsonarray get string getstring get bytes getbytes utf encrypt payload num bed numbed key param payload payload param key no keyno key number encrypted version illegal block size exception illegalblocksizeexception bad padding exception badpaddingexception unsupported encoding exception unsupportedencodingexception invalid key exception invalidkeyexception no such algorithm exception nosuchalgorithmexception no such padding exception nosuchpaddingexception invalid key spec exception invalidkeyspecexception invalid parameter spec exception invalidparameterspecexception list string encrypt string payload illegal block size exception illegalblocksizeexception bad padding exception badpaddingexception unsupported encoding exception unsupportedencodingexception invalid key exception invalidkeyexception no such algorithm exception nosuchalgorithmexception no such padding exception nosuchpaddingexception invalid key spec exception invalidkeyspecexception invalid parameter spec exception invalidparameterspecexception cipher cipher cipher get instance getinstance aes cbc pkcs padding salt random next bytes nextbytes salt cipher init cipher encrypt mode get ciper key getciperkey salt algorithm parameters algorithmparameters params cipher get parameters getparameters list string encrypted array list arraylist string encrypted add string base encode base encodebase salt encrypted add string base encode base encodebase params get parameter spec getparameterspec iv parameter spec ivparameterspec getiv encrypted add string base encode base encodebase cipher do final dofinal payload get bytes getbytes utf encrypted param salt number key cupher key cupherkey unsupported encoding exception unsupportedencodingexception no such algorithm exception nosuchalgorithmexception invalid key spec exception invalidkeyspecexception key get ciper key getciperkey salt unsupported encoding exception unsupportedencodingexception no such algorithm exception nosuchalgorithmexception invalid key spec exception invalidkeyspecexception secret key factory secretkeyfactory factory secret key factory secretkeyfactory get instance getinstance pbkdf withhmacsha has hing hashing password times takes has hing hashing times takes salt values times good key spec keyspec spec pbe key spec pbekeyspec shared key sharedkey to char array tochararray salt secret key secretkey tmp factory generate secret generatesecret spec secret key secretkey key secret key spec secretkeyspec tmp get encoded getencoded aes key param key no keyno number key h mac hmac key unsupported encoding exception unsupportedencodingexception key get key getkey key no keyno unsupported encoding exception unsupportedencodingexception math abs key no keyno get current key getcurrentkey illegal argument exception illegalargumentexception key expired contains key containskey key no keyno key no keyno trim keys trimkeys secret key spec secretkeyspec key secret key spec secretkeyspec hash shared key sharedkey key no keyno get bytes getbytes utf hmacsha key no keyno key key get current key getcurrentkey system current time millis currenttimemillis int erval interval dump olf trim keys trimkeys size max keys maxkeys list integer keys keys keyskeys array list arraylist integer key set keyset collections sort keys keys keyskeys integer keys keys keyskeys size min keys minkeys remove response header param response response param response header response header string get response header getresponseheader http response httpresponse response string header response get first header getfirstheader get value getvalue request body param request request body string i o exception ioexception string get request body getrequestbody http servlet request httpservletrequest request i o exception ioexception string content encoding contentencoding request get header getheader content encoding content encoding contentencoding content encoding contentencoding gzip treat request body gzip gzip input stream gzipinputstream gzip in gzipin gzip input stream gzipinputstream request get input stream getinputstream string gunzipped encoded json gunzippedencodedjson i o utils ioutils to string tostring gzip in gzipin gzip in gzipin close gunzipped encoded json gunzippedencodedjson assume plain text i o utils ioutils to string tostring request get reader getreader param response response body response server i o exception ioexception string get response body getresponsebody http response httpresponse response i o exception ioexception header content encoding contentencoding response get first header getfirstheader content encoding content encoding contentencoding content encoding contentencoding get value getvalue content encoding contentencoding get value getvalue gzip server gzip treat gzip input stream gzipinputstream gzip in gzipin gzip input stream gzipinputstream response get entity getentity get content getcontent string gunzipped encoded json gunzippedencodedjson i o utils ioutils to string tostring gzip in gzipin gzip in gzipin close gunzipped encoded json gunzippedencodedjson server plain text plaintext i o utils ioutils to string tostring response get entity getentity get content getcontent utf exception active check active checkactive deactivated illegal state exception illegalstateexception get class getclass get name getname active trust enabled trustenabled encryption enabled encryptionenabled shared key sharedkey illegal state exception illegalstateexception get class getclass get name getname shared key encryption sig ning signing enabled