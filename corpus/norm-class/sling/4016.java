licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling distribution serialization impl vlt javax jcr node javax jcr repository exception repositoryexception javax jcr session java file java io exception ioexception java input stream inputstream java output stream outputstream java util array list arraylist java util hash set hashset java util list java util navigable map navigablemap java util properties java util java util tree map treemap org apache commons file utils fileutils org apache commons io utils ioutils org apache jackrabbit vault api import mode importmode org apache jackrabbit vault api path filter set pathfilterset org apache jackrabbit vault api workspace filter workspacefilter org apache jackrabbit vault config default meta inf defaultmetainf org apache jackrabbit vault config default workspace filter defaultworkspacefilter org apache jackrabbit vault config meta inf metainf org apache jackrabbit vault filter default path filter defaultpathfilter org apache jackrabbit vault access control handling accesscontrolhandling org apache jackrabbit vault import options importoptions org apache jackrabbit vault pack aging packaging export options exportoptions org apache jackrabbit vault pack aging packaging jcr package jcrpackage org apache jackrabbit vault pack aging packaging package manager packagemanager org apache jackrabbit vault pack aging packaging vault package vaultpackage org apache sling distribution distribution request distributionrequest org apache sling distribution distribution request type distributionrequesttype org apache sling distribution simple distribution request simpledistributionrequest org apache sling distribution component impl settings utils settingsutils org slf logger org slf logger factory loggerfactory utility creating vlt filters export options vlt utils vltutils logger log logger factory loggerfactory get logger getlogger vlt utils vltutils workspace filter workspacefilter create filter createfilter distribution request distributionrequest distribution request distributionrequest navigable map navigablemap string path filter set pathfilterset filters default workspace filter defaultworkspacefilter filter default workspace filter defaultworkspacefilter string path distribution request distributionrequest get paths getpaths deep distribution request distributionrequest is deep isdeep path path filter set pathfilterset filter set filterset create filter set createfilterset path deep filters filter add filter set filterset filter string get paths getpaths meta inf metainf meta inf metainf meta inf metainf workspace filter workspacefilter filter meta inf metainf get filter getfilter filter filter default workspace filter defaultworkspacefilter list path filter set pathfilterset filter sets filtersets filter get filter sets getfiltersets string paths string filter sets filtersets size paths length paths filter sets filtersets get root getroot paths path filter set pathfilterset create filter set createfilterset string path deep navigable map navigablemap string path filter set pathfilterset filters path filter set pathfilterset filter set filterset path filter set pathfilterset path deep filter set filterset add include addinclude default path filter defaultpathfilter path add specific filter rules string key filters desc ending key set descendingkeyset path starts with startswith key filter set filterset add all addall filters key filter set filterset export options exportoptions get export options getexportoptions workspace filter workspacefilter filter string package roots packageroots string package group packagegroup string package name packagename string package version packageversion default meta inf defaultmetainf inf default meta inf defaultmetainf export options exportoptions opts export options exportoptions inf set filter setfilter filter properties props properties props set property setproperty vault package vaultpackage group package group packagegroup props set property setproperty vault package vaultpackage package name packagename props set property setproperty vault package vaultpackage version package version packageversion inf set properties setproperties props opts set meta inf setmetainf inf string root get package root getpackageroot filter get filter sets getfiltersets package roots packageroots opts set root path setrootpath root opts set mount path setmountpath root opts picks root dom inates dominates filter sets returned string get package root getpackageroot list path filter set pathfilterset filter sets filtersets string package roots packageroots string package root packageroot package roots packageroots package roots packageroots length string current root currentroot package roots packageroots filters have common root filtershavecommonroot path filter set pathfilterset filter set filterset filter sets filtersets string filter set root filtersetroot filter set filterset get root getroot filter set root filtersetroot starts with startswith current root currentroot filters have common root filtershavecommonroot filters have common root filtershavecommonroot package root packageroot current root currentroot package root packageroot package root packageroot starts with startswith package root packageroot package root packageroot import options importoptions get import options getimportoptions access control handling accesscontrolhandling acl handling aclhandling import mode importmode import mode importmode import options importoptions opts import options importoptions acl handling aclhandling opts set access control handling setaccesscontrolhandling acl handling aclhandling overwrite opts set access control handling setaccesscontrolhandling access control handling accesscontrolhandling overwrite import mode importmode opts set import mode setimportmode import mode importmode update opts set import mode setimportmode import mode importmode update opts vault package vaultpackage create package createpackage package manager packagemanager package manager packagemanager session session export options exportoptions options file temp folder tempfolder io exception ioexception repository exception repositoryexception file file file create temp file createtempfile distr vault create system nano time nanotime zip temp folder tempfolder package manager packagemanager assemble session options file repository exception repositoryexception file utils fileutils delete quietly deletequietly file vault package vaultpackage read package readpackage package manager packagemanager package manager packagemanager input stream inputstream stream file temp folder tempfolder io exception ioexception file file file create temp file createtempfile distr vault read system nano time nanotime zip temp folder tempfolder output stream outputstream file utils fileutils open output stream openoutputstream file io utils ioutils copy stream package manager packagemanager open file io exception ioexception file utils fileutils delete quietly deletequietly file io utils ioutils close quietly closequietly stream io utils ioutils close quietly closequietly delete package deletepackage vault package vaultpackage vault package vaultpackage vault package vaultpackage file file vault package vaultpackage get file getfile vault package vaultpackage close file utils fileutils delete quietly deletequietly file delete package deletepackage jcr package jcrpackage jcr package jcrpackage jcr package jcrpackage node node jcr package jcrpackage get node getnode jcr package jcrpackage close node node remove repository exception repositoryexception file get temp folder gettempfolder string temp folder path tempfolderpath file directory directory file temp folder path tempfolderpath directory exists directory is directory isdirectory directory throwable directory directory string find parent findparent string path string node name nodename path path ends with endswith path path node name nodename node name nodename idx path index of indexof node name nodename idx path substring idx tree map treemap string path filter set pathfilterset parse filters parsefilters string filters tree map treemap string path filter set pathfilterset result tree map treemap string path filter set pathfilterset filters filters length result string filter filters string filter parts filterparts filter split filter parts filterparts length string path settings utils settingsutils remove empty entry removeemptyentry filter parts filterparts path path filter set pathfilterset filter set filterset path filter set pathfilterset filter parts filterparts length string filter part filterpart settings utils settingsutils remove empty entry removeemptyentry filter parts filterparts filter part filterpart filter part filterpart starts with startswith filter set filterset add include addinclude default path filter defaultpathfilter filter part filterpart substring filter part filterpart starts with startswith filter set filterset add exclude addexclude default path filter defaultpathfilter filter part filterpart substring result path filter set filterset result distribution request distributionrequest sanitize request sanitizerequest distribution request distributionrequest request distribution request type distributionrequesttype request type requesttype request get request type getrequesttype distribution request type distributionrequesttype add equals request type requesttype distribution request type distributionrequesttype delete equals request type requesttype request string deep paths deeppaths hash set hashset string list string paths array list arraylist string string path request get paths getpaths vlt utils vltutils find parent findparent path rep policy distribution request type distributionrequesttype delete equals request type requesttype vlt properly install delete rep policy sub nodes subnodes illegal argument exception illegalargumentexception distribute delete node path distribution request type distributionrequesttype add equals request type requesttype string new path newpath vlt utils vltutils find parent findparent path rep policy rep policy paths add new path newpath deep paths deeppaths add new path newpath log debug changed distribution path deep path path new path newpath request is deep isdeep path paths add path deep paths deeppaths add path paths add path simple distribution request simpledistributionrequest request type requesttype paths to array toarray string deep paths deeppaths