licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling servlets impl helpers javax servlet http http servlet response httpservletresponse modified org apache sling api servlets http constants httpconstants header modified org apache sling api servlets http constants httpconstants header modified java buffered input stream bufferedinputstream java closeable java io exception ioexception java input stream inputstream java output stream outputstream java print writer printwriter java util array list arraylist java util java util iterator java util string tokenizer stringtokenizer javax jcr node javax jcr path not found exception pathnotfoundexception javax jcr repository exception repositoryexception javax servlet request dispatcher requestdispatcher javax servlet servlet exception servletexception javax servlet servlet output stream servletoutputstream javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse org apache jackrabbit jcr constants jcrconstants org apache sling api sling constants slingconstants org apache sling api sling http servlet request slinghttpservletrequest org apache sling api sling http servlet response slinghttpservletresponse org apache sling api request request dispatcher options requestdispatcheroptions org apache sling api resource resource org apache sling api resource resource metadata resourcemetadata org apache sling api resource resource not found exception resourcenotfoundexception org apache sling api resource resource resolver resourceresolver org apache sling api resource resource util resourceutil org apache sling api servlets sling safe methods servlet slingsafemethodsservlet org slf logger org slf logger factory loggerfactory code stream renderer servlet streamrendererservlet code str eams streams current resource client behalf link org apache sling servlets impl default get servlet defaultgetservlet current resource str eamed streamed rendered link plain text renderer servlet plaintextrendererservlet stream renderer servlet streamrendererservlet sling safe methods servlet slingsafemethodsservlet string ext res res serialversionuid mime multipart sep aration separation string string mime separation mimeseparation sling mime boundary full range marker array list arraylist range full array list arraylist range buffer size log logger log logger factory loggerfactory get logger getlogger get class getclass string index files indexfiles stream renderer servlet streamrendererservlet string index files indexfiles index files indexfiles index files indexfiles override do get doget sling http servlet request slinghttpservletrequest request sling http servlet response slinghttpservletresponse response servlet exception servletexception io exception ioexception servlet called request include included request get attribute getattribute sling constants slingconstants attr request servlet ensure extension res string ext request get request path info getrequestpathinfo get extension getextension ext ext equals ext res request get request progress tracker getrequestprogresstracker log stream renderer servlet streamrendererservlet support extension ext included response is committed iscommitted log error stream renderer servlet streamrendererservlet support extension ext response send error senderror http servlet response httpservletresponse resource resource request get resource getresource resource util resourceutil is non existing resource isnonexistingresource resource resource not found exception resourcenotfoundexception data render trailing slash url directory listing equals request get request path info getrequestpathinfo get suffix getsuffix render directory renderdirectory request response included check modification time modified header included resource metadata resourcemetadata meta resource get resource metadata getresourcemetadata modif time modiftime meta get modification time getmodificationtime unmodified request modif time modiftime response set status setstatus modified fall plain text rendering resource stream resource get resource type getresourcetype equals jcr constants jcrconstants link edfile linkedfile string actual resource path actualresourcepath resource adapt to adaptto node get property getproperty jcr constants jcrconstants jcr content get node getnode get path getpath resource request get resource resolver getresourceresolver get resource getresource actual resource path actualresourcepath path not found exception pathnotfoundexception resource not found exception resourcenotfoundexception data render repository exception repositoryexception io exception ioexception input stream inputstream stream resource adapt to adaptto input stream inputstream stream stream resource streamresource resource stream included request response resource root redirect is root resource request isrootresourcerequest resource render directory renderdirectory request response included included response is committed iscommitted request included committed redirecting request get request progress tracker getrequestprogresstracker log stream renderer servlet streamrendererservlet redirecting trailing slash response committed request included log warn stream renderer servlet streamrendererservlet redirecting trailing slash response committed request included redirect trailing slash render string url request get resource resolver getresourceresolver map request resource get path getpath response send redirect sendredirect url is root resource request isrootresourcerequest resource resource equals resource get path getpath equals resource get resource resolver getresourceresolver map resource get path getpath returns code code request code modified code header modification time code modif time modiftime code param request code component request componentrequest code checked code modified code header param modif time modiftime modification time compare header code code code modif time modiftime code equal time code modified code header unmodified http servlet request httpservletrequest request modif time modiftime modif time modiftime seconds mod time modtime modif time modiftime ims request get date header getdateheader header modified mod time modtime ims modification time assume modified stream resource streamresource resource resource input stream inputstream stream included sling http servlet request slinghttpservletrequest request sling http servlet response slinghttpservletresponse response io exception ioexception stream resource array list arraylist range ranges included range support included requests ranges full parse optional ranges ranges parse range parserange request response resource get resource metadata getresourcemetadata ranges response response headers request included set headers setheaders resource response servlet output stream servletoutputstream response get output stream getoutputstream ranges full full resource set content length setcontentlength response resource get resource metadata getresourcemetadata get content length getcontentlength buf buffer size stream read buf write buf ranges resource response set status setstatus http servlet response httpservletresponse partial content ranges size range range ranges response add header addheader content range bytes range start range range length set content length setcontentlength response range range start copy stream range response set content type setcontenttype multipart byte ranges byteranges boundary mime separation mimeseparation copy resource ranges iterator close silently closesilently stream render directory renderdirectory sling http servlet request slinghttpservletrequest request sling http servlet response slinghttpservletresponse response included servlet exception servletexception io exception ioexception request included committed rendering included response is committed iscommitted request get request progress tracker getrequestprogresstracker log stream renderer servlet streamrendererservlet rendering response committed request included log warn stream renderer servlet streamrendererservlet rendering response committed request included resource resource request get resource getresource resource resolver resourceresolver resolver request get resource resolver getresourceresolver check file string index files indexfiles resource file res fileres resolver get resource getresource resource file res fileres resource util resourceutil is synthetic resource issyntheticresource file res fileres include resource suffix selectors request dispatcher options requestdispatcheroptions rdo request dispatcher options requestdispatcheroptions rdo set replace suffix setreplacesuffix rdo set replace selectors setreplaceselectors request dispatcher requestdispatcher dispatcher index of indexof string file path filepath file res fileres get path getpath html dispatcher request get request dispatcher getrequestdispatcher file path filepath rdo dispatcher request get request dispatcher getrequestdispatcher file res fileres rdo set headers setheaders file res fileres response dispatcher include request response render index renderindex resource response response send error senderror http servlet response httpservletresponse forbidden param resource param response set headers setheaders resource resource sling http servlet response slinghttpservletresponse response resource metadata resourcemetadata meta resource get resource metadata getresourcemetadata modif time modiftime meta get modification time getmodificationtime modif time modiftime response set date header setdateheader header modified modif time modiftime string default content type defaultcontenttype application octet stream string content type contenttype meta get content type getcontenttype content type contenttype default content type defaultcontenttype equals content type contenttype repository doesn provide content type servlet context string get servlet context getservletcontext get mime type getmimetype resource get path getpath content type contenttype content type contenttype response set content type setcontenttype content type contenttype string encoding meta get character encoding getcharacterencoding encoding response set character encoding setcharacterencoding encoding code content length code header length larger code integer max code converted string code set header setheader string string code method called code set content length setcontentlength code method param response response code content length code header param length content length equal header set content length setcontentlength http servlet response httpservletresponse response length length length integer max response set content length setcontentlength length response set header setheader content length string value of valueof length render index renderindex resource resource sling http servlet response slinghttpservletresponse response io exception ioexception response set content type setcontenttype text html response set character encoding setcharacterencoding utf string path resource get path getpath print writer printwriter response get writer getwriter println doctype html dtd html println html println head println title path title println head println body println path println pre println modified size description println equals path println href parent render children iterator resource children resource util resourceutil list children listchildren resource children has next hasnext render child renderchild children println pre println body println html render child renderchild print writer printwriter resource resource string resource util resourceutil get name getname resource get path getpath input stream inputstream ins resource adapt to adaptto input stream inputstream ins close silently closesilently ins string display name displayname string suffix display name displayname length display name displayname display name displayname substring suffix suffix substring display name displayname length printf href display name displayname suffix resource metadata resourcemetadata meta resource get resource metadata getresourcemetadata last modified lastmodified meta get modification time getmodificationtime print last modified lastmodified length meta get content length getcontentlength length print length print println range header support code copy derived tomcat e tomcate default servlet defaultservlet http svn apache org view vc viewvc tomcat trunk java org apache catalina servlets default servlet defaultservlet java view mark up markup copies number ranges resource output stream copy contents input stream output stream ensure str eams streams closed returning face exception param resource resource send ranges param ostream output stream write param ranges iterator ranges client wanted retrieve exception io exception ioexception input output error occurs copy resource resource servlet output stream servletoutputstream ostream iterator range ranges io exception ioexception string content type contenttype resource get resource metadata getresourcemetadata get content type getcontenttype io exception ioexception exception exception ranges has next hasnext input stream inputstream resource input stream resourceinputstream resource adapt to adaptto input stream inputstream input stream inputstream istream buffered input stream bufferedinputstream resource input stream resourceinputstream buffer size range current range currentrange ranges writing mime header ostream println ostream println mime separation mimeseparation content type contenttype ostream println content type content type contenttype ostream println content range bytes current range currentrange start current range currentrange current range currentrange length ostream println copy content copy istream ostream current range currentrange io exception ioexception exception close silently closesilently istream ostream println ostream print mime separation mimeseparation exception exception copy contents input stream output stream param istream input stream read param ostream output stream write param range range client wanted retrieve exception io exception ioexception input output error occurs copy input stream inputstream istream output stream outputstream ostream range range io exception ioexception http range included end index endindex range log debug copy serving bytes range start end index endindex static copy range staticcopyrange istream ostream range start end index endindex method unit testing easier static copy range staticcopyrange input stream inputstream istream output stream outputstream ostream start io exception ioexception position buffer buffer size position start skipped istream skip start position skipped skip reason was n wasn advance stream cases fall read force skip ping skipping bytes len math min start position buffer length skipped istream read buffer len skipped io exception ioexception failed skip start bytes skipped position bytes position skipped position len math min position buffer length read istream read buffer len read position read ostream write buffer read parse range header param request servlet request processing param response servlet response creating array list arraylist ranges parsed range header link full full resource returned code code error occurred parsing header request finished sending error status array list arraylist range parse range parserange http servlet request httpservletrequest request http servlet response httpservletresponse response resource metadata resourcemetadata metadata io exception ioexception checking range string header value headervalue request get header getheader range header value headervalue header value time headervaluetime header value time headervaluetime request get date header getdateheader range illegal argument exception illegalargumentexception header value time headervaluetime sling etag support full range full metadata get modification time getmodificationtime header value time headervaluetime returned full file length filelength metadata get content length getcontentlength file length filelength full retrieving range header string range header rangeheader request get header getheader range range header rangeheader full adding range header rangeheader starts with startswith bytes fail parse range failparserange response file length filelength range header rangeheader range header rangeheader range header rangeheader substring vector ranges parsed array list arraylist range result array list arraylist range string tokenizer stringtokenizer comma tokenizer commatokenizer string tokenizer stringtokenizer range header rangeheader parsing range list comma tokenizer commatokenizer has more tokens hasmoretokens string range definition rangedefinition comma tokenizer commatokenizer next token nexttoken trim range current range currentrange range current range currentrange length file length filelength dash pos dashpos range definition rangedefinition index of indexof dash pos dashpos fail parse range failparserange response file length filelength range header rangeheader dash pos dashpos offset parse long parselong range definition rangedefinition current range currentrange start file length filelength offset current range currentrange file length filelength number format exception numberformatexception fail parse range failparserange response file length filelength range header rangeheader current range currentrange start parse long parselong range definition rangedefinition substring dash pos dashpos dash pos dashpos range definition rangedefinition length current range currentrange parse long parselong range definition rangedefinition substring dash pos dashpos range definition rangedefinition length current range currentrange file length filelength number format exception numberformatexception fail parse range failparserange response file length filelength range header rangeheader current range currentrange validate fail parse range failparserange response file length filelength range header rangeheader result add current range currentrange result s ends sends error response client range header accept able acceptable fail parse range failparserange http servlet response httpservletresponse response file length filelength string range header rangeheader io exception ioexception log error parse range parserange support range sending range header rangeheader response add header addheader content range bytes file length filelength response send error senderror http servlet response httpservletresponse requested range satisfiable close silently closesilently closeable close able closeable close able closeable close able closeable close io exception ioexception ignore range start length validate range code range valid code validate length length start start length