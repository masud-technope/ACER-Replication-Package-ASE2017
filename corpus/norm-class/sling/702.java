licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling form impl java file java i o exception ioexception java unsupported encoding exception unsupportedencodingexception java security invalid key exception invalidkeyexception java security no such algorithm exception nosuchalgorithmexception java util dictionary java util hash map hashmap javax jcr credentials javax jcr simple credentials simplecredentials javax servlet servlet javax servlet servlet exception servletexception javax servlet http cookie javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse javax servlet http http session httpsession org apache commons code c codec binary base org apache felix jaas login module factory loginmodulefactory org apache felix scr annotations component org apache felix scr annotations deactivate org apache felix scr annotations properties org apache felix scr annotations property org apache felix scr annotations property option propertyoption org apache felix scr annotations reference org apache felix scr annotations reference cardinality referencecardinality org apache felix scr annotations reference policy referencepolicy org apache felix scr annotations service org apache sling api authenticator org apache sling api resource login exception loginexception org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling api resource resource resolver factory resourceresolverfactory org apache sling core auth constants authconstants org apache sling core auth util authutil org apache sling core spi authentication handler authenticationhandler org apache sling core spi authentication info authenticationinfo org apache sling core spi default authentication feedback handler defaultauthenticationfeedbackhandler org apache sling form form reason formreason org apache sling form impl jaas form credentials formcredentials org apache sling form impl jaas jaas helper jaashelper org apache sling commons osgi osgi util osgiutil org osgi framework bundle context bundlecontext org osgi framework constants org osgi framework service registration serviceregistration org osgi service component component context componentcontext org slf logger org slf logger factory loggerfactory code form authentication handler formauthenticationhandler code auth orization authorization steps based cookie component label form description form description metatype org apache sling form form authentication handler formauthenticationhandler properties property constants service description apache sling form based authentication handler property authentication handler authenticationhandler path property cardinality property authentication handler authenticationhandler type property http servlet request httpservletrequest form property private propertyprivate property constants service ranking int value intvalue property private propertyprivate property login module factory loginmodulefactory jaas control flag sufficient property login module factory loginmodulefactory jaas realm jackrabbit oak property login module factory loginmodulefactory jaas ranking int value intvalue service form authentication handler formauthenticationhandler default authentication feedback handler defaultauthenticationfeedbackhandler authentication handler authenticationhandler parameter providing login form url property authentication form servlet authenticationformservlet servlet path string par login form form login form link par storage parameter indicating cookie store authentication data string storage cookie cookie link par storage parameter indicating session attribute store authentication data string storage session attribute session determine cookie session attribute string storage storage cookie property storage options property option propertyoption storage cookie cookie property option propertyoption storage session attribute session attribute string par storage form storage cookie session attribute par string sling form auth formauth configuration parameter providing cookie session attribute property string par form link par credentials attribute property string credentials attribute simple credentials simplecredentials attribute holds info extracted cookie property credentials attribute string par credentials attribute form credentials authentication data time par timeout timeout number minutes login session times expiry time authentication data property int value intvalue timeout string par timeout form timeout string token file cookie tokens bin file persist security tokens property token file string par token file form token file token fast seed secure faster see ding seeding mechanism see d seed random number generator link token store tokenstore faster mechanism disabled platform see ding seeding block startup consider ably considerably linux solaris platforms blocking secure code dev random code dev ice device see ding seeding property bool value boolvalue token fast seed string par token fast seed form token fast seed fastseed include par include form include form redirect login form simple include property bool value boolvalue include form string par include form form include login expire cookie par login expire login expire login form users cookie expires form property bool value boolvalue login expire string par login expire form one xpire onexpire login domain cookie cookie storage property string par cookie domain form cookie domain request method required user password sub mission submission form post string request method post segment request url user password sub mission submission form security check derived prescription servlet api specification srv login form notes order authentication proceed app ropriately appropriately action login form code security check code string request url suffix security check form sub mission submission parameter providing user authenticate username prescribed servlet api specification srv form based authentication string par use rname username username form sub mission submission parameter providing password user authenticate password prescribed servlet api specification srv form based authentication string par password password key authentication info authenticationinfo map domain cookie string cookie domain cookie domain factor convert minute numbers milliseconds int ernally internally minutes log logger log logger factory loggerfactory get logger getlogger get class getclass authentication storage authenticationstorage auth storage authstorage string login form loginform timeout login session milliseconds converted configuration property link par timeout multiplying link minutes session timeout sessiontimeout credentials attribute cookie data validate string attr cookie auth data attrcookieauthdata link token store tokenstore persist check authentication data token store tokenstore token store tokenstore link form login module plugin formloginmoduleplugin service registration created authentication handler registered login module plugin created field code code service registration serviceregistration login module loginmodule handler attempt include login form redirect include login form includeloginform resource resolver factory resolve login form resource reference policy reference policy referencepolicy dynamic cardinality reference cardinality referencecardinality optional unary resource resolver factory resourceresolverfactory resource resolver factory resourceresolverfactory login form presented token expires login after expire loginafterexpire jaas helper jaashelper jaas helper jaashelper extra cts extracts cookie session based credentials request returns code code handler assumes http basic authentication form fields request secure user data cookie http session authentication info authenticationinfo extract credentials extractcredentials http servlet request httpservletrequest request http servlet response httpservletresponse response authentication info authenticationinfo info credentials post request parameters info extract request parameter authentication extractrequestparameterauthentication request credentials cookie session info string auth data authdata auth storage authstorage extract authentication info extractauthenticationinfo request auth data authdata token store tokenstore is valid isvalid auth data authdata info create auth info createauthinfo auth data authdata clear cookie invalid rid invalid cookie isn auth n authn operation auth storage authstorage clear request response login after expire loginafterexpire auth util authutil is validate request isvalidaterequest request signal request credentials requestcredentials method previous login failure request set attribute setattribute failure reason form reason formreason timeout info authentication info authenticationinfo fail info code sling auth request login authrequestlogin code code form code method sends forbidden response code verify code parameter code code redirects login form credentials method assumes code verify code request parameter initial username password sub mission submission login form checks applied sending forbidden response request credentials requestcredentials http servlet request httpservletrequest request http servlet response httpservletresponse response i o exception ioexception ignore handler authentication handler requested ignore request credentials ignorerequestcredentials request handler check ref errer referrer request handler auth util authutil check ref erer checkreferer request login form loginform handler string resource auth util authutil set login resource attribute setloginresourceattribute request request getrequesturi include login form includeloginform resource resolver factory resourceresolverfactory resource resolver resourceresolver resource resolver resourceresolver resource resolver resourceresolver resource resolver factory resourceresolverfactory get administrative resource resolver getadministrativeresourceresolver resource login form resource loginformresource resource resolver resourceresolver resolve login form loginform servlet login form servlet loginformservlet login form resource loginformresource adapt to adaptto servlet login form servlet loginformservlet login form servlet loginformservlet service request response servlet exception servletexception log error failed include form login form loginform login exception loginexception log error unable resource resolver include login resource redirect resource resolver resourceresolver resource resolver resourceresolver close hash map hashmap string string params hash map hashmap string string params authenticator login resource resource append indication previous login failure request get attribute getattribute failure reason object j reason jreason request get attribute getattribute failure reason suppress warnings suppresswarnings rawtypes string reason j reason jreason enum enum j reason jreason j reason jreason to string tostring params failure reason reason auth util authutil send redirect sendredirect request response login form loginform params i o exception ioexception log error failed redirect login form login form loginform clears authentication prepared authentication handler drop credentials dropcredentials http servlet request httpservletrequest request http servlet response httpservletresponse response auth storage authstorage clear request response authentication feedback handler authenticationfeedbackhandler called unsuccessful login attempt implementation authentication data removed removing cookie remove http session attribute override authentication failed authenticationfailed http servlet request httpservletrequest request http servlet response httpservletresponse response authentication info authenticationinfo auth info authinfo note method called handler credentials login failure clear authentication data cookie http session auth storage authstorage clear request response signal reason login failure request set attribute setattribute failure reason form reason formreason invalid credentials called successful login authentication info implementation ensures authentication data cookie http session correct security tokens authentication data exists created data expired data updated security token expiry time creating updating authentication data fails removed cookie http session requests authenticated longer override authentication succeeded authenticationsucceeded http servlet request httpservletrequest request http servlet response httpservletresponse response authentication info authenticationinfo auth info authinfo note method called handler credentials succeeded login repository ensure fresh authentication data refresh auth data refreshauthdata request response auth info authinfo result security check url request method equals request get method getmethod request getrequesturi ends with endswith request url suffix default authentication feedback handler defaultauthenticationfeedbackhandler handle redirect handleredirect request response terminate request handler result check redirect requested resource parameter string target resource targetresource auth util authutil get login resource getloginresource request target resource targetresource response is committed iscommitted illegal state exception illegalstateexception response committed response reset buffer resetbuffer string builder stringbuilder string builder stringbuilder auth util authutil is redirect valid isredirectvalid request target resource targetresource append target resource targetresource request get context path getcontextpath length append append request get context path getcontextpath response send redirect sendredirect to string tostring i o exception ioexception ioe log error failed send redirect target resource targetresource ioe terminate request result redirect processing result redirect processing result redirect result override string to string tostring form based authentication handler force http basic returns code code authentication handler ignore call link request credentials requestcredentials http servlet request httpservletrequest http servlet response httpservletresponse method returns code code link request login parameter form http servlet request httpservletrequest form ignore request credentials ignorerequestcredentials http servlet request httpservletrequest request string request login requestlogin request get parameter getparameter request login parameter request login requestlogin http servlet request httpservletrequest form equals request login requestlogin ensures authentication data expiry time pro longed prolonged data existed method intended called authentication succeeded param request current request param response current response param auth info authinfo authentication info successful log refresh auth data refreshauthdata http servlet request httpservletrequest request http servlet response httpservletresponse response authentication info authenticationinfo auth info authinfo current authentication data missing login string auth data authdata get cookie auth data getcookieauthdata auth info authinfo check store create data refresh cookie refreshcookie needs refresh needsrefresh auth data authdata session timeout sessiontimeout add refresh stored hash refresh cookie refreshcookie expires system current time millis currenttimemillis session timeout sessiontimeout auth data authdata auth data authdata token store tokenstore encode expires auth info authinfo get user getuser invalid key exception invalidkeyexception log error get message getmessage illegal state exception illegalstateexception log error get message getmessage unsupported encoding exception unsupportedencodingexception log error get message getmessage no such algorithm exception nosuchalgorithmexception log error get message getmessage auth data authdata auth storage authstorage request response auth data authdata auth info authinfo auth storage authstorage clear request response request parameter authentication info authenticationinfo extract request parameter authentication extractrequestparameterauthentication http servlet request httpservletrequest request authentication info authenticationinfo info security check url request method equals request get method getmethod request getrequesturi ends with endswith request url suffix string user request get parameter getparameter par use rname username string pwd request get parameter getparameter par password user pwd info authentication info authenticationinfo http servlet request httpservletrequest form user pwd to char array tochararray info auth constants authconstants info login object validation request auth util authutil is validate request isvalidaterequest request auth util authutil set login resource attribute setloginresourceattribute request request get context path getcontextpath info authentication info authenticationinfo create auth info createauthinfo string auth data authdata string user id userid get user id getuserid auth data authdata user id userid authentication info authenticationinfo info authentication info authenticationinfo http servlet request httpservletrequest form user id userid jaas helper jaashelper enabled jcr resource constants jcrresourceconstants authentication info credentials info user jcr credentials form credentials formcredentials user id userid auth data authdata info attr cookie auth data attrcookieauthdata auth data authdata info string get cookie auth data getcookieauthdata authentication info authenticationinfo info object data info attr cookie auth data attrcookieauthdata data string string data login module plugin loginmoduleplugin support string get cookie auth data getcookieauthdata credentials credentials credentials simple credentials simplecredentials object data simple credentials simplecredentials credentials get attribute getattribute attr cookie auth data attrcookieauthdata data string string data credentials form credentials formcredentials form credentials formcredentials credentials get auth data getauthdata simple credentials simplecredentials valid attribute has auth data hasauthdata credentials credentials get cookie auth data getcookieauthdata credentials is valid isvalid credentials credentials string auth data authdata get cookie auth data getcookieauthdata credentials auth data authdata token store tokenstore is valid isvalid auth data authdata auth data authdata valid scr int egration integration called scr activate authentication handler invalid key exception invalidkeyexception no such algorithm exception nosuchalgorithmexception illegal state exception illegalstateexception unsupported encoding exception unsupportedencodingexception activate component context componentcontext component context componentcontext invalid key exception invalidkeyexception no such algorithm exception nosuchalgorithmexception illegal state exception illegalstateexception unsupported encoding exception unsupportedencodingexception dictionary properties component context componentcontext get properties getproperties jaas helper jaashelper jaas helper jaashelper component context componentcontext get bundle context getbundlecontext properties login form loginform osgi util osgiutil to string tostring properties par login form authentication form servlet authenticationformservlet servlet path log info login form url login form loginform string auth name authname osgi util osgiutil to string tostring properties par string default cookie domain defaultcookiedomain osgi util osgiutil to string tostring properties par cookie domain default cookie domain defaultcookiedomain length default cookie domain defaultcookiedomain string auth storage authstorage osgi util osgiutil to string tostring properties par storage storage storage session attribute equals auth storage authstorage auth storage authstorage session storage sessionstorage auth name authname log info http session store attribute auth name authname auth storage authstorage cookie storage cookiestorage auth name authname default cookie domain defaultcookiedomain log info cookie store auth name authname attr cookie auth data attrcookieauthdata osgi util osgiutil to string tostring properties par credentials attribute credentials attribute log info setting data attribute attr cookie auth data attrcookieauthdata timeout min utes timeoutminutes osgi util osgiutil to integer tointeger properties par timeout timeout timeout min utes timeoutminutes timeout min utes timeoutminutes timeout log info setting session timeout minutes timeout min utes timeoutminutes session timeout sessiontimeout minutes timeout min utes timeoutminutes string token file name tokenfilename osgi util osgiutil to string tostring properties par token file token file file token file tokenfile get token file gettokenfile token file name tokenfilename component context componentcontext get bundle context getbundlecontext fast see d fastseed osgi util osgiutil to boolean toboolean properties par token fast seed token fast seed log info storing tokens token file tokenfile get absolute path getabsolutepath token store tokenstore token store tokenstore token file tokenfile session timeout sessiontimeout fast see d fastseed login module loginmodule jaas helper jaashelper enabled login module loginmodule form login module plugin formloginmoduleplugin register component context componentcontext get bundle context getbundlecontext throwable log info register form login module plugin formloginmoduleplugin expected sling login module plugin loginmoduleplugin services supported log debug dump include login form includeloginform osgi util osgiutil to boolean toboolean properties par include form include form login after expire loginafterexpire osgi util osgiutil to boolean toboolean properties par login expire login expire deactivate deactivate jaas helper jaashelper jaas helper jaashelper close jaas helper jaashelper login module loginmodule login module loginmodule unregister login module loginmodule returns absolute file indicating file persist security tokens method api enable unit tests param token file name tokenfilename configured file param bundle context bundlecontext bundle context bundlecontext relative file absolute absolute file file get token file gettokenfile string token file name tokenfilename bundle context bundlecontext bundle context bundlecontext file token file tokenfile file token file name tokenfilename token file tokenfile is absolute isabsolute token file tokenfile token file tokenfile bundle context bundlecontext get data file getdatafile token file name tokenfilename token file tokenfile string sling home slinghome bundle context bundlecontext get property getproperty sling sling home slinghome token file tokenfile file sling home slinghome token file name tokenfilename token file tokenfile file token file name tokenfilename token file tokenfile get absolute file getabsolutefile returns user authentication data authentication data code code fields separated sign field returned code code returned method api enable unit tests param auth data authdata string get user id getuserid string auth data authdata auth data authdata string parts token store tokenstore split auth data authdata parts parts refresh cookie per iodically periodically param session timeout sessiontimeout time live session needs refresh needsrefresh string auth data authdata session timeout sessiontimeout update cookie updatecookie auth data authdata update cookie updatecookie string parts token store tokenstore split auth data authdata parts parts length cookie time cookietime parse long parselong parts substring system current time millis currenttimemillis session timeout sessiontimeout cookie time cookietime update cookie updatecookie update cookie updatecookie code authentication storage authenticationstorage code abst racts abstracts api required store authentication data http cookie http session concrete link cookie storage cookiestorage link session storage sessionstorage selected link form authentication handler formauthenticationhandler par storage configuration parameter link cookie storage cookiestorage authentication storage authenticationstorage string extract authentication info extractauthenticationinfo http servlet request httpservletrequest request http servlet request httpservletrequest request http servlet response httpservletresponse response string auth data authdata authentication info authenticationinfo info clear http servlet request httpservletrequest request http servlet response httpservletresponse response code cookie storage cookiestorage code supports storing authentication data http cookie cookie storage cookiestorage authentication storage authenticationstorage cookie header manage login cookie cookie storage cookiestorage set cookie setcookie http servlet request httpservletrequest http servlet response httpservletresponse string string string string header cookie cookie string cookie name cookiename string domain cookie name domaincookiename string default cookie domain defaultcookiedomain cookie storage cookiestorage string cookie name cookiename string default cookie domain defaultcookiedomain cookie name cookiename cookie name cookiename domain cookie name domaincookiename cookie name cookiename cookie domain default cookie domain defaultcookiedomain default cookie domain defaultcookiedomain string extract authentication info extractauthenticationinfo http servlet request httpservletrequest request cookie cookies request get cookies getcookies cookies cookie cookie cookies cookie name cookiename equals cookie get name getname cookie extract credentials reverse base encoding string cookie get value getvalue length string base decode base decodebase utf unsupported encoding exception unsupportedencodingexception runtime exception runtimeexception http servlet request httpservletrequest request http servlet response httpservletresponse response string auth data authdata authentication info authenticationinfo info base encode handle special characters string cookie value cookievalue cookie value cookievalue base encode base encodebase url safe string urlsafestring auth data authdata get bytes getbytes utf unsupported encoding exception unsupportedencodingexception runtime exception runtimeexception send cookie response string cookie domain cookiedomain string info cookie domain cookie domain cookiedomain cookie domain cookiedomain length cookie domain cookiedomain default cookie domain defaultcookiedomain set cookie setcookie request response cookie name cookiename cookie value cookievalue cookie domain cookiedomain send cookie domain cookie domain cookie domain cookiedomain set cookie setcookie request response domain cookie name domaincookiename cookie domain cookiedomain cookie domain cookiedomain clear http servlet request httpservletrequest request http servlet response httpservletresponse response cookie old cookie oldcookie string old cookie domain oldcookiedomain cookie cookies request get cookies getcookies cookies cookie cookie cookies cookie name cookiename equals cookie get name getname cookie old cookie oldcookie cookie domain cookie name domaincookiename equals cookie get name getname old cookie domain oldcookiedomain cookie get value getvalue remove cookie client old cookie oldcookie set cookie setcookie request response cookie name cookiename old cookie domain oldcookiedomain old cookie domain oldcookiedomain old cookie domain oldcookiedomain length set cookie setcookie request response domain cookie name domaincookiename old cookie domain oldcookiedomain set cookie setcookie http servlet request httpservletrequest request http servlet response httpservletresponse response string string age string domain string ctx path ctxpath request get context path getcontextpath string cookie path cookiepath ctx path ctxpath ctx path ctxpath length ctx path ctxpath servlet spec commonly http only httponly attribute cookies servlet api create cookie header manually http owasp org php http only httponly http only httponly attribute string builder stringbuilder header string builder stringbuilder setup cookie path http only httponly header append append append header append path append cookie path cookiepath don access header append http only httponly cookie domain configured domain header append domain append domain max age attribute remove cookie age header append max age append age ensure cookie secured https request request is secure issecure header append secure response add header addheader header cookie header to string tostring code session storage sessionstorage code support store authentication data http session session storage sessionstorage authentication storage authenticationstorage string session attribute name sessionattributename session storage sessionstorage string session attribute name sessionattributename session attribute name sessionattributename session attribute name sessionattributename string extract authentication info extractauthenticationinfo http servlet request httpservletrequest request http session httpsession session request get session getsession session object attribute session get attribute getattribute session attribute name sessionattributename attribute string string attribute http servlet request httpservletrequest request http servlet response httpservletresponse response string auth data authdata authentication info authenticationinfo info store hash session attribute http session httpsession session request get session getsession session set attribute setattribute session attribute name sessionattributename auth data authdata clear http servlet request httpservletrequest request http servlet response httpservletresponse response http session httpsession session request get session getsession session session remove attribute removeattribute session attribute name sessionattributename