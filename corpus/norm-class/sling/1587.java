licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling discovery base connectors ping java buffered reader bufferedreader java byte array input stream bytearrayinputstream java i o exception ioexception java string reader stringreader java lang reflect field java util hash map hashmap java util map javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse org apache http http entity httpentity org apache http http response httpresponse org apache http client methods http put httpput org apache http message basic header basicheader org apache sling discovery base connectors base config baseconfig org apache sling discovery base setup mock simple connector config simpleconnectorconfig org hamcrest description org jmock expectations org jmock mockery org jmock api action org jmock api invocation org jmock int egration integration junit j unit junit mockery org junit org junit org junit test topology request validator test topologyrequestvalidatortest topology request validator topologyrequestvalidator topology request validator topologyrequestvalidator mockery context j unit junit mockery security exception securityexception illegal argument exception illegalargumentexception no such field exception nosuchfieldexception illegal access exception illegalaccessexception base config baseconfig config simple connector config simpleconnectorconfig set private setprivate config shared key sharedkey test key testkey set private setprivate config hmac enabled hmacenabled set private setprivate config encryption enabled encryptionenabled set private setprivate config key interval keyinterval topology request validator topologyrequestvalidator topology request validator topologyrequestvalidator config set private setprivate object string field object security exception securityexception no such field exception nosuchfieldexception illegal argument exception illegalargumentexception illegal access exception illegalaccessexception field get class getclass get declared field getdeclaredfield field is accessible isaccessible set accessible setaccessible test test trust request testtrustrequest i o exception ioexception http put httpput method http put httpput test uri testuri string clear message clearmessage test message testmessage string message topology request validator topologyrequestvalidator encode message encodemessage clear message clearmessage assert not null assertnotnull message assert not equals assertnotequals message clear message clearmessage topology request validator topologyrequestvalidator trust message trustmessage method message assert not null assertnotnull method get first header getfirstheader topology request validator topologyrequestvalidator hash header assert not null assertnotnull method get first header getfirstheader topology request validator topologyrequestvalidator hash header get value getvalue assert true asserttrue method get first header getfirstheader topology request validator topologyrequestvalidator hash header get value getvalue length assert not null assertnotnull method get first header getfirstheader topology request validator topologyrequestvalidator sig header assert not null assertnotnull method get first header getfirstheader topology request validator topologyrequestvalidator sig header get value getvalue assert true asserttrue method get first header getfirstheader topology request validator topologyrequestvalidator sig header get value getvalue length http servlet request httpservletrequest request context mock http servlet request httpservletrequest context checking expectations allowing request get header getheader topology request validator topologyrequestvalidator hash header return value returnvalue method get first header getfirstheader topology request validator topologyrequestvalidator hash header get value getvalue allowing request get header getheader topology request validator topologyrequestvalidator sig header return value returnvalue method get first header getfirstheader topology request validator topologyrequestvalidator sig header get value getvalue allowing request get header getheader content encoding return value returnvalue allowing request getrequesturi return value returnvalue method geturi get path getpath allowing request get reader getreader return value returnvalue buffered reader bufferedreader string reader stringreader message assert true asserttrue topology request validator topologyrequestvalidator is trusted istrusted request assert equals assertequals clear message clearmessage topology request validator topologyrequestvalidator decode message decodemessage request test test trust response testtrustresponse i o exception ioexception http servlet request httpservletrequest request context mock http servlet request httpservletrequest context checking expectations allowing request getrequesturi return value returnvalue test uri http servlet response httpservletresponse response context mock http servlet response httpservletresponse map object object headers hash map hashmap object object context checking expectations allowing response set header setheader string string action describe to describeto description desc desc append text appendtext setting header object invoke invocation invocation throwable headers invocation get parameter getparameter invocation get parameter getparameter string clear message clearmessage test message testmessage string message topology request validator topologyrequestvalidator encode message encodemessage clear message clearmessage topology request validator topologyrequestvalidator trust message trustmessage response request message http entity httpentity response entity responseentity context mock http entity httpentity context checking expectations allowing response entity responseentity get content getcontent return value returnvalue byte array input stream bytearrayinputstream message get bytes getbytes http response httpresponse resp context mock http response httpresponse context checking expectations allowing resp get first header getfirstheader string action describe to describeto description desc desc append text appendtext header object invoke invocation invocation throwable basic header basicheader string invocation get parameter getparameter string headers invocation get parameter getparameter allowing resp get entity getentity return value returnvalue response entity responseentity topology request validator topologyrequestvalidator is trusted istrusted resp topology request validator topologyrequestvalidator decode message decodemessage test uri resp