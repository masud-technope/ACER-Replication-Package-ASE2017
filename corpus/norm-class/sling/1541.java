licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling mongodb impl java util hash map hashmap java util hash set hashset java util iterator java util map java util java util regex pattern javax servlet http http servlet request httpservletrequest org apache sling api resource modifying resource provider modifyingresourceprovider org apache sling api resource persistence exception persistenceexception org apache sling api resource queriable resource provider queriableresourceprovider org apache sling api resource resource org apache sling api resource resource provider resourceprovider org apache sling api resource resource resolver resourceresolver org apache sling api resource value map valuemap org slf logger org slf logger factory loggerfactory mongodb basicdbobject mongodb basicdbobjectbuilder mongodb command result commandresult mongodb db collection dbcollection mongodb db cursor dbcursor mongodb db object dbobject mongodb query builder querybuilder mongodb util json mongodb resource provider creates resources based mongodb entries resources properties stored mongodb starting mongodbresourceprovider resource provider resourceprovider modifying resource provider modifyingresourceprovider queriable resource provider queriableresourceprovider special path property relative path resource tree string prop path path property string prop logger logger logger logger factory loggerfactory get logger getlogger get class getclass global context mongodbcontext context map string mongodbresource changed resources changedresources hash map hashmap string mongodbresource string deleted resources deletedresources hash set hashset string mongodbresourceprovider mongodbcontext context context context string prop name to key propnametokey string starts with startswith string key to prop name keytopropname string key key starts with startswith key substring key starts with startswith key org apache sling api resource modifying resource provider modifyingresourceprovider create org apache sling api resource resource resolver resourceresolver java lang string java util map resource create resource resolver resourceresolver resolver string path map string object properties persistence exception persistenceexception string info extract resource info extractresourceinfo path info info length deleted deleted resources deletedresources remove path mongodbresource old resource oldresource mongodbresource get resource getresource resolver path info deleted old resource oldresource persistence exception persistenceexception resource exists path path db object dbobject db obj dbobj basicdbobject db obj dbobj getprop path info properties map entry string object entry properties entry set entryset string key prop name to key propnametokey entry get key getkey db obj dbobj key entry get value getvalue deleted old resource oldresource db obj dbobj prop old resource oldresource get properties getproperties prop mongodbresource rsrc mongodbresource resolver path info db obj dbobj changed resources changedresources path rsrc rsrc persistence exception persistenceexception illegal path unable create resource path path todo handle delete child resources deleted resources parents resource checked min imizes minimizes concurrency issues org apache sling api resource modifying resource provider modifyingresourceprovider delete org apache sling api resource resource resolver resourceresolver java lang string delete resource resolver resourceresolver resolver string path persistence exception persistenceexception string info extract resource info extractresourceinfo path info deleted resource deletedresource deleted resources deletedresources path resource rsrc get resource getresource resolver path info rsrc mongodbresource deleted resources deletedresources add path changed resources changedresources remove path db collection dbcollection col get collection getcollection info string pattern pattern quote info db object dbobject query query builder querybuilder start getprop path regex pattern compile pattern db cursor dbcursor cur col find query cur has next hasnext db object dbobject db obj dbobj cur string child path childpath info db obj dbobj getprop path deleted resources deletedresources add child path childpath changed resources changedresources remove child path childpath deleted resource deletedresource deleted resource deletedresource deleted resource deletedresource string prefix path iterator map entry string mongodbresource changed resources changedresources entry set entryset iterator has next hasnext map entry string mongodbresource entry entry get key getkey starts with startswith prefix remove persistence exception persistenceexception unable delete resource path path org apache sling api resource modifying resource provider modifyingresourceprovider revert resource resolver resourceresolver revert resource resolver resourceresolver resolver changed resources changedresources clear deleted resources deletedresources clear org apache sling api resource modifying resource provider modifyingresourceprovider commit resource resolver resourceresolver commit resource resolver resourceresolver resolver persistence exception persistenceexception string deleted deleted resources deletedresources string info extract resource info extractresourceinfo deleted check collection exists db collection dbcollection col get collection getcollection info col col find and remove findandremove query builder querybuilder start getprop path info context notify removed notifyremoved info mongodbresource changed changed resources changedresources values db collection dbcollection col context get data base getdatabase get collection getcollection changed get collection getcollection col string info string changed get collection getcollection changed get properties getproperties getprop path to string tostring create update changed get properties getproperties prop col update query builder querybuilder start getprop path changed get properties getproperties getprop path changed get properties getproperties context notify updated notifyupdated info create col save changed get properties getproperties context notify updated notifyupdated info persistence exception persistenceexception unable create collection changed get collection getcollection changed get path getpath revert resolver org apache sling api resource modifying resource provider modifyingresourceprovider has changes haschanges resource resolver resourceresolver has changes haschanges resource resolver resourceresolver resolver changed resources changedresources size deleted resources deletedresources size org apache sling api resource resource provider resourceprovider get resource getresource org apache sling api resource resource resolver resourceresolver java lang string resource get resource getresource resource resolver resourceresolver resource resolver resourceresolver string path deleted resources deletedresources path changed resources changedresources contains key containskey path mongodbresource changed resources changedresources path string info extract resource info extractresourceinfo path info get resource getresource resource resolver resourceresolver path info info rm inform resource changed mongodbresource resource deleted resources deletedresources remove resource get path getpath changed resources changedresources resource get path getpath resource todo check deleted resources org apache sling api resource resource provider resourceprovider list children listchildren org apache sling api resource resource iterator resource list children listchildren resource parent string info extract resource info extractresourceinfo parent get path getpath info info length collections string names hash set hashset string context get data base getdatabase get collection names getcollectionnames names remove all removeall context get filter collection names getfiltercollectionnames iterator string names iterator iterator resource has next hasnext has next hasnext resource string mongodbcollectionresource parent get resource resolver getresourceresolver parent get path getpath remove unsupported operation exception unsupportedoperationexception remove db collection dbcollection col get collection getcollection info col string pattern info length pattern pattern pattern quote info db object dbobject query query builder querybuilder start getprop path regex pattern compile pattern db cursor dbcursor cur col find query sort basicdbobjectbuilder start getprop path iterator resource has next hasnext cur has next hasnext resource db object dbobject obj cur string obj path objpath obj getprop path to string tostring last slash lastslash obj path objpath last index of lastindexof string last slash lastslash obj path objpath obj path objpath substring last slash lastslash mongodbresource parent get resource resolver getresourceresolver parent get path getpath info obj mongodbresourceprovider remove unsupported operation exception unsupportedoperationexception remove org apache sling api resource resource provider resourceprovider get resource getresource org apache sling api resource resource resolver resourceresolver javax servlet http http servlet request httpservletrequest java lang string suppress warnings suppresswarnings javadoc resource get resource getresource resource resolver resourceresolver resource resolver resourceresolver http servlet request httpservletrequest request string path get resource getresource resource resolver resourceresolver path extract info collection path string extract resource info extractresourceinfo string path path starts with startswith context get root with slash getrootwithslash path length context get root with slash getrootwithslash length special resource collections string string info path substring context get root with slash getrootwithslash length slash pos slashpos info index of indexof slash pos slashpos string info substring slash pos slashpos info substring slash pos slashpos special resource collection string info path equals context get root getroot special resource collections string check collection exists has collection hascollection string logger info mongo collection names string names context get data base getdatabase get collection names getcollectionnames names context is filter collection name isfiltercollectionname check collection exists db collection dbcollection get collection getcollection string has collection hascollection context get data base getdatabase get collection getcollection resource resource get resource getresource resource resolver resourceresolver resource resolver resourceresolver string path string info info length special resource collections mongodbcollectionresource resource resolver resourceresolver path info length special resource collection has collection hascollection info mongodbcollectionresource resource resolver resourceresolver path logger debug searching info info db collection dbcollection col get collection getcollection info col db object dbobject obj col find one findone query builder querybuilder start getprop path info logger debug obj obj mongodbresource resource resolver resourceresolver path info obj check newer object path db object dbobject getupdateddbobject string path db object dbobject db obj dbobj mongodbresource stored changed resources changedresources path stored stored get properties getproperties db obj dbobj string get deleted resources getdeletedresources deleted resources deletedresources map string mongodbresource get changed resources getchangedresources changed resources changedresources mongodbcontext get context getcontext context string getprop path prop path iterator resource find resources findresources resource resolver resourceresolver resolver string query string language language equals mongodb query query length query index of indexof find iterator resource return value returnvalue string collection name collectionname query substring query index of indexof find db collection dbcollection col get collection getcollection collection name collectionname col string criteria query trim substring query index of indexof find query length db object dbobject db object dbobject db object dbobject json parse criteria db cursor dbcursor cur col find db object dbobject string root path rootpath context get root with slash getrootwithslash iterator resource has next hasnext cur has next hasnext resource db object dbobject obj cur string obj path objpath obj getprop path to string tostring last slash lastslash obj path objpath last index of lastindexof string last slash lastslash obj path objpath obj path objpath substring last slash lastslash mongodbresource resolver root path rootpath collection name collectionname collection name collectionname obj mongodbresourceprovider remove unsupported operation exception unsupportedoperationexception remove return value returnvalue iterator value map valuemap query resources queryresources resource resolver resourceresolver resolver string query string language