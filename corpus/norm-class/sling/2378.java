licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling testing mock sling java io exception ioexception java input stream inputstream java input stream reader inputstreamreader java reader java net url java util array list arraylist java util enumeration java util iterator java util list java util jar attributes java util jar jar file jarfile java util jar manifest javax jcr name space registry namespaceregistry javax jcr repository exception repositoryexception javax jcr session javax jcr javax jcr value factory valuefactory javax jcr workspace javax jcr node type nodetype node definition nodedefinition javax jcr node type nodetype node definition template nodedefinitiontemplate javax jcr node type nodetype node type nodetype javax jcr node type nodetype node type definition nodetypedefinition javax jcr node type nodetype node type iterator nodetypeiterator javax jcr node type nodetype node type manager nodetypemanager javax jcr node type nodetype node type template nodetypetemplate javax jcr node type nodetype property definition propertydefinition javax jcr node type nodetype property definition template propertydefinitiontemplate org apache commons io utils ioutils org apache commons lang string utils stringutils org apache jackrabbit commons cnd cnd importer cndimporter org apache jackrabbit commons cnd comp act node type def reader compactnodetypedefreader org apache jackrabbit commons cnd definition builder factory definitionbuilderfactory org apache jackrabbit commons cnd template builder factory templatebuilderfactory org slf logger org slf logger factory loggerfactory singleton fetches node type definitions osg i osgi bundle manifest files sling node types nodetypes definitions classpath add itionally additionally support registering jcr repository node type definition scanner nodetypedefinitionscanner node type definition scanner nodetypedefinitionscanner singleton node type definition scanner nodetypedefinitionscanner max iterations logger log logger factory loggerfactory get logger getlogger node type definition scanner nodetypedefinitionscanner list string node type definitions nodetypedefinitions node type definition scanner nodetypedefinitionscanner node type definitions nodetypedefinitions find e node type definitions findenodetypedefinitions node type definitions classpath registered osg i osgi bundle headers list string get node type definitions getnodetypedefinitions node type definitions nodetypedefinitions registers node types classpath jcr repository param session session param node type mode nodetypemode node type mode repository exception repositoryexception repository exception register session session node type mode nodetypemode node type mode nodetypemode repository exception repositoryexception list string node type resources nodetyperesources get node type definitions getnodetypedefinitions register session node type resources nodetyperesources node type mode nodetypemode registers node types classpath jcr repository param session session param node type resources nodetyperesources list classpath resource url s urls pointing node type definitions param node type mode nodetypemode node type mode repository exception repositoryexception repository exception register session session list string node type resources nodetyperesources node type mode nodetypemode node type mode nodetypemode repository exception repositoryexception node type mode nodetypemode supported names paces namespaces register names paces registernamespaces session node type resources nodetyperesources node types nodetypes required register node types registernodetypes session node type resources nodetyperesources illegal argument exception illegalargumentexception node type mode supported node type mode nodetypemode registers names paces namespaces node type definitions classpath jcr repository param session session param node type resources nodetyperesources list classpath resource url s urls pointing node type definitions register names paces registernamespaces session session list string node type resources nodetyperesources repository exception repositoryexception class loader classloader class loader classloader get class getclass get class loader getclassloader workspace workspace session get workspace getworkspace name space registry namespaceregistry namespace registry namespaceregistry workspace get name space registry getnamespaceregistry value factory valuefactory value factory valuefactory session get value factory getvaluefactory definition builder factory definitionbuilderfactory node type template nodetypetemplate name space registry namespaceregistry factory template builder factory templatebuilderfactory dummy node type manager dummynodetypemanager value factory valuefactory namespace registry namespaceregistry string node type resource nodetyperesource node type resources nodetyperesources input stream inputstream class loader classloader get resource as stream getresourceasstream node type resource nodetyperesource reader reader input stream reader inputstreamreader comp act node type def reader compactnodetypedefreader node type template nodetypetemplate name space registry namespaceregistry cnd reader cndreader comp act node type def reader compactnodetypedefreader node type template nodetypetemplate name space registry namespaceregistry reader node type resource nodetyperesource factory name space registry namespaceregistry mapping cnd reader cndreader get name space mapping getnamespacemapping mapping geturis length string uri mapping geturis string prefix mapping get prefix getprefix uri namespace registry namespaceregistry register name space registernamespace prefix uri repository exception repositoryexception throwable log warn unable parse node type definition node type resource nodetyperesource io utils ioutils close quietly closequietly registers node types classpath jcr repository param session session param node type resources nodetyperesources list classpath resource url s urls pointing node type definitions register node types registernodetypes session session list string node type resources nodetyperesources repository exception repositoryexception class loader classloader class loader classloader get class getclass get class loader getclassloader workspace workspace session get workspace getworkspace node type manager nodetypemanager node type manager nodetypemanager workspace get node type manager getnodetypemanager name space registry namespaceregistry namespace registry namespaceregistry workspace get name space registry getnamespaceregistry value factory valuefactory value factory valuefactory session get value factory getvaluefactory registering node types multiple times exact order iteration list string remaining node type resources remainingnodetyperesources array list arraylist string node type resources nodetyperesources remaining node type resources remainingnodetyperesources is empty isempty register node types and remove succeeds registernodetypesandremovesucceeds remaining node type resources remainingnodetyperesources class loader classloader node type manager nodetypemanager namespace registry namespaceregistry value factory valuefactory iteration iteration max iterations remaining node type resources remainingnodetyperesources is empty isempty register node types and remove succeeds registernodetypesandremovesucceeds remaining node type resources remainingnodetyperesources class loader classloader node type manager nodetypemanager namespace registry namespaceregistry value factory valuefactory register node types classpath jcr repository remove succeeded register list param node type resources nodetyperesources list node type nodetype classpath resources param class loader classloader param node type manager nodetypemanager param namespace registry namespaceregistry param value factory valuefactory param log error logerror error log ged logged node type registration failed register node types and remove succeeds registernodetypesandremovesucceeds list string node type resources nodetyperesources class loader classloader class loader classloader node type manager nodetypemanager node type manager nodetypemanager name space registry namespaceregistry namespace registry namespaceregistry value factory valuefactory value factory valuefactory log error logerror iterator string node type resources iterator nodetyperesourcesiterator node type resources nodetyperesources iterator node type resources iterator nodetyperesourcesiterator has next hasnext string node type resource nodetyperesource node type resources iterator nodetyperesourcesiterator input stream inputstream class loader classloader get resource as stream getresourceasstream node type resource nodetyperesource reader reader input stream reader inputstreamreader cnd importer cndimporter register node types registernodetypes reader node type resource nodetyperesource node type manager nodetypemanager namespace registry namespaceregistry value factory valuefactory node type resources iterator nodetyperesourcesiterator remove throwable log error logerror log warn unable register node type node type resource nodetyperesource io utils ioutils close quietly closequietly find node type definition classpath paths searching manifest files classpath reading paths sling node types nodetypes entry order paths entry preserved order multiple bundles define entry deterministic correct dependencies node type definitions list node type definition paths list string find e node type definitions findenodetypedefinitions list string node type definitions nodetypedefinitions array list arraylist string enumeration url res enum resenum node type definition scanner nodetypedefinitionscanner get class loader getclassloader get resources getresources jar file jarfile manifest res enum resenum has more elements hasmoreelements url url url res enum resenum next element nextelement input stream inputstream url open stream openstream manifest manifest manifest attributes main attr ibs mainattribs manifest get main attributes getmainattributes string node type definition list nodetypedefinitionlist main attr ibs mainattribs get value getvalue sling node types nodetypes string node type definition array nodetypedefinitionarray string utils stringutils split node type definition list nodetypedefinitionlist node type definition array nodetypedefinitionarray string node type definition nodetypedefinition node type definition array nodetypedefinitionarray string utils stringutils is blank isblank node type definition nodetypedefinition node type definitions nodetypedefinitions add string utils stringutils trim node type definition nodetypedefinition close throwable log warn unable read jar manifest io exception ioexception log warn unable read jar manifests node type definitions nodetypedefinitions node type definition scanner nodetypedefinitionscanner singleton dummy classes usage comp act node type def reader compactnodetypedefreader underlying jcr mock dummy node type manager dummynodetypemanager node type manager nodetypemanager override node type nodetype get node type getnodetype string node type name nodetypename override has node type hasnodetype string override node type iterator nodetypeiterator get all node types getallnodetypes override node type iterator nodetypeiterator get primary node types getprimarynodetypes override node type iterator nodetypeiterator get mixin node types getmixinnodetypes override node type template nodetypetemplate create node type template createnodetypetemplate dummy node type template dummynodetypetemplate override node type template nodetypetemplate create node type template createnodetypetemplate node type definition nodetypedefinition ntd dummy node type template dummynodetypetemplate override node definition template nodedefinitiontemplate create node definition template createnodedefinitiontemplate dummy node definition template dummynodedefinitiontemplate override property definition template propertydefinitiontemplate create property definition template createpropertydefinitiontemplate dummy property definition template dummypropertydefinitiontemplate override node type nodetype register node type registernodetype node type definition nodetypedefinition ntd allow update allowupdate override node type iterator nodetypeiterator register node types registernodetypes node type definition nodetypedefinition ntds allow update allowupdate override unregister node type unregisternodetype string override unregister node types unregisternodetypes string names dummy node type template dummynodetypetemplate node type template nodetypetemplate override string get name getname override string get declared supertype names getdeclaredsupertypenames override is abstract isabstract override is mixin ismixin override has order able child nodes hasorderablechildnodes override is query able isqueryable override string get primary item name getprimaryitemname override property definition propertydefinition get declared property definitions getdeclaredpropertydefinitions override node definition nodedefinition get declared child node definitions getdeclaredchildnodedefinitions override set name setname string override set declared super type names setdeclaredsupertypenames string names override set abstract setabstract abstract status abstractstatus override set mixin setmixin mixin override set order able child nodes setorderablechildnodes order able orderable override set primary item name setprimaryitemname string override set query able setqueryable query able queryable override list get property definition templates getpropertydefinitiontemplates array list arraylist override list get node definition templates getnodedefinitiontemplates array list arraylist dummy node definition template dummynodedefinitiontemplate node definition template nodedefinitiontemplate override node type nodetype get required primary types getrequiredprimarytypes override string get required primary type names getrequiredprimarytypenames override node type nodetype get default primary type getdefaultprimarytype override string get default primary type name getdefaultprimarytypename override allows same name siblings allowssamenamesiblings override node type nodetype get declaring node type getdeclaringnodetype override string get name getname override is auto created isautocreated override is mandatory ismandatory override get on parent version getonparentversion override is protected isprotected override set name setname string override set auto created setautocreated auto created autocreated override set mandatory setmandatory mandatory override set on parent version setonparentversion opv override set protected setprotected protected status protectedstatus override set required primary type names setrequiredprimarytypenames string names override set default primary type name setdefaultprimarytypename string override set same name siblings setsamenamesiblings allow same name siblings allowsamenamesiblings dummy property definition template dummypropertydefinitiontemplate property definition template propertydefinitiontemplate override get required type getrequiredtype override string get value constraints getvalueconstraints override get default values getdefaultvalues override is multiple ismultiple override string get available query operators getavailablequeryoperators override is full text search able isfulltextsearchable override is query order able isqueryorderable override node type nodetype get declaring node type getdeclaringnodetype override string get name getname override is auto created isautocreated override is mandatory ismandatory override get on parent version getonparentversion override is protected isprotected override set name setname string override set auto created setautocreated auto created autocreated override set mandatory setmandatory mandatory override set on parent version setonparentversion opv override set protected setprotected protected status protectedstatus override set required type setrequiredtype type override set value constraints setvalueconstraints string constraints override set default values setdefaultvalues default values defaultvalues override set multiple setmultiple multiple override set available query operators setavailablequeryoperators string operators override set full text search able setfulltextsearchable full text search able fulltextsearchable override set query order able setqueryorderable query order able queryorderable