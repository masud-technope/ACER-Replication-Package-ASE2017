licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling scripting sightly impl plugin java util hash map hashmap java util hash set hashset java util org apache commons lang string utils stringutils org apache felix scr annotations component org apache felix scr annotations properties org apache felix scr annotations property org apache felix scr annotations service org apache sling scripting sightly impl compiler syntax org apache sling scripting sightly impl compiler expression expression org apache sling scripting sightly impl compiler expression expression node expressionnode org apache sling scripting sightly impl compiler expression node binary operation binaryoperation org apache sling scripting sightly impl compiler expression node binary operator binaryoperator org apache sling scripting sightly impl compiler expression node boolean constant booleanconstant org apache sling scripting sightly impl compiler expression node identifier org apache sling scripting sightly impl compiler expression node map literal mapliteral org apache sling scripting sightly impl compiler expression node property access propertyaccess org apache sling scripting sightly impl compiler expression node runtime call runtimecall org apache sling scripting sightly impl compiler expression node string constant stringconstant org apache sling scripting sightly impl compiler ris command conditional org apache sling scripting sightly impl compiler ris command loop org apache sling scripting sightly impl compiler ris command out text outtext org apache sling scripting sightly impl compiler ris command out variable outvariable org apache sling scripting sightly impl compiler ris command patterns org apache sling scripting sightly impl compiler ris command variable binding variablebinding org apache sling scripting sightly impl compiler common default plugin invoke defaultplugininvoke org apache sling scripting sightly impl compiler frontend compiler context compilercontext org apache sling scripting sightly impl compiler util stream push stream pushstream org apache sling scripting sightly impl filter expression context expressioncontext org apache sling scripting sightly impl html markup utils markuputils org slf logger org slf logger factory loggerfactory implementation attribute plugin component service properties property service description sightly resource block plugin property plugin scr prop block attribute property plugin scr prop priority int value intvalue attribute plugin attributeplugin plugin component plugincomponent logger log logger factory loggerfactory get logger getlogger attribute plugin attributeplugin override plugin invoke plugininvoke invoke expression expression plugin call info plugincallinfo call info callinfo compiler context compilercontext compiler context compilercontext string attribute name attributename decode attribute name decodeattributename call info callinfo attribute name attributename markup utils markuputils is sensitive attribute issensitiveattribute attribute name attributename log warn ref using refusing generate attribute security reasons attribute name attributename invocation default plugin invoke defaultplugininvoke attribute name attributename single attribute invoke singleattributeinvoke attribute name attributename expression compiler context compilercontext multi attribute invoke multiattributeinvoke expression get root getroot compiler context compilercontext string decode attribute name decodeattributename plugin call info plugincallinfo info string arguments info get arguments getarguments arguments length string utils stringutils join arguments single attribute invoke singleattributeinvoke default plugin invoke defaultplugininvoke string attribute name attributename string is true value istruevalue string escaped attr value escapedattrvalue string should display attribute shoulddisplayattribute write at end writeatend before call beforecall string attr value attrvalue expression node expressionnode node expression node expressionnode content node contentnode single attribute invoke singleattributeinvoke string attribute name attributename expression expression compiler context compilercontext compiler context compilercontext attribute name attributename attribute name attributename attr value attrvalue compiler context compilercontext generate variable generatevariable attr value attrvalue attribute name attributename escaped attr value escapedattrvalue compiler context compilercontext generate variable generatevariable attr value escaped attrvalueescaped attribute name attributename is true value istruevalue compiler context compilercontext generate variable generatevariable is true value istruevalue attribute name attributename should display attribute shoulddisplayattribute compiler context compilercontext generate variable generatevariable should display attr shoulddisplayattr attribute name attributename node expression get root getroot expression contains option containsoption syntax context option content node contentnode escape node with hint escapenodewithhint compiler context compilercontext identifier attr value attrvalue markup context markupcontext attribute string constant stringconstant attribute name attributename content node contentnode identifier attr value attrvalue override before attribute beforeattribute push stream pushstream stream string attribute name attributename attribute name attributename equals attribute name attributename before call beforecall emit start emitstart stream write at end writeatend override before attribute value beforeattributevalue push stream pushstream stream string attribute name attributename expression node expressionnode attribute value attributevalue attribute name attributename equals attribute name attributename before call beforecall emit write emitwrite stream patterns begin stream ignore beginstreamignore stream override after attribute value afterattributevalue push stream pushstream stream string attribute name attributename attribute name attributename equals attribute name attributename before call beforecall patterns end stream ignore endstreamignore stream override after attribute afterattribute push stream pushstream stream string attribute name attributename attribute name attributename equals attribute name attributename before call beforecall emit end emitend stream override after attributes afterattributes push stream pushstream stream write at end writeatend emit start emitstart stream stream emit out text outtext attribute name attributename emit write emitwrite stream emit end emitend stream override on plugin call onplugincall push stream pushstream stream plugin call info plugincallinfo call info callinfo expression expression attribute equals call info callinfo get name getname string attribute name attributename decode attribute name decodeattributename call info callinfo attribute name attributename equals attribute name attributename before call beforecall emit start emitstart push stream pushstream stream stream emit variable binding variablebinding start attr value attrvalue node stream emit variable binding variablebinding start escaped attr value escapedattrvalue content node contentnode stream emit variable binding variablebinding start should display attribute shoulddisplayattribute binary operation binaryoperation binary operator binaryoperator identifier escaped attr value escapedattrvalue binary operation binaryoperation binary operator binaryoperator string constant stringconstant identifier attr value attrvalue stream emit conditional start should display attribute shoulddisplayattribute emit write emitwrite push stream pushstream stream stream emit variable binding variablebinding start is true value istruevalue binary operation binaryoperation binary operator binaryoperator identifier attr value attrvalue boolean constant booleanconstant stream emit conditional start is true value istruevalue stream emit out text outtext stream emit out variable outvariable escaped attr value escapedattrvalue stream emit out text outtext stream emit conditional stream emit variable binding variablebinding emit end emitend push stream pushstream stream stream emit conditional stream emit variable binding variablebinding stream emit variable binding variablebinding stream emit variable binding variablebinding multi attribute invoke multiattributeinvoke default plugin invoke defaultplugininvoke expression node expressionnode attr map attrmap string attr map var attrmapvar compiler context compilercontext compiler context compilercontext before call beforecall string hash set hashset string multi attribute invoke multiattributeinvoke expression node expressionnode attr map attrmap compiler context compilercontext context attr map attrmap attr map attrmap compiler context compilercontext context attr map var attrmapvar context generate variable generatevariable attr map attrmap override before attributes beforeattributes push stream pushstream stream stream emit variable binding variablebinding start attr map var attrmapvar attr map attrmap override before attribute beforeattribute push stream pushstream stream string attribute name attributename add attribute name attributename before call beforecall string attr name var attrnamevar compiler context compilercontext generate variable generatevariable attr name attrname attribute name attributename string attr value attrvalue compiler context compilercontext generate variable generatevariable map contains mapcontains attribute name attributename stream emit variable binding variablebinding start attr name var attrnamevar string constant stringconstant attribute name attributename stream emit variable binding variablebinding start attr value attrvalue attribute value node attributevaluenode string constant stringconstant attribute name attributename write attribute writeattribute stream attr name var attrnamevar attr value attrvalue stream emit conditional start attr value attrvalue override after attribute afterattribute push stream pushstream stream string attribute name attributename before call beforecall stream emit conditional stream emit variable binding variablebinding stream emit variable binding variablebinding override on plugin call onplugincall push stream pushstream stream plugin call info plugincallinfo call info callinfo expression expression attribute equals call info callinfo get name getname string attr name attrname decode attribute name decodeattributename call info callinfo attr name attrname before call beforecall before call beforecall add attr name attrname override after attributes afterattributes push stream pushstream stream hash map hashmap string expression node expressionnode ignored literal map ignoredliteralmap hash map hashmap string expression node expressionnode string attr ignored literal map ignoredliteralmap attr boolean constant booleanconstant map literal mapliteral ignored literal ignoredliteral map literal mapliteral ignored literal map ignoredliteralmap string ignored var ignoredvar compiler context compilercontext generate variable generatevariable ignored attributes ignoredattributes stream emit variable binding variablebinding start ignored var ignoredvar ignored literal ignoredliteral string attr name var attrnamevar compiler context compilercontext generate variable generatevariable attr name attrname string attr name escaped attrnameescaped compiler context compilercontext generate variable generatevariable attr name escaped attrnameescaped string attr index attrindex compiler context compilercontext generate variable generatevariable attr index attrindex stream emit loop start attr map var attrmapvar attr name var attrnamevar attr index attrindex stream emit variable binding variablebinding start attr name escaped attrnameescaped escape node escapenode identifier attr name var attrnamevar markup context markupcontext attribute stream emit conditional start attr name escaped attrnameescaped string is ignored attr isignoredattr compiler context compilercontext generate variable generatevariable is ignored attr isignoredattr stream emit variable binding variablebinding start is ignored attr isignoredattr property access propertyaccess identifier ignored var ignoredvar identifier attr name var attrnamevar stream emit conditional start is ignored attr isignoredattr string attr content attrcontent compiler context compilercontext generate variable generatevariable attr content attrcontent stream emit variable binding variablebinding start attr content attrcontent attribute value node attributevaluenode identifier attr name var attrnamevar write attribute writeattribute stream attr name escaped attrnameescaped attr content attrcontent attr content attrcontent stream emit variable binding variablebinding stream emit conditional stream emit variable binding variablebinding stream emit conditional stream emit variable binding variablebinding stream emit loop stream emit variable binding variablebinding stream emit variable binding variablebinding write attribute writeattribute push stream pushstream stream string attr name var attrnamevar string attr content var attrcontentvar string escaped content escapedcontent compiler context compilercontext generate variable generatevariable attr content escaped attrcontentescaped string should display attribute shoulddisplayattribute compiler context compilercontext generate variable generatevariable should display attr shoulddisplayattr stream emit variable binding variablebinding start escaped content escapedcontent escaped expression escapedexpression identifier attr content var attrcontentvar identifier attr name var attrnamevar stream emit variable binding variablebinding start should display attribute shoulddisplayattribute binary operation binaryoperation binary operator binaryoperator identifier escaped content escapedcontent binary operation binaryoperation binary operator binaryoperator string constant stringconstant identifier attr content var attrcontentvar stream emit conditional start should display attribute shoulddisplayattribute write attr name attrname stream emit out text outtext write attribute name writeattributename stream attr name var attrnamevar write attribute value writeattributevalue stream escaped content escapedcontent attr content var attrcontentvar stream emit conditional stream emit variable binding variablebinding stream emit variable binding variablebinding write attribute name writeattributename push stream pushstream stream string attr name var attrnamevar stream emit out variable outvariable attr name var attrnamevar write attribute value writeattributevalue push stream pushstream stream string escaped content escapedcontent string attr content var attrcontentvar holds comparison attr value attrvalue string is true var istruevar compiler context compilercontext generate variable generatevariable is true attr istrueattr stream emit is true attr istrueattr attr content attrcontent variable binding variablebinding start is true attr istrueattr attr content attrcontent is true var istruevar binary operation binaryoperation binary operator binaryoperator identifier attr content var attrcontentvar boolean constant booleanconstant is true attr istrueattr stream emit conditional start is true var istruevar stream emit out text outtext write escaped content escapedcontent stream emit out variable outvariable escaped content escapedcontent stream emit out text outtext is true attr istrueattr stream emit conditional scope is true attr istrueattr stream emit variable binding variablebinding expression node expressionnode attribute value node attributevaluenode expression node expressionnode attribute name node attributenamenode property access propertyaccess identifier attr map var attrmapvar attribute name node attributenamenode expression node expressionnode escaped expression escapedexpression expression node expressionnode original expression node expressionnode hint escape node escapenode original markup context markupcontext attribute hint expression node expressionnode escape node escapenode expression node expressionnode node markup context markupcontext markup context markupcontext expression node expressionnode hint escape node with hint escapenodewithhint compiler context compilercontext node markup context markupcontext hint expression node expressionnode escape node with hint escapenodewithhint compiler context compilercontext compiler context compilercontext expression node expressionnode node markup context markupcontext markup context markupcontext expression node expressionnode hint hint todo escape xss correct modifying compiler context api runtime call runtimecall xss node string constant stringconstant markup context markupcontext get name getname hint compiler context compilercontext adjust to context adjusttocontext expression node markup context markupcontext expression context expressioncontext attribute get root getroot