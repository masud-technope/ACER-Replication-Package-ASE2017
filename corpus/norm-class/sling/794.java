licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling super imposing superimposing impl org apache sling super imposing superimposing superimposing resource provider superimposingresourceprovider prop superimpose overlayable org apache sling super imposing superimposing superimposing resource provider superimposingresourceprovider prop superimpose register parent org apache sling super imposing superimposing superimposing resource provider superimposingresourceprovider prop superimpose source path org junit org mockito mockito java util array list arraylist java util arrays java util dictionary java util hash map hashmap java util iterator java util list java util map javax jcr path not found exception pathnotfoundexception javax jcr property javax jcr repository exception repositoryexception javax jcr session javax jcr observation event javax jcr observation event iterator eventiterator javax jcr observation event listener eventlistener org apache commons collect ions collections iterator utils iteratorutils org apache sling api resource login exception loginexception org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling api resource resource resolver factory resourceresolverfactory org apache sling api resource resource util resourceutil org apache sling api resource value map valuemap org apache sling api wrappers value map decorator valuemapdecorator org apache sling super imposing superimposing superimposing resource provider superimposingresourceprovider org junit org junit org junit test org junit runner run with runwith org mockito answers org mockito mock org mockito invocation invocation on mock invocationonmock org mockito run ners runners mockito unit runner mockitojunitrunner org mockito stub bin g stubbing answer org osgi framework bundle context bundlecontext org osgi framework service registration serviceregistration org osgi service component component context componentcontext run with runwith mockito unit runner mockitojunitrunner superimposing manager impl test superimposingmanagerimpltest mock dictionary string object component context properties componentcontextproperties mock component context componentcontext component context componentcontext mock bundle context bundlecontext bundle context bundlecontext mock resource resolver factory resourceresolverfactory resource resolver factory resourceresolverfactory mock resource resolver resourceresolver resource resolver resourceresolver mock answer answers returns deep stubs session session list service registration serviceregistration service registrations serviceregistrations array list arraylist service registration serviceregistration superimposing manager impl superimposingmanagerimpl under test undertest string original path root path string superimposed path root path string observation path root suppress warnings suppresswarnings unchecked set up setup login exception loginexception component context componentcontext get bundle context getbundlecontext then return thenreturn bundle context bundlecontext component context componentcontext get properties getproperties then return thenreturn component context properties componentcontextproperties component context properties componentcontextproperties superimposing manager impl superimposingmanagerimpl observation paths property then return thenreturn string observation path resource resolver factory resourceresolverfactory get administrative resource resolver getadministrativeresourceresolver map then return thenreturn resource resolver resourceresolver resource resolver resourceresolver adapt to adaptto session then return thenreturn session collect list service registrations validate unregistered shutdown bundle context bundlecontext register service registerservice any string anystring any object anyobject dictionary then answer thenanswer answer service registration serviceregistration service registration serviceregistration answer invocation on mock invocationonmock invocation service registration serviceregistration mock registration mockregistration mock service registration serviceregistration service registrations serviceregistrations add mock registration mockregistration do answer doanswer answer object answer invocation on mock invocationonmock invocation service registrations serviceregistrations remove mock registration mockregistration mock registration mockregistration unregister mock registration mockregistration simulate absolute path access properties session object session item exists itemexists any string anystring then answer thenanswer answer answer invocation on mock invocationonmock invocation throwable string absolute path absolutepath string invocation get arguments getarguments string node path nodepath resource util resourceutil get parent getparent absolute path absolutepath string property name propertyname resource util resourceutil get name getname absolute path absolutepath resource resource resource resolver resourceresolver get resource getresource node path nodepath resource value map valuemap props resource adapt to adaptto value map valuemap props contains key containskey property name propertyname session get property getproperty any string anystring then answer thenanswer answer property property answer invocation on mock invocationonmock invocation throwable string absolute path absolutepath string invocation get arguments getarguments string node path nodepath resource util resourceutil get parent getparent absolute path absolutepath string property name propertyname resource util resourceutil get name getname absolute path absolutepath resource resource resource resolver resourceresolver get resource getresource node path nodepath resource value map valuemap props resource adapt to adaptto value map valuemap object props property name propertyname path not found exception pathnotfoundexception property prop mock property prop get name getname then return thenreturn property name propertyname string prop get string getstring then return thenreturn string prop get boolean getboolean then return thenreturn prop path not found exception pathnotfoundexception repository exception repositoryexception runtime exception runtimeexception initialize enabled interrupted exception interruptedexception login exception loginexception repository exception repositoryexception component context properties componentcontextproperties superimposing manager impl superimposingmanagerimpl enabled property then return thenreturn enabled under test undertest superimposing manager impl superimposingmanagerimpl with resource resolver factory withresourceresolverfactory resource resolver factory resourceresolverfactory under test undertest activate component context componentcontext under test undertest is enabled isenabled verify observation registration verify session get workspace getworkspace get observation manager getobservationmanager add event listener addeventlistener event listener eventlistener any int anyint observation path any boolean anyboolean string string any boolean anyboolean wait separate initialization thread finished under test undertest initialization is done isdone thread sleep tear down teardown repository exception repositoryexception under test undertest deactivate component context componentcontext under test undertest is enabled isenabled verify observation resource resolver terminated correctly verify session get workspace getworkspace get observation manager getobservationmanager remove event listener removeeventlistener event listener eventlistener verify resource resolver resourceresolver close registrations unregistered shutdown service registration serviceregistration registration service registrations serviceregistrations verify registration times unregister resource prepare superimposing resource preparesuperimposingresource string super imposed path superimposedpath string source path sourcepath register parent registerparent over layable overlayable resource resource mock resource resource get path getpath then return thenreturn super imposed path superimposedpath value map valuemap props value map decorator valuemapdecorator hash map hashmap string object props prop superimpose source path source path sourcepath props prop superimpose register parent register parent registerparent props prop superimpose overlayable over layable overlayable resource adapt to adaptto value map valuemap then return thenreturn props resource resolver resourceresolver get resource getresource super imposed path superimposedpath then return thenreturn resource resource move super imp osed resource movesuperimposedresource resource resource string new path newpath string old path oldpath resource get path getpath resource get path getpath then return thenreturn new path newpath resource resolver resourceresolver get resource getresource old path oldpath then return thenreturn resource resolver resourceresolver get resource getresource new path newpath then return thenreturn resource test test disabled testdisabled interrupted exception interruptedexception login exception loginexception repository exception repositoryexception exception thrown service disabled activate deactivate initialize verify zero int eractions verifyzerointeractions resource resolver factory resourceresolverfactory verify zero int eractions verifyzerointeractions bundle context bundlecontext suppress warnings suppresswarnings unchecked test test find all super impo sings testfindallsuperimposings interrupted exception interruptedexception login exception loginexception repository exception repositoryexception prepare query returns existing super imposed superimposed resource component context properties componentcontextproperties superimposing manager impl superimposingmanagerimpl findallqueries property then return thenreturn syntax query resource resolver resourceresolver find resources findresources query syntax answer iterator resource iterator resource answer invocation on mock invocationonmock invocation arrays as list aslist resource prepare superimposing resource preparesuperimposingresource superimposed path original path iterator initialize ensure super imposed superimposed resource detected registered list superimposing resource provider superimposingresourceprovider providers iterator utils iteratorutils to list tolist under test undertest get registered providers getregisteredproviders assert equals assertequals providers size superimposing resource provider superimposingresourceprovider provider providers iterator assert equals assertequals superimposed path provider get root path getrootpath assert equals assertequals original path provider get source path getsourcepath assert false assertfalse provider is overlay able isoverlayable verify bundle context bundlecontext register service registerservice any string anystring provider dictionary event iterator eventiterator prepare node create event preparenodecreateevent resource p resource presource repository exception repositoryexception string resource path resourcepath p resource presource get path getpath event node event nodeevent mock event node event nodeevent get type gettype then return thenreturn event node node event nodeevent get path getpath then return thenreturn resource path resourcepath event property event propertyevent mock event property event propertyevent get type gettype then return thenreturn event property property event propertyevent get path getpath then return thenreturn resource path resourcepath superimposing resource provider superimposingresourceprovider prop superimpose source path event iterator eventiterator event iterator eventiterator mock event iterator eventiterator event iterator eventiterator has next hasnext then return thenreturn event iterator eventiterator next event nextevent then return thenreturn node event nodeevent property event propertyevent event iterator eventiterator event iterator eventiterator prepare node change event preparenodechangeevent resource p resource presource repository exception repositoryexception string resource path resourcepath p resource presource get path getpath event property event propertyevent mock event property event propertyevent get type gettype then return thenreturn event property changed property event propertyevent get path getpath then return thenreturn resource path resourcepath superimposing resource provider superimposingresourceprovider prop superimpose source path event iterator eventiterator event iterator eventiterator mock event iterator eventiterator event iterator eventiterator has next hasnext then return thenreturn event iterator eventiterator next event nextevent then return thenreturn property event propertyevent event iterator eventiterator event iterator eventiterator prepare node remove event preparenoderemoveevent resource p resource presource repository exception repositoryexception string resource path resourcepath p resource presource get path getpath event node event nodeevent mock event node event nodeevent get type gettype then return thenreturn event node removed node event nodeevent get path getpath then return thenreturn resource path resourcepath event iterator eventiterator event iterator eventiterator mock event iterator eventiterator event iterator eventiterator has next hasnext then return thenreturn event iterator eventiterator next event nextevent then return thenreturn node event nodeevent event iterator eventiterator event iterator eventiterator prepare node move event preparenodemoveevent resource p resource presource string p old path poldpath repository exception repositoryexception string resource path resourcepath p resource presource get path getpath event node remove event noderemoveevent mock event node remove event noderemoveevent get type gettype then return thenreturn event node removed node remove event noderemoveevent get path getpath then return thenreturn p old path poldpath event node create event nodecreateevent mock event node create event nodecreateevent get type gettype then return thenreturn event node node create event nodecreateevent get path getpath then return thenreturn resource path resourcepath event iterator eventiterator event iterator eventiterator mock event iterator eventiterator event iterator eventiterator has next hasnext then return thenreturn event iterator eventiterator next event nextevent then return thenreturn node remove event noderemoveevent node create event nodecreateevent event iterator eventiterator suppress warnings suppresswarnings unchecked test test super imp osed resource create update remove testsuperimposedresourcecreateupdateremove interrupted exception interruptedexception login exception loginexception repository exception repositoryexception initialize simulate node create event resource super imposed resource superimposedresource prepare superimposing resource preparesuperimposingresource superimposed path original path under test undertest on event onevent prepare node create event preparenodecreateevent super imposed resource superimposedresource ensure super imposed superimposed resource detected registered list superimposing resource provider superimposingresourceprovider providers iterator utils iteratorutils to list tolist under test undertest get registered providers getregisteredproviders assert equals assertequals providers size superimposing resource provider superimposingresourceprovider provider providers iterator assert equals assertequals superimposed path provider get root path getrootpath assert equals assertequals original path provider get source path getsourcepath assert false assertfalse provider is overlay able isoverlayable verify bundle context bundlecontext register service registerservice any string anystring provider dictionary simulate change original path super imposed resource superimposedresource adapt to adaptto value map valuemap prop superimpose source path path under test undertest on event onevent prepare node change event preparenodechangeevent super imposed resource superimposedresource ensure super imposed superimposed resource update detected provider instance registered providers iterator utils iteratorutils to list tolist under test undertest get registered providers getregisteredproviders assert equals assertequals providers size superimposing resource provider superimposingresourceprovider provider providers iterator assert equals assertequals superimposed path provider get root path getrootpath assert equals assertequals path provider get source path getsourcepath assert false assertfalse provider is overlay able isoverlayable verify bundle context bundlecontext register service registerservice any string anystring provider dictionary simulate node removal under test undertest on event onevent prepare node remove event preparenoderemoveevent super imposed resource superimposedresource ensure provider removed providers iterator utils iteratorutils to list tolist under test undertest get registered providers getregisteredproviders assert equals assertequals providers size suppress warnings suppresswarnings unchecked test test super imp osed resource create move testsuperimposedresourcecreatemove interrupted exception interruptedexception login exception loginexception repository exception repositoryexception component context properties componentcontextproperties superimposing manager impl superimposingmanagerimpl findallqueries property then return thenreturn syntax query initialize simulate node create event resource super imposed resource superimposedresource prepare superimposing resource preparesuperimposingresource superimposed path original path under test undertest on event onevent prepare node create event preparenodecreateevent super imposed resource superimposedresource simulate node move event string old path oldpath super imposed resource superimposedresource get path getpath move super imp osed resource movesuperimposedresource super imposed resource superimposedresource path prepare query returns moved super imposed superimposed resource resource resolver resourceresolver find resources findresources query syntax answer iterator resource iterator resource answer invocation on mock invocationonmock invocation arrays as list aslist resource super imposed resource superimposedresource iterator under test undertest on event onevent prepare node move event preparenodemoveevent super imposed resource superimposedresource old path oldpath ensure super imposed superimposed resource update detected provider instance registered list superimposing resource provider superimposingresourceprovider providers iterator utils iteratorutils to list tolist under test undertest get registered providers getregisteredproviders assert equals assertequals providers size superimposing resource provider superimposingresourceprovider provider providers iterator assert equals assertequals path provider get root path getrootpath assert equals assertequals original path provider get source path getsourcepath assert false assertfalse provider is overlay able isoverlayable verify bundle context bundlecontext register service registerservice any string anystring provider dictionary