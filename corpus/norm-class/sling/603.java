licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling event impl jobs queues java util calendar java util java util hash map hashmap java util map java util java util concurrent semaphore java util concurrent atomic atomic boolean atomicboolean java util concurrent atomic atomic integer atomicinteger java util concurrent atomic atomic long atomiclong java util concurrent locks reentrant read write lock reentrantreadwritelock org apache sling api resource persistence exception persistenceexception org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling commons threads thread pool threadpool org apache sling event impl eventing thread pool eventingthreadpool org apache sling event impl jobs internal job state internaljobstate org apache sling event impl jobs job handler jobhandler org apache sling event impl jobs job impl jobimpl org apache sling event impl jobs job topic traverser jobtopictraverser org apache sling event impl jobs utility org apache sling event impl jobs config internal queue configuration internalqueueconfiguration org apache sling event impl jobs not ifications notifications notification utility notificationutility org apache sling event impl support batch resource remove r batchresourceremover org apache sling event jobs job org apache sling event jobs job job state jobstate org apache sling event jobs notification constants notificationconstants org apache sling event jobs queue org apache sling event jobs queue configuration queueconfiguration type org apache sling event jobs statistics org slf logger org slf logger factory loggerfactory job blocking queue blocking queue functionality job event handling job queue impl jobqueueimpl queue timeout suspend mins max suspend time logger logger logger configuration internal queue configuration internalqueueconfiguration configuration queue string queue name queuename running running suspended atomic long atomiclong suspended since suspendedsince atomic long atomiclong services queues queue services queueservices services map events processing map string job handler jobhandler processing jobs lists processingjobslists hash map hashmap string job handler jobhandler thread pool threadpool thread pool threadpool async counter atomic integer atomicinteger async counter asynccounter atomic integer atomicinteger flag out date d outdated atomic boolean atomicboolean is out date d isoutdated atomic boolean atomicboolean marker closing queue atomic boolean atomicboolean close marker closemarker atomic boolean atomicboolean marker full cache search atomic boolean atomicboolean do full cache search dofullcachesearch atomic boolean atomicboolean counter res cheduling rescheduling atomic integer atomicinteger wait counter waitcounter atomic integer atomicinteger job cache queue job cache queuejobcache cache semaphore handling max number jobs semaphore guard thread executing start jobs atomic boolean atomicboolean start jobs guard startjobsguard atomic boolean atomicboolean lock close start reentrant read write lock reentrantreadwritelock lock reentrant read write lock reentrantreadwritelock sleeping ordered queues job reschedule d rescheduled is sleeping until issleepinguntil create queue param queue param config queue configuration param services queue services param topics topics handled queue code job queue impl jobqueueimpl jobs process code job queue impl jobqueueimpl create queue createqueue string internal queue configuration internalqueueconfiguration config queue services queueservices services string topics queue job cache queuejobcache cache queue job cache queuejobcache services configuration services statistics manager statisticsmanager config get type gettype topics cache is empty isempty job queue impl jobqueueimpl config services cache create queue param queue param config queue configuration param services queue services param cache job cache job queue impl jobqueueimpl string internal queue configuration internalqueueconfiguration config queue services queueservices services queue job cache queuejobcache cache config get own thread pool size getownthreadpoolsize thread pool threadpool eventing thread pool eventingthreadpool services thread pool manager threadpoolmanager config get own thread pool size getownthreadpoolsize thread pool threadpool services even ting thread pool eventingthreadpool queue name queuename configuration config services services logger logger factory loggerfactory get logger getlogger get class getclass get name getname running cache cache semaphore config get max parallel getmaxparallel logger info starting job queue queue name queuename logger debug configuration job queue configuration queue configuration override internal queue configuration internalqueueconfiguration get configuration getconfiguration configuration job queue override string get name getname queue name queuename org apache sling event jobs queue get statistics getstatistics override statistics get statistics getstatistics services statistics manager statisticsmanager get queue statistics getqueuestatistics queue name queuename start job queue method called concurrently guard start jobs startjobs start jobs guard startjobsguard compare and set compareandset start jobs parallel running is out date d isoutdated is suspended issuspended try acquire tryacquire started lock write lock writelock lock job handler jobhandler handler cache get next job getnextjob services job consumer manager jobconsumermanager services statistics manager statisticsmanager do full cache search dofullcachesearch get and set getandset handler started thread pool threadpool execute runnable override update thread priority thread current thread currentthread thread current thread currentthread string old name oldname current thread currentthread get name getname old priority oldpriority current thread currentthread get priority getpriority current thread currentthread set name setname old name oldname handler get job getjob get queue name getqueuename handler get job getjob get topic gettopic configuration get thread priority getthreadpriority configuration get thread priority getthreadpriority norm current thread currentthread set priority setpriority thread norm priority min current thread currentthread set priority setpriority thread min priority max current thread currentthread set priority setpriority thread max priority start job startjob handler current thread currentthread set priority setpriority old priority oldpriority current thread currentthread set name setname old name oldname launch job start jobs startjobs job started release lock write lock writelock unlock start jobs guard startjobsguard start job startjob job handler jobhandler handler close marker closemarker job impl jobimpl job handler get job getjob handler started system current time millis currenttimemillis services configuration get audit logger getauditlogger debug start job get id getid sanity check queue d queued property calendar queue d queued job get property getproperty job impl jobimpl property job queued calendar queue d queued simply ten seconds queue d queued calendar get instance getinstance queue d queued set time in millis settimeinmillis system current time millis currenttimemillis queue time queuetime handler started queue d queued get time in millis gettimeinmillis update statistics services statistics manager statisticsmanager job started jobstarted queue name queuename job get topic gettopic queue time queuetime send not ification notification notification utility notificationutility send notification sendnotification services event admin eventadmin notification constants notificationconstants topic job started job queue time queuetime processing jobs lists processingjobslists processing jobs lists processingjobslists job get id getid handler job execution result impl jobexecutionresultimpl result job execution result impl jobexecutionresultimpl cancelled job job state jobstate result state resultstate job job state jobstate error job execution context impl jobexecutioncontextimpl ctx job execution context impl jobexecutioncontextimpl handler job execution context impl jobexecutioncontextimpl a sync handler asynchandler override finished job state jobstate services job consumer manager jobconsumermanager unregister listener unregisterlistener job get id getid finished job finishedjob job get id getid async counter asynccounter decrement and get decrementandget ctx result job execution result impl jobexecutionresultimpl handler get consumer getconsumer process job ctx result async processing services job consumer manager jobconsumermanager register listener registerlistener job get id getid handler get consumer getconsumer ctx async counter asynccounter increment and get incrementandget ctx mark async markasync result succeeded result state resultstate job job state jobstate succeeded result failed result state resultstate job job state jobstate queued result cancelled handler is stopped isstopped result state resultstate job job state jobstate stopped result state resultstate job job state jobstate error throwable nosonar logger error unhandled error occured job processor get message getmessage processing job utility to string tostring job result job execution result impl jobexecutionresultimpl cancelled result state resultstate job job state jobstate error result result get retry delay in ms getretrydelayinms job set property setproperty job impl jobimpl property delay override result get retry delay in ms getretrydelayinms result get message getmessage job set property setproperty job property result message result get message getmessage finished job finishedjob job get id getid result state resultstate exception logger error exception job processing release out date outdate queue out date outdate is out date d isoutdated compare and set compareandset string get name getname out date d outdated hash code hashcode logger info out dating outdating queue renaming queue name queuename queue name queuename check queue closed try to close trytoclose resume queue close resume lock write lock writelock lock check can be closed canbeclosed close marker closemarker close close marker closemarker lock write lock writelock unlock check queue closed can be closed canbeclosed is suspended issuspended async counter asynccounter wait counter waitcounter available per mits availablepermits configuration get max parallel getmaxparallel close queue close running logger debug shutting job queue queue name queuename resume processing jobs lists processingjobslists processing jobs lists processingjobslists clear configuration get own thread pool size getownthreadpoolsize eventing thread pool eventingthreadpool thread pool threadpool release logger info stopped job queue queue name queuename per iodic periodic main tenance maintenance main tain maintain check suspended suspended since suspendedsince max suspend time system current time millis currenttimemillis logger info waking suspended queue suspended max suspend time resume full cache search do full cache search dofullcachesearch start jobs startjobs info rm inform queue job topics param topics topics wake up queue wakeupqueue string topics cache handle new topics handlenewtopics topics job queue param handler job handler req ueue requeue job handler jobhandler handler cache reschedule queue name queuename handler services statistics manager statisticsmanager start jobs startjobs reschedule info rescheduleinfo reschedule processing time succeeded processing time processingtime job job state jobstate internal job state internaljobstate final state finalstate reschedule info rescheduleinfo handle reschedule handlereschedule job handler jobhandler handler job job state jobstate result state resultstate reschedule info rescheduleinfo info reschedule info rescheduleinfo info result state resultstate result state resultstate job finished succeeded logger is debug enabled isdebugenabled logger debug finished job utility to string tostring handler get job getjob info processing time processingtime system current time millis currenttimemillis handler started info final state finalstate internal job state internaljobstate succeeded check exc eeded exceeded number retries queued retries handler get job getjob get property getproperty job property job retries retry count retrycount handler get job getjob get property getproperty job property job retry count retry count retrycount retries retry count retrycount retries logger is debug enabled isdebugenabled logger debug cancelled job utility to string tostring handler get job getjob info final state finalstate internal job state internaljobstate cancelled info reschedule handler get job getjob retry logger is debug enabled isdebugenabled logger debug failed job utility to string tostring handler get job getjob info final state finalstate internal job state internaljobstate failed consumer cancelled job stopped error logger is debug enabled isdebugenabled logger debug cancelled job utility to string tostring handler get job getjob info final state finalstate internal job state internaljobstate cancelled info job job state jobstate queued info reschedule info job job state jobstate info handle job finish determine reschedule cancel job finished job finishedjob string job id jobid job job state jobstate result state resultstate is async isasync services configuration get audit logger getauditlogger debug finished result state resultstate job id jobid logger debug received finish job result state resultstate job id jobid result state resultstate job handler job handler jobhandler handler remove event processing list processing jobs lists processingjobslists handler processing jobs lists processingjobslists remove job id jobid running logger warn queue running discarding finish job id jobid handler logger warn job started queue job id jobid handle res cheduling rescheduling job reschedule info rescheduleinfo reschedule info rescheduleinfo handle reschedule handlereschedule handler result state resultstate reschedule info rescheduleinfo reschedule cancelled jobs succeeded jobs queue configured keep jobs keepjobs reschedule info rescheduleinfo job job state jobstate succeeded configuration is keep jobs iskeepjobs handler finished reschedule info rescheduleinfo keep jobs keepjobs reschedule info rescheduleinfo processing time processingtime reschedule handler update statistics services statistics manager statisticsmanager job ended jobended queue name queuename handler get job getjob get topic gettopic reschedule info rescheduleinfo final state finalstate reschedule info rescheduleinfo processing time processingtime send not ification notification notification utility notificationutility send notification sendnotification services event admin eventadmin reschedule info rescheduleinfo final state finalstate get topic gettopic handler get job getjob reschedule info rescheduleinfo processing time processingtime reschedule info rescheduleinfo reschedule org apache sling event jobs queue resume override resume suspended since suspendedsince get and set getandset logger debug waking suspended queue queue name queuename start jobs startjobs org apache sling event jobs queue suspend override suspend suspended since suspendedsince compare and set compareandset system current time millis currenttimemillis logger debug suspending queue queue name queuename org apache sling event jobs queue is suspended issuspended override is suspended issuspended suspended since suspendedsince org apache sling event jobs queue remove all removeall override remove all removeall string topics cache get topics gettopics logger debug removing jobs queue queue name queuename topics topics is empty isempty resource resolver resourceresolver resolver services configuration create resource resolver createresourceresolver resource base resource baseresource resolver get resource getresource services configuration get local jobs path getlocaljobspath sanity check base resource baseresource batch resource remove r batchresourceremover brr batch resource remove r batchresourceremover string topics resource topic resource topicresource base resource baseresource get child getchild replace topic resource topicresource job topic traverser jobtopictraverser traverse logger topic resource topicresource job topic traverser jobtopictraverser job callback jobcallback override handle job impl jobimpl job resource job resource jobresource topic resource topicresource get resource resolver getresourceresolver get resource getresource job get resource path getresourcepath sanity check job resource jobresource brr delete job resource jobresource persistence exception persistenceexception ignore logger error unable remove job job ignore topic resource topicresource get resource resolver getresourceresolver revert topic resource topicresource get resource resolver getresourceresolver refresh resolver commit persistence exception persistenceexception ignore logger error unable remove jobs ignore resolver close org apache sling event jobs queue get state getstate java lang string override object get state getstate string key configuration get type gettype type ordered is sleeping until issleepinguntil equals key is sleeping until issleepinguntil org apache sling event jobs queue get state info getstateinfo override string get state info getstateinfo out date d outdated is out date d isoutdated suspended since suspendedsince suspended since suspendedsince async jobs asyncjobs async counter asynccounter wait count waitcount wait counter waitcounter job count jobcount string value of valueof configuration get max parallel getmaxparallel available per mits availablepermits configuration get type gettype type ordered is sleeping until issleepinguntil is sleeping until issleepinguntil retry delay job param handler job handler retry delay get retry delay getretrydelay job handler jobhandler handler delay configuration get retry delay in ms getretrydelayinms handler get job getjob get property getproperty job impl jobimpl property delay override delay handler get job getjob get property getproperty job impl jobimpl property delay override handler get job getjob get property getproperty job property job retry delay delay handler get job getjob get property getproperty job property job retry delay delay stop job stopjob job impl jobimpl job job handler jobhandler handler processing jobs lists processingjobslists handler processing jobs lists processingjobslists job get id getid handler handler handler reschedule job handler jobhandler handler delay put ting putting job retry delay delay get retry delay getretrydelay handler delay configuration get type gettype type ordered cache set is blocked setisblocked handler add to retry list addtoretrylist fire date firedate fire date firedate set time settime system current time millis currenttimemillis delay configuration get type gettype type ordered is sleeping until issleepinguntil fire date firedate get time gettime string job name jobname waiting queue name queuename handler hash code hashcode runnable runnable override handler remove from retry list removefromretrylist req ueue requeue handler wait counter waitcounter decrement and get decrementandget configuration get type gettype type ordered is sleeping until issleepinguntil cache set is blocked setisblocked start jobs startjobs wait counter waitcounter increment and get incrementandget services scheduler schedule services scheduler fire date firedate job name jobname scheduling fails thread queue req ueue requeue handler