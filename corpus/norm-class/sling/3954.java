licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling commons osgi java util array list arraylist java util collection java util collections java util iterator java util list java util map java util sorted map sortedmap java util tree map treemap a qute aqute bnd annotation consumer type consumertype a qute aqute bnd annotation provider type providertype helper collects services registered osg i osgi bind unbind methods services ordered service ranking iterate d iterated object instance implementation thread safe usage define dynamic reference cardinality optional multiple service pre reference my service myservice reference interface referenceinterface my service myservice cardinality reference cardinality referencecardinality optional multiple policy reference policy referencepolicy dynamic ranked services rankedservices my service myservice my services myservices ranked services rankedservices my service myservice pre define bind unbind methods delegate ranked services rankedservices instance pre bind my service bindmyservice my service myservice service map string object props my services myservices bind service props unbind my service unbindmyservice my service myservice service map string object props my services myservices unbind service props pre access list referenced services access thread safe manner pre my service myservice service my services myservices code pre option ally optionally pass link change listener changelistener instance not ified notified list referenced services changed param service type provider type providertype ranked services rankedservices iterable change listener changelistener change listener changelistener sorted map sortedmap comparable object service map servicemap tree map treemap comparable object collection sorted services sortedservices collections empty list emptylist instantiate change listener ranked services rankedservices instantiate change listener param change listener changelistener change listener ranked services rankedservices change listener changelistener change listener changelistener change listener changelistener change listener changelistener handle bind service event param service service instance param props service reference properties bind service map string object props service map servicemap service map servicemap service util serviceutil get comparable for service ranking getcomparableforserviceranking props service update sorted services updatesortedservices handle unbind service event param service service instance param props service reference properties unbind service map string object props service map servicemap service map servicemap remove service util serviceutil get comparable for service ranking getcomparableforserviceranking props update sorted services updatesortedservices update list sorted services copying array making unmodifiable update sorted services updatesortedservices list copied list copiedlist array list arraylist service map servicemap values sorted services sortedservices collections unmodifiable list unmodifiablelist copied list copiedlist change listener changelistener change listener changelistener changed lists services registered osg i osgi sorted service ranking collection service instances collection sorted services sortedservices iter ates iterates services registered osg i osgi sorted service ranking iterator service instances iterator iterator sorted services sortedservices iterator notification services list consumer type consumertype change listener changelistener called list ranked services changed bundle bindings unbind ings unbindings method called block code efficient changed