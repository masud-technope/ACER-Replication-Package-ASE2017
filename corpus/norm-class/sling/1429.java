licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling distribution trigger impl javax jcr node javax jcr session javax jcr workspace javax jcr observation event javax jcr observation observation manager observationmanager org apache sling api resource resource resolver factory resourceresolverfactory org apache sling commons scheduler scheduler org apache sling distribution distribution request distributionrequest org apache sling distribution trigger distribution request handler distributionrequesthandler org apache sling jcr api sling repository slingrepository org junit ignore org junit test org junit assert not null assertnotnull org junit assert null assertnull org mockito matchers org mockito matchers org mockito mockito mock org mockito mockito test case testcase link persisted jcr event distribution trigger persistedjcreventdistributiontrigger ignore sling fixed per sis ting jcr event distribution trigger test persistingjcreventdistributiontriggertest test test process event without privileges testprocesseventwithoutprivileges exception string service name servicename service id serviceid session session mock session session node exists nodeexists nuggets then return thenreturn sling repository slingrepository repository mock sling repository slingrepository scheduler scheduler mock scheduler resource resolver factory resourceresolverfactory resolver factory resolverfactory mock resource resolver factory resourceresolverfactory repository login service loginservice service name servicename then return thenreturn session string path path string nuggets path nuggetspath nuggets persisted jcr event distribution trigger persistedjcreventdistributiontrigger persisting jcr event distribution trigger persistingjcreventdistributiontrigger persisted jcr event distribution trigger persistedjcreventdistributiontrigger repository scheduler resolver factory resolverfactory path service name servicename nuggets path nuggetspath event event mock event distribution request distributionrequest distribution request distributionrequest persisting jcr event distribution trigger persistingjcreventdistributiontrigger process event processevent event assert null assertnull distribution request distributionrequest test test process event without privileges and nuggets path testprocesseventwithoutprivilegesandnuggetspath exception string service name servicename service id serviceid session session mock session session has permission haspermission session action add node then return thenreturn session has permission haspermission nuggets session action add node then return thenreturn time doesn exist created session node exists nodeexists nuggets then return thenreturn time exist session node exists nodeexists nuggets then return thenreturn node root node rootnode mock node node var node varnode mock node node nuggets node nuggetsnode mock node var node varnode add node addnode nuggets sling folder then return thenreturn nuggets node nuggetsnode root node rootnode add node addnode sling folder then return thenreturn var node varnode session get root node getrootnode then return thenreturn root node rootnode sling repository slingrepository repository mock sling repository slingrepository scheduler scheduler mock scheduler resource resolver factory resourceresolverfactory resolver factory resolverfactory mock resource resolver factory resourceresolverfactory repository login service loginservice service name servicename then return thenreturn session string path path string nuggets path nuggetspath nuggets persisted jcr event distribution trigger persistedjcreventdistributiontrigger persisting jcr event distribution trigger persistingjcreventdistributiontrigger persisted jcr event distribution trigger persistedjcreventdistributiontrigger repository scheduler resolver factory resolverfactory path service name servicename nuggets path nuggetspath event event mock event distribution request distributionrequest distribution request distributionrequest persisting jcr event distribution trigger persistingjcreventdistributiontrigger process event processevent event assert null assertnull distribution request distributionrequest test test process event with privileges testprocesseventwithprivileges exception string nuggets path nuggetspath nuggets string service name servicename service id serviceid session session mock session session node exists nodeexists nuggets then return thenreturn workspace workspace mock workspace observation manager observationmanager observation manager observationmanager mock observation manager observationmanager workspace get observation manager getobservationmanager then return thenreturn observation manager observationmanager session get workspace getworkspace then return thenreturn workspace session has permission haspermission nuggets path nuggetspath session action add node then return thenreturn sling repository slingrepository repository mock sling repository slingrepository scheduler scheduler mock scheduler resource resolver factory resourceresolverfactory resolver factory resolverfactory mock resource resolver factory resourceresolverfactory repository login service loginservice service name servicename then return thenreturn session string path path persisted jcr event distribution trigger persistedjcreventdistributiontrigger persisting jcr event distribution trigger persistingjcreventdistributiontrigger persisted jcr event distribution trigger persistedjcreventdistributiontrigger repository scheduler resolver factory resolverfactory path service name servicename nuggets path nuggetspath distribution request handler distributionrequesthandler handler mock distribution request handler distributionrequesthandler persisting jcr event distribution trigger persistingjcreventdistributiontrigger register handler node nuggets node nuggetsnode mock node node event node eventnode mock node nuggets node nuggetsnode add node addnode string string then return thenreturn event node eventnode session get node getnode nuggets path nuggetspath then return thenreturn nuggets node nuggetsnode event event mock event event get path getpath then return thenreturn path generating event distribution request distributionrequest distribution request distributionrequest persisting jcr event distribution trigger persistingjcreventdistributiontrigger process event processevent event assert not null assertnotnull distribution request distributionrequest test test process event with privileges and no nuggets node testprocesseventwithprivilegesandnonuggetsnode exception string nuggets path nuggetspath nuggets string service name servicename service id serviceid session session mock session time doesn exist created session node exists nodeexists nuggets then return thenreturn time exist session node exists nodeexists nuggets then return thenreturn node root node rootnode mock node node var node varnode mock node node nuggets node nuggetsnode mock node var node varnode add node addnode nuggets sling folder then return thenreturn nuggets node nuggetsnode root node rootnode add node addnode sling folder then return thenreturn var node varnode session get root node getrootnode then return thenreturn root node rootnode workspace workspace mock workspace observation manager observationmanager observation manager observationmanager mock observation manager observationmanager workspace get observation manager getobservationmanager then return thenreturn observation manager observationmanager session get workspace getworkspace then return thenreturn workspace session has permission haspermission string session action add node then return thenreturn sling repository slingrepository repository mock sling repository slingrepository scheduler scheduler mock scheduler resource resolver factory resourceresolverfactory resolver factory resolverfactory mock resource resolver factory resourceresolverfactory repository login service loginservice service name servicename then return thenreturn session string path path persisted jcr event distribution trigger persistedjcreventdistributiontrigger persisting jcr event distribution trigger persistingjcreventdistributiontrigger persisted jcr event distribution trigger persistedjcreventdistributiontrigger repository scheduler resolver factory resolverfactory path service name servicename nuggets path nuggetspath distribution request handler distributionrequesthandler handler mock distribution request handler distributionrequesthandler persisting jcr event distribution trigger persistingjcreventdistributiontrigger register handler node event node eventnode mock node nuggets node nuggetsnode add node addnode string string then return thenreturn event node eventnode session get node getnode nuggets path nuggetspath then return thenreturn nuggets node nuggetsnode event event mock event event get path getpath then return thenreturn path generating event distribution request distributionrequest distribution request distributionrequest persisting jcr event distribution trigger persistingjcreventdistributiontrigger process event processevent event assert not null assertnotnull distribution request distributionrequest