licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling testing mock osgi org junit assert equals assertequals org junit assert false assertfalse org junit assert not null assertnotnull org junit assert null assertnull org junit assert same assertsame org junit assert true asserttrue java util array list arraylist java util dictionary java util hashtable java util list java util map org apache felix scr annotations activate org apache felix scr annotations component org apache felix scr annotations deactivate org apache felix scr annotations property org apache felix scr annotations reference org apache felix scr annotations reference cardinality referencecardinality org apache felix scr annotations references org apache felix scr annotations service org junit org junit org junit test org mockito mockito org osgi framework bundle org osgi framework bundle context bundlecontext org osgi framework constants org osgi framework service factory servicefactory org osgi framework service reference servicereference org osgi framework service registration serviceregistration org osgi service component component context componentcontext org osgi service component annotations modified google common collect immutable map immutablemap osgi service util test osgiserviceutiltest bundle context bundlecontext bundle context bundlecontext mock osgi mockosgi new bundle context newbundlecontext service service service service set up setup service service service service bundle context bundlecontext register service registerservice service interface serviceinterface get name getname service bundle context bundlecontext register service registerservice service interface serviceinterface get name getname service tear down teardown mock osgi mockosgi shutdown bundle context bundlecontext test test service testservice service service service assert true asserttrue mock osgi mockosgi inject services injectservices service bundle context bundlecontext dictionary string object service config hashtable string object service config prop assert true asserttrue mock osgi mockosgi activate service bundle context bundlecontext service config assert not null assertnotnull service get component context getcomponentcontext assert equals assertequals service config prop service get component context getcomponentcontext get properties getproperties prop assert same assertsame service service get reference getreference list service interface serviceinterface references service get references getreferences assert equals assertequals references size assert same assertsame service references list service super interface servicesuperinterface references service get references getreferences assert equals assertequals references size assert same assertsame service references list map string object reference configs service get reference getreference configs assert equals assertequals reference configs size assert equals assertequals reference configs constants service ranking assert true asserttrue mock osgi mockosgi deactivate service bundle context bundlecontext assert null assertnull service get component context getcomponentcontext test test service testservice config bundle context bundlecontext bundle context bundlecontext mock osgi mockosgi new bundle context newbundlecontext map string object initial proper ites initialproperites immutable map immutablemap string object prop service service service mock osgi mockosgi activate service bundle context bundlecontext initial proper ites initialproperites assert equals assertequals initial proper ites initialproperites prop service get config getconfig prop map string object new properties newproperties immutable map immutablemap string object prop mock osgi mockosgi modified service bundle context bundlecontext new properties newproperties assert equals assertequals new properties newproperties prop service get config getconfig prop new properties newproperties immutable map immutablemap string object prop dictionary string object new properties dictonary newpropertiesdictonary hashtable string object new properties newproperties mock osgi mockosgi modified service bundle context bundlecontext new properties dictonary newpropertiesdictonary assert equals assertequals new properties newproperties prop service get config getconfig prop test test service testservice service service service assert true asserttrue mock osgi mockosgi inject services injectservices service bundle context bundlecontext assert false assertfalse mock osgi mockosgi activate service bundle context bundlecontext assert same assertsame service service get reference getreference test expected no scr metadata exception noscrmetadataexception test inject services no metadata testinjectservicesnometadata mock osgi mockosgi inject services injectservices object mock osgi mockosgi new bundle context newbundlecontext test expected no scr metadata exception noscrmetadataexception test activate no metadata testactivatenometadata mock osgi mockosgi activate object bundle context bundlecontext test expected no scr metadata exception noscrmetadataexception test deactivate no metadata testdeactivatenometadata mock osgi mockosgi deactivate object bundle context bundlecontext test expected no scr metadata exception noscrmetadataexception test modified no metadata testmodifiednometadata mock osgi mockosgi modified object mock osgi mockosgi new bundle context newbundlecontext immutable map immutablemap string object test test mocked service testmockedservice service service mockito spy service mockito do return doreturn service do remote thing doremotething mock osgi mockosgi inject services injectservices service bundle context bundlecontext mock osgi mockosgi activate service bundle context bundlecontext dictionary string object bundle context bundlecontext register service registerservice service interface serviceinterface get name getname service assert same assertsame service bundle context bundlecontext get service getservice bundle context bundlecontext get service reference getservicereference service interface serviceinterface get name getname assert equals assertequals service do remote thing doremotething test test service factory via scr testservicefactoryviascr service factory servicefactory service factory servicefactory service factory servicefactory mock osgi mockosgi inject services injectservices service factory servicefactory bundle context bundlecontext mock osgi mockosgi activate service factory servicefactory bundle context bundlecontext dictionary string object bundle context bundlecontext register service registerservice service factory servicefactory get name getname service factory servicefactory assert same assertsame service factory servicefactory bundle context bundlecontext get service getservice bundle context bundlecontext get service reference getservicereference service factory servicefactory get name getname test test service factory via manual registration testservicefactoryviamanualregistration service factory servicefactory service factory servicefactory service factory servicefactory bundle context bundlecontext register service registerservice service factory servicefactory get name getname service factory servicefactory override object get service getservice bundle bundle service registration serviceregistration registration service factory servicefactory override unget service ungetservice bundle bundle service registration serviceregistration registration object service assert same assertsame service factory servicefactory bundle context bundlecontext get service getservice bundle context bundlecontext get service reference getservicereference service factory servicefactory get name getname service interface serviceinterface methods service interface serviceinterface optional methods service interface serviceinterface methods service interface serviceinterface service super interface servicesuperinterface methods service super interface servicesuperinterface methods component service service interface serviceinterface property constants service ranking int value intvalue service service interface serviceinterface dummy component service service interface serviceinterface service interface serviceinterface property constants service ranking int value intvalue service service interface serviceinterface service interface serviceinterface dummy component references reference reference reference interface referenceinterface service interface serviceinterface cardinality reference cardinality referencecardinality mandatory multiple service reference service interface serviceinterface reference reference cardinality reference cardinality referencecardinality optional unary service interface serviceinterface optional reference optional list service reference servicereference references array list arraylist service reference servicereference reference reference reference interface referenceinterface service interface serviceinterface cardinality reference cardinality referencecardinality optional multiple list service super interface servicesuperinterface references array list arraylist service super interface servicesuperinterface list map string object reference configs array list arraylist map string object component context componentcontext component context componentcontext map string object config activate activate component context componentcontext ctx component context componentcontext ctx config map util maputil to map tomap ctx get properties getproperties deactivate deactivate component context componentcontext ctx component context componentcontext modified modified map string object new config newconfig config new config newconfig service interface serviceinterface get reference getreference reference service interface serviceinterface optional get reference getreference optional reference optional list service interface serviceinterface get references getreferences list service interface serviceinterface services array list arraylist service interface serviceinterface service reference servicereference service reference servicereference references services add service interface serviceinterface component context componentcontext get bundle context getbundlecontext get service getservice service reference servicereference services list service super interface servicesuperinterface get references getreferences references list map string object get reference getreference configs reference configs component context componentcontext get component context getcomponentcontext component context componentcontext map string object get config getconfig config bind reference bindreference optional service interface serviceinterface optional service reference optional service unbind reference unbindreference optional service interface serviceinterface optional service reference optional bind reference bindreference service interface serviceinterface service reference service unbind reference unbindreference service interface serviceinterface service reference bind reference bindreference service reference servicereference service reference servicereference references add service reference servicereference unbind reference unbindreference service reference servicereference service reference servicereference references remove service reference servicereference bind reference bindreference service super interface servicesuperinterface service map string object service config serviceconfig references add service reference configs add service config serviceconfig unbind reference unbindreference service super interface servicesuperinterface service map string object service config serviceconfig references remove service reference configs remove service config serviceconfig service osgi r osgir service interface serviceinterface reference service interface serviceinterface optional reference optional list service reference servicereference references list service super interface servicesuperinterface references list service super interface servicesuperinterface references filtered component context componentcontext component context componentcontext map string object config activate activate component context componentcontext ctx component context componentcontext ctx config map util maputil to map tomap ctx get properties getproperties deactivate deactivate component context componentcontext ctx component context componentcontext modified modified map string object new config newconfig config new config newconfig service interface serviceinterface get reference getreference reference service interface serviceinterface optional get reference getreference optional reference optional list service interface serviceinterface get references getreferences list service interface serviceinterface services array list arraylist service interface serviceinterface service reference servicereference service reference servicereference references services add service interface serviceinterface component context componentcontext get bundle context getbundlecontext get service getservice service reference servicereference services list service super interface servicesuperinterface get references getreferences references list service super interface servicesuperinterface get references getreferences filtered references filtered component context componentcontext get component context getcomponentcontext component context componentcontext map string object get config getconfig config component reference reference interface referenceinterface service interface serviceinterface custom name customname bind custom bind custombind unbind custom unbind customunbind service service interface serviceinterface reference service interface serviceinterface get reference getreference reference custom bind custombind service interface serviceinterface service reference service custom unbind customunbind service interface serviceinterface service reference component service service interface serviceinterface service service interface serviceinterface override do remote thing doremotething service interface serviceinterface do remote thing doremotething component service service factory servicefactory service factory servicefactory service factory servicefactory