org apache sling crankstart launcher org junit assert not null assertnotnull org junit fail java file java io exception ioexception java input stream inputstream java input stream reader inputstreamreader java reader java net server socket serversocket java util array list arraylist java util list java util random org apache http client methods http get httpget org apache http client methods http uri request httpurirequest org apache http impl client default http client defaulthttpclient org slf logger org slf logger factory loggerfactory setup crankstart launched instance tests crankstart setup crankstartsetup logger log logger factory loggerfactory get logger getlogger get class getclass port get available port getavailableport string storage path storagepath get osgi storage path getosgistoragepath thread crankstart thread crankstartthread string base url baseurl http localhost port list crankstart setup crankstartsetup to clean up tocleanup array list arraylist crankstart setup crankstartsetup string model paths crankstart model txt provisioning model base txt provisioning model sling extensions txt provisioning model start level txt provisioning model crankstart tests txt override string to string tostring get class getclass get simple name getsimplename port port osg i osgi storage storage path storagepath get available port getavailableport result server socket serversocket server socket serversocket result get local port getlocalport close exception runtime exception runtimeexception get available port getavailableport failed result merge model resource mergemodelresource launcher launcher string path exception input stream inputstream crankstart setup crankstartsetup get resource as stream getresourceasstream path assert not null assertnotnull expecting test resource path reader input input stream reader inputstreamreader launcher merge model mergemodel launcher get model getmodel input path launcher compute effective model computeeffectivemodel input close string get base url getbaseurl base url baseurl setup exception crankstart thread crankstartthread to clean up tocleanup to clean up tocleanup is empty isempty log info stopping crankstart instances starting crankstart setup crankstartsetup to clean up tocleanup stop crankstart instance stopcrankstartinstance to clean up tocleanup clear log info starting http uri request httpurirequest http get httpget base url baseurl system set property setproperty crankstart model http port string value of valueof port system set property setproperty crankstart model osgi storage path storage path storagepath default http client defaulthttpclient execute fail expecting connection port fail starting http service io exception ioexception expected launcher launcher launcher string path model paths merge model resource mergemodelresource launcher path launcher compute effective model computeeffectivemodel crankstart thread crankstartthread thread launcher launch interrupted exception interruptedexception log info launcher thread int errupted interrupted exiting exception print stack trace printstacktrace fail launcher exception crankstart thread crankstartthread set daemon setdaemon crankstart thread crankstartthread start runtime get runtime getruntime add shutdown hook addshutdownhook thread override stop crankstart instance stopcrankstartinstance stop crankstart instance stopcrankstartinstance log info stopping crankstart thread crankstartthread crankstart thread crankstartthread int errupt interrupt crankstart thread crankstartthread join interrupted exception interruptedexception ignore crankstart thread crankstartthread string get osgi storage path getosgistoragepath file tmp root tmproot file system get property getproperty java tmp dir tmpdir random random random file tmp folder tmpfolder file tmp root tmproot system current time millis currenttimemillis random next int nextint tmp folder tmpfolder mkdir fail failed create tmp folder tmpfolder get absolute path getabsolutepath tmp folder tmpfolder delete on exit deleteonexit tmp folder tmpfolder get absolute path getabsolutepath