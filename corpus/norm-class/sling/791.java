licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling jcr class loader classloader internal java byte array input stream bytearrayinputstream java byte array output stream bytearrayoutputstream java file not found exception filenotfoundexception java io exception ioexception java input stream inputstream java output stream outputstream java util map javax jcr item javax jcr node javax jcr property javax jcr repository exception repositoryexception javax jcr session javax jcr simple credentials simplecredentials org apache felix scr annotations activate org apache felix scr annotations component org apache felix scr annotations deactivate org apache felix scr annotations properties org apache felix scr annotations reference org apache felix scr annotations reference cardinality referencecardinality org apache felix scr annotations reference policy referencepolicy org apache felix scr annotations service org apache sling commons class loader classloader class loader writer classloaderwriter org apache sling commons class loader classloader dynamic class loader manager dynamicclassloadermanager org apache sling commons mime mime type service mimetypeservice org apache sling commons osgi properties util propertiesutil org apache sling jcr api sling repository slingrepository org apache sling settings sling settings service slingsettingsservice org osgi framework bundle org osgi framework service reference servicereference org osgi service component component context componentcontext org slf logger org slf logger factory loggerfactory code dynamic class loader provider impl dynamicclassloaderproviderimpl code loader loads classes configured paths repository link class loader writer classloaderwriter clients writing reading classes resources component metatype label loader description loader description org apache sling jcr class loader classloader internal dynamic class loader provider impl dynamicclassloaderproviderimpl service class loader writer classloaderwriter service factory servicefactory properties org apache felix scr annotations property service vendor apache software foundation org apache felix scr annotations property service description repository based class loader classloader writer class loader writer impl classloaderwriterimpl class loader writer classloaderwriter logger logger logger logger factory loggerfactory get logger getlogger class loader writer impl classloaderwriterimpl string path classes org apache felix scr annotations property path string path prop classpath append org apache felix scr annotations property bool value boolvalue append string append prop append id appendid node type packages folders string folder folder loader owner string owner admin org apache felix scr annotations property owner string owner prop owner reference sling settings service slingsettingsservice settings owner loader jcr user string class loader owner classloaderowner configured path string class path classpath reference sling repository slingrepository repository reference policy reference policy referencepolicy dynamic cardinality reference cardinality referencecardinality optional unary mime type service mimetypeservice mime type service mimetypeservice reference reference interface referenceinterface dynamic class loader manager dynamicclassloadermanager bind bind dynamic class loader manager binddynamicclassloadermanager unbind unbind dynamic class loader manager unbinddynamicclassloadermanager service reference servicereference dynamic class loader manager dynamicclassloadermanager bundle service instance bundle caller bundle callerbundle cached repository loader repository class loader repositoryclassloader repository class loader repositoryclassloader activate component param component context componentcontext component context param properties configuration properties activate activate component context componentcontext component context componentcontext map string object properties class path classpath properties util propertiesutil to string tostring properties path prop path class path classpath ends with endswith class path classpath class path classpath substring class path classpath length properties util propertiesutil to boolean toboolean properties append prop append class path classpath class path classpath settings get sling id getslingid class loader owner classloaderowner properties util propertiesutil to string tostring properties owner prop owner caller bundle callerbundle component context componentcontext get using bundle getusingbundle deactivate component deactivate deactivate destroy repository class loader destroyrepositoryclassloader caller bundle callerbundle called handle binding dynamic class loader manager dynamicclassloadermanager service reference suppress warnings suppresswarnings unused bind dynamic class loader manager binddynamicclassloadermanager service reference servicereference dynamic class loader manager dynamicclassloadermanager called handle unbinding dynamic class loader manager dynamicclassloadermanager service reference suppress warnings suppresswarnings unused unbind dynamic class loader manager unbinddynamicclassloadermanager service reference servicereference dynamic class loader manager dynamicclassloadermanager dynamic class loader manager dynamicclassloadermanager dest roys destroys repository loader existing ungets dynamic class loader manager dynamicclassloadermanager service dynamic loader destroy repository class loader destroyrepositoryclassloader repository class loader repositoryclassloader rcl repository class loader repositoryclassloader rcl repository class loader repositoryclassloader rcl destroy service reference servicereference local dynamic class loader manager localdynamicclassloadermanager dynamic class loader manager dynamicclassloadermanager bundle local caller bundle localcallerbundle caller bundle callerbundle local dynamic class loader manager localdynamicclassloadermanager local caller bundle localcallerbundle local caller bundle localcallerbundle get bundle context getbundlecontext unget service ungetservice local dynamic class loader manager localdynamicclassloadermanager session session create session createsession repository exception repositoryexception admin istrative administrative session potential impersonation session admin repository login administrative loginadministrative admin session admin user owner admin get user d getuserid equals class loader owner classloaderowner admin impersonate owner logout admin session admin impersonate simple credentials simplecredentials class loader owner classloaderowner admin logout active is activate isactivate repository repository class loader repositoryclassloader get or create class loader getorcreateclassloader repository class loader repositoryclassloader repository class loader repositoryclassloader is live islive cleanup existing loader destroy repository class loader destroyrepositoryclassloader dynamic loader bundle loader writer dynamic class loader manager dynamicclassloadermanager dclm dynamic class loader manager dynamicclassloadermanager caller bundle callerbundle get bundle context getbundlecontext get service getservice dynamic class loader manager dynamicclassloadermanager repository class loader repositoryclassloader repository class loader repositoryclassloader class path classpath dclm get dynamic class loader getdynamicclassloader repository class loader repositoryclassloader handle change event handlechangeevent string path repository class loader repositoryclassloader rcl repository class loader repositoryclassloader rcl rcl handle event handleevent path org apache sling commons class loader classloader class loader writer classloaderwriter delete java lang string delete string string path clean path cleanpath handle change event handlechangeevent path session session session create session createsession session item exists itemexists path item file item fileitem session get item getitem path file item fileitem remove session save repository exception repositoryexception logger error remove path session session logout fall item exist error org apache sling commons class loader classloader class loader writer classloaderwriter get output stream getoutputstream java lang string output stream outputstream get output stream getoutputstream string string path clean path cleanpath repository output stream repositoryoutputstream path org apache sling commons class loader classloader class loader writer classloaderwriter rename java lang string java lang string rename string old name oldname string new name newname string old path oldpath clean path cleanpath old name oldname string new path newpath clean path cleanpath new name newname session session session create session createsession session move old path oldpath new path newpath session save handle change event handlechangeevent old name oldname handle change event handlechangeevent new name newname repository exception repositoryexception logger error rename old name oldname new name newname session session logout fall error existence old file name oldfilename creates folder hierarchy repository synchronize method reduce potential conflicts write session occur session create path parent path time sync hronizing synchronizing avoid situation method written fail safe manner mkdirs session session string path quick test session item exists itemexists path session get item getitem path is node isnode check path walking node current session get root node getrootnode string names path split names length names names length current has node hasnode names current current get node getnode names node parent node parentnode current adding node exception thread create node time current parent node parentnode add node addnode names folder session save repository exception repositoryexception session refresh parent node parentnode has node hasnode names current parent node parentnode get node getnode names current parent node parentnode add node addnode names folder session save repository exception repositoryexception logger error create folder path path session refresh repository exception repositoryexception error create helper method clean path replaces back slashes backslashes slashes cuts trailing spaces configured path access path string clean path cleanpath string path replace back slash backslash slash path path replace path ends with endswith path path substring path length class path classpath path repository output stream repositoryoutputstream byte array output stream bytearrayoutputstream class loader writer impl classloaderwriterimpl repository output provider repositoryoutputprovider string file name filename repository output stream repositoryoutputstream class loader writer impl classloaderwriterimpl repository output provider repositoryoutputprovider string file name filename repository output provider repositoryoutputprovider repository output provider repositoryoutputprovider file name filename file name filename override close io exception ioexception close session session session repository output provider repositoryoutputprovider create session createsession last pos lastpos file name filename last index of lastindexof string path last pos lastpos file name filename substring last pos lastpos string last pos lastpos file name filename file name filename substring last pos lastpos last pos lastpos repository output provider repositoryoutputprovider mkdirs session path io exception ioexception unable create path path node file node filenode node content node contentnode node parent node parentnode session item exists itemexists file name filename item item session get item getitem file name filename item is node isnode node node item is node isnode node item item get parent getparent jcr content equals node get name getname parent node parentnode node content node contentnode node node is node type isnodetype file parent node parentnode node content node contentnode node get node getnode jcr content parent node parentnode node content node contentnode node parent node parentnode item get parent getparent item remove session save file node filenode parent node parentnode add node addnode file last pos lastpos parent node parentnode session get root node getrootnode item parent session get item getitem path parent is node isnode io exception ioexception parent path node parent node parentnode node parent file node filenode parent node parentnode add node addnode file file node filenode content node contentnode file node filenode add node addnode jcr content resource mime type service mimetypeservice mt service mtservice repository output provider repositoryoutputprovider mime type service mimetypeservice string mime type mimetype mt service mtservice mt service mtservice get mime type getmimetype file name filename mime type mimetype mime type mimetype application octet stream content node contentnode set property setproperty jcr last modified lastmodified system current time millis currenttimemillis content node contentnode set property setproperty jcr data byte array input stream bytearrayinputstream buf size content node contentnode set property setproperty jcr mime type mimetype mime type mimetype session save repository output provider repositoryoutputprovider handle change event handlechangeevent file name filename repository exception repositoryexception io exception ioexception io exception ioexception write file file name filename reason to string tostring init cause initcause session session logout input stream inputstream get input stream getinputstream string io exception ioexception string path clean path cleanpath jcr content jcr data session session session create session createsession session item exists itemexists path property prop property session get item getitem path input stream inputstream prop get stream getstream byte array output stream bytearrayoutputstream baos byte array output stream bytearrayoutputstream buf read buf baos write buf byte array input stream bytearrayinputstream baos to byte array tobytearray file not found exception filenotfoundexception unable find repository exception repositoryexception io exception ioexception io exception ioexception failed input stream inputstream init cause initcause session session logout get last modified getlastmodified string string path clean path cleanpath jcr content jcr last modified lastmodified session session session create session createsession session item exists itemexists path property prop property session get item getitem path prop get long getlong repository exception repositoryexception logger error modification time session session logout class loader classloader get class loader getclassloader get or create class loader getorcreateclassloader