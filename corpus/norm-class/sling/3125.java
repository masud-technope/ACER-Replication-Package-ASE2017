licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling jcr jackrabbit base config java io exception ioexception java input stream inputstream java reader java util array list arraylist java util hash map hashmap java util hash set hashset java util list java util map java util properties java util java util concurrent concurrent hash map concurrenthashmap org apache jackrabbit core config bean config beanconfig org apache jackrabbit core config bean config visitor beanconfigvisitor org apache jackrabbit core config bean factory beanfactory org apache jackrabbit core config configuration exception configurationexception org apache jackrabbit core config repository configuration parser repositoryconfigurationparser org apache jackrabbit core config simple bean factory simplebeanfactory org osgi framework bundle context bundlecontext org osgi framework constants org osgi framework filter org osgi framework invalid syntax exception invalidsyntaxexception org osgi framework service reference servicereference org osgi framework service registration serviceregistration org osgi util tracker service tracker servicetracker org osgi util tracker service tracker customizer servicetrackercustomizer org slf logger org slf logger factory loggerfactory org xml sax input source inputsource osgi bean factory osgibeanfactory bean factory beanfactory service tracker customizer servicetrackercustomizer logger log logger factory loggerfactory get logger getlogger get class getclass bean factory beanfactory delegate simple bean factory simplebeanfactory bundle context bundlecontext bundle context bundlecontext tracker track services jackrabbit extensions service tracker servicetracker tracker instances actual instances look edup lookedup osg i osgi service registry dependencies hash set hashset map class name classname instances map string class name mapping classnamemapping hash map hashmap string map instance instance implementation map object instance map instancemap concurrent hash map concurrenthashmap object service registration serviceregistration bean factory reg beanfactoryreg osgi bean factory osgibeanfactory bundle context bundlecontext bundle context bundlecontext bundle context bundlecontext bundle context bundlecontext filter filter filter bundle context bundlecontext create filter createfilter jackrabbit extension invalid syntax exception invalidsyntaxexception runtime exception runtimeexception invalid filter tracker service tracker servicetracker bundle context bundlecontext filter initialize input source inputsource config source configsource configuration exception configurationexception determine dependencies determinedependencies config source configsource create class name map pings createclassnamemappings tracker open check state checkstate close bean factory reg beanfactoryreg bean factory reg beanfactoryreg unregister bean factory reg beanfactoryreg tracker close dependencies clear instance map instancemap clear class name mapping classnamemapping clear bean factory beanfactory object new instance newinstance clazz bean config beanconfig config configuration exception configurationexception target class targetclass get class from config getclassfromconfig config target class targetclass is interface isinterface object instance map instancemap target class targetclass configuration exception configurationexception instance registered type target class targetclass get name getname delegate new instance newinstance clazz config service tracker customizer servicetrackercustomizer object adding service addingservice service reference servicereference reference object instance bundle context bundlecontext get service getservice reference deps provided depsprovided determine provided dependencies determineprovideddependencies reference register instance registerinstance deps provided depsprovided instance check state checkstate deps provided depsprovided modified service modifiedservice service reference servicereference service reference servicereference object removed service removedservice service reference servicereference reference object deregister instance deregisterinstance check state checkstate bundle context bundlecontext unget service ungetservice reference callback methods callback method invoked services required jackrabbit impl ementing implementing manage repository lifecycle implementation registers bean factory beanfactory instance repository creator create repository dependencies satisfied dependenciessatisfied todo review thread safety aspect service registration serviceregistration reg bean factory reg beanfactoryreg reg bean factory reg beanfactoryreg bundle context bundlecontext register service registerservice bean factory beanfactory get name getname properties log info dependencies satisfied registering bean factory beanfactory instance callback method invoked service required jackrabbit impl ementing implementing manage repository lifecycle implementation registers bean factory beanfactory instance repository creator service depends bean factory beanfactory reference not ified notified react dependencies un satisfied dependenciesunsatisfied service registration serviceregistration reg bean factory reg beanfactoryreg reg reg unregister bean factory reg beanfactoryreg log info dependencies unsatisfied deregistering bean factory beanfactory instance get class from config getclassfromconfig bean config beanconfig config string cname config get class name getclassname config get class loader getclassloader load class loadclass cname class not found exception classnotfoundexception runtime exception runtimeexception load cname check state checkstate instance map instancemap size dependencies size dependencies satisfied dependenciessatisfied dependencies un satisfied dependenciesunsatisfied determine dependencies determinedependencies input source inputsource source configuration exception configurationexception properties properties put all putall system get properties getproperties set property setproperty repository configuration parser repositoryconfigurationparser repository variable fake path repository configuration parser repositoryconfigurationparser parser repository configuration parser repositoryconfigurationparser parser set config visitor setconfigvisitor dep finder bean config visitor depfinderbeanconfigvisitor parser parse repository config parserepositoryconfig source close source input stream inputstream source get byte stream getbytestream close io exception ioexception ignore reader source get character stream getcharacterstream close io exception ioexception ignore dependencies is empty isempty log info dependencies configured repository created osg i osgi dependency injected log info dependencies determined repository repository started dependencies satisfied dependencies register instance registerinstance deps provided depsprovided object deps provided depsprovided instance map instancemap deregister instance deregisterinstance deps provided depsprovided deps provided depsprovided instance map instancemap remove determines dependencies service reference servicereference satisfy determine provided dependencies determineprovideddependencies service reference servicereference obj ectclass objectclass property determines classes service instance published interfaces get class getclass get interfaces getinterfaces string interfaces string get property getproperty constants obj ectclass objectclass list deps provided depsprovided array list arraylist interfaces length string int f intf interfaces class name mapping classnamemapping contains key containskey int f intf deps provided depsprovided add class name mapping classnamemapping int f intf deps provided depsprovided to array toarray deps provided depsprovided size create class name map pings createclassnamemappings clazz dependencies class name mapping classnamemapping clazz get name getname clazz dep finder bean config visitor depfinderbeanconfigvisitor bean config visitor beanconfigvisitor visit bean config beanconfig config clazz get class from config getclassfromconfig config clazz is interface isinterface dependencies add clazz