licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling distribution serialization impl avro javax annotation check for null checkfornull javax annotation nonnull java buffered input stream bufferedinputstream java byte array input stream bytearrayinputstream java file java file output stream fileoutputstream java io exception ioexception java input stream inputstream java output stream outputstream java nio byte buffer bytebuffer java text simple date format simpledateformat java util arrays java util collection java util collections java util gregorian calendar gregoriancalendar java util hash map hashmap java util hash set hashset java util linked list linkedlist java util list java util map java util org apache avro schema org apache avro file data file reader datafilereader org apache avro file data file writer datafilewriter org apache avro generic data genericdata org apache avro datum reader datumreader org apache avro datum writer datumwriter org apache avro specific specific datum reader specificdatumreader org apache avro specific specific datum writer specificdatumwriter org apache avro util utf org apache commons io utils ioutils org apache jackrabbit jcr constants jcrconstants org apache sling api resource persistence exception persistenceexception org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling api resource value map valuemap org apache sling distribution distribution request distributionrequest org apache sling distribution common distribution exception distributionexception org apache sling distribution serialization distribution package distributionpackage org apache sling distribution serialization distribution package builder distributionpackagebuilder org apache sling distribution serialization impl file distribution package filedistributionpackage org slf logger org slf logger factory loggerfactory avro based link distribution package builder distributionpackagebuilder avro distribution package builder avrodistributionpackagebuilder distribution package builder distributionpackagebuilder logger log logger factory loggerfactory get logger getlogger get class getclass data file writer datafilewriter avro shallow resource avroshallowresource data file writer datafilewriter schema schema string ignored properties ignoredproperties string ignored node names ignorednodenames simple date format simpledateformat date format dateformat simple date format simpledateformat yyyy sss avro distribution package builder avrodistributionpackagebuilder datum writer datumwriter avro shallow resource avroshallowresource datum writer datumwriter specific datum writer specificdatumwriter avro shallow resource avroshallowresource avro shallow resource avroshallowresource data file writer datafilewriter data file writer datafilewriter avro shallow resource avroshallowresource datum writer datumwriter schema schema parser parse get class getclass get resource as stream getresourceasstream shallow resource shallowresource avsc io exception ioexception string i props iprops hash set hashset string i props iprops add jcr constants jcrconstants jcr frozenmixintypes i props iprops add jcr constants jcrconstants jcr frozenprimarytype i props iprops add jcr constants jcrconstants jcr frozenuuid i props iprops add jcr constants jcrconstants jcr version history versionhistory i props iprops add jcr constants jcrconstants jcr base version baseversion i props iprops add jcr constants jcrconstants jcr predecessors i props iprops add jcr constants jcrconstants jcr success ors successors i props iprops add jcr constants jcrconstants jcr ischeckedout i props iprops add jcr constants jcrconstants jcr uuid ignored properties ignoredproperties collections unmodifiable set unmodifiableset i props iprops string i names inames hash set hashset string i names inames add rep policy ignored node names ignorednodenames collections unmodifiable set unmodifiableset i names inames override string get type gettype avro distribution package builder factory avrodistributionpackagebuilderfactory resource avro resourceavro nonnull override distribution package distributionpackage create package createpackage nonnull resource resolver resourceresolver resource resolver resourceresolver nonnull distribution request distributionrequest request distribution exception distributionexception distribution package distributionpackage distribution package distributionpackage file file file create temp file createtempfile system nano time nanotime avro data file writer datafilewriter create schema file string path request get paths getpaths resource resource resource resolver resourceresolver get resource getresource path avro shallow resource avroshallowresource avro shallow resource avroshallowresource get avro shallow resource getavroshallowresource request is deep isdeep path path resource data file writer datafilewriter append avro shallow resource avroshallowresource distribution package distributionpackage file distribution package filedistributionpackage file get type gettype exception distribution exception distributionexception data file writer datafilewriter close io exception ioexception distribution package distributionpackage avro shallow resource avroshallowresource get avro shallow resource getavroshallowresource deep string path resource resource io exception ioexception avro shallow resource avroshallowresource avro shallow resource avroshallowresource avro shallow resource avroshallowresource avro shallow resource avroshallowresource set name setname avro system nano time nanotime avro shallow resource avroshallowresource set path setpath path avro shallow resource avroshallowresource set resource type setresourcetype resource get resource type getresourcetype value map valuemap value map valuemap resource get value map getvaluemap map char sequence charsequence object map hash map hashmap char sequence charsequence object map entry string object entry value map valuemap entry set entryset ignored properties ignoredproperties entry get key getkey object entry get value getvalue gregorian calendar gregoriancalendar date format dateformat format gregorian calendar gregoriancalendar get time gettime object object object arrays as list aslist input stream inputstream byte buffer bytebuffer wrap io utils ioutils to byte array tobytearray input stream inputstream map entry get key getkey avro shallow resource avroshallowresource set value map setvaluemap map list avro shallow resource avroshallowresource children linked list linkedlist avro shallow resource avroshallowresource deep resource child resource get children getchildren string child path childpath child get path getpath ignored node names ignorednodenames child get name getname children add get avro shallow resource getavroshallowresource child path childpath child avro shallow resource avroshallowresource set children setchildren children avro shallow resource avroshallowresource nonnull override distribution package distributionpackage read package readpackage nonnull resource resolver resourceresolver resource resolver resourceresolver nonnull input stream inputstream stream distribution exception distributionexception file file file create temp file createtempfile system nano time nanotime avro output stream outputstream output file output stream fileoutputstream file copied io utils ioutils copy stream output log debug copied bytes copied file distribution package filedistributionpackage file get type gettype exception distribution exception distributionexception collection avro shallow resource avroshallowresource read avro resources readavroresources file file io exception ioexception datum reader datumreader avro shallow resource avroshallowresource datum reader datumreader specific datum reader specificdatumreader avro shallow resource avroshallowresource avro shallow resource avroshallowresource data file reader datafilereader avro shallow resource avroshallowresource data file reader datafilereader data file reader datafilereader avro shallow resource avroshallowresource file datum reader datumreader avro shallow resource avroshallowresource avro resource avroresource collection avro shallow resource avroshallowresource avro resources avroresources linked list linkedlist avro shallow resource avroshallowresource data file reader datafilereader has next hasnext reuse avro resource avroresource object passing saves alloc ating allocating garbage collecting objects files items avro resource avroresource data file reader datafilereader avro resource avroresource avro resources avroresources add avro resource avroresource avro resources avroresources check for null checkfornull override distribution package distributionpackage get package getpackage nonnull resource resolver resourceresolver resource resolver resourceresolver nonnull string file file file file exists file distribution package filedistributionpackage file get type gettype override install package installpackage nonnull resource resolver resourceresolver resource resolver resourceresolver nonnull distribution package distributionpackage distribution package distributionpackage distribution exception distributionexception distribution package distributionpackage file distribution package filedistributionpackage string file path filepath distribution package distributionpackage get id getid file file file path filepath collection avro shallow resource avroshallowresource avro shallow resources avroshallowresources read avro resources readavroresources avro shallow resource avroshallowresource avro shallow resources avroshallowresources persist resource persistresource resource resolver resourceresolver resource resolver resourceresolver commit exception distribution exception distributionexception persist resource persistresource nonnull resource resolver resourceresolver resource resolver resourceresolver avro shallow resource avroshallowresource persistence exception persistenceexception string path get path getpath to string tostring trim string path substring path last index of lastindexof string substring path substring path last index of lastindexof string parent path parentpath substring length substring map string object map hash map hashmap string object map char sequence charsequence object value map valuemap get value map getvaluemap map entry char sequence charsequence object entry value map valuemap entry set entryset object entry get value getvalue generic data genericdata array generic data genericdata array array generic data genericdata array string string array size length object array to string tostring utf to string tostring byte buffer bytebuffer bytes byte buffer bytebuffer array buffered input stream bufferedinputstream byte array input stream bytearrayinputstream bytes map entry get key getkey to string tostring resource existing resource existingresource resource resolver resourceresolver get resource getresource path existing resource existingresource resource resolver resourceresolver delete existing resource existingresource resource parent resource resolver resourceresolver get resource getresource parent path parentpath parent parent create parent createparent resource resolver resourceresolver parent path parentpath resource created resource createdresource resource resolver resourceresolver create parent map log info created resource created resource createdresource avro shallow resource avroshallowresource child get children getchildren persist resource persistresource created resource createdresource get resource resolver getresourceresolver child resource create parent createparent resource resolver resourceresolver resource resolver resourceresolver string path persistence exception persistenceexception string parent path parentpath path substring path last index of lastindexof string path substring path last index of lastindexof resource parent resource parentresource resource resolver resourceresolver get resource getresource parent path parentpath parent resource parentresource parent resource parentresource create parent createparent resource resolver resourceresolver parent path parentpath map string object properties hash map hashmap string object resource resolver resourceresolver create parent resource parentresource properties