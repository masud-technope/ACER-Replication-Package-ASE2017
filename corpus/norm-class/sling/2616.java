licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling distribution pack aging packaging impl importer javax annotation nonnull javax jcr node javax jcr session javax jcr node type nodetype node type nodetype javax jcr security access control manager accesscontrolmanager javax jcr security privilege java input stream inputstream org apache commons io utils ioutils org apache jackrabbit jcr constants jcrconstants org apache jackrabbit util text org apache sling api resource resource resolver resourceresolver org apache sling distribution common distribution exception distributionexception org apache sling distribution serialization distribution package distributionpackage org apache sling distribution pack aging packaging distribution package importer distributionpackageimporter org apache sling distribution serialization distribution package info distributionpackageinfo org apache sling jcr api sling repository slingrepository org slf logger org slf logger factory loggerfactory link org apache sling distribution pack aging packaging distribution package importer distributionpackageimporter importing link distribution package distributionpackage stream type underlying jcr repository repository distribution package importer repositorydistributionpackageimporter distribution package importer distributionpackageimporter logger log logger factory loggerfactory get logger getlogger get class getclass sling repository slingrepository repository string service name servicename string path string privilege name privilegename repository distribution package importer repositorydistributionpackageimporter sling repository slingrepository repository string service name servicename string path string privilege name privilegename repository repository service name servicename service name servicename path path privilege name privilegename privilege name privilegename import package importpackage nonnull resource resolver resourceresolver resource resolver resourceresolver nonnull distribution package distributionpackage distribution package distributionpackage distribution exception distributionexception session session session authenticate last slash lastslash distribution package distributionpackage get id getid last index of lastindexof string node name nodename text escape last slash lastslash distribution package distributionpackage get id getid distribution package distributionpackage get id getid substring last slash lastslash log debug importing distribution package distributionpackage get id getid node name nodename session node added node addednode session get node getnode path add node addnode node name nodename node type nodetype file node content node contentnode added node addednode add node addnode jcr constants jcrconstants jcr content node type nodetype resource content node contentnode input stream inputstream input stream inputstream input stream inputstream distribution package distributionpackage create input stream createinputstream content node contentnode set property setproperty jcr constants jcrconstants jcr data session get value factory getvaluefactory create binary createbinary input stream inputstream content node contentnode set property setproperty type distribution package distributionpackage get type gettype session save io utils ioutils close quietly closequietly input stream inputstream log info imported repository node distribution package distributionpackage get id getid added node addednode get path getpath exception session deliver repository exception distribution exception distributionexception session session log out logout distribution package info distributionpackageinfo import stream importstream nonnull resource resolver resourceresolver resource resolver resourceresolver nonnull input stream inputstream stream distribution exception distributionexception distribution exception distributionexception supported session authenticate exception session session repository login service loginservice service name servicename session access control manager accesscontrolmanager access control manager accesscontrolmanager session get access control manager getaccesscontrolmanager privilege privilege access control manager accesscontrolmanager privilege from name privilegefromname privilege name privilegename access control manager accesscontrolmanager has privileges hasprivileges path privilege privilege session log out logout exception failed access path path privilege privilege log debug authenticated path privilege path privilege name privilegename session