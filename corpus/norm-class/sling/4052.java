licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling distribution serialization impl kryo javax annotation check for null checkfornull javax annotation nonnull java byte array input stream bytearrayinputstream java file java file output stream fileoutputstream java io exception ioexception java input stream inputstream java output stream outputstream java util collections java util hash map hashmap java util hash set hashset java util linked list linkedlist java util map java util esotericsoftware kryo kryo esotericsoftware kryo serializer esotericsoftware kryo input esotericsoftware kryo output org apache commons io utils ioutils org apache jackrabbit jcr constants jcrconstants org apache sling api resource persistence exception persistenceexception org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling api resource synthetic resource syntheticresource org apache sling api resource value map valuemap org apache sling api wrappers value map decorator valuemapdecorator org apache sling distribution distribution request distributionrequest org apache sling distribution common distribution exception distributionexception org apache sling distribution serialization distribution package distributionpackage org apache sling distribution serialization distribution package builder distributionpackagebuilder org apache sling distribution serialization impl file distribution package filedistributionpackage org obj enesis objenesis str ategy strategy std ins tantiator strategy stdinstantiatorstrategy org slf logger org slf logger factory loggerfactory link org apache sling distribution serialization distribution package builder distributionpackagebuilder based link kryo serial izer serializer sling link resource kryo resource distribution package builder kryoresourcedistributionpackagebuilder distribution package builder distributionpackagebuilder kryo kryo kryo logger log logger factory loggerfactory get logger getlogger get class getclass string ignored properties ignoredproperties string ignored node names ignorednodenames string get type gettype kryo resource kryo resource distribution package builder kryoresourcedistributionpackagebuilder kryo set ins tantiator strategy setinstantiatorstrategy kryo default ins tantiator strategy defaultinstantiatorstrategy std ins tantiator strategy stdinstantiatorstrategy kryo add default serializer adddefaultserializer resource resource serializer resourceserializer kryo add default serializer adddefaultserializer input stream inputstream input stream serializer inputstreamserializer string i props iprops hash set hashset string i props iprops add jcr constants jcrconstants jcr frozenmixintypes i props iprops add jcr constants jcrconstants jcr frozenprimarytype i props iprops add jcr constants jcrconstants jcr frozenuuid i props iprops add jcr constants jcrconstants jcr version history versionhistory i props iprops add jcr constants jcrconstants jcr base version baseversion i props iprops add jcr constants jcrconstants jcr predecessors i props iprops add jcr constants jcrconstants jcr success ors successors i props iprops add jcr constants jcrconstants jcr ischeckedout i props iprops add jcr constants jcrconstants jcr uuid ignored properties ignoredproperties collections unmodifiable set unmodifiableset i props iprops string i names inames hash set hashset string i names inames add rep policy ignored node names ignorednodenames collections unmodifiable set unmodifiableset i names inames nonnull distribution package distributionpackage create package createpackage nonnull resource resolver resourceresolver resource resolver resourceresolver nonnull distribution request distributionrequest request distribution exception distributionexception distribution package distributionpackage distribution package distributionpackage string paths request get paths getpaths file file file create temp file createtempfile system nano time nanotime kryo output output output file output stream fileoutputstream file linked list linkedlist resource resources linked list linkedlist resource string paths resource resource resource resolver resourceresolver get resource getresource resource add resource addresource request is deep isdeep resources resource kryo write object writeobject output resources output close distribution package distributionpackage file distribution package filedistributionpackage file get type gettype exception distribution exception distributionexception distribution package distributionpackage add resource addresource deep linked list linkedlist resource resources resource resource resources add resource resource child resource get children getchildren deep ignored node names ignorednodenames resource get name getname add resource addresource resources child nonnull distribution package distributionpackage read package readpackage nonnull resource resolver resourceresolver resource resolver resourceresolver nonnull input stream inputstream stream distribution exception distributionexception file file file create temp file createtempfile system nano time nanotime kryo output stream outputstream output file output stream fileoutputstream file copied io utils ioutils copy stream output log debug copied bytes copied file distribution package filedistributionpackage file get type gettype exception distribution exception distributionexception check for null checkfornull distribution package distributionpackage get package getpackage nonnull resource resolver resourceresolver resource resolver resourceresolver nonnull string file file file file exists file distribution package filedistributionpackage file get type gettype install package installpackage nonnull resource resolver resourceresolver resource resolver resourceresolver nonnull distribution package distributionpackage distribution package distributionpackage distribution exception distributionexception input input input distribution package distributionpackage create input stream createinputstream linked list linkedlist resource resources linked list linkedlist resource kryo read object readobject input linked list linkedlist input close resource resource resources persist resource persistresource resource resolver resourceresolver resource resource resolver resourceresolver commit exception distribution exception distributionexception persist resource persistresource nonnull resource resolver resourceresolver resource resolver resourceresolver resource resource persistence exception persistenceexception string path resource get path getpath trim string path substring path last index of lastindexof string substring path substring path last index of lastindexof string parent path parentpath substring length substring resource existing resource existingresource resource resolver resourceresolver get resource getresource path existing resource existingresource resource resolver resourceresolver delete existing resource existingresource resource parent resource resolver resourceresolver get resource getresource parent path parentpath parent parent create parent createparent resource resolver resourceresolver parent path parentpath resource created resource createdresource resource resolver resourceresolver create parent resource get value map getvaluemap log info created resource created resource createdresource resource create parent createparent resource resolver resourceresolver resource resolver resourceresolver string path persistence exception persistenceexception string parent path parentpath path substring path last index of lastindexof string path substring path last index of lastindexof resource parent resource parentresource resource resolver resourceresolver get resource getresource parent path parentpath parent resource parentresource parent resource parentresource create parent createparent resource resolver resourceresolver parent path parentpath map string object properties hash map hashmap string object resource resolver resourceresolver create parent resource parentresource properties resource serializer resourceserializer serializer resource override write kryo kryo output output resource resource value map valuemap value map valuemap resource get value map getvaluemap output write string writestring resource get path getpath output write string writestring resource get resource type getresourcetype hash map hashmap map hash map hashmap string object map entry string object entry value map valuemap entry set entryset ignored properties ignoredproperties entry get key getkey map entry get key getkey entry get value getvalue kryo write object or null writeobjectornull output map hash map hashmap override resource read kryo kryo input input resource type string path input read string readstring string resource type resourcetype input read string readstring hash map hashmap string object map kryo read object or null readobjectornull input hash map hashmap synthetic resource syntheticresource path resource type resourcetype override value map valuemap get value map getvaluemap value map decorator valuemapdecorator map value map serializer valuemapserializer serializer value map valuemap override write kryo kryo output output value map valuemap value map valuemap map entry string object entry value map valuemap entry set entryset output write string writestring entry get key getkey output write string writestring entry get value getvalue to string tostring override value map valuemap read kryo kryo input input value map valuemap type map string object map hash map hashmap string object string key key input read string readstring string input read string readstring map key value map decorator valuemapdecorator map input stream serializer inputstreamserializer serializer input stream inputstream override write kryo kryo output output input stream inputstream stream bytes io utils ioutils to byte array tobytearray stream output write int writeint bytes length output write bytes io exception ioexception log warn serialize input stream override input stream inputstream read kryo kryo input input input stream inputstream type size input read int readint bytes size input read bytes readbytes bytes byte array input stream bytearrayinputstream bytes