licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling discovery base org junit assert equals assertequals org junit assert not null assertnotnull org junit assert not same assertnotsame org junit assert null assertnull org junit assert true asserttrue org junit fail java util list java util map java util uuid org apache log level org apache log log manager logmanager org apache sling discovery cluster view clusterview org apache sling discovery instance description instancedescription org apache sling discovery topology event topologyevent org apache sling discovery topology event topologyevent type org apache sling discovery base commons undefined cluster view exception undefinedclusterviewexception org apache sling discovery base setup virtual instance virtualinstance org apache sling discovery base setup virtual instance builder virtualinstancebuilder org apache sling discovery base setup mock asserting topology event listener assertingtopologyeventlistener org apache sling discovery base setup mock property provider impl propertyproviderimpl org junit org junit org junit test org slf logger org slf logger factory loggerfactory abstract single instance test abstractsingleinstancetest logger logger logger factory loggerfactory get logger getlogger get class getclass virtual instance virtualinstance instance string property value propertyvalue level log level loglevel virtual instance builder virtualinstancebuilder new builder newbuilder setup exception org apache log logger discovery logger discoverylogger log manager logmanager get root logger getrootlogger get logger getlogger org apache sling discovery log level loglevel discovery logger discoverylogger get level getlevel discovery logger discoverylogger set level setlevel level debug logger info setup creating standalone instance instance new builder newbuilder set debug name setdebugname standalone instance standaloneinstance new repository newrepository discovery impl set connector ping timeout setconnectorpingtimeout set connector ping interval setconnectorpinginterval set min event delay setmineventdelay heartbeat int erval interval prevent disturb explicit heartbeats test build logger info setup creating standalone instance tear down teardown exception org apache log logger discovery logger discoverylogger log manager logmanager get root logger getrootlogger get logger getlogger org apache sling discovery discovery logger discoverylogger set level setlevel log level loglevel logger info tear down teardown stop ping stopping standalone instance instance instance instance logger info tear down teardown stop ping stopping standalone instance test test get ters testgetters undefined cluster view exception undefinedclusterviewexception interrupted exception interruptedexception logger info test get ters testgetters start assert not null assertnotnull instance logger info sling instance get sling id getslingid instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview sling fail complain undefined cluster view exception undefinedclusterviewexception instance heartbeats and check view heartbeatsandcheckview wait vote happen thread sleep assert not null assertnotnull instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview cluster view clusterview instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview logger info cluster view get id getid assert not null assertnotnull get id getid assert not same assertnotsame get id getid list instance description instancedescription instances get instances getinstances assert not null assertnotnull instances assert true asserttrue instances size instance description instancedescription my instance myinstance instances assert not null assertnotnull my instance myinstance assert true asserttrue my instance myinstance get cluster view getclusterview logger info instance my instance myinstance get sling id getslingid assert equals assertequals instance get sling id getslingid my instance myinstance get sling id getslingid map string string properties my instance myinstance get properties getproperties assert not null assertnotnull properties assert null assertnull my instance myinstance get property getproperty foo assert true asserttrue my instance myinstance is leader isleader assert true asserttrue my instance myinstance is local islocal logger info test get ters testgetters test test property providers testpropertyproviders throwable logger info test property providers testpropertyproviders start string property name propertyname uuid randomuuid to string tostring property value propertyvalue uuid randomuuid to string tostring property provider impl propertyproviderimpl property provider impl propertyproviderimpl set property setproperty property name propertyname property value propertyvalue instance bind property provider bindpropertyprovider property name propertyname instance heartbeats and check view heartbeatsandcheckview wait vote happen thread sleep assert equals assertequals property value propertyvalue instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get instances getinstances get property getproperty property name propertyname property value propertyvalue uuid randomuuid to string tostring set property setproperty property name propertyname property value propertyvalue instance heartbeats and check view heartbeatsandcheckview assert equals assertequals property value propertyvalue instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get instances getinstances get property getproperty property name propertyname assert null assertnull instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get instances getinstances get property getproperty uuid randomuuid to string tostring logger info test property providers testpropertyproviders test test invalid properties testinvalidproperties throwable logger info test invalid properties testinvalidproperties start instance heartbeats and check view heartbeatsandcheckview instance heartbeats and check view heartbeatsandcheckview string property value propertyvalue uuid randomuuid to string tostring thread sleep do test property dotestproperty uuid randomuuid to string tostring property value propertyvalue property value propertyvalue do test property dotestproperty property value propertyvalue do test property dotestproperty property value propertyvalue property value propertyvalue do test property dotestproperty property value propertyvalue property value propertyvalue do test property dotestproperty jcr uuid randomuuid to string tostring property value propertyvalue do test property dotestproperty uuid randomuuid to string tostring property value propertyvalue do test property dotestproperty uuid randomuuid to string tostring test property value propertyvalue do test property dotestproperty uuid randomuuid to string tostring test property value propertyvalue logger info test invalid properties testinvalidproperties do test property dotestproperty string property name propertyname string property value propertyvalue string expected property value expectedpropertyvalue throwable property provider impl propertyproviderimpl property provider impl propertyproviderimpl set property setproperty property name propertyname property value propertyvalue instance bind property provider bindpropertyprovider property name propertyname assert equals assertequals expected property value expectedpropertyvalue instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview get instances getinstances get property getproperty property name propertyname test test topology event listeners testtopologyeventlisteners throwable logger info test topology event listeners testtopologyeventlisteners start instance heartbeats and check view heartbeatsandcheckview logger info test topology event listeners testtopologyeventlisteners sleep thread sleep instance heartbeats and check view heartbeatsandcheckview logger info test topology event listeners testtopologyeventlisteners sleep thread sleep asserting topology event listener assertingtopologyeventlistener asserting topology event listener assertingtopologyeventlistener asserting topology event listener assertingtopologyeventlistener asserting topology event listener assertingtopologyeventlistener add expected addexpected type topology init logger info test topology event listeners testtopologyeventlisteners binding event listener instance bind topology event listener bindtopologyeventlistener asserting topology event listener assertingtopologyeventlistener sling async event sending requires minimal wait time now ada ys nowadays thread sleep assert equals assertequals asserting topology event listener assertingtopologyeventlistener get remaining expected count getremainingexpectedcount string property name propertyname uuid randomuuid to string tostring property value propertyvalue uuid randomuuid to string tostring property provider impl propertyproviderimpl property provider impl propertyproviderimpl set property setproperty property name propertyname property value propertyvalue asserting topology event listener assertingtopologyeventlistener add expected addexpected type properties changed assert equals assertequals asserting topology event listener assertingtopologyeventlistener get remaining expected count getremainingexpectedcount assert equals assertequals get get cnt getgetcnt instance bind property provider bindpropertyprovider property name propertyname logger info test topology event listeners testtopologyeventlisteners sleep thread sleep logger info test topology event listeners testtopologyeventlisteners dumping failure asserting topology event listener assertingtopologyeventlistener dump assert equals assertequals asserting topology event listener assertingtopologyeventlistener get remaining expected count getremainingexpectedcount assume get property getproperty called called multiple times assert true asserttrue get get cnt getgetcnt asserting topology event listener assertingtopologyeventlistener add expected addexpected type properties changed assert equals assertequals asserting topology event listener assertingtopologyeventlistener get remaining expected count getremainingexpectedcount set get cnt setgetcnt property value propertyvalue uuid randomuuid to string tostring set property setproperty property name propertyname property value propertyvalue assert equals assertequals get get cnt getgetcnt instance heartbeats and check view heartbeatsandcheckview logger info test topology event listeners testtopologyeventlisteners sleep thread sleep assert equals assertequals asserting topology event listener assertingtopologyeventlistener get remaining expected count getremainingexpectedcount assert equals assertequals get get cnt getgetcnt heartbeat repeat result call instance heartbeats and check view heartbeatsandcheckview logger info test topology event listeners testtopologyeventlisteners sleep thread sleep assert equals assertequals asserting topology event listener assertingtopologyeventlistener get remaining expected count getremainingexpectedcount assert equals assertequals get get cnt getgetcnt logger info test topology event listeners testtopologyeventlisteners test test bootstrap testbootstrap throwable logger info test bootstrap testbootstrap start instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview fail complain undefined cluster view exception undefinedclusterviewexception sling delaying init event events view establish heartbeats asserting topology event listener assertingtopologyeventlistener ada asserting topology event listener assertingtopologyeventlistener instance bind topology event listener bindtopologyeventlistener ada assert equals assertequals ada get events getevents size assert equals assertequals ada get unexpected count getunexpectedcount instance get cluster view service getclusterviewservice get local cluster view getlocalclusterview fail complain undefined cluster view exception undefinedclusterviewexception ada add expected addexpected type topology init instance heartbeats and check view heartbeatsandcheckview thread sleep instance heartbeats and check view heartbeatsandcheckview thread sleep logger info test boostrap testboostrap dumping repo instance dump repo dumprepo logger info test boostrap testboostrap dumping listener ada dump assert equals assertequals ada get unexpected count getunexpectedcount assert equals assertequals ada get events getevents size topology event topologyevent init event initevent ada get events getevents remove assert not null assertnotnull init event initevent assert not null assertnotnull init event initevent get new view getnewview assert not null assertnotnull init event initevent get new view getnewview get cluster views getclusterviews view established expect normal established instance description establishedinstancedescription instance assert established view assertestablishedview logger info test bootstrap testbootstrap