licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling xss impl java input stream inputstream java util arrays java util collections java util map java util concurrent concurrent hash map concurrenthashmap java util regex pattern org apache felix scr annotations activate org apache felix scr annotations component org apache felix scr annotations property org apache felix scr annotations reference org apache felix scr annotations service org apache sling api sling constants slingconstants org apache sling api resource login exception loginexception org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling api resource resource resolver factory resourceresolverfactory org apache sling xss protection context protectioncontext org apache sling xss xss filter xssfilter org osgi service event event org osgi service event event constants eventconstants org osgi service event event handler eventhandler org owasp validator html model attribute org owasp validator html model tag org slf logger org slf logger factory loggerfactory code xss filter xssfilter code anti samy antisamy xss protection library href http code google owaspantisamy http code google owaspantisamy component service event handler eventhandler xss filter xssfilter property event constants eventconstants event topic org apache sling api resource resource xss filter impl xssfilterimpl xss filter xssfilter event handler eventhandler logger logger logger factory loggerfactory get logger getlogger xss filter impl xssfilterimpl href configuration copied config xml supplied ant i samy antisamy attribute href attribute attribute href arrays as list aslist pattern compile pattern compile mailto collections string empty list emptylist remove attribute removeattribute string policy path sling xss config xml policy cache size policy handler policyhandler default handler defaulthandler attribute href attribute hrefattribute contexts xss filter rule xssfilterrule html html context htmlhtmlcontext html to html content context htmltohtmlcontentcontext xss filter rule xssfilterrule plain html context plainhtmlcontext plain text to html content context plaintexttohtmlcontentcontext policies cache map string policy handler policyhandler policies concurrent hash map concurrenthashmap string policy handler policyhandler reference resource resolver factory resourceresolverfactory resource resolver factory resourceresolverfactory override handle event handleevent event event string path string event get property getproperty sling constants slingconstants property path path ends with endswith policy path logger debug detected policy file change updating handler path update default handler updatedefaulthandler override check protection context protectioncontext context string src check context src override string filter string src filter xss filter xssfilter context src override string filter protection context protectioncontext context string src filter context src activate suppress warnings suppresswarnings unused activate load handler update default handler updatedefaulthandler update default handler updatedefaulthandler resource resolver resourceresolver admin resolver adminresolver admin resolver adminresolver resource resolver factory resourceresolverfactory get administrative resource resolver getadministrativeresourceresolver resource policy resource policyresource admin resolver adminresolver get resource getresource policy path policy resource policyresource input stream inputstream policy stream policystream policy resource policyresource adapt to adaptto input stream inputstream policy stream policystream default handler defaulthandler set default handler setdefaulthandler policy handler policyhandler policy stream policystream policy stream policystream close exception logger error unable load policy policy resource policyresource get path getpath content installed service active embedded file handler logger debug find policy file location attempting resource embedded bundle policy path input stream inputstream policy stream policystream get class getclass get class loader getclassloader get resource as stream getresourceasstream sling inf content config xml policy stream policystream default handler defaulthandler set default handler setdefaulthandler policy handler policyhandler policy stream policystream policy stream policystream close exception logger error unable load policy embedded policy file default handler defaulthandler illegal state exception illegalstateexception load policy handler login exception loginexception logger error unable load policy file admin resolver adminresolver admin resolver adminresolver close filter rule context xss filter rule xssfilterrule get filter rule getfilterrule protection context protectioncontext context context null pointer exception nullpointerexception context context protection context protectioncontext html html content html html context htmlhtmlcontext plain html context plainhtmlcontext methods api client code dependency methods ris ky risky removed point time implementation check protection context protectioncontext context string src string policy xss filter rule xssfilterrule ctx get filter rule getfilterrule context policy handler policyhandler handler ctx supports policy supportspolicy policy handler policies policy handler default handler defaulthandler ctx check handler src string filter protection context protectioncontext context string src string policy src xss filter rule xssfilterrule ctx get filter rule getfilterrule context policy handler policyhandler handler ctx supports policy supportspolicy policy handler policies policy handler default handler defaulthandler ctx filter handler src suppress warnings suppresswarnings unused set default policy setdefaultpolicy input stream inputstream policy stream policystream exception set default handler setdefaulthandler policy handler policyhandler policy stream policystream set default handler setdefaulthandler policy handler policyhandler default handler defaulthandler tag link tag linktag default handler defaulthandler get policy getpolicy get tag by lower case name gettagbylowercasename attribute href attribute hrefattribute link tag linktag link tag linktag get attribute by name getattributebyname href href attribute hrefattribute fallback configuration href attribute hrefattribute href attribute default handler defaulthandler default handler defaulthandler href attribute hrefattribute href attribute hrefattribute suppress warnings suppresswarnings unused reset default policy resetdefaultpolicy update default handler updatedefaulthandler suppress warnings suppresswarnings unused load policy loadpolicy string policy name policyname input stream inputstream policy stream policystream exception policies size policy cache size policy handler policyhandler policy handler policyhandler policy handler policyhandler policy stream policystream policies policy name policyname policy handler policyhandler suppress warnings suppresswarnings unused unload policy unloadpolicy string policy name policyname policies remove policy name policyname suppress warnings suppresswarnings unused has policy haspolicy string policy name policyname policies contains key containskey policy name policyname override is valid href isvalidhref string url logic org owasp validator html scan magicsaxfilter start element startelement is valid isvalid href attribute hrefattribute contains allowed value containsallowedvalue url to lower case tolowercase is valid isvalid is valid isvalid href attribute hrefattribute matches allowed expression matchesallowedexpression url is valid isvalid