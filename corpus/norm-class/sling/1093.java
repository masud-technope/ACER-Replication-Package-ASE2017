licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling event org junit assert equals assertequals org junit assert not null assertnotnull org junit assert true asserttrue java io exception ioexception java util dictionary java util hash map hashmap java util hash set hashset java util hashtable java util map java util java util concurrent atomic atomic integer atomicinteger org apache sling event impl bar rier barrier org apache sling event impl jobs config configuration constants configurationconstants org apache sling event jobs job org apache sling event jobs job manager jobmanager org apache sling event jobs notification constants notificationconstants org apache sling event jobs queue org apache sling event jobs queue configuration queueconfiguration org apache sling event jobs consumer job consumer jobconsumer org junit org junit org junit test org junit runner run with runwith org ops pax exam junit pax exam paxexam org ops pax exam spi reactors exam reactor strategy examreactorstrategy org ops pax exam spi reactors per method permethod org osgi framework service registration serviceregistration org osgi service event event org osgi service event event handler eventhandler run with runwith pax exam paxexam exam reactor strategy examreactorstrategy per method permethod unordered queue test unorderedqueuetest abstract job handling test abstractjobhandlingtest string queue unorderedtestqueue string topic sling unorderedtest max par num jobs string queue conf pid queueconfpid override setup io exception ioexception setup create robin test queue org osgi service configuration rr config rrconfig config admin configadmin create factory configuration createfactoryconfiguration org apache sling event jobs queue configuration queueconfiguration dictionary string object rr props rrprops hashtable string object rr props rrprops configuration constants configurationconstants prop queue rr props rrprops configuration constants configurationconstants prop type queue configuration queueconfiguration type unordered rr props rrprops configuration constants configurationconstants prop topics topic rr props rrprops configuration constants configurationconstants prop retries rr props rrprops configuration constants configurationconstants prop retry delay rr props rrprops configuration constants configurationconstants prop max parallel max par rr config rrconfig update rr props rrprops queue conf pid queueconfpid rr config rrconfig get pid getpid sleep clean up cleanup io exception ioexception remove configuration removeconfiguration queue conf pid queueconfpid cleanup test timeout test timeout test unordered queue testunorderedqueue exception job manager jobmanager job manager jobmanager get job manager getjobmanager bar rier barrier bar rier barrier service registration serviceregistration reg register job consumer registerjobconsumer topic start job consumer jobconsumer override job result jobresult process job job block job result jobresult register consumer event handle atomic integer atomicinteger count atomic integer atomicinteger atomic integer atomicinteger parallel count parallelcount atomic integer atomicinteger integer max participants maxparticipants hash set hashset integer service registration serviceregistration jc reg jcreg register job consumer registerjobconsumer topic job consumer jobconsumer override job result jobresult process job job max parallel count parallelcount increment and get incrementandget max max par parallel count parallelcount decrement and get decrementandget job result jobresult failed max participants maxparticipants max participants maxparticipants add max sleep job get property getproperty sleep parallel count parallelcount decrement and get decrementandget job result jobresult service registration serviceregistration eh reg ehreg register event handler registereventhandler notification constants notificationconstants topic job finished event handler eventhandler override handle event handleevent event event count increment and get incrementandget event queue started job manager jobmanager add job addjob topic start assert true asserttrue event received time block reset queue queue job manager jobmanager get queue getqueue queue assert not null assertnotnull queue queue exist suspend suspend start jobs num jobs string sub topic subtopic topic map string object props hash map hashmap string object props sleep props sleep job manager jobmanager add job addjob sub topic subtopic props start queue resume count num jobs assert equals assertequals failed count get statistics getstatistics get number of failed jobs getnumberoffailedjobs assert equals assertequals cancelled count get statistics getstatistics get number of cancelled jobs getnumberofcancelledjobs sleep started event test add assert equals assertequals finished count num jobs count assert equals assertequals finished count num jobs job manager jobmanager get statistics getstatistics get number of finished jobs getnumberoffinishedjobs assert equals assertequals finished count num jobs get statistics getstatistics get number of finished jobs getnumberoffinishedjobs assert equals assertequals failed count get statistics getstatistics get number of failed jobs getnumberoffailedjobs assert equals assertequals cancelled count get statistics getstatistics get number of cancelled jobs getnumberofcancelledjobs max par assert true asserttrue participants string value of valueof max participants maxparticipants max participants maxparticipants reg unregister jc reg jcreg unregister eh reg ehreg unregister