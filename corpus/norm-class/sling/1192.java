licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling models impl org junit assert equals assertequals org junit assert false assertfalse org junit assert not null assertnotnull org junit assert null assertnull org junit assert true asserttrue org mockito matchers org mockito matchers any boolean anyboolean org mockito matchers any object anyobject org mockito matchers any string anystring org mockito mockito mock org mockito mockito java net malformedurlexception java net url java util dictionary java util hash map hashmap java util hashtable java util map java util vector org apache sling api resource resource org apache sling api resource value map valuemap org apache sling api wrappers value map decorator valuemapdecorator org apache sling models impl injectors value map injector valuemapinjector org apache sling models spi implementation picker implementationpicker org apache sling models test models testmodels classes impl extend implextend even simple r property model evensimplerpropertymodel org apache sling models test models testmodels classes impl extend implextend extends class property model extendsclasspropertymodel org apache sling models test models testmodels classes impl extend implextend implements interface property model implementsinterfacepropertymodel org apache sling models test models testmodels classes impl extend implextend implements interface property model implementsinterfacepropertymodel org apache sling models test models testmodels classes impl extend implextend invalid implements interface property model invalidimplementsinterfacepropertymodel org apache sling models test models testmodels classes impl extend implextend invalid sample service interface invalidsampleserviceinterface org apache sling models test models testmodels classes impl extend implextend sample service interface sampleserviceinterface org apache sling models test models testmodels classes impl extend implextend simple property model simplepropertymodel org junit org junit org junit test org junit runner run with runwith org mockito mock org mockito invocation invocation on mock invocationonmock org mockito run ners runners mockito unit runner mockitojunitrunner org mockito stub bin g stubbing answer org osgi framework bundle org osgi framework bundle context bundlecontext org osgi framework bundle event bundleevent org osgi framework service reference servicereference org osgi framework service registration serviceregistration org osgi service component component context componentcontext run with runwith mockito unit runner mockitojunitrunner implements extends test implementsextendstest mock component context componentcontext component ctx componentctx mock bundle context bundlecontext bundle context bundlecontext mock bundle bundle mock bundle event bundleevent bundle event bundleevent model adapter factory modeladapterfactory factory service registration serviceregistration registered adapter factories registeredadapterfactories implementation picker implementationpicker first implementation picker firstimplementationpicker first implementation picker firstimplementationpicker service properties map servicepropertiesmap first implementation picker props firstimplementationpickerprops service properties map servicepropertiesmap integer max suppress warnings suppresswarnings unchecked setup class not found exception classnotfoundexception malformedurlexception component ctx componentctx get bundle context getbundlecontext then return thenreturn bundle context bundlecontext component ctx componentctx get properties getproperties then return thenreturn hashtable string object bundle context bundlecontext register service registerservice any string anystring any object anyobject dictionary answer service registration serviceregistration override service registration serviceregistration answer invocation on mock invocationonmock invocation throwable dictionary string object props dictionary string object invocation get arguments getarguments service registration serviceregistration reg mock service registration serviceregistration service reference servicereference mock service reference servicereference reg get reference getreference then return thenreturn get property getproperty any string anystring then answer thenanswer answer object override object answer invocation on mock invocationonmock invocation throwable string key string invocation get arguments getarguments props key reg factory model adapter factory modeladapterfactory factory activate component ctx componentctx factory bind injector bindinjector value map injector valuemapinjector service properties map servicepropertiesmap factory bind implementation picker bindimplementationpicker first implementation picker firstimplementationpicker first implementation picker props firstimplementationpickerprops simulate bundle add model package bundle listener modelpackagebundlelistener dictionary string string headers hashtable string string headers model package bundle listener modelpackagebundlelistener header org apache sling models test models testmodels classes impl extend implextend bundle get headers getheaders then return thenreturn headers vector url class urls classurls vector url class urls classurls add get class url getclassurl extends class property model extendsclasspropertymodel class urls classurls add get class url getclassurl implements interface property model implementsinterfacepropertymodel class urls classurls add get class url getclassurl implements interface property model implementsinterfacepropertymodel class urls classurls add get class url getclassurl invalid implements interface property model invalidimplementsinterfacepropertymodel class urls classurls add get class url getclassurl invalid sample service interface invalidsampleserviceinterface class urls classurls add get class url getclassurl sample service interface sampleserviceinterface class urls classurls add get class url getclassurl simple property model simplepropertymodel bundle find entries findentries any string anystring any string anystring any boolean anyboolean then return thenreturn class urls classurls elements bundle load class loadclass any string anystring answer override answer invocation on mock invocationonmock invocation class not found exception classnotfoundexception string class name classname string invocation get arguments getarguments implements extends test implementsextendstest get class getclass get class loader getclassloader load class loadclass class name classname registered adapter factories registeredadapterfactories service registration serviceregistration factory listener adding bundle addingbundle bundle bundle event bundleevent url get class url getclassurl clazz malformedurlexception string path file clazz get name getname replace url path tear down teardown simulate bundle remove model package bundle listener modelpackagebundlelistener factory listener removed bundle removedbundle bundle bundle event bundleevent registered adapter factories registeredadapterfactories adapt ion adaption longer implementation mapping removed resource res get mock resource with props getmockresourcewithprops sample service interface sampleserviceinterface model factory get adapter getadapter res sample service interface sampleserviceinterface assert null assertnull model adapt implementation model annotation test test implements interface model testimplementsinterfacemodel resource res get mock resource with props getmockresourcewithprops sample service interface sampleserviceinterface model factory get adapter getadapter res sample service interface sampleserviceinterface assert not null assertnotnull model assert equals assertequals implements interface property model implementsinterfacepropertymodel model get class getclass assert equals assertequals model get all properties getallproperties assert true asserttrue factory can create from adaptable cancreatefromadaptable res sample service interface sampleserviceinterface adapt picker extend adaptation fail adapter works test test implements no picker testimplementsnopicker factory unbind implementation picker unbindimplementationpicker first implementation picker firstimplementationpicker first implementation picker props firstimplementationpickerprops resource res get mock resource with props getmockresourcewithprops sample service interface sampleserviceinterface model factory get adapter getadapter res sample service interface sampleserviceinterface assert null assertnull model assert false assertfalse factory is model class ismodelclass res sample service interface sampleserviceinterface model factory get adapter getadapter res implements interface property model implementsinterfacepropertymodel assert not null assertnotnull model assert equals assertequals model get all properties getallproperties assert true asserttrue factory can create from adaptable cancreatefromadaptable res implements interface property model implementsinterfacepropertymodel ensure implementation adapted adapter property annotation disabled work unit test adapter factory adapterfactory called enabled int egration integration tests test test implements interface model testimplementsinterfacemodel impl class not mapped implclassnotmapped resource res get mock resource with props getmockresourcewithprops implements interface property model implementsinterfacepropertymodel model factory get adapter getadapter res implements interface property model implementsinterfacepropertymodel assert null assertnull model test implementation mapping valid implemented test test invalid implements interface model testinvalidimplementsinterfacemodel resource res get mock resource with props getmockresourcewithprops invalid sample service interface invalidsampleserviceinterface model factory get adapter getadapter res invalid sample service interface invalidsampleserviceinterface assert null assertnull model assert false assertfalse factory is model class ismodelclass res invalid sample service interface invalidsampleserviceinterface test adapt superclass implementation mapping model annotation test test extends class model testextendsclassmodel resource res get mock resource with props getmockresourcewithprops simple property model simplepropertymodel model factory get adapter getadapter res simple property model simplepropertymodel assert not null assertnotnull model assert equals assertequals model get all properties getallproperties assert true asserttrue factory can create from adaptable cancreatefromadaptable res simple property model simplepropertymodel even simple r property model evensimplerpropertymodel simple r model simplermodel factory get adapter getadapter res even simple r property model evensimplerpropertymodel assert not null assertnotnull simple r model simplermodel assert equals assertequals model get first getfirst assert true asserttrue factory can create from adaptable cancreatefromadaptable res even simple r property model evensimplerpropertymodel adapt implementation model annotation test test implements interface model with pick last implementation picker testimplementsinterfacemodelwithpicklastimplementationpicker factory bind implementation picker bindimplementationpicker adapter impl ementations test adapterimplementationstest last implementation picker lastimplementationpicker service properties map servicepropertiesmap resource res get mock resource with props getmockresourcewithprops sample service interface sampleserviceinterface model factory get adapter getadapter res sample service interface sampleserviceinterface assert not null assertnotnull model assert equals assertequals implements interface property model implementsinterfacepropertymodel model get class getclass assert equals assertequals model get all properties getallproperties assert true asserttrue factory can create from adaptable cancreatefromadaptable res sample service interface sampleserviceinterface resource get mock resource with props getmockresourcewithprops map string object map hash map hashmap string object map map value map valuemap value map decorator valuemapdecorator map resource res mock resource res adapt to adaptto value map valuemap then return thenreturn res