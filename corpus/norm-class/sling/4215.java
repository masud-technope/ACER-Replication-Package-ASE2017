licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling discovery impl cluster voting java util calendar java util collections java util comparator java util dictionary java util hash map hashmap java util hashtable java util iterator java util list java util map java util uuid org apache felix scr annotations activate org apache felix scr annotations component org apache felix scr annotations deactivate org apache felix scr annotations reference org apache felix scr annotations service org apache sling api sling constants slingconstants org apache sling api resource login exception loginexception org apache sling api resource modifiable value map modifiablevaluemap org apache sling api resource persistence exception persistenceexception org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling api resource resource resolver factory resourceresolverfactory org apache sling api resource value map valuemap org apache sling discovery commons providers util resource helper resourcehelper org apache sling discovery impl config org apache sling settings sling settings service slingsettingsservice org osgi framework bundle context bundlecontext org osgi framework constants org osgi framework service registration serviceregistration org osgi service component component context componentcontext org osgi service event event org osgi service event event constants eventconstants org osgi service event event handler eventhandler org slf logger org slf logger factory loggerfactory osgi event handler responsible votings vote component service voting handler votinghandler voting handler votinghandler event handler eventhandler enum voting detail votingdetail promoted win ning winning voted voted unchanged time dout timedout comparator voting view votingview voting comparator comparator voting view votingview compare voting view votingview voting view votingview get voting id getvotingid compare to compareto get voting id getvotingid period job scheduler string discovery impl analyze votings analyzevotings runner logger logger logger factory loggerfactory get logger getlogger get class getclass reference sling settings service slingsettingsservice sling settings service slingsettingsservice reference resource resolver factory resourceresolverfactory resolver factory resolverfactory reference config config sling local instance string sling id slingid heartbeat handler heartbeathandler sets leader election id leaderelectionid sub sequently subsequently ensure leader election id leaderelectionid correctly voting string leader election id leaderelectionid activated component context componentcontext context service registration serviceregistration event handler registration eventhandlerregistration testing voting handler votinghandler test constructor testconstructor sling settings service slingsettingsservice settings service settingsservice resource resolver factory resourceresolverfactory factory config config voting handler votinghandler handler voting handler votinghandler handler sling settings service slingsettingsservice settings service settingsservice handler resolver factory resolverfactory factory handler config config handler deactivate deactivate event handler registration eventhandlerregistration event handler registration eventhandlerregistration unregister logger info deactivate voting handler votinghandler unregistered event handler eventhandler event handler registration eventhandlerregistration activated logger info deactivate deactivated sling id slingid sling id slingid activate activate component context componentcontext context sling id slingid sling settings service slingsettingsservice get sling id getslingid logger logger factory loggerfactory get logger getlogger get class getclass get canonical name getcanonicalname sling id slingid context context activated activated register event handler eventhandler start receiving processing votings register event handler registereventhandler logger info activated activated sling id slingid register event handler registereventhandler bundle context bundlecontext bundle context bundlecontext context context get bundle context getbundlecontext bundle context bundlecontext logger info register event handler registereventhandler context bundle context bundlecontext register dictionary string object properties hashtable string object properties constants service description voting event listener string topics string sling constants slingconstants topic resource sling constants slingconstants topic resource changed sling constants slingconstants topic resource removed properties event constants eventconstants event topic topics string path config get discovery resource path getdiscoveryresourcepath path ends with endswith path path substring path length path path properties event constants eventconstants event filter path path event handler registration eventhandlerregistration bundle context bundlecontext register service registerservice event handler eventhandler get name getname properties logger info register event handler registereventhandler voting handler votinghandler registered event handler eventhandler handle repository react ongoing votings handle event handleevent event event activated string resource path resourcepath string event get property getproperty path string ongoing votings path ongoingvotingspath config get ongoing votings path getongoingvotingspath resource path resourcepath business resource path resourcepath starts with startswith ongoing votings path ongoingvotingspath business resource resolver resourceresolver resource resolver resourceresolver resource resolver resourceresolver resolver factory resolverfactory get administrative resource resolver getadministrativeresourceresolver login exception loginexception logger error handle event handleevent log admin istratively administratively logger is debug enabled isdebugenabled logger debug handle event handleevent path resource path resourcepath event event analyze votings analyzevotings resource resolver resourceresolver persistence exception persistenceexception logger error handle event handleevent persistence exception persistenceexception votings analysis resource resolver resourceresolver resource resolver resourceresolver close analyze ongoing voting repository sling method called concurrently hearbeat handler hearbeathandler do check view docheckview voting handler votinghandler handle event handleevent map voting view votingview voting detail votingdetail analyze votings analyzevotings resource resolver resourceresolver resource resolver resourceresolver persistence exception persistenceexception activated logger info analyze votings analyzevotings voting handler votinghandler initialized vote map voting view votingview voting detail votingdetail result hash map hashmap voting view votingview voting detail votingdetail sling ref res hing refreshing resource resolver resourceresolver session latest repository logger debug analyze votings analyzevotings start sling id slingid sling id slingid resource resolver resourceresolver refresh voting view votingview winning vote winningvote voting helper votinghelper get winning voting getwinningvoting resource resolver resourceresolver config winning vote winningvote winning vote winningvote is init iated by isinitiatedby sling id slingid logger info analyze votings analyzevotings voting winning mark established winning vote winningvote promote resource resolver resourceresolver winning vote winningvote get resource getresource runtime exception runtimeexception logger error analyze votings analyzevotings runtime exception runtimeexception promotion error logger error analyze votings analyzevotings error promotion sling commit ting committing resource resolver resourceresolver session resource resolver resourceresolver commit test verification result winning vote winningvote voting detail votingdetail promoted result logger info analyze votings analyzevotings winning vote vote expecting promoted established winning vote winningvote result winning vote winningvote voting detail votingdetail win ning winning result list voting view votingview ongoing votings ongoingvotings voting helper votinghelper list votings listvotings resource resolver resourceresolver config ongoing votings ongoingvotings ongoing votings ongoingvotings size logger debug analyze votings analyzevotings ongoing votings moment result collections sort ongoing votings ongoingvotings voting comparator voting view votingview yes vote yesvote voting view votingview voting ongoing votings ongoingvotings my vote myvote voting get vote getvote sling id slingid voted no votedno my vote myvote my vote myvote voted yes votedyes my vote myvote my vote myvote voting is time dout voting istimedoutvoting config voting timed delete logger info analyze votings analyzevotings deleting timed voting voting voting remove result voting voting detail votingdetail time dout timedout voting has no votes hasnovotes voted no votedno logger info analyze votings analyzevotings vote votes vote voting voting vote sling id slingid result voting voting detail votingdetail voted ignore silently result voting voting detail votingdetail unchanged voting is ongoing voting isongoingvoting config logger debug analyze votings analyzevotings vote ongoing ignoring voting string live comparison livecomparison live comparison livecomparison voting matches live view matchesliveview config exception logger error analyze votings analyzevotings compare voting live view live comparison livecomparison voted no votedno logger info analyze votings analyzevotings vote doesn t doesnt match live view voting comparison result live comparison livecomparison vote voting voting vote sling id slingid result voting voting detail votingdetail voted result voting voting detail votingdetail unchanged yes vote yesvote vote voted no votedno logger info analyze votings analyzevotings voted voting voting voting vote sling id slingid result voting voting detail votingdetail voted ignore silently result voting voting detail votingdetail unchanged voted yes votedyes logger info analyze votings analyzevotings timed votes matches live ongoing voted noting candidate voting yes vote yesvote voting yes vote yesvote my vote myvote yes vote yesvote get vote getvote sling id slingid voted yes votedyes my vote myvote my vote myvote voted yes votedyes logger info analyze votings analyzevotings declaring per sonal personal winner yes vote yesvote my vote myvote my vote myvote yes vote yesvote vote sling id slingid leader election id leaderelectionid result yes vote yesvote voting detail votingdetail voted don vote log result yes vote yesvote voting detail votingdetail unchanged resource resolver resourceresolver commit logger debug analyze votings analyzevotings result vote yes vote yesvote result cleanup time dout votings cleanuptimedoutvotings resource resolver resourceresolver resource resolver resourceresolver list voting view votingview time dout votings timedoutvotings voting helper votinghelper list time dout votings listtimedoutvotings resource resolver resourceresolver config iterator voting view votingview time dout votings timedoutvotings iterator has next hasnext voting view votingview time dout voting res timedoutvotingres time dout voting res timedoutvotingres logger info cleanup time dout votings cleanuptimedoutvotings removing timed voting time dout voting res timedoutvotingres time dout voting res timedoutvotingres remove promote voting established view promote resource resolver resourceresolver resource resolver resourceresolver resource winning vote resource winningvoteresource persistence exception persistenceexception resource previous views resource previousviewsresource resource helper resourcehelper get or create resource getorcreateresource resource resolver resourceresolver config get previous view path getpreviousviewpath resource established views resource establishedviewsresource resource helper resourcehelper get or create resource getorcreateresource resource resolver resourceresolver config get established view path getestablishedviewpath resource ongoing votings resource ongoingvotingsresource resource helper resourcehelper get or create resource getorcreateresource resource resolver resourceresolver config get ongoing votings path getongoingvotingspath logger is debug enabled isdebugenabled logger debug promote previous views resource previousviewsresource previous views resource previousviewsresource get path getpath logger debug promote established views resource establishedviewsresource established views resource establishedviewsresource get path getpath logger debug promote ongoing votings resource ongoingvotingsresource ongoing votings resource ongoingvotingsresource get path getpath logger debug promote winning vote resource winningvoteresource winning vote resource winningvoteresource get path getpath step remove nodes previous views previousviews iterator resource previous views resource previousviewsresource get children getchildren iterator has next hasnext resource previous view previousview resource resolver resourceresolver delete previous view previousview persistence exception persistenceexception logger error promote delete previous view move resource helper resourcehelper move resource moveresource previous views resource previousviewsresource config get previous view path getpreviousviewpath trash uuid randomuuid to string tostring logger info promote rec reating recreating previous views previousviews node previous views resource previousviewsresource resource helper resourcehelper get or create resource getorcreateresource resource resolver resourceresolver config get previous view path getpreviousviewpath step ret ire retire existing established view note ret ire retire iterator resource established views resource establishedviewsresource get children getchildren iterator has next hasnext resource ret ired view retiredview logger is debug enabled isdebugenabled logger debug promote moving established view previous views ret ired view retiredview get path getpath resource helper resourcehelper move resource moveresource ret ired view retiredview previous views resource previousviewsresource get path getpath ret ired view retiredview get name getname logger is debug enabled isdebugenabled logger debug promote ret iring retiring err one ously erroneously addition ally additionally established node ret ired view retiredview get path getpath resource resolver resourceresolver delete ret ired view retiredview step move winning vote resource established views resource establishedviewsresource leaderid iterator resource winning vote resource winningvoteresource get child getchild members get children getchildren iterator string leader election id leaderelectionid string leaderid members count memberscount has next hasnext resource a member amember members count memberscount string leid a member amember adapt to adaptto value map valuemap leader election id leaderelectionid string leader election id leaderelectionid leid leid compare to compareto leader election id leaderelectionid leader election id leaderelectionid leid leaderid a member amember get name getname logger is debug enabled isdebugenabled logger debug promote leader leaderid leader election id leaderelectionid leader election id leaderelectionid modifiable value map modifiablevaluemap winning vote map winningvotemap winning vote resource winningvoteresource adapt to adaptto modifiable value map modifiablevaluemap winning vote map winningvotemap leader id leaderid leaderid winning vote map winningvotemap leader election id leaderelectionid leader election id leaderelectionid winning vote map winningvotemap promoted at promotedat calendar get instance getinstance winning vote map winningvotemap promoted by promotedby sling id slingid move result established string new established view path newestablishedviewpath established views resource establishedviewsresource get path getpath winning vote resource winningvoteresource get name getname logger info promote pro moting promoting established node members members count memberscount path new established view path newestablishedviewpath resource helper resourcehelper move resource moveresource winning vote resource winningvoteresource new established view path newestablishedviewpath step delete ongoing votings iterable resource ongoing votings children ongoingvotingschildren ongoing votings resource ongoingvotingsresource get children getchildren ongoing votings children ongoingvotingschildren iterator resource ongoing votings children ongoingvotingschildren iterator has next hasnext resource an ongoing voting anongoingvoting logger info promote deleting ongoing voting an ongoing voting anongoingvoting get name getname resource resolver resourceresolver delete an ongoing voting anongoingvoting step duplicate ongoing votings ongoingvotings nodes created cleanup iterator resource ongoing votings resource ongoingvotingsresource get parent getparent get children getchildren iterator has next hasnext resource resource resource get path getpath starts with startswith config get ongoing votings path getongoingvotingspath resource get path getpath equals config get ongoing votings path getongoingvotingspath speak cleaning logger warn promote cleaning duplicate ongoing voting path ongoingvotingpath resource get path getpath resource resolver resourceresolver delete resource logger debug promote promotion g promotiong saving resource resolver resourceresolver commit logger info promote promotion members members count memberscount path new established view path newestablishedviewpath set leader election id setleaderelectionid string leader election id leaderelectionid logger info set leader election id setleaderelectionid leader election id leaderelectionid leader election id leaderelectionid leader election id leaderelectionid leader election id leaderelectionid