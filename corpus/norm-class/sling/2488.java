licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling discovery impl java net url java util array list arraylist java util collection java util collections java util dictionary java util hash map hashmap java util hash set hashset java util hashtable java util linked list linkedlist java util list java util map java util map entry java util java util uuid java util concurrent locks reentrant lock reentrantlock org apache felix scr annotations activate org apache felix scr annotations component org apache felix scr annotations deactivate org apache felix scr annotations reference org apache felix scr annotations reference cardinality referencecardinality org apache felix scr annotations reference policy referencepolicy org apache felix scr annotations service org apache sling api resource login exception loginexception org apache sling api resource modifiable value map modifiablevaluemap org apache sling api resource persistence exception persistenceexception org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling api resource resource resolver factory resourceresolverfactory org apache sling commons scheduler scheduler org apache sling discovery discovery service discoveryservice org apache sling discovery instance description instancedescription org apache sling discovery property provider propertyprovider org apache sling discovery topology event topologyevent org apache sling discovery topology event topologyevent type org apache sling discovery topology event listener topologyeventlistener org apache sling discovery base commons base discovery service basediscoveryservice org apache sling discovery base commons cluster view service clusterviewservice org apache sling discovery base commons default topology view defaulttopologyview org apache sling discovery base commons undefined cluster view exception undefinedclusterviewexception org apache sling discovery base commons undefined cluster view exception undefinedclusterviewexception reason org apache sling discovery base connectors announcement announcement registry announcementregistry org apache sling discovery base connectors ping connector registry connectorregistry org apache sling discovery commons providers base topology view basetopologyview org apache sling discovery commons providers default cluster view defaultclusterview org apache sling discovery commons providers default instance description defaultinstancedescription org apache sling discovery commons providers view state manager viewstatemanager org apache sling discovery commons providers base view state manager factory viewstatemanagerfactory org apache sling discovery commons providers spi cluster sync service clustersyncservice org apache sling discovery commons providers spi local cluster view localclusterview org apache sling discovery commons providers spi base sync token service synctokenservice org apache sling discovery commons providers util property name helper propertynamehelper org apache sling discovery commons providers util resource helper resourcehelper org apache sling discovery impl cluster cluster view service impl clusterviewserviceimpl org apache sling discovery impl common heartbeat heartbeat handler heartbeathandler org apache sling settings sling settings service slingsettingsservice org osgi framework bundle context bundlecontext org osgi framework constants org osgi framework service registration serviceregistration org slf logger org slf logger factory loggerfactory implementation cross cluster service view manager implementation detecting cluster supports cluster instance component service discovery service discoveryservice discovery service impl discoveryserviceimpl discovery service impl discoveryserviceimpl base discovery service basediscoveryservice logger logger logger factory loggerfactory get logger getlogger discovery service impl discoveryserviceimpl cluster sync service clustersyncservice passes call doesn sync calls callback doesn can celling cancelling cluster sync service clustersyncservice pass cluster sync service cluster sync service clustersyncservice override sync base topology view basetopologyview view runnable callback logger debug sync sync token synctoken applicable callback override cancel sync cancelsync can celling cancelling applicable reference sling settings service slingsettingsservice settings service settingsservice reference cardinality reference cardinality referencecardinality optional multiple policy reference policy referencepolicy dynamic reference interface referenceinterface topology event listener topologyeventlistener topology event listener topologyeventlistener event listeners eventlisteners topology event listener topologyeventlistener property providers reference cardinality reference cardinality referencecardinality optional multiple policy reference policy referencepolicy dynamic reference interface referenceinterface property provider propertyprovider updated updated property provider updatedpropertyprovider list provider info providerinfo provider infos providerinfos array list arraylist provider info providerinfo lock object sync hing synching bind unbind topology event sending object lock object service activated avoid sending events discovery awares activate activated reference resource resolver factory resourceresolverfactory resource resolver factory resourceresolverfactory reference scheduler scheduler reference heartbeat handler heartbeathandler heartbeat handler heartbeathandler reference announcement registry announcementregistry announcement registry announcementregistry reference connector registry connectorregistry connector registry connectorregistry reference cluster view service impl clusterviewserviceimpl cluster view service clusterviewservice reference config config reference sync token service synctokenservice sync token service synctokenservice sling id slingid local instance string sling id slingid service registration serviceregistration mbean registration mbeanregistration view state manager viewstatemanager view state manager viewstatemanager reentrant lock reentrantlock view state manager lock viewstatemanagerlock reentrant lock reentrantlock list topology event listener topologyeventlistener pending listeners pendinglisteners linked list linkedlist topology event listener topologyeventlistener topology event listener topologyeventlistener change prop agation listener changepropagationlistener topology event listener topologyeventlistener handle topology event handletopologyevent topology event topologyevent event heartbeat handler heartbeathandler handler heartbeat handler heartbeathandler activated handler event get type gettype type topology changed event get type gettype type properties changed logger info change prop agation listener changepropagationlistener handle topology event handletopologyevent topology changed propagate connectors handler trigger async connector ping triggerasyncconnectorping testing base discovery service basediscoveryservice test constructor testconstructor resource resolver factory resourceresolverfactory resource resolver factory resourceresolverfactory announcement registry announcementregistry announcement registry announcementregistry connector registry connectorregistry connector registry connectorregistry cluster view service impl clusterviewserviceimpl cluster view service clusterviewservice heartbeat handler heartbeathandler heartbeat handler heartbeathandler sling settings service slingsettingsservice settings service settingsservice scheduler scheduler config config sync token service synctokenservice sync token service or null synctokenserviceornull discovery service impl discoveryserviceimpl disco service discoservice discovery service impl discoveryserviceimpl disco service discoservice resource resolver factory resourceresolverfactory resource resolver factory resourceresolverfactory disco service discoservice announcement registry announcementregistry announcement registry announcementregistry disco service discoservice connector registry connectorregistry connector registry connectorregistry disco service discoservice cluster view service clusterviewservice cluster view service clusterviewservice disco service discoservice heartbeat handler heartbeathandler heartbeat handler heartbeathandler disco service discoservice settings service settingsservice settings service settingsservice disco service discoservice scheduler scheduler disco service discoservice config config disco service discoservice sync token service synctokenservice sync token service or null synctokenserviceornull disco service discoservice discovery service impl discoveryserviceimpl registermbean bundle context bundlecontext bundle context bundlecontext mbean registration mbeanregistration mbean registration mbeanregistration mbean registration mbeanregistration unregister mbean registration mbeanregistration exception logger error registermbean error unregister dictionary string string mbean props mbeanprops hashtable string string mbean props mbeanprops jmx object name objectname org apache sling type discovery discovery service impl discoveryserviceimpl discovery service bean impl discoveryservicembeanimpl mbean discovery service bean impl discoveryservicembeanimpl heartbeat handler heartbeathandler mbean registration mbeanregistration bundle context bundlecontext register service registerservice discovery service bean impl discoveryservicembeanimpl get name getname mbean mbean props mbeanprops throwable logger warn registermbean unable register discovery service impl discoveryserviceimpl m bean mbean handle isolated from topology handleisolatedfromtopology heartbeat handler heartbeathandler reg ain regain leader ship leadership heartbeat handler heartbeathandler reset leader election id resetleaderelectionid logger info get topology gettopology reset leader election id leaderelectionid force instance instance order inc l incl remain leader activate service activate activate bundle context bundlecontext bundle context bundlecontext logger debug discovery service impl discoveryserviceimpl act ivating activating settings service settingsservice illegal state exception illegalstateexception settings service settingsservice heartbeat handler heartbeathandler illegal state exception illegalstateexception heartbeat handler heartbeathandler sling id slingid settings service settingsservice get sling id getslingid cluster sync service clustersyncservice cluster sync service clustersyncservice config use sync token service usesynctokenservice logger info activate use sync token service usesynctokenservice configured pass cluster sync service cluster sync service clustersyncservice pass cluster sync service sync token service synctokenservice logger warn activate use sync token service usesynctokenservice configured sync token service synctokenservice pass cluster sync service cluster sync service clustersyncservice sync token service synctokenservice logger info activate use sync token service usesynctokenservice configured sync token service synctokenservice sync token service synctokenservice cluster sync service clustersyncservice sync token service synctokenservice view state manager viewstatemanager view state manager factory viewstatemanagerfactory new view state manager newviewstatemanager view state manager lock viewstatemanagerlock cluster sync service clustersyncservice config get min event delay getmineventdelay view state manager viewstatemanager install min event delay handler installmineventdelayhandler scheduler config get min event delay getmineventdelay string isolated cluster id isolatedclusterid uuid randomuuid to string tostring create pre voting isolated topology view topologyview voting finished single instance cluster id clusterid remain get topology gettopology invoked topology init default cluster view defaultclusterview isolated cluster isolatedcluster default cluster view defaultclusterview isolated cluster id isolatedclusterid map string string empty properties emptyproperties hash map hashmap string string default instance description defaultinstancedescription isolated instance isolatedinstance default instance description defaultinstancedescription isolated cluster isolatedcluster sling id slingid empty properties emptyproperties collection instance description instancedescription col array list arraylist instance description instancedescription col add isolated instance isolatedinstance default topology view defaulttopologyview topology default topology view defaulttopologyview topology add instances addinstances col topology set not current setnotcurrent set old view setoldview topology set old view setoldview default topology view defaulttopologyview get topology gettopology get old view getoldview set not current setnotcurrent heartbeat issued service starts discovery service discoveryservice heartbeat handler heartbeathandler discovery service discoveryservice passed heartbeat handler heartbeathandler initialize call heartbeat handler heartbeathandler initialize isolated cluster id isolatedclusterid view state manager lock viewstatemanagerlock lock view state manager viewstatemanager handle activated handleactivated do update properties doupdateproperties default topology view defaulttopologyview new view newview default topology view defaulttopologyview get topology gettopology new view newview is current iscurrent view state manager viewstatemanager handle new view handlenewview new view newview sling issue log info delaying logger info activate instance isolated mode finish voting send topology init activated set old view setoldview new view newview bind views tatemanager viewstatemanager topology event listener topologyeventlistener listener pending listeners pendinglisteners view state manager viewstatemanager bind listener pending listeners pendinglisteners clear view state manager viewstatemanager bind change prop agation listener changepropagationlistener view state manager lock viewstatemanagerlock view state manager lock viewstatemanagerlock unlock url topologyconnectorurls config get topology connector ls gettopologyconnectorurls topologyconnectorurls topologyconnectorurls length url aurl topologyconnectorurls aurl logger info activate registering out going outgoing topology connector aurl connector registry connectorregistry register out going connector registeroutgoingconnector cluster view service clusterviewservice aurl exception logger info activate register url aurl registermbean bundle context bundlecontext logger debug discovery service impl discoveryserviceimpl activated deactivate service deactivate deactivate logger debug discovery service impl discoveryserviceimpl deactivated view state manager lock viewstatemanagerlock lock view state manager viewstatemanager view state manager viewstatemanager unbind change prop agation listener changepropagationlistener view state manager viewstatemanager handle deactivated handledeactivated activated view state manager lock viewstatemanagerlock view state manager lock viewstatemanagerlock unlock mbean registration mbeanregistration mbean registration mbeanregistration unregister mbean registration mbeanregistration exception logger error deactivate error unregister bind topology event listener bind topology event listener bindtopologyeventlistener topology event listener topologyeventlistener event listener eventlistener view state manager lock viewstatemanagerlock lock activated pending listeners pendinglisteners add event listener eventlistener view state manager viewstatemanager bind event listener eventlistener view state manager lock viewstatemanagerlock view state manager lock viewstatemanagerlock unlock unbind topology event listener unbind topology event listener unbindtopologyeventlistener topology event listener topologyeventlistener event listener eventlistener view state manager lock viewstatemanagerlock lock activated pending listeners pendinglisteners remove event listener eventlistener view state manager viewstatemanager unbind event listener eventlistener view state manager lock viewstatemanagerlock view state manager lock viewstatemanagerlock unlock bind property provider bind property provider bindpropertyprovider property provider propertyprovider property provider propertyprovider map string object props logger debug bind property provider bindpropertyprovider binding property provider propertyprovider property provider propertyprovider lock bind property provider int eral bindpropertyproviderinteral property provider propertyprovider props bind property provider bind property provider int eral bindpropertyproviderinteral property provider propertyprovider property provider propertyprovider map string object props provider info providerinfo info provider info providerinfo property provider propertyprovider props provider infos providerinfos add info collections sort provider infos providerinfos do update properties doupdateproperties check for topology change checkfortopologychange update property provider updated property provider updatedpropertyprovider property provider propertyprovider property provider propertyprovider map string object props logger debug bind property provider bindpropertyprovider updating property provider propertyprovider property provider propertyprovider lock unbind property provider internal unbindpropertyproviderinternal property provider propertyprovider props bind property provider int eral bindpropertyproviderinteral property provider propertyprovider props unbind property provider unbind property provider unbindpropertyprovider property provider propertyprovider property provider propertyprovider map string object props logger debug unbind property provider unbindpropertyprovider releasing property provider propertyprovider property provider propertyprovider lock unbind property provider internal unbindpropertyproviderinternal property provider propertyprovider props unbind property provider unbind property provider internal unbindpropertyproviderinternal property provider propertyprovider property provider propertyprovider map string object props update provider info providerinfo info provider info providerinfo property provider propertyprovider props provider infos providerinfos remove info update do update properties doupdateproperties check for topology change checkfortopologychange update properties inquiring property provider propertyprovider current values method invoked reg ularly regularly heartbeat handler heartbeathandler properties stored repository config get cluster instances path getclusterinstancespath anno unced announced topology config get cluster instances path getclusterinstancespath do update properties doupdateproperties resource resolver factory resourceresolverfactory update properties logger debug do update properties doupdateproperties early update properties resource resolver factory resourceresolverfactory logger debug do update properties doupdateproperties updating properties map string string new props newprops hash map hashmap string string provider info providerinfo info provider infos providerinfos info refresh properties refreshproperties new props newprops put all putall info properties resource resolver resourceresolver resource resolver resourceresolver resource resolver resourceresolver resource resolver factory resourceresolverfactory get administrative resource resolver getadministrativeresourceresolver resource my instance myinstance resource helper resourcehelper get or create resource getorcreateresource resource resolver resourceresolver config get cluster instances path getclusterinstancespath sling id slingid properties sling revert refresh resource resolver resourceresolver work potential issue jackrabbit clustered environment resource resolver resourceresolver revert resource resolver resourceresolver refresh modifiable value map modifiablevaluemap my instance map myinstancemap my instance myinstance adapt to adaptto modifiable value map modifiablevaluemap string hash set hashset string my instance map myinstancemap key set keyset string key new props newprops contains key containskey key per fect perfect key index of indexof ignore remove my instance map myinstancemap remove key any changes anychanges entry string string entry new props newprops entry set entryset object existing value existingvalue my instance map myinstancemap entry get key getkey entry get value getvalue equals existing value existingvalue sling don t dont rewrite properties changed logger is debug enabled isdebugenabled logger debug do update properties doupdateproperties unchanged entry get key getkey entry get value getvalue logger is debug enabled isdebugenabled logger debug do update properties doupdateproperties changed entry get key getkey entry get value getvalue any changes anychanges my instance map myinstancemap entry get key getkey entry get value getvalue any changes anychanges resource resolver resourceresolver commit login exception loginexception logger error handle event handleevent log admin istratively administratively runtime exception runtimeexception log repository persistence exception persistenceexception logger error handle event handleevent persistence exception persistenceexception runtime exception runtimeexception exception talking repository resource resolver resourceresolver resource resolver resourceresolver close logger debug do update properties doupdateproperties updating properties update properties topology event applicable update properties updateproperties lock logger debug update properties updateproperties calling do update properties doupdateproperties do update properties doupdateproperties logger debug update properties updateproperties calling handle potential topology change handlepotentialtopologychange check for topology change checkfortopologychange logger debug update properties updateproperties internal caching provider infos service ranking provider info providerinfo comparable provider info providerinfo property provider propertyprovider provider object property properties propertyproperties ranking service id serviceid map string string properties hash map hashmap string string provider info providerinfo property provider propertyprovider provider map string object service props serviceprops provider provider property properties propertyproperties service props serviceprops property provider propertyprovider property properties object service props serviceprops constants service ranking integer ranking ranking integer service id serviceid service props serviceprops constants service refresh properties refreshproperties refresh properties refreshproperties properties clear property properties propertyproperties string string val provider get property getproperty string property properties propertyproperties val put property if valid putpropertyifvalid string property properties propertyproperties val property properties propertyproperties string string string property properties propertyproperties string val provider get property getproperty val put property if valid putpropertyifvalid val sling property valid put property if valid putpropertyifvalid string string val property name helper propertynamehelper is valid property name isvalidpropertyname properties val java lang comparable compare to compareto java lang object compare to compareto provider info providerinfo sort rank ascending order ranking ranking rank ranking ranking higher rank ranks equal sort service desc ending descending order service id serviceid service id serviceid override equals object obj obj provider info providerinfo provider info providerinfo obj service id serviceid service id serviceid override hash code hashcode provider hash code hashcode checks local cluster view clusterview avoids annotation registry annotationregistry check for local cluster view change checkforlocalclusterviewchange view state manager lock viewstatemanagerlock lock activated logger debug check for local cluster view change checkforlocalclusterviewchange activated ignoring cluster view service clusterviewservice cluster view service clusterviewservice get cluster view service getclusterviewservice cluster view service clusterviewservice undefined cluster view exception undefinedclusterviewexception reason repository exception cluster view service clusterviewservice moment local cluster view localclusterview local cluster view localclusterview cluster view service clusterviewservice get local cluster view getlocalclusterview undefined cluster view exception undefinedclusterviewexception logger info check for local cluster view change checkforlocalclusterviewchange undefined cluster view get reason getreason get old view getoldview set not current setnotcurrent view state manager viewstatemanager handle changing handlechanging get reason getreason reason isolated topology handle isolated from topology handleisolatedfromtopology view state manager lock viewstatemanagerlock view state manager lock viewstatemanagerlock unlock check current topology potential change check for topology change checkfortopologychange view state manager lock viewstatemanagerlock lock activated logger debug check for topology change checkfortopologychange activated ignoring default topology view defaulttopologyview default topology view defaulttopologyview get topology gettopology is current iscurrent valid view view state manager viewstatemanager comparison sending event view state manager viewstatemanager handle new view handlenewview set old view setoldview don view send changing event decide d decided view state manager viewstatemanager view state manager viewstatemanager handle changing handlechanging view state manager lock viewstatemanagerlock view state manager lock viewstatemanagerlock unlock handle fact topology started change info rm inform listeners asap handle topology changing handletopologychanging view state manager lock viewstatemanagerlock lock activated logger error handle topology changing handletopologychanging activated logger debug handle topology changing handletopologychanging invoking view state manager viewstatemanager handle changing handlechanging view state manager viewstatemanager handle changing handlechanging view state manager lock viewstatemanagerlock view state manager lock viewstatemanagerlock unlock sling send topology changing event shutdown service for ced shutdown forcedshutdown lock activated logger error for ced shutdown forcedshutdown ignoring for ced forced shutdown service activated get old view getoldview logger error for ced shutdown forcedshutdown ignoring for ced forced shutdown old view oldview logger error for ced shutdown forcedshutdown sending topology changing listeners sling old view oldview marked get old view getoldview set not current setnotcurrent view state manager viewstatemanager handle changing handlechanging logger error for ced shutdown forcedshutdown deactivating discovery service discoveryservice event flag service deactivated activated cluster view service clusterviewservice get cluster view service getclusterviewservice cluster view service clusterviewservice cluster view service impl clusterviewserviceimpl get cluster view service impl getclusterviewserviceimpl cluster view service clusterviewservice announcement registry announcementregistry get announcement registry getannouncementregistry announcement registry announcementregistry testing view state manager viewstatemanager get view state manager getviewstatemanager view state manager viewstatemanager