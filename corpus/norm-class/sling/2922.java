licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling commons testing int egration integration java io exception ioexception java input stream inputstream java net malformedurlexception java net url java util hash map hashmap java util linked list linkedlist java util list java util map java util regex pattern javax servlet http http servlet response httpservletresponse junit framework test case testcase org apache commons http client httpclient credentials org apache commons http client httpclient header org apache commons http client httpclient http client httpclient org apache commons http client httpclient http exception httpexception org apache commons http client httpclient http method httpmethod org apache commons http client httpclient http method base httpmethodbase org apache commons http client httpclient name value pair namevaluepair org apache commons http client httpclient username password credentials usernamepasswordcredentials org apache commons http client httpclient auth scope authscope org apache commons http client httpclient methods get method getmethod org apache commons http client httpclient methods post method postmethod org apache sling commons testing util java script engine javascriptengine org slf logger org slf logger factory loggerfactory org slf mdc base http based sling launchpad int egration integration tests http test base httptestbase test case testcase logger log logger factory loggerfactory get logger getlogger get class getclass system property startup check skipped string property skip start up startup check launchpad skip startup check startupcheck string http url remove ending slash removeendingslash system get property getproperty launchpad http server url http localhost string http base url remove path removepath http url string webdav base url remove ending slash removeendingslash system get property getproperty launchpad webdav server url http base url string servlet context remove ending slash removeendingslash system get property getproperty launchpad servlet context get path getpath http url string ready url prop prefix launchpad ready max ready url base path test files string test path launchpad int egration integration tests string http method string http method post post string content type html text html string content type xml application xml string content type plain text plain string content type json application json string content type application java script javascript string content type css text css string sling resource type sling resource type resourcetype string sling post servlet create suffix string ext txt string read iness check extension readinesscheckextension txt string read iness check content type prefix readinesscheckcontenttypeprefix text plain string execute resource type sling testing slingtesting http test base httptestbase get simple name getsimplename execute counter executecounter ready timeout seconds integer get integer getinteger http test base httptestbase ready timeout seconds readytimeoutseconds sling int egration test client slingintegrationtestclient test client testclient http client httpclient http client httpclient sling startup ok slingstartupok don care content type get content getcontent methods string content type dontcare object startup check lock startupchecklock object url s urls stored deleted tear down teardown list string urls to delete urlstodelete linked list linkedlist string execute java script javascript code java script engine javascriptengine java script engine javascriptengine java script engine javascriptengine http test base httptestbase creates test node parent path parentpath stores values testing created jsp scripting test jspscriptingtest older test classes simplify test node testnode http test node httptestnode test node testnode string parent path parentpath map string string properties io exception ioexception test client testclient parent path parentpath properties string remove ending slash removeendingslash string str str str ends with endswith str substring str length str string remove path removepath string str pos str index of indexof slash pos slashpos str index of indexof pos slash pos slashpos str substring slash pos slashpos str string get path getpath string str pos str index of indexof slash pos slashpos str index of indexof pos slash pos slashpos str substring slash pos slashpos override set up setup exception set up setup mdc test class testclass get class getclass get name getname mdc test case testcase get name getname assume http webdav host port url url url url http base url malformedurlexception mfe io exception ioexception malformedurlexception http base url setup http client authentication jackrabbit credentials http client httpclient test info passing client testinfopassingclient http client httpclient get params getparams set authentication preemptive setauthenticationpreemptive credentials default creds defaultcreds get default credentials getdefaultcredentials http client httpclient get state getstate set credentials setcredentials auth scope authscope url get host gethost url get port getport auth scope authscope realm default creds defaultcreds test client testclient sling int egration test client slingintegrationtestclient http client httpclient wait for sling startup waitforslingstartup generate credentials http requests credentials get default credentials getdefaultcredentials username password credentials usernamepasswordcredentials admin admin override tear down teardown exception mdc remove test case testcase mdc remove test class testclass tear down teardown string url urls to delete urlstodelete test client testclient delete url server side initialization sling bundles async hronously asynchronously webapp started method checks ready server side calling url requires sling post servlet slingpostservlet jcr repository work correctly wait for sling startup waitforslingstartup exception leave random startup check lock startupchecklock sling startup ok slingstartupok sling startup ok slingstartupok fail sling services checked earlier tests system get property getproperty property skip start up startup check sling startup ok slingstartupok sling startup ok slingstartupok system err println checking required sling services started timeout ready timeout seconds seconds system err println base url s urls http base url webdav base url servlet context servlet context creating node server msec timeout list string exception messages exceptionmessages linked list linkedlist string max msec to wait maxmsectowait ready timeout seconds startup time startuptime system current time millis currenttimemillis string last exception lastexception n times ok ntimesok wait sling server ready slingserverready returns times cases initial izations initializations place returns min times sling startup ok slingstartupok system current time millis currenttimemillis startup time startuptime max msec to wait maxmsectowait sling server ready slingserverready n times ok ntimesok n times ok ntimesok min times sling startup ok slingstartupok n times ok ntimesok exception n times ok ntimesok string new x newx to string tostring last exception lastexception equals new x newx exception messages exceptionmessages add new x newx last exception lastexception new x newx thread sleep sling startup ok slingstartupok log info sling server ready msec system current time millis currenttimemillis startup time startuptime string buffer stringbuffer msg string buffer stringbuffer server ready msg append max msec to wait maxmsectowait append msec append exception messages exceptionmessages size append exceptions string exception messages exceptionmessages msg append append system err println msg fail msg to string tostring system err println sling services started continuing int egration integration tests create retrieve node server sling server ready slingserverready exception create node server string time string value of valueof system current time millis currenttimemillis string url http base url wait for sling startup waitforslingstartup time add properties node map string string props hash map hashmap string string props time time post url created node content string url of new node urlofnewnode url of new node urlofnewnode test client testclient create node createnode url props get method getmethod get method getmethod url of new node urlofnewnode read iness check extension readinesscheckextension status http client httpclient execute method executemethod status http status code exception httpstatuscodeexception status url of new node urlofnewnode header get response header getresponseheader content type string content type contenttype get value getvalue content type contenttype starts with startswith read iness check content type prefix readinesscheckcontenttypeprefix io exception ioexception expected content type read iness check content type prefix readinesscheckcontenttypeprefix content type contenttype url url of new node urlofnewnode string content get response body as string getresponsebodyasstring content time io exception ioexception content time content url url of new node urlofnewnode url of new node urlofnewnode test client testclient delete url of new node urlofnewnode exception ignore check webdav root ready trailing slash base url context root string web dav url webdavurl webdav base url http any method httpanymethod options http any method httpanymethod options web dav url webdavurl status http client httpclient execute method executemethod options status http status code exception httpstatuscodeexception status options web dav url webdavurl header tells talking webdav server header options get response header getresponseheader io exception ioexception response header url web dav url webdavurl get value getvalue io exception ioexception header url web dav url webdavurl get value getvalue prop find propfind io exception ioexception header get value getvalue prop find propfind url web dav url webdavurl check optional additional url s urls read yness readyness defined system properties launchpad ready tmp some url someurl expected regexp in response expectedregexpinresponse max ready url string prop name propname ready url prop prefix string ready def readydef system get property getproperty prop name propname string parts ready def readydef split parts length string info prop name propname ready def readydef http any method httpanymethod http any method httpanymethod parts http base url parts expected status expectedstatus integer value of valueof parts status http client httpclient execute method executemethod expected status expectedstatus status io exception ioexception status status match expected info string content get response body as string getresponsebodyasstring pattern pattern compile parts matcher content matches io exception ioexception content match expected regexp info content content verify url returns expected status code expectedstatuscode http method httpmethod executed io exception ioexception http method httpmethod assert http status asserthttpstatus string url string urlstring expected status code expectedstatuscode string assert message assertmessage io exception ioexception get method getmethod get method getmethod url string urlstring status http client httpclient execute method executemethod assert message assertmessage assert equals assertequals url string urlstring expected status code expectedstatuscode status assert equals assertequals assert message assertmessage expected status code expectedstatuscode status verify url returns expected status code expectedstatuscode http method httpmethod executed io exception ioexception http method httpmethod assert http status asserthttpstatus string url string urlstring expected status code expectedstatuscode io exception ioexception assert http status asserthttpstatus url string urlstring expected status code expectedstatuscode execute post request check status http method httpmethod executed io exception ioexception http method httpmethod assert post status assertpoststatus string url expected status code expectedstatuscode list name value pair namevaluepair post params postparams string assert message assertmessage io exception ioexception post method postmethod post post method postmethod url post set follow redirects setfollowredirects post params postparams name value pair namevaluepair nvp post set request body setrequestbody post params postparams to array toarray nvp status http client httpclient execute method executemethod post assert message assertmessage assert equals assertequals expected status code expectedstatuscode status assert equals assertequals assert message assertmessage expected status code expectedstatuscode status post retrieve contents url content type http method string get content getcontent string url string expected content type expectedcontenttype io exception ioexception get content getcontent url expected content type expectedcontenttype retrieve contents url content type http method string get content getcontent string url string expected content type expectedcontenttype list name value pair namevaluepair params io exception ioexception get content getcontent url expected content type expectedcontenttype params http servlet response httpservletresponse retrieve contents url content type http method param expected content type expectedcontenttype content type dontcare checked io exception ioexception http exception httpexception string get content getcontent string url string expected content type expectedcontenttype list name value pair namevaluepair params expected status code expectedstatuscode io exception ioexception get content getcontent url expected content type expectedcontenttype params expected status code expectedstatuscode http method retrieve contents url content type param expected content type expectedcontenttype content type dontcare checked param http method httpmethod supports post methods io exception ioexception http exception httpexception string get content getcontent string url string expected content type expectedcontenttype list name value pair namevaluepair params expected status code expectedstatuscode string http method httpmethod io exception ioexception http method base httpmethodbase method http method equals http method httpmethod method get method getmethod url http method post equals http method httpmethod method post method postmethod url fail http method supported test suite method http method httpmethod params name value pair namevaluepair nvp name value pair namevaluepair method set query string setquerystring params to array toarray nvp status http client httpclient execute method executemethod method string content get response body as stream getresponsebodyasstream method assert equals assertequals expected status expected status code expectedstatuscode url content content expected status code expectedstatuscode status header method get response header getresponseheader content type expected content type expectedcontenttype fail expected content type get value getvalue content type dontcare equals expected content type expectedcontenttype check fail expected content type starts expected content type expectedcontenttype content type header url assert true asserttrue expected content type starts expected content type expectedcontenttype url get value getvalue get value getvalue starts with startswith expected content type expectedcontenttype content to string tostring upload rendering test script url deletion string upload test script uploadtestscript string script path scriptpath string local file name localfilename string filename on server filenameonserver io exception ioexception string url webdav base url script path scriptpath filename on server filenameonserver string test file testfile int egration integration test local file name localfilename input stream inputstream data get class getclass get resource as stream getresourceasstream test file testfile data fail test file test file testfile test client testclient upload url data data data close url upload script execute parameters content string execute script executescript string local file name localfilename exception execute script executescript local file name localfilename upload script execute parameters optional content string execute script executescript string local file name localfilename list name value pair namevaluepair params exception unique resource type counter get class getclass counter execute counter executecounter string resource type resourcetype execute resource type counter string script path scriptpath apps resource type resourcetype test client testclient mkdirs webdav base url script path scriptpath pos local file name localfilename last index of lastindexof pos illegal argument exception illegalargumentexception local file name localfilename extension local file name localfilename string ext local file name localfilename substring pos list string to delete todelete linked list linkedlist string to delete todelete add upload test script uploadtestscript script path scriptpath local file name localfilename txt ext map string string props hash map hashmap string string props sling resource type resource type resourcetype string node path nodepath script path scriptpath node counter string node url nodeurl test client testclient create node createnode http base url node path nodepath props to delete todelete add node url nodeurl get content getcontent node url nodeurl txt content type dontcare params string url to delete todelete test client testclient delete url assert java script assertjavascript string expected output expectedoutput string json data jsondata string code io exception ioexception assert java script assertjavascript expected output expectedoutput json data jsondata code evaluate code json data jsondata data object assert java script assertjavascript string expected output expectedoutput string json data jsondata string code string test info testinfo io exception ioexception string result java script engine javascriptengine execute code json data jsondata result equals expected output expectedoutput fail expected expected output expectedoutput result script code data json data jsondata test info testinfo test info test info testinfo response body string option ally optionally limiting length read param max length maxlength limit string get response body as stream getresponsebodyasstream http method base httpmethodbase max length maxlength io exception ioexception input stream inputstream get response body as stream getresponsebodyasstream string builder stringbuilder content string builder stringbuilder string charset get response char set getresponsecharset buffer read buffer buffer length content append string buffer charset max length maxlength content length max length maxlength illegal argument exception illegalargumentexception response body size max length maxlength max length maxlength content to string tostring extension content type prefix requests check sling read iness readiness set read iness content type setreadinesscontenttype string extension string content type prefix contenttypeprefix read iness check extension readinesscheckextension extension read iness check content type prefix readinesscheckcontenttypeprefix content type prefix contenttypeprefix