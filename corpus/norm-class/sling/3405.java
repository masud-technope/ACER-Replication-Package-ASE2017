licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling jcr registration java util hash map hashmap java util iterator java util map javax jcr repository org osgi framework constants org osgi framework service reference servicereference org osgi service component component constants componentconstants org osgi service component component context componentcontext org osgi service log log service logservice code abstract registration support abstractregistrationsupport code base registration purposes embedded repositories base cares synchronization issues link activate component context componentcontext link deactivate component context componentcontext link bind repository bindrepository service reference servicereference link unbind repository unbindrepository service reference servicereference methods impl ementations implementations api safely assume thread safe ensure thread safeness methods overwritten abstract registration support abstractregistrationsupport jcr repository service registration property create registration service registration property assumed single string exist repository registered string repository registration log service logservice logging extensions declare log service reference call link bind log bindlog log service logservice enable logging correctly log service logservice log osg i osgi component context componentcontext component context componentcontext component context componentcontext empty map repositories bound registry registry activated map string service reference servicereference repository registration backlog repositoryregistrationbacklog hash map hashmap string service reference servicereference map repositories bound registry component registered registry map string object registered repositories registeredrepositories hash map hashmap string object lock serialize access registry management object registry lock registrylock object api implemented extensions performs additional activation tasks method called link activate component context componentcontext method intended internal setup acquiring registry activation succeeded code code returned activation succeeded repositories bound component activated registered code code returned activation failed component disabled receives repository bind unbound events unbind events repositories bound do activate doactivate performs additional deactivation tasks method called link deactivate component context componentcontext method intended internal cleanup setup link do activate doactivate method method called link do activate doactivate succeeded do deactivate dodeactivate called register repository registry method called link activate component context componentcontext repositories bound component activated link bind repository bindrepository service reference servicereference repositories bound component activated actual registration fails method expected code code fact link unbind repository unbindrepository string object called named repository method safely assume called activation component component deactivation param repository registered param repository code javax jcr repository code register returns object code data code parameter link unbind repository unbindrepository string object method unregister repository code code actual registration failed object bind repository bindrepository string repository repository called unregister repository registry method called link unbind repository unbindrepository service reference servicereference repositories unbound component deactivated link deactivate component context componentcontext repositories unbound component deactivated link bind repository bindrepository string repository returned code code named repository registered method called method safely assume called activation component component deactivation param repository registered param data data object returned link bind repository internal bindrepositoryinternal string service reference servicereference method unbind repository unbindrepository string object data implementation support methods returns osg i osgi code component context componentcontext code component method returns code code link do activate doactivate method called link do deactivate dodeactivate method called method code code fully operational component context componentcontext get component context getcomponentcontext component context componentcontext logs message optional code throwable code stack trace log service code stderr code log service param level code log service logservice code level log message param message message log code code param code throwable code log message code code log level string message throwable log service logservice log log log log log level message system err print level message print stack trace printstacktrace system err returns code code property service properties code code property exists property empty string param reference code service reference servicereference code code code property returned empty property code code string get name getname service reference servicereference reference string string reference get property getproperty repository registration length log log service logservice log debug register repository registerrepository repository registered scr int ergration intergration activates component thread safely osg i osgi component context componentcontext field call link do activate doactivate register repo sitores repositores bound activation calling link bind repository bindrepository string repository repository link do activate doactivate returns code code repositories bound registered component disabled param component context componentcontext osg i osgi code component context componentcontext code component activate component context componentcontext component context componentcontext registry lock registrylock component context componentcontext component context componentcontext do activate doactivate register repositories tmp map iterator map entry string service reference servicereference repository registration backlog repositoryregistrationbacklog entry set entryset iterator has next hasnext map entry string service reference servicereference entry bind repository internal bindrepositoryinternal entry get key getkey entry get value getvalue remove disable component string string component context componentcontext get properties getproperties component constants componentconstants component get component context getcomponentcontext disable component disablecomponent deactivates component thread safely unregister repo sitores repositores bound calling link unbind repository unbindrepository string object repository call link do deactivate dodeactivate clear osg i osgi component context componentcontext field param component context componentcontext osg i osgi code component context componentcontext code component deactivate component context componentcontext context registry lock registrylock unregister repositories tmp map iterator map entry string object registered repositories registeredrepositories entry set entryset iterator has next hasnext map entry string object entry unbind repository unbindrepository entry get key getkey entry get value getvalue remove do deactivate dodeactivate component context componentcontext registers repository identified osg i osgi service reference service property repository service property repository registered param reference code service reference servicereference code representing repository register bind repository bindrepository service reference servicereference reference string get name getname reference registry lock registrylock component context componentcontext context register delay repository registration backlog repositoryregistrationbacklog reference bind repository internal bindrepositoryinternal reference log log service logservice log info service reference get property getproperty constants service property registering unregisters repository identified osg i osgi service reference service property repository service property repository assumed registered param reference code service reference servicereference code representing repository unregister unbind repository unbindrepository service reference servicereference reference string get name getname reference registry lock registrylock unbind repository object data registered repositories registeredrepositories remove data unbind repository unbindrepository data ensure unregistered internal temporary map repository registration backlog repositoryregistrationbacklog remove reference service component context componentcontext component context componentcontext get bundle context getbundlecontext unget service ungetservice reference log log service logservice log debug service reference get property getproperty constants service property unregister binds log service logservice bind log bindlog log service logservice log log log unbinds log service logservice unbind log unbindlog log service logservice log log log log internal internal bind method called link activate component context componentcontext link bind repository bindrepository service reference servicereference control registration process retrieving repository calling link bind repository bindrepository string repository method bind repository internal bindrepositoryinternal string service reference servicereference reference repository repository repository get component context getcomponentcontext get bundle context getbundlecontext get service getservice reference object data bind repository bindrepository repository data registered repositories registeredrepositories data