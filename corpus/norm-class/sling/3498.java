licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling installer factories sub systems subsystems base impl java byte array output stream bytearrayoutputstream java io exception ioexception java input stream inputstream java output stream outputstream java net url java util arrays java util dictionary java util hash set hashset java util java util jar attributes java util jar jar file jarfile java util jar manifest java util zip zip entry zipentry java util zip zip input stream zipinputstream org apache sling installer api tasks registered resource registeredresource org apache sling installer api tasks transformation result transformationresult org apache sling installer factories sub systems subsystems base impl subsystem base transformer subsystembasetransformer delete on close file input stream deleteonclosefileinputstream org apache sling settings sling settings service slingsettingsservice org junit test org mockito mockito org junit assert array equals assertarrayequals org junit assert equals assertequals org junit assert false assertfalse org junit assert true asserttrue subsystem base transformer test subsystembasetransformertest test test transform no run mode testtransformnorunmode exception sling settings service slingsettingsservice sling settings slingsettings mockito mock sling settings service slingsettingsservice subsystem base transformer subsystembasetransformer sbt subsystem base transformer subsystembasetransformer sling settings slingsettings url test archive testarchive get class getclass get resource getresource test subsystem base registered resource registeredresource resource test registered resource testregisteredresource test archive testarchive transformation result transformationresult tra sbt transform resource assert equals assertequals tra length transformation result transformationresult tra assert equals assertequals esa get resource type getresourcetype assert equals assertequals test get id getid delete on close file input stream deleteonclosefileinputstream dcis delete on close file input stream deleteonclosefileinputstream get input stream getinputstream assert true asserttrue file backing stream exist dcis file exists string found bundles foundbundles hash set hashset zip input stream zipinputstream zis zip input stream zipinputstream dcis jar file jarfile jar file jarfile test archive testarchive get file getfile zip entry zipentry zis get next entry getnextentry found bundles foundbundles add get name getname get name getname osgi inf subsystem manifest manifest zis attributes attrs get main attributes getmainattributes assert equals assertequals test attrs get value getvalue subsystem symbolic name symbolicname assert equals assertequals osgi subsystem composite attrs get value getvalue subsystem type assert equals assertequals yeah attrs get value getvalue subsystem copyright assert equals assertequals extra subsystem headers including span multiple lines manifest attrs get value getvalue subsystem description assert equals assertequals org apache sling commons osgi version type osgi bundle start order org apache sling commons json version type osgi bundle start order org apache sling commons mime version type osgi bundle start order attrs get value getvalue subsystem content org apache sling commons osgi jar zip entry zipentry oze get entry getentry potential bundles org apache sling commons osgi jar assert artifacts equal assertartifactsequal oze get name getname get input stream getinputstream oze zis org apache sling commons json jar zip entry zipentry jze get entry getentry potential bundles org apache sling commons json jar assert artifacts equal assertartifactsequal jze get name getname get input stream getinputstream jze zis org apache sling commons mime jar zip entry zipentry mze get entry getentry potential bundles org apache sling commons mime jar assert artifacts equal assertartifactsequal mze get name getname get input stream getinputstream mze zis assert equals assertequals hash set hashset arrays as list aslist osgi inf subsystem org apache sling commons osgi jar org apache sling commons json jar org apache sling commons mime jar found bundles foundbundles assert false assertfalse closing stream temp file deleted dcis file exists test test other run mode testotherrunmode exception sling settings service slingsettingsservice sling settings slingsettings mockito mock sling settings service slingsettingsservice mockito sling settings slingsettings get run modes getrunmodes then return thenreturn hash set hashset string arrays as list aslist bar tar subsystem base transformer subsystembasetransformer sbt subsystem base transformer subsystembasetransformer sling settings slingsettings url test archive testarchive get class getclass get resource getresource test subsystem base registered resource registeredresource resource test registered resource testregisteredresource test archive testarchive transformation result transformationresult tra sbt transform resource assert equals assertequals tra length transformation result transformationresult tra assert equals assertequals esa get resource type getresourcetype assert equals assertequals test get id getid delete on close file input stream deleteonclosefileinputstream dcis delete on close file input stream deleteonclosefileinputstream get input stream getinputstream assert true asserttrue file backing stream exist dcis file exists string found bundles foundbundles hash set hashset zip input stream zipinputstream zis zip input stream zipinputstream dcis jar file jarfile jar file jarfile test archive testarchive get file getfile zip entry zipentry zis get next entry getnextentry found bundles foundbundles add get name getname get name getname osgi inf subsystem manifest manifest zis attributes attrs get main attributes getmainattributes assert equals assertequals test attrs get value getvalue subsystem symbolic name symbolicname assert equals assertequals osgi subsystem composite attrs get value getvalue subsystem type assert equals assertequals yeah attrs get value getvalue subsystem copyright assert equals assertequals extra subsystem headers including span multiple lines manifest attrs get value getvalue subsystem description assert equals assertequals org apache sling commons osgi version type osgi bundle start order org apache sling commons json version type osgi bundle start order org apache sling commons mime version type osgi bundle start order org apache sling commons threads version type osgi bundle start order org apache sling commons content detection contentdetection version type osgi bundle start order attrs get value getvalue subsystem content org apache sling commons osgi jar zip entry zipentry oze get entry getentry potential bundles org apache sling commons osgi jar assert artifacts equal assertartifactsequal oze get name getname get input stream getinputstream oze zis org apache sling commons json jar zip entry zipentry jze get entry getentry potential bundles org apache sling commons json jar assert artifacts equal assertartifactsequal jze get name getname get input stream getinputstream jze zis org apache sling commons mime jar zip entry zipentry mze get entry getentry potential bundles org apache sling commons mime jar assert artifacts equal assertartifactsequal mze get name getname get input stream getinputstream mze zis org apache sling commons threads jar zip entry zipentry tze get entry getentry potential bundles org apache sling commons threads jar assert artifacts equal assertartifactsequal tze get name getname get input stream getinputstream tze zis org apache sling commons content detection contentdetection jar zip entry zipentry cze get entry getentry potential bundles org apache sling commons content detection contentdetection jar assert artifacts equal assertartifactsequal cze get name getname get input stream getinputstream cze zis assert equals assertequals hash set hashset arrays as list aslist osgi inf subsystem org apache sling commons osgi jar org apache sling commons json jar org apache sling commons mime jar org apache sling commons threads jar org apache sling commons content detection contentdetection jar found bundles foundbundles assert false assertfalse closing stream temp file deleted dcis file exists assert artifacts equal assertartifactsequal string input stream inputstream input stream inputstream io exception ioexception bytes suck streams suckstreams bytes suck streams suckstreams assert array equals assertarrayequals bytes bytes pump streams pumpstreams input stream inputstream output stream outputstream io exception ioexception bytes length offset length read bytes offset bytes length offset offset length offset bytes length write bytes bytes length offset offset write bytes offset suck streams suckstreams input stream inputstream io exception ioexception byte array output stream bytearrayoutputstream baos byte array output stream bytearrayoutputstream pump streams pumpstreams baos baos to byte array tobytearray test registered resource testregisteredresource registered resource registeredresource url resourceurl test registered resource testregisteredresource url url resourceurl url override string get scheme getscheme resourceurl get protocol getprotocol override string geturl resourceurl to external form toexternalform override string get type gettype file override input stream inputstream get input stream getinputstream io exception ioexception resourceurl open stream openstream override dictionary string object get dictionary getdictionary override string get digest getdigest override get priority getpriority override string get entity id getentityid