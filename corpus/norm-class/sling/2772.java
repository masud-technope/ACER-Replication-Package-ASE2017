licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling xss impl java file input stream fileinputstream java input stream inputstream java lang reflect field org apache sling api sling http servlet request slinghttpservletrequest org apache sling api resource resource resolver resourceresolver org apache sling xss xssapi org junit org junit org junit test org mockito invocation invocation on mock invocationonmock org mockito stub bin g stubbing answer org owasp validator html anti samy antisamy org owasp validator html policy org owasp validator html model attribute org powermock reflect whitebox junit framework test case testcase org junit fail org mockito matchers any string anystring org mockito mockito mock org mockito mockito xssapi impl test xssapiimpltest string rubbish rubbish string rubbish json rubbish string rubbish xml rubbish xssapi xssapi setup xss filter impl xssfilterimpl xss filter xssfilter xss filter impl xssfilterimpl set default handler setdefaulthandler xss filter xssfilter src main resources sling inf content config xml xssapi xssapi impl xssapiimpl whitebox invoke method invokemethod xssapi activate field filter field filterfield xssapi impl xssapiimpl get declared field getdeclaredfield xss filter xssfilter filter field filterfield set accessible setaccessible filter field filterfield xssapi xss filter xssfilter resource resolver resourceresolver mock resolver mockresolver mock resource resolver resourceresolver mock resolver mockresolver map any string anystring then answer thenanswer answer object answer invocation on mock invocationonmock invocation object args invocation get arguments getarguments string url string args url replace all replaceall jcr jcr sling http servlet request slinghttpservletrequest mock request mockrequest mock sling http servlet request slinghttpservletrequest mock request mockrequest get resource resolver getresourceresolver then return thenreturn mock resolver mockresolver xssapi xssapi get request specific i getrequestspecificapi mock request mockrequest exception print stack trace printstacktrace set default handler setdefaulthandler xss filter impl xssfilterimpl xss filter xssfilter string filename exception input stream inputstream policy stream policystream file input stream fileinputstream filename policy policy policy get instance getinstance policy stream policystream anti samy antisamy anti samy antisamy anti samy antisamy policy policy handler policyhandler mock policy handler mockpolicyhandler mock policy handler policyhandler mock policy handler mockpolicyhandler get policy getpolicy then return thenreturn policy mock policy handler mockpolicyhandler get anti samy getantisamy then return thenreturn anti samy antisamy whitebox invoke method invokemethod xss filter xssfilter set default handler setdefaulthandler mock policy handler mockpolicyhandler test testencodeforhtml string test data testdata simple simple script script gã¼nter gã¼nter string a test data atestdata test data testdata string source a test data atestdata string expected a test data atestdata test case testcase assert equals assertequals html encoding source expected xssapi encodeforhtml source test testencodeforhtmlattr string test data testdata simple simple script script script alert pwned script script alert pwned script gã¼nter gã¼nter string a test data atestdata test data testdata string source a test data atestdata string expected a test data atestdata test case testcase assert equals assertequals html encoding source expected xssapi encodeforhtmlattr source test test encode for l testencodeforxml string test data testdata simple simple script script gã¼nter gã¼nter string a test data atestdata test data testdata string source a test data atestdata string expected a test data atestdata test case testcase assert equals assertequals xml encoding source expected xssapi encodeforxml source test testencodeforxmlattr string test data testdata simple simple script script gã¼nter gã¼nter xss expression alert xss xss expression alert xss string a test data atestdata test data testdata string source a test data atestdata string expected a test data atestdata test case testcase assert equals assertequals xml encoding source expected xssapi encodeforxmlattr source test testfilterhtml string test data testdata source expected result simple simple script ugly script wow wow onmouseover ugly nice nice img src java script javascript ugly img src nice jpg img src nice jpg gã¼nter gã¼nter str ike strike str ike strike str ike strike str ike strike str ike strike str ike strike href empty href href empty href string a test data atestdata test data testdata string source a test data atestdata string expected a test data atestdata test case testcase assert equals assertequals filtering source expected xssapi filterhtml source test test get valid href testgetvalidhref string test data testdata simple simple parent parent repo gã¼nter repo gã¼nter jcr names paces namespaces jcr content feed jcr content feed jcr content jcr content jcr content jcr content on click onclick ugly on click onclick ugly java script javascript ugly http localhost http localhost http localhost test http localhost test http localhost jcr content test http localhost jcr content test http localhost test html http localhost test html space test test http localhost test http localhost test test attr test attr http localhost test attr http localhost test attr test test http localhost test http localhost test test test http localhost test http localhost test test test http localhost test http localhost test test test ecd http localhost test http localhost test ecd test test ccd http localhost test http localhost test ccd test test http localhost test http localhost test colons query string test search html tag test test search html tag aid test jcr names paces namespaces colons query string test jcr content search html tag test test jcr content search html tag aid test query string test search html tag test ing tag abc test search html tag aid test ing tag aid abc string a test data atestdata test data testdata string href a test data atestdata string expected a test data atestdata test case testcase assert equals assertequals requested href expected xssapi get valid href getvalidhref href test test get valid href without href config testgetvalidhrefwithouthrefconfig exception load anti samy antisamy configuration href filter xss filter impl xssfilterimpl xss filter xssfilter whitebox get internal state getinternalstate xssapi xss filter xssfilter set default handler setdefaulthandler xss filter xssfilter src test resources config without href configwithouthref xml attribute href attribute hrefattribute whitebox get internal state getinternalstate xss filter xssfilter href attribute hrefattribute assert equals assertequals href attribute hrefattribute xss filter impl xssfilterimpl href attribute tests check configuration test get valid href testgetvalidhref test test get valid integer testgetvalidinteger string test data testdata junk string a test data atestdata test data testdata string source a test data atestdata integer expected a test data atestdata integer a test data atestdata test case testcase assert equals assertequals validating int eger integer source expected xssapi get valid integer getvalidinteger source test test get valid long testgetvalidlong string test data testdata junk string a test data atestdata test data testdata string source a test data atestdata expected a test data atestdata a test data atestdata test case testcase assert equals assertequals validating source expected xssapi get valid long getvalidlong source test test get valid dimension testgetvaliddimension string test data testdata junk auto auto auto auto auto auto auto x autox string a test data atestdata test data testdata string source a test data atestdata string expected a test data atestdata test case testcase assert equals assertequals validating dimension source expected xssapi get valid dimension getvaliddimension source test test encode for string testencodeforjsstring string test data testdata simple simple script script string a test data atestdata test data testdata string source a test data atestdata string expected a test data atestdata test case testcase assert equals assertequals encoding source expected xssapi encodeforjsstring source test test get valid token testgetvalidjstoken string test data testdata rubbish rubbish simple simple clickstreamcloud thingy clickstreamcloud thingy rubbish rubbish literal string literal string literal string literal string bad literal rubbish literal junk literal junk rubbish rubbish string a test data atestdata test data testdata string source a test data atestdata string expected a test data atestdata test case testcase assert equals assertequals validating java script javascript token source expected xssapi getvalidjstoken source rubbish test testencodeforcssstring string test data testdata source expected result test test string a test data atestdata test data testdata string source a test data atestdata string expected a test data atestdata string result xssapi encodeforcssstring source test case testcase assert equals assertequals encoding source expected result test test get valid style token testgetvalidstyletoken string test data testdata rubbish rubbish rubbish neak rubbish java script javascript alert rubbish java script javascript alert rubbish java script javascript alert xss rubbish url java script javascript alert rubbish url java script javascript alert rubbish url java script javascript alert xss rubbish expression alert rubbish expression alert rubbish expression location rubbish style script alert script rubbish background color background color moz box sizing moz box sizing fff fff literal string literal string literal string literal string invalid strings bad string rubbish rubbish rubbish valid parent hesis parenthesis rgb rgb invalid parent hesis parenthesis rgb rubbish rubbish valid tokens url http test png url http test png url image test png url image test png invalid tokens color red rubbish string a test data atestdata test data testdata string source a test data atestdata string expected a test data atestdata string result xssapi get valid style token getvalidstyletoken source rubbish result equals expected fail validating style token source expecting expected result test testgetvalidcsscolor string test data testdata rubbish rubbish rgb rgb rgba rgba ddd ddd eeeeee eeeeee hsl hsl hsla hsla current color currentcolor current color currentcolor transparent transparent menu text menutext menu text menutext expression rubbish blue rubbish url rubbish string a test data atestdata test data testdata string source a test data atestdata string expected a test data atestdata string result xssapi getvalidcsscolor source rubbish result equals expected fail validating css color source expecting expected result test test get valid multi line comment testgetvalidmultilinecomment string test data testdata rubbish blah hack rubbish valid comment valid comment string a test data atestdata test data testdata string source a test data atestdata string expected a test data atestdata string result xssapi get valid multi line comment getvalidmultilinecomment source rubbish result equals expected fail validating multiline comment source expecting expected result test testgetvalidjson string test data testdata rubbish json rubbish json rubbish json test test test test test test rubbish json test test test test test test test test test test test test test test rubbish json test test test test string a test data atestdata test data testdata string source a test data atestdata string expected a test data atestdata string result xssapi getvalidjson source rubbish json result equals expected fail validating json source expecting expected result test test get valid l testgetvalidxml string test data testdata rubbish xml rubbish xml test test test rubbish xml test test test rubbish xml xyz xyz xyz rubbish xml string a test data atestdata test data testdata string source a test data atestdata string expected a test data atestdata string result xssapi getvalidxml source rubbish xml result equals expected fail validating xml source expecting expected result