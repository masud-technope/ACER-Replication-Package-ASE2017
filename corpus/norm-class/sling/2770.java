licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling discovery commons providers spi org apache sling discovery commons providers base topology view basetopologyview cluster sync service clustersyncservice establish strong consistency underlying event ually eventually consistent repository issue length sling version comp osed composed fact ors factors concurrency discovery service listeners instances change topology listener doesn activity based older inc arnation incarnation topology view topologyview listener instance change view view based repository instance leaves cluster crashes depending repository left backlog processed relevant topology dependent data waited set tle settle topology dependent activity aspects handled cluster sync service clustersyncservice intro ducing introducing sync token written repository receiving peers writing instance aware ongoing change writing instance topology changing receiving instance writing instance prior sending topology changing aspect achieved making underlying repository oak discovery lite descriptor determine instance view deactivated backlog repository dependent cluster sync service clustersyncservice starts synchronization process calls callback completion sync thread safe invoked concurrently sync called previous invocation finished previous invocation discarded callback previous invocation longer called synchronization process consists making repository processed potential backlog instances longer view writes sync token defined location peers sync tokens declares successful completion point calls callback param view view instances local cluster agree param callback runnable called successful syncing sync base topology view basetopologyview view runnable callback cancel sync cancelsync