licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling validation impl java util array list arraylist java util arrays java util collection java util hash map hashmap java util map java util map entry java util regex pattern javax annotation nonnull org apache commons collections multi hash map multihashmap org apache commons collections multi map multimap org apache sling api resource resource resolver resourceresolver org apache sling validation validator org apache sling validation impl model resource property builder resourcepropertybuilder org apache sling validation impl model validation model builder validationmodelbuilder org apache sling validation impl util example valid ators examplevalidators date validator datevalidator org apache sling validation model resource property resourceproperty org apache sling validation model validation model validationmodel org apache sling validation spi validation model provider validationmodelprovider org hamcrest description org hamcrest matchers org hamcrest type safe matcher typesafematcher org junit org junit org junit test org junit runner run with runwith org mockito mock org mockito mockito org mockito run ners runners mockito unit runner mockitojunitrunner org osgi framework constants org osgi service event event run with runwith mockito unit runner mockitojunitrunner validation model retriever impl test validationmodelretrieverimpltest validation model retriever impl validationmodelretrieverimpl validation model retriever validationmodelretriever validator date validator datevalidator multi map multimap applicable path per resource type applicablepathperresourcetype test model provider testmodelprovider model provider modelprovider mock resource resolver resourceresolver resource resolver resourceresolver test model provider models resource types map applicable path per resource type applicablepathperresourcetype applicable path applicablepath add ition addition models empty resource property equal validated resource type test model provider testmodelprovider validation model provider validationmodelprovider counter override nonnull collection validation model validationmodel get model getmodel nonnull string relative resource type relativeresourcetype nonnull map string validator valid ators map validatorsmap nonnull resource resolver resourceresolver resource resolver resourceresolver validator passed assert that assertthat valid ators map validatorsmap matchers string validator has entry hasentry date validator datevalidator get name getname date validator datevalidator collection validation model validationmodel models array list arraylist validation model validationmodel collection string applicable paths applicablepaths collection string applicable path per resource type applicablepathperresourcetype relative resource type relativeresourcetype applicable paths applicablepaths string applicable path applicablepath applicable paths applicablepaths validation model builder validationmodelbuilder model builder modelbuilder validation model builder validationmodelbuilder applicable path applicablepath model builder modelbuilder add applicable path addapplicablepath applicable path applicablepath model builder modelbuilder resource property resourceproperty resource property builder resourcepropertybuilder build relative resource type relativeresourcetype models add model builder modelbuilder build relative resource type relativeresourcetype counter models custom hamcrest matcher matches resource properties based equality resource property name matcher resourcepropertynamematcher type safe matcher typesafematcher resource property resourceproperty string expected name expectedname resource property name matcher resourcepropertynamematcher string expected name expectedname override describe to describeto description description description append text appendtext resource property resourceproperty expected name expectedname override matches safely matchessafely resource property resourceproperty resource property resourceproperty expected name expectedname equals resource property resourceproperty get name getname setup date validator datevalidator date validator datevalidator applicable path per resource type applicablepathperresourcetype multi hash map multihashmap validation model retriever validationmodelretriever validation model retriever impl validationmodelretrieverimpl model provider modelprovider test model provider testmodelprovider service service ranking map string object properties hash map hashmap string object properties constants service validation model retriever validationmodelretriever bind model provider bindmodelprovider model provider modelprovider properties validation model retriever validationmodelretriever bind validator bindvalidator date validator datevalidator test test get model testgetmodel applicable path per resource type applicablepathperresourcetype test type content site applicable path per resource type applicablepathperresourcetype test type content site sub node subnode test applicable path per resource type applicablepathperresourcetype test type content site sub node subnode validation model validationmodel model validation model retriever validationmodelretriever get model getmodel test type content site sub node subnode test some page somepage resource resolver resourceresolver assert not null assertnotnull model assert that assertthat arrays as list aslist model get applicable paths getapplicablepaths matchers content site sub node subnode test test test get model with null applicable path path testgetmodelwithnullapplicablepathpath applicable path per resource type applicablepathperresourcetype test type content site applicable path per resource type applicablepathperresourcetype test type applicable path per resource type applicablepathperresourcetype test type content site sub node subnode validation model validationmodel model validation model retriever validationmodelretriever get model getmodel test type resource resolver resourceresolver assert not null assertnotnull model assert that assertthat arrays as list aslist model get applicable paths getapplicablepaths matchers test test get cached model testgetcachedmodel applicable path per resource type applicablepathperresourcetype test type content site call times time counter provider called validation model validationmodel model validation model retriever validationmodelretriever get model getmodel test type content site resource resolver resourceresolver assert not null assertnotnull model assert equals assertequals model provider modelprovider counter model validation model retriever validationmodelretriever get model getmodel test type content site resource resolver resourceresolver assert not null assertnotnull model assert equals assertequals model provider modelprovider counter model validation model retriever validationmodelretriever get model getmodel invalid type content site resource resolver resourceresolver assert null assertnull model assert equals assertequals model provider modelprovider counter model validation model retriever validationmodelretriever get model getmodel invalid type content site resource resolver resourceresolver assert null assertnull model assert equals assertequals model provider modelprovider counter test test get cached invalidation testgetcachedinvalidation applicable path per resource type applicablepathperresourcetype test type content site validation model retriever validationmodelretriever get model getmodel test type content site resource resolver resourceresolver assert equals assertequals model provider modelprovider counter validation model retriever validationmodelretriever handle event handleevent event validation model retriever impl validationmodelretrieverimpl cache invalidation event topic cache invalidation provider called validation model retriever validationmodelretriever get model getmodel test type content site resource resolver resourceresolver assert equals assertequals model provider modelprovider counter test test get model with resource inheritance testgetmodelwithresourceinheritance type model applicable path per resource type applicablepathperresourcetype test type content site validation model validationmodel model validation model retriever validationmodelretriever get model getmodel test type content site resource resolver resourceresolver assert not null assertnotnull model assert that assertthat model get resource properties getresourceproperties matchers resource property name matcher resourcepropertynamematcher test type type merged model returned mockito resource resolver resourceresolver get parent resource type getparentresourcetype test type then return thenreturn test supertype applicable path per resource type applicablepathperresourcetype test supertype content site model validation model retriever validationmodelretriever get model getmodel test type content site resource resolver resourceresolver assert not null assertnotnull model assert that assertthat model get resource properties getresourceproperties matchers contains in any order containsinanyorder resource property name matcher resourcepropertynamematcher test type resource property name matcher resourcepropertynamematcher test supertype test test get model with resource inheritance and no suitable base model found testgetmodelwithresourceinheritanceandnosuitablebasemodelfound model base type resource type validation model validationmodel model validation model retriever validationmodelretriever get model getmodel test type content site resource resolver resourceresolver assert null assertnull model model model type mockito resource resolver resourceresolver get parent resource type getparentresourcetype test type then return thenreturn test supertype model base type model validation model retriever validationmodelretriever get model getmodel test type content site resource resolver resourceresolver assert null assertnull model model base type model validation model retriever validationmodelretriever validation models cache validationmodelscache clear supertype model applicable path per resource type applicablepathperresourcetype test supertype content site model validation model retriever validationmodelretriever get model getmodel test type content site resource resolver resourceresolver assert not null assertnotnull model assert that assertthat model get resource properties getresourceproperties matchers resource property name matcher resourcepropertynamematcher test supertype test test get model with resource inheritance and no model for super type found testgetmodelwithresourceinheritanceandnomodelforsupertypefound applicable path per resource type applicablepathperresourcetype test type content site mockito resource resolver resourceresolver get parent resource type getparentresourcetype test type then return thenreturn test supertype mockito resource resolver resourceresolver get parent resource type getparentresourcetype test supertype then return thenreturn test supers upertype supersupertype model base type validation model validationmodel model validation model retriever validationmodelretriever get model getmodel test type content site resource resolver resourceresolver assert not null assertnotnull model assert that assertthat model get resource properties getresourceproperties matchers resource property name matcher resourcepropertynamematcher test type