licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling event impl jobs queues java util array list arraylist java util collections java util hash map hashmap java util hash set hashset java util iterator java util list java util map java util java util concurrent concurrent hash map concurrenthashmap java util concurrent atomic atomic boolean atomicboolean org apache felix scr annotations activate org apache felix scr annotations component org apache felix scr annotations deactivate org apache felix scr annotations properties org apache felix scr annotations property org apache felix scr annotations reference org apache felix scr annotations service org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling commons scheduler scheduler org apache sling commons threads thread pool threadpool org apache sling commons threads thread pool manager threadpoolmanager org apache sling event impl eventing thread pool eventingthreadpool org apache sling event impl jobs job consumer manager jobconsumermanager org apache sling event impl jobs job handler jobhandler org apache sling event impl jobs job impl jobimpl org apache sling event impl jobs config configuration change listener configurationchangelistener org apache sling event impl jobs config internal queue configuration internalqueueconfiguration org apache sling event impl jobs config job manager configuration jobmanagerconfiguration org apache sling event impl jobs config queue configuration manager queueconfigurationmanager org apache sling event impl jobs config queue configuration manager queueconfigurationmanager queue info queueinfo org apache sling event impl jobs jmx queue status event queuestatusevent org apache sling event impl jobs jmx queues bean impl queuesmbeanimpl org apache sling event impl jobs stats statistics manager statisticsmanager org apache sling event impl support environment org apache sling event impl support resource helper resourcehelper org apache sling event jobs job org apache sling event jobs notification constants notificationconstants org apache sling event jobs queue org apache sling event jobs jmx queuesmbean org osgi service event event org osgi service event event admin eventadmin org osgi service event event constants eventconstants org osgi service event event handler eventhandler org slf logger org slf logger factory loggerfactory implementation queue manager component service runnable queue manager queuemanager event handler eventhandler properties property scheduler property scheduler period long value longvalue property scheduler property scheduler concurrent bool value boolvalue property event constants eventconstants event topic notification constants notificationconstants topic job queue manager queuemanager runnable event handler eventhandler configuration change listener configurationchangelistener logger logger logger logger factory loggerfactory get logger getlogger get class getclass reference event admin eventadmin event admin eventadmin reference scheduler scheduler reference job consumer manager jobconsumermanager job consumer manager jobconsumermanager reference queuesmbean queuesmbean reference thread pool manager threadpoolmanager thread pool manager threadpoolmanager thread pool reference reference interface referenceinterface eventing thread pool eventingthreadpool thread pool threadpool thread pool threadpool job manager configuration reference job manager configuration jobmanagerconfiguration configuration reference statistics manager statisticsmanager statistics manager statisticsmanager lock object queues map don sync concurrent map object queues lock queueslock object active queues map string job queue impl jobqueueimpl queues concurrent hash map concurrenthashmap string job queue impl jobqueueimpl count scheduler runs scheduler runs schedulerruns flag manager active suspended atomic boolean atomicboolean is active isactive atomic boolean atomicboolean queue services queue services queueservices queue services queueservices activate component param props configuration properties activate activate map string object props logger info apache sling queue manager started instance environment application queue services queueservices queue services queueservices queue services queueservices configuration configuration queue services queueservices event admin eventadmin event admin eventadmin queue services queueservices job consumer manager jobconsumermanager job consumer manager jobconsumermanager queue services queueservices scheduler scheduler queue services queueservices thread pool manager threadpoolmanager thread pool manager threadpoolmanager queue services queueservices statistics manager statisticsmanager statistics manager statisticsmanager queue services queueservices even ting thread pool eventingthreadpool thread pool threadpool configuration add listener addlistener deactivate component deactivate deactivate logger debug apache sling queue manager stop ping stopping instance environment application configuration remove listener removelistener iterator job queue impl jobqueueimpl queues values iterator has next hasnext job queue impl jobqueueimpl jbq jbq close update mbeans queues bean impl queuesmbeanimpl queuesmbean send event sendevent queue status event queuestatusevent jbq queues clear queue services queueservices logger info apache sling queue manager stopped instance environment application method invoked per iodically periodically scheduler searches idle queues stops timeout queue idle consecutive clean calls removed java lang runnable main tain maintain scheduler runs schedulerruns logger debug queue manager main tenance maintenance starting scheduler runs schedulerruns queue main tenance maintenance is active isactive job queue impl jobqueueimpl jbq queues values jbq main tain maintain full topic scan scheduler runs schedulerruns is active isactive full topic scan fulltopicscan full clean do full clean up dofullcleanup scheduler runs schedulerruns do full clean up dofullcleanup check idle queue logger debug checking idle queues synchronize avoid creating queue removed cleanup queues lock queueslock iterator map entry string job queue impl jobqueueimpl queues entry set entryset iterator has next hasnext map entry string job queue impl jobqueueimpl current job queue impl jobqueueimpl jbq current get value getvalue jbq try to close trytoclose logger debug removing idle job queue jbq remove remove update mbeans queues bean impl queuesmbeanimpl queuesmbean send event sendevent queue status event queuestatusevent jbq logger debug queue manager main tenance maintenance finished scheduler runs schedulerruns start queue method searches queue queue exist created started param queue info queueinfo queue info param topics topics start queue info queueinfo queue info queueinfo string topics internal queue configuration internalqueueconfiguration config queue info queueinfo queue configuration queueconfiguration create queue is new queue isnewqueue job queue impl jobqueueimpl queue synchronize avoid creating queue removed cleanup queues lock queueslock queue queues queue info queueinfo queue name queuename check rec onfiguration reconfiguration identity check queue queue get configuration getconfiguration config out date queue outdatequeue queue queue configuration queue queue queue job queue impl jobqueueimpl create queue createqueue queue info queueinfo queue name queuename config queue services queueservices topics startup queue empty create queue createqueue queue is new queue isnewqueue queues queue info queueinfo queue name queuename queue queues bean impl queuesmbeanimpl queuesmbean send event sendevent queue status event queuestatusevent queue queue is new queue isnewqueue queue wake up queue wakeupqueue topics queue start jobs startjobs method invoked per iodically periodically scheduler configuration minute java lang runnable override main tain maintain out date queue outdatequeue job queue impl jobqueueimpl queue remove queue check main queue string old name oldname resource helper resourcehelper filter queue name filterqueuename queue get name getname queues remove old name oldname check close rename queue try to close trytoclose copy statistics update mbeans queues bean impl queuesmbeanimpl queuesmbean send event sendevent queue status event queuestatusevent queue queue out date outdate read d readd string new name newname resource helper resourcehelper filter name filtername queue get name getname queues contains key containskey new name newname new name newname resource helper resourcehelper filter name filtername queue get name getname string value of valueof queues new name newname queue update mbeans queues bean impl queuesmbeanimpl queuesmbean send event sendevent queue status event queuestatusevent queue queue out date outdate queues restart rename close queues clear queues lock queueslock list job queue impl jobqueueimpl queues array list arraylist job queue impl jobqueueimpl queues values job queue impl jobqueueimpl queue queues out date queue outdatequeue queue check active job manager configuration jobmanagerconfiguration config configuration config list job res chedule list reschedulelist configuration clear job retry list clearjobretrylist job res chedule list reschedulelist job handler jobhandler job handler jobhandler job impl jobimpl configuration res chedule reschedule org apache sling event jobs job manager jobmanager get queue getqueue java lang string queue get queue getqueue string queues org apache sling event jobs job manager jobmanager get queues getqueues iterable queue get queues getqueues iterator job queue impl jobqueueimpl jq i jqi queues values iterator iterable queue override iterator queue iterator iterator queue override has next hasnext jq i jqi has next hasnext override queue jq i jqi override remove unsupported operation exception unsupportedoperationexception method called topology queue configurations change param active job handling active atm override configuration changed configurationchanged active active configuration logger debug topology changed active is active isactive active active full topic scan fulltopicscan restart full topic scan fulltopicscan logger debug scan ning scanning repository existing topics string topics scan topics scantopics map queue info queueinfo string mapping update topic mapping updatetopicmapping topics start queues map entry queue info queueinfo string entry mapping entry set entryset start entry get key getkey entry get value getvalue scan resource tree topics string scan topics scantopics string topics hash set hashset string resource resolver resourceresolver resolver configuration create resource resolver createresourceresolver resource base resource baseresource resolver get resource getresource configuration get local jobs path getlocaljobspath sanity check base resource baseresource iterator resource topic iter topiciter base resource baseresource list children listchildren topic iter topiciter has next hasnext resource topic resource topicresource topic iter topiciter string topic topic resource topicresource get name getname replace logger debug topic topic topics add topic resolver close topics org osgi service event event handler eventhandler handle event handleevent org osgi service event event override handle event handleevent event event string topic string event get property getproperty notification constants notificationconstants not ification notification property job topic is active isactive topic queue info queueinfo info configuration get queue configuration manager getqueueconfigurationmanager get queue info getqueueinfo topic start info collections singleton topic latest mapping queue topics map queue info queueinfo string update topic mapping updatetopicmapping string topics map queue info queueinfo string mapping hash map hashmap queue configuration manager queueconfigurationmanager queue info queueinfo string string topic topics queue info queueinfo queue info queueinfo configuration get queue configuration manager getqueueconfigurationmanager get queue info getqueueinfo topic string queue topics queuetopics mapping queue info queueinfo queue topics queuetopics queue topics queuetopics hash set hashset string mapping queue info queueinfo queue topics queuetopics queue topics queuetopics add topic logger debug established topic mapping mapping mapping bind thread pool bindthreadpool eventing thread pool eventingthreadpool etp thread pool threadpool etp unbind thread pool unbindthreadpool eventing thread pool eventingthreadpool etp thread pool threadpool etp thread pool threadpool