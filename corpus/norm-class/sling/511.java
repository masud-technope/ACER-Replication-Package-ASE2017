licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling servlets post impl helper java buffered input stream bufferedinputstream java byte array input stream bytearrayinputstream java file java file input stream fileinputstream java file output stream fileoutputstream java io exception ioexception java input stream inputstream java output stream outputstream java sequence input stream sequenceinputstream java util calendar java util collections java util hash map hashmap java util linked hash set linkedhashset java util list java util map java util javax jcr node javax jcr node iterator nodeiterator javax jcr repository exception repositoryexception javax jcr node type nodetype node type nodetype javax jcr node type nodetype node type manager nodetypemanager javax servlet servlet context servletcontext org apache commons io utils ioutils org apache jackrabbit util text org apache sling api request request parameter requestparameter org apache sling api resource modifiable value map modifiablevaluemap org apache sling api resource persistence exception persistenceexception org apache sling api resource resource org apache sling servlets post modification org apache sling servlets post sling post constants slingpostconstants org slf logger org slf logger factory loggerfactory handles file uploads simple xmp form action admin method post enctype multipart form data input type file port rait portrait form xmp create file node admin node type admin derived folder resource node file name filename xmp form action admin method post enctype multipart form data input type file form xmp filename uploaded file node type hint xmp form action admin method post enctype multipart form data input type file port rait portrait input type hidden port rait portrait type hint typehint file form xmp create node type file admin hinted type file int ermediate intermediate file node created resource node sling file upload handler slingfileuploadhandler node type nodetype string constants string folder folder string file file string resource resource string unstructured unstructured item string constants string jcr content jcr content string jcr lastmodified jcr last modified lastmodified string jcr mimetype jcr mime type mimetype string jcr encoding jcr encoding string jcr data jcr data logger log logger factory loggerfactory get logger getlogger get class getclass servlet context servlet context servletcontext servlet context servletcontext set servlet context setservletcontext servlet context servletcontext servlet context servletcontext servlet context servletcontext servlet context servletcontext file request parameter creation nodes parent node folder file created resource code code filename uploaded file param parent parent node param prop assembled property info repository exception repositoryexception error occurs set file setfile resource parent resource parentresource node parent request property requestproperty prop request parameter requestparameter list modification string string content type contenttype repository exception repositoryexception persistence exception persistenceexception check type hint type file create file type invalid drop parent node type decide create nt file createntfile parent is node type isnodetype folder string type hint typehint prop get type hint gettypehint type hint typehint node type manager nodetypemanager nt mgr ntmgr parent get session getsession get workspace getworkspace get node type manager getnodetypemanager node type nodetype nt mgr ntmgr get node type getnodetype type hint typehint create nt file createntfile is node type isnodetype file repository exception repositoryexception type hint typehint file image extension create nt file createntfile index of indexof create nt file createntfile empty type type hint typehint type hint typehint create nt file createntfile file resource create file node needed resource res parent resparent create nt file createntfile create file res parent resparent get or create child resource getorcreatechildresource parent resource parentresource type hint typehint jcr content type hint typehint resource res parent resparent parent resource parentresource create resource node resource new resource newresource get or create child resource getorcreatechildresource res parent resparent type hint typehint node res new resource newresource adapt to adaptto node properties add modification on modified onmodified res set property setproperty jcr lastmodified calendar get instance getinstance get path getpath add modification on modified onmodified res set property setproperty jcr mimetype content type contenttype get path getpath process chunk upload request sep arately separately prop is chunk upload ischunkupload process chunk processchunk res parent resparent res prop add modification on modified onmodified res set property setproperty jcr data get input stream getinputstream get path getpath io exception ioexception repository exception repositoryexception error retrieving input stream inputstream parameter file request parameter creation nodes parent node folder file created resource code code filename uploaded file param parent parent node param prop assembled property info repository exception repositoryexception error occurs set file setfile resource parent resource parentresource request property requestproperty prop request parameter requestparameter list modification string string content type contenttype persistence exception persistenceexception repository exception repositoryexception string type hint typehint prop get type hint gettypehint type hint typehint type hint typehint file prop is chunk upload ischunkupload exists exception repository exception repositoryexception process chunk upload request parent resource parent resource parentresource get path getpath doesn exists create properties map string object props hash map hashmap string object props sling resource type resourcetype type hint typehint props jcr lastmodified calendar get instance getinstance props jcr mimetype content type contenttype props jcr data get input stream getinputstream io exception ioexception persistence exception persistenceexception error retrieving input stream inputstream parameter create resource resource result parent resource parentresource get child getchild result modifiable value map modifiablevaluemap result adapt to adaptto modifiable value map modifiablevaluemap persistence exception persistenceexception resource parent resource parentresource get path getpath modifiable put all putall props result parent resource parentresource get resource resolver getresourceresolver create parent resource parentresource props string key props key set keyset add modification on modified onmodified result get path getpath key process chunk upload int ermediate intermediate chunks request per sists persists chunks jcr content chunk start jcr data resource chunk start jcr data chunk merge previous chunks chunk replace binary destination process chunk processchunk resource res parent resparent node res request property requestproperty prop request parameter requestparameter list modification repository exception repositoryexception chunk offset chunkoffset prop get chunk getchunk get offset getoffset chunk offset chunkoffset chunk check chunk upload progress exception node iterator nodeiterator itr res get nodes getnodes sling post constants slingpostconstants chunk node itr has next hasnext repository exception repositoryexception chunk upload progress res get path getpath res add mixin addmixin sling post constants slingpostconstants sling chunk mixin add modification on modified onmodified res set property setproperty sling post constants slingpostconstants sling chunks length get path getpath res has property hasproperty jcr data create empty jcr data property res set property setproperty jcr data byte array input stream bytearrayinputstream get bytes getbytes res has property hasproperty sling post constants slingpostconstants sling chunks length repository exception repositoryexception chunk upload res get path getpath current length currentlength res get property getproperty sling post constants slingpostconstants sling chunks length get long getlong total length totallength prop get chunk getchunk get length getlength chunk offset chunkoffset current length currentlength repository exception repositoryexception chunk offset chunk offset chunkoffset doesn match expected offset res get property getproperty sling post constants slingpostconstants sling chunks length get long getlong total length totallength res has property hasproperty sling post constants slingpostconstants sling file length expected length expectedlength res get property getproperty sling post constants slingpostconstants sling file length get long getlong total length totallength expected length expectedlength repository exception repositoryexception file length total length totallength doesn match expected length expected length expectedlength res set property setproperty sling post constants slingpostconstants sling file length total length totallength node iterator nodeiterator itr res get nodes getnodes sling post constants slingpostconstants chunk node string value of valueof chunk offset chunkoffset itr has next hasnext repository exception repositoryexception chunk itr next node nextnode get path getpath string node name nodename sling post constants slingpostconstants chunk node string value of valueof chunk offset chunkoffset string value of valueof chunk offset chunkoffset get size getsize total length totallength current length currentlength get size getsize prop get chunk getchunk is completed iscompleted file file input stream inputstream file ins fileins file merge chunks mergechunks res get input stream getinputstream file ins fileins file input stream fileinputstream file add modification on modified onmodified res set property setproperty jcr data file ins fileins get path getpath node iterator nodeiterator node itr nodeitr res get nodes getnodes sling post constants slingpostconstants chunk node node itr nodeitr has next hasnext node node range noderange node itr nodeitr next node nextnode add modification on deleted ondeleted node range noderange get path getpath node range noderange remove res has property hasproperty sling post constants slingpostconstants sling file length javax jcr property exp len prop explenprop res get property getproperty sling post constants slingpostconstants sling file length add modification on deleted ondeleted exp len prop explenprop get path getpath exp len prop explenprop remove res has property hasproperty sling post constants slingpostconstants sling chunks length javax jcr property curr len prop currlenprop res get property getproperty sling post constants slingpostconstants sling chunks length add modification on deleted ondeleted curr len prop currlenprop get path getpath curr len prop currlenprop remove res remove mixin removemixin sling post constants slingpostconstants sling chunk mixin file ins fileins close file delete io exception ioexception ign node range node rangenode res add node addnode node name nodename sling post constants slingpostconstants sling chunk node type nodetype add modification on created oncreated range node rangenode get path getpath add modification on modified onmodified range node rangenode set property setproperty jcr data get input stream getinputstream get path getpath add modification on modified onmodified range node rangenode set property setproperty sling post constants slingpostconstants sling chunk offset chunk offset chunkoffset get path getpath add modification on modified onmodified res set property setproperty sling post constants slingpostconstants sling chunks length current length currentlength get size getsize get path getpath io exception ioexception repository exception repositoryexception error retrieving input stream inputstream parameter merge previous chunks chunk stream temporary file file merge chunks mergechunks node parent node parentnode input stream inputstream last chunk stream lastchunkstream persistence exception persistenceexception repository exception repositoryexception output stream outputstream sequence input stream sequenceinputstream merge str m mergestrm file file file file create temp file createtempfile tmp merge chunk mergechunk file output stream fileoutputstream file string start pattern startpattern sling post constants slingpostconstants chunk node node iterator nodeiterator node itr nodeitr parent node parentnode get nodes getnodes start pattern startpattern input stream inputstream ins input stream inputstream inp str m set inpstrmset linked hash set linkedhashset input stream inputstream node itr nodeitr has next hasnext node itr nodeitr get size getsize repository exception repositoryexception node pattern start pattern startpattern node range node rangenode node itr nodeitr next node nextnode inp str m set inpstrmset add range node rangenode get property getproperty javax jcr property jcr data get binary getbinary get stream getstream log debug chunk merge stream range node rangenode get name getname string index bounds indexbounds range node rangenode get name getname substring sling post constants slingpostconstants chunk node length split start pattern startpattern sling post constants slingpostconstants chunk node string value of valueof value of valueof index bounds indexbounds node itr nodeitr parent node parentnode get nodes getnodes start pattern startpattern inp str m set inpstrmset add last chunk stream lastchunkstream merge str m mergestrm sequence input stream sequenceinputstream collections enumeration inp str m set inpstrmset io utils ioutils copy l arg e copylarge merge str m mergestrm io exception ioexception persistence exception persistenceexception exc epiton excepiton occured io utils ioutils close quietly closequietly io utils ioutils close quietly closequietly merge str m mergestrm file delete chunks saved node chunks exist delete chunks deletechunks node node repository exception repositoryexception parent node chunks mixin sling chunks applied node chunk parent chunkparent node jcr content node jcrcontentnode has chunks haschunks node chunk parent chunkparent node node has node hasnode jcr content has chunks haschunks jcr content node jcrcontentnode node get node getnode jcr content chunk parent chunkparent jcr content node jcrcontentnode chunk parent chunkparent node iterator nodeiterator node itr nodeitr chunk parent chunkparent get nodes getnodes sling post constants slingpostconstants chunk node node itr nodeitr has next hasnext node range node rangenode node itr nodeitr next node nextnode range node rangenode remove chunk parent chunkparent has property hasproperty sling post constants slingpostconstants sling file length chunk parent chunkparent get property getproperty sling post constants slingpostconstants sling file length remove chunk parent chunkparent has property hasproperty sling post constants slingpostconstants sling chunks length chunk parent chunkparent get property getproperty sling post constants slingpostconstants sling chunks length remove chunk parent chunkparent remove mixin removemixin sling post constants slingpostconstants sling chunk mixin link sling post constants slingpostconstants sling chunk node type nodetype link node param node link node link sling post constants slingpostconstants sling chunk node type nodetype link node link sling post constants slingpostconstants sling chunk node type nodetype chunk node repository exception repositoryexception node get last chunk getlastchunk node node repository exception repositoryexception parent node chunks mixin sling chunks applied node chunk parent chunkparent node jcr content node jcrcontentnode has chunks haschunks node chunk parent chunkparent node node has node hasnode jcr content has chunks haschunks jcr content node jcrcontentnode node get node getnode jcr content chunk parent chunkparent jcr content node jcrcontentnode string start pattern startpattern sling post constants slingpostconstants chunk node node iterator nodeiterator node itr nodeitr chunk parent chunkparent get nodes getnodes start pattern startpattern node chunk node chunknode node itr nodeitr has next hasnext node itr nodeitr get size getsize repository exception repositoryexception node pattern start pattern startpattern chunk node chunknode node itr nodeitr next node nextnode string index bounds indexbounds chunk node chunknode get name getname substring sling post constants slingpostconstants chunk node length split start pattern startpattern sling post constants slingpostconstants chunk node string value of valueof value of valueof index bounds indexbounds node itr nodeitr chunk parent chunkparent get nodes getnodes start pattern startpattern chunk node chunknode node chunks stored has chunks haschunks node node repository exception repositoryexception node type nodetype node type nodetype node get mixin node types getmixinnodetypes node type nodetype get name getname equals sling post constants slingpostconstants sling chunk mixin string app octet application octet stream file request parameter creation nodes parent node folder file created resource code code filename uploaded file param parent parent node param prop assembled property info repository exception repositoryexception error occurs set file setfile resource parent request property requestproperty prop list modification repository exception repositoryexception persistence exception persistenceexception request parameter requestparameter prop get values getvalues ignore plain form field empty is form field isformfield get size getsize node string prop get name getname equals get file name getfilename str ip strip path browse rs browsers include entire path substring last index of lastindexof substring last index of lastindexof text escape illegal jcr chars escapeillegaljcrchars string content type contenttype get content type getcontenttype content type contenttype idx content type contenttype index of indexof idx content type contenttype content type contenttype substring idx content type contenttype content type contenttype equals app octet servlet context servletcontext ctx servlet context servletcontext ctx content type contenttype ctx get mime type getmimetype get file name getfilename content type contenttype content type contenttype equals app octet content type contenttype app octet node node parent adapt to adaptto node node set file setfile parent prop content type contenttype set file setfile parent node prop content type contenttype resource get or create child resource getorcreatechildresource resource parent string string type hint typehint list modification persistence exception persistenceexception repository exception repositoryexception resource result parent get child getchild result node existing result adapt to adaptto node existing existing is node type isnodetype type hint typehint existing remove result create with changes createwithchanges parent type hint typehint result create with changes createwithchanges parent type hint typehint result resource create with changes createwithchanges resource parent string string type hint typehint list modification persistence exception persistenceexception map string object properties type hint typehint properties hash map hashmap string object parent adapt to adaptto node properties jcr primary type primarytype type hint typehint properties sling resource type resourcetype type hint typehint resource result parent get resource resolver getresourceresolver create parent properties add modification on created oncreated result get path getpath result