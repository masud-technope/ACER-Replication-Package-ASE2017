licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling installer org junit assert equals assertequals org junit assert not null assertnotnull java input stream inputstream java util array list arraylist java util dictionary java util hash map hashmap java util hashtable java util list java util map java util concurrent broken barrier exception brokenbarrierexception java util concurrent cyclic barrier cyclicbarrier java util concurrent time unit timeunit java util concurrent timeout exception timeoutexception org apache sling installer api installable resource installableresource org apache sling installer api update handler updatehandler org apache sling installer api update result updateresult org apache sling installer api event installation event installationevent org apache sling installer api event installation listener installationlistener org apache sling installer api tasks change state task changestatetask org apache sling installer api tasks install task installtask org apache sling installer api tasks install task factory installtaskfactory org apache sling installer api tasks registered resource registeredresource org apache sling installer api tasks resource state resourcestate org apache sling installer api tasks resource transformer resourcetransformer org apache sling installer api tasks task resource taskresource org apache sling installer api tasks task resource group taskresourcegroup org apache sling installer api tasks transformation result transformationresult org junit org junit org junit test org junit runner run with runwith org ops pax exam option org ops pax exam junit pax exam paxexam org osgi framework constants org osgi framework service registration serviceregistration run with runwith pax exam paxexam update handler test updatehandlertest osgi installer test base osgiinstallertestbase string type special list service registration serviceregistration service registrations serviceregistrations array list arraylist service registration serviceregistration map string dictionary string object installed hash map hashmap string dictionary string object org ops pax exam configuration option config default configuration defaultconfiguration set up setup setup installer setupinstaller service registrations serviceregistrations clear dictionary string object props hashtable string object props constants service ranking service registrations serviceregistrations add bundle context bundlecontext register service registerservice resource transformer resourcetransformer resource transformer resourcetransformer transformation result transformationresult transform registered resource registeredresource resource last dot lastdot resource geturl last index of lastindexof last slash lastslash resource geturl last index of lastindexof resource geturl substring last dot lastdot equals type string resource geturl substring last slash lastslash last dot lastdot transformation result transformationresult transformation result transformationresult set id setid set resource type setresourcetype type transformation result transformationresult props service registrations serviceregistrations add bundle context bundlecontext register service registerservice install task factory installtaskfactory install task factory installtaskfactory install task installtask create task createtask task resource group taskresourcegroup to activate toactivate task resource taskresource to activate toactivate get active resource getactiveresource get entity id getentityid starts with startswith type get state getstate resource state resourcestate install installed get entity id getentityid get dictionary getdictionary change state task changestatetask to activate toactivate resource state resourcestate installed installed remove get entity id getentityid change state task changestatetask to activate toactivate resource state resourcestate uninstalled props override tear down teardown service registration serviceregistration reg service registrations serviceregistrations reg unregister service registrations serviceregistrations clear tear down teardown update handler impl updatehandlerimpl update handler updatehandler barrier bar rier barrier barrier update result updateresult result update result updateresult handle update handleupdate string resource type resourcetype string string url input stream inputstream map string object attributes test dictionaries update result updateresult handle update handleupdate string resource type resourcetype string string url dictionary string object dict map string object attributes resource type resourcetype equals type update result updateresult update result updateresult type resource resource type resourcetype set priority setpriority installable resource installableresource priority result bar rier barrier block update result updateresult handle removal handleremoval string resource type resourcetype string string url update result updateresult update result updateresult url result bar rier barrier block update result updateresult wait for update waitforupdate bar rier barrier block update result updateresult result result bar rier barrier reset barrier get installer listener barrier getinstallerlistenerbarrier barrier barrier installation listener installationlistener installation listener installationlistener on event onevent installation event installationevent event event get type gettype installation event installationevent type proc essed processed block reg bundle context bundlecontext register service registerservice installation listener installationlistener get name getname test test simple update testsimpleupdate exception update handler impl updatehandlerimpl update handler impl updatehandlerimpl dictionary string object dict hashtable string object dict update handler updatehandler property schemes type service registrations serviceregistrations add bundle context bundlecontext register service registerservice update handler updatehandler dict dictionary string object data hashtable string object data foo bar installable resource installableresource installable resource installableresource resource type data installable resource installableresource type properties barrier get installer listener barrier getinstallerlistenerbarrier installer register resources registerresources type installable resource installableresource block reg unregister assert not null assertnotnull resource installed installed installed type dictionary string object new data newdata hashtable string object data bar foo resource change listener resourcechangelistener resource added or updated resourceaddedorupdated type new data newdata update result updateresult wait for update waitforupdate assert not null assertnotnull assert equals assertequals type resource type geturl resource change listener resourcechangelistener resource removed resourceremoved type update result updateresult wait for update waitforupdate assert not null assertnotnull assert equals assertequals type resource type geturl simplified version cyclic bar rier barrier testing barrier cyclic barrier cyclicbarrier barrier part ies parties part ies parties block await interrupted exception interruptedexception broken barrier exception brokenbarrierexception block seconds await seconds time unit timeunit seconds interrupted exception interruptedexception broken barrier exception brokenbarrierexception timeout exception timeoutexception reset service registration serviceregistration reg