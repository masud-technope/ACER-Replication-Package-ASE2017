licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling tooling support install impl java file java file input stream fileinputstream java file not found exception filenotfoundexception java file output stream fileoutputstream java io exception ioexception java input stream inputstream java util list java util jar jar file jarfile java util jar jar input stream jarinputstream java util jar jar output stream jaroutputstream java util jar manifest java util zip def later deflater java util zip zip entry zipentry java util zip zip output stream zipoutputstream javax servlet servlet javax servlet servlet exception servletexception javax servlet http http servlet httpservlet javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse org apache felix scr annotations activate org apache felix scr annotations component org apache felix scr annotations property org apache felix scr annotations reference org apache felix scr annotations service org osgi framework bundle org osgi framework bundle context bundlecontext org osgi framework bundle exception bundleexception org osgi framework constants org osgi service package admin packageadmin package admin packageadmin org slf logger org slf logger factory loggerfactory org apache commons file upload fileupload file item fileitem org apache commons file upload fileupload file upload exception fileuploadexception org apache commons file upload fileupload disk disk file item factory diskfileitemfactory org apache commons file upload fileupload servlet servlet file upload servletfileupload org apache commons io utils ioutils prototype installing updating bundle directory component service servlet property alias system sling tooling install install servlet installservlet http servlet httpservlet serialversionuid logger logger logger factory loggerfactory get logger getlogger get class getclass string dir dir upload memory size threshold bundle context bundlecontext bundle context bundlecontext reference package admin packageadmin package admin packageadmin activate activate bundle context bundlecontext bundle context bundlecontext bundle context bundlecontext bundle context bundlecontext override do post dopost http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception string dir path dirpath req get parameter getparameter dir is multipart ismultipart servlet file upload servletfileupload is multipart content ismultipartcontent req dir path dirpath is multipart ismultipart logger error dir parameter multipart content req get parameter map getparametermap resp set status setstatus installation result installationresult result installation result installationresult dir parameter req get parameter map getparametermap multipart content result render resp get writer getwriter is multipart ismultipart install based on uploaded jar installbasedonuploadedjar req resp install based on directory installbasedondirectory resp file dir path dirpath install based on uploaded jar installbasedonuploadedjar http servlet request httpservletrequest req http servlet response httpservletresponse resp io exception ioexception installation result installationresult result disk file item factory diskfileitemfactory factory disk file item factory diskfileitemfactory hold largish bundles memory improve performance factory set size threshold setsizethreshold upload memory size threshold servlet file upload servletfileupload upload servlet file upload servletfileupload upload set file item factory setfileitemfactory factory suppress warnings suppresswarnings unchecked list file item fileitem items upload parse request parserequest req items size log and write error logandwriteerror items size items process updating bundle supported resp file item fileitem item items jar input stream jarinputstream jar input stream inputstream raw input rawinput jar jar input stream jarinputstream item get input stream getinputstream manifest manifest jar get manifest getmanifest manifest log and write error logandwriteerror uploaded jar file manifest resp string symbolic name symbolicname manifest get main attributes getmainattributes get value getvalue constants bundle symbolicname symbolic name symbolicname log and write error logandwriteerror manifest constants bundle symbolicname resp string version manifest get main attributes getmainattributes get value getvalue constants bundle version jar input stream jarinputstream validation fresh input stream updating raw input rawinput item get input stream getinputstream bundle get bundle getbundle symbolic name symbolicname install or update bundle installorupdatebundle raw input rawinput input stream inputstream symbolic name symbolicname version jar result installation result installationresult resp set status setstatus result render resp get writer getwriter bundle exception bundleexception log and write error logandwriteerror unable install update bundle symbolic name symbolicname resp io utils ioutils close quietly closequietly jar io utils ioutils close quietly closequietly raw input rawinput file upload exception fileuploadexception log and write error logandwriteerror failed parsing uploaded bundle resp log and write error logandwriteerror string message http servlet response httpservletresponse resp io exception ioexception logger info message resp set status setstatus installation result installationresult message render resp get writer getwriter log and write error logandwriteerror string message exception http servlet response httpservletresponse resp io exception ioexception logger info message resp set status setstatus installation result installationresult message get message getmessage render resp get writer getwriter install based on directory installbasedondirectory http servlet response httpservletresponse resp file dir file not found exception filenotfoundexception io exception ioexception installation result installationresult result dir exists dir is directory isdirectory logger info checking dir bundle install dir file manifest file manifestfile file dir jar file jarfile manifest manifest file manifestfile exists file input stream fileinputstream fis fis file input stream fileinputstream manifest file manifestfile manifest manifest fis string symbolic name symbolicname get main attributes getmainattributes get value getvalue constants bundle symbolicname symbolic name symbolicname search bundle bundle get bundle getbundle symbolic name symbolicname file temp file tempfile file create temp file createtempfile dir get name getname bundle create jar createjar dir temp file tempfile input stream inputstream file input stream fileinputstream temp file tempfile string location dir get absolute path getabsolutepath install or update bundle installorupdatebundle location result installation result installationresult resp set status setstatus result render resp get writer getwriter bundle exception bundleexception log and write error logandwriteerror unable install update bundle dir dir resp temp file tempfile delete log and write error logandwriteerror manifest dir symbolic resp io utils ioutils close quietly closequietly fis result installation result installationresult dir dir manifest log and write error logandwriteerror dir dir manifest resp result installation result installationresult dir dir exist log and write error logandwriteerror dir dir exist resp install or update bundle installorupdatebundle bundle bundle input stream inputstream string location bundle exception bundleexception bundle update bundle update install bundle bundle context bundlecontext install bundle installbundle location start account removed packages updated bundles newly satisfied optional imports installed bundles package admin packageadmin refresh packages refreshpackages bundle bundle bundle get bundle getbundle string symbolic name symbolicname bundle bundle bundle context bundlecontext get bundles getbundles symbolic name symbolicname equals get symbolic name getsymbolicname create jar createjar file source dir sourcedir file jar file jarfile manifest io exception ioexception jar output stream jaroutputstream zos jar output stream jaroutputstream file output stream fileoutputstream jar file jarfile zos set level setlevel def later deflater compression manifest zip entry zipentry an entry anentry zip entry zipentry jar file jarfile manifest zos put next entry putnextentry an entry anentry write zos zos close entry closeentry zip dir zipdir source dir sourcedir zos zos close io exception ioexception ignore zip dir zipdir file source dir sourcedir zip output stream zipoutputstream zos string path io exception ioexception read buffer readbuffer bytes in bytesin file source dir sourcedir list files listfiles is directory isdirectory string prefix path get name getname zos put next entry putnextentry zip entry zipentry prefix zip dir zipdir zos prefix string entry path get name getname jar file jarfile manifest equals entry file input stream fileinputstream fis file input stream fileinputstream zip entry zipentry an entry anentry zip entry zipentry entry zos put next entry putnextentry an entry anentry bytes in bytesin fis read read buffer readbuffer zos write read buffer readbuffer bytes in bytesin fis close