licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling testing mock osgi org junit assert equals assertequals org junit assert null assertnull org junit assert same assertsame org apache sling testing mock osgi osgi service util test osgiserviceutiltest service osgi r osgir org apache sling testing mock osgi osgi service util test osgiserviceutiltest service interface serviceinterface org apache sling testing mock osgi osgi service util test osgiserviceutiltest service interface serviceinterface optional org apache sling testing mock osgi osgi service util test osgiserviceutiltest service interface serviceinterface org apache sling testing mock osgi osgi service util test osgiserviceutiltest service interface serviceinterface org apache sling testing mock osgi osgi service util test osgiserviceutiltest service super interface servicesuperinterface org junit org junit test org junit runner run with runwith org mockito mock org mockito run ners runners mockito unit runner mockitojunitrunner org osgi framework bundle context bundlecontext org osgi framework service registration serviceregistration google common collect immutable map immutablemap google common collect immutable set immutableset run with runwith mockito unit runner mockitojunitrunner mock bundle context dynamic refer nces osgi r mockbundlecontextdynamicreferncesosgir test bundle context bundlecontext bundle context bundlecontext service osgi r osgir service service registration serviceregistration reg service registration serviceregistration reg mock service interface serviceinterface dependency mock service interface serviceinterface dependency mock service interface serviceinterface optional dependency a optional aoptional mock service interface serviceinterface optional dependency b optional boptional mock service interface serviceinterface dependency mock service interface serviceinterface dependency mock service super interface servicesuperinterface dependency mock service super interface servicesuperinterface dependency set up setup bundle context bundlecontext mock osgi mockosgi new bundle context newbundlecontext setup service instance minimum mandatory references reg bundle context bundlecontext register service registerservice service interface serviceinterface get name getname dependency reg bundle context bundlecontext register service registerservice service interface serviceinterface get name getname dependency service service osgi r osgir mock osgi mockosgi inject services injectservices service bundle context bundlecontext mock osgi mockosgi activate service bundle context bundlecontext bundle context bundlecontext register service registerservice service osgi r osgir get name getname service assert dependency assertdependency dependency assert dependency assertdependency optional assert dependencies assertdependencies dependency assert dependencies assertdependencies test test add remove optional unary service testaddremoveoptionalunaryservice service registration serviceregistration reg a optional aoptional bundle context bundlecontext register service registerservice service interface serviceinterface optional get name getname dependency a optional aoptional assert dependency assertdependency optional dependency a optional aoptional reg a optional aoptional unregister assert dependency assertdependency optional test add optional unary service testaddoptionalunaryservice too many toomany bundle context bundlecontext register service registerservice service interface serviceinterface optional get name getname dependency a optional aoptional assert dependency assertdependency optional dependency a optional aoptional real osg i osgi fail covered current implementation test real implementation bundle context bundlecontext register service registerservice service interface serviceinterface optional get name getname dependency b optional boptional assert dependency assertdependency optional dependency b optional boptional test expected reference violation exception referenceviolationexception test add mandatory unary service testaddmandatoryunaryservice too many toomany bundle context bundlecontext register service registerservice service interface serviceinterface get name getname dependency test expected reference violation exception referenceviolationexception test remove mandatory unary service testremovemandatoryunaryservice too many toomany reg unregister test test add remove optional multiple service testaddremoveoptionalmultipleservice service registration serviceregistration reg bundle context bundlecontext register service registerservice service interface serviceinterface get name getname dependency assert dependencies assertdependencies dependency service registration serviceregistration reg bundle context bundlecontext register service registerservice service interface serviceinterface get name getname dependency assert dependencies assertdependencies dependency dependency reg unregister assert dependencies assertdependencies dependency reg unregister assert dependencies assertdependencies test test add remove mandatory multiple service testaddremovemandatorymultipleservice service registration serviceregistration reg bundle context bundlecontext register service registerservice service interface serviceinterface get name getname dependency assert dependencies assertdependencies dependency dependency reg unregister assert dependencies assertdependencies dependency real osg i osgi fail covered current implementation test real implementation reg unregister assert dependencies assertdependencies test test reference with target filter testreferencewithtargetfilter assert dependencies assertdependencies filtered bundle context bundlecontext register service registerservice service interface serviceinterface get name getname dependency map util maputil to dictionary todictionary immutable map immutablemap string object prop abc bundle context bundlecontext register service registerservice service interface serviceinterface get name getname dependency map util maputil to dictionary todictionary immutable map immutablemap string object prop def assert dependencies assertdependencies filtered dependency assert dependency assertdependency service interface serviceinterface instance instance assert null assertnull service get reference getreference assert same assertsame instance service get reference getreference assert dependency assertdependency optional service interface serviceinterface optional instance instance assert null assertnull service get reference getreference optional assert same assertsame instance service get reference getreference optional assert dependencies assertdependencies service interface serviceinterface instances assert equals assertequals immutable set immutableset service interface serviceinterface copy of copyof instances immutable set immutableset service interface serviceinterface copy of copyof service get references getreferences assert dependencies assertdependencies service super interface servicesuperinterface instances assert equals assertequals immutable set immutableset service super interface servicesuperinterface copy of copyof instances immutable set immutableset service super interface servicesuperinterface copy of copyof service get references getreferences assert dependencies assertdependencies filtered service super interface servicesuperinterface instances assert equals assertequals immutable set immutableset service super interface servicesuperinterface copy of copyof instances immutable set immutableset service super interface servicesuperinterface copy of copyof service get references getreferences filtered