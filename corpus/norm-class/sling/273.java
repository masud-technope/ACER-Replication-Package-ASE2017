licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling jcr content loader contentloader internal java io exception ioexception java input stream inputstream java unsupported encoding exception unsupportedencodingexception java net url java net url connection urlconnection java net url decoder urldecoder java util array list arraylist java util calendar java util collections java util enumeration java util hash map hashmap java util iterator java util linked list linkedlist java util list java util map java util string tokenizer stringtokenizer javax jcr item javax jcr no such workspace exception nosuchworkspaceexception javax jcr node javax jcr repository exception repositoryexception javax jcr session org apache commons io utils ioutils org apache sling jcr content loader contentloader content reader contentreader org osgi framework bundle org slf logger org slf logger factory loggerfactory code bundle content loader bundlecontentloader code loads initial content bundle bundle content loader bundlecontentloader base import loader baseimportloader string parent descriptor root logger log logger factory loggerfactory get logger getlogger bundle content loader bundlecontentloader bundle helper bundlehelper bundle helper bundlehelper bundles registration failed ret ried retried list bundle delayed bundles delayedbundles bundle content loader bundlecontentloader bundle helper bundlehelper bundle helper bundlehelper content reader whiteboard contentreaderwhiteboard content reader whiteboard contentreaderwhiteboard content reader whiteboard contentreaderwhiteboard bundle helper bundlehelper bundle helper bundlehelper delayed bundles delayedbundles linked list linkedlist bundle dispose delayed bundles delayedbundles delayed bundles delayedbundles clear delayed bundles delayedbundles bundle helper bundlehelper register bundle install content param metadata session metadatasession param bundle repository exception repositoryexception register bundle registerbundle session metadata session metadatasession bundle bundle is update isupdate repository exception repositoryexception update uninstall content is update isupdate unregister bundle unregisterbundle metadata session metadatasession bundle log debug registering bundle content loading bundle get symbolic name getsymbolicname register bundle internal registerbundleinternal metadata session metadatasession bundle is update isupdate handle delayed bundles current size currentsize delayed bundles delayedbundles size current size currentsize delayed bundles delayedbundles size delayed bundles delayedbundles is empty isempty iterator bundle delayed bundles delayedbundles iterator has next hasnext bundle delayed register bundle internal registerbundleinternal metadata session metadatasession delayed remove current size currentsize delayed bundles delayedbundles size is update isupdate add delayed bundles update delayed bundles delayedbundles add bundle register bundle internal registerbundleinternal session metadata session metadatasession bundle bundle is retry isretry is update isupdate check bundle initial content iterator path entry pathentry path iter pathiter path entry pathentry get content paths getcontentpaths bundle path iter pathiter log debug bundle initial content bundle get symbolic name getsymbolicname bundle helper bundlehelper create repository path createrepositorypath metadata session metadatasession content loader service contentloaderservice bundle content node check content loaded map string object bundle content info bundlecontentinfo bundle helper bundlehelper get bundle content info getbundlecontentinfo metadata session metadatasession bundle don info loading bundle content info bundlecontentinfo success list string created nodes creatednodes content already loaded contentalreadyloaded bundle content info bundlecontentinfo content loader service contentloaderservice property content loaded boolean value booleanvalue is bundle updated isbundleupdated calendar last loaded at lastloadedat calendar bundle content info bundlecontentinfo content loader service contentloaderservice property content loaded last loaded at lastloadedat assumes bundle installed updated content loaded last loaded at lastloadedat get time in millis gettimeinmillis bundle get last modified getlastmodified is bundle updated isbundleupdated is update isupdate is bundle updated isbundleupdated content already loaded contentalreadyloaded log info content bundle loaded bundle get symbolic name getsymbolicname created nodes creatednodes install content installcontent metadata session metadatasession bundle path iter pathiter content already loaded contentalreadyloaded is bundle updated isbundleupdated is retry isretry log success retry log info retrying load initial content bundle succeeded bundle get symbolic name getsymbolicname success bundle helper bundlehelper unlock bundle content info unlockbundlecontentinfo metadata session metadatasession bundle success created nodes creatednodes repository exception repositoryexception is retry isretry log error load initial content bundle bundle get symbolic name getsymbolicname get message getmessage unregister bundle remove installed content param bundle bundle unregister bundle unregisterbundle session session bundle bundle delayed bundles delayedbundles bundle delayed bundles delayedbundles remove bundle bundle helper bundlehelper create repository path createrepositorypath session content loader service contentloaderservice bundle content node map string object bundle content info bundlecontentinfo bundle helper bundlehelper get bundle content info getbundlecontentinfo session bundle bundle uninstalled bundle content info bundlecontentinfo uninstall content uninstallcontent session bundle string bundle content info bundlecontentinfo content loader service contentloaderservice property uninstall paths bundle helper bundlehelper content is uninstalled contentisuninstalled session bundle bundle helper bundlehelper unlock bundle content info unlockbundlecontentinfo session bundle repository exception repositoryexception log error remove initial content bundle bundle get symbolic name getsymbolicname get message getmessage internal install content bundle content removed uninstall list top nodes list string install content installcontent session default session defaultsession bundle bundle iterator path entry pathentry path iter pathiter content already loaded contentalreadyloaded repository exception repositoryexception list string created nodes creatednodes array list arraylist string map string session created sessions createdsessions hash map hashmap string session log debug ins talling installing initial content bundle bundle get symbolic name getsymbolicname default content creator defaultcontentcreator content creator contentcreator default content creator defaultcontentcreator bundle helper bundlehelper path iter pathiter has next hasnext path entry pathentry path entry pathentry path iter pathiter content already loaded contentalreadyloaded path entry pathentry is overwrite isoverwrite string workspace path entry pathentry get workspace getworkspace session target session targetsession workspace created sessions createdsessions contains key containskey workspace target session targetsession created sessions createdsessions workspace target session targetsession create session createsession workspace created sessions createdsessions workspace target session targetsession target session targetsession default session defaultsession node target node targetnode get target node gettargetnode target session targetsession path entry pathentry get target gettarget target node targetnode install from path installfrompath bundle path entry pathentry get path getpath path entry pathentry target node targetnode path entry pathentry is uninstall isuninstall created nodes creatednodes content creator contentcreator optimize created nodes list collections sort created nodes creatednodes created nodes creatednodes size iterator string created nodes creatednodes iterator string previous has next hasnext string current current starts with startswith previous remove previous current persist modifications default session defaultsession refresh default session defaultsession save session session created sessions createdsessions values session refresh session save check version able versionable nodes node version able versionable content creator contentcreator get version ables getversionables version able versionable check in checkin default session defaultsession has pending changes haspendingchanges default session defaultsession refresh session session created sessions createdsessions values session has pending changes haspendingchanges session refresh repository exception repositoryexception log warn failure rollback partial initial content bundle bundle get symbolic name getsymbolicname content creator contentcreator clear session session created sessions createdsessions values session log out logout log debug installing initial content bundle bundle get symbolic name getsymbolicname created nodes creatednodes handle content installation single path param bundle bundle content param path path param configuration param parent parent node param created nodes creatednodes optional list store nodes list uninstall repository exception repositoryexception install from path installfrompath bundle bundle string path path entry pathentry configuration node parent list string created nodes creatednodes default content creator defaultcontentcreator content creator contentcreator repository exception repositoryexception init content creator content creator contentcreator init configuration get content read ers getcontentreaders created nodes creatednodes map string node processed entries processedentries hash map hashmap string node suppress warnings suppresswarnings unchecked enumeration string entries bundle get entry paths getentrypaths path entries check single content url bundle get entry getentry path log info install initial content entries bundle path bundle get symbolic name getsymbolicname single file content check content reader extension string ext content creator contentcreator get content read ers getcontentreaders key set keyset path ends with endswith ext handle file handlefile path bundle processed entries processedentries configuration parent created nodes creatednodes content creator contentcreator potential parent node extension url parent node descriptor parentnodedescriptor import parent node importparentnode bundle path parent content creator contentcreator parent node descriptor parentnodedescriptor processed entries processedentries parent node descriptor parentnodedescriptor to string tostring parent entries has more elements hasmoreelements string entry entries next element nextelement log debug processing initial content entry bundle entry bundle get symbolic name getsymbolicname entry ends with endswith dir check node descriptor create dir string base entry substring entry length url node descriptor nodedescriptor string ext content creator contentcreator get content read ers getcontentreaders key set keyset node descriptor nodedescriptor bundle get entry getentry base ext node descriptor nodedescriptor descriptor processed call create folder createfolder creates folder returns existing node created descriptor string get name getname base node node node descriptor nodedescriptor node processed entries processedentries node descriptor nodedescriptor to string tostring node node create node createnode parent node descriptor nodedescriptor content creator contentcreator configuration processed entries processedentries node descriptor nodedescriptor to string tostring node node create folder createfolder parent configuration is overwrite isoverwrite walk node install from path installfrompath bundle entry configuration node created nodes creatednodes content creator contentcreator file create file handle file handlefile entry bundle processed entries processedentries configuration parent created nodes creatednodes content creator contentcreator handle file entry param entry param bundle param processed entries processedentries param configuration param parent param created nodes creatednodes repository exception repositoryexception handle file handlefile string entry bundle bundle map string node processed entries processedentries path entry pathentry configuration node parent list string created nodes creatednodes default content creator defaultcontentcreator content creator contentcreator repository exception repositoryexception url file bundle get entry getentry entry string get name getname entry processed entries processedentries contains key containskey file to string tostring consumed node descriptor check node descriptor url node descriptor nodedescriptor string ext content creator contentcreator get content read ers getcontentreaders key set keyset node descriptor nodedescriptor bundle get entry getentry entry ext node descriptor nodedescriptor install descriptor found reader foundreader get content reader getcontentreader entry configuration node node found reader foundreader node create node createnode parent file content creator contentcreator configuration node log debug created node node get path getpath processed entries processedentries file to string tostring node log warn node created file file log debug find content reader entry entry place file node create file createfile configuration parent file created nodes creatednodes content creator contentcreator node parent get node getnode io exception ioexception ioe log warn create file node file ioe process node descriptor nodedescriptor processed entries processedentries contains key containskey node descriptor nodedescriptor to string tostring content creator contentcreator set ignore overwrite flag setignoreoverwriteflag node create node createnode parent node descriptor nodedescriptor content creator contentcreator configuration processed entries processedentries node descriptor nodedescriptor to string tostring node content creator contentcreator set ignore overwrite flag setignoreoverwriteflag repository exception repositoryexception log error failed process file file create node content resource bundle param parent parent node param content node param resource url resourceurl resource url param content creator contentcreator content creator param configuration configuration node created repository exception repositoryexception node create node createnode node parent string url resource url resourceurl default content creator defaultcontentcreator content creator contentcreator path entry pathentry configuration repository exception repositoryexception string resource path resourcepath resource url resourceurl get path getpath to lower case tolowercase input stream inputstream content stream contentstream special treatment system view imports resource path resourcepath ends with endswith ext jcr xml content stream contentstream resource url resourceurl open stream openstream import jcr xml importjcrxml parent content stream contentstream node reader resource content reader contentreader node reader nodereader get content reader getcontentreader resource path resourcepath configuration find type node reader nodereader string content reader extension contentreaderextension get content reader extension getcontentreaderextension content creator contentcreator prepare parsing prepareparsing parent to plain name toplainname content reader extension contentreaderextension node reader nodereader parse resource url resourceurl content creator contentcreator content creator contentcreator get created root node getcreatedrootnode repository exception repositoryexception throwable repository exception repositoryexception get message getmessage io utils ioutils close quietly closequietly content stream contentstream create folder param parent parent node param folder param overwrite existing folder removed node pointing folder repository exception repositoryexception node create folder createfolder node parent string overwrite repository exception repositoryexception parent has node hasnode overwrite parent get node getnode remove parent get node getnode parent add node addnode sling folder create file url param configuration param parent param source param created nodes creatednodes param content creator contentcreator io exception ioexception repository exception repositoryexception create file createfile path entry pathentry configuration node parent url source list string created nodes creatednodes default content creator defaultcontentcreator content creator contentcreator io exception ioexception repository exception repositoryexception string src path srcpath source get path getpath pos src path srcpath last index of lastindexof string get name getname source get path getpath string path pos path path src path srcpath substring pos content creator contentcreator init configuration get content read ers getcontentreaders created nodes creatednodes content creator contentcreator prepare parsing prepareparsing parent url connection urlconnection conn source open connection openconnection last modified lastmodified math min conn get last modified getlastmodified configuration get last modified getlastmodified string type conn get content type getcontenttype input stream inputstream data conn get input stream getinputstream content creator contentcreator create file and resource node createfileandresourcenode path data type last modified lastmodified content creator contentcreator finish node finishnode content creator contentcreator finish node finishnode decodes code path code path slash complete path slash contained support names unsupported characters colon code code names url encoded code java net url encoder urlencoder code utf character encoding method decodes code java net url decoder urldecoder code utf character encoding param path path extract url decoded string get name getname string path last slash lastslash path last index of lastindexof string last slash lastslash path path substring last slash lastslash encoded characters decode index of indexof url decoder urldecoder decode utf unsupported encoding exception unsupportedencodingexception uee log error decode platform support utf undecoded exception log error decode undecoded encoded problems decoding unmodified node get target node gettargetnode session session string path repository exception repositoryexception path directive path session get root node getrootnode path starts with startswith relative path absolute path path session item exists itemexists path node current node currentnode session get root node getrootnode string tokenizer stringtokenizer string tokenizer stringtokenizer path substring has more tokens hasmoretokens string next token nexttoken current node currentnode has node hasnode current node currentnode add node addnode sling folder current node currentnode current node currentnode get node getnode current node currentnode item item session get item getitem path item is node isnode node item uninstall content uninstallcontent session default session defaultsession bundle bundle string uninstall paths uninstallpaths map string session created sessions createdsessions hash map hashmap string session log debug uninstalling initial content bundle bundle get symbolic name getsymbolicname uninstall paths uninstallpaths uninstall paths uninstallpaths length string path uninstall paths uninstallpaths session target session targetsession ws sep pos wsseppos path index of indexof ws sep pos wsseppos string workspace name workspacename path substring ws sep pos wsseppos path path substring ws sep pos wsseppos workspace name workspacename equals default session defaultsession get workspace getworkspace get name getname target session targetsession default session defaultsession created sessions createdsessions contains key containskey workspace name workspacename target session targetsession created sessions createdsessions workspace name workspacename target session targetsession create session createsession workspace name workspacename created sessions createdsessions workspace name workspacename target session targetsession target session targetsession default session defaultsession target session targetsession item exists itemexists path target session targetsession get item getitem path remove persist modifications default session defaultsession save session session created sessions createdsessions values session save log debug uninstalling initial content bundle bundle get symbolic name getsymbolicname repository exception repositoryexception log error unable uninstall initial content bundle bundle get symbolic name getsymbolicname default session defaultsession has pending changes haspendingchanges default session defaultsession refresh session session created sessions createdsessions values session has pending changes haspendingchanges session refresh repository exception repositoryexception log warn failure rollback uninstalling initial content bundle bundle get symbolic name getsymbolicname session session created sessions createdsessions values session log out logout descriptor url url content reader contentreader content reader contentreader parent node descriptor root descriptor get parent node descriptor getparentnodedescriptor bundle bundle string path default content creator defaultcontentcreator content creator contentcreator map entry string content reader contentreader entry content creator contentcreator get content read ers getcontentreaders entry set entryset entry get value getvalue string builder stringbuilder file path filepath string builder stringbuilder path path ends with endswith file path filepath append file path filepath append parent descriptor add file extension jcr xml xml zip base import loader baseimportloader file path filepath append entry get key getkey url url bundle get entry getentry file path filepath to string tostring url descriptor descriptor descriptor descriptor url url descriptor content reader contentreader entry get value getvalue descriptor imports mixin nodes properties option ally optionally child nodes parent node url import parent node importparentnode bundle bundle string path node parent default content creator defaultcontentcreator content creator contentcreator repository exception repositoryexception descriptor descriptor get parent node descriptor getparentnodedescriptor bundle path content creator contentcreator parent descriptor root descriptor content creator contentcreator prepare parsing prepareparsing parent descriptor content reader contentreader parse descriptor url content creator contentcreator descriptor url repository exception repositoryexception throwable repository exception repositoryexception get message getmessage session create session createsession string workspace repository exception repositoryexception bundle helper bundlehelper get session getsession workspace no such workspace exception nosuchworkspaceexception session temp bundle helper bundlehelper get session getsession temp get workspace getworkspace create workspace createworkspace workspace temp log out logout bundle helper bundlehelper get session getsession workspace