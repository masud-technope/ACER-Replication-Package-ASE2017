licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling discovery base connectors announcement java util collection java util hash map hashmap java util iterator java util linked list linkedlist java util map java util map entry org apache felix scr annotations activate org apache felix scr annotations component org apache felix scr annotations reference org apache felix scr annotations service org apache sling api resource login exception loginexception org apache sling api resource persistence exception persistenceexception org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling api resource resource resolver factory resourceresolverfactory org apache sling api resource value map valuemap org apache sling commons json json exception jsonexception org apache sling discovery cluster view clusterview org apache sling discovery instance description instancedescription org apache sling discovery base connectors base config baseconfig org apache sling discovery commons providers util resource helper resourcehelper org apache sling settings sling settings service slingsettingsservice org slf logger org slf logger factory loggerfactory implementation announcement registry announcementregistry handles json backed announcements storing local discovery impl cluster nodes clusternodes sling id slingid announcement component service announcement registry announcementregistry announcement registry impl announcementregistryimpl announcement registry announcementregistry logger logger logger factory loggerfactory get logger getlogger get class getclass reference resource resolver factory resourceresolverfactory resource resolver factory resourceresolverfactory reference sling settings service slingsettingsservice settings service settingsservice string sling id slingid reference base config baseconfig config announcement registry impl announcementregistryimpl test constructor and activate testconstructorandactivate resource resolver factory resourceresolverfactory resource resolver factory resourceresolverfactory sling settings service slingsettingsservice sling settings service slingsettingsservice base config baseconfig config announcement registry impl announcementregistryimpl registry test constructor testconstructor resource resolver factory resourceresolverfactory sling settings service slingsettingsservice config registry activate registry announcement registry impl announcementregistryimpl test constructor testconstructor resource resolver factory resourceresolverfactory resource resolver factory resourceresolverfactory sling settings service slingsettingsservice sling settings service slingsettingsservice base config baseconfig config announcement registry impl announcementregistryimpl registry announcement registry impl announcementregistryimpl registry resource resolver factory resourceresolverfactory resource resolver factory resourceresolverfactory registry settings service settingsservice sling settings service slingsettingsservice registry config config registry activate activate sling id slingid settings service settingsservice get sling id getslingid map string cached announcement cachedannouncement own announcements cache ownannouncementscache hash map hashmap string cached announcement cachedannouncement unregister announcement unregisterannouncement string owner id ownerid owner id ownerid owner id ownerid length illegal argument exception illegalargumentexception owner id ownerid empty remove cache error own announcements cache ownannouncementscache remove owner id ownerid resource resolver factory resourceresolverfactory logger error unregister announcement unregisterannouncement resource resolver factory resourceresolverfactory resource resolver resourceresolver resource resolver resourceresolver resource resolver resourceresolver resource resolver factory resourceresolverfactory get administrative resource resolver getadministrativeresourceresolver string path config get cluster instances path getclusterinstancespath sling id slingid announcements owner id ownerid resource announcements resource announcementsresource resource resolver resourceresolver get resource getresource path announcements resource announcementsresource resource resolver resourceresolver delete announcements resource announcementsresource resource resolver resourceresolver commit login exception loginexception logger error unregister announcement unregisterannouncement log administratively runtime exception runtimeexception log repository persistence exception persistenceexception logger error unregister announcement unregisterannouncement persistence exception persistenceexception runtime exception runtimeexception exception talking repository resource resolver resourceresolver resource resolver resourceresolver close collection announcement list local announcements listlocalannouncements fill with cached announcements fillwithcachedannouncements linked list linkedlist announcement collection cached announcement cachedannouncement list local incoming announcements listlocalincomingannouncements collection cached announcement cachedannouncement result linked list linkedlist cached announcement cachedannouncement own announcements cache ownannouncementscache values iterator cached announcement cachedannouncement result iterator has next hasnext cached announcement cachedannouncement cached announcement cachedannouncement cached announcement cachedannouncement get announcement getannouncement is inherited isinherited remove cached announcement cachedannouncement has expired hasexpired remove result instance description instancedescription get local instance description getlocalinstancedescription cluster view clusterview local cluster view localclusterview iterator instance description instancedescription local cluster view localclusterview get instances getinstances iterator has next hasnext instance description instancedescription is local islocal collection announcement list announcements in same cluster listannouncementsinsamecluster cluster view clusterview local cluster view localclusterview logger debug list announcements in same cluster listannouncementsinsamecluster start local cluster view localclusterview local cluster view localclusterview local cluster view localclusterview illegal argument exception illegalargumentexception cluster view clusterview resource resolver resourceresolver resource resolver resourceresolver collection announcement incoming announcements incomingannouncements linked list linkedlist announcement instance description instancedescription local instance localinstance get local instance description getlocalinstancedescription local cluster view localclusterview resource resolver resourceresolver resource resolver factory resourceresolverfactory get administrative resource resolver getadministrativeresourceresolver resource cluster instances resource clusterinstancesresource resource helper resourcehelper get or create resource getorcreateresource resource resolver resourceresolver config get cluster instances path getclusterinstancespath iterator resource cluster instances resource clusterinstancesresource get children getchildren iterator has next hasnext resource a cluster instance resource aclusterinstanceresource string instance id instanceid a cluster instance resource aclusterinstanceresource get name getname logger debug list announcements in same cluster listannouncementsinsamecluster handling cluster instance clusterinstance instance id instanceid local instance localinstance local instance localinstance get sling id getslingid equals instance id instanceid local instance serve cache logger debug list announcements in same cluster listannouncementsinsamecluster matched local instance localinstance filling cache instance id instanceid fill with cached announcements fillwithcachedannouncements incoming announcements incomingannouncements todo add cluster view clusterview instance sling id instanceslingid convenience api change local cluster view localclusterview instance id instanceid logger debug list announcements in same cluster listannouncementsinsamecluster instance view ignoring instance id instanceid corresponds earlier expiry handling resource announcements resource announcementsresource a cluster instance resource aclusterinstanceresource get child getchild announcements announcements resource announcementsresource logger debug list announcements in same cluster listannouncementsinsamecluster instance announcements instance id instanceid logger debug list announcements in same cluster listannouncementsinsamecluster instance announcements instance id instanceid iterator resource announcements resource announcementsresource get children getchildren iterator announcement topology announcement topologyannouncement has next hasnext resource an announcement anannouncement topology announcement topologyannouncement announcement fromjson an announcement anannouncement adapt to adaptto value map valuemap topology announcement topologyannouncement string logger debug list announcements in same cluster listannouncementsinsamecluster announcement topology announcement topologyannouncement incoming announcements incomingannouncements add topology announcement topologyannouncement sling longer check expired announcements fact instance cluster view clusterview live instance responsible cleaning expired announcements repository sling method read operations commit close block login exception loginexception logger error list announcements in same cluster listannouncementsinsamecluster log administratively runtime exception runtimeexception log repository persistence exception persistenceexception logger error list announcements in same cluster listannouncementsinsamecluster persistence exception persistenceexception runtime exception runtimeexception exception talking repository json exception jsonexception logger error list announcements in same cluster listannouncementsinsamecluster json exception jsonexception runtime exception runtimeexception exception converting json resource resolver resourceresolver resource resolver resourceresolver close logger is debug enabled isdebugenabled logger debug list announcements in same cluster listannouncementsinsamecluster result incoming announcements incomingannouncements size incoming announcements incomingannouncements collection announcement fill with cached announcements fillwithcachedannouncements collection announcement incoming announcements incomingannouncements iterator entry string cached announcement cachedannouncement own announcements cache ownannouncementscache entry set entryset iterator has next hasnext entry string cached announcement cachedannouncement entry entry get value getvalue has expired hasexpired filter incoming announcements incomingannouncements add entry get value getvalue get announcement getannouncement incoming announcements incomingannouncements cluster view clusterview cluster view clusterview string instance id instanceid iterator instance description instancedescription cluster view clusterview get instances getinstances iterator has next hasnext instance description instancedescription instance instance get sling id getslingid equals instance id instanceid fine instance view has active announcement hasactiveannouncement string owner id ownerid owner id ownerid owner id ownerid length illegal argument exception illegalargumentexception owner id ownerid empty owner id ownerid cached announcement cachedannouncement cached announcement cachedannouncement own announcements cache ownannouncementscache owner id ownerid cached announcement cachedannouncement cached announcement cachedannouncement has expired hasexpired register announcement registerannouncement announcement topology announcement topologyannouncement topology announcement topologyannouncement illegal argument exception illegalargumentexception topology announcement topologyannouncement topology announcement topologyannouncement is valid isvalid logger warn topology announcement topologyannouncement valid resource resolver factory resourceresolverfactory logger error register announcement registerannouncement resource resolver factory resourceresolverfactory cached announcement cachedannouncement cached announcement cachedannouncement own announcements cache ownannouncementscache topology announcement topologyannouncement get owner id getownerid cached announcement cachedannouncement logger is debug enabled isdebugenabled logger debug register announcement registerannouncement existing cached announcement owner id ownerid topology announcement topologyannouncement get owner id getownerid topology announcement topologyannouncement corresponds to correspondsto cached announcement cachedannouncement get announcement getannouncement changed announcement update heartbeat fine normal stable connector logger debug register announcement registerannouncement changed updating heartbeat memory cached announcement cachedannouncement register ping registerping topology announcement topologyannouncement config logger debug register announcement registerannouncement incoming announcement differs existing json exception jsonexception logger error register announcement registerannouncement json exception jsonexception converting incoming announcement json repository cache require updated reset ting resetting cache point own announcements cache ownannouncementscache remove topology announcement topologyannouncement get owner id getownerid logger debug register announcement registerannouncement cached announcement owner id ownerid topology announcement topologyannouncement get owner id getownerid logger debug register announcement registerannouncement list local announcements collection announcement announcements linked list linkedlist announcement fill with cached announcements fillwithcachedannouncements announcements logger is debug enabled isdebugenabled logger debug register announcement registerannouncement list returned announcements announcements size iterator announcement announcements iterator has next hasnext announcement announcement announcement get owner id getownerid equals topology announcement topologyannouncement get owner id getownerid owner skip analyse instances announcement include owner collection instance description instancedescription attached instances attachedinstances announcement list instances listinstances iterator instance description instancedescription attached instances attachedinstances iterator has next hasnext instance description instancedescription instance description instancedescription topology announcement topologyannouncement get owner id getownerid equals instance description instancedescription get sling id getslingid logger info register announcement registerannouncement instance attached instance description instancedescription get sling id getslingid resource resolver resourceresolver resource resolver resourceresolver resource resolver resourceresolver resource resolver factory resourceresolverfactory get administrative resource resolver getadministrativeresourceresolver resource announcements resource announcementsresource resource helper resourcehelper get or create resource getorcreateresource resource resolver resourceresolver config get cluster instances path getclusterinstancespath sling id slingid announcements topology announcement topologyannouncement persist to persistto announcements resource announcementsresource resource resolver resourceresolver commit own announcements cache ownannouncementscache topology announcement topologyannouncement get owner id getownerid cached announcement cachedannouncement topology announcement topologyannouncement config login exception loginexception logger error register announcement registerannouncement log administratively runtime exception runtimeexception log repository persistence exception persistenceexception logger error register announcement registerannouncement persistence exception persistenceexception runtime exception runtimeexception exception talking repository json exception jsonexception logger error register announcement registerannouncement json exception jsonexception runtime exception runtimeexception exception converting json resource resolver resourceresolver resource resolver resourceresolver close add all except addallexcept announcement target cluster view clusterview cluster view clusterview announcement filter announcementfilter filter resource resolver resourceresolver resource resolver resourceresolver resource resolver resourceresolver resource resolver factory resourceresolverfactory get administrative resource resolver getadministrativeresourceresolver resource cluster instances resource clusterinstancesresource resource helper resourcehelper get or create resource getorcreateresource resource resolver resourceresolver config get cluster instances path getclusterinstancespath iterator resource cluster instances resource clusterinstancesresource get children getchildren iterator resource announcements resource announcementsresource has next hasnext resource a cluster instance resource aclusterinstanceresource string instance id instanceid a cluster instance resource aclusterinstanceresource get name getname todo add cluster view clusterview instance sling id instanceslingid convenience api change cluster view clusterview instance id instanceid corresponds earlier expiry handling announcements resource announcementsresource a cluster instance resource aclusterinstanceresource get child getchild announcements announcements resource announcementsresource iterator resource announcements resource announcementsresource get children getchildren iterator has next hasnext resource an announcement anannouncement logger is debug enabled isdebugenabled logger debug add all except addallexcept an announcement anannouncement an announcement anannouncement announcement topology announcement topologyannouncement topology announcement topologyannouncement announcement fromjson an announcement anannouncement adapt to adaptto value map valuemap topology announcement topologyannouncement string filter filter accept a cluster instance resource aclusterinstanceresource get name getname topology announcement topologyannouncement target add incoming topology announcement addincomingtopologyannouncement topology announcement topologyannouncement sling method read operations commit close block login exception loginexception logger error handle event handleevent log administratively runtime exception runtimeexception log repository persistence exception persistenceexception logger error handle event handleevent persistence exception persistenceexception runtime exception runtimeexception exception talking repository json exception jsonexception logger error handle event handleevent json exception jsonexception runtime exception runtimeexception exception converting json resource resolver resourceresolver resource resolver resourceresolver close check expired announcements checkexpiredannouncements iterator entry string cached announcement cachedannouncement own announcements cache ownannouncementscache entry set entryset iterator has next hasnext entry string cached announcement cachedannouncement entry entry get value getvalue has expired hasexpired expiry remove string instance id instanceid entry get key getkey logger info check expired announcements checkexpiredannouncements topology connector instance id instanceid sling id slingid inherited entry get value getvalue get announcement getannouncement is inherited isinherited expired delete announcements of deleteannouncementsof instance id instanceid sling stale announcements repository crash action own announcements cache ownannouncementscache auth orative authorative announcements registered instance registry repository additional announcements resource resolver resourceresolver resource resolver resourceresolver resource resolver resourceresolver resource resolver factory resourceresolverfactory get administrative resource resolver getadministrativeresourceresolver resource announcements resource announcementsresource resource helper resourcehelper get or create resource getorcreateresource resource resolver resourceresolver config get cluster instances path getclusterinstancespath sling id slingid announcements iterator resource announcements resource announcementsresource get children getchildren iterator has next hasnext resource res string owner id ownerid res get name getname own announcements cache ownannouncementscache contains key containskey owner id ownerid fine leave announcement untouched announcement earlier inc a rnation incarnation instance stale remove sling resource helper resourcehelper delete resource deleteresource resource resolver resourceresolver res get path getpath resource resolver resourceresolver commit resource resolver resourceresolver close resource resolver resourceresolver login exception loginexception logger error check expired announcements checkexpiredannouncements log administratively checking expired announcements sling id slingid sling id slingid persistence exception persistenceexception logger error check expired announcements checkexpiredannouncements persistence exception persistenceexception checking expired announcements sling id slingid sling id slingid resource resolver resourceresolver resource resolver resourceresolver revert resource resolver resourceresolver close resource resolver resourceresolver delete announcements of deleteannouncementsof string instance id instanceid resource resolver resourceresolver resource resolver resourceresolver resource resolver resourceresolver resource resolver factory resourceresolverfactory get administrative resource resolver getadministrativeresourceresolver resource helper resourcehelper delete resource deleteresource resource resolver resourceresolver config get cluster instances path getclusterinstancespath sling id slingid announcements instance id instanceid resource resolver resourceresolver commit resource resolver resourceresolver close resource resolver resourceresolver login exception loginexception logger error delete announcements of deleteannouncementsof log administratively deleting announcements instance id instanceid instance id instanceid persistence exception persistenceexception logger error delete announcements of deleteannouncementsof persistence exception persistenceexception deleting announcements instance id instanceid instance id instanceid resource resolver resourceresolver resource resolver resourceresolver revert resource resolver resourceresolver close resource resolver resourceresolver collection instance description instancedescription list instances listinstances cluster view clusterview local cluster view localclusterview logger debug list instances listinstances start local cluster view localclusterview local cluster view localclusterview collection instance description instancedescription instances linked list linkedlist instance description instancedescription collection announcement announcements list announcements in same cluster listannouncementsinsamecluster local cluster view localclusterview announcements logger debug list instances listinstances announcement instances instances instances iterator announcement announcements iterator has next hasnext announcement announcement logger debug list instances listinstances adding announcement announcement instances add all addall announcement list instances listinstances logger debug list instances listinstances announcements instances instances instances