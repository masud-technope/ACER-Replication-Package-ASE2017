licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling jcr content loader contentloader internal junit x junitx util private accessor privateaccessor org apache sling commons testing jcr repository util repositoryutil org apache sling testing mock osgi mock bundle mockbundle org apache sling testing mock sling resource resolver type resourceresolvertype org apache sling testing mock sling junit sling context slingcontext org junit org junit rule org junit test org junit rules expected exception expectedexception org osgi framework bundle org osgi framework bundle event bundleevent javax jcr java util org junit org hamcrest core matchers corematchers org apache sling jcr content loader contentloader internal content loader service contentloaderservice content loader service test contentloaderservicetest rule sling context slingcontext context sling context slingcontext resource resolver type resourceresolvertype jcr oak rule expected exception expectedexception thrown expected exception expectedexception content loader service contentloaderservice under test undertest bundle content loader bundlecontentloader content loader contentloader session session setup exception whiteboard holds read ers readers context register inject activate service registerinjectactivateservice content reader white board contentreaderwhiteboard todo sling repository slingrepository registered box calling context resource resolver resourceresolver todo sling node types registered session context resource resolver resourceresolver adapt to adaptto session repository util repositoryutil register sling node types registerslingnodetypes session register content loader service under test undertest context register inject activate service registerinjectactivateservice content loader service contentloaderservice content loader contentloader bundle content loader bundlecontentloader private accessor privateaccessor get field getfield under test undertest bundle content loader bundlecontentloader content loader service contentloaderservice bundle changed bundlechanged bundle event bundleevent test method side method deep bundle content loader bundlecontentloader content loader service contentloaderservice test test bundle resolved bundle changed testbundleresolvedbundlechanged no such field exception nosuchfieldexception repository exception repositoryexception bundle bundle create new bundle createnewbundle list bundle delayed bundles delayedbundles list bundle private accessor privateaccessor get field getfield content loader contentloader delayed bundles delayedbundles string updated bundles updatedbundles string private accessor privateaccessor get field getfield under test undertest updated bundles updatedbundles updated bundles updatedbundles add bundle get symbolic name getsymbolicname updated bundles current amout updatedbundlescurrentamout updated bundles updatedbundles size under test undertest bundle changed bundlechanged bundle event bundleevent bundle event bundleevent resolved bundle check bundle removed updated bundles updatedbundles assert equals assertequals updated bundles current amout updatedbundlescurrentamout delayed bundles delayedbundles size updated bundles current amout updatedbundlescurrentamout updated bundles updatedbundles size under test undertest bundle changed bundlechanged bundle event bundleevent bundle event bundleevent updated bundle assert equals assertequals updated bundles current amout updatedbundlescurrentamout updated bundles updatedbundles size call method check exception occurs under test undertest bundle changed bundlechanged bundle event bundleevent bundle event bundleevent uninstalled bundle content loader service contentloaderservice bundle changed bundlechanged bundle event bundleevent test get content info from locked node getcontentinfofromlockednode repository exception repositoryexception bundle bundle create new bundle createnewbundle node bc node bcnode node session get item getitem content loader service contentloaderservice bundle content node bc node bcnode add node addnode bundle get symbolic name getsymbolicname add mixin addmixin mix lock able lockable session save bc node bcnode get node getnode bundle get symbolic name getsymbolicname lock assert null assertnull under test undertest get bundle content info getbundlecontentinfo session bundle test get content info from not lock able node getcontentinfofromnotlockablenode repository exception repositoryexception bundle bundle create new bundle createnewbundle node bc node bcnode node session get item getitem content loader service contentloaderservice bundle content node node lock able lockable mixin bc node bcnode add node addnode bundle get symbolic name getsymbolicname session save assert null assertnull under test undertest get bundle content info getbundlecontentinfo session bundle test get content info getcontentinfo repository exception repositoryexception bundle bundle create new bundle createnewbundle node bc node bcnode node session get item getitem content loader service contentloaderservice bundle content node node bundle content bundlecontent bc node bcnode add node addnode bundle get symbolic name getsymbolicname bundle content bundlecontent add mixin addmixin mix lock able lockable calendar calendar get instance getinstance bundle content bundlecontent set property setproperty property content loaded is loaded isloaded bundle content bundlecontent set property setproperty property content loaded is loaded isloaded string paths foo bar bundle content bundlecontent set property setproperty property uninstall paths paths session save map string object props under test undertest get bundle content info getbundlecontentinfo session bundle assert that assertthat content info contentinfo props not null value notnullvalue assert equals assertequals is loaded isloaded props property content loaded assert true asserttrue props contains key containskey property content loaded assert true asserttrue props contains key containskey property uninstall paths content loader service contentloaderservice content is uninstalled contentisuninstalled session bundle test test content is uninstalled testcontentisuninstalled repository exception repositoryexception bundle bundle create new bundle createnewbundle node bc node bcnode session get node getnode bundle content node add node addnode bundle get symbolic name getsymbolicname under test undertest content is uninstalled contentisuninstalled session bundle assert true asserttrue bc node bcnode has property hasproperty content unloaded assert true asserttrue bc node bcnode has property hasproperty content unload time assert false assertfalse bc node bcnode has property hasproperty property uninstall paths assert false assertfalse bc node bcnode get property getproperty property content loaded get boolean getboolean content loader service contentloaderservice get mime type getmimetype string test test mime type service testmimetypeservice assert equals assertequals audio mpeg under test undertest get mime type getmimetype test content loader service contentloaderservice get mime type getmimetype string test get session for workspace getsessionforworkspace repository exception repositoryexception assert not null assertnotnull under test undertest get session getsession bundle create new bundle createnewbundle mock bundle mockbundle mock bundle mockbundle context bundle context bundlecontext set symbolic name setsymbolicname unique id uniqueid string unique id uniqueid get class getclass get simple name getsimplename uuid randomuuid