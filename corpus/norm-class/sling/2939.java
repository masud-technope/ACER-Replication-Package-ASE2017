licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling installer factories sub systems subsystems base impl java file java file input stream fileinputstream java file not found exception filenotfoundexception java file output stream fileoutputstream java io exception ioexception java nio file files java nio file path java nio file standard copy option standardcopyoption java util array list arraylist java util collections java util hash map hashmap java util hash set hashset java util list java util map java util java util jar attributes java util jar jar file jarfile java util jar jar input stream jarinputstream java util jar manifest java util zip zip entry zipentry java util zip zip input stream zipinputstream java util zip zip output stream zipoutputstream org apache sling installer api installable resource installableresource org apache sling installer api tasks registered resource registeredresource org apache sling installer api tasks resource transformer resourcetransformer org apache sling installer api tasks transformation result transformationresult org apache sling settings sling settings service slingsettingsservice org osgi framework constants org osgi framework version org osgi framework namespace identity name space identitynamespace org osgi service subsystem subsystem constants subsystemconstants org slf logger org slf logger factory loggerfactory subsystem base transformer subsystembasetransformer resource transformer resourcetransformer string potential bundles potential bundles string type subsystem base subsystem base logger logger logger factory loggerfactory get logger getlogger get class getclass sling settings service slingsettingsservice sling settings slingsettings subsystem base transformer subsystembasetransformer sling settings service slingsettingsservice settings sling settings slingsettings settings transformation result transformationresult transform registered resource registeredresource resource todo start level subsystem resource get type gettype equals installable resource installableresource type file resource geturl ends with endswith type subsystem base logger info subsystem base resource resource subsystem data subsystemdata ssd create subsystem file createsubsystemfile resource transformation result transformationresult transformation result transformationresult attributes mf attributes mfattributes ssd manifest get main attributes getmainattributes set id setid mf attributes mfattributes get value getvalue subsystem constants subsystemconstants subsystem symbolicname set version setversion version mf attributes mfattributes get value getvalue subsystem constants subsystemconstants subsystem version set resource type setresourcetype esa set input stream setinputstream delete on close file input stream deleteonclosefileinputstream ssd file map string object attr hash map hashmap string object attr subsystem constants subsystemconstants subsystem symbolicname mf attributes mfattributes get value getvalue subsystem constants subsystemconstants subsystem symbolicname attr subsystem constants subsystemconstants subsystem version mf attributes mfattributes get value getvalue subsystem constants subsystemconstants subsystem version set attributes setattributes attr transformation result transformationresult io exception ioexception ioe logger error problem processing subsystem base file resource ioe subsystem data subsystemdata create subsystem file createsubsystemfile registered resource registeredresource resource io exception ioexception subsystem data subsystemdata data subsystem data subsystemdata string builder stringbuilder subsystem content subsystemcontent string builder stringbuilder jar input stream jarinputstream jis jar input stream jarinputstream resource get input stream getinputstream manifest run modes manifest runmodesmanifest jis get manifest getmanifest string run mode resources runmoderesources process run modes manifest processrunmodesmanifest run modes manifest runmodesmanifest file file create temp file createtempfile sling generated esa delete on exit deleteonexit data file zip output stream zipoutputstream zos zip output stream zipoutputstream file output stream fileoutputstream zip entry zipentry zie zie jis get next entry getnextentry string zie name ziename zie get name getname subsystem manifest base equals zie name ziename data manifest manifest jis run mode resources runmoderesources zie name ziename zie name ziename zie name ziename substring potential bundles length handle subsystem artifact handlesubsystemartifact zie name ziename jis zos subsystem content subsystemcontent data manifest get main attributes getmainattributes put value putvalue subsystem constants subsystemconstants subsystem content subsystem content subsystemcontent to string tostring zip entry zipentry zoe zip entry zipentry osgi inf subsystem zos put next entry putnextentry zoe data manifest write zos zos close entry closeentry data string process run modes manifest processrunmodesmanifest manifest run modes manifest runmodesmanifest string res hash set hashset attributes attrs run modes manifest runmodesmanifest get main attributes getmainattributes res add all addall parse manifest header parsemanifestheader attrs string sling settings slingsettings get run modes getrunmodes res add all addall parse manifest header parsemanifestheader attrs res list string parse manifest header parsemanifestheader attributes attrs string key list string res array list arraylist string val attrs get value getvalue key val collections empty list emptylist string val split length res add res handle subsystem artifact handlesubsystemartifact string artifact name artifactname zip input stream zipinputstream zis zip output stream zipoutputstream zos string builder stringbuilder subsystem content subsystemcontent io exception ioexception idx artifact name artifactname index of indexof idx artifact name artifactname last index of lastindexof idx idx idx io exception ioexception invalid entry format num artifact jar artifact name artifactname start order startorder integer parse int parseint artifact name artifactname substring idx idx artifact name artifactname length idx file temp artifact tempartifact file create temp file createtempfile sling generated tmp temp artifact tempartifact delete on exit deleteonexit path temp path temppath temp artifact tempartifact to path topath files copy zis temp path temppath standard copy option standardcopyoption replace existing jar file jarfile jar file jarfile temp artifact tempartifact attributes get manifest getmanifest get main attributes getmainattributes string bsn get value getvalue constants bundle symbolicname string version get value getvalue constants bundle version version version string type get value getvalue constants fragment host identity name space identitynamespace type fragment identity name space identitynamespace type bundle bsn subsystem content subsystemcontent length subsystem content subsystemcontent append subsystem content subsystemcontent append bsn subsystem content subsystemcontent append subsystem content subsystemcontent append identity name space identitynamespace capability version attribute subsystem content subsystemcontent append subsystem content subsystemcontent append version subsystem content subsystemcontent append subsystem content subsystemcontent append identity name space identitynamespace capability type attribute subsystem content subsystemcontent append subsystem content subsystemcontent append type subsystem content subsystemcontent append subsystem content subsystemcontent append subsystem constants subsystemconstants start order directive subsystem content subsystemcontent append subsystem content subsystemcontent append start order startorder exception zip entry zipentry zoe zip entry zipentry artifact name artifactname substring idx zos put next entry putnextentry zoe files copy temp path temppath zos zos close entry closeentry temp artifact tempartifact delete subsystem data subsystemdata file file manifest manifest delete on close file input stream deleteonclosefileinputstream file input stream fileinputstream file file delete on close file input stream deleteonclosefileinputstream file file not found exception filenotfoundexception file override close io exception ioexception close file delete