licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling testing mock osgi java lang annotation annotation java lang reflect field java lang reflect invocation target exception invocationtargetexception java lang reflect method java util array list arraylist java util collection java util hash map hashmap java util list java util map java util sorted set sortedset org apache commons lang string utils stringutils org apache felix scr impl helper annotations org apache sling testing mock osgi osgi metadata util osgimetadatautil field collection type fieldcollectiontype org apache sling testing mock osgi osgi metadata util osgimetadatautil osgi metadata osgimetadata org apache sling testing mock osgi osgi metadata util osgimetadatautil reference org apache sling testing mock osgi osgi metadata util osgimetadatautil reference policy referencepolicy org osgi framework bundle context bundlecontext org osgi framework invalid syntax exception invalidsyntaxexception org osgi framework service reference servicereference org osgi service component component context componentcontext helper methods inject dependencies activate services osgi service util osgiserviceutil osgi service util osgiserviceutil methods simulate activation deactivation osg i osgi service instance param target service instance param component context componentcontext component context activation deactivation method called failed activate deactivate activatedeactivate object target component context componentcontext component context componentcontext activate target class targetclass target get class getclass method activation deactivation osgi metadata osgi metadata osgimetadata metadata osgi metadata util osgimetadatautil get metadata getmetadata target class targetclass metadata no scr metadata exception noscrmetadataexception target class targetclass string method name methodname activate method name methodname metadata get activate method name getactivatemethodname method name methodname metadata get deactivate method name getdeactivatemethodname fallback default name fallbackdefaultname string utils stringutils is empty isempty method name methodname fallback default name fallbackdefaultname activate method name methodname activate method name methodname deactivate find matching activate deactivate method execute invoke lifecycle method invokelifecyclemethod target target class targetclass method name methodname activate component context componentcontext map util maputil to map tomap component context componentcontext get properties getproperties fallback default name fallbackdefaultname runtime exception runtimeexception matching activate activation deactivation method method name methodname target class targetclass get name getname simulate modification configuration osg i osgi service instance param target service instance param properties updated configuration modified method called failed modified object target component context componentcontext component context componentcontext map string object properties target class targetclass target get class getclass method activation deactivation osgi metadata osgi metadata osgimetadata metadata osgi metadata util osgimetadatautil get metadata getmetadata target class targetclass metadata no scr metadata exception noscrmetadataexception target class targetclass string method name methodname metadata get modified method name getmodifiedmethodname string utils stringutils is empty isempty method name methodname find matching modified method execute invoke lifecycle method invokelifecyclemethod target target class targetclass method name methodname component context componentcontext properties runtime exception runtimeexception matching modified method method name methodname target class targetclass get name getname invokes lifecycle method activation deactivation modified variable method arguments param target target object param target class targetclass target object param method name methodname method param allow integer argument allowintegerargument integer arguments dec activate decactivate param component context componentcontext component context param properties component properties method invoked invoke lifecycle method invokelifecyclemethod object target target class targetclass string method name methodname allow integer argument allowintegerargument component context componentcontext component context componentcontext map string object properties component context componentcontext method method get method getmethod target class targetclass method name methodname component context componentcontext method invoke method invokemethod target method object component context componentcontext bundle context bundlecontext method get method getmethod target class targetclass method name methodname bundle context bundlecontext method invoke method invokemethod target method object component context componentcontext get bundle context getbundlecontext map method get method getmethod target class targetclass method name methodname map method invoke method invokemethod target method object map util maputil to map tomap component context componentcontext get properties getproperties component property type annotation lass method get method getmethod target class targetclass method name methodname annotation method invoke method invokemethod target method object annotations to object toobject method get parameter types getparametertypes map util maputil to map tomap component context componentcontext get properties getproperties component context componentcontext get bundle context getbundlecontext get bundle getbundle deactivation allow integer argument allowintegerargument method get method getmethod target class targetclass method name methodname method invoke method invokemethod target method object integer deactivation allow integer argument allowintegerargument method get method getmethod target class targetclass method name methodname integer method invoke method invokemethod target method object mixed arguments mixed args allowed mixedargsallowed allow integer argument allowintegerargument component context componentcontext bundle context bundlecontext map annotation integer component context componentcontext bundle context bundlecontext map annotation method get method with any combination args getmethodwithanycombinationargs target class targetclass method name methodname mixed args allowed mixedargsallowed method object args object method get parameter types getparametertypes length args length method get parameter types getparametertypes component context componentcontext args component context componentcontext method get parameter types getparametertypes bundle context bundlecontext args component context componentcontext get bundle context getbundlecontext method get parameter types getparametertypes map args map util maputil to map tomap component context componentcontext get properties getproperties method get parameter types getparametertypes is annotation isannotation args annotations to object toobject method get parameter types getparametertypes map util maputil to map tomap component context componentcontext get properties getproperties component context componentcontext get bundle context getbundlecontext get bundle getbundle method get parameter types getparametertypes method get parameter types getparametertypes integer args invoke method invokemethod target method args noargs method get method getmethod target class targetclass method name methodname method invoke method invokemethod target method object method get method getmethod clazz string method name methodname types method methods clazz get declared methods getdeclaredmethods method method methods string utils stringutils equals method get name getname method name methodname method get parameter types getparametertypes length types length found mismatch foundmismatch types length method get parameter types getparametertypes types types annotation method get parameter types getparametertypes is annotation isannotation found mismatch foundmismatch found mismatch foundmismatch method check classes super class superclass clazz get superclass getsuperclass super class superclass super class superclass object get method getmethod super class superclass method name methodname types method get method with assignable types getmethodwithassignabletypes clazz string method name methodname types method methods clazz get declared methods getdeclaredmethods method method methods string utils stringutils equals method get name getname method name methodname method get parameter types getparametertypes length types length found mismatch foundmismatch types length method get parameter types getparametertypes is assignable from isassignablefrom types found mismatch foundmismatch found mismatch foundmismatch method check classes super class superclass clazz get superclass getsuperclass super class superclass super class superclass object get method with assignable types getmethodwithassignabletypes super class superclass method name methodname types method get method with any combination args getmethodwithanycombinationargs clazz string method name methodname types method methods clazz get declared methods getdeclaredmethods method method methods string utils stringutils equals method get name getname method name methodname method get parameter types getparametertypes length found mismatch foundmismatch parameter type parametertype method get parameter types getparametertypes found any match foundanymatch types length parameter type parametertype types types annotation parameter type parametertype is annotation isannotation found any match foundanymatch found any match foundanymatch found mismatch foundmismatch found mismatch foundmismatch method check classes super class superclass clazz get superclass getsuperclass super class superclass super class superclass object get method with any combination args getmethodwithanycombinationargs super class superclass method name methodname types invoke method invokemethod object target method method object args method set accessible setaccessible method invoke target args illegal access exception illegalaccessexception runtime exception runtimeexception unable invoke method method get name getname target get class getclass get name getname illegal argument exception illegalargumentexception runtime exception runtimeexception unable invoke method method get name getname target get class getclass get name getname invocation target exception invocationtargetexception runtime exception runtimeexception unable invoke method method get name getname target get class getclass get name getname get cause getcause field get field getfield clazz string field name fieldname type field fields clazz get declared fields getdeclaredfields field field fields string utils stringutils equals field get name getname field name fieldname field get type gettype equals type field check classes super class superclass clazz get superclass getsuperclass super class superclass super class superclass object get field getfield super class superclass field name fieldname type field get field with assignable type getfieldwithassignabletype clazz string field name fieldname type field fields clazz get declared fields getdeclaredfields field field fields string utils stringutils equals field get name getname field name fieldname field get type gettype is assignable from isassignablefrom type field check classes super class superclass clazz get superclass getsuperclass super class superclass super class superclass object get field with assignable type getfieldwithassignabletype super class superclass field name fieldname type set field setfield object target field field object field set accessible setaccessible field target illegal access exception illegalaccessexception runtime exception runtimeexception unable field field get name getname target get class getclass get name getname illegal argument exception illegalargumentexception runtime exception runtimeexception unable field field get name getname target get class getclass get name getname simulate osg i osgi service dependency injection injects direct references multiple references param target service instance param bundle context bundlecontext bundle context services fetched inject dependencies injected service dependencies inject services injectservices object target bundle context bundlecontext bundle context bundlecontext collect declared reference annotations field level target class targetclass target get class getclass osgi metadata osgimetadata metadata osgi metadata util osgimetadatautil get metadata getmetadata target class targetclass metadata no scr metadata exception noscrmetadataexception target class targetclass list reference references metadata get references getreferences references is empty isempty inject services reference reference references inject service reference injectservicereference reference target bundle context bundlecontext inject service reference injectservicereference reference reference object target bundle context bundlecontext bundle context bundlecontext target class targetclass target get class getclass reference type type reference get interface type as class getinterfacetypeasclass matching service references list service info serviceinfo matching services matchingservices get matching services getmatchingservices type bundle context bundlecontext reference get target gettarget references check reference optional matching services matchingservices is empty isempty reference is cardinality optional iscardinalityoptional reference violation exception referenceviolationexception unable inject mandatory reference reference get name getname target class targetclass get name getname matching services reference is cardinality multiple iscardinalitymultiple empty array invoke bind unbind method invokebindunbindmethod reference target multiple references check reference multiple matching services matchingservices size reference is cardinality multiple iscardinalitymultiple reference violation exception referenceviolationexception multiple matches unary reference reference get name getname target class targetclass get name getname invoke bind method service info serviceinfo matching service matchingservice matching services matchingservices invoke bind unbind method invokebindunbindmethod reference target matching service matchingservice invoke bind unbind method invokebindunbindmethod reference reference object target service info serviceinfo service info serviceinfo bind target class targetclass target get class getclass invoke bind method string method name methodname bind reference get bind getbind reference get unbind getunbind string field name fieldname reference get field getfield string utils stringutils is empty isempty method name methodname string utils stringutils is empty isempty field name fieldname runtime exception runtimeexception bind unbind method file defined reference reference get name getname target class targetclass get name getname string utils stringutils is not empty isnotempty method name methodname service info serviceinfo service reference servicereference method method get method getmethod target class targetclass method name methodname service reference servicereference method invoke method invokemethod target method object service info serviceinfo get service reference getservicereference assignable service instance interface type interfacetype reference get interface type as class getinterfacetypeasclass method get method with assignable types getmethodwithassignabletypes target class targetclass method name methodname interface type interfacetype method invoke method invokemethod target method object service info serviceinfo get service instance getserviceinstance assignable service instance map method get method with assignable types getmethodwithassignabletypes target class targetclass method name methodname interface type interfacetype map method invoke method invokemethod target method object service info serviceinfo get service instance getserviceinstance service info serviceinfo get service config getserviceconfig runtime exception runtimeexception bind bind unbind method method name methodname reference reference get name getname target class targetclass get name getname osg i osgi decl arative declarative services bind unbind methods modify field string utils stringutils is not empty isnotempty field name fieldname check field list collection reference reference is cardinality multiple iscardinalitymultiple reference get field collection type getfieldcollectiontype service reference object item service info serviceinfo item service info serviceinfo get service instance getserviceinstance reference get field collection type getfieldcollectiontype field collection type fieldcollectiontype reference item service info serviceinfo get service reference getservicereference collection field field get field with assignable type getfieldwithassignabletype target class targetclass field name fieldname collection field bind add to collection addtocollection target field item remove from collection removefromcollection target field item list field get field getfield target class targetclass field name fieldname list field bind add to collection addtocollection target field item remove from collection removefromcollection target field item runtime exception runtimeexception field collection type reference get field collection type getfieldcollectiontype supported reference reference get name getname target class targetclass get name getname check single field reference assignable service instance interface type interfacetype reference get interface type as class getinterfacetypeasclass field field get field with assignable type getfieldwithassignabletype target class targetclass field name fieldname interface type interfacetype field set field setfield target field bind service info serviceinfo service info serviceinfo get service instance getserviceinstance service reference servicereference field get field getfield target class targetclass field name fieldname service reference servicereference field set field setfield target field bind service info serviceinfo service info serviceinfo get service reference getservicereference suppress warnings suppresswarnings unchecked add to collection addtocollection object target field field object item field set accessible setaccessible collection object collection collection object field target collection collection array list arraylist object item collection add item field target collection illegal access exception illegalaccessexception runtime exception runtimeexception unable field field get name getname target get class getclass get name getname illegal argument exception illegalargumentexception runtime exception runtimeexception unable field field get name getname target get class getclass get name getname suppress warnings suppresswarnings unchecked remove from collection removefromcollection object target field field object item field set accessible setaccessible collection object collection collection object field target collection collection array list arraylist object item collection remove item field target collection illegal access exception illegalaccessexception runtime exception runtimeexception unable field field get name getname target get class getclass get name getname illegal argument exception illegalargumentexception runtime exception runtimeexception unable field field get name getname target get class getclass get name getname invoke bind method service reference param reference reference metadata param target target object reference param service info serviceinfo service invoke method invoke bind method invokebindmethod reference reference object target service info serviceinfo service info serviceinfo invoke bind unbind method invokebindunbindmethod reference target service info serviceinfo invoke unbind method service reference param reference reference metadata param target target object reference param service info serviceinfo service invoke method invoke unbind method invokeunbindmethod reference reference object target service info serviceinfo service info serviceinfo invoke bind unbind method invokebindunbindmethod reference target service info serviceinfo list service info serviceinfo get matching services getmatchingservices type bundle context bundlecontext bundle context bundlecontext string filter list service info serviceinfo matching services matchingservices array list arraylist service info serviceinfo service reference servicereference references bundle context bundlecontext get service references getservicereferences type get name getname filter references service reference servicereference service reference servicereference references object service instance serviceinstance bundle context bundlecontext get service getservice service reference servicereference map string object service config serviceconfig hash map hashmap string object string service reference servicereference get property keys getpropertykeys string key service config serviceconfig key service reference servicereference get property getproperty key matching services matchingservices add service info serviceinfo service instance serviceinstance service config serviceconfig service reference servicereference invalid syntax exception invalidsyntaxexception matching services matchingservices collects references registered service match exported interfaces service registration param registered services registeredservices registered services param registration service registration list references list reference info referenceinfo get matching dynamic references getmatchingdynamicreferences sorted set sortedset mock service registration mockserviceregistration registered services registeredservices mock service registration mockserviceregistration registration list reference info referenceinfo references array list arraylist reference info referenceinfo mock service registration mockserviceregistration existing registration existingregistration registered services registeredservices osgi metadata osgimetadata metadata osgi metadata util osgimetadatautil get metadata getmetadata existing registration existingregistration get service getservice get class getclass metadata reference reference metadata get references getreferences reference get policy getpolicy reference policy referencepolicy dynamic string service interface serviceinterface registration get classes getclasses string utils stringutils equals service interface serviceinterface reference get interface type getinterfacetype references add reference info referenceinfo existing registration existingregistration reference references service info serviceinfo object service instance serviceinstance map string object service config serviceconfig service reference servicereference service reference servicereference service info serviceinfo object service instance serviceinstance map string object service config serviceconfig service reference servicereference service reference servicereference service instance serviceinstance service instance serviceinstance service config serviceconfig service config serviceconfig service reference servicereference service reference servicereference suppress warnings suppresswarnings unchecked service info serviceinfo mock service registration mockserviceregistration registration service instance serviceinstance registration get service getservice service config serviceconfig map util maputil to map tomap registration get properties getproperties service reference servicereference registration get reference getreference object get service instance getserviceinstance service instance serviceinstance map string object get service config getserviceconfig service config serviceconfig service reference servicereference get service reference getservicereference service reference servicereference reference info referenceinfo mock service registration mockserviceregistration service registration serviceregistration reference reference reference info referenceinfo mock service registration mockserviceregistration service registration serviceregistration reference reference service registration serviceregistration service registration serviceregistration reference reference mock service registration mockserviceregistration get service registration getserviceregistration service registration serviceregistration reference get reference getreference reference