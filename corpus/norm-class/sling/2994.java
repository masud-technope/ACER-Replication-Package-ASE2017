licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling installer org junit assert equals assertequals org junit assert not null assertnotnull org junit assert null assertnull java util array list arraylist java util dictionary java util hashtable java util linked list linkedlist java util list java util concurrent atomic atomic integer atomicinteger org apache sling installer api installable resource installableresource org apache sling installer api event installation event installationevent org apache sling installer api event installation listener installationlistener org apache sling installer api tasks resource state resourcestate org apache sling installer api tasks resource transformer resourcetransformer org junit org junit org junit test org junit runner run with runwith org ops pax exam option org ops pax exam junit pax exam paxexam org osgi framework bundle org osgi framework service reference servicereference org osgi framework service registration serviceregistration org osgi service configuration org osgi service configuration admin configurationadmin org osgi service configuration event configurationevent org osgi service configuration listener configurationlistener org osgi util tracker service tracker servicetracker org osgi util tracker service tracker customizer servicetrackercustomizer run with runwith pax exam paxexam config install test configinstalltest osgi installer test base osgiinstallertestbase configuration listener configurationlistener list configuration event configurationevent events linked list linkedlist configuration event configurationevent list service registration serviceregistration service registrations serviceregistrations array list arraylist service registration serviceregistration installation events installationevents atomic integer atomicinteger counter atomic integer atomicinteger org ops pax exam configuration option config default configuration defaultconfiguration set up setup installation events installationevents setup installer setupinstaller events clear service registrations serviceregistrations clear service registrations serviceregistrations add bundle context bundlecontext register service registerservice configuration listener configurationlistener get name getname installation listener installationlistener installation listener installationlistener on event onevent installation event installationevent event installation events installationevents service registrations serviceregistrations add bundle context bundlecontext register service registerservice installation listener installationlistener get name getname override tear down teardown tear down teardown service registration serviceregistration reg service registrations serviceregistrations reg unregister service registrations serviceregistrations clear string uniqueid counter increment and get incrementandget system current time millis currenttimemillis org osgi service configuration listener configurationlistener configuration event configurationevent org osgi service configuration event configurationevent configuration event configurationevent configuration event configurationevent get type gettype configuration event configurationevent delete d deleted get type gettype configuration event configurationevent updated events events add test test install config windows path testinstallconfigwindowspath exception dictionary string object cfg data cfgdata hashtable string object cfg data cfgdata foo bar string cfg pid cfgpid get class getclass get simple name getsimplename uniqueid assert null assertnull config cfg pid cfgpid test find configuration findconfiguration cfg pid cfgpid install configs patterns work fine problem occurs windows sep rator seprator foo bar foo bar string uri foo bar installable resource installableresource result mock installable resource mockinstallableresource uri cfg pid cfgpid copy cfg data cfgdata installable resource installableresource rsrc installable resource installableresource result installer update resources updateresources url scheme rsrc configuration cfg wait for configuration waitforconfiguration installing cfg pid cfgpid assert equals assertequals config match bar cfg get properties getproperties foo installer update resources updateresources url scheme string rsrc get id getid wait for configuration waitforconfiguration removing time cfg pid cfgpid test test install and remove config testinstallandremoveconfig exception dictionary string object cfg data cfgdata hashtable string object cfg data cfgdata foo bar string cfg pid cfgpid get class getclass get simple name getsimplename uniqueid assert null assertnull config cfg pid cfgpid test find configuration findconfiguration cfg pid cfgpid installable resource installableresource rsrc get installable resource getinstallableresource cfg pid cfgpid cfg data cfgdata installer update resources updateresources url scheme rsrc configuration cfg wait for configuration waitforconfiguration installing cfg pid cfgpid assert equals assertequals config match bar cfg get properties getproperties foo installer update resources updateresources url scheme string rsrc get id getid wait for configuration waitforconfiguration removing cfg pid cfgpid installer update resources updateresources url scheme rsrc cfg wait for configuration waitforconfiguration reinstalling cfg pid cfgpid assert equals assertequals config match bar cfg get properties getproperties foo installer update resources updateresources url scheme string rsrc get id getid wait for configuration waitforconfiguration removing time cfg pid cfgpid test test install update remove config resource testinstallupdateremoveconfigresource exception dictionary string object cfg data cfgdata hashtable string object cfg data cfgdata foo bar string cfg pid cfgpid get class getclass get simple name getsimplename uniqueid installable resource installableresource rsrc installable resource installableresource config a configa cfg pid cfgpid cfg data cfgdata installable resource installableresource type properties installer update resources updateresources url scheme installable resource installableresource rsrc wait for config value waitforconfigvalue installing cfg pid cfgpid foo bar dictionary string object second data seconddata hashtable string object second data seconddata foo bla installable resource installableresource rsrc installable resource installableresource config b configb cfg pid cfgpid second data seconddata installable resource installableresource type properties installer update resources updateresources url scheme installable resource installableresource rsrc wait for config value waitforconfigvalue updating cfg pid cfgpid foo bla installer update resources updateresources url scheme string config b configb cfg pid cfgpid wait for config value waitforconfigvalue deleting cfg pid cfgpid foo bar test test install update remove template config resource testinstallupdateremovetemplateconfigresource exception dictionary string object cfg data cfgdata hashtable string object cfg data cfgdata foo bar cfg data cfgdata installable resource installableresource resource template string cfg pid cfgpid get class getclass get simple name getsimplename uniqueid installable resource installableresource rsrc installable resource installableresource config a configa cfg pid cfgpid cfg data cfgdata installable resource installableresource type properties installer update resources updateresources url scheme installable resource installableresource rsrc wait for config value waitforconfigvalue installing cfg pid cfgpid foo bar dictionary string object second data seconddata hashtable string object second data seconddata foo bla installable resource installableresource rsrc installable resource installableresource config b configb cfg pid cfgpid second data seconddata installable resource installableresource type properties installer update resources updateresources url scheme installable resource installableresource rsrc wait for config value waitforconfigvalue updating cfg pid cfgpid foo bla installer update resources updateresources url scheme string config b configb cfg pid cfgpid wait for configuration waitforconfiguration deleting cfg pid cfgpid test test install update remove config factory resource testinstallupdateremoveconfigfactoryresource exception dictionary string object cfg data cfgdata hashtable string object cfg data cfgdata foo bar string cfg factory pid cfgfactorypid get class getclass get simple name getsimplename uniqueid string alias alias uniqueid installable resource installableresource rsrc installable resource installableresource config a configa cfg factory pid cfgfactorypid alias cfg data cfgdata installable resource installableresource type properties installer update resources updateresources url scheme installable resource installableresource rsrc wait for factory config value waitforfactoryconfigvalue installing cfg factory pid cfgfactorypid foo bar dictionary string object second data seconddata hashtable string object second data seconddata foo bla installable resource installableresource rsrc installable resource installableresource config b configb cfg factory pid cfgfactorypid alias second data seconddata installable resource installableresource type properties installer update resources updateresources url scheme installable resource installableresource rsrc wait for factory config value waitforfactoryconfigvalue updating cfg factory pid cfgfactorypid foo bla installer update resources updateresources url scheme string config b configb cfg factory pid cfgfactorypid alias wait for factory config value waitforfactoryconfigvalue updating cfg factory pid cfgfactorypid foo bar test test install update remove template config factory resource testinstallupdateremovetemplateconfigfactoryresource exception dictionary string object cfg data cfgdata hashtable string object cfg data cfgdata foo bar cfg data cfgdata installable resource installableresource resource template string cfg factory pid cfgfactorypid get class getclass get simple name getsimplename uniqueid string alias alias uniqueid installable resource installableresource rsrc installable resource installableresource config a configa cfg factory pid cfgfactorypid alias cfg data cfgdata installable resource installableresource type properties installer update resources updateresources url scheme installable resource installableresource rsrc wait for factory config value waitforfactoryconfigvalue installing cfg factory pid cfgfactorypid foo bar dictionary string object second data seconddata hashtable string object second data seconddata foo bla installable resource installableresource rsrc installable resource installableresource config b configb cfg factory pid cfgfactorypid alias second data seconddata installable resource installableresource type properties installer update resources updateresources url scheme installable resource installableresource rsrc wait for factory config value waitforfactoryconfigvalue updating cfg factory pid cfgfactorypid foo bla installer update resources updateresources url scheme string config b configb cfg factory pid cfgfactorypid alias wait for factory configuration waitforfactoryconfiguration deleting cfg factory pid cfgfactorypid test test install update remove config testinstallupdateremoveconfig exception dictionary string object cfg data cfgdata hashtable string object cfg data cfgdata foo bar string cfg pid cfgpid get class getclass get simple name getsimplename uniqueid installable resource installableresource rsrc installable resource installableresource config a configa cfg pid cfgpid cfg data cfgdata installable resource installableresource type properties installer update resources updateresources url scheme installable resource installableresource rsrc configuration cfg wait for config value waitforconfigvalue installing cfg pid cfgpid foo bar dictionary string object second data seconddata hashtable string object second data seconddata foo bla cfg update second data seconddata wait for resource waitforresource url scheme config a configa cfg pid cfgpid resource state resourcestate configuration second cfg secondcfg wait for config value waitforconfigvalue updating cfg pid cfgpid foo bla second cfg secondcfg delete wait for resource waitforresource url scheme config a configa cfg pid cfgpid resource state resourcestate installed wait for config value waitforconfigvalue deleting cfg pid cfgpid foo bar test test install update remove template config testinstallupdateremovetemplateconfig exception dictionary string object cfg data cfgdata hashtable string object cfg data cfgdata foo bar cfg data cfgdata installable resource installableresource resource template string cfg pid cfgpid get class getclass get simple name getsimplename uniqueid installable resource installableresource rsrc installable resource installableresource config a configa cfg pid cfgpid cfg data cfgdata installable resource installableresource type properties installer update resources updateresources url scheme installable resource installableresource rsrc configuration cfg wait for config value waitforconfigvalue installing cfg pid cfgpid foo bar dictionary string object second data seconddata hashtable string object second data seconddata foo bla cfg update second data seconddata wait for resource waitforresource url scheme config a configa cfg pid cfgpid resource state resourcestate configuration second cfg secondcfg wait for config value waitforconfigvalue updating cfg pid cfgpid foo bla second cfg secondcfg delete sleep wait for resource waitforresource url scheme config a configa cfg pid cfgpid resource state resourcestate wait for configuration waitforconfiguration deleting cfg pid cfgpid test test install update remove config factory testinstallupdateremoveconfigfactory exception dictionary string object cfg data cfgdata hashtable string object cfg data cfgdata foo bar string cfg factory pid cfgfactorypid get class getclass get simple name getsimplename uniqueid string alias alias uniqueid installable resource installableresource rsrc installable resource installableresource config a configa cfg factory pid cfgfactorypid alias cfg data cfgdata installable resource installableresource type properties installer update resources updateresources url scheme installable resource installableresource rsrc configuration cfg wait for factory config value waitforfactoryconfigvalue installing cfg factory pid cfgfactorypid foo bar dictionary string object second data seconddata hashtable string object second data seconddata foo bla cfg update second data seconddata wait for resource waitforresource url scheme config a configa cfg factory pid cfgfactorypid alias resource state resourcestate configuration second cfg secondcfg wait for factory config value waitforfactoryconfigvalue updating cfg factory pid cfgfactorypid foo bla second cfg secondcfg delete wait for resource waitforresource url scheme config a configa cfg factory pid cfgfactorypid alias resource state resourcestate installed wait for factory config value waitforfactoryconfigvalue deleting cfg factory pid cfgfactorypid foo bar test test install update remove template config factory testinstallupdateremovetemplateconfigfactory exception dictionary string object cfg data cfgdata hashtable string object cfg data cfgdata foo bar cfg data cfgdata installable resource installableresource resource template string cfg factory pid cfgfactorypid get class getclass get simple name getsimplename uniqueid string alias alias uniqueid installable resource installableresource rsrc installable resource installableresource config a configa cfg factory pid cfgfactorypid alias cfg data cfgdata installable resource installableresource type properties installer update resources updateresources url scheme installable resource installableresource rsrc configuration cfg wait for factory config value waitforfactoryconfigvalue installing cfg factory pid cfgfactorypid foo bar dictionary string object second data seconddata hashtable string object second data seconddata foo bla cfg update second data seconddata wait for resource waitforresource url scheme config a configa cfg factory pid cfgfactorypid alias resource state resourcestate configuration second cfg secondcfg wait for factory config value waitforfactoryconfigvalue updating cfg factory pid cfgfactorypid foo bla second cfg secondcfg delete sleep wait for resource waitforresource url scheme config a configa cfg factory pid cfgfactorypid alias resource state resourcestate wait for factory configuration waitforfactoryconfiguration deleting cfg factory pid cfgfactorypid test test deferred config install testdeferredconfiginstall exception bundle config admin configadmin get config admin bundle getconfigadminbundle assert not null assertnotnull config admin configadmin bundle config admin configadmin wait for config admin waitforconfigadmin string cfg pid cfgpid get class getclass get simple name getsimplename deferred uniqueid assert null assertnull config cfg pid cfgpid test find configuration findconfiguration cfg pid cfgpid dictionary string object cfg data cfgdata hashtable string object cfg data cfgdata foo bar config admin configadmin wait for config admin waitforconfigadmin installable resource installableresource rsrc get installable resource getinstallableresource cfg pid cfgpid cfg data cfgdata installation events installationevents installer update resources updateresources url scheme rsrc wait for installation events waitforinstallationevents config admin configadmin start wait for config admin waitforconfigadmin wait for configuration waitforconfiguration config installed configuration admin configurationadmin res tarts restarts cfg pid cfgpid installer update resources updateresources url scheme string rsrc get id getid wait for configuration waitforconfiguration config removed configuration admin configurationadmin res tarts restarts cfg pid cfgpid test test deferred config remove testdeferredconfigremove exception atomic integer atomicinteger transformer count transformercount atomic integer atomicinteger service tracker servicetracker service tracker servicetracker bundle context bundlecontext resource transformer resourcetransformer get name getname service tracker customizer servicetrackercustomizer removed service removedservice service reference servicereference reference object service bundle context bundlecontext unget service ungetservice reference transformer count transformercount decrement and get decrementandget modified service modifiedservice service reference servicereference reference object service object adding service addingservice service reference servicereference reference transformer count transformercount increment and get incrementandget bundle context bundlecontext get service getservice reference open atomic integer atomicinteger expected count expectedcount atomic integer atomicinteger condition cond condition override is true istrue exception transformer count transformercount expected count expectedcount override string additional info additionalinfo resource transformer count string value of valueof transformer count transformercount string value of valueof expected count expectedcount bundle config admin configadmin get config admin bundle getconfigadminbundle assert not null assertnotnull config admin configadmin bundle config admin configadmin wait for config admin waitforconfigadmin expected count expectedcount wait for condition waitforcondition cond string cfg pid cfgpid get class getclass get simple name getsimplename deferred uniqueid assert null assertnull config cfg pid cfgpid test find configuration findconfiguration cfg pid cfgpid dictionary string object cfg data cfgdata hashtable string object cfg data cfgdata foo bar installable resource installableresource rsrc get installable resource getinstallableresource cfg pid cfgpid cfg data cfgdata installer update resources updateresources url scheme rsrc wait for configuration waitforconfiguration config installed stop ping stopping configuration admin configurationadmin cfg pid cfgpid wait for resource waitforresource url scheme rsrc get id getid resource state resourcestate installed config admin configadmin wait for config admin waitforconfigadmin expected count expectedcount wait for condition waitforcondition cond installation events installationevents installer update resources updateresources url scheme string rsrc get id getid wait for installation events waitforinstallationevents wait for resource waitforresource url scheme rsrc get id getid resource state resourcestate uninstall config admin configadmin start wait for config admin waitforconfigadmin expected count expectedcount wait for condition waitforcondition cond wait for configuration waitforconfiguration config removed configuration admin configurationadmin res tarts restarts cfg pid cfgpid close test test reinstall same config testreinstallsameconfig exception dictionary string object cfg data cfgdata hashtable string object cfg data cfgdata foo bar string cfg pid cfgpid get class getclass get simple name getsimplename reinstall uniqueid assert null assertnull config cfg pid cfgpid test find configuration findconfiguration cfg pid cfgpid configuration admin configurationadmin wait for config admin waitforconfigadmin configuration get configuration getconfiguration cfg pid cfgpid update cfg data cfgdata wait for config value waitforconfigvalue manual installation cfg pid cfgpid foo bar wait for condition waitforcondition expected configuration events configurationevents test config condition configcondition cfg pid cfgpid installer update resources updateresources url scheme get installable resource getinstallableresource cfg pid cfgpid cfg data cfgdata cfg data cfgdata foo changed installer update resources updateresources url scheme get installable resource getinstallableresource cfg pid cfgpid cfg data cfgdata wait for config value waitforconfigvalue changing cfg pid cfgpid foo changed wait for condition waitforcondition expected configuration events configurationevents test config condition configcondition cfg pid cfgpid config condition configcondition condition string pid max count maxcount config condition configcondition string pid count pid pid max count maxcount count override is true istrue exception count events configuration event configurationevent events pid equals get pid getpid count count max count maxcount override string additional info additionalinfo string builder stringbuilder string builder stringbuilder expected append max count maxcount append events append pid append received events events configuration event configurationevent events append append get pid getpid append append get type gettype append to string tostring wait for installation events waitforinstallationevents how many howmany exception condition condition override is true istrue exception installation events installationevents how many howmany wait for condition waitforcondition wait how many howmany installation events