licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling scripting sightly impl compiler java io exception ioexception java input stream inputstream java input stream reader inputstreamreader java output stream outputstream java reader java util array list arraylist java util hash map hashmap java util linked hash set linkedhashset java util list java util map java util java util concurrent locks lock java util concurrent locks reentrant read write lock reentrantreadwritelock org apache commons io utils ioutils org apache felix scr annotations activate org apache felix scr annotations component org apache felix scr annotations reference org apache felix scr annotations service org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling commons class loader classloader class loader writer classloaderwriter org apache sling commons compiler compilation result compilationresult org apache sling commons compiler compilation unit compilationunit org apache sling commons compiler compiler message compilermessage org apache sling commons compiler java compiler javacompiler org apache sling commons compiler options org apache sling scripting sightly resource resolution resourceresolution org apache sling scripting sightly sightly exception sightlyexception org apache sling scripting sightly impl engine sightly engine configuration sightlyengineconfiguration org apache sling scripting sightly impl engine unit loader unitloader org apache sling scripting sightly impl engine compiled source identifier sourceidentifier org slf logger org slf logger factory loggerfactory code sightly java compiler sightlyjavacompiler simple instantiation arbitrary classes stored repository regular osg i osgi bundles comp iles compiles java sources fly discover source files based link resource typically sling components supports sling resource type inheritance component service sightly java compiler service sightlyjavacompilerservice sightly java compiler service sightlyjavacompilerservice logger log logger factory loggerfactory get logger getlogger sightly java compiler service sightlyjavacompilerservice reference class loader writer classloaderwriter class loader writer classloaderwriter reference java compiler javacompiler java compiler javacompiler reference unit change monitor unitchangemonitor unit change monitor unitchangemonitor reference sightly engine configuration sightlyengineconfiguration sightly engine configuration sightlyengineconfiguration options options reentrant read write lock reentrantreadwritelock lock reentrant read write lock reentrantreadwritelock lock read lock readlock lock read lock readlock lock write lock writelock lock write lock writelock method returns object instance based regular class loading classloading mechanisms fly compilation requested denote fully qualified class name classname service find sling servlet resolution mechanism compile fly required param resolver link resource resolver resourceresolver read access resources search path link resource resolver resourceresolver get search path getsearchpath param calling script callingscript lookup performed based resource code class name classname identify fully qualified parameter code param class name classname object instantiation object instance requested compiler exception compilerexception runtime exception object get instance getinstance resource resolver resourceresolver resolver resource calling script callingscript string class name classname pojo hint pojohint class name classname unit change monitor unitchangemonitor get last modified date for java use object getlastmodifieddateforjavauseobject class name classname pojo repo changed loaded object result compile repository java class compilerepositoryjavaclass resolver class name classname unit change monitor unitchangemonitor clear java use object clearjavauseobject class name classname result pojo hint pojohint compile repository java class compilerepositoryjavaclass resolver class name classname object bundle repo registered unit change monitor unitchangemonitor load object loadobject class name classname compiler exception compilerexception cex compile repository java class compilerepositoryjavaclass resolver class name classname calling script callingscript resource pojo resource pojoresource resource resolution resourceresolution get resource from search path getresourcefromsearchpath calling script callingscript class name classname java pojo resource pojoresource get instance getinstance resolver utils get java name from path getjavanamefrompath pojo resource pojoresource get path getpath sightly exception sightlyexception find class name classname comp iles compiles passed fully qualified source code param source code sourcecode source code generate param fqcn fully qualified compile object instance compile compiler exception compilerexception runtime exception object compile source compilesource source identifier sourceidentifier source identifier sourceidentifier string source code sourcecode string fqcn down graded lock downgradedlock write lock writelock lock source identifier sourceidentifier source identifier sourceidentifier needs update needsupdate internal compile source internalcompilesource source code sourcecode fqcn down grade downgrade write lock read lock don recompile recompiled thread read lock readlock lock write lock writelock unlock down graded lock downgradedlock class loader writer classloaderwriter get class loader getclassloader load class loadclass fqcn new instance newinstance internal compile source internalcompilesource source code sourcecode fqcn exception compiler exception compilerexception compiler exception compilerexception compiler exception cause compilerexceptioncause compiler errors down graded lock downgradedlock read lock readlock unlock write lock writelock unlock object internal compile source internalcompilesource string source code sourcecode string fqcn exception sightly engine configuration sightlyengineconfiguration is dev mode isdevmode string path fqcn replace all replaceall java output stream outputstream class loader writer classloaderwriter get output stream getoutputstream path io utils ioutils write source code sourcecode utf io utils ioutils close quietly closequietly compilation unit compilationunit compilation unit compilationunit sightly compilation unit sightlycompilationunit source code sourcecode fqcn start system current time millis currenttimemillis compilation result compilationresult compilation result compilationresult java compiler javacompiler compile compilation unit compilationunit compilation unit compilationunit options system current time millis currenttimemillis list compiler message compilermessage errors compilation result compilationresult get errors geterrors errors errors size compiler exception compilerexception compiler exception compilerexception compiler exception cause compilerexceptioncause compiler errors create error msg createerrormsg errors log is debug enabled isdebugenabled log debug script compiled compilation result compilationresult did compile didcompile log debug compilation start loader dirty link class loader writer classloaderwriter decide loader class loader writer classloaderwriter get class loader getclassloader load class loadclass fqcn new instance newinstance object compile repository java class compilerepositoryjavaclass resource resolver resourceresolver resolver string class name classname string pojo path pojopath get path from java name getpathfromjavaname resolver class name classname resource pojo resource pojoresource resolver get resource getresource pojo path pojopath pojo resource pojoresource compile source compilesource io utils ioutils to string tostring pojo resource pojoresource adapt to adaptto input stream inputstream utf class name classname io exception ioexception sightly exception sightlyexception string format unable compile class name classname pojo path pojopath sightly exception sightlyexception find file class name classname repository jcr path expanding generated method generates alternative path names expanding mentioned param original path originalpath paths link alternative paths symbol replacement needed code original path originalpath string get possible pojo paths getpossiblepojopaths string original path originalpath string possible paths possiblepaths linked hash set linkedhashset string possible paths possiblepaths add original path originalpath map integer string chars hash map hashmap integer string ambiguous path symbol ambiguouspathsymbol symbols ambiguous path symbol ambiguouspathsymbol values ambiguous path symbol ambiguouspathsymbol symbol symbols string path copy pathcopy original path originalpath substring original path originalpath last index of lastindexof actual index actualindex first pass firstpass path copy pathcopy index of indexof symbol get symbol getsymbol pos path copy pathcopy index of indexof symbol get symbol getsymbol actual index actualindex pos first pass firstpass actual index actualindex chars actual index actualindex symbol get symbol getsymbol to string tostring path copy pathcopy path copy pathcopy substring pos first pass firstpass chars size array list arraylist ambiguous path symbol ambiguouspathsymbol possible arr angements possiblearrangements array list arraylist ambiguous path symbol ambiguouspathsymbol populate array populatearray possible arr angements possiblearrangements ambiguous path symbol ambiguouspathsymbol chars size integer indexes chars key set keyset to array toarray integer chars size ambiguous path symbol ambiguouspathsymbol arrangement possible arr angements possiblearrangements possible path possiblepath original path originalpath to char array tochararray arrangement length current symbol currentsymbol arrangement get symbol getsymbol current index currentindex indexes possible path possiblepath current index currentindex current symbol currentsymbol possible paths possiblepaths add string possible path possiblepath possible paths possiblepaths initial array size equal number elements needed arrangement method generate arr angements arrangements values array code array collection arraycollection values array pop ulated populated link ambiguous path symbol ambiguouspathsymbol constants param array collection arraycollection collection store arrays param symbols arrangement array symbolsarrangementarray initial array collecting param initial array pop ulated populated needed recursion purposes start initial call populate array populatearray array list arraylist ambiguous path symbol ambiguouspathsymbol array collection arraycollection ambiguous path symbol ambiguouspathsymbol symbols arrangement array symbolsarrangementarray symbols arrangement array symbolsarrangementarray length symbols arrangement array symbolsarrangementarray length array collection arraycollection add symbols arrangement array symbolsarrangementarray clone ambiguous path symbol ambiguouspathsymbol symbol ambiguous path symbol ambiguouspathsymbol values symbols arrangement array symbolsarrangementarray symbol populate array populatearray array collection arraycollection symbols arrangement array symbolsarrangementarray instantiate instance param class name classname instantiate instance object load object loadobject string class name classname class loader writer classloaderwriter class loader writer classloaderwriter get class loader getclassloader load class loadclass class name classname new instance newinstance for name forname class name classname new instance newinstance throwable compiler exception compilerexception compiler exception compilerexception compiler exception cause compilerexceptioncause compiler errors activate suppress warnings suppresswarnings unused activate log info act ivating activating get class getclass get name getname string version system get property getproperty java specification version options options options options key generate debug info options options key source version version options options key target version version options options key loader write r writer class loader writer classloaderwriter options options key force compilation string get path from java name getpathfromjavaname resource resolver resourceresolver resolver string class name classname sightly generated class sightlygeneratedclass class name classname unit loader unitloader prefix sightly generated class sightlygeneratedclass string package name packagename class name classname substring class name classname last index of lastindexof string short class name shortclassname class name classname substring package name packagename length string path package name packagename replace replace short class name shortclassname java sightly generated class sightlygeneratedclass path string possible paths possiblepaths get possible pojo paths getpossiblepojopaths path string possible path possiblepath possible paths possiblepaths resolver get resource getresource possible path possiblepath possible path possiblepath path string create error msg createerrormsg list compiler message compilermessage errors string builder stringbuilder buffer string builder stringbuilder buffer append compilation errors buffer append errors get file getfile buffer append string builder stringbuilder errors buffer errorsbuffer string builder stringbuilder duplicate variable duplicatevariable compiler message compilermessage errors duplicate variable duplicatevariable get message getmessage duplicate local variable duplicate variable duplicatevariable buffer append defined identical block elements defining variable errors buffer errorsbuffer append n line nline errors buffer errorsbuffer append get line getline errors buffer errorsbuffer append column errors buffer errorsbuffer append get column getcolumn errors buffer errorsbuffer append errors buffer errorsbuffer append get message getmessage buffer append errors buffer errorsbuffer buffer to string tostring sightly compilation unit sightlycompilationunit compilation unit compilationunit string fqcn string source code sourcecode sightly compilation unit sightlycompilationunit string source code sourcecode string fqcn exception source code sourcecode source code sourcecode fqcn fqcn override reader get source getsource io exception ioexception input stream reader inputstreamreader io utils ioutils to input stream toinputstream source code sourcecode utf override string get main class name getmainclassname fqcn override get last modified getlastmodified system current time millis currenttimemillis code ambiguous path symbol ambiguouspathsymbol holds symbols valid jcr path transformed obey java naming conventions enum ambiguous path symbol ambiguouspathsymbol dash underscore character symbol ambiguous path symbol ambiguouspathsymbol character symbol symbol symbol character get symbol getsymbol symbol