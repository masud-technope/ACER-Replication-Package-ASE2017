licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling launchpad webapp int egrationtest integrationtest access manager accessmanager org junit assert equals assertequals org junit assert not null assertnotnull org junit assert null assertnull org junit assert false assertfalse java io exception ioexception java util array list arraylist java util hash set hashset java util list java util javax servlet http http servlet response httpservletresponse org apache commons http client httpclient credentials org apache commons http client httpclient name value pair namevaluepair org apache commons http client httpclient username password credentials usernamepasswordcredentials org apache sling commons json json array jsonarray org apache sling commons json json exception jsonexception org apache sling commons json json object jsonobject org apache sling commons testing int egration integration http test httptest org junit org junit org junit test org junit exp erimental experimental categories category tests modify ace modifyace sling post operation modify ace test modifyacetest string test user id testuserid string test user id testuserid string test group id testgroupid string test folder url testfolderurl access manager test util accessmanagertestutil access manager test util accessmanagertestutil setup exception set up setup cleanup exception tear down teardown credentials creds username password credentials usernamepasswordcredentials admin admin test folder url testfolderurl remove test user exists string post url posturl test folder url testfolderurl list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair operation delete assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams test group id testgroupid remove test user exists string post url posturl http test httptest http base url system user manager usermanager group test group id testgroupid delete html list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams test user id testuserid remove test user exists string post url posturl http test httptest http base url system user manager usermanager user test user id testuserid delete html list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams test user id testuserid remove test user exists string post url posturl http test httptest http base url system user manager usermanager user test user id testuserid delete html list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams test test modify ace for user testmodifyaceforuser io exception ioexception json exception jsonexception test user id testuserid create test user createtestuser test folder url testfolderurl create test folder createtestfolder string post url posturl test folder url testfolderurl modify ace modifyace html list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr read granted post params postparams add name value pair namevaluepair privilege jcr write denied invalid post params postparams add name value pair namevaluepair privilege jcr modify access control modifyaccesscontrol bogus credentials creds username password credentials usernamepasswordcredentials admin admin assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams fetch json acl verify settings string get url geturl test folder url testfolderurl acl json string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json assert equals assertequals json object jsonobject length json object jsonobject ace object aceobject json object jsonobject optjsonobject test user id testuserid assert not null assertnotnull ace object aceobject string principal string principalstring ace object aceobject opt string optstring principal assert equals assertequals test user id testuserid principal string principalstring order ace object aceobject opt int optint order assert equals assertequals order json array jsonarray granted array grantedarray ace object aceobject optjsonarray granted assert not null assertnotnull granted array grantedarray assert equals assertequals granted array grantedarray length assert equals assertequals jcr read granted array grantedarray get string getstring json array jsonarray denied array deniedarray ace object aceobject optjsonarray denied assert not null assertnotnull denied array deniedarray assert equals assertequals denied array deniedarray length assert equals assertequals jcr write denied array deniedarray get string getstring test test modify ace for group testmodifyaceforgroup io exception ioexception json exception jsonexception test group id testgroupid create test group createtestgroup test folder url testfolderurl create test folder createtestfolder string post url posturl test folder url testfolderurl modify ace modifyace html list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test group id testgroupid post params postparams add name value pair namevaluepair privilege jcr read granted post params postparams add name value pair namevaluepair privilege jcr write denied invalid post params postparams add name value pair namevaluepair privilege jcr modify access control modifyaccesscontrol bogus credentials creds username password credentials usernamepasswordcredentials admin admin assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams fetch json acl verify settings string get url geturl test folder url testfolderurl acl json string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json assert equals assertequals json object jsonobject length json object jsonobject ace object aceobject json object jsonobject optjsonobject test group id testgroupid assert not null assertnotnull ace object aceobject order ace object aceobject opt int optint order assert equals assertequals order string principal string principalstring ace object aceobject opt string optstring principal assert equals assertequals test group id testgroupid principal string principalstring json array jsonarray granted array grantedarray ace object aceobject optjsonarray granted assert not null assertnotnull granted array grantedarray assert equals assertequals granted array grantedarray length assert equals assertequals jcr read granted array grantedarray get string getstring json array jsonarray denied array deniedarray ace object aceobject optjsonarray denied assert not null assertnotnull denied array deniedarray assert equals assertequals jcr write denied array deniedarray get string getstring test sling preserve privileges posted modify ace modifyace request test test merge ace for user testmergeaceforuser io exception ioexception json exception jsonexception test user id testuserid create test user createtestuser test folder url testfolderurl create test folder createtestfolder string post url posturl test folder url testfolderurl modify ace modifyace html create initial privileges list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr read granted post params postparams add name value pair namevaluepair privilege jcr read access control readaccesscontrol granted post params postparams add name value pair namevaluepair privilege jcr add child nodes addchildnodes granted post params postparams add name value pair namevaluepair privilege jcr modify access control modifyaccesscontrol denied post params postparams add name value pair namevaluepair privilege jcr remove child nodes removechildnodes denied credentials creds username password credentials usernamepasswordcredentials admin admin assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams fetch json acl verify settings string get url geturl test folder url testfolderurl acl json string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json assert equals assertequals json object jsonobject length json object jsonobject ace object aceobject json object jsonobject optjsonobject test user id testuserid assert not null assertnotnull ace object aceobject string principal string principalstring ace object aceobject opt string optstring principal assert equals assertequals test user id testuserid principal string principalstring order ace object aceobject opt int optint order assert equals assertequals order json array jsonarray granted array grantedarray ace object aceobject optjsonarray granted assert not null assertnotnull granted array grantedarray assert equals assertequals granted array grantedarray length string granted privilege names grantedprivilegenames hash set hashset string granted array grantedarray length granted privilege names grantedprivilegenames add granted array grantedarray get string getstring assert privilege assertprivilege granted privilege names grantedprivilegenames jcr read assert privilege assertprivilege granted privilege names grantedprivilegenames jcr read access control readaccesscontrol assert privilege assertprivilege granted privilege names grantedprivilegenames jcr add child nodes addchildnodes json array jsonarray denied array deniedarray ace object aceobject optjsonarray denied assert not null assertnotnull denied array deniedarray assert equals assertequals denied array deniedarray length string denied privilege names deniedprivilegenames hash set hashset string denied array deniedarray length denied privilege names deniedprivilegenames add denied array deniedarray get string getstring assert privilege assertprivilege denied privilege names deniedprivilegenames jcr modify access control modifyaccesscontrol assert privilege assertprivilege denied privilege names deniedprivilegenames jcr remove child nodes removechildnodes post privileges merge existing privileges list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid jcr read jcr add child nodes addchildnodes posted remain granted ace clear existing privilege post params postparams add name value pair namevaluepair privilege jcr read access control readaccesscontrol add privilege post params postparams add name value pair namevaluepair privilege jcr modify properties modifyproperties granted jcr modify access control modifyaccesscontrol posted remain denied ace deny modify access control modifyaccesscontrol privilege post params postparams add name value pair namevaluepair privilege jcr modify access control modifyaccesscontrol denied clear existing privilege post params postparams add name value pair namevaluepair privilege jcr remove child nodes removechildnodes deny privilege post params postparams add name value pair namevaluepair privilege jcr remove node removenode denied assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams fetch json acl verify settings string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json assert equals assertequals json object jsonobject length json object jsonobject ace object aceobject json object jsonobject optjsonobject test user id testuserid assert not null assertnotnull ace object aceobject string principal string principalstring ace object aceobject opt string optstring principal assert equals assertequals test user id testuserid principal string principalstring json array jsonarray granted array grantedarray ace object aceobject optjsonarray granted assert not null assertnotnull granted array grantedarray assert equals assertequals granted array grantedarray length string granted privilege names grantedprivilegenames hash set hashset string granted array grantedarray length granted privilege names grantedprivilegenames add granted array grantedarray get string getstring assert privilege assertprivilege granted privilege names grantedprivilegenames jcr read assert privilege assertprivilege granted privilege names grantedprivilegenames jcr add child nodes addchildnodes assert privilege assertprivilege granted privilege names grantedprivilegenames jcr modify properties modifyproperties json array jsonarray denied array deniedarray ace object aceobject optjsonarray denied assert not null assertnotnull denied array deniedarray assert equals assertequals denied array deniedarray length string denied privilege names deniedprivilegenames hash set hashset string denied array deniedarray length denied privilege names deniedprivilegenames add denied array deniedarray get string getstring assert privilege assertprivilege denied privilege names deniedprivilegenames jcr modify access control modifyaccesscontrol assert privilege assertprivilege denied privilege names deniedprivilegenames jcr remove node removenode test sling preserve privileges posted modify ace modifyace request test test merge ace for user split aggregate principal testmergeaceforusersplitaggregateprincipal io exception ioexception json exception jsonexception test user id testuserid create test user createtestuser test folder url testfolderurl create test folder createtestfolder string post url posturl test folder url testfolderurl modify ace modifyace html create initial privileges list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr read granted post params postparams add name value pair namevaluepair privilege jcr write denied credentials creds username password credentials usernamepasswordcredentials admin admin assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams fetch json acl verify settings string get url geturl test folder url testfolderurl acl json string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json assert equals assertequals json object jsonobject length json object jsonobject ace object aceobject json object jsonobject optjsonobject test user id testuserid assert not null assertnotnull ace object aceobject assert equals assertequals test user id testuserid ace object aceobject opt string optstring principal json array jsonarray granted array grantedarray ace object aceobject optjsonarray granted assert not null assertnotnull granted array grantedarray assert equals assertequals granted array grantedarray length string granted privilege names grantedprivilegenames hash set hashset string granted array grantedarray length granted privilege names grantedprivilegenames add granted array grantedarray get string getstring assert privilege assertprivilege granted privilege names grantedprivilegenames jcr read json array jsonarray denied array deniedarray ace object aceobject optjsonarray denied assert not null assertnotnull denied array deniedarray assert equals assertequals denied array deniedarray length string denied privilege names deniedprivilegenames hash set hashset string denied array deniedarray length denied privilege names deniedprivilegenames add denied array deniedarray get string getstring assert privilege assertprivilege denied privilege names deniedprivilegenames jcr write post privileges merge existing privileges list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid jcr read posted remain granted ace add privilege post params postparams add name value pair namevaluepair privilege jcr modify properties modifyproperties granted jcr write posted aggregate privileges granted aggregate priv iledge priviledge disagreaged remaining denied privileges denied ace assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams fetch json acl verify settings string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json assert equals assertequals json object jsonobject length json object jsonobject ace object aceobject json object jsonobject optjsonobject test user id testuserid assert not null assertnotnull ace object aceobject assert equals assertequals test user id testuserid ace object aceobject opt string optstring principal json array jsonarray granted array grantedarray ace object aceobject optjsonarray granted assert not null assertnotnull granted array grantedarray assert equals assertequals granted array grantedarray length string granted privilege names grantedprivilegenames hash set hashset string granted array grantedarray length granted privilege names grantedprivilegenames add granted array grantedarray get string getstring assert privilege assertprivilege granted privilege names grantedprivilegenames jcr read assert privilege assertprivilege granted privilege names grantedprivilegenames jcr modify properties modifyproperties json array jsonarray denied array deniedarray ace object aceobject optjsonarray denied assert not null assertnotnull denied array deniedarray assert equals assertequals denied array deniedarray length string denied privilege names deniedprivilegenames hash set hashset string denied array deniedarray length denied privilege names deniedprivilegenames add denied array deniedarray get string getstring assert privilege assertprivilege denied privilege names deniedprivilegenames jcr write remaining privileges disaggregated jcr write collection remain assert privilege assertprivilege denied privilege names deniedprivilegenames jcr add child nodes addchildnodes assert privilege assertprivilege denied privilege names deniedprivilegenames jcr remove node removenode assert privilege assertprivilege denied privilege names deniedprivilegenames jcr remove child nodes removechildnodes test sling preserve privileges posted modify ace modifyace request test test merge ace for user combine aggregate privilege testmergeaceforusercombineaggregateprivilege io exception ioexception json exception jsonexception test user id testuserid create test user createtestuser test folder url testfolderurl create test folder createtestfolder string post url posturl test folder url testfolderurl modify ace modifyace html create initial privileges list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr read granted post params postparams add name value pair namevaluepair privilege jcr remove node removenode denied credentials creds username password credentials usernamepasswordcredentials admin admin assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams fetch json acl verify settings string get url geturl test folder url testfolderurl acl json string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json assert equals assertequals json object jsonobject length json object jsonobject ace object aceobject json object jsonobject optjsonobject test user id testuserid assert not null assertnotnull ace object aceobject assert equals assertequals test user id testuserid ace object aceobject opt string optstring principal json array jsonarray granted array grantedarray ace object aceobject getjsonarray granted assert not null assertnotnull granted array grantedarray assert equals assertequals granted array grantedarray length string granted privilege names grantedprivilegenames hash set hashset string granted array grantedarray length granted privilege names grantedprivilegenames add granted array grantedarray get string getstring assert privilege assertprivilege granted privilege names grantedprivilegenames jcr read json array jsonarray denied array deniedarray ace object aceobject getjsonarray denied assert not null assertnotnull denied array deniedarray assert equals assertequals denied array deniedarray length string denied privilege names deniedprivilegenames hash set hashset string denied array deniedarray length denied privilege names deniedprivilegenames add denied array deniedarray get string getstring assert privilege assertprivilege denied privilege names deniedprivilegenames jcr remove node removenode post privileges merge existing privileges list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid jcr read posted remain granted ace deny full jcr write aggregate privilege merge existing add privilege post params postparams add name value pair namevaluepair privilege jcr write denied assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams fetch json acl verify settings string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json assert equals assertequals json object jsonobject length json object jsonobject ace object aceobject json object jsonobject optjsonobject test user id testuserid assert not null assertnotnull ace object aceobject assert equals assertequals test user id testuserid ace object aceobject opt string optstring principal json array jsonarray granted array grantedarray ace object aceobject optjsonarray granted assert not null assertnotnull granted array grantedarray assert equals assertequals granted array grantedarray length string granted privilege names grantedprivilegenames hash set hashset string granted array grantedarray length granted privilege names grantedprivilegenames add granted array grantedarray get string getstring assert privilege assertprivilege granted privilege names grantedprivilegenames jcr read json array jsonarray denied array deniedarray ace object aceobject optjsonarray denied assert not null assertnotnull denied array deniedarray assert equals assertequals denied array deniedarray length string denied privilege names deniedprivilegenames hash set hashset string denied array deniedarray length denied privilege names deniedprivilegenames add denied array deniedarray get string getstring assert privilege assertprivilege denied privilege names deniedprivilegenames jcr write test ace update deny privilege ace grant privilege test test merge ace for user deny privilege after grant privilege testmergeaceforuserdenyprivilegeaftergrantprivilege io exception ioexception json exception jsonexception test user id testuserid create test user createtestuser test folder url testfolderurl create test folder createtestfolder string post url posturl test folder url testfolderurl modify ace modifyace html create initial privileges list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr write granted credentials creds username password credentials usernamepasswordcredentials admin admin assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams fetch json acl verify settings string get url geturl test folder url testfolderurl acl json string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json assert equals assertequals json object jsonobject length json object jsonobject ace object aceobject json object jsonobject optjsonobject test user id testuserid assert not null assertnotnull ace object aceobject assert equals assertequals test user id testuserid ace object aceobject opt string optstring principal json array jsonarray granted array grantedarray ace object aceobject optjsonarray granted assert not null assertnotnull granted array grantedarray assert equals assertequals granted array grantedarray length string granted privilege names grantedprivilegenames hash set hashset string granted array grantedarray length granted privilege names grantedprivilegenames add granted array grantedarray get string getstring assert privilege assertprivilege granted privilege names grantedprivilegenames jcr write assert false assertfalse ace object aceobject denied post privileges merge existing privileges list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid jcr write posted remain granted ace deny jcr node type management nodetypemanagement privilege merge existing ace add privilege post params postparams add name value pair namevaluepair privilege jcr node type management nodetypemanagement denied assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams fetch json acl verify settings string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json assert equals assertequals json object jsonobject length json object jsonobject ace object aceobject json object jsonobject optjsonobject test user id testuserid assert not null assertnotnull ace object aceobject assert equals assertequals test user id testuserid ace object aceobject opt string optstring principal json array jsonarray granted array grantedarray ace object aceobject optjsonarray granted assert not null assertnotnull granted array grantedarray assert equals assertequals granted array grantedarray length string granted privilege names grantedprivilegenames hash set hashset string granted array grantedarray length granted privilege names grantedprivilegenames add granted array grantedarray get string getstring assert privilege assertprivilege granted privilege names grantedprivilegenames jcr write json array jsonarray denied array deniedarray ace object aceobject optjsonarray denied assert not null assertnotnull denied array deniedarray assert equals assertequals denied array deniedarray length string denied privilege names deniedprivilegenames hash set hashset string denied array deniedarray length denied privilege names deniedprivilegenames add denied array deniedarray get string getstring assert privilege assertprivilege denied privilege names deniedprivilegenames jcr node type management nodetypemanagement test verify adding ace position acl test test add ace order by first testaddaceorderbyfirst io exception ioexception json exception jsonexception create ace order test folder with one ace createaceordertestfolderwithoneace test group id testgroupid create test group createtestgroup add or update ace addorupdateace test folder url testfolderurl test group id testgroupid fetch json acl verify settings string get url geturl test folder url testfolderurl acl json credentials creds username password credentials usernamepasswordcredentials admin admin string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json assert equals assertequals json object jsonobject length json object jsonobject group json object jsonobject getjsonobject test group id testgroupid assert not null assertnotnull group assert equals assertequals test group id testgroupid group get string getstring principal assert equals assertequals group get int getint order json object jsonobject user json object jsonobject getjsonobject test user id testuserid assert not null assertnotnull user assert equals assertequals test user id testuserid user get string getstring principal assert equals assertequals user get int getint order test verify adding ace acl test test add ace order by last testaddaceorderbylast io exception ioexception json exception jsonexception create ace order test folder with one ace createaceordertestfolderwithoneace test group id testgroupid create test group createtestgroup add or update ace addorupdateace test folder url testfolderurl test group id testgroupid fetch json acl verify settings string get url geturl test folder url testfolderurl acl json credentials creds username password credentials usernamepasswordcredentials admin admin string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json assert equals assertequals json object jsonobject length json object jsonobject user json object jsonobject getjsonobject test user id testuserid assert not null assertnotnull user assert equals assertequals test user id testuserid user get string getstring principal assert equals assertequals user get int getint order json object jsonobject group json object jsonobject getjsonobject test group id testgroupid assert not null assertnotnull group assert equals assertequals test group id testgroupid group get string getstring principal assert equals assertequals group get int getint order test verify adding ace existing ace acl test test add ace order by before testaddaceorderbybefore io exception ioexception json exception jsonexception create ace order test folder with one ace createaceordertestfolderwithoneace test group id testgroupid create test group createtestgroup add or update ace addorupdateace test folder url testfolderurl test group id testgroupid test user id testuserid fetch json acl verify settings string get url geturl test folder url testfolderurl acl json credentials creds username password credentials usernamepasswordcredentials admin admin string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json assert equals assertequals json object jsonobject length json object jsonobject group json object jsonobject getjsonobject test group id testgroupid assert not null assertnotnull group assert equals assertequals test group id testgroupid group get string getstring principal assert equals assertequals group get int getint order json object jsonobject user json object jsonobject getjsonobject test user id testuserid assert not null assertnotnull user assert equals assertequals test user id testuserid user get string getstring principal assert equals assertequals user get int getint order test verify adding ace existing ace acl test test add ace order by after testaddaceorderbyafter io exception ioexception json exception jsonexception create ace order test folder with one ace createaceordertestfolderwithoneace test group id testgroupid create test group createtestgroup add or update ace addorupdateace test folder url testfolderurl test group id testgroupid test user id testuserid fetch json acl verify settings string get url geturl test folder url testfolderurl acl json credentials creds username password credentials usernamepasswordcredentials admin admin string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json assert equals assertequals json object jsonobject length json object jsonobject user json object jsonobject getjsonobject test user id testuserid assert not null assertnotnull user assert equals assertequals test user id testuserid user get string getstring principal assert equals assertequals user get int getint order json object jsonobject group json object jsonobject getjsonobject test group id testgroupid assert not null assertnotnull group assert equals assertequals test group id testgroupid group get string getstring principal assert equals assertequals group get int getint order test verify adding ace specific acl test test add ace order by numeric testaddaceorderbynumeric io exception ioexception json exception jsonexception create ace order test folder with one ace createaceordertestfolderwithoneace test group id testgroupid create test group createtestgroup add or update ace addorupdateace test folder url testfolderurl test group id testgroupid fetch json acl verify settings string get url geturl test folder url testfolderurl acl json credentials creds username password credentials usernamepasswordcredentials admin admin string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json assert equals assertequals json object jsonobject length json object jsonobject group json object jsonobject getjsonobject test group id testgroupid assert not null assertnotnull group assert equals assertequals test group id testgroupid group get string getstring principal assert equals assertequals group get int getint order json object jsonobject user json object jsonobject getjsonobject test user id testuserid assert not null assertnotnull user assert equals assertequals test user id testuserid user get string getstring principal assert equals assertequals user get int getint order add principal test group id testgroupid test user id testuserid test user id testuserid create test user createtestuser add or update ace addorupdateace test folder url testfolderurl test user id testuserid string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json assert equals assertequals json object jsonobject length json object jsonobject group json object jsonobject getjsonobject test group id testgroupid assert not null assertnotnull group assert equals assertequals test group id testgroupid group get string getstring principal assert equals assertequals group get int getint order json object jsonobject user json object jsonobject getjsonobject test user id testuserid assert not null assertnotnull user assert equals assertequals test user id testuserid user get string getstring principal assert equals assertequals user get int getint order json object jsonobject user json object jsonobject getjsonobject test user id testuserid assert not null assertnotnull user assert equals assertequals test user id testuserid user get string getstring principal assert equals assertequals user get int getint order test modifying existing ace changing order leaves ace position acl test test update ace preserve position testupdateacepreserveposition io exception ioexception json exception jsonexception create ace order test folder with one ace createaceordertestfolderwithoneace test group id testgroupid create test group createtestgroup add or update ace addorupdateace test folder url testfolderurl test group id testgroupid update ace update change ace order add or update ace addorupdateace test folder url testfolderurl test group id testgroupid fetch json acl verify settings string get url geturl test folder url testfolderurl acl json credentials creds username password credentials usernamepasswordcredentials admin admin string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json assert equals assertequals json object jsonobject length json object jsonobject group json object jsonobject getjsonobject test group id testgroupid assert not null assertnotnull group assert equals assertequals test group id testgroupid group get string getstring principal assert equals assertequals group get int getint order json object jsonobject user json object jsonobject getjsonobject test user id testuserid assert not null assertnotnull user assert equals assertequals test user id testuserid user get string getstring principal assert equals assertequals user get int getint order helper create test folder single ace pre created create ace order test folder with one ace createaceordertestfolderwithoneace io exception ioexception json exception jsonexception test user id testuserid create test user createtestuser test folder url testfolderurl create test folder createtestfolder add or update ace addorupdateace test folder url testfolderurl test user id testuserid fetch json acl verify settings string get url geturl test folder url testfolderurl acl json credentials creds username password credentials usernamepasswordcredentials admin admin string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json assert equals assertequals json object jsonobject length json object jsonobject user json object jsonobject getjsonobject test user id testuserid assert not null assertnotnull user assert equals assertequals test user id testuserid user get string getstring principal assert equals assertequals user get int getint order helper add update ace testing add or update ace addorupdateace string folder url folderurl string principal id principalid read granted readgranted string order io exception ioexception json exception jsonexception string post url posturl folder url folderurl modify ace modifyace html create initial privileges list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid principal id principalid post params postparams add name value pair namevaluepair privilege jcr read read granted readgranted granted denied post params postparams add name value pair namevaluepair privilege jcr write denied order post params postparams add name value pair namevaluepair order order credentials creds username password credentials usernamepasswordcredentials admin admin assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams test sling test test modify ace response as n testmodifyaceresponseasjson io exception ioexception json exception jsonexception test user id testuserid create test user createtestuser test folder url testfolderurl create test folder createtestfolder string post url posturl test folder url testfolderurl modify ace modifyace json list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr read granted post params postparams add name value pair namevaluepair privilege jcr write denied invalid post params postparams add name value pair namevaluepair privilege jcr modify access control modifyaccesscontrol bogus credentials creds username password credentials usernamepasswordcredentials admin admin string json get authenticated post content getauthenticatedpostcontent creds post url posturl http test httptest content type json post params postparams http servlet response httpservletresponse json response parsed json object json object jsonobject json object jsonobject json object jsonobject json assert not null assertnotnull json object jsonobject test sling test test merge ace for user grant nested aggregate privilege after deny super aggregate privilege testmergeaceforusergrantnestedaggregateprivilegeafterdenysuperaggregateprivilege io exception ioexception json exception jsonexception test user id testuserid create test user createtestuser test folder url testfolderurl create test folder createtestfolder string post url posturl test folder url testfolderurl modify ace modifyace json setup initial denied privileges test user list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr version management versionmanagement denied post params postparams add name value pair namevaluepair privilege jcr read denied post params postparams add name value pair namevaluepair privilege jcr modify access control modifyaccesscontrol denied post params postparams add name value pair namevaluepair privilege rep write denied credentials creds username password credentials usernamepasswordcredentials admin admin string json get authenticated post content getauthenticatedpostcontent creds post url posturl http test httptest content type json post params postparams http servlet response httpservletresponse grant jcr write sub set subset rep write aggregate privilege post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr version management versionmanagement granted post params postparams add name value pair namevaluepair privilege jcr read granted post params postparams add name value pair namevaluepair privilege jcr modify access control modifyaccesscontrol granted aggregate rep write post params postparams add name value pair namevaluepair privilege jcr write granted string json get authenticated post content getauthenticatedpostcontent creds post url posturl http test httptest content type json post params postparams http servlet response httpservletresponse verify acl correct values fetch json acl verify settings string get url geturl test folder url testfolderurl acl json string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json assert equals assertequals json object jsonobject length json object jsonobject ace object aceobject json object jsonobject optjsonobject test user id testuserid assert not null assertnotnull ace object aceobject assert equals assertequals test user id testuserid ace object aceobject opt string optstring principal json array jsonarray granted array grantedarray ace object aceobject getjsonarray granted assert not null assertnotnull granted array grantedarray assert equals assertequals granted array grantedarray length string granted privilege names grantedprivilegenames hash set hashset string granted array grantedarray length granted privilege names grantedprivilegenames add granted array grantedarray get string getstring assert privilege assertprivilege granted privilege names grantedprivilegenames jcr version management versionmanagement assert privilege assertprivilege granted privilege names grantedprivilegenames jcr read assert privilege assertprivilege granted privilege names grantedprivilegenames jcr modify access control modifyaccesscontrol assert privilege assertprivilege granted privilege names grantedprivilegenames jcr write json array jsonarray denied array deniedarray ace object aceobject getjsonarray denied assert not null assertnotnull denied array deniedarray assert equals assertequals denied array deniedarray length string denied privilege names deniedprivilegenames hash set hashset string denied array deniedarray length denied privilege names deniedprivilegenames add denied array deniedarray get string getstring left overs leftovers denied rep write granted jcr write assert privilege assertprivilege denied privilege names deniedprivilegenames jcr node type management nodetypemanagement test sling test test merge ace for user grant aggregate privilege parts after deny aggregate privilege testmergeaceforusergrantaggregateprivilegepartsafterdenyaggregateprivilege io exception ioexception json exception jsonexception test user id testuserid create test user createtestuser test folder url testfolderurl create test folder createtestfolder string post url posturl test folder url testfolderurl modify ace modifyace json setup initial denied privileges test user list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr version management versionmanagement denied post params postparams add name value pair namevaluepair privilege jcr read denied post params postparams add name value pair namevaluepair privilege jcr modify access control modifyaccesscontrol denied post params postparams add name value pair namevaluepair privilege rep write denied credentials creds username password credentials usernamepasswordcredentials admin admin string json get authenticated post content getauthenticatedpostcontent creds post url posturl http test httptest content type json post params postparams http servlet response httpservletresponse grant privileges contained rep write privilege post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr version management versionmanagement granted post params postparams add name value pair namevaluepair privilege jcr read granted post params postparams add name value pair namevaluepair privilege jcr modify access control modifyaccesscontrol granted privilege rep write post params postparams add name value pair namevaluepair privilege jcr node type management nodetypemanagement granted aggregate rep write post params postparams add name value pair namevaluepair privilege jcr write granted string json get authenticated post content getauthenticatedpostcontent creds post url posturl http test httptest content type json post params postparams http servlet response httpservletresponse verify acl correct values fetch json acl verify settings string get url geturl test folder url testfolderurl acl json string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json assert equals assertequals json object jsonobject length json object jsonobject ace object aceobject json object jsonobject optjsonobject test user id testuserid assert not null assertnotnull ace object aceobject assert equals assertequals test user id testuserid ace object aceobject opt string optstring principal json array jsonarray granted array grantedarray ace object aceobject getjsonarray granted assert not null assertnotnull granted array grantedarray string granted privilege names grantedprivilegenames hash set hashset string granted array grantedarray length granted privilege names grantedprivilegenames add granted array grantedarray get string getstring assert privilege assertprivilege granted privilege names grantedprivilegenames jcr version management versionmanagement assert privilege assertprivilege granted privilege names grantedprivilegenames jcr read assert privilege assertprivilege granted privilege names grantedprivilegenames jcr modify access control modifyaccesscontrol jcr node type management nodetypemanagement jcr write assert privilege assertprivilege granted privilege names grantedprivilegenames rep write assert equals assertequals expecting correct number privileges granted privilege names grantedprivilegenames granted privilege names grantedprivilegenames size left denied json array jsonarray denied array deniedarray ace object aceobject optjsonarray denied assert null assertnull denied array deniedarray