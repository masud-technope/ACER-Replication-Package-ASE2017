licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling scripting java script javascript java filter reader filterreader java io exception ioexception java push back reader pushbackreader java reader java util stack org slf logger org slf logger factory loggerfactory code esp reader espreader code code filter reader filterreader code takes jsp input produces plain ecma script output filtering modifications input comp ris e comprise template text html wrapped write text wrapped single write call quote characters template text html tag attribute values escaped ecma code written output ecma slash star comments written ecma slash slash comments written jsp style template comments removed stream line end ings lineendings lf s lfs crlf s crlfs written html comments treated spec ially specially handled plain template text written output wrapped write consequence behaviour jsp ecma expressions included comments nice reader numbers stream match numbers matching contents input stream insertion write calls column numbers match mix ecma code tags template text maximum performance advisable create esp reader espreader plain file reader filereader input stream reader inputstreamreader buffered reader bufferedreader based simple r simpler read ers readers reasons call base reader character character turn performing base reader buffer input esp reader espreader filter reader filterreader log logger log logger factory loggerfactory get logger getlogger esp reader espreader parser parser starts running text treated template text wrapped write parse esp ecma script reading upto code code written output verbatim exceptions ecma slash star comments handed handled link parse ecma comment quoted strings handled link parse quote ecma slash slash comments handled link parse ecma comment l commentl parse ecma ecma script expression reading works link parse ecma exception code enclosed code code code code tags wrapped code write code statement verbatim parse ecma expr comp act compact esp expression syntax jsp expression language notation parse ecma expr compact jsp comment reading upto closing code code tag removed stream parse jsp comment ecma quoted string reading written input stream upto closing quote matches opening quote parse quote verbatim copy verbatim chars verbatimchars characters returned unchecked number characters returned popped stack inject text output processing parse verbatim ecma comment reading ecma slash star comment read completely returned parse ecma comment ecma comment reading ecma slash slash comment read completely returned parse ecma comment l commentl work look ahead lookahead character insertion push back reader pushbackreader push back reader pushbackreader input current parse field code parse code constants stack enter pushed stack left previous popped stack push state pushstate pop state popstate stack state stack statestack parser expected insert write call input stream link parse esp field necessairily start real text line start linestart characters push back pushback stream verbatim number consecutive characters verbatim chars verbatimchars string matching character string quoting quote char quotechar escape character encountered quoted string escape definition variable written initial code code indicating defined start write startwrite string out undefined outundefined java script javascript statement sets variable output data auto matically automatically inserted reader code needed string init statement response writer string out init statement outinitstatement init statement create esp reader espreader top code base reader basereader code constructor wraps input reader code push back reader pushbackreader code input stream modifications handled tra nsparently transparently link do read doread method param base reader basereader wrapped reader esp reader espreader reader base reader basereader base reader basereader input push back reader pushbackreader base reader basereader state stack statestack stack line start linestart verbatim chars verbatimchars quote char quotechar escape start esp template text push state pushstate parse esp code fragment initialize variable param statement statement initialization set out init statement setoutinitstatement string statement out init statement outinitstatement statement check block read operation ready input reader ready guarantee won block filtering character needed input code code character code push back reader pushbackreader code io exception ioexception reader open ready io exception ioexception ensure open ensureopen input ready filtered character character input stream character input reader skipped filtered characters character injected translation template text ecma code character filtering input reader io exception ioexception reader open read io exception ioexception ensure open ensureopen do read doread fill buffer filtered injected characters characters input stream characters input reader skipped filtered characters characters injected translation template text ecma code method code read cbuf cbuf length code param cbuf character buffer fill filtered characters number characters filled buffer input reader io exception ioexception reader open read cbuf io exception ioexception read cbuf cbuf length fill buffer offset number characters characters input stream characters input reader skipped filtered characters characters injected translation template text ecma code param cbuf character buffer fill filtered characters param offset start buffer param len number characters fill buffer number characters filled buffer input reader io exception ioexception reader open index out of bounds exception indexoutofboundsexception len negative negative higher buffer length len negative buffer size read cbuf len java io exception ioexception ensure open ensureopen check lines input stream reader inputstreamreader cbuf length len len cbuf length len index out of bounds exception indexoutofboundsexception len len do read doread cbuf eof read number read skip number filtered characters skip method calling read repeatedly number characters throwing result input reader reached skipped number characters method returns number characters skipped param number filtered characters skip number filtered characters skipped illegal argument exception illegalargumentexception negative io exception ioexception reading characters skip io exception ioexception illegal argument exception illegalargumentexception skip negative do read doread close esp reader espreader close java io exception ioexception input input close input don t dont close mark position stream code mark code code esp reader espreader code throwable param read ahead limit readaheadlimit number characters read exception io exception ioexception mark supported mark read ahead limit readaheadlimit io exception ioexception io exception ioexception mark supported stream supports mark operation mark supported mark supported marksupported reset stream code reset code method code esp reader espreader code throwable exception io exception ioexception reset supported reset io exception ioexception io exception ioexception reset supported internal routine foo two rk footwork reading character time code push back reader pushbackreader code acting current filter implemented finite machine defined code parse code constants situations decide steps char acters characters looked inserted input stream depending concrete character input stream current file io exception ioexception input code push back reader pushbackreader code do read doread io exception ioexception loop find character passing filter character input injected unread method input read eof proper returned line start linestart parse esp injection do verbatim doverbatim mark ended line start linestart start read injection marker finite machine template text text wrapped write parse esp start ecma expr input read ecma expression push state pushstate parse ecma expr compact start write startwrite line start linestart do verbatim doverbatim input unread start ecma code expr esp comment jsp comment input read input read ecma expression push state pushstate parse ecma expr start write startwrite line start linestart do verbatim doverbatim jsp comment input read push state pushstate parse jsp comment input unread ecma ecma code input unread push state pushstate parse ecma line start linestart do verbatim doverbatim special push read input unread input unread template text injected string line end lineend check real crlf input read input unread line end lineend line end lineend line end lineend write empty line start linestart do verbatim doverbatim do verbatim doverbatim line end lineend line start linestart line end lineend length matter do verbatim doverbatim do verbatim doverbatim line end lineend start write startwrite template text wrapped quotes occur ring occurring text escaped escape escape character do verbatim doverbatim string value of valueof line start linestart line start linestart start write startwrite parse ecma expr parse ecma input read pop state popstate parse ecma expr do verbatim doverbatim line start linestart input unread input read push state pushstate parse ecma comment l commentl push state pushstate parse ecma comment input unread ecma string start unescaped escape recognize quote char quotechar push state pushstate parse quote reading compact ecma expression parse ecma expr compact compact expression expression wrapped write pop state popstate do verbatim doverbatim esp write line start linestart reading jsp comment returning end ings endings parse jsp comment jsp comments comp lexly complexly input read input read input read reached pop state popstate input unread input unread input unread correct accurate terminate open template line start linestart push character input unread insert do verbatim doverbatim mark start line start linestart force read reading character comment read ecma string upto quote character parse quote unescaped quote character quote char quotechar escape pop state popstate mark escape escaped bug escape escape parse verbatim verbatim chars verbatimchars pop state popstate parse ecma comment input read pop state popstate do verbatim doverbatim input unread parse ecma comment l commentl input read pop state popstate input unread pop state popstate log warn do read doread unknown parse esp ensure open ensureopen io exception ioexception input io exception ioexception reader closed start write startwrite string start string startstring io exception ioexception start string startstring start string startstring length do verbatim doverbatim start string startstring do verbatim doverbatim write out undefined outundefined do verbatim doverbatim out init statement outinitstatement out undefined outundefined do verbatim doverbatim string verbatim string verbatimstring io exception ioexception input unread verbatim string verbatimstring to char array tochararray verbatim chars verbatimchars verbatim string verbatimstring length parse verbatim push state pushstate parse verbatim push state pushstate new state newstate state stack statestack push new state newstate pop state popstate old state oldstate state stack statestack is empty isempty parse esp state stack statestack pop old state oldstate