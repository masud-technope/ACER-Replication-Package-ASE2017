licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling launchpad base shared java beans int rospector introspector java file java file filter filefilter java file output stream fileoutputstream java file name filter filenamefilter java i o exception ioexception java input stream inputstream java output stream outputstream java net jarurlconnection java net malformedurlexception java net uri java net url java net url connection urlconnection java util array list arraylist java util collections java util java util list java util jar jar file jarfile org apache sling commons osgi bundle version bundleversion bundle version info bundleversioninfo org apache sling commons osgi bundle version bundleversion file bundle version info filebundleversioninfo code loader code utility methods actual launch ers launchers launching framework loader launchpad folder constructor file launchpad home launchpadhome file ext lib home extlibhome external library string extension lib path ext creates loader instance load launchpad folder ensuring existence launchpad folder constructor removes launcher jar files sling folder cleaning previous upgrades param launchpad home launchpadhome launchpad folder code code empty string illegal argument exception illegalargumentexception code launchpad home launchpadhome code argument code code empty string launchpad folder exists directory sling folder created loader file launchpad home launchpadhome launchpad home launchpadhome illegal argument exception illegalargumentexception launchpad folder empty launchpad home launchpadhome get launchpad home file getlaunchpadhomefile launchpad home launchpadhome ext lib home extlibhome get extension lib home getextensionlibhome remove old launcher jars removeoldlauncherjars creates url class loader urlclassloader launcher jar file launchpad home launchpadhome directory loads returns launcher identified launcher class name launcherclassname param launcher class name launcherclassname fully qualified implementing launcher constructor arguments launcher instance loaded newly created class loader classloader null pointer exception nullpointerexception launcher class name launcherclassname illegal argument exception illegalargumentexception launcher class name launcherclassname instantiated failure contained exception object load launcher loadlauncher string launcher class name launcherclassname file launcher jar file launcherjarfile get launcher jar file getlauncherjarfile info loading launcher launcher class name launcherclassname launcher jar file launcherjarfile get name getname launcher jar file launcherjarfile can read canread illegal argument exception illegalargumentexception sling launcher jar launcher jar file launcherjarfile accessible class loader classloader loader loader launcher class loader launcherclassloader launcher jar file launcherjarfile get ext libs getextlibs malformedurlexception illegal argument exception illegalargumentexception create url jar path launcher class launcherclass loader load class loadclass launcher class name launcherclassname launcher class launcherclass new instance newinstance class not found exception classnotfoundexception cnfe illegal argument exception illegalargumentexception find launcher class name launcherclassname launcher jar file launcherjarfile cnfe instantiation exception instantiationexception illegal argument exception illegalargumentexception instantiate launcher launcher class name launcherclassname illegal access exception illegalaccessexception illegal argument exception illegalargumentexception access constructor launcher class name launcherclassname remove traces loaded framework java not ably notably traces removed java beans javabeans property caches close launcher jar file opened platform method called not ifier notifier called cleanupvm ensure java beans javabeans intro spec tor introspector classes have d haved cached intro spection introspection int rospector introspector flush caches flushcaches sling check close launcher jar jar file jarfile cached platform close launcher jar file closelauncherjarfile get launcher jar file getlauncherjarfile copies contents launcher jar url sling directory existing file bundle version supplied launcher jar file replaced code code launcher jar file installed updated code code i o exception ioexception error occurrs transfer ring transferring contents install launcher jar installlauncherjar url launcher jar launcherjar i o exception ioexception info checking launcher jar folder launchpad home launchpadhome file current launcher jar file currentlauncherjarfile get launcher jar file getlauncherjarfile copy launcher jar temporary file extract bundle version info url connection urlconnection launcher jar conn launcherjarconn launcher jar launcherjar open connection openconnection launcher jar conn launcherjarconn set use caches setusecaches file tmp file launchpad home launchpadhome loader tmp system current time millis currenttimemillis shared constants sharedconstants launcher jar rel path spool launcher jar conn launcherjarconn get input stream getinputstream tmp file bundle version info filebundleversioninfo new vi newvi file bundle version info filebundleversioninfo tmp install new launcher installnewlauncher new vi newvi is bundle isbundle i o exception ioexception launcher jar bundle version info launcher jar launcherjar compare versions decide existing launcher jar current launcher jar file currentlauncherjarfile exists file bundle version info filebundleversioninfo current vi currentvi file bundle version info filebundleversioninfo current launcher jar file currentlauncherjarfile current vi currentvi is bundle isbundle i o exception ioexception existing launcher jar bundle version info current launcher jar file currentlauncherjarfile get absolute path getabsolutepath string info current vi currentvi compare to compareto new vi newvi info install new launcher installnewlauncher current vi currentvi compare to compareto new vi newvi info install new launcher installnewlauncher info info existing launcher info get bundle info getbundleinfo current vi currentvi current launcher jar file currentlauncherjarfile get name getname install new launcher installnewlauncher file file tmp get parent file getparentfile shared constants sharedconstants launcher jar rel path system current time millis currenttimemillis tmp rename to renameto i o exception ioexception failed rename tmp get name getname get name getname info ins talling installing launcher launcher jar launcherjar get bundle info getbundleinfo new vi newvi get name getname tmp exists tmp delete install new launcher installnewlauncher relevant bundle version info logging string get bundle info getbundleinfo bundle version info bundleversioninfo string builder stringbuilder string builder stringbuilder append get version getversion is snapshot issnapshot append modified append get bundle last modified getbundlelastmodified to string tostring removes candidate launcher jar files leaving launcher jar file sling startup remove old launcher jars removeoldlauncherjars file launcher jars launcherjars get launcher jar files getlauncherjarfiles launcher jars launcherjars launcher jars launcherjars length remove files current file current get launcher jar file getlauncherjarfile file launcher jars launcherjars get absolute path getabsolutepath equals current get absolute path getabsolutepath string version info versioninfo file bundle version info filebundleversioninfo file bundle version info filebundleversioninfo version info versioninfo get bundle info getbundleinfo i o exception ioexception info deleting obsolete launcher jar get name getname version info versioninfo delete ensure current file standard launcher shared constants sharedconstants launcher jar rel path equals current get name getname info renaming current launcher jar current get name getname shared constants sharedconstants launcher jar rel path file launcher file name launcherfilename file current get parent file getparentfile shared constants sharedconstants launcher jar rel path current rename to renameto launcher file name launcherfilename s pools spools contents input stream file replacing contents file contents input stream method returns input stream guaranteed closed i o exception ioexception error occurrs reading writing input stream contents spool input stream inputstream ins file dest file destfile i o exception ioexception output stream outputstream file output stream fileoutputstream dest file destfile buf ins read buf write buf ins ins close i o exception ioexception ignore close i o exception ioexception ignore internal helper returns code file code object representing launcher jar file sling folder file get launcher jar file getlauncherjarfile file result file launcher jars launcherjars get launcher jar files getlauncherjarfiles launcher jars launcherjars launcher jars launcherjars length existing file naming desired primary result file launchpad home launchpadhome shared constants sharedconstants launcher jar rel path file result launcher jars launcherjars launcher jars launcherjars length result returns files code launchpad home launchpadhome code directory considered launcher jar files sorted based bundle version files start link shared constants sharedconstants launcher jar rel path list empty launcher jar file installed list candidate launcher jar files empty code code returned error occurs list files file get launcher jar files getlauncherjarfiles list files names starting prefix file raw list rawlist launchpad home launchpadhome list files listfiles file filter filefilter accept file path name pathname path name pathname is file isfile path name pathname get name getname starts with startswith shared constants sharedconstants launcher jar rel path valid bundle headers sort bundle version numbers list file bundle version info filebundleversioninfo list array list arraylist file bundle version info filebundleversioninfo file raw list rawlist file bundle version info filebundleversioninfo fvi fvi file bundle version info filebundleversioninfo i o exception ioexception ioe illegal state exception illegalstateexception read bundle loader file get absolute path getabsolutepath fvi is bundle isbundle list add fvi collections sort list file result file list size file bundle version info filebundleversioninfo fvi list result fvi get source getsource result returns code launchpad home launchpadhome code path directory directory exist created creation fails code launchpad home launchpadhome code exists directory code illegal argument exception illegalargumentexception code thrown param launchpad home launchpadhome sling directory launcher jar files stored sling directory illegal argument exception illegalargumentexception code launchpad home launchpadhome code exists directory created directory file get launchpad home file getlaunchpadhomefile file launchpad home launchpadhome launchpad home launchpadhome exists launchpad home launchpadhome is directory isdirectory illegal argument exception illegalargumentexception sling launchpad home launchpadhome exists directory launchpad home launchpadhome mkdirs illegal argument exception illegalargumentexception sling launchpad home launchpadhome created directory launchpad home launchpadhome close launcher jar file closelauncherjarfile file launcher jar launcherjar uri launcher jar uri launcherjaruri launcher jar launcherjar touri url launcher jar root launcherjarroot url jar launcher jar uri launcherjaruri url connection urlconnection conn launcher jar root launcherjarroot open connection openconnection conn jarurlconnection jar file jarfile jar file jarfile jarurlconnection conn get jar file getjarfile jar file jarfile close exception meant overridden display log info info string msg file get extension lib home getextensionlibhome check sling initialized launchpad home launchpadhome launchpad home launchpadhome exists illegal argument exception illegalargumentexception sling initialized assumes launchpad home launchpadhome initialized file ext lib file extlibfile file launchpad home launchpadhome extension lib path ext lib file extlibfile exists ext lib file extlibfile is directory isdirectory illegal argument exception illegalargumentexception sling extension lib ext lib file extlibfile exists directory info sling extension lib ext lib file extlibfile ext lib file extlibfile file get ext libs getextlibs ext lib home extlibhome ext lib home extlibhome exists info external libs ext exists file file libs ext lib home extlibhome list files listfiles file name filter filenamefilter accept file dir string ends with endswith jar libs libs file string builder stringbuilder log string bldr logstringbldr string builder stringbuilder sling extension jars file lib libs log string bldr logstringbldr append lib log string bldr logstringbldr append log string bldr logstringbldr append info log string bldr logstringbldr to string tostring libs