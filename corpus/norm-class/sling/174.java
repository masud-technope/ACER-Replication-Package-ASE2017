licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling scripting sightly impl html dom java util collection java util map java util stack org apache commons lang string utils stringutils org apache sling scripting sightly impl compiler syntax org apache sling scripting sightly impl compiler frontend compiler context compilercontext org apache sling scripting sightly impl compiler frontend element context elementcontext org apache sling scripting sightly impl compiler frontend expression parser expressionparser org apache sling scripting sightly impl compiler frontend expression wrapper expressionwrapper org apache sling scripting sightly impl compiler frontend fragment org apache sling scripting sightly impl compiler frontend int erpolation interpolation org apache sling scripting sightly impl compiler ris command patterns org apache sling scripting sightly impl filter expression context expressioncontext org apache sling scripting sightly impl filter filter org apache sling scripting sightly impl compiler expression expression org apache sling scripting sightly impl compiler expression expression node expressionnode org apache sling scripting sightly impl compiler expression node binary operation binaryoperation org apache sling scripting sightly impl compiler expression node binary operator binaryoperator org apache sling scripting sightly impl compiler expression node boolean constant booleanconstant org apache sling scripting sightly impl compiler expression node identifier org apache sling scripting sightly impl compiler expression node string constant stringconstant org apache sling scripting sightly impl plugin markup context markupcontext org apache sling scripting sightly impl plugin plugin org apache sling scripting sightly impl plugin plugin call info plugincallinfo org apache sling scripting sightly impl plugin plugin invoke plugininvoke org apache sling scripting sightly impl compiler ris command conditional org apache sling scripting sightly impl compiler ris command out text outtext org apache sling scripting sightly impl compiler ris command out variable outvariable org apache sling scripting sightly impl compiler ris command variable binding variablebinding org apache sling scripting sightly impl compiler util symbol generator symbolgenerator org apache sling scripting sightly impl compiler util stream push stream pushstream org apache sling scripting sightly impl html markup utils markuputils org slf logger org slf logger factory loggerfactory implementation markup handler markup handler markuphandler logger log logger factory loggerfactory get logger getlogger markup handler markuphandler push stream pushstream stream symbol generator symbolgenerator symbol generator symbolgenerator symbol generator symbolgenerator expression parser expressionparser expression parser expressionparser expression parser expressionparser map string plugin plugin registry pluginregistry compiler context compilercontext compiler context compilercontext expression wrapper expressionwrapper expression wrapper expressionwrapper stack element context elementcontext element stack elementstack stack element context elementcontext markup handler markuphandler push stream pushstream stream map string plugin plugin registry pluginregistry collection filter filters stream stream plugin registry pluginregistry plugin registry pluginregistry expression wrapper expressionwrapper expression wrapper expressionwrapper filters compiler context compilercontext compiler context compilercontext symbol generator symbolgenerator expression wrapper expressionwrapper on open tag start onopentagstart string markup string tag name tagname element context elementcontext context element context elementcontext tag name tagname markup element stack elementstack push context on attribute onattribute string string element context elementcontext context element stack elementstack peek syntax is plugin attribute ispluginattribute handle plugin handleplugin string utils stringutils default string defaultstring context context add attribute addattribute on open tag end onopentagend string markup element context elementcontext context element stack elementstack peek plugin invoke plugininvoke invoke context plugin invoke plugininvoke invoke before element beforeelement stream context get tag name gettagname sly tag slytag sly equals ignore case equalsignorecase context get tag name gettagname sly tag slytag patterns begin stream ignore beginstreamignore stream invoke before tag open beforetagopen stream context get open tag start markup getopentagstartmarkup invoke before attributes beforeattributes stream traverse attributes traverseattributes context invoke invoke after attributes afterattributes stream markup invoke after tag open aftertagopen stream sly tag slytag patterns end stream ignore endstreamignore stream invoke before children beforechildren stream traverse attributes traverseattributes element context elementcontext context plugin invoke plugininvoke invoke map entry string object attribute context get attributes getattributes string attr name attrname attribute get key getkey object content obj contentobj attribute get value getvalue content obj contentobj content obj contentobj string string content string content obj contentobj emit attribute emitattribute attr name attrname content invoke content obj contentobj map entry map entry entry map entry content obj contentobj plugin call info plugincallinfo info plugin call info plugincallinfo entry get key getkey expression expression expression entry get value getvalue invoke on plugin call onplugincall stream info expression emit attribute emitattribute string string content plugin invoke plugininvoke invoke invoke before attribute beforeattribute stream content emit simple text attribute emitsimpletextattribute invoke int erpolation interpolation int erpolation interpolation expression parser expressionparser parse int erpolation parseinterpolation content string text try as simple text tryassimpletext int erpolation interpolation text emit simple text attribute emitsimpletextattribute text invoke emit expression attribute emitexpressionattribute int erpolation interpolation invoke invoke after attribute afterattribute stream emit simple text attribute emitsimpletextattribute string string text value textvalue plugin invoke plugininvoke invoke emit attribute start emitattributestart invoke before attribute value beforeattributevalue stream string constant stringconstant text value textvalue text value textvalue emit attribute value start emitattributevaluestart text value textvalue escape quotes escapequotes text value textvalue text value textvalue emit attribute end emitattributeend invoke after attribute value afterattributevalue stream string escape quotes escapequotes string text value textvalue text value textvalue replace quot emit expression attribute emitexpressionattribute string int erpolation interpolation int erpolation interpolation plugin invoke plugininvoke invoke int erpolation interpolation attribute checked attributechecked int erpolation interpolation int erpolation interpolation size emit single fragment emitsinglefragment int erpolation interpolation invoke emit multiple fragment emitmultiplefragment int erpolation interpolation invoke emit multiple fragment emitmultiplefragment string int erpolation interpolation int erpolation interpolation plugin invoke plugininvoke invoke simplified algorithm attribute output works int erpolation interpolation size attribute skip test alt ogether altogether expression expression expression wrapper expressionwrapper transform int erpolation interpolation get attribute markup context getattributemarkupcontext expression context expressioncontext attribute string attr content attrcontent symbol generator symbolgenerator attr content attrcontent string should display attr shoulddisplayattr symbol generator symbolgenerator should display attr shoulddisplayattr stream emit variable binding variablebinding start attr content attrcontent expression get root getroot stream emit variable binding variablebinding start should display attr shoulddisplayattr binary operation binaryoperation binary operator binaryoperator identifier attr content attrcontent binary operation binaryoperation binary operator binaryoperator string constant stringconstant identifier attr content attrcontent stream emit conditional start should display attr shoulddisplayattr emit attribute start emitattributestart invoke before attribute value beforeattributevalue stream expression get root getroot emit attribute value start emitattributevaluestart stream emit out variable outvariable attr content attrcontent emit attribute end emitattributeend invoke after attribute value afterattributevalue stream stream emit conditional stream emit variable binding variablebinding stream emit variable binding variablebinding emit single fragment emitsinglefragment string int erpolation interpolation int erpolation interpolation plugin invoke plugininvoke invoke raw expression expression value expression valueexpression expression wrapper expressionwrapper transform int erpolation interpolation expression context expressioncontext attribute holds raw attribute string attr value attrvalue symbol generator symbolgenerator attr value attrvalue holds escaped attribute string attr content attrcontent symbol generator symbolgenerator attr content attrcontent holds comparison attr value attrvalue string is true var istruevar symbol generator symbolgenerator is true attr istrueattr string should display attr shoulddisplayattr symbol generator symbolgenerator should display attr shoulddisplayattr markup context markupcontext markup context markupcontext get attribute markup context getattributemarkupcontext expression content expression contentexpression value expression valueexpression with node withnode identifier attr value attrvalue expression node expressionnode node value expression valueexpression get root getroot attr content attrcontent expr stream emit variable binding variablebinding start attr value attrvalue node stream emit variable binding variablebinding start attr content attrcontent expression wrapper expressionwrapper adjust to context adjusttocontext content expression contentexpression markup context markupcontext expression context expressioncontext attribute get root getroot stream emit variable binding variablebinding start should display attr shoulddisplayattr binary operation binaryoperation binary operator binaryoperator identifier attr content attrcontent binary operation binaryoperation binary operator binaryoperator string constant stringconstant identifier attr value attrvalue attr content attrcontent stream emit conditional start should display attr shoulddisplayattr write attr name attrname emit attribute start emitattributestart invoke before attribute value beforeattributevalue stream node stream emit is true attr istrueattr attr value attrvalue variable binding variablebinding start is true attr istrueattr attr value attrvalue is true var istruevar binary operation binaryoperation binary operator binaryoperator identifier attr value attrvalue boolean constant booleanconstant is true attr istrueattr stream emit conditional start is true var istruevar write emit attribute value start emitattributevaluestart write attr content attrcontent stream emit out variable outvariable attr content attrcontent write emit attribute end emitattributeend is true attr istrueattr stream emit conditional scope is true attr istrueattr stream emit variable binding variablebinding invoke after attribute value afterattributevalue stream attr content attrcontent stream emit conditional stream emit variable binding variablebinding scope attr content attrcontent stream emit variable binding variablebinding scope attr value attrvalue stream emit variable binding variablebinding emit attribute start emitattributestart string emit attribute value start emitattributevaluestart emit attribute end emitattributeend on close tag onclosetag string markup element context elementcontext context element stack elementstack pop plugin invoke plugininvoke invoke context plugin invoke plugininvoke invoke after children afterchildren stream self closing tag selfclosingtag string utils stringutils is empty isempty markup sly tag slytag sly equals ignore case equalsignorecase context get tag name gettagname sly tag slytag patterns begin stream ignore beginstreamignore stream invoke before tag close beforetagclose stream self closing tag selfclosingtag markup invoke after tag close aftertagclose stream self closing tag selfclosingtag sly tag slytag patterns end stream ignore endstreamignore stream invoke after element afterelement stream on text ontext string text string tag current element tag currentelementtag explicit context required explicitcontextrequired is explicit context required isexplicitcontextrequired tag markup context markupcontext markup context markupcontext explicit context required explicitcontextrequired markup context markupcontext text out text outtext text markup context markupcontext on comment oncomment string markup syntax is sightly comment issightlycomment markup out text outtext markup markup context markupcontext comment on data node ondatanode string markup markup on doc type ondoctype string markup markup on document finished ondocumentfinished stream signal done signaldone out text outtext string content markup context markupcontext context int erpolation interpolation int erpolation interpolation expression parser expressionparser parse int erpolation parseinterpolation content context int erpolation interpolation require context requirecontext int erpolation interpolation string text try as simple text tryassimpletext int erpolation interpolation text text out expr node outexprnode expression wrapper expressionwrapper transform int erpolation interpolation context expression context expressioncontext text get root getroot int erpolation interpolation require context requirecontext int erpolation interpolation int erpolation interpolation int erpolation interpolation result int erpolation interpolation fragment fragment int erpolation interpolation get fragments getfragments fragment added fragment addedfragment fragment is string isstring added fragment addedfragment fragment fragment get expression getexpression contains option containsoption syntax context option added fragment addedfragment fragment string current tag currenttag current element tag currentelementtag log warn element requires expressions explicit context expression replaced empty string current tag currenttag added fragment addedfragment fragment expr expression string constant stringconstant empty result add fragment addfragment added fragment addedfragment result int erpolation interpolation attribute checked attributechecked string attribute name attributename int erpolation interpolation int erpolation interpolation markup utils markuputils is sensitive attribute issensitiveattribute attribute name attributename int erpolation interpolation int erpolation interpolation new int erpolation newinterpolation int erpolation interpolation fragment fragment int erpolation interpolation get fragments getfragments fragment added fragment addedfragment fragment fragment is expression isexpression expression expression fragment get expression getexpression expression contains option containsoption syntax context option log warn expressions attribute explicit context option expression erased attribute name attributename added fragment addedfragment fragment text new int erpolation newinterpolation add fragment addfragment added fragment addedfragment new int erpolation newinterpolation out expr node outexprnode expression node expressionnode node string variable symbol generator symbolgenerator stream emit variable binding variablebinding start variable node stream emit out variable outvariable variable stream emit variable binding variablebinding string try as simple text tryassimpletext int erpolation interpolation int erpolation interpolation int erpolation interpolation size fragment fragment int erpolation interpolation get fragment getfragment fragment is string isstring fragment get text gettext int erpolation interpolation size string text stream emit out text outtext text handle plugin handleplugin string string element context elementcontext context plugin call info plugincallinfo call info callinfo syntax parse plugin attribute parsepluginattribute call info callinfo plugin plugin obtain plugin obtainplugin call info callinfo get name getname expression context expressioncontext expression context expressioncontext expression context expressioncontext get context for plugin getcontextforplugin plugin expression expr expression wrapper expressionwrapper transform expression parser expressionparser parse int erpolation parseinterpolation expression context expressioncontext plugin invoke plugininvoke invoke plugin invoke expr call info callinfo compiler context compilercontext context add plugin addplugin invoke plugin priority context add plugin call addplugincall call info callinfo expr plugin obtain plugin obtainplugin string plugin plugin plugin registry pluginregistry plugin unsupported operation exception unsupportedoperationexception string format plugin exist plugin markup context markupcontext get attribute markup context getattributemarkupcontext string attribute name attributename src equals ignore case equalsignorecase attribute name attributename href equals ignore case equalsignorecase attribute name attributename markup context markupcontext uri markup context markupcontext attribute string current element tag currentelementtag element stack elementstack is empty isempty element context elementcontext current element stack elementstack peek current get tag name gettagname is explicit context required isexplicitcontextrequired string parent element name parentelementname parent element name parentelementname script equals parent element name parentelementname style equals parent element name parentelementname