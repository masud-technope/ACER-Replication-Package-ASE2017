licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling jcr base org apache sling jcr api name space mapper namespacemapper org apache sling service user mapping serviceusermapping service user mapper serviceusermapper org apache sling testing mock jcr mock jcr mockjcr org junit test org mockito mockito org osgi framework bundle javax jcr java lang reflect invocation handler invocationhandler java lang reflect proxy java util dictionary org mockito mockito org junit session proxy handler test sessionproxyhandlertest method verifies session proxy repository manager created proxy instance kind code session proxy handler sessionproxyhandler session proxy invocation handler sessionproxyinvocationhandler code test test proxy testproxy repository exception repositoryexception create mock session mocksession mock impersonate method call impersonate method doesn implemented session session mockito spy mock jcr mockjcr new session newsession admin admin space adminspace session imper session impersession mock jcr mockjcr new session newsession test test space testspace do return doreturn imper session impersession session impersonate create proxy handle proxy session session proxy handler sessionproxyhandler proxy handler proxyhandler session proxy handler sessionproxyhandler custom sling repository manager customslingrepositorymanager session proxy session proxysession proxy handler proxyhandler create proxy createproxy session session for test sessionfortest proxy link imper session impersession object session session for test sessionfortest proxy session proxysession impersonate invocation handler invocationhandler handler proxy get invocation handler getinvocationhandler session for test sessionfortest checking proxy session proxysession kind session proxy handler sessionproxyhandler session proxy invocation handler sessionproxyinvocationhandler proxy object creation works fine assert equals assertequals session proxy handler sessionproxyhandler session proxy invocation handler sessionproxyinvocationhandler handler get class getclass checking methods proxy object works doesn call impersonate method assert not null assertnotnull session for test sessionfortest get root node getrootnode assert not null assertnotnull session for test sessionfortest get repository getrepository create custom repository manager repositorymanager support namespace mapping code oak sling repository manager oakslingrepositorymanager code lies code org apache sling jcr oak server code creates circular dependencies module custom sling repository manager customslingrepositorymanager abstract sling repository manager abstractslingrepositorymanager override service user mapper serviceusermapper get service user mapper getserviceusermapper override repository acquire repository acquirerepository override dictionary string object get service registration properties getserviceregistrationproperties override abstract sling repository abstractslingrepository create bundle using bundle usingbundle override destroy abstract sling repository abstractslingrepository repository service instance repositoryserviceinstance override dispose repository disposerepository repository repository override name space mapper namespacemapper get name space mapper services getnamespacemapperservices name space mapper namespacemapper