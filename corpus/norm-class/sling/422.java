licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling event impl jobs tasks java io exception ioexception java object input stream objectinputstream java util hash map hashmap java util list java util map org apache sling api resource persistence exception persistenceexception org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling api resource value map valuemap org apache sling discovery instance description instancedescription org apache sling event impl jobs job topic traverser jobtopictraverser org apache sling event impl jobs config job manager configuration jobmanagerconfiguration org apache sling event impl jobs config queue configuration manager queueconfigurationmanager org apache sling event impl jobs config queue configuration manager queueconfigurationmanager queue info queueinfo org apache sling event impl jobs config topology capabilities topologycapabilities org apache sling event impl support environment org apache sling event impl support resource helper resourcehelper org apache sling event jobs job org slf logger org slf logger factory loggerfactory upgrade task upgrade jobs earlier versions format upgrade task upgradetask logger logger logger logger factory loggerfactory get logger getlogger get class getclass job manager configuration job manager configuration jobmanagerconfiguration configuration capabilities topology capabilities topologycapabilities caps constructor param config configuration upgrade task upgradetask job manager configuration jobmanagerconfiguration config configuration config caps configuration get topology capabilities gettopologycapabilities upgrade caps is leader isleader process jobs from previous versions processjobsfrompreviousversions upgrade bridged jobs upgradebridgedjobs upgrade bridged jobs previous versions bridged jobs stored special topic changed jobs stored real topic upgrade bridged jobs upgradebridgedjobs string path configuration get local jobs path getlocaljobspath sling event slingevent event admin eventadmin resource resolver resourceresolver resolver configuration create resource resolver createresourceresolver resolver resource root resource rootresource resolver get resource getresource path root resource rootresource upgrade bridged jobs upgradebridgedjobs root resource rootresource caps is leader isleader resource unassigned root unassignedroot resolver get resource getresource configuration get unassigned jobs path getunassignedjobspath sling event slingevent event admin eventadmin unassigned root unassignedroot upgrade bridged jobs upgradebridgedjobs unassigned root unassignedroot resolver close upgrade bridged jobs param root resource rootresource root resource topic resource upgrade bridged jobs upgradebridgedjobs resource topic resource topicresource string topic name topicname topic resource topicresource get name getname replace queue configuration manager queueconfigurationmanager qcm configuration get queue configuration manager getqueueconfigurationmanager qcm queue info queueinfo info qcm get queue info getqueueinfo topic name topicname job topic traverser jobtopictraverser traverse logger topic resource topicresource job topic traverser jobtopictraverser resource callback resourcecallback override handle resource rsrc value map valuemap resource helper resourcehelper get value map getvaluemap rsrc string target id targetid caps detect target detecttarget topic name topicname info map string object props hash map hashmap string object string new path newpath target id targetid new path newpath configuration get ass gined jobs path getassginedjobspath target id targetid topic resource topicresource get name getname rsrc get path getpath substring topic resource topicresource get path getpath length props job property job queue info queue name queuename props job property job target instance target id targetid new path newpath configuration get unassigned jobs path getunassignedjobspath topic resource topicresource get name getname rsrc get path getpath substring topic resource topicresource get path getpath length props remove job property job queue props remove job property job target instance props remove job property job started time resource helper resourcehelper get or create resource getorcreateresource topic resource topicresource get resource resolver getresourceresolver new path newpath props topic resource topicresource get resource resolver getresourceresolver delete rsrc topic resource topicresource get resource resolver getresourceresolver commit persistence exception persistenceexception logger warn unable move job previous version rsrc get path getpath topic resource topicresource get resource resolver getresourceresolver refresh topic resource topicresource get resource resolver getresourceresolver revert instantiation exception instantiationexception logger warn unable move job previous version rsrc get path getpath topic resource topicresource get resource resolver getresourceresolver refresh topic resource topicresource get resource resolver getresourceresolver revert caps is active isactive handle jobs previous versions moving unassigned area process jobs from previous versions processjobsfrompreviousversions resource resolver resourceresolver resolver configuration create resource resolver createresourceresolver resolver process jobs from previous versions processjobsfrompreviousversions resolver get resource getresource configuration get previous version anon path getpreviousversionanonpath process jobs from previous versions processjobsfrompreviousversions resolver get resource getresource configuration get previous version ide ntified path getpreviousversionidentifiedpath persistence exception persistenceexception logger warn problems moving jobs previous version resolver close recursively find jobs move process jobs from previous versions processjobsfrompreviousversions resource rsrc persistence exception persistenceexception rsrc caps is active isactive rsrc is resource type isresourcetype resource helper resourcehelper resource type job move job from previous version movejobfrompreviousversion rsrc resource child rsrc get children getchildren process jobs from previous versions processjobsfrompreviousversions child caps is active isactive rsrc get resource resolver getresourceresolver delete rsrc rsrc get resource resolver getresourceresolver commit rsrc get resource resolver getresourceresolver refresh move single job move job from previous version movejobfrompreviousversion resource job resource jobresource persistence exception persistenceexception resource resolver resourceresolver resolver job resource jobresource get resource resolver getresourceresolver value map valuemap resource helper resourcehelper get value map getvaluemap job resource jobresource check binary properties map string object binary properties binaryproperties hash map hashmap string object object input stream objectinputstream ois sling event slingevent properties object input stream objectinputstream ois length ois read int readint length string key string ois read object readobject object ois read object readobject binary properties binaryproperties key class not found exception classnotfoundexception cnfe persistence exception persistenceexception cnfe java invalid class exception invalidclassexception ice persistence exception persistenceexception invalid ice io exception ioexception ioe persistence exception persistenceexception unable deserialize job properties ioe ois close io exception ioexception ioe persistence exception persistenceexception unable deserialize job properties ioe map string object properties resource helper resourcehelper clone value map clonevaluemap string topic string properties remove sling event slingevent topic properties resource helper resourcehelper property job topic topic properties remove job property job queue properties remove job property job target instance binary properties properties put all putall binary properties binaryproperties properties remove sling event slingevent properties properties contains key containskey job property job retries dummy updated queue properties job property job retries properties contains key containskey job property job retry count properties job property job retry count list instance description instancedescription potential targets potentialtargets caps get potential targets getpotentialtargets topic string target id targetid potential targets potentialtargets potential targets potentialtargets size queue configuration manager queueconfigurationmanager qcm configuration get queue configuration manager getqueueconfigurationmanager qcm resolver revert queue info queueinfo info qcm get queue info getqueueinfo topic logger debug queue info queue configuration queueconfiguration topic target id targetid caps detect target detecttarget topic info target id targetid properties job property job queue info queue name queuename properties job property job target instance target id targetid properties job property job retries info queue configuration queueconfiguration get max retries getmaxretries properties job property job created instance environment application properties resource resolver resourceresolver property resource type resource helper resourcehelper resource type job string job id jobid configuration get unique id getuniqueid topic properties resource helper resourcehelper property job job id jobid properties remove job property job started time string new path newpath configuration get unique path getuniquepath target id targetid topic job id jobid logger debug moving job job resource jobresource get path getpath new path newpath resource helper resourcehelper get or create resource getorcreateresource resolver new path newpath properties resolver delete job resource jobresource resolver commit instantiation exception instantiationexception persistence exception persistenceexception exception reading reasource get message getmessage get cause getcause