licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling testing samples integration tests integrationtests server side serverside sling post java byte array input stream bytearrayinputstream java byte array output stream bytearrayoutputstream java file java file input stream fileinputstream java file output stream fileoutputstream java io exception ioexception java input stream inputstream java output stream outputstream java nio charset charset java util hash map hashmap java util iterator java util map junit framework org apache commons io utils ioutils org apache http http response httpresponse org apache http client methods http post httppost org apache http entity mime multipart entity multipartentity org apache http entity mime content content body contentbody org apache http entity mime content input stream body inputstreambody org apache http entity mime content string body stringbody org apache sling commons json json object jsonobject org apache sling servlets post sling post constants slingpostconstants org apache sling testing tools sling sling test base slingtestbase org junit test org slf logger org slf logger factory loggerfactory sling post chunk upload test slingpostchunkuploadtest sling test base slingtestbase logger log logger factory loggerfactory get logger getlogger get class getclass string chunk node chunk string jcr content jcr content file cutter filecutter file cutter filecutter file cutter filecutter string parent path parentpath tmp test chunk upload int err uption interruption test test chunk upload testchunkupload create file file file create file createfile helloworld chunk size chunksize string node name nodename file get name getname upload chunks uploadchunks parent path parentpath file node name nodename chunk size chunksize integer max retrieve stream validate content uploaded file http response httpresponse response http get httpget parent path parentpath node name nodename input stream inputstream fis file input stream fileinputstream file assert equals assertequals content stream doesn match io utils ioutils content equals contentequals fis byte array input stream bytearrayinputstream get request executor getrequestexecutor get content getcontent get bytes getbytes fis close clean uploaded file repository map string string req params reqparams hash map hashmap string string req params reqparams sling post constants slingpostconstants operation delete response upload multi part uploadmultipart parent path parentpath node name nodename req params reqparams status response http get httpget parent path parentpath node name nodename assert equals assertequals status response get status line getstatusline get status code getstatuscode file delete exception log error error fail exception caught get message getmessage test chunk upload int err uption interruption test variable chunk size int err uption interruption client ret rieves retrieves chunk upload resume upload variable chunk size test test interrupted chunk upload testinterruptedchunkupload create bytes file file file create file createfile helloworld string node name nodename file get name getname chunk size chunksize uplaod chunk bytes uploaded upload chunks uploadchunks parent path parentpath file node name nodename chunk size chunksize json object jsonobject json get chunk json getchunkjson parent path parentpath node name nodename validate json chunk size chunksize upload chunks total bytes uploaded upload chunks uploadchunks parent path parentpath file node name nodename chunk size chunksize json get chunk json getchunkjson parent path parentpath node name nodename validate json chunk size chunksize upload chunk total bytes chunks uploaded upload chunks uploadchunks parent path parentpath file node name nodename json get int getint sling post constants slingpostconstants sling chunks length chunk size chunksize json get chunk json getchunkjson parent path parentpath node name nodename validate json chunk size chunksize upload chunks uploadchunks parent path parentpath file node name nodename json get int getint sling post constants slingpostconstants sling chunks length chunk size chunksize integer max http response httpresponse response http get httpget parent path parentpath node name nodename input stream inputstream fis file input stream fileinputstream file assert equals assertequals content stream doesn match io utils ioutils content equals contentequals fis byte array input stream bytearrayinputstream get request executor getrequestexecutor get content getcontent get bytes getbytes fis close clean uploaded file repository map string string req params reqparams hash map hashmap string string req params reqparams sling post constants slingpostconstants operation delete response upload multi part uploadmultipart parent path parentpath node name nodename req params reqparams status response http get httpget parent path parentpath node name nodename assert equals assertequals status response get status line getstatusline get status code getstatuscode file delete exception log error error fail exception caught get message getmessage test concurrent chunk upload fail test deletion incomplete upload test upload path test test concurrent chunk upload testconcurrentchunkupload create bytes file file file create file createfile helloworld string node name nodename file get name getname chunk size chunksize uplaod chunk bytes uploaded upload chunks uploadchunks parent path parentpath file node name nodename chunk size chunksize json object jsonobject json get chunk json getchunkjson parent path parentpath file get name getname validate json create bytes file file second file secondfile create file createfile hello earth helloearth chunk size chunksize uploaded upload chunks uploadchunks parent path parentpath second file secondfile node name nodename chunk size chunksize fail upload fail exception ignore upload chunks uploadchunks parent path parentpath second file secondfile node name nodename chunk size chunksize fail upload fail exception ignore clean uploaded file repository map string string req params reqparams hash map hashmap string string req params reqparams sling post constants slingpostconstants operation delete req params reqparams apply to chunks applytochunks http response httpresponse response upload multi part uploadmultipart parent path parentpath file get name getname req params reqparams assert equals assertequals status response get status line getstatusline get status code getstatuscode chunk size chunksize upload chunks uploadchunks parent path parentpath second file secondfile node name nodename chunk size chunksize integer max response http get httpget parent path parentpath node name nodename input stream inputstream fis file input stream fileinputstream second file secondfile assert equals assertequals content stream doesn match io utils ioutils content equals contentequals fis byte array input stream bytearrayinputstream get request executor getrequestexecutor get content getcontent get bytes getbytes fis close clean uploaded file repository req params reqparams hash map hashmap string string req params reqparams sling post constants slingpostconstants operation delete response upload multi part uploadmultipart parent path parentpath node name nodename req params reqparams status response http get httpget parent path parentpath node name nodename assert equals assertequals status response get status line getstatusline get status code getstatuscode file delete second file secondfile delete exception log error error fail exception caught get message getmessage test chunk upload midway test test mid way chunk upload testmidwaychunkupload file file create bytes file file create file createfile helloworld chunk size chunksize upload chunks uploadchunks parent path parentpath file file get name getname chunk size chunksize fail upload fail exception ignore exception log error error fail exception caught get message getmessage file delete test upload existing node test binary content doesn updated chunk upload fin ishes finishes test test chunk upload on existing node testchunkuploadonexistingnode create bytes file file file create file createfile helloworld string node name nodename file get name getname input stream inputstream fis file input stream fileinputstream file upload multi part uploadmultipart parent path parentpath fis file get name getname fis close http response httpresponse response http get httpget parent path parentpath node name nodename fis file input stream fileinputstream file assert equals assertequals content stream doesn match io utils ioutils content equals contentequals fis byte array input stream bytearrayinputstream get request executor getrequestexecutor get content getcontent get bytes getbytes fis close create bytes file file second file secondfile create file createfile hello earth helloearth chunk size chunksize uplaod chunk bytes uploaded upload chunks uploadchunks parent path parentpath second file secondfile node name nodename chunk size chunksize json object jsonobject json get chunk json getchunkjson parent path parentpath node name nodename validate json response http get httpget parent path parentpath node name nodename fis file input stream fileinputstream file assert equals assertequals content stream doesn match io utils ioutils content equals contentequals fis byte array input stream bytearrayinputstream get request executor getrequestexecutor get content getcontent get bytes getbytes fis close upload chunks uploadchunks parent path parentpath second file secondfile node name nodename chunk size chunksize integer max response http get httpget parent path parentpath node name nodename fis file input stream fileinputstream second file secondfile assert equals assertequals content stream doesn match io utils ioutils content equals contentequals fis byte array input stream bytearrayinputstream get request executor getrequestexecutor get content getcontent get bytes getbytes fis close clean uploaded file repository map string string req params reqparams hash map hashmap string string req params reqparams sling post constants slingpostconstants operation delete response upload multi part uploadmultipart parent path parentpath node name nodename req params reqparams status response http get httpget parent path parentpath node name nodename assert equals assertequals status response get status line getstatusline get status code getstatuscode file delete second file secondfile delete exception log error error fail exception caught get message getmessage test file size advance file parameter completed file completion test test chunk upload on str eaming testchunkuploadonstreaming create bytes file file file create file createfile helloworld string node name nodename file get name getname input stream inputstream fis file input stream fileinputstream file chunk size chunksize upload part uploadpart parent path parentpath file file get name getname chunk size chunksize upload part uploadpart parent path parentpath file file get name getname chunk size chunksize upload part uploadpart parent path parentpath file file get name getname chunk size chunksize fis close file second file secondfile create file createfile helloworld http response httpresponse response http get httpget parent path parentpath node name nodename fis file input stream fileinputstream second file secondfile assert equals assertequals content stream doesn match io utils ioutils content equals contentequals fis byte array input stream bytearrayinputstream get request executor getrequestexecutor get content getcontent get bytes getbytes fis close clean uploaded file repository map string string req params reqparams hash map hashmap string string req params reqparams sling post constants slingpostconstants operation delete response upload multi part uploadmultipart parent path parentpath node name nodename req params reqparams status response http get httpget parent path parentpath node name nodename assert equals assertequals status response get status line getstatusline get status code getstatuscode file delete second file secondfile delete exception log error error fail exception caught get message getmessage create temporary file size file create file createfile string base string basestring times exception output stream outputstream file file file file create temp file createtempfile test chunk upload chunkupload create bytes file string data append string appendstring base string basestring times file output stream fileoutputstream file io utils ioutils write data close file exists exception file get absolute path getabsolutepath close exception ignore file query chunk upload json json object jsonobject get chunk json getchunkjson string path exception json object jsonobject json http response httpresponse response http get httpget path json string json str jsonstr get request executor getrequestexecutor get content getcontent json json object jsonobject json str jsonstr json jcr content json json getjsonobject jcr content json validate json object jsonobject json bytes uploaded bytesuploaded expected chunks expectedchunks exception assert equals assertequals bytes uploaded bytesuploaded didn match bytes uploaded bytesuploaded json opt int optint sling post constants slingpostconstants sling chunks length chunk count chunkcount iterator string itr json itr itr has next hasnext string key itr key starts with startswith chunk node chunk count chunkcount assert equals assertequals chunks uploaded chunksuploaded didn match expected chunks expectedchunks chunk count chunkcount upload num of chunks numofchunks number chunks starting offset size equals chunk size chunksize file reached upload chunks uploadchunks string path file file string node name nodename off set offset chunk size chunksize num of chunks numofchunks exception length file length int value intvalue chunk number chunknumber off set offset length chunk number chunknumber num of chunks numofchunks off set offset chunk size chunksize length chunk size chunksize length off set offset upload part uploadpart path file node name nodename file length off set offset chunk size chunksize off set offset chunk size chunksize chunk number chunknumber chunk number chunknumber upload single chunk starting offset size chunk size chunksize param type hint typehint todo http response httpresponse upload part uploadpart string path file file string node name nodename length off set offset integer chunk size chunksize is complete iscomplete exception buf file cutter filecutter cut file cutfile file off set offset chunk size chunksize log debug thread current thread currentthread get name getname uploading bytes off set offset off set offset chunk size chunksize byte array input stream bytearrayinputstream ins tream instream byte array input stream bytearrayinputstream buf map string string req params reqparams hash map hashmap string string req params reqparams node name nodename sling post constants slingpostconstants suffix offset string value of valueof off set offset length req params reqparams node name nodename sling post constants slingpostconstants suffix length to string tostring length is complete iscomplete req params reqparams node name nodename sling post constants slingpostconstants suffix completed is complete iscomplete to string tostring upload multi part uploadmultipart path req params reqparams ins tream instream node name nodename send multipart post request server http response httpresponse upload multi part uploadmultipart string path map string string req params reqparams input stream inputstream ins string file name filename exception charset utf charset available chars ets availablecharsets utf multipart entity multipartentity req entity reqentity multipart entity multipartentity http post httppost http post httppost http post httppost get request builder getrequestbuilder build url buildurl path req params reqparams map entry string string entry req params reqparams entry set entryset string key entry get key getkey string entry get value getvalue req entity reqentity add part addpart key string body stringbody utf ins content body contentbody content body contentbody input stream body inputstreambody ins file name filename req entity reqentity add part addpart file name filename content body contentbody http post httppost set entity setentity req entity reqentity http response httpresponse response get request executor getrequestexecutor execute get request builder getrequestbuilder build other request buildotherrequest http post httppost with credentials withcredentials get server username getserverusername get server password getserverpassword get response getresponse status response get status line getstatusline get status code getstatuscode status status log debug response status status log debug output get request executor getrequestexecutor get content getcontent exception response get status line getstatusline get reason phrase getreasonphrase response send http request server http response httpresponse http get httpget string path exception get request executor getrequestexecutor execute get request builder getrequestbuilder build get request buildgetrequest path with credentials withcredentials get server username getserverusername get server password getserverpassword get response getresponse create string base string basestring times string append string appendstring string base string basestring times string buffer stringbuffer buf string buffer stringbuffer base string basestring times buf append base string basestring buf to string tostring file cut ter cutter utility file cutter filecutter cut file slice length size starting off set offset offset size file length cut file cutfile file file off set offset size io exception ioexception file input stream fileinputstream fis fis file input stream fileinputstream file fis skip off set offset tmp size byte array output stream bytearrayoutputstream baos byte array output stream bytearrayoutputstream fis read tmp baos write tmp baos to byte array tobytearray fis close