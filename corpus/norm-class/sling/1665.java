licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling testing tools jar exec jarexec java file java io exception ioexception java util arrays java util properties java util regex pattern org apache commons exec command line commandline org apache commons exec default executor defaultexecutor org apache commons exec execute exception executeexception org apache commons exec execute result handler executeresulthandler org apache commons exec executor org apache commons exec pump stream handler pumpstreamhandler org slf logger org slf logger factory loggerfactory start runnable jar for king forking jvm process terminate process exits jar executor jarexecutor file jar to execute jartoexecute string jvm full path jvmfullpath server port serverport properties config executor executor logger log logger factory loggerfactory get logger getlogger get class getclass port exit timeout string jar folder target dependency string jar regexp org apache sling jar string prop prefix jar executor string prop server port prop prefix server port string prop jar folder prop prefix jar folder string prop jar regexp prop prefix jar regexp string prop options prop prefix options string prop work folder prop prefix work folder string prop jar options prop prefix jar options string prop exit timeout seconds prop prefix exit timeout seconds string prop wait onshutdown prop prefix wait shutdown string prop java path prop prefix java executable path string prop sync exec prop prefix sync hronous synchronous exec string prop sync exec expected prop prefix sync hronous synchronous exec expected result suppress warnings suppresswarnings serial executor exception executorexception exception executor exception executorexception string reason reason executor exception executorexception string reason throwable reason override string to string tostring get class getclass get simple name getsimplename jar to execute jartoexecute get name getname port server port serverport get server port getserverport server port serverport build jar executor jarexecutor locate jar jar executor jarexecutor properties config executor exception executorexception config config is windows iswindows system get property getproperty to lower case tolowercase windows string port str portstr config get property getproperty prop server port server port serverport port str portstr port integer value of valueof port str portstr string config jvm path configjvmpath config get property getproperty prop java path config jvm path configjvmpath string java executable javaexecutable is windows iswindows java exe java jvm full path jvmfullpath system get property getproperty java file separator bin file separator java executable javaexecutable jvm full path jvmfullpath config jvm path configjvmpath string jar folder path jarfolderpath config get property getproperty prop jar folder jar folder path jarfolderpath jar folder path jarfolderpath jar folder jar folder path jarfolderpath file jar folder jarfolder file jar folder path jarfolderpath string jar name regexp jarnameregexp config get property getproperty prop jar regexp jar name regexp jarnameregexp jar name regexp jarnameregexp jar regexp jar name regexp jarnameregexp pattern jar pattern jarpattern pattern compile jar name regexp jarnameregexp find executable jar string candidates jar folder jarfolder list candidates executor exception executorexception files jar folder prop jar folder property jar folder jarfolder get absolute path getabsolutepath file string filename candidates jar pattern jarpattern matcher filename matches file jar folder jarfolder filename executor exception executorexception executable jar matching jar pattern jarpattern jar folder jarfolder get absolute path getabsolutepath candidates arrays as list aslist candidates jar to execute jartoexecute start jar setup runtime hook start exception execute result handler executeresulthandler execute result handler executeresulthandler on process failed onprocessfailed execute exception executeexception log error process execution failed on process complete onprocesscomplete result log info process execution complete exit code result string vm options vmoptions config get property getproperty prop options executor default executor defaultexecutor command line commandline command line commandline jvm full path jvmfullpath vm options vmoptions vm options vmoptions length add arguments addarguments vm options vmoptions add argument addargument jar add argument addargument jar to execute jartoexecute get absolute path getabsolutepath additional options jar executed jar exec jarexec server port replaced server port serverport string jar options jaroptions config get property getproperty prop jar options jar options jaroptions jar options jaroptions length jar options jaroptions jar options jaroptions replace all replaceall jar exec jarexec server port string value of valueof server port serverport log info executable jar options jar options jaroptions add arguments addarguments jar options jaroptions string work folder option workfolderoption config get property getproperty prop work folder work folder option workfolderoption work folder option workfolderoption length file work folder workfolder file work folder option workfolderoption work folder workfolder is directory isdirectory io exception ioexception work dir prop work folder option exist work folder workfolder get absolute path getabsolutepath log info setting working directory executable jar work folder workfolder get absolute path getabsolutepath executor set working directory setworkingdirectory work folder workfolder string tm str tmstr config get property getproperty prop exit timeout seconds exit timeout seconds exittimeoutseconds tm str tmstr exit timeout integer value of valueof tm str tmstr equals config get property getproperty prop sync exec start system current time millis currenttimemillis log info exec uting executing waiting result result executor execute expected integer value of valueof config get property getproperty prop sync exec expected log info execution system current time millis currenttimemillis start msec result expected executor exception executorexception expected result code expected result log info exec uting executing async hronously asynchronously executor set stream handler setstreamhandler pump stream handler pumpstreamhandler shutdown hook single process destroyer shutdownhooksingleprocessdestroyer shutdown hook single process destroyer shutdownhooksingleprocessdestroyer java jar jar to execute jartoexecute get name getname exit timeout seconds exittimeoutseconds wait on shutdown waitonshutdown value of valueof config get property getproperty prop wait onshutdown log info setting process destroyer processdestroyer wait on shutdown waitonshutdown wait on shutdown waitonshutdown set wait on shutdown setwaitonshutdown wait on shutdown waitonshutdown executor set process destroyer setprocessdestroyer executor execute process started wait exit returning executor illegal state exception illegalstateexception process started executor object executor get process destroyer getprocessdestroyer shutdown hook single process destroyer shutdownhooksingleprocessdestroyer shutdown hook single process destroyer shutdownhooksingleprocessdestroyer destroy process destroyprocess log info process dest royed destroyed illegal state exception illegalstateexception runnable destroy process