licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling core java i o exception ioexception java unsupported encoding exception unsupportedencodingexception java net malformedurlexception java net url java net url encoder urlencoder java util hash map hashmap java util iterator java util map java util map entry java util regex pattern javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse org apache sling api authenticator org apache sling api resource resource resolver resourceresolver org apache sling api resource resource util resourceutil org apache sling core spi authentication handler authenticationhandler org slf logger org slf logger factory loggerfactory code auth util authutil code utility functions implementations link org apache sling core spi authentication handler authenticationhandler services users sling authentication infrastructure utility extended instantiated bundle version auth util authutil request header commonly ajax frame works frameworks request pos ted posted ajax request expected link xml http request header j query jquery extjs prototype client side java script javascript framework is ajax request isajaxrequest javax servlet http http servlet request httpservletrequest string requested requested expected link requested request header identify request ajax request is ajax request isajaxrequest javax servlet http http servlet request httpservletrequest string xml http request xml http request xmlhttprequest request header providing clients user agent link is browser request isbrowserrequest http servlet request httpservletrequest decide request browser string user agent user agent string contained link user agent header indicating mozilla browser examples browsers firefox generally gecko based browsers safari chrome generally web kit webkit based browsers microsoft string browser mozilla mozilla string contained link user agent header indicating opera browser browser opera browser string browser opera opera instantiation auth util authutil returns named request attribute parameter string request attribute empty string returned empty request parameter parameter returned code default value defaultvalue code returned param request request attribute request parameter param attribute parameter param default value defaultvalue empty string attribute empty parameter exists request attribute parameter code default value defaultvalue code defined string get attribute or parameter getattributeorparameter http servlet request httpservletrequest request string string default value defaultvalue string resource attr resourceattr get attribute string getattributestring request resource attr resourceattr resource attr resourceattr string resource request get parameter getparameter resource resource length resource default value defaultvalue returns resource target redirect successful authentication method returns empty string code default login resource defaultloginresource code parameter code resource code request attribute checked empty string returned code resource code request parameter checked returned empty string param request request providing attribute parameter param default login resource defaultloginresource login resource empty redirect ion redirection target code default login resource defaultloginresource code string get login resource getloginresource http servlet request httpservletrequest request string default login resource defaultloginresource get attribute or parameter getattributeorparameter request authenticator login resource default login resource defaultloginresource ensures returns link authenticator login resource request attribute empty string attribute method sets link authenticator login resource request parameter empty string parameter code default value defaultvalue code empty string attribute param request request check resource attribute param default value defaultvalue attribute request parameter parameter code code empty string returns resource request attribute string set login resource attribute setloginresourceattribute http servlet request httpservletrequest request string default value defaultvalue string resource attr resourceattr get attribute string getattributestring request authenticator login resource resource attr resourceattr string resource par resourcepar request get parameter getparameter authenticator login resource resource par resourcepar resource par resourcepar length resource attr resourceattr resource par resourcepar default value defaultvalue default value defaultvalue length resource attr resourceattr default value defaultvalue resource attr resourceattr request set attribute setattribute authenticator login resource resource attr resourceattr resource attr resourceattr redirects target path app ending appending parameters parameter map method functionality code params code map code code link authenticator login resource resource entry entry generated request uri optional query string code request code parameters code params code map single link authenticator login resource resource parameter target path redirect parameter encoded code java net url encoder urlencoder code utf encoding safe requests checking redirect target creating target url parameter map response buffer reset code http servlet response httpservletresponse send redirect sendredirect code called headers calling method preserved param request request object current request uri request query string code params code map link authenticator login resource resource parameter param response response send redirect client param target redirect target validate path prefixed request servlet context path parameter valid target request link is redirect valid isredirectvalid http servlet request httpservletrequest string method target modified root request context param params map parameters target path code code i o exception ioexception error occurs sending redirect request illegal state exception illegalstateexception response committed partial url converted valid url internal error internalerror utf character encoding supported platform caught real problem encoding required specification missing send redirect sendredirect http servlet request httpservletrequest request http servlet response httpservletresponse response string target map string string params i o exception ioexception check and reset checkandreset response string builder stringbuilder string builder stringbuilder auth util authutil is redirect valid isredirectvalid request target append target request get context path getcontextpath length append append request get context path getcontextpath params params hash map hashmap string string ensure login resource redirect params authenticator login resource string resource request getrequesturi request get query string getquerystring resource request get query string getquerystring params authenticator login resource resource append iterator entry string string params entry set entryset iterator has next hasnext entry string string entry entry get key getkey entry get value getvalue append entry get key getkey append append url encoder urlencoder encode entry get value getvalue utf unsupported encoding exception unsupportedencodingexception uee internal error internalerror unexpected unsupported encoding exception unsupportedencodingexception utf has next hasnext append response send redirect sendredirect to string tostring returns request attribute empty string param request request retrieve attribute param attribute named request attribute code code attribute empty string string get attribute string getattributestring http servlet request httpservletrequest request string object res obj resobj request get attribute getattribute res obj resobj string string res obj resobj length string res obj resobj empty string returns code code client asks validation sub mitted submitted username password credentials implementation returns code code request parameter link par validate code code ins ensitve insensitve request parameter code code method returns code code param request request provide parameter check code code link par validate parameter code code is validate request isvalidaterequest http servlet request httpservletrequest request equals ignore case equalsignorecase request get parameter getparameter auth constants authconstants par validate s ends sends response credential validation request method over writes overwrites response status sends content content length header prevents caching clients proxies response headers calling methods preserved response param response response object illegal state exception illegalstateexception response committed send valid sendvalid http servlet response httpservletresponse response check and reset checkandreset response response set status setstatus http servlet response httpservletresponse explicitly content content type prevent fire fox firefox parse response sling response set content type setcontenttype text plain response set content length setcontentlength prevent client aggressively caching response sling response set header setheader pragma cache response set header setheader cache control cache response add header addheader cache control store response flush buffer flushbuffer i o exception ioexception ioe get log getlog error failed send response ioe s ends sends forbidden response option ally optionally stating reason response code link reason header link reason header link authentication handler authenticationhandler failure reason request attribute method over writes overwrites response status forbidden adds link auth constants authconstants reason header sends reason result response headers calling methods preserved response param request request object param response response object illegal state exception illegalstateexception response committed send invalid sendinvalid http servlet request httpservletrequest request http servlet response httpservletresponse response check and reset checkandreset response response set status setstatus http servlet response httpservletresponse forbidden object reason request get attribute getattribute authentication handler authenticationhandler failure reason object reason code reasoncode request get attribute getattribute authentication handler authenticationhandler failure reason code reason response set header setheader auth constants authconstants reason reason to string tostring reason code reasoncode response set header setheader auth constants authconstants reason code reason code reasoncode to string tostring response set content type setcontenttype text plain response set character encoding setcharacterencoding utf response get writer getwriter println reason response flush buffer flushbuffer i o exception ioexception ioe get log getlog error failed send for bidden forbidden response ioe check request authentication handler param request current request ref erer referer matches handler check ref erer checkreferer http servlet request httpservletrequest request string login form loginform sling ref erer referer header supplied check matches login path handler post equals request get method getmethod string ref erer referer request get header getheader ref erer referer ref erer referer string expected path expectedpath string format request get context path getcontextpath login form loginform url uri url ref erer referer expected path expectedpath equals uri get path getpath selector handle malformedurlexception get log getlog debug failed parse ref erer referer login form login form loginform returns code code redirect code target code valid list requirements code target code code code empty string code target code url identified character sequence code code sep arating separating scheme host code target code normalized consecutive slashes path segment single dot code target code prefixed servlet context path code resource resolver resourceresolver code request attribute code target code servlet context path prefix resolve existing resource code resource resolver resourceresolver code request attribute code target code absolute path starting slash character characters code code code code code code code code plain url encoding conditions hold method returns code code logs warning level message org apache sling core auth util authutil logger param request providing code resource resolver resourceresolver code attribute context resolve resource code target code code code target validated code res our e resolver resoureresolver code param target redirect target validate path prefixed request servlet context path code code redirect target considered valid is redirect valid isredirectvalid http servlet request httpservletrequest request string target target target length get log getlog warn is redirect valid isredirectvalid redirect target empty target get log getlog warn is redirect valid isredirectvalid redirect target url target target target target target ends with endswith target ends with endswith get log getlog warn is redirect valid isredirectvalid redirect target normalized target string ctx path ctxpath get context path getcontextpath request ctx path ctxpath length target starts with startswith ctx path ctxpath get log getlog warn is redirect valid isredirectvalid redirect target start servlet context path target ctx path ctxpath special req uesting requesting servlet context root path ctx path ctxpath length target length string local target localtarget target substring ctx path ctxpath length local target localtarget starts with startswith get log getlog warn is redirect valid isredirectvalid redirect target servlet context path absolute path target ctx path ctxpath query local target localtarget index of indexof string path query local target localtarget substring query local target localtarget resource resolver resourceresolver resolver get resource resolver getresourceresolver request resolver assume fine path res olves resolves resource resource util resourceutil is non existing resource isnonexistingresource resolver resolve request path resolving resource check illegal characters pattern illegal pattern compile illegal matcher path find get log getlog warn is redirect valid isredirectvalid redirect target target returns context path request empty string request code code string get context path getcontextpath http servlet request httpservletrequest request request request get context path getcontextpath returns resource resolver link authentication support authenticationsupport request attribute resolver request attribute code code request object code code resource resolver resource resolver resourceresolver get resource resolver getresourceresolver http servlet request httpservletrequest request request resource resolver resourceresolver request get attribute getattribute authentication support authenticationsupport request attribute resolver returns code code request assumed client browser fire fix firefix int ernet internet explorer method ins pects inspects code user agent code header returns code code header string mozilla contained firefox int ernet internet explorer web kit webkit based browsers user agent opera contained opera user agent param request request inspect code code request assumed browser is browser request isbrowserrequest http servlet request httpservletrequest request string user agent useragent request get header getheader user agent user agent useragent user agent useragent browser mozilla user agent useragent browser opera returns code code request considered ajax request code xml http request xmlhttprequest code browser host object request considered ajax request client sends requested request header code xml http request xmlhttprequest code param request current request code code request considered ajax request is ajax request isajaxrequest http servlet request httpservletrequest request xml http request equals request get header getheader requested checks response committed code illegal state exception illegalstateexception code thrown response buffer cleared leaving headers status untouched param response response check reset illegal state exception illegalstateexception response committed check and reset checkandreset http servlet response httpservletresponse response response is committed iscommitted illegal state exception illegalstateexception response committed response reset buffer resetbuffer helper method returning org apache sling core auth util authutil logger logger get log getlog logger factory loggerfactory get logger getlogger org apache sling core auth util authutil