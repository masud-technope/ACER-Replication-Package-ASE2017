licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling discovery impl common heartbeat org junit assert equals assertequals org junit assert false assertfalse org junit assert not null assertnotnull org junit assert null assertnull org junit assert true asserttrue org junit fail java util calendar java util hash set hashset java util iterator java util linked list linkedlist java util list java util javax jcr property org apache log level org apache log log manager logmanager org apache sling api resource modifiable value map modifiablevaluemap org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling api resource resource resolver factory resourceresolverfactory org apache sling discovery topology event topologyevent org apache sling discovery topology event listener topologyeventlistener org apache sling discovery topology view topologyview org apache sling discovery base setup virtual instance virtualinstance org apache sling discovery impl discovery service impl discoveryserviceimpl org apache sling discovery impl cluster voting voting helper votinghelper org apache sling discovery impl cluster voting voting view votingview org apache sling discovery impl setup fulljr virtual instance virtualinstance org apache sling discovery impl setup fulljr virtual instance builder virtualinstancebuilder org junit org junit org junit test org slf logger org slf logger factory loggerfactory junit x junitx util private accessor privateaccessor heartbeat test heartbeattest logger logger logger factory loggerfactory get logger getlogger get class getclass simple topology event listener simpletopologyeventlistener topology event listener topologyeventlistener list topology event topologyevent events linked list linkedlist topology event topologyevent topology event topologyevent last event lastevent event count eventcount string simple topology event listener simpletopologyeventlistener string override handle topology event handletopologyevent topology event topologyevent event events add event string msg event to string tostring topology view topologyview new view newview event get new view getnewview event get type gettype properties changed msg string value of valueof topology event topologyevent type properties changed topology changed msg topology event topologyevent type topology changed new view newview new view newview get instances getinstances size new view newview is current iscurrent new view newview is current iscurrent topology changing msg topology event topologyevent type topology changing old view oldview contained event get old view getoldview get instances getinstances size old view oldview is current iscurrent event get old view getoldview is current iscurrent topology init new view newview msg topology event topologyevent type topology init new view newview new view newview new view newview get instances getinstances msg topology event topologyevent type topology init new view newview instances new view newview new view newview is current iscurrent new view newview is current iscurrent msg topology event topologyevent type topology init new view newview new view newview get instances getinstances size new view newview is current iscurrent new view newview is current iscurrent logger factory loggerfactory get logger getlogger get class getclass info handle topology event handletopologyevent msg last event lastevent event event count eventcount get event count geteventcount event count eventcount topology event topologyevent get last event getlastevent last event lastevent virtual instance virtualinstance instances hash set hashset virtual instance virtualinstance level log level loglevel setup exception org apache log logger discovery logger discoverylogger log manager logmanager get root logger getrootlogger get logger getlogger org apache sling discovery log level loglevel discovery logger discoverylogger get level getlevel discovery logger discoverylogger set level setlevel level trace tear down teardown exception org apache log logger discovery logger discoverylogger log manager logmanager get root logger getrootlogger get logger getlogger org apache sling discovery discovery logger discoverylogger set level setlevel log level loglevel iterator virtual instance virtualinstance instances iterator has next hasnext virtual instance virtualinstance test test partitioning testpartitioning throwable do test partitioning dotestpartitioning test test partitioning with failing scheduler testpartitioningwithfailingscheduler throwable do test partitioning dotestpartitioning fulljr virtual instance builder virtualinstancebuilder new builder newbuilder fulljr virtual instance builder virtualinstancebuilder do test partitioning dotestpartitioning scheduler throwable logger info do test partitioning dotestpartitioning creating slow machine slowmachine fulljr virtual instance builder virtualinstancebuilder builder new builder newbuilder builder set debug name setdebugname slow new repository newrepository discovery impl set connector ping timeout setconnectorpingtimeout set connector ping interval setconnectorpinginterval set min event delay setmineventdelay with failing scheduler withfailingscheduler scheduler fulljr virtual instance virtualinstance slow machine slowmachine builder full build fullbuild assert equals assertequals slow machine slowmachine get discovery service getdiscoveryservice get topology gettopology get instances getinstances size assert equals assertequals slow machine slowmachine get sling id getslingid slow machine slowmachine get discovery service getdiscoveryservice get topology gettopology get instances getinstances iterator get sling id getslingid instances add slow machine slowmachine wait ensure slow machine slowmachine low erst lowerst leader election id leaderelectionid leader thread sleep simple topology event listener simpletopologyeventlistener slow listener slowlistener simple topology event listener simpletopologyeventlistener slow slow machine slowmachine bind topology event listener bindtopologyeventlistener slow listener slowlistener logger info do test partitioning dotestpartitioning creating fast machine fastmachine fulljr virtual instance builder virtualinstancebuilder fast builder fastbuilder new builder newbuilder fast builder fastbuilder set debug name setdebugname fast use repository of userepositoryof slow machine slowmachine set connector ping timeout setconnectorpingtimeout set connector ping interval setconnectorpinginterval set min event delay setmineventdelay with failing scheduler withfailingscheduler scheduler fulljr virtual instance virtualinstance fast machine fastmachine fast builder fastbuilder full build fullbuild assert equals assertequals fast machine fastmachine get discovery service getdiscoveryservice get topology gettopology get instances getinstances size assert equals assertequals fast machine fastmachine get sling id getslingid fast machine fastmachine get discovery service getdiscoveryservice get topology gettopology get instances getinstances iterator get sling id getslingid instances add fast machine fastmachine wait ensure fast machine fastmachine low erst lowerst leader election id leaderelectionid leader partitioning thread sleep simple topology event listener simpletopologyeventlistener fast listener fastlistener simple topology event listener simpletopologyeventlistener fast fast machine fastmachine bind topology event listener bindtopologyeventlistener fast listener fastlistener logger info do test partitioning dotestpartitioning creating fast machine fastmachine fulljr virtual instance builder virtualinstancebuilder full builder fullbuilder new builder newbuilder full builder fullbuilder set debug name setdebugname fast use repository of userepositoryof slow machine slowmachine set connector ping timeout setconnectorpingtimeout set connector ping interval setconnectorpinginterval set min event delay setmineventdelay with failing scheduler withfailingscheduler scheduler fulljr virtual instance virtualinstance fast machine fastmachine full builder fullbuilder full build fullbuild assert equals assertequals fast machine fastmachine get discovery service getdiscoveryservice get topology gettopology get instances getinstances size assert equals assertequals fast machine fastmachine get sling id getslingid fast machine fastmachine get discovery service getdiscoveryservice get topology gettopology get instances getinstances iterator get sling id getslingid instances add fast machine fastmachine simple topology event listener simpletopologyeventlistener fast listener fastlistener simple topology event listener simpletopologyeventlistener fast fast machine fastmachine bind topology event listener bindtopologyeventlistener fast listener fastlistener logger info do test partitioning dotestpartitioning creating fast machine fastmachine fulljr virtual instance builder virtualinstancebuilder full builder fullbuilder new builder newbuilder full builder fullbuilder set debug name setdebugname fast use repository of userepositoryof slow machine slowmachine set connector ping timeout setconnectorpingtimeout set connector ping interval setconnectorpinginterval set min event delay setmineventdelay with failing scheduler withfailingscheduler scheduler fulljr virtual instance virtualinstance fast machine fastmachine full builder fullbuilder full build fullbuild assert equals assertequals fast machine fastmachine get discovery service getdiscoveryservice get topology gettopology get instances getinstances size assert equals assertequals fast machine fastmachine get sling id getslingid fast machine fastmachine get discovery service getdiscoveryservice get topology gettopology get instances getinstances iterator get sling id getslingid instances add fast machine fastmachine simple topology event listener simpletopologyeventlistener fast listener fastlistener simple topology event listener simpletopologyeventlistener fast fast machine fastmachine bind topology event listener bindtopologyeventlistener fast listener fastlistener logger info do test partitioning dotestpartitioning creating fast machine fastmachine fulljr virtual instance builder virtualinstancebuilder full builder fullbuilder new builder newbuilder full builder fullbuilder set debug name setdebugname fast use repository of userepositoryof slow machine slowmachine set connector ping timeout setconnectorpingtimeout set connector ping interval setconnectorpinginterval set min event delay setmineventdelay with failing scheduler withfailingscheduler scheduler fulljr virtual instance virtualinstance fast machine fastmachine full builder fullbuilder full build fullbuild assert equals assertequals fast machine fastmachine get discovery service getdiscoveryservice get topology gettopology get instances getinstances size assert equals assertequals fast machine fastmachine get sling id getslingid fast machine fastmachine get discovery service getdiscoveryservice get topology gettopology get instances getinstances iterator get sling id getslingid instances add fast machine fastmachine simple topology event listener simpletopologyeventlistener fast listener fastlistener simple topology event listener simpletopologyeventlistener fast fast machine fastmachine bind topology event listener bindtopologyeventlistener fast listener fastlistener logger info do test partitioning dotestpartitioning logger info do test partitioning dotestpartitioning letting heartbeats instances loops logger info do test partitioning dotestpartitioning heartbeat handler heartbeathandler hh slow hhslow slow machine slowmachine get heartbeat handler getheartbeathandler logger info do test partitioning dotestpartitioning logger info do test partitioning dotestpartitioning pinging hh slow hhslow logger info do test partitioning dotestpartitioning lock hh slow hhslow hh slow hhslow issue heartbeat issueheartbeat hh slow hhslow do check view docheckview scheduler logger info do test partitioning dotestpartitioning logger info do test partitioning dotestpartitioning pinging fast machine fastmachine logger info do test partitioning dotestpartitioning lock fast machine fastmachine get heartbeat handler getheartbeathandler fast machine fastmachine get heartbeat handler getheartbeathandler issue heartbeat issueheartbeat fast machine fastmachine get heartbeat handler getheartbeathandler do check view docheckview logger info do test partitioning dotestpartitioning logger info do test partitioning dotestpartitioning pinging fast machine fastmachine logger info do test partitioning dotestpartitioning lock fast machine fastmachine get heartbeat handler getheartbeathandler fast machine fastmachine get heartbeat handler getheartbeathandler issue heartbeat issueheartbeat fast machine fastmachine get heartbeat handler getheartbeathandler do check view docheckview logger info do test partitioning dotestpartitioning logger info do test partitioning dotestpartitioning pinging fast machine fastmachine logger info do test partitioning dotestpartitioning lock fast machine fastmachine get heartbeat handler getheartbeathandler fast machine fastmachine get heartbeat handler getheartbeathandler issue heartbeat issueheartbeat fast machine fastmachine get heartbeat handler getheartbeathandler do check view docheckview logger info do test partitioning dotestpartitioning logger info do test partitioning dotestpartitioning pinging fast machine fastmachine logger info do test partitioning dotestpartitioning lock fast machine fastmachine get heartbeat handler getheartbeathandler fast machine fastmachine get heartbeat handler getheartbeathandler issue heartbeat issueheartbeat fast machine fastmachine get heartbeat handler getheartbeathandler do check view docheckview thread sleep stage fast slow instance logger info do test partitioning dotestpartitioning instances agreed assert not null assertnotnull fast listener fastlistener get last event getlastevent assert equals assertequals topology event topologyevent type topology init fast listener fastlistener get last event getlastevent get type gettype assert equals assertequals fast listener fastlistener get last event getlastevent get new view getnewview get instances getinstances size assert false assertfalse fast listener fastlistener get last event getlastevent get new view getnewview get local instance getlocalinstance is leader isleader assert not null assertnotnull fast listener fastlistener get last event getlastevent assert equals assertequals topology event topologyevent type topology init fast listener fastlistener get last event getlastevent get type gettype assert equals assertequals fast listener fastlistener get last event getlastevent get new view getnewview get instances getinstances size assert false assertfalse fast listener fastlistener get last event getlastevent get new view getnewview get local instance getlocalinstance is leader isleader assert not null assertnotnull fast listener fastlistener get last event getlastevent assert equals assertequals topology event topologyevent type topology init fast listener fastlistener get last event getlastevent get type gettype assert equals assertequals fast listener fastlistener get last event getlastevent get new view getnewview get instances getinstances size assert false assertfalse fast listener fastlistener get last event getlastevent get new view getnewview get local instance getlocalinstance is leader isleader assert not null assertnotnull fast listener fastlistener get last event getlastevent assert equals assertequals topology event topologyevent type topology init fast listener fastlistener get last event getlastevent get type gettype assert equals assertequals fast listener fastlistener get last event getlastevent get new view getnewview get instances getinstances size assert false assertfalse fast listener fastlistener get last event getlastevent get new view getnewview get local instance getlocalinstance is leader isleader assert not null assertnotnull slow listener slowlistener get last event getlastevent assert equals assertequals topology event topologyevent type topology init slow listener slowlistener get last event getlastevent get type gettype assert equals assertequals slow listener slowlistener get last event getlastevent get new view getnewview get instances getinstances size assert true asserttrue slow listener slowlistener get last event getlastevent get new view getnewview get local instance getlocalinstance is leader isleader slow instance heartbeat time d timed logger info do test partitioning dotestpartitioning letting slow machine slowmachine send heartbeats fast scheduler lock fast machine fastmachine get heartbeat handler getheartbeathandler fast machine fastmachine get heartbeat handler getheartbeathandler issue heartbeat issueheartbeat fast machine fastmachine get heartbeat handler getheartbeathandler do check view docheckview lock fast machine fastmachine get heartbeat handler getheartbeathandler fast machine fastmachine get heartbeat handler getheartbeathandler issue heartbeat issueheartbeat fast machine fastmachine get heartbeat handler getheartbeathandler do check view docheckview lock fast machine fastmachine get heartbeat handler getheartbeathandler fast machine fastmachine get heartbeat handler getheartbeathandler issue heartbeat issueheartbeat fast machine fastmachine get heartbeat handler getheartbeathandler do check view docheckview lock fast machine fastmachine get heartbeat handler getheartbeathandler fast machine fastmachine get heartbeat handler getheartbeathandler issue heartbeat issueheartbeat fast machine fastmachine get heartbeat handler getheartbeathandler do check view docheckview thread sleep logger info do test partitioning dotestpartitioning decoupled slow machine slowmachine fast listeners instances remaining logger info do test partitioning dotestpartitioning sleeping thread sleep logger info do test partitioning dotestpartitioning fast machines assert equals assertequals topology event topologyevent type topology changed fast listener fastlistener get last event getlastevent get type gettype assert equals assertequals fast listener fastlistener get last event getlastevent get new view getnewview get instances getinstances size assert equals assertequals topology event topologyevent type topology changed fast listener fastlistener get last event getlastevent get type gettype assert equals assertequals fast listener fastlistener get last event getlastevent get new view getnewview get instances getinstances size assert equals assertequals topology event topologyevent type topology changed fast listener fastlistener get last event getlastevent get type gettype assert equals assertequals fast listener fastlistener get last event getlastevent get new view getnewview get instances getinstances size assert equals assertequals topology event topologyevent type topology changed fast listener fastlistener get last event getlastevent get type gettype assert equals assertequals fast listener fastlistener get last event getlastevent get new view getnewview get instances getinstances size assert true asserttrue fast listener fastlistener get last event getlastevent get new view getnewview get local instance getlocalinstance is leader isleader assert false assertfalse fast listener fastlistener get last event getlastevent get new view getnewview get local instance getlocalinstance is leader isleader assert false assertfalse fast listener fastlistener get last event getlastevent get new view getnewview get local instance getlocalinstance is leader isleader assert false assertfalse fast listener fastlistener get last event getlastevent get new view getnewview get local instance getlocalinstance is leader isleader slow instance is olated isolated assert false assertfalse slow machine slowmachine get discovery service getdiscoveryservice get topology gettopology is current iscurrent assert equals assertequals slow machine slowmachine get discovery service getdiscoveryservice get topology gettopology get instances getinstances size assert equals assertequals topology event topologyevent type topology init slow listener slowlistener get last event getlastevent get type gettype assert equals assertequals topology event topologyevent type topology changing slow listener slowlistener get last event getlastevent get type gettype todo handle potential topology change handlepotentialtopologychange called handle topology changed handletopologychanged topology change handler topologychangehandler update properties updateproperties discovery service impl discoveryserviceimpl slow disco slowdisco discovery service impl discoveryserviceimpl slow machine slowmachine get discovery service getdiscoveryservice slow disco slowdisco update properties updateproperties triggered async event takes moment thread sleep assert equals assertequals topology event topologyevent type topology changing slow listener slowlistener get last event getlastevent get type gettype assert equals assertequals slow listener slowlistener get event count geteventcount topology view topologyview slow top o slowtopo slow machine slowmachine get discovery service getdiscoveryservice get topology gettopology assert not null assertnotnull slow top o slowtopo assert false assertfalse slow top o slowtopo is current iscurrent assert equals assertequals slow top o slowtopo get instances getinstances size scheduler lock fast machine fastmachine get heartbeat handler getheartbeathandler fast machine fastmachine get heartbeat handler getheartbeathandler issue heartbeat issueheartbeat fast machine fastmachine get heartbeat handler getheartbeathandler do check view docheckview lock fast machine fastmachine get heartbeat handler getheartbeathandler fast machine fastmachine get heartbeat handler getheartbeathandler issue heartbeat issueheartbeat fast machine fastmachine get heartbeat handler getheartbeathandler do check view docheckview lock fast machine fastmachine get heartbeat handler getheartbeathandler fast machine fastmachine get heartbeat handler getheartbeathandler issue heartbeat issueheartbeat fast machine fastmachine get heartbeat handler getheartbeathandler do check view docheckview lock fast machine fastmachine get heartbeat handler getheartbeathandler fast machine fastmachine get heartbeat handler getheartbeathandler issue heartbeat issueheartbeat fast machine fastmachine get heartbeat handler getheartbeathandler do check view docheckview hh slow hhslow issue heartbeat issueheartbeat hh slow hhslow do check view docheckview scheduler lock fast machine fastmachine get heartbeat handler getheartbeathandler fast machine fastmachine get heartbeat handler getheartbeathandler issue heartbeat issueheartbeat fast machine fastmachine get heartbeat handler getheartbeathandler do check view docheckview lock fast machine fastmachine get heartbeat handler getheartbeathandler fast machine fastmachine get heartbeat handler getheartbeathandler issue heartbeat issueheartbeat fast machine fastmachine get heartbeat handler getheartbeathandler do check view docheckview lock fast machine fastmachine get heartbeat handler getheartbeathandler fast machine fastmachine get heartbeat handler getheartbeathandler issue heartbeat issueheartbeat fast machine fastmachine get heartbeat handler getheartbeathandler do check view docheckview lock fast machine fastmachine get heartbeat handler getheartbeathandler fast machine fastmachine get heartbeat handler getheartbeathandler issue heartbeat issueheartbeat fast machine fastmachine get heartbeat handler getheartbeathandler do check view docheckview thread sleep cluster assert equals assertequals topology event topologyevent type topology changed fast listener fastlistener get last event getlastevent get type gettype assert equals assertequals fast listener fastlistener get last event getlastevent get new view getnewview get instances getinstances size assert equals assertequals topology event topologyevent type topology changed fast listener fastlistener get last event getlastevent get type gettype assert equals assertequals fast listener fastlistener get last event getlastevent get new view getnewview get instances getinstances size assert equals assertequals topology event topologyevent type topology changed fast listener fastlistener get last event getlastevent get type gettype assert equals assertequals fast listener fastlistener get last event getlastevent get new view getnewview get instances getinstances size assert equals assertequals topology event topologyevent type topology changed fast listener fastlistener get last event getlastevent get type gettype assert equals assertequals fast listener fastlistener get last event getlastevent get new view getnewview get instances getinstances size assert equals assertequals topology event topologyevent type topology changed slow listener slowlistener get last event getlastevent get type gettype assert equals assertequals slow listener slowlistener get last event getlastevent get new view getnewview get instances getinstances size sling rejoin partitioning slow machine slowmachine leader slow machine slowmachine dump repo dumprepo assert false assertfalse slow listener slowlistener get last event getlastevent get new view getnewview get local instance getlocalinstance is leader isleader assert true asserttrue fast listener fastlistener get last event getlastevent get new view getnewview get local instance getlocalinstance is leader isleader assert false assertfalse fast listener fastlistener get last event getlastevent get new view getnewview get local instance getlocalinstance is leader isleader assert false assertfalse fast listener fastlistener get last event getlastevent get new view getnewview get local instance getlocalinstance is leader isleader assert false assertfalse fast listener fastlistener get last event getlastevent get new view getnewview get local instance getlocalinstance is leader isleader tests machine slow sending heartbeats trigger fast machine kick topology slow topology changing topology changed sends heartbeats voting happen test test slow and fast machine testslowandfastmachine throwable do test slow and fast machine dotestslowandfastmachine test test slow and fast machine with failing scheduler testslowandfastmachinewithfailingscheduler throwable do test slow and fast machine dotestslowandfastmachine do test slow and fast machine dotestslowandfastmachine with failing scheduler withfailingscheduler throwable logger info do test slow and fast machine dotestslowandfastmachine creating slow machine slowmachine heartbeat runner fulljr virtual instance builder virtualinstancebuilder slow builder slowbuilder new builder newbuilder slow builder slowbuilder set debug name setdebugname slow new repository newrepository discovery impl set connector ping timeout setconnectorpingtimeout set connector ping interval setconnectorpinginterval set min event delay setmineventdelay with failing scheduler withfailingscheduler with failing scheduler withfailingscheduler fulljr virtual instance virtualinstance slow machine slowmachine slow builder slowbuilder full build fullbuild instances add slow machine slowmachine simple topology event listener simpletopologyeventlistener slow listener slowlistener simple topology event listener simpletopologyeventlistener slow slow machine slowmachine bind topology event listener bindtopologyeventlistener slow listener slowlistener logger info do test slow and fast machine dotestslowandfastmachine creating fast machine fastmachine heartbeat runner fulljr virtual instance builder virtualinstancebuilder fast builder fastbuilder new builder newbuilder fast builder fastbuilder set debug name setdebugname fast use repository of userepositoryof slow machine slowmachine set connector ping timeout setconnectorpingtimeout set connector ping interval setconnectorpinginterval set min event delay setmineventdelay with failing scheduler withfailingscheduler with failing scheduler withfailingscheduler fulljr virtual instance virtualinstance fast machine fastmachine fast builder fastbuilder full build fullbuild instances add fast machine fastmachine simple topology event listener simpletopologyeventlistener fast listener fastlistener simple topology event listener simpletopologyeventlistener fast fast machine fastmachine bind topology event listener bindtopologyeventlistener fast listener fastlistener heartbeat handler heartbeathandler hh slow hhslow slow machine slowmachine get heartbeat handler getheartbeathandler heartbeat handler heartbeathandler hh fast hhfast fast machine fastmachine get heartbeat handler getheartbeathandler thread sleep logger info do test slow and fast machine dotestslowandfastmachine event triggered assert false assertfalse fast machine fastmachine get discovery service getdiscoveryservice get topology gettopology is current iscurrent assert false assertfalse slow machine slowmachine get discovery service getdiscoveryservice get topology gettopology is current iscurrent assert null assertnull fast listener fastlistener get last event getlastevent assert null assertnull slow listener slowlistener get last event getlastevent rounds heartbeats instances logger info do test slow and fast machine dotestslowandfastmachine send couple heartbeats connect lock hh slow hhslow hh slow hhslow issue heartbeat issueheartbeat hh slow hhslow do check view docheckview lock hh fast hhfast hh fast hhfast issue heartbeat issueheartbeat hh fast hhfast do check view docheckview thread sleep logger info do test slow and fast machine dotestslowandfastmachine instances connected slow machine slowmachine dump repo dumprepo assert equals assertequals slow machine slowmachine get discovery service getdiscoveryservice get topology gettopology get instances getinstances size assert equals assertequals fast machine fastmachine get discovery service getdiscoveryservice get topology gettopology get instances getinstances size assert equals assertequals topology event topologyevent type topology init fast listener fastlistener get last event getlastevent get type gettype assert equals assertequals fast listener fastlistener get event count geteventcount assert equals assertequals topology event topologyevent type topology init slow listener slowlistener get last event getlastevent get type gettype assert equals assertequals slow listener slowlistener get event count geteventcount slow machine slow fast updates expected logger info do test slow and fast machine dotestslowandfastmachine heartbeat slow machine slowmachine lock hh slow hhslow hh slow hhslow issue heartbeat issueheartbeat logger info do test slow and fast machine dotestslowandfastmachine fast machine fastmachine sends heartbeats thread sleep lock hh fast hhfast hh fast hhfast issue heartbeat issueheartbeat hh fast hhfast do check view docheckview logger info do test slow and fast machine dotestslowandfastmachine fast machine fastmachine decoupled slow fast machine fastmachine dump repo dumprepo start vote hh fast hhfast do check view docheckview fast machine fastmachine dump repo dumprepo pro motion promotion hh fast hhfast do check view docheckview hh slow hhslow heartbeat time d timed hh fast hhfast hh slow hhslow fast machine fastmachine dump repo dumprepo assert equals assertequals topology event topologyevent type topology changed fast listener fastlistener get last event getlastevent get type gettype assert equals assertequals fast listener fastlistener get event count geteventcount assert equals assertequals fast machine fastmachine get discovery service getdiscoveryservice get topology gettopology get instances getinstances size topology view topologyview top o topo slow machine slowmachine get discovery service getdiscoveryservice get topology gettopology assert false assertfalse top o topo is current iscurrent hh slow hhslow check heartbeat check logger info do test slow and fast machine dotestslowandfastmachine slow machine slowmachine check view checkview detect decoupled hh slow hhslow do check view docheckview slow machine slowmachine dump repo dumprepo logger info do test slow and fast machine dotestslowandfastmachine slow machine slowmachine heartbeat lock hh slow hhslow hh slow hhslow issue heartbeat issueheartbeat assert equals assertequals topology event topologyevent type topology changed fast listener fastlistener get last event getlastevent get type gettype assert equals assertequals fast listener fastlistener get event count geteventcount assert equals assertequals topology event topologyevent type topology changing slow listener slowlistener get last event getlastevent get type gettype assert equals assertequals slow listener slowlistener get event count geteventcount thread sleep slow lsitener send topology changed logger info do test slow and fast machine dotestslowandfastmachine silence slow machine slowmachine remain changing assert equals assertequals topology event topologyevent type topology changing slow listener slowlistener get last event getlastevent get type gettype assert false assertfalse slow machine slowmachine get discovery service getdiscoveryservice get topology gettopology is current iscurrent assert equals assertequals slow listener slowlistener get event count geteventcount assert equals assertequals topology event topologyevent type topology changed fast listener fastlistener get last event getlastevent get type gettype assert equals assertequals fast machine fastmachine get discovery service getdiscoveryservice get topology gettopology get instances getinstances size assert equals assertequals fast listener fastlistener get event count geteventcount rounds heartbeats instances logger info do test slow and fast machine dotestslowandfastmachine fast slow issue heartbeats lock hh fast hhfast hh fast hhfast issue heartbeat issueheartbeat hh fast hhfast do check view docheckview lock hh slow hhslow hh slow hhslow issue heartbeat issueheartbeat hh slow hhslow do check view docheckview thread sleep logger info do test slow and fast machine dotestslowandfastmachine joined slow lsitener send topology changed assert equals assertequals topology event topologyevent type topology changed fast listener fastlistener get last event getlastevent get type gettype assert true asserttrue fast machine fastmachine get discovery service getdiscoveryservice get topology gettopology is current iscurrent assert equals assertequals fast machine fastmachine get discovery service getdiscoveryservice get topology gettopology get instances getinstances size assert equals assertequals fast listener fastlistener get event count geteventcount assert equals assertequals topology event topologyevent type topology changed slow listener slowlistener get last event getlastevent get type gettype assert true asserttrue slow machine slowmachine get discovery service getdiscoveryservice get topology gettopology is current iscurrent assert equals assertequals slow machine slowmachine get discovery service getdiscoveryservice get topology gettopology get instances getinstances size assert equals assertequals slow listener slowlistener get event count geteventcount object lock heartbeat handler heartbeathandler heartbeat handler heartbeathandler no such field exception nosuchfieldexception test rely private accessor privateaccessor get field getfield heartbeat handler heartbeathandler lock sling test reproduce voting loop verify fixed test test voting loop testvotingloop throwable logger info test voting loop testvotingloop creating slow machine slowmachine fulljr virtual instance builder virtualinstancebuilder slow builder slowbuilder new builder newbuilder slow builder slowbuilder set debug name setdebugname slow new repository newrepository discovery impl set connector ping timeout setconnectorpingtimeout set connector ping interval setconnectorpinginterval set min event delay setmineventdelay fulljr virtual instance virtualinstance slow machine slowmachine slow builder slowbuilder full build fullbuild instances add slow machine slowmachine simple topology event listener simpletopologyeventlistener slow listener slowlistener simple topology event listener simpletopologyeventlistener slow slow machine slowmachine bind topology event listener bindtopologyeventlistener slow listener slowlistener logger info test voting loop testvotingloop creating slow machine slowmachine fulljr virtual instance builder virtualinstancebuilder slow builder slowbuilder new builder newbuilder slow builder slowbuilder set debug name setdebugname slow use repository of userepositoryof slow machine slowmachine set connector ping timeout setconnectorpingtimeout set connector ping interval setconnectorpinginterval set min event delay setmineventdelay fulljr virtual instance virtualinstance slow machine slowmachine slow builder slowbuilder full build fullbuild instances add slow machine slowmachine simple topology event listener simpletopologyeventlistener slow listener slowlistener simple topology event listener simpletopologyeventlistener slow slow machine slowmachine bind topology event listener bindtopologyeventlistener slow listener slowlistener logger info test voting loop testvotingloop creating fast machine fastmachine fulljr virtual instance builder virtualinstancebuilder fast builder fastbuilder new builder newbuilder fast builder fastbuilder set debug name setdebugname fast use repository of userepositoryof slow machine slowmachine set connector ping timeout setconnectorpingtimeout set connector ping interval setconnectorpinginterval set min event delay setmineventdelay fulljr virtual instance virtualinstance fast machine fastmachine fast builder fastbuilder full build fullbuild instances add fast machine fastmachine simple topology event listener simpletopologyeventlistener fast listener fastlistener simple topology event listener simpletopologyeventlistener fast fast machine fastmachine bind topology event listener bindtopologyeventlistener fast listener fastlistener heartbeat handler heartbeathandler hh slow hhslow slow machine slowmachine get heartbeat handler getheartbeathandler heartbeat handler heartbeathandler hh slow hhslow slow machine slowmachine get heartbeat handler getheartbeathandler heartbeat handler heartbeathandler hh fast hhfast fast machine fastmachine get heartbeat handler getheartbeathandler thread sleep logger info test voting loop testvotingloop initial sleep event assert false assertfalse fast machine fastmachine get discovery service getdiscoveryservice get topology gettopology is current iscurrent assert false assertfalse slow machine slowmachine get discovery service getdiscoveryservice get topology gettopology is current iscurrent assert false assertfalse slow machine slowmachine get discovery service getdiscoveryservice get topology gettopology is current iscurrent assert null assertnull fast listener fastlistener get last event getlastevent assert null assertnull slow listener slowlistener get last event getlastevent assert null assertnull slow listener slowlistener get last event getlastevent prevent slow machine voting logger info test voting loop testvotingloop stop ping stopping voting slow machine slowmachine slow machine slowmachine stop voting stopvoting issue heartbeat logger info test voting loop testvotingloop letting slow slow fast issue heartbeat hh slow hhslow issue heartbeat issueheartbeat hh slow hhslow issue heartbeat issueheartbeat hh fast hhfast issue heartbeat issueheartbeat fast start voting fast vote slow doesn voting loop logger info test voting loop testvotingloop fast check view checkview init iate initiate voting hh fast hhfast do check view docheckview calendar previous voted at previousvotedat logger info test voting loop testvotingloop sleeping thread sleep logger info test voting loop testvotingloop check voting loop check ongoing votings resource resolver factory resourceresolverfactory factory fast machine fastmachine get resource resolver factory getresourceresolverfactory resource resolver resourceresolver resource resolver resourceresolver factory get administrative resource resolver getadministrativeresourceresolver list voting view votingview ongoing votings ongoingvotings voting helper votinghelper list open non winning votings listopennonwinningvotings resource resolver resourceresolver fast machine fastmachine get full config getfullconfig assert not null assertnotnull ongoing votings ongoingvotings assert equals assertequals ongoing votings ongoingvotings size voting view votingview ongoing vote ongoingvote ongoing votings ongoingvotings assert false assertfalse ongoing vote ongoingvote is winning iswinning assert false assertfalse ongoing vote ongoingvote has voted yes hasvotedyes slow machine slowmachine get sling id getslingid assert true asserttrue ongoing vote ongoingvote has voted yes hasvotedyes slow machine slowmachine get sling id getslingid resource member resource memberresource ongoing vote ongoingvote get resource getresource get child getchild members get child getchild slow machine slowmachine get sling id getslingid modifiable value map modifiablevaluemap member map membermap member resource memberresource adapt to adaptto modifiable value map modifiablevaluemap property vote property member map membermap vote assert equals assertequals vote get boolean getboolean property voted at votedat property member map membermap voted at votedat previous voted at previousvotedat previous voted at previousvotedat voted at votedat get date getdate assert equals assertequals previous voted at previousvotedat voted at votedat get date getdate exception resource resolver resourceresolver close fail exception