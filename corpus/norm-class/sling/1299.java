licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling security impl java i o exception ioexception java print writer printwriter java net inet address java net inet address java net inet address inetaddress java net malformedurlexception java net network interface networkinterface java net socket exception socketexception java net url java util array list arraylist java util arrays java util dictionary java util enumeration java util hash set hashset java util hashtable java util list java util java util regex pattern javax servlet filter javax servlet filter chain filterchain javax servlet filter config filterconfig javax servlet servlet exception servletexception javax servlet servlet request servletrequest javax servlet servlet response servletresponse javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse org apache felix scr annotations activate org apache felix scr annotations component org apache felix scr annotations deactivate org apache felix scr annotations property org apache felix scr annotations property unbounded propertyunbounded org apache felix scr annotations service org apache sling commons osgi properties util propertiesutil org osgi framework bundle context bundlecontext org osgi framework constants org osgi framework service registration serviceregistration org osgi service component component context componentcontext org slf logger org slf logger factory loggerfactory component metatype description referrer description label referrer property pattern property private propertyprivate service filter ref errer filter referrerfilter filter request header providing clients user agent link is browser request isbrowserrequest http servlet request httpservletrequest decide request browser string user agent user agent string contained link user agent header indicating mozilla browser examples browsers firefox generally gecko based browsers safari chrome generally web kit webkit based browsers microsoft string browser mozilla mozilla string contained link user agent header indicating opera browser browser opera browser string browser opera opera logger logger logger logger factory loggerfactory get logger getlogger get class getclass empty empty empty property property bool value boolvalue empty string prop empty empty string prop hosts referrer uri hosts property property unbounded property unbounded propertyunbounded array string prop hosts hosts referrer regex hosts property property unbounded property unbounded propertyunbounded array string prop hosts regex hosts regexp filtered methods property property unbounded property unbounded propertyunbounded array post delete string prop methods filter methods empty referrer allow empty allowempty allowed uri referrers url allowed uri ref errers allowedurireferrers allowed regexp referrers pattern allowed regex ref errers allowedregexreferrers methods filtered string filter methods filtermethods service registration serviceregistration config printer registration configprinterregistration create list referrers string get default allowed ref errers getdefaultallowedreferrers string referrers hash set hashset string enumeration network interface networkinterface ifaces network interface networkinterface get network interfaces getnetworkinterfaces ifaces has more elements hasmoreelements network interface networkinterface iface ifaces next element nextelement logger info adding allowed refer ers referers iface get display name getdisplayname enumeration inet address inetaddress ias iface get inet addr esses getinetaddresses ias has more elements hasmoreelements inet address inetaddress ias next element nextelement string address get host address gethostaddress trim to lower case tolowercase inet address referrers add http address referrers add https address inet address referrers add http address referrers add https address socket exception socketexception logger error unable detect net work network interfaces referrers add http localhost referrers add http referrers add http referrers add https localhost referrers add https referrers add https referrers add list url urls string url url urls add malformedurlexception mue logger warn unable create url mue get message getmessage create url s urls uri referrer url create ref errer urls createreferrerurls string referrers list url urls array list arraylist url string referrers pos index of indexof valid url pos add urls add urls http add urls https urls to array toarray url urls size create patterns regexp referrer list pattern create ref errer patterns createreferrerpatterns string regex ps regexps list pattern patterns array list arraylist pattern string regexp regex ps regexps pattern pattern pattern compile regexp patterns add pattern exception logger warn unable create pattern string regexp get message getmessage patterns to array toarray pattern patterns size activate activate activate component context componentcontext ctx dictionary props ctx get properties getproperties allow empty allowempty properties util propertiesutil to boolean toboolean props prop empty empty string allow regex hosts allowregexhosts default if empty defaultifempty properties util propertiesutil to string array tostringarray props prop hosts regex prop hosts prop hosts allowed regex ref errers allowedregexreferrers create ref errer patterns createreferrerpatterns allow regex hosts allowregexhosts string allow uri ref errers allowurireferrers get default allowed ref errers getdefaultallowedreferrers string allow hosts allowhosts default if empty defaultifempty properties util propertiesutil to string array tostringarray props prop hosts prop hosts prop hosts allow uri ref errers allowurireferrers add all addall arrays as list aslist allow hosts allowhosts allowed uri ref errers allowedurireferrers create ref errer urls createreferrerurls allow uri ref errers allowurireferrers filter methods filtermethods properties util propertiesutil to string array tostringarray props prop methods filter methods filtermethods filter methods filtermethods length filter methods filtermethods filter methods filtermethods trim length filter methods filtermethods filter methods filtermethods filter methods filtermethods length filter methods filtermethods filter methods filtermethods to upper case touppercase config printer registration configprinterregistration register config printer registerconfigprinter ctx get bundle context getbundlecontext deactivate deactivate config printer registration configprinterregistration unregister service registration serviceregistration register config printer registerconfigprinter bundle context bundlecontext bundle context bundlecontext configuration printer configurationprinter cfg printer cfgprinter configuration printer configurationprinter dictionary string string service props serviceprops hashtable string string service props serviceprops constants service description apache sling ref errer referrer filter configuration printer service props serviceprops constants service vendor apache software foundation service props serviceprops felix webconsole label sling referrer filter slingreferrerfilter service props serviceprops felix webconsole title sling ref errer referrer filter service props serviceprops felix webconsole config printer configprinter modes bundle context bundlecontext register service registerservice object get name getname cfg printer cfgprinter service props serviceprops is modification ismodification http servlet request httpservletrequest req string method req get method getmethod filter methods filtermethods string filter methods filtermethods equals method do filter dofilter servlet request servletrequest req servlet response servletresponse res filter chain filterchain chain i o exception ioexception servlet exception servletexception req http servlet request httpservletrequest res http servlet response httpservletresponse http servlet request httpservletrequest request http servlet request httpservletrequest req modification request browser is browser request isbrowserrequest request is modification ismodification request is valid request isvalidrequest request http servlet response httpservletresponse response http servlet response httpservletresponse res response send error senderror chain do filter dofilter req res host info hostinfo string host string scheme port string touri scheme host port host info hostinfo get host gethost string referrer start pos startpos referrer index of indexof start pos startpos illegal host info hostinfo info host info hostinfo info scheme referrer substring start pos startpos param start paramstart referrer index of indexof string host and path hostandpath param start paramstart referrer referrer substring param start paramstart end pos endpos host and path hostandpath index of indexof start pos startpos string host part hostpart end pos endpos host and path hostandpath substring start pos startpos host and path hostandpath substring start pos startpos end pos endpos host name start hostnamestart host part hostpart index of indexof host name end hostnameend host part hostpart last index of lastindexof host name end hostnameend host name start hostnamestart info host host part hostpart substring host name start hostnamestart info scheme equals http info port info scheme equals https info port info host host part hostpart substring host name start hostnamestart host name end hostnameend info port integer value of valueof host part hostpart substring host name end hostnameend info is valid request isvalidrequest http servlet request httpservletrequest request string referrer request get header getheader ref erer referer check missing empty referrer referrer referrer trim length allow empty allowempty logger info rejected empty referrer header request request get method getmethod request getrequesturi allow empty allowempty check relative referrer allowed referrer index of indexof check air referrer allowed referrer starts with startswith app host info hostinfo info get host gethost referrer info invalid invalid logger info rejected illegal referrer header request object request get method getmethod request getrequesturi referrer request host info host equals request get server name getservername request referrer matches allowed referrers valid is valid uri ref errer isvalidurireferrer info is valid regex ref errer isvalidregexreferrer info valid logger info rejected referrer header request object request get method getmethod request getrequesturi referrer valid javax servlet filter init javax servlet filter config filterconfig init filter config filterconfig config servlet exception servletexception javax servlet filter destroy destroy param host info hostinfo host info hostinfo check val idity validity code code host info hostinfo matches allowed uri referrer is valid uri ref errer isvalidurireferrer host info hostinfo host info hostinfo url allowed uri ref errers allowedurireferrers host info hostinfo host equals get host gethost host info hostinfo scheme equals get protocol getprotocol get port getport host info hostinfo port get port getport param host info hostinfo host info hostinfo check val idity validity code code host info hostinfo matches allowed regexp referrer is valid regex ref errer isvalidregexreferrer host info hostinfo host info hostinfo pattern allowed regex ref errers allowedregexreferrers string url host info hostinfo touri matcher url matches code default properties defaultproperties code code properties code single empty string code properties code string default if empty defaultifempty string properties string default properties defaultproperties properties length properties trim length default properties defaultproperties properties returns code code request assumed client browser fire fix firefix int ernet internet explorer method ins pects inspects code user agent code header returns code code header string mozilla contained firefox int ernet internet explorer web kit webkit based browsers user agent opera contained opera user agent param request request inspect code code request assumed browser is browser request isbrowserrequest http servlet request httpservletrequest request string user agent useragent request get header getheader user agent user agent useragent user agent useragent browser mozilla user agent useragent browser opera configuration printer configurationprinter print allowed ref errers allowedreferrers org apache felix webconsole configuration printer configurationprinter print configuration printconfiguration java print writer printwriter print configuration printconfiguration print writer printwriter println current apache sling ref errer referrer filter allowed ref errers referrers println url url allowed uri ref errers allowedurireferrers println url to string tostring pattern pattern allowed regex ref errers allowedregexreferrers println pattern to string tostring