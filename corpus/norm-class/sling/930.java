licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling rewriter impl components java string writer stringwriter java util array list arraylist java util hash map hashmap java util list java util map javax xml transform transformer configuration exception transformerconfigurationexception javax xml transform transformer factory transformerfactory javax xml transform sax sax transformer factory saxtransformerfactory javax xml transform sax transformer handler transformerhandler javax xml transform stream stream result streamresult org apache sling rewriter serializer org apache sling rewriter serializer factory serializerfactory org osgi service component component context componentcontext org slf logger org slf logger factory loggerfactory org xml sax attributes org xml sax content handler contenthandler org xml sax locator org xml sax sax exception saxexception org xml sax ext lexical handler lexicalhandler org xml sax helpers attributes impl attributesimpl base trax based serialize rs serializers abstract trax serializer factory abstracttraxserializerfactory serializer factory serializerfactory logger logger logger factory loggerfactory get logger getlogger get class getclass get name getname trax code transformer factory transformerfactory code serial izer serializer sax transformer factory saxtransformerfactory tfactory needs names paces as attributes needsnamespacesasattributes string get output format getoutputformat string get doc type public getdoctypepublic string get doc type system getdoctypesystem org apache sling rewriter serializer factory serializerfactory create serializer createserializer serializer create serializer createserializer transformer handler transformerhandler t handler thandler t handler thandler tfactory new transformer handler newtransformerhandler transformer configuration exception transformerconfigurationexception logger error unable create transformer handler content handler contenthandler needs names paces as attributes needsnamespacesasattributes name space as attributes namespaceasattributes ns pipeline nspipeline name space as attributes namespaceasattributes t handler thandler logger ns pipeline nspipeline t handler thandler trax serializer traxserializer t handler thandler get output format getoutputformat get doc type public getdoctypepublic get doc type system getdoctypesystem activate component context componentcontext ctx tfactory sax transformer factory saxtransformerfactory transformer factory transformerfactory new instance newinstance tfactory set error listener seterrorlistener trax error handler traxerrorhandler logger check namespace attributes needs names paces as attributes needsnamespacesasattributes needs names paces as attributes needsnamespacesasattributes exception logger warn transformer names paces namespaces attributes assuming needs names paces as attributes needsnamespacesasattributes deactivat component context componentcontext ctx tfactory checks trax implementation correctly handles names paces namespaces code start prefix mapping startprefixmapping code xmlns attributes check consists sending sax events representing minimal namespace d namespaced document names paces namespaces defined calls code start prefix mapping startprefixmapping code xmlns xxx attributes check text needs names paces as attributes needsnamespacesasattributes exception serialize minimal document check names paces namespaces handled string writer stringwriter writer string writer stringwriter string uri namespace uri namespaceuri string prefix nsp string check xmlns prefix uri transformer handler transformerhandler handler tfactory new transformer handler newtransformerhandler handler set result setresult stream result streamresult writer output single element handler start document startdocument handler start prefix mapping startprefixmapping prefix uri handler start element startelement uri element element attributes impl attributesimpl handler end element endelement uri element element handler end prefix mapping endprefixmapping prefix handler end document enddocument string text writer t o string tostring check namespace replace search text replace index of indexof check pipe ensures namespace prefixes xmlns attributes circumvent xalan serialization behaviour ignore names paces namespaces xmlns xxx attributes name space as attributes namespaceasattributes content handler contenthandler lexical handler lexicalhandler uri xml names paces namespaces string xml name space namespace uri http org xml namespace prefixes start prefix mapping startprefixmapping declarations coming element list string prefix list prefixlist array list arraylist string uri s uris start prefix mapping startprefixmapping declarations coming element list string uri list urilist array list arraylist string maps uri prefix mappings work bug xalan serial izer serializer map string string uri to prefix map uritoprefixmap hash map hashmap string string map string string prefix to uri map prefixtourimap hash map hashmap string string start prefix mapping startprefixmapping coming element has map pings hasmappings content handler contenthandler content handler contenthandler lexical handler lexicalhandler lexical handler lexicalhandler logger logger name space as attributes namespaceasattributes content handler contenthandler handler logger logger content handler contenthandler handler lexical handler lexicalhandler lexical handler lexicalhandler handler logger logger org xml sax content handler contenthandler set document locator setdocumentlocator org xml sax locator set document locator setdocumentlocator locator locator content handler contenthandler set document locator setdocumentlocator locator receive notification character data param characters xml document param start start position array param len number characters read array characters start len sax exception saxexception content handler contenthandler characters start len receive notification ignorable whitespace element content param characters xml document param start start position array param len number characters read array ignorable whitespace ignorablewhitespace start len sax exception saxexception content handler contenthandler ignorable whitespace ignorablewhitespace start len receive notification processing instruction param target processing instruction target param data processing instruction data supplied processing instruction processinginstruction string target string data sax exception saxexception content handler contenthandler processing instruction processinginstruction target data receive notification skipped entity param skipped entity parameter entity skipped entity skippedentity string sax exception saxexception content handler contenthandler skipped entity skippedentity report start dtd declarations param document type param public id publicid declared identifier external dtd sub set subset declared param system id systemid declared system identifier external dtd sub set subset declared startdtd string string public id publicid string system id systemid sax exception saxexception lexical handler lexicalhandler startdtd public id publicid system id systemid report dtd declarations enddtd sax exception saxexception lexical handler lexicalhandler enddtd report entity param entity parameter entity start entity startentity string sax exception saxexception lexical handler lexicalhandler start entity startentity report entity param entity end entity endentity string sax exception saxexception lexical handler lexicalhandler end entity endentity report start cdata startcdata sax exception saxexception lexical handler lexicalhandler startcdata report cdata endcdata sax exception saxexception lexical handler lexicalhandler endcdata report xml comment document param array holding characters comment param start starting position array param len number characters array comment start len sax exception saxexception lexical handler lexicalhandler comment start len start document startdocument sax exception saxexception clean up cleanup uri to prefix map uritoprefixmap clear prefix to uri map prefixtourimap clear clear map pings clearmappings content handler contenthandler start document startdocument track mappings add code xmlns code attributes code start element startelement code start prefix mapping startprefixmapping string prefix string uri sax exception saxexception uri fixes npe start element startelement uri prefix starts with startswith xml has map pings hasmappings prefix list prefixlist add prefix uri list urilist add uri empty prefixes prefix length uri to prefix map uritoprefixmap uri prefix uri to prefix map uritoprefixmap uri prefix prefix to uri map prefixtourimap prefix uri content handler contenthandler start prefix mapping startprefixmapping prefix uri ensure namespace declarations code xmlns code attributes add needed calling superclass work around workaround xalan bug version code org apache xalan serialize serializertoxml code ignores code start end prefix mapping endprefixmapping code start element startelement string elt uri elturi string elt local name eltlocalname string eltqname attributes attrs sax exception saxexception restore q name qname map colon elt uri elturi elt uri elturi length uri to prefix map uritoprefixmap contains key containskey elt uri elturi eltqname uri to prefix map uritoprefixmap elt uri elturi elt local name eltlocalname has map pings hasmappings add xmlns attributes needed attributes add attributes impl attributesimpl new attrs newattrs mapping count mappingcount prefix list prefixlist size attr count attrcount attrs get length getlength mapping mapping mapping count mappingcount mapping build infos namespace string uri uri list urilist mapping string prefix prefix list prefixlist mapping string q name qname prefix equals xmlns xmlns prefix search xmlns attribute attr attr attr count attrcount attr q name qname equals attrs getqname attr check mapping attribute uri match uri equals attrs get value getvalue attr logger error uri prefix mapping attribute match uri attrs geturi attr sax exception saxexception uri prefix mapping attribute match add namespace new attrs newattrs sax bug spent hours remind attr count attrcount new attrs newattrs attributes impl attributesimpl new attrs newattrs attributes impl attributesimpl attrs prefix equals new attrs newattrs add attribute addattribute xml name space namespace uri xmlns xmlns cdata uri new attrs newattrs add attribute addattribute xml name space namespace uri prefix q name qname cdata uri mapping clean up cleanup element clear map pings clearmappings start element attributes content handler contenthandler start element startelement elt uri elturi elt local name eltlocalname eltqname new attrs newattrs attrs new attrs newattrs normal job content handler contenthandler start element startelement elt uri elturi elt local name eltlocalname eltqname attrs receive notification element restore element q name qname end element endelement string elt uri elturi string elt local name eltlocalname string eltqname sax exception saxexception restore q name qname map colon elt uri elturi elt uri elturi length uri to prefix map uritoprefixmap contains key containskey elt uri elturi eltqname uri to prefix map uritoprefixmap elt uri elturi elt local name eltlocalname content handler contenthandler end element endelement elt uri elturi elt local name eltlocalname eltqname scope prefix uri mapping remove entry mapping tab les tables end prefix mapping endprefixmapping string prefix sax exception saxexception main tain maintain maps direct ions directions prefix to uri map prefixtourimap contains key containskey prefix uri to prefix map uritoprefixmap remove prefix to uri map prefixtourimap prefix prefix to uri map prefixtourimap remove prefix has map pings hasmappings time start end prefix mapping endprefixmapping calls element event clear has mapping hasmapping flag code executed rare occasion start end prefix mapping endprefixmapping calls element event would n wouldn remove items prefix list prefixlist uri list urilist namespace incorrectly declared element end prefix mapping endprefixmapping call pos prefix list prefixlist last index of lastindexof prefix pos prefix list prefixlist remove pos uri list urilist remove pos content handler contenthandler end prefix mapping endprefixmapping prefix end document enddocument sax exception saxexception clean up cleanup uri to prefix map uritoprefixmap clear prefix to uri map prefixtourimap clear clear map pings clearmappings content handler contenthandler end document enddocument clear map pings clearmappings has map pings hasmappings prefix list prefixlist clear uri list urilist clear