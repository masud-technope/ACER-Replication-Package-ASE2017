licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling discovery commons providers base org junit assert equals assertequals java util iterator java util linked list linkedlist java util list java util random java util uuid java util concurrent locks reentrant lock reentrantlock org apache sling discovery topology event topologyevent org apache sling discovery topology event topologyevent type org apache sling discovery commons providers base topology view basetopologyview org apache sling discovery commons providers base view state manager impl viewstatemanagerimpl org apache sling discovery commons providers spi cluster sync service clustersyncservice org junit org junit org junit test org slf logger org slf logger factory loggerfactory cluster test clustertest logger logger logger factory loggerfactory get logger getlogger get class getclass list view state manager impl viewstatemanagerimpl mgr list mgrlist random default random defaultrandom setup exception mgr list mgrlist linked list linkedlist view state manager impl viewstatemanagerimpl randomness deterministic methods default random defaultrandom random tear down teardown exception mgr list mgrlist default random defaultrandom view state manager impl viewstatemanagerimpl new mgr newmgr view state manager impl viewstatemanagerimpl mgr view state manager impl viewstatemanagerimpl reentrant lock reentrantlock cluster sync service clustersyncservice sync base topology view basetopologyview view runnable callback callback override cancel sync cancelsync cancel auto mgr list mgrlist add mgr mgr wait for inflight events waitforinflightevents view state manager impl viewstatemanagerimpl mgr interrupted exception interruptedexception mgr illegal argument exception illegalargumentexception mgr mgr get async event sender getasynceventsender logger info wait for inflight events waitforinflightevents mgr activated mgr get async event sender getasynceventsender has in flight event hasinflightevent logger info wait for inflight events waitforinflightevents waiting thread sleep assert count events assertcountevents view state manager impl viewstatemanagerimpl mgr dummy listener dummylistener topology event topologyevent type types interrupted exception interruptedexception wait for inflight events waitforinflightevents mgr assert equals assertequals types length count events countevents iterator topology event topologyevent get events getevents iterator has next hasnext types length topology event topologyevent expected event expectedevent type got type gottype types assert equals assertequals expected event expectedevent get type gettype got type gottype has next hasnext string buffer stringbuffer additional types additionaltypes string buffer stringbuffer has next hasnext additional types additionaltypes append additional types additionaltypes append get type gettype fail events expected additional types additionaltypes types length string buffer stringbuffer additional types additionaltypes string buffer stringbuffer types length additional types additionaltypes append additional types additionaltypes append types fail events expected additional types additionaltypes fail string string todo auto generated method stub test test two nodes testtwonodes exception view state manager impl viewstatemanagerimpl mgr new mgr newmgr string sling id slingid uuid randomuuid to string tostring view state manager impl viewstatemanagerimpl mgr new mgr newmgr string sling id slingid uuid randomuuid to string tostring bind dummy listener dummylistener dummy listener dummylistener mgr bind assert count events assertcountevents mgr bind dummy listener dummylistener dummy listener dummylistener mgr bind assert count events assertcountevents mgr fiddle events expected mgr handle changing handlechanging assert count events assertcountevents mgr mgr handle activated handleactivated assert count events assertcountevents mgr mgr handle changing handlechanging assert count events assertcountevents mgr fiddle events expected mgr handle changing handlechanging assert count events assertcountevents mgr mgr handle activated handleactivated assert count events assertcountevents mgr mgr handle changing handlechanging assert count events assertcountevents mgr call handle new view handlenewview current views base topology view basetopologyview test helper testhelper new view newview sling id slingid sling id slingid sling id slingid sling id slingid mgr handle new view handlenewview assert count events assertcountevents mgr assert count events assertcountevents mgr base topology view basetopologyview test helper testhelper new view newview sling id slingid sling id slingid sling id slingid sling id slingid mgr handle new view handlenewview assert count events assertcountevents mgr assert count events assertcountevents mgr call handle new view handlenewview current view init base topology view basetopologyview test helper testhelper new view newview sling id slingid sling id slingid sling id slingid sling id slingid mgr handle new view handlenewview assert count events assertcountevents mgr type topology init assert count events assertcountevents mgr base topology view basetopologyview test helper testhelper new view newview sling id slingid sling id slingid sling id slingid sling id slingid mgr handle new view handlenewview assert count events assertcountevents mgr type topology init assert count events assertcountevents mgr type topology init instance dec oupled decoupled cluster pseudo net work network partitioning base topology view basetopologyview test helper testhelper new view newview sling id slingid sling id slingid sling id slingid mgr handle new view handlenewview assert count events assertcountevents mgr type topology init assert count events assertcountevents mgr type topology init type topology changing type topology changed instance not e note dec oupling decoupling mgr handle changing handlechanging assert count events assertcountevents mgr type topology init type topology changing assert count events assertcountevents mgr type topology init type topology changing type topology changed instance rejoin base topology view basetopologyview test helper testhelper new view newview sling id slingid sling id slingid sling id slingid sling id slingid mgr handle new view handlenewview assert count events assertcountevents mgr type topology init type topology changing type topology changed assert count events assertcountevents mgr type topology init type topology changing type topology changed base topology view basetopologyview test helper testhelper new view newview sling id slingid sling id slingid sling id slingid sling id slingid mgr handle new view handlenewview assert count events assertcountevents mgr type topology init type topology changing type topology changed assert count events assertcountevents mgr type topology init type topology changing type topology changed type topology changing type topology changed