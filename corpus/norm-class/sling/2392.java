licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling launchpad webapp int egrationtest integrationtest access manager accessmanager org junit assert equals assertequals org junit assert not null assertnotnull org junit assert null assertnull org junit assert true asserttrue java io exception ioexception java util array list arraylist java util hash set hashset java util list java util javax servlet http http servlet response httpservletresponse org apache commons http client httpclient credentials org apache commons http client httpclient name value pair namevaluepair org apache commons http client httpclient username password credentials usernamepasswordcredentials org apache sling commons json json array jsonarray org apache sling commons json json exception jsonexception org apache sling commons json json object jsonobject org apache sling commons testing int egration integration http test httptest org junit org junit org junit ignore org junit test tests acl eacl sling operation get acl test getacltest string test user id testuserid string test user id testuserid access manager test util accessmanagertestutil access manager test util accessmanagertestutil setup exception set up setup cleanup exception tear down teardown credentials creds username password credentials usernamepasswordcredentials admin admin test user id testuserid remove test user exists string post url posturl http test httptest http base url system user manager usermanager user test user id testuserid delete html list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams test user id testuserid remove test user exists string post url posturl http test httptest http base url system user manager usermanager user test user id testuserid delete html list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams test sling effective acl servlet returns incorrect test test effective acl for user testeffectiveaclforuser io exception ioexception json exception jsonexception test user id testuserid create test user createtestuser test user id testuserid create test user createtestuser string test folder url testfolderurl create test folder createtestfolder jcr primary type primarytype unstructured prop one propone prop one value proponevalue child child prop one childpropone string post url posturl test folder url testfolderurl modify ace modifyace html create initial privileges list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr write granted credentials creds username password credentials usernamepasswordcredentials admin admin assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr write granted assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr lock management lockmanagement granted post url posturl test folder url testfolderurl child modify ace modifyace html assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams fetch json eacl verify settings string get url geturl test folder url testfolderurl child eacl json string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json json object jsonobject ace object aceobject json object jsonobject optjsonobject test user id testuserid assert not null assertnotnull ace object aceobject string principal string principalstring ace object aceobject opt string optstring principal assert equals assertequals test user id testuserid principal string principalstring json array jsonarray granted array grantedarray ace object aceobject optjsonarray granted assert not null assertnotnull granted array grantedarray assert equals assertequals granted array grantedarray length string granted privilege names grantedprivilegenames hash set hashset string granted array grantedarray length granted privilege names grantedprivilegenames add granted array grantedarray get string getstring assert privilege assertprivilege granted privilege names grantedprivilegenames jcr write json array jsonarray denied array deniedarray ace object aceobject optjsonarray denied assert null assertnull denied array deniedarray json object jsonobject ace object aceobject json object jsonobject optjsonobject test user id testuserid assert not null assertnotnull ace object aceobject string principal string principalstring ace object aceobject opt string optstring principal assert equals assertequals test user id testuserid principal string principalstring json array jsonarray granted array grantedarray ace object aceobject optjsonarray granted assert not null assertnotnull granted array grantedarray assert equals assertequals granted array grantedarray length string granted privilege names grantedprivilegenames hash set hashset string granted array grantedarray length granted privilege names grantedprivilegenames add granted array grantedarray get string getstring assert privilege assertprivilege granted privilege names grantedprivilegenames jcr write assert privilege assertprivilege granted privilege names grantedprivilegenames jcr lock management lockmanagement json array jsonarray denied array deniedarray ace object aceobject optjsonarray denied assert null assertnull denied array deniedarray test sling effective acl servlet returns incorrect test test effective acl merge for user testeffectiveaclmergeforuser replace privilege on child replaceprivilegeonchild io exception ioexception json exception jsonexception test user id testuserid create test user createtestuser string test folder url testfolderurl create test folder createtestfolder jcr primary type primarytype unstructured prop one propone prop one value proponevalue child child prop one childpropone string post url posturl test folder url testfolderurl modify ace modifyace html create initial privileges list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr write denied credentials creds username password credentials usernamepasswordcredentials admin admin assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr write granted post url posturl test folder url testfolderurl child modify ace modifyace html assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams fetch json eacl verify settings string get url geturl test folder url testfolderurl child eacl json string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json json object jsonobject ace object aceobject json object jsonobject optjsonobject test user id testuserid assert not null assertnotnull ace object aceobject string principal string principalstring ace object aceobject opt string optstring principal assert equals assertequals test user id testuserid principal string principalstring json array jsonarray granted array grantedarray ace object aceobject optjsonarray granted assert not null assertnotnull granted array grantedarray assert equals assertequals granted array grantedarray length string granted privilege names grantedprivilegenames hash set hashset string granted array grantedarray length granted privilege names grantedprivilegenames add granted array grantedarray get string getstring assert privilege assertprivilege granted privilege names grantedprivilegenames jcr write json array jsonarray denied array deniedarray ace object aceobject optjsonarray denied assert null assertnull denied array deniedarray test sling effective acl servlet returns incorrect test test effective acl merge for user testeffectiveaclmergeforuser fewer privileges granted on child fewerprivilegesgrantedonchild io exception ioexception json exception jsonexception test user id testuserid create test user createtestuser string test folder url testfolderurl create test folder createtestfolder jcr primary type primarytype unstructured prop one propone prop one value proponevalue child child prop one childpropone string post url posturl test folder url testfolderurl modify ace modifyace html create initial privileges list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr granted credentials creds username password credentials usernamepasswordcredentials admin admin assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr write granted post url posturl test folder url testfolderurl child modify ace modifyace html assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams fetch json eacl verify settings string get url geturl test folder url testfolderurl child eacl json string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json json object jsonobject ace object aceobject json object jsonobject optjsonobject test user id testuserid assert not null assertnotnull ace object aceobject string principal string principalstring ace object aceobject opt string optstring principal assert equals assertequals test user id testuserid principal string principalstring json array jsonarray granted array grantedarray ace object aceobject optjsonarray granted assert not null assertnotnull granted array grantedarray assert equals assertequals granted array grantedarray length string granted privilege names grantedprivilegenames hash set hashset string granted array grantedarray length granted privilege names grantedprivilegenames add granted array grantedarray get string getstring assert privilege assertprivilege granted privilege names grantedprivilegenames jcr json array jsonarray denied array deniedarray ace object aceobject optjsonarray denied assert null assertnull denied array deniedarray test sling effective acl servlet returns incorrect test test effective acl merge for user testeffectiveaclmergeforuser more privileges granted on child moreprivilegesgrantedonchild io exception ioexception json exception jsonexception test user id testuserid create test user createtestuser string test folder url testfolderurl create test folder createtestfolder jcr primary type primarytype unstructured prop one propone prop one value proponevalue child child prop one childpropone string post url posturl test folder url testfolderurl modify ace modifyace html create initial privileges list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr write granted credentials creds username password credentials usernamepasswordcredentials admin admin assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr granted post url posturl test folder url testfolderurl child modify ace modifyace html assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams fetch json eacl verify settings string get url geturl test folder url testfolderurl child eacl json string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json json object jsonobject ace object aceobject json object jsonobject optjsonobject test user id testuserid assert not null assertnotnull ace object aceobject string principal string principalstring ace object aceobject opt string optstring principal assert equals assertequals test user id testuserid principal string principalstring json array jsonarray granted array grantedarray ace object aceobject optjsonarray granted assert not null assertnotnull granted array grantedarray assert equals assertequals granted array grantedarray length string granted privilege names grantedprivilegenames hash set hashset string granted array grantedarray length granted privilege names grantedprivilegenames add granted array grantedarray get string getstring assert privilege assertprivilege granted privilege names grantedprivilegenames jcr json array jsonarray denied array deniedarray ace object aceobject optjsonarray denied assert null assertnull denied array deniedarray test sling effective acl servlet returns incorrect test todo fails oak ignore test effective acl merge for user testeffectiveaclmergeforuser sub set of privileges denied on child subsetofprivilegesdeniedonchild io exception ioexception json exception jsonexception test user id testuserid create test user createtestuser string test folder url testfolderurl create test folder createtestfolder jcr primary type primarytype unstructured prop one propone prop one value proponevalue child child prop one childpropone string post url posturl test folder url testfolderurl modify ace modifyace html create initial privileges list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr granted credentials creds username password credentials usernamepasswordcredentials admin admin assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr write denied post url posturl test folder url testfolderurl child modify ace modifyace html assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams fetch json eacl verify settings string get url geturl test folder url testfolderurl child eacl json string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json json object jsonobject ace object aceobject json object jsonobject optjsonobject test user id testuserid assert not null assertnotnull ace object aceobject string principal string principalstring ace object aceobject opt string optstring principal assert equals assertequals test user id testuserid principal string principalstring json array jsonarray granted array grantedarray ace object aceobject optjsonarray granted assert not null assertnotnull granted array grantedarray assert true asserttrue granted array grantedarray length string granted privilege names grantedprivilegenames hash set hashset string granted array grantedarray length granted privilege names grantedprivilegenames add granted array grantedarray get string getstring assert privilege assertprivilege granted privilege names grantedprivilegenames jcr assert privilege assertprivilege granted privilege names grantedprivilegenames jcr write assert privilege assertprivilege granted privilege names grantedprivilegenames jcr read assert privilege assertprivilege granted privilege names grantedprivilegenames jcr read access control readaccesscontrol assert privilege assertprivilege granted privilege names grantedprivilegenames jcr modify access control modifyaccesscontrol assert privilege assertprivilege granted privilege names grantedprivilegenames jcr lock management lockmanagement assert privilege assertprivilege granted privilege names grantedprivilegenames jcr version management versionmanagement assert privilege assertprivilege granted privilege names grantedprivilegenames jcr node type management nodetypemanagement assert privilege assertprivilege granted privilege names grantedprivilegenames jcr ret ention management retentionmanagement assert privilege assertprivilege granted privilege names grantedprivilegenames jcr lifecycle management lifecyclemanagement jcr write aggregate privileges denied assert privilege assertprivilege granted privilege names grantedprivilegenames jcr modify properties modifyproperties assert privilege assertprivilege granted privilege names grantedprivilegenames jcr add child nodes addchildnodes assert privilege assertprivilege granted privilege names grantedprivilegenames jcr remove node removenode assert privilege assertprivilege granted privilege names grantedprivilegenames jcr remove child nodes removechildnodes json array jsonarray denied array deniedarray ace object aceobject optjsonarray denied assert not null assertnotnull denied array deniedarray assert equals assertequals denied array deniedarray length string denied privilege names deniedprivilegenames hash set hashset string denied array deniedarray length denied privilege names deniedprivilegenames add denied array deniedarray get string getstring assert privilege assertprivilege denied privilege names deniedprivilegenames jcr write test sling effective acl servlet returns incorrect test test effective acl merge for user testeffectiveaclmergeforuser sub set of privileges denied on child subsetofprivilegesdeniedonchild io exception ioexception json exception jsonexception test user id testuserid create test user createtestuser string test folder url testfolderurl create test folder createtestfolder jcr primary type primarytype unstructured prop one propone prop one value proponevalue child child prop one childpropone string post url posturl test folder url testfolderurl modify ace modifyace html create initial privileges list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr granted credentials creds username password credentials usernamepasswordcredentials admin admin assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr remove node removenode denied post url posturl test folder url testfolderurl child modify ace modifyace html assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams fetch json eacl verify settings string get url geturl test folder url testfolderurl child eacl json string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json json object jsonobject ace object aceobject json object jsonobject optjsonobject test user id testuserid assert not null assertnotnull ace object aceobject string principal string principalstring ace object aceobject opt string optstring principal assert equals assertequals test user id testuserid principal string principalstring json array jsonarray granted array grantedarray ace object aceobject optjsonarray granted assert not null assertnotnull granted array grantedarray assert true asserttrue granted array grantedarray length string granted privilege names grantedprivilegenames hash set hashset string granted array grantedarray length granted privilege names grantedprivilegenames add granted array grantedarray get string getstring assert privilege assertprivilege granted privilege names grantedprivilegenames jcr assert privilege assertprivilege granted privilege names grantedprivilegenames jcr write assert privilege assertprivilege granted privilege names grantedprivilegenames jcr read assert privilege assertprivilege granted privilege names grantedprivilegenames jcr read access control readaccesscontrol assert privilege assertprivilege granted privilege names grantedprivilegenames jcr modify access control modifyaccesscontrol assert privilege assertprivilege granted privilege names grantedprivilegenames jcr lock management lockmanagement assert privilege assertprivilege granted privilege names grantedprivilegenames jcr version management versionmanagement assert privilege assertprivilege granted privilege names grantedprivilegenames jcr node type management nodetypemanagement assert privilege assertprivilege granted privilege names grantedprivilegenames jcr ret ention management retentionmanagement assert privilege assertprivilege granted privilege names grantedprivilegenames jcr lifecycle management lifecyclemanagement assert privilege assertprivilege granted privilege names grantedprivilegenames jcr modify properties modifyproperties assert privilege assertprivilege granted privilege names grantedprivilegenames jcr add child nodes addchildnodes assert privilege assertprivilege granted privilege names grantedprivilegenames jcr remove child nodes removechildnodes json array jsonarray denied array deniedarray ace object aceobject optjsonarray denied assert not null assertnotnull denied array deniedarray assert equals assertequals denied array deniedarray length string denied privilege names deniedprivilegenames hash set hashset string denied array deniedarray length denied privilege names deniedprivilegenames add denied array deniedarray get string getstring assert privilege assertprivilege denied privilege names deniedprivilegenames jcr remove node removenode test sling effective acl servlet returns incorrect test test effective acl merge for user testeffectiveaclmergeforuser super set of privileges denied on child supersetofprivilegesdeniedonchild io exception ioexception json exception jsonexception test user id testuserid create test user createtestuser string test folder url testfolderurl create test folder createtestfolder jcr primary type primarytype unstructured prop one propone prop one value proponevalue child child prop one childpropone string post url posturl test folder url testfolderurl modify ace modifyace html create initial privileges list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr write granted credentials creds username password credentials usernamepasswordcredentials admin admin assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr denied post url posturl test folder url testfolderurl child modify ace modifyace html assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams fetch json eacl verify settings string get url geturl test folder url testfolderurl child eacl json string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json json object jsonobject ace object aceobject json object jsonobject optjsonobject test user id testuserid assert not null assertnotnull ace object aceobject string principal string principalstring ace object aceobject opt string optstring principal assert equals assertequals test user id testuserid principal string principalstring json array jsonarray granted array grantedarray ace object aceobject optjsonarray granted assert null assertnull granted array grantedarray json array jsonarray denied array deniedarray ace object aceobject optjsonarray denied assert not null assertnotnull denied array deniedarray assert equals assertequals denied array deniedarray length string denied privilege names deniedprivilegenames hash set hashset string denied array deniedarray length denied privilege names deniedprivilegenames add denied array deniedarray get string getstring assert privilege assertprivilege denied privilege names deniedprivilegenames jcr test sling effective acl servlet returns incorrect test test effective acl merge for user testeffectiveaclmergeforuser super set of privileges denied on child supersetofprivilegesdeniedonchild io exception ioexception json exception jsonexception test user id testuserid create test user createtestuser string test folder url testfolderurl create test folder createtestfolder jcr primary type primarytype unstructured prop one propone prop one value proponevalue child child prop one childpropone string post url posturl test folder url testfolderurl modify ace modifyace html create initial privileges list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr modify properties modifyproperties granted credentials creds username password credentials usernamepasswordcredentials admin admin assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair principal id principalid test user id testuserid post params postparams add name value pair namevaluepair privilege jcr denied post url posturl test folder url testfolderurl child modify ace modifyace html assert authenticated post status assertauthenticatedpoststatus creds post url posturl http servlet response httpservletresponse post params postparams fetch json eacl verify settings string get url geturl test folder url testfolderurl child eacl json string json get authenticated content getauthenticatedcontent creds get url geturl http test httptest content type json http servlet response httpservletresponse assert not null assertnotnull json json object jsonobject json object jsonobject json object jsonobject json json object jsonobject ace object aceobject json object jsonobject optjsonobject test user id testuserid assert not null assertnotnull ace object aceobject string principal string principalstring ace object aceobject opt string optstring principal assert equals assertequals test user id testuserid principal string principalstring json array jsonarray granted array grantedarray ace object aceobject optjsonarray granted assert null assertnull granted array grantedarray json array jsonarray denied array deniedarray ace object aceobject optjsonarray denied assert not null assertnotnull denied array deniedarray assert equals assertequals denied array deniedarray length string denied privilege names deniedprivilegenames hash set hashset string denied array deniedarray length denied privilege names deniedprivilegenames add denied array deniedarray get string getstring assert privilege assertprivilege denied privilege names deniedprivilegenames jcr