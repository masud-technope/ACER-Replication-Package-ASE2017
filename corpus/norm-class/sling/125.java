licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling event impl jobs tasks java util hash map hashmap java util iterator java util list java util map org apache sling api resource persistence exception persistenceexception org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling api resource value map valuemap org apache sling discovery instance description instancedescription org apache sling event impl jobs job topic traverser jobtopictraverser org apache sling event impl jobs config job manager configuration jobmanagerconfiguration org apache sling event impl jobs config queue configuration manager queueconfigurationmanager org apache sling event impl jobs config queue configuration manager queueconfigurationmanager queue info queueinfo org apache sling event impl jobs config topology capabilities topologycapabilities org apache sling event impl support resource helper resourcehelper org apache sling event jobs job org slf logger org slf logger factory loggerfactory check topology task checks topology queue configuration reassigns jobs leader instance finds dead instance reassigns jobs live instances leader instance checks unassigned jobs assign instance detects jobs doesn process reassigns check topology task checktopologytask logger logger logger logger factory loggerfactory get logger getlogger get class getclass job manager configuration job manager configuration jobmanagerconfiguration configuration capabilities topology capabilities topologycapabilities caps constructor param config configuration check topology task checktopologytask job manager configuration jobmanagerconfiguration config configuration config caps configuration get topology capabilities gettopologycapabilities reassign jobs stopped instance reassign jobs from stopped instances reassignjobsfromstoppedinstances caps is leader isleader caps is active isactive logger debug checking stopped instances resource resolver resourceresolver resolver configuration create resource resolver createresourceresolver resolver resource jobs root jobsroot resolver get resource getresource configuration get assgined jobs path getassginedjobspath logger debug jobs root jobs root jobsroot resource exist check jobs root jobsroot iterator resource instance iter instanceiter jobs root jobsroot list children listchildren caps is active isactive instance iter instanceiter has next hasnext resource instance resource instanceresource instance iter instanceiter string instance id instanceid instance resource instanceresource get name getname caps is active isactive instance id instanceid logger debug stopped instance instance id instanceid assign jobs assignjobs instance resource instanceresource resolver close reassign stale jobs instance reassign stale jobs reassignstalejobs caps is active isactive logger debug checking stale jobs resource resolver resourceresolver resolver configuration create resource resolver createresourceresolver resolver resource jobs root jobsroot resolver get resource getresource configuration get local jobs path getlocaljobspath resource exist check jobs root jobsroot iterator resource topic iter topiciter jobs root jobsroot list children listchildren caps is active isactive topic iter topiciter has next hasnext resource topic resource topicresource topic iter topiciter string topic name topicname topic resource topicresource get name getname replace logger debug checking topic topic name topicname list instance description instancedescription potential targets potentialtargets caps get potential targets getpotentialtargets topic name topicname reassign instance description instancedescription desc potential targets potentialtargets desc is local islocal reassign reassign queue configuration manager queueconfigurationmanager qcm configuration get queue configuration manager getqueueconfigurationmanager qcm queue info queueinfo info qcm get queue info getqueueinfo topic name topicname job topic traverser jobtopictraverser traverse logger topic resource topicresource job topic traverser jobtopictraverser resource callback resourcecallback override handle resource rsrc value map valuemap resource helper resourcehelper get value map getvaluemap rsrc string target id targetid caps detect target detecttarget topic name topicname info map string object props hash map hashmap string object props remove job property job started time string new path newpath target id targetid new path newpath configuration get assgined jobs path getassginedjobspath target id targetid topic resource topicresource get name getname rsrc get path getpath substring topic resource topicresource get path getpath length props job property job queue info queue name queuename props job property job target instance target id targetid new path newpath configuration get unassigned jobs path getunassignedjobspath topic resource topicresource get name getname rsrc get path getpath substring topic resource topicresource get path getpath length props remove job property job queue props remove job property job target instance resource helper resourcehelper get or create resource getorcreateresource resolver new path newpath props resolver delete rsrc resolver commit string job id jobid resource helper resourcehelper property job string target id targetid configuration get audit logger getauditlogger debug reassign target id targetid job id jobid configuration get audit logger getauditlogger debug reunassign job id jobid persistence exception persistenceexception logger warn unable move stale job rsrc get path getpath new path newpath resolver refresh resolver revert instantiation exception instantiationexception logger warn unable move stale job rsrc get path getpath resolver refresh resolver revert caps is active isactive resolver close assign unassigned jobs queue configurations topology capabilities assign unassigned jobs assignunassignedjobs caps caps is leader isleader caps is active isactive logger debug checking unassigned jobs resource resolver resourceresolver resolver configuration create resource resolver createresourceresolver resolver resource unassigned root unassignedroot resolver get resource getresource configuration get unassigned jobs path getunassignedjobspath logger debug unassigned root unassigned root unassignedroot resource exist check unassigned root unassignedroot assign jobs assignjobs unassigned root unassignedroot resolver close assign jobs jobs root jobs stored topic param jobs root jobsroot root jobs param unassign unassign job instance assign jobs assignjobs resource jobs root jobsroot unassign resource resolver resourceresolver resolver jobs root jobsroot get resource resolver getresourceresolver iterator resource topic iter topiciter jobs root jobsroot list children listchildren caps is active isactive topic iter topiciter has next hasnext resource topic resource topicresource topic iter topiciter string topic name topicname topic resource topicresource get name getname replace logger debug topic topic name topicname check instance topics list instance description instancedescription potential targets potentialtargets caps get potential targets getpotentialtargets topic name topicname potential targets potentialtargets potential targets potentialtargets size queue configuration manager queueconfigurationmanager qcm configuration get queue configuration manager getqueueconfigurationmanager qcm queue info queueinfo info qcm get queue info getqueueinfo topic name topicname logger debug queue info queue configuration queueconfiguration topic name topicname job topic traverser jobtopictraverser traverse logger topic resource topicresource job topic traverser jobtopictraverser resource callback resourcecallback override handle resource rsrc value map valuemap resource helper resourcehelper get value map getvaluemap rsrc string target id targetid caps detect target detecttarget topic name topicname info target id targetid string new path newpath configuration get assgined jobs path getassginedjobspath target id targetid topic resource topicresource get name getname rsrc get path getpath substring topic resource topicresource get path getpath length map string object props hash map hashmap string object props job property job queue info queue name queuename props job property job target instance target id targetid props remove job property job started time resource helper resourcehelper get or create resource getorcreateresource resolver new path newpath props resolver delete rsrc resolver commit string job id jobid resource helper resourcehelper property job string configuration get audit logger getauditlogger debug reassign target id targetid job id jobid persistence exception persistenceexception logger warn unable move unassigned job rsrc get path getpath new path newpath resolver refresh resolver revert instantiation exception instantiationexception logger warn unable move unassigned job rsrc get path getpath resolver refresh resolver revert caps is active isactive unassign jobs caps is active isactive unassign move unassigned area job topic traverser jobtopictraverser traverse logger topic resource topicresource job topic traverser jobtopictraverser resource callback resourcecallback override handle resource rsrc value map valuemap resource helper resourcehelper get value map getvaluemap rsrc string new path newpath configuration get unassigned jobs path getunassignedjobspath topic resource topicresource get name getname rsrc get path getpath substring topic resource topicresource get path getpath length map string object props hash map hashmap string object props remove job property job queue props remove job property job target instance props remove job property job started time resource helper resourcehelper get or create resource getorcreateresource resolver new path newpath props resolver delete rsrc resolver commit string job id jobid resource helper resourcehelper property job string configuration get audit logger getauditlogger debug reunassign job id jobid persistence exception persistenceexception logger warn unable unassigned job rsrc get path getpath new path newpath resolver refresh resolver revert instantiation exception instantiationexception logger warn unable unassigned job rsrc get path getpath resolver refresh resolver revert caps is active isactive main tenance maintenance full run fullrun topology changed topologychanged config changed configchanged caps topology changed res chedule reschedule assigned jobs stopped instances topology changed topologychanged reassign jobs from stopped instances reassignjobsfromstoppedinstances check topics reassign stale jobs reassignstalejobs assign unassigned jobs assign unassigned jobs assignunassignedjobs