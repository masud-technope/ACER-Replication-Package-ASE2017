licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling tracer internal java io exception ioexception java util collection java util list javax servlet filter javax servlet filter chain filterchain javax servlet servlet exception servletexception javax servlet servlet request servletrequest javax servlet servlet response servletresponse javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse qos logback classic level qos logback classic logger context loggercontext qos logback classic spi i logging event iloggingevent qos logback classic turbo turbo filter turbofilter qos logback core read list appender listappender google common collect immutable map immutablemap google common collect lists org apache sling api sling http servlet request slinghttpservletrequest org apache sling testing mock osgi mock osgi mockosgi org apache sling testing mock osgi junit osgi context osgicontext org apache sling testing mock osgi junit osgi context callback osgicontextcallback org junit rule org junit test org junit rules test watcher testwatcher org junit runner description org osgi framework invalid syntax exception invalidsyntaxexception org osgi framework service reference servicereference org slf logger factory loggerfactory org hamcrest core matchers corematchers has item hasitem org hamcrest core matchers corematchers org junit assert equals assertequals org junit assert not null assertnotnull org junit assert null assertnull org junit assert that assertthat org mockito mockito mock org mockito mockito org slf logger factory loggerfactory get logger getlogger log tracer test logtracertest rule log collector logcollector log collector logcollector log collector logcollector rule osgi context osgicontext context osgi context osgicontext osgi context callback osgicontextcallback override execute osgi context osgicontext context io exception ioexception context get service getservice turbo filter turbofilter turbo filter turbofilter tfs context get services getservices turbo filter turbofilter turbo filter turbofilter tfs get log context getlogcontext get turbo filter list getturbofilterlist remove test default setup defaultsetup exception context register inject activate service registerinjectactivateservice log tracer logtracer assert null assertnull filters registered enabled context get service getservice filter test enable tracer enabletracer exception log tracer logtracer tracer context register inject activate service registerinjectactivateservice log tracer logtracer immutable map immutablemap string object enabled assert equals assertequals context get services getservices filter length mock osgi mockosgi deactivate tracer assert null assertnull context get service getservice filter test no turbo filter registered unless tracing requested noturbofilterregisteredunlesstracingrequested exception http servlet request httpservletrequest request mock http servlet request httpservletrequest http servlet response httpservletresponse response mock http servlet response httpservletresponse activate tracer activatetracer filter chain filterchain chain filter chain filterchain override do filter dofilter servlet request servletrequest request servlet response servletresponse response io exception ioexception servlet exception servletexception assert null assertnull context get service getservice turbo filter turbofilter filter filter get filter getfilter filter do filter dofilter request response chain test turbo filter registered when tracing requested turbofilterregisteredwhentracingrequested exception http servlet request httpservletrequest request mock http servlet request httpservletrequest http servlet response httpservletresponse response mock http servlet response httpservletresponse request get header getheader log tracer logtracer header tracer config then return thenreturn foo bar activate tracer activatetracer filter chain filterchain chain filter chain filterchain override do filter dofilter servlet request servletrequest request servlet response servletresponse response io exception ioexception servlet exception servletexception assert not null assertnotnull context get service getservice turbo filter turbofilter filter filter get filter getfilter filter do filter dofilter request response chain assert null assertnull turbo filter turbofilter removed request context get service getservice turbo filter turbofilter test turbo filter registered when tracing requested turbofilterregisteredwhentracingrequested sling exception http servlet request httpservletrequest request mock sling http servlet request slinghttpservletrequest http servlet response httpservletresponse response mock http servlet response httpservletresponse request get parameter getparameter log tracer logtracer param tracer config then return thenreturn foo bar activate tracer activatetracer filter chain filterchain chain filter chain filterchain override do filter dofilter servlet request servletrequest request servlet response servletresponse response io exception ioexception servlet exception servletexception assert not null assertnotnull context get service getservice turbo filter turbofilter filter filter get filter getfilter filter do filter dofilter request response chain assert null assertnull turbo filter turbofilter removed request context get service getservice turbo filter turbofilter test check tracing checktracing exception http servlet request httpservletrequest request mock sling http servlet request slinghttpservletrequest http servlet response httpservletresponse response mock http servlet response httpservletresponse request get parameter getparameter log tracer logtracer param tracer config then return thenreturn level trace level debug activate tracer activatetracer level old level oldlevel root logger rootlogger get level getlevel root logger rootlogger set level setlevel level info filter chain filterchain chain filter chain filterchain override do filter dofilter servlet request servletrequest request servlet response servletresponse response io exception ioexception servlet exception servletexception turbo filter turbofilter turbo filter turbofilter context get service getservice turbo filter turbofilter assert not null assertnotnull turbo filter turbofilter get log context getlogcontext add turbo filter addturbofilter turbo filter turbofilter get logger getlogger info info get logger getlogger debug debug get logger getlogger info info get logger getlogger debug debug get logger getlogger trace trace get logger getlogger debug debug get logger getlogger trace trace get logger getlogger trace trace get logger getlogger is trace enabled istraceenabled get logger getlogger trace trace filter filter get filter getfilter filter do filter dofilter request response chain assert null assertnull context get service getservice turbo filter turbofilter list string logs log collector logcollector get logs getlogs assert that assertthat logs has item hasitem info assert that assertthat logs has item hasitem debug assert that assertthat logs has item hasitem info assert that assertthat logs has item hasitem debug assert that assertthat logs has item hasitem trace assert that assertthat logs has item hasitem debug assert that assertthat logs has item hasitem trace assert that assertthat logs has item hasitem trace assert that assertthat logs has item hasitem trace root logger rootlogger set level setlevel old level oldlevel activate tracer activatetracer context register inject activate service registerinjectactivateservice log tracer logtracer immutable map immutablemap string object enabled filter get filter getfilter sling filter slingfilter invalid syntax exception invalidsyntaxexception collection service reference servicereference filter context bundle context bundlecontext get service references getservicereferences filter service reference servicereference filter result service reference servicereference filter sling filter slingfilter get property getproperty filter scope result sling filter slingfilter get property getproperty pattern result result context bundle context bundlecontext get service getservice result assertion error assertionerror filter logger context loggercontext get log context getlogcontext logger context loggercontext logger factory loggerfactory get logger factory getiloggerfactory qos logback classic logger root logger rootlogger get log context getlogcontext get logger getlogger qos logback classic logger root logger log collector logcollector test watcher testwatcher list string msgs lists new array list newarraylist test appender testappender appender test appender testappender list string get logs getlogs msgs override starting description description appender set context setcontext get log context getlogcontext appender set name setname test log collector testlogcollector appender start root logger rootlogger add appender addappender appender override finished description description root logger rootlogger detach appender detachappender appender test appender testappender list appender listappender i logging event iloggingevent override append i logging event iloggingevent i logging event iloggingevent msgs add i logging event iloggingevent get for matted message getformattedmessage