licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling event impl jobs queues java util array list arraylist java util collections java util hash map hashmap java util hash set hashset java util list java util map java util java util concurrent concurrent skip list set concurrentskiplistset java util concurrent atomic atomic boolean atomicboolean org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling event impl jobs job consumer manager jobconsumermanager org apache sling event impl jobs job handler jobhandler org apache sling event impl jobs job impl jobimpl org apache sling event impl jobs job topic traverser jobtopictraverser org apache sling event impl jobs utility org apache sling event impl jobs config job manager configuration jobmanagerconfiguration org apache sling event impl jobs stats statistics manager statisticsmanager org apache sling event jobs job job state jobstate org apache sling event jobs queue org apache sling event jobs queue configuration queueconfiguration org apache sling event jobs queue configuration queueconfiguration type org apache sling event jobs consumer job executor jobexecutor org slf logger org slf logger factory loggerfactory queue job cache caches jobs queue based topics queue act ively actively processing queue job cache queuejobcache logger logger logger logger factory loggerfactory get logger getlogger get class getclass maximum pre loaded jobs topic max preload limit maxpreloadlimit job manager configuration job manager configuration jobmanagerconfiguration configuration topics handled queue string topics topics scan string topics with new jobs topicswithnewjobs hash set hashset string cache current objects list job impl jobimpl cache array list arraylist job impl jobimpl queue type queue configuration queueconfiguration type queue type queuetype block cache ordered queues atomic boolean atomicboolean queue is blocked queueisblocked atomic boolean atomicboolean create queue job cache param configuration current job manager configuration param queue type queuetype queue type param topics topics handled queue queue job cache queuejobcache job manager configuration jobmanagerconfiguration configuration string queue name queuename statistics manager statisticsmanager statistics manager statisticsmanager queue configuration queueconfiguration type queue type queuetype string topics configuration configuration queue type queuetype queue type queuetype topics concurrent skip list set concurrentskiplistset string topics fill cache fillcache queue name queuename statistics manager statisticsmanager topics queue topics string get topics gettopics topics check jobs queue code job out standing outstanding is empty isempty result cache result cache is empty isempty result topics with new jobs topicswithnewjobs result topics with new jobs topicswithnewjobs is empty isempty result set is blocked setisblocked queue is blocked queueisblocked fill cache sync called constructor fill cache fillcache string queue name queuename statistics manager statisticsmanager statistics manager statisticsmanager string checking topics checkingtopics hash set hashset string checking topics checkingtopics add all addall topics checking topics checkingtopics is empty isempty load jobs loadjobs queue name queuename checking topics checkingtopics statistics manager statisticsmanager job method called concurrently link res chedule reschedule job handler jobhandler link handle new topics handlenewtopics called concurrently job handler jobhandler get next job getnextjob job consumer manager jobconsumermanager job consumer manager jobconsumermanager statistics manager statisticsmanager statistics manager statisticsmanager queue queue do full dofull job handler jobhandler handler queue is blocked queueisblocked cache retry retry cache is empty isempty string checking topics checkingtopics hash set hashset string topics with new jobs topicswithnewjobs checking topics checkingtopics add all addall topics with new jobs topicswithnewjobs topics with new jobs topicswithnewjobs clear do full dofull checking topics checkingtopics add all addall topics checking topics checkingtopics is empty isempty load jobs loadjobs queue get name getname checking topics checkingtopics statistics manager statisticsmanager cache is empty isempty job impl jobimpl job cache remove job executor jobexecutor consumer job consumer manager jobconsumermanager get executor getexecutor job get topic gettopic handler job handler jobhandler job consumer configuration consumer handler start processing startprocessing queue statistics manager statisticsmanager job deque ued jobdequeued queue get name getname handler get job getjob get topic gettopic logger is debug enabled isdebugenabled logger debug discarding removed job utility to string tostring job handler retry statistics manager statisticsmanager job deque ued jobdequeued queue get name getname handler get job getjob get topic gettopic consumer instance assign instance handler reassign handler retry handler retry handler load number of numberof topics jobs param checking topics checkingtopics topics check load jobs loadjobs string queue name queuename string checking topics checkingtopics statistics manager statisticsmanager statistics manager statisticsmanager logger debug starting jobs loading checking topics checkingtopics map string list job impl jobimpl topic cache topiccache hash map hashmap string list job impl jobimpl resource resolver resourceresolver resolver configuration create resource resolver createresourceresolver resource base resource baseresource resolver get resource getresource configuration get local jobs path getlocaljobspath sanity check base resource baseresource string topic checking topics checkingtopics resource topic resource topicresource base resource baseresource get child getchild topic replace topic resource topicresource topic cache topiccache topic load jobs loadjobs queue name queuename topic topic resource topicresource statistics manager statisticsmanager resolver close order topics ordertopics topic cache topiccache logger debug finished jobs loading cache size order topics based queue type cache param topic cache topiccache topic based cache order topics ordertopics map string list job impl jobimpl topic cache topiccache queue type queuetype type ordered queue type queuetype type unordered list job impl jobimpl list topic cache topiccache values cache add all addall list collections sort cache topic robin map entry string list job impl jobimpl entry topic cache topiccache entry set entryset entry get value getvalue is empty isempty cache add entry get value getvalue remove entry get value getvalue is empty isempty load number of numberof topics jobs param topic topic param topic resource topicresource parent resource jobs cache filled jobs list job impl jobimpl load jobs loadjobs string queue name queuename string topic resource topic resource topicresource statistics manager statisticsmanager statistics manager statisticsmanager logger debug loading jobs topic topic list job impl jobimpl list array list arraylist job impl jobimpl atomic boolean atomicboolean scan topic scantopic atomic boolean atomicboolean job topic traverser jobtopictraverser traverse logger topic resource topicresource job topic traverser jobtopictraverser job callback jobcallback override handle job impl jobimpl job job get processing started getprocessingstarted job has read errors hasreaderrors list add job statistics manager statisticsmanager job queue d jobqueued queue name queuename topic list size max preload limit maxpreloadlimit scan topic scantopic job get processing started getprocessingstarted logger debug ignoring job processing started job error reading job scan topic scantopic job is read error recover able isreaderrorrecoverable logger debug ignoring job rec over able recoverable read errors job logger debug failing job unrecoverable read errors job job handler jobhandler handler job handler jobhandler job configuration handler finished job state jobstate error list size max preload limit maxpreloadlimit scan topic scantopic topics with new jobs topicswithnewjobs topics with new jobs topicswithnewjobs add topic logger debug caching jobs topic list size topic list info rm inform queue cache topics jobs param topics topics scan handle new topics handlenewtopics string topics logger debug update cache handle event topics topics topics with new jobs topicswithnewjobs topics with new jobs topicswithnewjobs add all addall topics topics add all addall topics res chedule reschedule job res chedule reschedule job add cache param handler job handler res chedule reschedule string queue name queuename job handler jobhandler handler statistics manager statisticsmanager statistics manager statisticsmanager cache handler res chedule reschedule queue type queuetype type ordered cache add handler get job getjob cache add handler get job getjob statistics manager statisticsmanager job queue d jobqueued queue name queuename handler get job getjob get topic gettopic