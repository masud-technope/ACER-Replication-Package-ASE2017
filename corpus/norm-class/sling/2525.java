licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling event impl jobs tasks java util array list arraylist java util arrays java util calendar java util iterator java util list org apache felix scr annotations component org apache felix scr annotations property org apache felix scr annotations reference org apache felix scr annotations service org apache sling api resource persistence exception persistenceexception org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling api resource resource util resourceutil org apache sling api resource value map valuemap org apache sling event impl jobs job impl jobimpl org apache sling event impl jobs config job manager configuration jobmanagerconfiguration org apache sling event jobs job org apache sling event jobs consumer job execution context jobexecutioncontext org apache sling event jobs consumer job execution result jobexecutionresult org apache sling event jobs consumer job executor jobexecutor org slf logger org slf logger factory loggerfactory task clean history clean task configured properties age jobs older amount minutes removed days topic jobs topic removed topic meaning jobs removed string array string jobs removed meaning jobs removed string array string allowed values succeeded stopped error dropped component service job executor jobexecutor property job executor jobexecutor property topics org apache sling event impl jobs tasks history clean up task historycleanuptask history clean up task historycleanuptask job executor jobexecutor string property age age string property topic topic string property older days age logger logger logger factory loggerfactory get logger getlogger get class getclass reference job manager configuration jobmanagerconfiguration configuration override job execution result jobexecutionresult process job job job execution context jobexecutioncontext context age job get property getproperty property age age age age age calendar remove date removedate calendar get instance getinstance remove date removedate add calendar minute age string topics job get property getproperty property topic string string job get property getproperty property string string log topics logtopics topics arrays to string tostring topics string log states logstates arrays to string tostring context log cleaning job history removing jobs older topics remove date removedate log topics logtopics log states logstates list string state list statelist state list statelist array list arraylist string string state list statelist add state list statelist resource resolver resourceresolver resolver configuration create resource resolver createresourceresolver state list statelist state list statelist job job state jobstate succeeded cleanup remove date removedate resolver context configuration get stored successful jobs path getstoredsuccessfuljobspath topics state list statelist state list statelist job job state jobstate dropped state list statelist job job state jobstate error state list statelist job job state jobstate state list statelist job job state jobstate stopped cleanup remove date removedate resolver context configuration get stored cancelled jobs path getstoredcancelledjobspath topics state list statelist persistence exception persistenceexception logger warn exception job resource tree cleanup resolver close context result succeeded cleanup calendar remove date removedate resource resolver resourceresolver resolver job execution context jobexecutioncontext context string base path basepath string topics list string state list statelist persistence exception persistenceexception resource base resource baseresource resolver get resource getresource base path basepath sanity check base resource baseresource iterator resource topic iter topiciter base resource baseresource list children listchildren context is stopped isstopped topic iter topiciter has next hasnext resource topic resource topicresource topic iter topiciter check topic topics topics length topic resource topicresource get name getname equals topics years iterator resource year iter yeariter topic resource topicresource list children listchildren context is stopped isstopped year iter yeariter has next hasnext resource year resource yearresource year iter yeariter year integer value of valueof year resource yearresource get name getname old year oldyear year remove date removedate calendar year months iterator resource month iter monthiter year resource yearresource list children listchildren context is stopped isstopped month iter monthiter has next hasnext resource month resource monthresource month iter monthiter month integer value of valueof month resource monthresource get name getname old month oldmonth old year oldyear month remove date removedate calendar month days iterator resource day iter dayiter month resource monthresource list children listchildren context is stopped isstopped day iter dayiter has next hasnext resource day resource dayresource day iter dayiter day integer value of valueof day resource dayresource get name getname old day oldday old month oldmonth day remove date removedate calendar day month hours iterator resource hour iter houriter day resource dayresource list children listchildren context is stopped isstopped hour iter houriter has next hasnext resource hour resource hourresource hour iter houriter hour integer value of valueof hour resource hourresource get name getname old hour oldhour old day oldday hour remove date removedate calendar hour day minutes iterator resource minute iter minuteiter hour resource hourresource list children listchildren context is stopped isstopped minute iter minuteiter has next hasnext resource minute resource minuteresource minute iter minuteiter check delete minute minute integer value of valueof minute resource minuteresource get name getname old min ute oldminute old hour oldhour minute remove date removedate calendar minute old min ute oldminute iterator resource job iter jobiter minute resource minuteresource list children listchildren context is stopped isstopped job iter jobiter has next hasnext resource job resource jobresource job iter jobiter remove state list statelist remove value map valuemap resource util resourceutil get value map getvaluemap job resource jobresource string job impl jobimpl property finished string state list statelist remove remove resolver delete job resource jobresource resolver commit check delete minute context is stopped isstopped old min ute oldminute minute resource minuteresource list children listchildren has next hasnext resolver delete minute resource minuteresource resolver commit check delete hour context is stopped isstopped old hour oldhour hour resource hourresource list children listchildren has next hasnext resolver delete hour resource hourresource resolver commit check delete day context is stopped isstopped old day oldday day resource dayresource list children listchildren has next hasnext resolver delete day resource dayresource resolver commit check delete month context is stopped isstopped old month oldmonth month resource monthresource list children listchildren has next hasnext resolver delete month resource monthresource resolver commit check delete year context is stopped isstopped old year oldyear year resource yearresource list children listchildren has next hasnext resolver delete year resource yearresource resolver commit