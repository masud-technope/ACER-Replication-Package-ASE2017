licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license sandroboehme jsnodetypes mock sandroboehme jsnodetypes generation constants generationconstants nodetype req primary type sandroboehme jsnodetypes generation constants generationconstants nodetype req primary type org mockito matchers any int anyint org mockito mockito mock org mockito mockito org mockito mockito verify org mockito mockito java buffered reader bufferedreader java byte array output stream bytearrayoutputstream java file reader filereader java io exception ioexception java print writer printwriter java net url javax jcr node javax jcr repository exception repositoryexception javax jcr session javax jcr workspace javax jcr node type nodetype node definition nodedefinition javax jcr node type nodetype node type nodetype javax jcr node type nodetype node type iterator nodetypeiterator javax jcr node type nodetype node type manager nodetypemanager javax jcr version on parent version action onparentversionaction javax servlet servlet exception servletexception org apache sling api sling http servlet request slinghttpservletrequest org apache sling api sling http servlet response slinghttpservletresponse org apache sling api resource resource org apache sling api servlets http constants httpconstants org apache sling commons node types nodetypes nodetypesjsonservlet org apache sling commons json json exception jsonexception org apache sling commons json json object jsonobject org apache sling commons json json t okener jsontokener sandroboehme jsnodetypes test json assert jsonassert generates node type nodetype mocks returned servlet cal les calles node type manager nodetypemanager get all node types getallnodetypes mocks request response output stream simulate environment servlet runtime mock node type generator mocknodetypegenerator mock classes sling http servlet request slinghttpservletrequest request sling http servlet response slinghttpservletresponse response resource resource node current node currentnode session session workspace workspace node type manager nodetypemanager nt manager ntmanager node type iterator nodetypeiterator node type iterator nodetypeiterator byte array output stream bytearrayoutputstream out stream outstream mock property def generator mockpropertydefgenerator property generator propertygenerator mock property def generator mockpropertydefgenerator set up setup repository exception repositoryexception io exception ioexception create mocks request mock sling http servlet request slinghttpservletrequest response mock sling http servlet response slinghttpservletresponse resource mock resource current node currentnode mock node session mock session workspace mock workspace nt manager ntmanager mock node type manager nodetypemanager node type iterator nodetypeiterator mock node type iterator nodetypeiterator out stream outstream byte array output stream bytearrayoutputstream stub bin g stubbing request get resource getresource then return thenreturn resource request get method getmethod then return thenreturn http constants httpconstants method response get writer getwriter then return thenreturn print writer printwriter out stream outstream resource adapt to adaptto node then return thenreturn current node currentnode current node currentnode get session getsession then return thenreturn session session get workspace getworkspace then return thenreturn workspace workspace get node type manager getnodetypemanager then return thenreturn nt manager ntmanager nt manager ntmanager get all node types getallnodetypes then return thenreturn node type iterator nodetypeiterator mock property def generator mockpropertydefgenerator get property generator getpropertygenerator property generator propertygenerator node definition nodedefinition get simple child node def getsimplechildnodedef string node definition nodedefinition child node def childnodedef mock node definition nodedefinition node type nodetype req primary types reqprimarytypes get simple node type with name getsimplenodetypewithname nodetype req primary type get simple node type with name getsimplenodetypewithname nodetype req primary type child node def childnodedef get required primary types getrequiredprimarytypes then return thenreturn req primary types reqprimarytypes child node def childnodedef get name getname then return thenreturn child node def childnodedef get on parent version getonparentversion then return thenreturn on parent version action onparentversionaction copy child node def childnodedef node definition nodedefinition get complete child node def getcompletechildnodedef string node definition nodedefinition child node def childnodedef mock node definition nodedefinition node type nodetype required primary type requiredprimarytype get simple node type with name getsimplenodetypewithname nodetype req primary type node type nodetype required primary type requiredprimarytype get simple node type with name getsimplenodetypewithname nodetype req primary type node type nodetype req primary types reqprimarytypes required primary type requiredprimarytype required primary type requiredprimarytype child node def childnodedef get required primary types getrequiredprimarytypes then return thenreturn req primary types reqprimarytypes child node def childnodedef get name getname then return thenreturn child node def childnodedef get on parent version getonparentversion then return thenreturn on parent version action onparentversionaction version child node def childnodedef get default primary type getdefaultprimarytype then return thenreturn required primary type requiredprimarytype child node def childnodedef allows same name siblings allowssamenamesiblings then return thenreturn child node def childnodedef is auto created isautocreated then return thenreturn child node def childnodedef is mandatory ismandatory then return thenreturn child node def childnodedef is protected isprotected then return thenreturn child node def childnodedef assert equals with servlet result assertequalswithservletresult string filename json exception jsonexception servlet exception servletexception io exception ioexception nodetypesjsonservlet generation servlet generationservlet nodetypesjsonservlet generation servlet generationservlet service request response verify response send error senderror any int anyint string resultingjson string out stream outstream to byte array tobytearray utf string expectedntjson getexpectedntjson filename json object jsonobject actual json object from servlet actualjsonobjectfromservlet json object jsonobject json t okener jsontokener resultingjson json assert jsonassert assert equals assertequals actual json resultingjson n expected nexpected json expectedntjson json object jsonobject json t okener jsontokener expectedntjson actual json object from servlet actualjsonobjectfromservlet string getexpectedntjson string filename io exception ioexception url file uri fileuri mock node type generator mocknodetypegenerator get resource getresource expectedntjson filename json buffered reader bufferedreader buffered reader bufferedreader file reader filereader file uri fileuri get file getfile string current line currentline string builder stringbuilder file content filecontent string builder stringbuilder current line currentline read line readline file content filecontent append current line currentline file content filecontent to string tostring node type nodetype get simple node type with name getsimplenodetypewithname string node type name nodetypename node type nodetype mock node type nodetype node type nodetype supertype mock node type nodetype supertype get name getname then return thenreturn base node type nodetype super types supertypes supertype get declared super types getdeclaredsupertypes then return thenreturn super types supertypes get name getname then return thenreturn node type name nodetypename