licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling discovery commons providers base org junit assert equals assertequals org junit assert true asserttrue org junit assert null assertnull org junit fail java util hash map hashmap java util random java util uuid org apache sling discovery topology event topologyevent org apache sling discovery commons providers base topology view basetopologyview org apache sling discovery commons providers default cluster view defaultclusterview org apache sling discovery commons providers default instance description defaultinstancedescription org apache sling discovery commons providers dummy topology view dummytopologyview org apache sling discovery commons providers event helper eventhelper org apache sling discovery commons providers base view state manager impl viewstatemanagerimpl org slf logger org slf logger factory loggerfactory test helper testhelper logger logger logger factory loggerfactory get logger getlogger test helper testhelper assert events assertevents view state manager impl viewstatemanagerimpl mgr dummy listener dummylistener listener topology event topologyevent events wait for async events waitforasyncevents mgr assert equals assertequals events length listener count events countevents events length topology event topologyevent events assert equals assertequals get type gettype listener get events getevents get type gettype get type gettype topology init assert null assertnull listener get events getevents get old view getoldview assert equals assertequals get new view getnewview listener get events getevents get new view getnewview topology changing assert equals assertequals get old view getoldview listener get events getevents get old view getoldview assert null assertnull listener get events getevents get new view getnewview properties changed topology changed assert equals assertequals get old view getoldview listener get events getevents get old view getoldview assert equals assertequals get new view getnewview listener get events getevents get new view getnewview fail type supported listener clear events clearevents wait for async events waitforasyncevents view state manager impl viewstatemanagerimpl mgr sleep mgr get async event sender getasynceventsender has in flight event hasinflightevent minimum thread sleep sleep interrupted exception interruptedexception logger error wait for flush waitforflush int errupted interrupted minor sleep math min sleep assert no events assertnoevents dummy listener dummylistener listener assert equals assertequals listener count events countevents couple loops randomly calling handle changing handlechanging handle new view handlenewview note random passed custom izing customizing hardcoding method random interrupted exception interruptedexception random event loop randomeventloop view state manager impl viewstatemanagerimpl mgr dummy discovery service dummydiscoveryservice sds loop size loopsize delay in millis delayinmillis random random dummy listener dummylistener listeners interrupted exception interruptedexception loop size loopsize should call changing shouldcallchanging random next boolean nextboolean should call changing shouldcallchanging don t dont changing logger debug random event loop randomeventloop calling handle changing handlechanging mgr handle changing handlechanging wait async events processed get last view getlastview correct view logger debug random event loop randomeventloop waiting async events wait for async events waitforasyncevents mgr logger debug random event loop randomeventloop asserting changing event listeners length assert events assertevents mgr listeners event helper eventhelper new changing event newchangingevent listeners get last view getlastview logger debug random event loop randomeventloop asserting events listeners length assert no events assertnoevents listeners dummy topology view dummytopologyview view dummy topology view dummytopologyview add instance addinstance base topology view basetopologyview last views lastviews base topology view basetopologyview listeners length listeners length last views lastviews listeners get last view getlastview logger debug random event loop randomeventloop calling handle new view handlenewview sds sds set topo ology settopoology view dummy topology view dummytopologyview clone d view clonedview view clone mgr handle new view handlenewview view delay in millis delayinmillis logger debug random event loop randomeventloop waiting delay in millis delayinmillis thread sleep delay in millis delayinmillis logger debug random event loop randomeventloop waiting delay in millis delayinmillis assert equals assertequals mgr wait for async events waitforasyncevents should call changing shouldcallchanging changing contract logger debug random event loop randomeventloop asserting changing changed events listeners length assert events assertevents mgr listeners event helper eventhelper new changing event newchangingevent last views lastviews event helper eventhelper new changed event newchangedevent last views lastviews view logger debug random event loop randomeventloop asserting changed event listeners length assert events assertevents mgr listeners event helper eventhelper new changed event newchangedevent last views lastviews clone d view clonedview dummy topology view dummytopologyview new view newview is current iscurrent string leader id leaderid string local id localid string sling ids slingids new view newview uuid randomuuid to string tostring uuid randomuuid to string tostring is current iscurrent leader id leaderid local id localid sling ids slingids dummy topology view dummytopologyview new view newview string sync id syncid string cluster id clusterid is current iscurrent string leader id leaderid string local id localid string sling ids slingids dummy topology view dummytopologyview topology dummy topology view dummytopologyview sync id syncid default cluster view defaultclusterview cluster default cluster view defaultclusterview cluster id clusterid string sling id slingid sling ids slingids default instance description defaultinstancedescription default instance description defaultinstancedescription cluster sling id slingid equals leader id leaderid sling id slingid equals local id localid sling id slingid hash map hashmap string string topology add instance description addinstancedescription is current iscurrent topology set not current setnotcurrent topology