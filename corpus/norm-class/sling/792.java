licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling servlets comp at compat impl java io exception ioexception java util array list arraylist java util iterator java util list java util map org apache felix scr annotations component org apache felix scr annotations properties org apache felix scr annotations property org apache felix scr annotations service org apache sling api sling exception slingexception org apache sling api sling http servlet request slinghttpservletrequest org apache sling api sling http servlet response slinghttpservletresponse org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling api resource resource util resourceutil org apache sling api servlets sling safe methods servlet slingsafemethodsservlet org apache sling commons json json exception jsonexception org apache sling commons json json writer jsonwriter org apache sling servlets impl helpers json resource writer jsonresourcewriter org slf logger org slf logger factory loggerfactory sling safe methods servlet slingsafemethodsservlet renders search json data query servlet json requests sling component service javax servlet servlet properties property service description query servlet property service vendor apache software foundation property sling servlet resource types resourcetypes sling servlet property sling servlet extensions json property sling servlet selectors query property sling servlet prefix int value intvalue json query servlet jsonqueryservlet sling safe methods servlet slingsafemethodsservlet serialversionuid logger log logger factory loggerfactory get logger getlogger json query servlet jsonqueryservlet search clause string statement statement query type string query type query type querytype result offset string offset offset number rows requested string rows rows property append result string property property exerpt lookup path string excerpt path exc erpt path excerptpath rep exerpt string rep excerpt rep exc erpt excerpt string tidy tidy json resource writer jsonresourcewriter item writer itemwriter json query servlet jsonqueryservlet item writer itemwriter json resource writer jsonresourcewriter request tidy pretty printed format is tidy istidy sling http servlet request slinghttpservletrequest req string selector req get request path info getrequestpathinfo get selectors getselectors tidy equals selector override do get doget sling http servlet request slinghttpservletrequest req sling http servlet response slinghttpservletresponse resp io exception ioexception dump result dumpresult req resp retrieve query type request param req request query type string get query type getquerytype sling http servlet request slinghttpservletrequest req req get parameter getparameter query type retrieve query statement request param req request param query type querytype query type determined query statement string get statement getstatement sling http servlet request slinghttpservletrequest req string query type querytype req get parameter getparameter statement dumps result json object param req request param resp response io exception ioexception search unexpectedly fail dump result dumpresult sling http servlet request slinghttpservletrequest req sling http servlet response slinghttpservletresponse resp io exception ioexception resource resolver resourceresolver resolver req get resource resolver getresourceresolver string query type querytype get query type getquerytype req string statement get statement getstatement req query type querytype iterator map string object result resolver query resources queryresources statement query type querytype req get parameter getparameter offset skip parse long parselong req get parameter getparameter offset skip result has next hasnext result skip resp set content type setcontenttype req get response content type getresponsecontenttype resp set character encoding setcharacterencoding utf json writer jsonwriter json writer jsonwriter resp get writer getwriter set tidy settidy is tidy istidy req array count req get parameter getparameter rows count parse long parselong req get parameter getparameter rows list string properties array list arraylist string req get parameter values getparametervalues property string property req get parameter values getparametervalues property properties add property string exerpt path exerptpath req get parameter getparameter excerpt path exerpt path exerptpath req get parameter getparameter excerpt path iter ate iterate result build json result result has next hasnext count map string object row result object string path row jcr path to string tostring key resource util resourceutil get name getname path dump columns string col name colname row key set keyset key col name colname string str value strvalue col name colname equals rep excerpt object row rep exc erpt excerpt exerpt path exerptpath str value strvalue to string tostring str value strvalue str value strvalue format value formatvalue row col name colname item writer itemwriter dump value dumpvalue row col name colname str value strvalue load properties add result properties is empty isempty resource node res noderes resolver get resource getresource path dump properties dumpproperties node res noderes properties end object endobject count end array endarray json exception jsonexception wrap exception wrapexception dump properties dumpproperties json writer jsonwriter resource node res noderes list string properties json exception jsonexception resource node res noderes item writer itemwriter dump properties dumpproperties node res noderes properties param org apache sling api sling exception slingexception wrapping exception sling exception slingexception wrap exception wrapexception exception log warn error query servlet queryservlet to string tostring sling exception slingexception to string tostring