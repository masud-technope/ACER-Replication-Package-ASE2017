licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling resource access security resourceaccesssecurity impl junit framework test case testcase org apache sling api resource modifiable value map modifiablevaluemap org apache sling api resource resource org apache sling api resource value map valuemap org apache sling api security resource access security resourceaccesssecurity org apache sling resource access security resourceaccesssecurity resource access gate resourceaccessgate org junit org junit test org osgi framework bundle org osgi framework bundle context bundlecontext org osgi framework service reference servicereference org junit assert false assertfalse org junit assert null assertnull org mockito mockito mock org mockito mockito times org mockito mockito org mockito mockito verify org junit assert true asserttrue resource access security impl tests resourceaccesssecurityimpltests service reference servicereference service reference servicereference resource access security resourceaccesssecurity resource access security resourceaccesssecurity resource access gate resourceaccessgate resource access gate resourceaccessgate set up setup resource access security resourceaccesssecurity provider resource access security impl providerresourceaccesssecurityimpl test test can update testcanupdate init mocks initmocks content string update resource resource mock resource resource get path getpath then return thenreturn content resource access gate resourceaccessgate can update canupdate resource then return thenreturn resource access gate resourceaccessgate gate result gateresult granted assert true asserttrue resource access security resourceaccesssecurity can update canupdate resource test test cannot update testcannotupdate init mocks initmocks content string update resource resource mock resource resource get path getpath then return thenreturn content resource access gate resourceaccessgate can update canupdate resource then return thenreturn resource access gate resourceaccessgate gate result gateresult denied assert false assertfalse resource access security resourceaccesssecurity can update canupdate resource test test cannot update wrong path testcannotupdatewrongpath init mocks initmocks content string update resource resource mock resource resource get path getpath then return thenreturn wrong content wrongcontent resource access gate resourceaccessgate can update canupdate resource then return thenreturn resource access gate resourceaccessgate gate result gateresult granted assert false assertfalse resource access security resourceaccesssecurity can update canupdate resource test test can update using readable resource testcanupdateusingreadableresource read rights resource init mocks initmocks content string read update resource resource mock resource resource get path getpath then return thenreturn content modifiable value map modifiablevaluemap value map valuemap mock modifiable value map modifiablevaluemap resource adapt to adaptto modifiable value map modifiablevaluemap then return thenreturn value map valuemap resource access gate resourceaccessgate can read canread resource then return thenreturn resource access gate resourceaccessgate gate result gateresult granted resource access gate resourceaccessgate can update canupdate resource then return thenreturn resource access gate resourceaccessgate gate result gateresult granted resource readable resource readableresource resource access security resourceaccesssecurity get readable resource getreadableresource resource modifiable value map modifiablevaluemap result value map resultvaluemap readable resource readableresource adapt to adaptto modifiable value map modifiablevaluemap result value map resultvaluemap modified verify value map valuemap times modified test test cannot update using readable resource if cannot read testcannotupdateusingreadableresourceifcannotread init mocks initmocks content string read update resource resource mock resource resource get path getpath then return thenreturn content modifiable value map modifiablevaluemap value map valuemap mock modifiable value map modifiablevaluemap resource adapt to adaptto modifiable value map modifiablevaluemap then return thenreturn value map valuemap resource access gate resourceaccessgate can read canread resource then return thenreturn resource access gate resourceaccessgate gate result gateresult denied resource access gate resourceaccessgate can update canupdate resource then return thenreturn resource access gate resourceaccessgate gate result gateresult granted resource readable resource readableresource resource access security resourceaccesssecurity get readable resource getreadableresource resource assert null assertnull readable resource readableresource test test cannot update using readable resource if cannot update testcannotupdateusingreadableresourceifcannotupdate init mocks initmocks content string read update resource resource mock resource resource get path getpath then return thenreturn content modifiable value map modifiablevaluemap value map valuemap mock modifiable value map modifiablevaluemap resource adapt to adaptto modifiable value map modifiablevaluemap then return thenreturn value map valuemap resource access gate resourceaccessgate can read canread resource then return thenreturn resource access gate resourceaccessgate gate result gateresult granted resource access gate resourceaccessgate can update canupdate resource then return thenreturn resource access gate resourceaccessgate gate result gateresult denied resource readable resource readableresource resource access security resourceaccesssecurity get readable resource getreadableresource resource modifiable value map modifiablevaluemap result value map resultvaluemap readable resource readableresource adapt to adaptto modifiable value map modifiablevaluemap assert null assertnull result value map resultvaluemap test test cannot update acc ident ally using readable resource if cannot update testcannotupdateaccidentallyusingreadableresourceifcannotupdate init mocks initmocks content string read update resource resource mock resource resource get path getpath then return thenreturn content modifiable value map modifiablevaluemap value map valuemap mock modifiable value map modifiablevaluemap resource adapt to adaptto modifiable value map modifiablevaluemap then return thenreturn value map valuemap resource access gate resourceaccessgate can read canread resource then return thenreturn resource access gate resourceaccessgate gate result gateresult granted resource access gate resourceaccessgate can update canupdate resource then return thenreturn resource access gate resourceaccessgate gate result gateresult denied resource readable resource readableresource resource access security resourceaccesssecurity get readable resource getreadableresource resource value map valuemap result value map resultvaluemap readable resource readableresource adapt to adaptto value map valuemap result value map resultvaluemap modified verify value map valuemap times modified init mocks initmocks string path string operations service reference servicereference mock service reference servicereference bundle bundle mock bundle bundle context bundlecontext bundle context bundlecontext mock bundle context bundlecontext resource access gate resourceaccessgate mock resource access gate resourceaccessgate service reference servicereference get bundle getbundle then return thenreturn bundle bundle get bundle context getbundlecontext then return thenreturn bundle context bundlecontext bundle context bundlecontext get service getservice service reference servicereference then return thenreturn resource access gate resourceaccessgate service reference servicereference get property getproperty resource access gate resourceaccessgate path then return thenreturn path service reference servicereference get property getproperty resource access gate resourceaccessgate operations then return thenreturn operations provider resource access security impl providerresourceaccesssecurityimpl resource access security resourceaccesssecurity bind resource access gate bindresourceaccessgate service reference servicereference