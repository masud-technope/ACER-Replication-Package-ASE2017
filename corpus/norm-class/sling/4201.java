licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling event org junit assert equals assertequals org junit assert false assertfalse org junit assert not null assertnotnull org junit assert true asserttrue java io exception ioexception java util array list arraylist java util collection java util collections java util dictionary java util hashtable java util list java util map java util concurrent atomic atomic integer atomicinteger org apache sling event impl barrier org apache sling event impl jobs config configuration constants configurationconstants org apache sling event jobs job org apache sling event jobs job manager jobmanager org apache sling event jobs notification constants notificationconstants org apache sling event jobs queue configuration queueconfiguration org apache sling event jobs consumer job consumer jobconsumer org apache sling event jobs consumer job execution context jobexecutioncontext org apache sling event jobs consumer job execution result jobexecutionresult org apache sling event jobs consumer job executor jobexecutor org junit org junit org junit test org junit runner run with runwith org ops pax exam junit pax exam paxexam org ops pax exam spi reactors exam reactor strategy examreactorstrategy org ops pax exam spi reactors per method permethod org osgi framework service registration serviceregistration org osgi service event event org osgi service event event handler eventhandler run with runwith pax exam paxexam exam reactor strategy examreactorstrategy per method permethod job handling test jobhandlingtest abstract job handling test abstractjobhandlingtest string topic sling test string queue conf pid queueconfpid override setup io exception ioexception setup create test queue org osgi service configuration config config admin configadmin create factory configuration createfactoryconfiguration org apache sling event jobs queue configuration queueconfiguration dictionary string object props hashtable string object props configuration constants configurationconstants prop test props configuration constants configurationconstants prop type queue configuration queueconfiguration type unordered props configuration constants configurationconstants prop topics string topic topic props configuration constants configurationconstants prop retries props configuration constants configurationconstants prop retry delay config update props queue conf pid queueconfpid config get pid getpid sleep clean up cleanup io exception ioexception remove configuration removeconfiguration queue conf pid queueconfpid cleanup test simple job execution job executed finished test timeout test timeout test simple job execution using job consumer testsimplejobexecutionusingjobconsumer exception barrier barrier service registration serviceregistration reg register job consumer registerjobconsumer topic job consumer jobconsumer override job result jobresult process job job block job result jobresult get job manager getjobmanager add job addjob topic assert true asserttrue event received time block reset assert false assertfalse unexpected event received time block reg unregister test simple job execution job executed finished test timeout test timeout test simple job execution using job executor testsimplejobexecutionusingjobexecutor exception barrier barrier service registration serviceregistration reg register job executor registerjobexecutor topic job executor jobexecutor override job execution result jobexecutionresult process job job job execution context jobexecutioncontext context block context result succeeded get job manager getjobmanager add job addjob topic assert true asserttrue event received time block reset assert false assertfalse unexpected event received time block reg unregister test timeout test timeout test many jobs testmanyjobs exception service registration serviceregistration reg register job consumer registerjobconsumer topic job consumer jobconsumer override job result jobresult process job job job result jobresult atomic integer atomicinteger count atomic integer atomicinteger service registration serviceregistration reg register event handler registereventhandler notification constants notificationconstants topic job finished event handler eventhandler override handle event handleevent event event count increment and get incrementandget start jobs count count get job manager getjobmanager add job addjob topic count count sleep assert equals assertequals finished count count count assert equals assertequals finished count count get job manager getjobmanager get statistics getstatistics get number of finished jobs getnumberoffinishedjobs reg unregister reg unregister extra sleep fixes test problems java sleep test can celing canceling job job execution fails test timeout test timeout test cancel job testcanceljob exception barrier barrier barrier barrier service registration serviceregistration jc reg jcreg register job consumer registerjobconsumer topic job consumer jobconsumer override job result jobresult process job job block block job result jobresult failed map string object job properties jobproperties collections singleton map singletonmap object cancel job id canceljobid suppress warnings suppresswarnings unchecked map string object job properties as array jobpropertiesasarray map job properties as array jobpropertiesasarray job properties jobproperties create job job manager jobmanager job manager jobmanager get job manager getjobmanager job manager jobmanager add job addjob topic job properties jobproperties block assert equals assertequals job manager jobmanager find jobs findjobs job manager jobmanager query type querytype topic job properties as array jobpropertiesasarray size job waiting cancel fails job job manager jobmanager get job getjob topic job properties jobproperties assert not null assertnotnull job block sleep job queue job job manager jobmanager get job getjob topic job properties jobproperties assert not null assertnotnull assert true asserttrue job manager jobmanager remove job by id removejobbyid get id getid assert equals assertequals job manager jobmanager find jobs findjobs job manager jobmanager query type querytype topic job properties as array jobpropertiesasarray size collection job col job manager jobmanager find jobs findjobs job manager jobmanager query type querytype history topic job properties as array jobpropertiesasarray assert equals assertequals col size job col job manager jobmanager remove job by id removejobbyid get id getid jc reg jcreg unregister test job test timeout test timeout test get job testgetjob exception barrier barrier barrier barrier service registration serviceregistration jc reg jcreg register job consumer registerjobconsumer topic job consumer jobconsumer override job result jobresult process job job block block job result jobresult job manager jobmanager job manager jobmanager get job manager getjobmanager job job manager jobmanager add job addjob topic block assert not null assertnotnull job manager jobmanager get job getjob topic job block job manager jobmanager remove job by id removejobbyid get id getid jc reg jcreg unregister res chedule reschedule test job res cheduled rescheduled times fails test timeout test timeout test start job and res chedule teststartjobandreschedule exception list integer retry count list retrycountlist array list arraylist integer barrier barrier service registration serviceregistration jc reg jcreg register job consumer registerjobconsumer topic job consumer jobconsumer retry count retrycount override job result jobresult process job job retry job get property getproperty job property job retry count retry integer job get property getproperty job property job retry count retry retry count retrycount retry count list retrycountlist add retry retry count retrycount block job result jobresult failed job manager jobmanager job manager jobmanager get job manager getjobmanager job job job manager jobmanager add job addjob topic assert true asserttrue event received time block reset job ret ried retried seconds wait assert true asserttrue event received time block reset job ret ried retried seconds wait assert true asserttrue event received time block reached retry expect event reset assert false assertfalse unexpected event received time block assert equals assertequals unexpected number retries retry count list retrycountlist size job manager jobmanager remove job by id removejobbyid job get id getid jc reg jcreg unregister not ifications notifications send jobs treated invocations test timeout test timeout test not ifications testnotifications exception list string cancelled collections synchronized list synchronizedlist array list arraylist string list string failed collections synchronized list synchronizedlist array list arraylist string list string finished collections synchronized list synchronizedlist array list arraylist string list string started collections synchronized list synchronizedlist array list arraylist string service registration serviceregistration jc reg jcreg register job consumer registerjobconsumer topic job consumer jobconsumer override job result jobresult process job job events finish time string string job get property getproperty equals equals job result jobresult fails equals job result jobresult failed retry job get property getproperty job property job retry count retry integer job get property getproperty job property job retry count fails time equals retry job result jobresult failed job result jobresult fails time equals retry retry job result jobresult failed job result jobresult job result jobresult failed service registration serviceregistration reg register event handler registereventhandler notification constants notificationconstants topic job cancel led cancelled event handler eventhandler override handle event handleevent event event string string event get property getproperty cancelled add service registration serviceregistration reg register event handler registereventhandler notification constants notificationconstants topic job failed event handler eventhandler override handle event handleevent event event string string event get property getproperty failed add service registration serviceregistration reg register event handler registereventhandler notification constants notificationconstants topic job finished event handler eventhandler override handle event handleevent event event string string event get property getproperty finished add service registration serviceregistration reg register event handler registereventhandler notification constants notificationconstants topic job started event handler eventhandler override handle event handleevent event event string string event get property getproperty started add job manager jobmanager job manager jobmanager get job manager getjobmanager job manager jobmanager add job addjob topic collections singleton map singletonmap object job manager jobmanager add job addjob topic collections singleton map singletonmap object job manager jobmanager add job addjob topic collections singleton map singletonmap object job manager jobmanager add job addjob topic collections singleton map singletonmap object job manager jobmanager add job addjob topic collections singleton map singletonmap object count start time starttime system current time millis currenttimemillis count finished size cancelled size seconds cancel test system current time millis currenttimemillis start time starttime exception timeout not ification notification test count started size assert equals assertequals finished count finished size assert equals assertequals cancelled count cancelled size assert equals assertequals started count started size assert equals assertequals failed count failed size collection job col job manager jobmanager find jobs findjobs job manager jobmanager query type querytype history sling test map string object job col job manager jobmanager remove job by id removejobbyid get id getid jc reg jcreg unregister reg unregister reg unregister reg unregister reg unregister test sending jobs processor test timeout test timeout test no job processor testnojobprocessor exception atomic integer atomicinteger count atomic integer atomicinteger service registration serviceregistration register job consumer registerjobconsumer topic job consumer jobconsumer override job result jobresult process job job count increment and get incrementandget job result jobresult job manager jobmanager job manager jobmanager get job manager getjobmanager start jobs job processor count count string job topic jobtopic topic topic job manager jobmanager add job addjob job topic jobtopic job manager jobmanager get statistics getstatistics get number of finished jobs getnumberoffinishedjobs count sleep assert equals assertequals finished count count count unprocessed count job consumer job assert equals assertequals unprocessed count job manager jobmanager get statistics getstatistics get number of jobs getnumberofjobs assert equals assertequals finished count count job manager jobmanager get statistics getstatistics get number of finished jobs getnumberoffinishedjobs remove jobs job job manager jobmanager find jobs findjobs job manager jobmanager query type querytype topic map string object job manager jobmanager remove job by id removejobbyid get id getid unregister