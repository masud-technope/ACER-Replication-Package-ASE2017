licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling launchpad webapp int egrationtest integrationtest servlets post org junit assert equals assertequals org junit assert true asserttrue org junit fail java io exception ioexception java util array list arraylist java util arrays java util hash map hashmap java util list java util map javax jcr repository javax jcr repository exception repositoryexception javax jcr session javax jcr simple credentials simplecredentials javax jcr observation event javax jcr observation event iterator eventiterator javax jcr observation event listener eventlistener javax jcr observation observation manager observationmanager javax servlet http http servlet response httpservletresponse org apache commons http client httpclient credentials org apache commons http client httpclient name value pair namevaluepair org apache commons http client httpclient username password credentials usernamepasswordcredentials org apache jackrabbit commons jcr utils jcrutils org apache sling commons json json array jsonarray org apache sling commons json json exception jsonexception org apache sling commons json json object jsonobject org apache sling commons testing int egration integration http test httptest org apache sling commons testing int egration integration name value pair list namevaluepairlist org apache sling launchpad webapp int egrationtest integrationtest authenticated test util authenticatedtestutil org apache sling servlets post sling post constants slingpostconstants org junit org junit org junit ignore org junit rule org junit test org junit rules test name testname post servlet privileges update test postservletprivilegesupdatetest string test base path sling tests string post url posturl string test user id testuserid authenticated test util authenticatedtestutil authenticated test util authenticatedtestutil rule test name testname test name testname test name testname setup exception set up setup post url posturl http test httptest http base url test base path system current time millis currenttimemillis javadoc org apache sling commons testing int egration integration http test base httptestbase tear down teardown cleanup exception test user id testuserid remove test user exists string post url posturl http test httptest http base url system user manager usermanager user test user id testuserid delete html list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair assert authenticated admin post status assertauthenticatedadminpoststatus post url posturl http servlet response httpservletresponse post params postparams tear down teardown test sling updating property requires jcr modify properties modifyproperties privilege node changing existing property observers receive property changed event property removed event property event test todo fails jackrabbit oak ignore test update property privileges and events testupdatepropertyprivilegesandevents io exception ioexception json exception jsonexception repository exception repositoryexception interrupted exception interruptedexception create user admin curl myuser fpwd password fpwd confirm fpwdconfirm password http admin admin localhost system user manager usermanager user create html test user id testuserid create test user createtestuser create node admin curl name hint namehint node fprop one fpropone prop one value proponevalue fprop one fpropone prop one value proponevalue fprop two fproptwo prop two value proptwovalue http admin admin localhost test string create test node url createtestnodeurl post url posturl sling post constants slingpostconstants create suffix name value pair list namevaluepairlist client node properties clientnodeproperties name value pair list namevaluepairlist client node properties clientnodeproperties add sling post constants slingpostconstants node hint test name testname get method name getmethodname client node properties clientnodeproperties add prop one propone prop one value proponevalue client node properties clientnodeproperties add prop one propone prop one value proponevalue client node properties clientnodeproperties add prop two proptwo prop two value proptwovalue string test node url testnodeurl get test client gettestclient create node createnode create test node url createtestnodeurl client node properties clientnodeproperties string content get content getcontent test node url testnodeurl json http test httptest content type json json object jsonobject json json object jsonobject content object prop one obj proponeobj json opt prop one propone assert true asserttrue prop one obj proponeobj json array jsonarray assert equals assertequals json array jsonarray prop one obj proponeobj length assert equals assertequals prop one value proponevalue json array jsonarray prop one obj proponeobj assert equals assertequals prop one value proponevalue json array jsonarray prop one obj proponeobj object prop two obj proptwoobj json opt prop two proptwo assert true asserttrue prop two obj proptwoobj string assert equals assertequals prop two value proptwovalue prop two obj proptwoobj attempt update property node test user testuser javax jcr access denied exception accessdeniedexception test node prop one propone allowed add modify item curl fprop one fpropone prop one value changed proponevaluechanged fprop two fproptwo prop two value changed proptwovaluechanged fprop two fproptwo prop two value changed proptwovaluechanged http myuser password localhost test node list name value pair namevaluepair post params postparams array list arraylist name value pair namevaluepair post params postparams add name value pair namevaluepair prop one propone prop one value changed proponevaluechanged post params postparams add name value pair namevaluepair prop two proptwo prop two value changed proptwovaluechanged post params postparams add name value pair namevaluepair prop two proptwo prop two value changed proptwovaluechanged credentials test user creds testusercreds username password credentials usernamepasswordcredentials test user id testuserid test pwd testpwd string expected message expectedmessage expected javax jcr access denied exception accessdeniedexception assert authenticated post status assertauthenticatedpoststatus test user creds testusercreds test node url testnodeurl http servlet response httpservletresponse internal server error post params postparams expected message expectedmessage grant jcr modify properties modifyproperties rights test user testuser admin curl fprincipal id fprincipalid myuser fprivilege jcr modify properties modifyproperties granted http admin admin localhost test node modify ace modifyace html map string string node ace properties nodeaceproperties hash map hashmap string string node ace properties nodeaceproperties principal id principalid test user id testuserid node ace properties nodeaceproperties privilege jcr modify properties modifyproperties granted get test client gettestclient create node createnode test node url testnodeurl modify ace modifyace html node ace properties nodeaceproperties davex session verify correct jcr events delivered repository repository jcr utils jcrutils get repository getrepository http test httptest http base url server session jcr session jcrsession test event listener testeventlistener listener test event listener testeventlistener observation manager observationmanager observation manager observationmanager jcr session jcrsession repository login simple credentials simplecredentials admin admin to char array tochararray observation manager observationmanager jcr session jcrsession get workspace getworkspace get observation manager getobservationmanager string test node path testnodepath test node url testnodeurl substring http test httptest http base url length observation manager observationmanager add event listener addeventlistener listener event property event property changed event types event property removed abs path abspath test node path testnodepath is deep isdeep uuid node type name nodetypename no local nolocal attempt update properties node curl fprop one fpropone prop one value changed proponevaluechanged fprop two fproptwo prop two value changed proptwovaluechanged fprop two fproptwo prop two value changed proptwovaluechanged http myuser password localhost test node assert authenticated post status assertauthenticatedpoststatus test user creds testusercreds test node url testnodeurl http servlet response httpservletresponse post params postparams expected message expectedmessage verify change happened string after update content afterupdatecontent get content getcontent test node url testnodeurl json http test httptest content type json json object jsonobject after update json afterupdatejson json object jsonobject after update content afterupdatecontent object after update prop one obj afterupdateproponeobj after update json afterupdatejson opt prop one propone assert true asserttrue after update prop one obj afterupdateproponeobj json array jsonarray assert equals assertequals json array jsonarray after update prop one obj afterupdateproponeobj length assert equals assertequals prop one value changed proponevaluechanged json array jsonarray after update prop one obj afterupdateproponeobj object after update prop two obj afterupdateproptwoobj after update json afterupdatejson opt prop two proptwo assert true asserttrue after update prop two obj afterupdateproptwoobj json array jsonarray assert equals assertequals json array jsonarray after update prop two obj afterupdateproptwoobj length assert equals assertequals prop two value changed proptwovaluechanged json array jsonarray after update prop two obj afterupdateproptwoobj assert equals assertequals prop two value changed proptwovaluechanged json array jsonarray after update prop two obj afterupdateproptwoobj wait expected jcr events delivered listener get event bundles processed geteventbundlesprocessed thread sleep assert equals assertequals property event expected listener to string tostring listener added properties addedproperties size assert equals assertequals test node path testnodepath prop two proptwo listener added properties addedproperties assert equals assertequals property removed event expected listener to string tostring listener removed properties removedproperties size assert equals assertequals test node path testnodepath prop two proptwo listener removed properties removedproperties assert equals assertequals property changed event expected listener to string tostring listener changed properties changedproperties size assert equals assertequals test node path testnodepath prop one propone listener changed properties changedproperties cleanup observation manager observationmanager observation manager observationmanager remove event listener removeeventlistener listener jcr session jcrsession log out logout repository test event listener testeventlistener event listener eventlistener list string changed properties changedproperties array list arraylist string list string added properties addedproperties array list arraylist string list string removed properties removedproperties array list arraylist string event bundles processed eventbundlesprocessed on event onevent event iterator eventiterator event iterator eventiterator event iterator eventiterator has next hasnext event event event iterator eventiterator next event nextevent type event get type gettype type event property changed changed properties changedproperties add event get path getpath event property added properties addedproperties add event get path getpath event property removed removed properties removedproperties add event get path getpath event bundles processed eventbundlesprocessed repository exception repositoryexception fail get message getmessage get event bundles processed geteventbundlesprocessed event bundles processed eventbundlesprocessed clear changed properties changedproperties clear added properties addedproperties clear removed properties removedproperties clear event bundles processed eventbundlesprocessed javadoc java lang object to string tostring override string to string tostring test event listener testeventlistener added properties addedproperties arrays to string tostring added properties addedproperties to array toarray changed properties changedproperties arrays to string tostring changed properties changedproperties to array toarray removed properties removedproperties arrays to string tostring removed properties removedproperties to array toarray