licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling testing mock sling loader java byte array input stream bytearrayinputstream java io exception ioexception java input stream inputstream java text date format dateformat java text parse exception parseexception java text simple date format simpledateformat java util calendar java util java util hash map hashmap java util map java util org apache commons io utils ioutils org apache commons lang char encoding charencoding org apache commons lang string utils stringutils org apache jackrabbit jcr constants jcrconstants org apache sling api resource modifiable value map modifiablevaluemap org apache sling api resource persistence exception persistenceexception org apache sling api resource resource org apache sling api resource resource resolver resourceresolver org apache sling api resource resource util resourceutil org apache sling commons json json array jsonarray org apache sling commons json json exception jsonexception org apache sling commons json json object jsonobject org apache sling commons json jcr json item writer jsonitemwriter org apache sling commons mime mime type service mimetypeservice org osgi framework bundle context bundlecontext org osgi framework service reference servicereference google common collect immutable map immutablemap google common collect immutable set immutableset imports json data binary data sling resource hierarchy operations json bin aries binaries link resource resolver resourceresolver commit called content loader contentloader string reference jcr reference string path jcr path string content type contenttype octet stream application octet stream string jcr data placeholder jcr data string names immutable set immutableset jcr constants jcrconstants jcr primarytype jcr constants jcrconstants jcr mixintypes jcr constants jcrconstants jcr uuid jcr constants jcrconstants jcr base version baseversion jcr constants jcrconstants jcr predecessors jcr constants jcrconstants jcr success ors successors jcr constants jcrconstants jcr created jcr constants jcrconstants jcr version history versionhistory jcr checked out checkedout jcr is checked out ischeckedout rep policy resource resolver resourceresolver resource resolver resourceresolver bundle context bundlecontext bundle context bundlecontext date format dateformat calendar format calendarformat param resource resolver resourceresolver resource resolver content loader contentloader resource resolver resourceresolver resource resolver resourceresolver resource resolver resourceresolver param resource resolver resourceresolver resource resolver param bundle context bundlecontext bundle context content loader contentloader resource resolver resourceresolver resource resolver resourceresolver bundle context bundlecontext bundle context bundlecontext resource resolver resourceresolver resource resolver resourceresolver bundle context bundlecontext bundle context bundlecontext calendar format calendarformat simple date format simpledateformat json item writer jsonitemwriter ecma format json item writer jsonitemwriter format locale content json file repository param classpath resource classpathresource classpath resource url json content param parent resource parentresource parent resource param child name childname child resource create json content resource resource json string classpath resource classpathresource resource parent resource parentresource string child name childname input stream inputstream content loader contentloader get resource as stream getresourceasstream classpath resource classpathresource illegal argument exception illegalargumentexception classpath resource classpath resource classpathresource json parent resource parentresource child name childname close io exception ioexception content json file repository auto creates parent hierarchies unstrucured nodes missing param classpath resource classpathresource classpath resource url json content param dest path destpath path json content resource resource json string classpath resource classpathresource string dest path destpath input stream inputstream content loader contentloader get resource as stream getresourceasstream classpath resource classpathresource illegal argument exception illegalargumentexception classpath resource classpath resource classpathresource json dest path destpath close io exception ioexception content json file repository param input stream inputstream input stream json content param parent resource parentresource parent resource param child name childname child resource create json content resource resource json input stream inputstream input stream inputstream resource parent resource parentresource string child name childname json input stream inputstream parent resource parentresource get path getpath child name childname content json file repository auto creates parent hierarchies unstrucured nodes missing param input stream inputstream input stream json content param dest path destpath path json content resource resource json input stream inputstream input stream inputstream string dest path destpath string parent path parentpath resource util resourceutil get parent getparent dest path destpath string child name childname resource util resourceutil get name getname dest path destpath resource parent resource parentresource resource resolver resourceresolver get resource getresource parent path parentpath parent resource parentresource parent resource parentresource create resource hierarchy createresourcehierarchy parent path parentpath parent resource parentresource get child getchild child name childname illegal argument exception illegalargumentexception resource exist dest path destpath string json string jsonstring convert to json string converttojsonstring input stream inputstream trim json object jsonobject json json object jsonobject json string jsonstring resource resource create resource createresource parent resource parentresource child name childname json resource resolver resourceresolver commit resource json exception jsonexception runtime exception runtimeexception io exception ioexception runtime exception runtimeexception resource create resource hierarchy createresourcehierarchy string path string parent path parentpath resource util resourceutil get parent getparent path parent path parentpath resource parent resource parentresource resource resolver resourceresolver get resource getresource parent path parentpath parent resource parentresource parent resource parentresource create resource hierarchy createresourcehierarchy parent path parentpath map string object props hash map hashmap string object props jcr constants jcrconstants jcr primarytype jcr constants jcrconstants unstructured resource resolver resourceresolver create parent resource parentresource resource util resourceutil get name getname path props persistence exception persistenceexception runtime exception runtimeexception resource create resource createresource resource parent resource parentresource string child name childname json object jsonobject json object jsonobject io exception ioexception json exception jsonexception collect properties has jcr data hasjcrdata map string object props hash map hashmap string object json array jsonarray names json object jsonobject names names names length string names get string getstring string utils stringutils equals jcr data placeholder has jcr data hasjcrdata names object obj json object jsonobject obj json object jsonobject set property setproperty props obj validate jcr primary type object primary type obj primarytypeobj json object jsonobject opt jcr constants jcrconstants jcr primarytype string primary type primarytype primary type obj primarytypeobj primary type primarytype string value of valueof primary type obj primarytypeobj primary type primarytype primary type primarytype jcr constants jcrconstants unstructured props jcr constants jcrconstants jcr primarytype primary type primarytype create resource resource resource resource resolver resourceresolver create parent resource parentresource child name childname props has jcr data hasjcrdata modifiable value map modifiablevaluemap value map valuemap resource adapt to adaptto modifiable value map modifiablevaluemap binary data avoid complain ts complaints jcr create empty binary data value map valuemap jcr constants jcrconstants jcr data byte array input stream bytearrayinputstream add child resources names names length string names get string getstring names object obj json object jsonobject obj json object jsonobject create resource createresource resource json object jsonobject obj resource set property setproperty map string object props string object json exception jsonexception json array jsonarray multivalue json array jsonarray array json array jsonarray array length object values object array length array length values array values values array values arrayvalues values length values length array values arrayvalues values props cleanup json name cleanupjsonname array values arrayvalues values number array values arrayvalues values length values length array values arrayvalues number values long value longvalue props cleanup json name cleanupjsonname array values arrayvalues values array values arrayvalues values length values length array values arrayvalues values props cleanup json name cleanupjsonname array values arrayvalues string array values arrayvalues string values length values length array values arrayvalues values to string tostring props cleanup json name cleanupjsonname array values arrayvalues props cleanup json name cleanupjsonname string single props cleanup json name cleanupjsonname number props cleanup json name cleanupjsonname number long value longvalue props cleanup json name cleanupjsonname string string value stringvalue to string tostring check calendar object calendar calendar try parse calendar value tryparsecalendarvalue string value stringvalue calendar props cleanup json name cleanupjsonname calendar props cleanup json name cleanupjsonname string value stringvalue string cleanup json name cleanupjsonname string starts with startswith reference substring reference length starts with startswith path substring path length string convert to json string converttojsonstring input stream inputstream input stream inputstream io utils ioutils to string tostring input stream inputstream char encoding charencoding utf io exception ioexception runtime exception runtimeexception input stream inputstream close io exception ioexception calendar try parse calendar value tryparsecalendarvalue string string utils stringutils is not blank isnotblank calendar format calendarformat calendar format calendarformat parse calendar calendar calendar get instance getinstance calendar set time settime calendar parse exception parseexception binary file file binary node repository auto creates parent hierarchies unstrucured nodes missing mime type auto detected resource param classpath resource classpathresource classpath resource url binary file param path path mount binary data parent nodes created automatically resource binary data resource binary file binaryfile string classpath resource classpathresource string path input stream inputstream content loader contentloader get resource as stream getresourceasstream classpath resource classpathresource illegal argument exception illegalargumentexception classpath resource classpath resource classpathresource binary file binaryfile path detect mime type from name detectmimetypefromname path close io exception ioexception binary file file binary node repository auto creates parent hierarchies unstrucured nodes missing param classpath resource classpathresource classpath resource url binary file param path path mount binary data parent nodes created automatically param mime type mimetype mime type binary data resource binary data resource binary file binaryfile string classpath resource classpathresource string path string mime type mimetype input stream inputstream content loader contentloader get resource as stream getresourceasstream classpath resource classpathresource illegal argument exception illegalargumentexception classpath resource classpath resource classpathresource binary file binaryfile path mime type mimetype close io exception ioexception binary file file binary node repository auto creates parent hierarchies unstrucured nodes missing mime type auto detected resource param input stream inputstream input stream binary data param path path mount binary data parent nodes created automatically resource binary data resource binary file binaryfile input stream inputstream input stream inputstream string path binary file binaryfile input stream inputstream path detect mime type from name detectmimetypefromname path binary file file binary node repository auto creates parent hierarchies unstrucured nodes missing param input stream inputstream input stream binary data param path path mount binary data parent nodes created automatically param mime type mimetype mime type binary data resource binary data resource binary file binaryfile input stream inputstream input stream inputstream string path string mime type mimetype string parent path parentpath resource util resourceutil get parent getparent path string resource util resourceutil get name getname path resource parent resource parentresource resource resolver resourceresolver get resource getresource parent path parentpath parent resource parentresource parent resource parentresource create resource hierarchy createresourcehierarchy parent path parentpath binary file binaryfile input stream inputstream parent resource parentresource mime type mimetype binary file file binary node repository auto creates parent hierarchies unstrucured nodes missing mime type auto detected resource param input stream inputstream input stream binary data param parent resource parentresource parent resource param resource file resource binary data resource binary file binaryfile input stream inputstream input stream inputstream resource parent resource parentresource string binary file binaryfile input stream inputstream parent resource parentresource detect mime type from name detectmimetypefromname binary file file binary node repository auto creates parent hierarchies unstrucured nodes missing param input stream inputstream input stream binary data param parent resource parentresource parent resource param resource file param mime type mimetype mime type binary data resource binary data resource binary file binaryfile input stream inputstream input stream inputstream resource parent resource parentresource string string mime type mimetype resource file resource resolver resourceresolver create parent resource parentresource immutable map immutablemap string object builder jcr constants jcrconstants jcr primarytype jcr constants jcrconstants file build resource resolver resourceresolver create file jcr constants jcrconstants jcr content immutable map immutablemap string object builder jcr constants jcrconstants jcr primarytype jcr constants jcrconstants resource jcr constants jcrconstants jcr data input stream inputstream jcr constants jcrconstants jcr mimetype mime type mimetype build resource resolver resourceresolver commit file persistence exception persistenceexception runtime exception runtimeexception unable create resource parent resource parentresource get path getpath binary file resource binary node repository auto creates parent hierarchies unstrucured nodes missing mime type auto detected resource param classpath resource classpathresource classpath resource url binary file param path path mount binary data parent nodes created automatically resource binary data resource binary resource binaryresource string classpath resource classpathresource string path input stream inputstream content loader contentloader get resource as stream getresourceasstream classpath resource classpathresource illegal argument exception illegalargumentexception classpath resource classpath resource classpathresource binary resource binaryresource path detect mime type from name detectmimetypefromname path close io exception ioexception binary file resource binary node repository auto creates parent hierarchies unstrucured nodes missing param classpath resource classpathresource classpath resource url binary file param path path mount binary data parent nodes created automatically param mime type mimetype mime type binary data resource binary data resource binary resource binaryresource string classpath resource classpathresource string path string mime type mimetype input stream inputstream content loader contentloader get resource as stream getresourceasstream classpath resource classpathresource illegal argument exception illegalargumentexception classpath resource classpath resource classpathresource binary resource binaryresource path mime type mimetype close io exception ioexception binary file resource binary node repository auto creates parent hierarchies unstrucured nodes missing mime type auto detected resource param input stream inputstream input stream binary data param path path mount binary data parent nodes created automatically resource binary data resource binary resource binaryresource input stream inputstream input stream inputstream string path binary resource binaryresource input stream inputstream path detect mime type from name detectmimetypefromname path binary file resource binary node repository auto creates parent hierarchies unstrucured nodes missing param input stream inputstream input stream binary data param path path mount binary data parent nodes created automatically param mime type mimetype mime type binary data resource binary data resource binary resource binaryresource input stream inputstream input stream inputstream string path string mime type mimetype string parent path parentpath resource util resourceutil get parent getparent path string resource util resourceutil get name getname path resource parent resource parentresource resource resolver resourceresolver get resource getresource parent path parentpath parent resource parentresource parent resource parentresource create resource hierarchy createresourcehierarchy parent path parentpath binary resource binaryresource input stream inputstream parent resource parentresource mime type mimetype binary file resource binary node repository auto creates parent hierarchies unstrucured nodes missing mime type auto detected resource param input stream inputstream input stream binary data param parent resource parentresource parent resource param resource resource resource binary data resource binary resource binaryresource input stream inputstream input stream inputstream resource parent resource parentresource string binary resource binaryresource input stream inputstream parent resource parentresource detect mime type from name detectmimetypefromname binary file resource binary node repository auto creates parent hierarchies unstrucured nodes missing param input stream inputstream input stream binary data param parent resource parentresource parent resource param resource resource param mime type mimetype mime type binary data resource binary data resource binary resource binaryresource input stream inputstream input stream inputstream resource parent resource parentresource string string mime type mimetype resource resource resource resolver resourceresolver create parent resource parentresource immutable map immutablemap string object builder jcr constants jcrconstants jcr primarytype jcr constants jcrconstants resource jcr constants jcrconstants jcr data input stream inputstream jcr constants jcrconstants jcr mimetype mime type mimetype build resource resolver resourceresolver commit resource persistence exception persistenceexception runtime exception runtimeexception unable create resource parent resource parentresource get path getpath detected mime type file extension mime type service fallback application octet stream param node mime type string detect mime type from name detectmimetypefromname string string mime type mimetype string file extension fileextension string utils stringutils substring after last substringafterlast bundle context bundlecontext string utils stringutils is not empty isnotempty file extension fileextension service reference servicereference bundle context bundlecontext get service reference getservicereference mime type service mimetypeservice get name getname mime type service mimetypeservice mime type service mimetypeservice mime type service mimetypeservice bundle context bundlecontext get service getservice mime type mimetype mime type service mimetypeservice get mime type getmimetype file extension fileextension string utils stringutils default string defaultstring mime type mimetype content type contenttype octet stream