licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache sling bgservlets impl org junit assert equals assertequals org junit assert false assertfalse org junit assert not null assertnotnull org junit assert true asserttrue org junit fail java byte array output stream bytearrayoutputstream java io exception ioexception java output stream outputstream org apache sling bgservlets job status jobstatus org junit test suspendable output stream test suspendableoutputstreamtest string test abc def ghijklmnopqrstuvwxyz abcdefghijklmnopqrstuvwxyz writer thread writerthread thread output stream outputstream to write towrite test get bytes getbytes exception run exception runexception write delay writer thread writerthread output stream outputstream override write to write towrite thread sleep write delay exception run exception runexception test test no suspend testnosuspend io exception ioexception byte array output stream bytearrayoutputstream bos byte array output stream bytearrayoutputstream suspendable output stream suspendableoutputstream suspendable output stream suspendableoutputstream bos write test get bytes getbytes flush assert equals assertequals string fully written test bos to string tostring test test stop teststop io exception ioexception byte array output stream bytearrayoutputstream bos byte array output stream bytearrayoutputstream suspendable output stream suspendableoutputstream suspendable output stream suspendableoutputstream bos assert equals assertequals expecting job status jobstatus get state getstate request state change requeststatechange job status jobstatus running write test get bytes getbytes flush request state change requeststatechange job status jobstatus stopped assert equals assertequals expecting requested write job status jobstatus requested get state getstate write get bytes getbytes fail expected stream stopped exception streamstoppedexception writing stopped stream suspendable output stream suspendableoutputstream stream stopped exception streamstoppedexception as expected asexpected assert equals assertequals expecting stopped write job status jobstatus stopped get state getstate test test suspend testsuspend exception byte array output stream bytearrayoutputstream bos byte array output stream bytearrayoutputstream suspendable output stream suspendableoutputstream suspendable output stream suspendableoutputstream bos request state change requeststatechange job status jobstatus running writer thread writerthread writer thread writerthread set daemon setdaemon start delay writer thread writerthread write delay thread sleep delay assert true asserttrue expecting data written writer thread writerthread bos size request state change requeststatechange job status jobstatus suspended thread sleep delay assert equals assertequals expecting suspend writes job status jobstatus suspended get state getstate count bos size thread sleep delay assert equals assertequals expecting writes suspend count bos size request state change requeststatechange job status jobstatus running thread sleep delay assert equals assertequals expecting running job status jobstatus running get state getstate assert true asserttrue expecting data written res uming resuming bos size count close thread sleep delay assert false assertfalse expecting writer thread writerthread closing stream is alive isalive assert not null assertnotnull expecting exception writer thread writerthread run exception runexception assert true asserttrue expecting io exception ioexception writer thread writerthread run exception runexception io exception ioexception test test suspend then stop testsuspendthenstop exception byte array output stream bytearrayoutputstream bos byte array output stream bytearrayoutputstream suspendable output stream suspendableoutputstream suspendable output stream suspendableoutputstream bos assert equals assertequals expecting job status jobstatus get state getstate writer thread writerthread writer thread writerthread set daemon setdaemon start request state change requeststatechange job status jobstatus suspended delay writer thread writerthread write delay thread sleep delay assert equals assertequals expecting suspend writes job status jobstatus suspended get state getstate request state change requeststatechange job status jobstatus stopped assert equals assertequals expecting requested write job status jobstatus requested get state getstate write get bytes getbytes fail expected stream stopped exception streamstoppedexception writing stopped stream suspendable output stream suspendableoutputstream stream stopped exception streamstoppedexception as expected asexpected assert equals assertequals expecting stopped write job status jobstatus stopped get state getstate close test test done testdone byte array output stream bytearrayoutputstream bos byte array output stream bytearrayoutputstream suspendable output stream suspendableoutputstream suspendable output stream suspendableoutputstream bos request state change requeststatechange job status jobstatus assert equals assertequals expecting job status jobstatus get state getstate request state change requeststatechange job status jobstatus suspended assert equals assertequals expecting job status jobstatus get state getstate request state change requeststatechange job status jobstatus stopped assert equals assertequals expecting job status jobstatus get state getstate test test creation to running state testcreationtorunningstate byte array output stream bytearrayoutputstream bos byte array output stream bytearrayoutputstream suspendable output stream suspendableoutputstream suspendable output stream suspendableoutputstream bos assert equals assertequals expecting init ially initially job status jobstatus get state getstate request state change requeststatechange job status jobstatus queued assert equals assertequals expecting queued requests job status jobstatus queued get state getstate request state change requeststatechange job status jobstatus running assert equals assertequals expecting running requested job status jobstatus running get state getstate