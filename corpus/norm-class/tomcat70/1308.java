licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina deploy java file java file input stream fileinputstream java file not found exception filenotfoundexception java file output stream fileoutputstream java io exception ioexception java util map java util concurrent concurrent hash map concurrenthashmap java util concurrent atomic atomic long atomiclong org apache juli logging log org apache juli logging log factory logfactory org apache tomcat util buf hex utils hexutils org apache tomcat util res string manager stringmanager factory read files write files split ting splitting smaller messages entire files don read memory factory reader writer time reading writing factory close input output str eams streams mark factory closed force cleanup call cleanup calling object thread safe author filip hanik version file message factory filemessagefactory variables log log log factory logfactory get log getlog file message factory filemessagefactory string manager stringmanager string manager stringmanager get manager getmanager constants number bytes read file read size file reading writing file file writing factory reading factory open for write openforwrite factory reused closed open for write openforwrite input stream held variable file input stream fileinputstream open for write openforwrite output stream held variable file output stream fileoutputstream number messages written nr of messages processed nrofmessagesprocessed total size file size total number pack ets packets split file total nr of messages totalnrofmessages number message processed message id s ids based atomic long atomiclong last message processed lastmessageprocessed atomic long atomiclong messages received order held buffer required worked expected messages spend time buffer map file message filemessage msg buffer msgbuffer concurrent hash map concurrenthashmap file message filemessage bytes hold data thread safe data read size flag thread writing messages disk access flag synch ronised synchronised is writing iswriting time instance created milliseconds creation time creationtime maximum valid time seconds creation time creationtime max valid time maxvalidtime constructor ins tantiates instantiates factory read write open for write openforwrite file created output stream opened write open for write openforwrite input stream opened file exist param file file read written param open for write openforwrite writing file reading file file not found exception filenotfoundexception file read doesn exist io exception ioexception system fails open input output str eams streams file fails create file written file message factory filemessagefactory file open for write openforwrite file not found exception filenotfoundexception io exception ioexception file open for write openforwrite open for write openforwrite log is debug enabled isdebugenabled log debug open file write open for write openforwrite open for write openforwrite file exists file create new file createnewfile io exception ioexception get string getstring file new fail filenewfail file file output stream fileoutputstream size file length total nr of messages totalnrofmessages size read size file input stream fileinputstream creation time creationtime system current time millis currenttimemillis creates factory read write file opening read read message readmessage invoked opening write write message writemessage invoked param file file read written param open for write openforwrite writing file reading file not found exception filenotfoundexception file read doesn exist io exception ioexception fails create file written file message factory filemessagefactory file message factory filemessagefactory get instance getinstance file open for write openforwrite file not found exception filenotfoundexception io exception ioexception file message factory filemessagefactory open for write openforwrite reads file data file message sets size total length totallength total nr of msgs totalnrofmsgs message number eof reached factory returns closes message returned passed memory remember file message factory thread safe don t dont hand message thread read param file message filemessage message pop ulated populated file data illegal argument exception illegalargumentexception factory writing closed io exception ioexception file read exception occurs file message filemessage returns message passed parameter eof file message filemessage read message readmessage file message filemessage illegal argument exception illegalargumentexception io exception ioexception check state checkstate length read data length cleanup set data setdata data length set total length settotallength size set total nr of msgs settotalnrofmsgs total nr of messages totalnrofmessages set message number setmessagenumber nr of messages processed nrofmessagesprocessed writes message file msg get message number getmessagenumber msg get total nr of msgs gettotalnrofmsgs output stream closed writing param msg file message filemessage message data written illegal argument exception illegalargumentexception factory opened read closed io exception ioexception file write error occurs returns file complete outputs tream outputstream closed write message writemessage file message filemessage msg illegal argument exception illegalargumentexception io exception ioexception open for write openforwrite illegal argument exception illegalargumentexception write message factory reading log is debug enabled isdebugenabled log debug message msg data hex utils hexutils to hex string tohexstring msg get data getdata data length msg get data length getdatalength msg get message number getmessagenumber last message processed lastmessageprocessed duplicate message processed log warn receive message sender act timeout acttimeout msg get context name getcontextname war msg get file name getfilename data hex utils hexutils to hex string tohexstring msg get data getdata data length msg get data length getdatalength file message filemessage previous msg buffer msgbuffer value of valueof msg get message number getmessagenumber msg previous duplicate message processed log warn receive message sender act timeout acttimeout msg get context name getcontextname war msg get file name getfilename data hex utils hexutils to hex string tohexstring msg get data getdata data length msg get data length getdatalength file message filemessage is writing iswriting msg buffer msgbuffer value of valueof last message processed lastmessageprocessed is writing iswriting write get data getdata get data length getdatalength last message processed lastmessageprocessed increment and get incrementandget flush get message number getmessagenumber get total nr of msgs gettotalnrofmsgs close cleanup msg buffer msgbuffer value of valueof last message processed lastmessageprocessed is writing iswriting write message writemessage closes factory str eams streams sets references cleanup close exception ignore close exception ignore size closed data nr of messages processed nrofmessagesprocessed total nr of messages totalnrofmessages msg buffer msgbuffer clear last message processed lastmessageprocessed check factory perform function asked invoked read message readmessage write message writemessage methods proceed param open for write openforwrite illegal argument exception illegalargumentexception check state checkstate open for write openforwrite illegal argument exception illegalargumentexception open for write openforwrite open for write openforwrite cleanup open for write openforwrite illegal argument exception illegalargumentexception write message factory reading illegal argument exception illegalargumentexception read message factory writing closed cleanup illegal argument exception illegalargumentexception factory closed usage param args string args read filename args write filename exception main string args exception system println usage file message factory filemessagefactory file to be read filetoberead file to be written filetobewritten system println usage copy file local file system file message factory filemessagefactory read get instance getinstance file args file message factory filemessagefactory write get instance getinstance file args file message filemessage msg file message filemessage args args msg read read message readmessage msg msg system println empty input file args system println expecting write msg get total nr of msgs gettotalnrofmsgs messages cnt msg write write message writemessage msg cnt msg read read message readmessage msg system println wrote cnt messages main file get file getfile file is valid isvalid max valid time maxvalidtime time now timenow system current time millis currenttimemillis time idle timeidle time now timenow creation time creationtime time idle timeidle max valid time maxvalidtime cleanup file exists file delete get max valid time getmaxvalidtime max valid time maxvalidtime set max valid time setmaxvalidtime max valid time maxvalidtime max valid time maxvalidtime max valid time maxvalidtime