licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina websocket java io exception ioexception java security message digest messagedigest java security no such algorithm exception nosuchalgorithmexception java util array list arraylist java util collections java util enumeration java util list java util queue java util concurrent concurrent linked queue concurrentlinkedqueue javax servlet servlet exception servletexception javax servlet servlet request servletrequest javax servlet servlet request wrapper servletrequestwrapper javax servlet http http servlet httpservlet javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse org apache catalina connector request facade requestfacade org apache catalina util base org apache tomcat util buf c converter cconverter org apache tomcat util res string manager stringmanager base implementation servlet processing web socket websocket connections rfc expected applications extend implementation provide application specific functionality deprecated replaced jsr web socket websocket implementation removed tomcat deprecated web socket servlet websocketservlet http servlet httpservlet serialversionuid accept eafa get bytes getbytes c converter cconverter iso string manager stringmanager string manager stringmanager get manager getmanager constants queue message digest messagedigest sha help ers helpers concurrent linked queue concurrentlinkedqueue message digest messagedigest override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception required send server handshake message string key string sub protocol subprotocol list string extensions collections empty list emptylist header contains token headercontainstoken req upgrade websocket resp send error senderror http servlet response httpservletresponse bad request header contains token headercontainstoken req connection upgrade resp send error senderror http servlet response httpservletresponse bad request header contains token headercontainstoken req websocket version resp set status setstatus resp set header setheader web socket websocket version key req get header getheader web socket websocket key key resp send error senderror http servlet response httpservletresponse bad request string origin req get header getheader origin verify origin verifyorigin origin resp send error senderror http servlet response httpservletresponse forbidden list string sub protocols subprotocols get tokens from header gettokensfromheader req web socket websocket protocol sub protocols subprotocols is empty isempty sub protocol subprotocol select sub protocol selectsubprotocol sub protocols subprotocols todo read client handshake web socket websocket extensions todo extensions require ability api tbd passed tomcat int ernals internals process extension data frame frag mented fragmented good accept connection resp set header setheader upgrade websocket resp set header setheader connection upgrade resp set header setheader web socket websocket accept get web socket accept getwebsocketaccept key sub protocol subprotocol resp set header setheader web socket websocket protocol sub protocol subprotocol extensions is empty isempty todo ws http servlet request wrapper wshttpservletrequestwrapper wrapper ws http servlet request wrapper wshttpservletrequestwrapper req stream inbound streaminbound inbound create web socket inbound createwebsocketinbound sub protocol subprotocol wrapper wrapper invalid ate invalidate small hack servlet api servlet request servletrequest req unwrap request servlet request wrapper servletrequestwrapper servlet request wrapper servletrequestwrapper get request getrequest request facade requestfacade request facade requestfacade do upgrade doupgrade inbound resp send error senderror http servlet response httpservletresponse internal server error get string getstring servlet req upgrade fail requpgradefail works tokens quoted strings sophisticated parsing header contains token headercontainstoken http servlet request httpservletrequest req string header name headername string target enumeration string headers req get headers getheaders header name headername headers has more elements hasmoreelements string header headers next element nextelement string tokens header split string token tokens target equals ignore case equalsignorecase token trim works tokens quoted strings sophisticated parsing list string get tokens from header gettokensfromheader http servlet request httpservletrequest req string header name headername list string result array list arraylist string enumeration string headers req get headers getheaders header name headername headers has more elements hasmoreelements string header headers next element nextelement string tokens header split string token tokens result add token trim result string get web socket accept getwebsocketaccept string key servlet exception servletexception message digest messagedigest sha helper sha help ers helpers poll sha helper sha helper message digest messagedigest get instance getinstance sha no such algorithm exception nosuchalgorithmexception servlet exception servletexception sha helper reset sha helper update key get bytes getbytes c converter cconverter iso string result base encode sha helper digest accept sha help ers helpers add sha helper result int ended intended overridden classes verify origin web socket websocket request processing param origin origin header request code code code code accept request code code reject implementation returns code code verify origin verifyorigin string origin int ended intended overridden classes select protocol client list supported protocols param sub protocols subprotocols list protocols supported client client preference order server obligation resp ect respect declared preference code code protocol selected protocol protocols listed client implementation returns code code string select sub protocol selectsubprotocol list string sub protocols subprotocols create instance process inbound connection app lications applications provide instance connection param sub protocol subprotocol protocol agreed client server code code agreed param request http request init iated initiated web socket websocket connection note object valid method retain reference execution method tomcat detects access illegal state exception illegalstateexception stream inbound streaminbound create web socket inbound createwebsocketinbound string sub protocol subprotocol http servlet request httpservletrequest request