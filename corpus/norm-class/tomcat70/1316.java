licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina websocket java buffered input stream bufferedinputstream java io exception ioexception java input stream inputstream java output stream outputstream java output stream writer outputstreamwriter java writer java net inet socket address inetsocketaddress java net socket java net socket address socketaddress java nio byte buffer bytebuffer java nio char buffer charbuffer java security message digest messagedigest java util array list arraylist java util list javax naming initial context initialcontext javax naming naming exception namingexception javax servlet http http servlet request httpservletrequest org junit assert equals assertequals org junit assert false assertfalse org junit assert true asserttrue org junit test org apache catalina context org apache catalina deploy application listener applicationlistener org apache catalina deploy context environment contextenvironment org apache catalina servlets default servlet defaultservlet org apache catalina startup tomcat org apache catalina startup tomcat base test tomcatbasetest org apache catalina util base org apache tomcat util buf c converter cconverter org apache tomcat util buf byte chunk bytechunk org apache tomcat util buf b converter bconverter org apache tomcat util buf char chunk charchunk org apache tomcat websocket tester echo server testerechoserver deprecated removed tomcat deprecated test web socket testwebsocket tomcat base test tomcatbasetest string crlf accept eafa get bytes getbytes c converter cconverter iso test test simple testsimple exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx add application listener addapplicationlistener application listener applicationlistener tester echo server testerechoserver config get name getname tomcat add servlet addservlet ctx default servlet defaultservlet ctx add servlet mapping addservletmapping tomcat start web socket client websocketclient client web socket client websocketclient get port getport send web socket websocket handshake client writer write tester echo server testerechoserver config path basic http crlf client writer write host foo crlf client writer write upgrade websocket crlf client writer write connection alive upgrade crlf client writer write web socket websocket version crlf client writer write web socket websocket key todo crlf client writer write crlf client writer flush upgrade response string response line responseline client reader read line readline assert true asserttrue response line responseline starts with startswith http swallow headers string response header line responseheaderline client reader read line readline response header line responseheaderline equals response header line responseheaderline client reader read line readline web socket websocket client send message sendmessage foo client send message sendmessage foo assert equals assertequals foo foo foofoo client read message readmessage finished socket client close test test detect wrong version testdetectwrongversion exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx add application listener addapplicationlistener application listener applicationlistener tester echo server testerechoserver config get name getname tomcat add servlet addservlet ctx default servlet defaultservlet ctx add servlet mapping addservletmapping tomcat start web socket client websocketclient client web socket client websocketclient get port getport send web socket websocket handshake client writer write tester echo server testerechoserver config path basic http crlf client writer write host foo crlf client writer write upgrade websocket crlf client writer write connection upgrade crlf client writer write web socket websocket version crlf client writer write web socket websocket key todo crlf client writer write crlf client writer flush upgrade response string response line responseline client reader read line readline assert true asserttrue response line responseline starts with startswith http list string header lines headerlines array list arraylist string string response header line responseheaderline client reader read line readline response header line responseheaderline equals header lines headerlines add response header line responseheaderline response header line responseheaderline client reader read line readline assert true asserttrue header lines headerlines web socket websocket version finished socket client close test test no connection testnoconnection exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx add application listener addapplicationlistener application listener applicationlistener tester echo server testerechoserver config get name getname tomcat add servlet addservlet ctx default servlet defaultservlet ctx add servlet mapping addservletmapping tomcat start web socket client websocketclient client web socket client websocketclient get port getport send web socket websocket handshake client writer write tester echo server testerechoserver config path basic http crlf client writer write host foo crlf client writer write upgrade websocket crlf client writer write web socket websocket version crlf client writer write web socket websocket key todo crlf client writer write crlf client writer flush error response string response line responseline client reader read line readline assert true asserttrue response line responseline starts with startswith http finished socket client close test test no upgrade testnoupgrade exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx add application listener addapplicationlistener application listener applicationlistener tester echo server testerechoserver config get name getname tomcat add servlet addservlet ctx default servlet defaultservlet ctx add servlet mapping addservletmapping tomcat start web socket client websocketclient client web socket client websocketclient get port getport send web socket websocket handshake client writer write tester echo server testerechoserver config path basic http crlf client writer write host foo crlf client writer write connection upgrade crlf client writer write web socket websocket version crlf client writer write web socket websocket key todo crlf client writer write crlf client writer flush error response upgrade treated upgrade request generated request reaches servlet string response line responseline client reader read line readline assert true asserttrue response line responseline starts with startswith http finished socket client close test test key testkey exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx add application listener addapplicationlistener application listener applicationlistener tester echo server testerechoserver config get name getname tomcat add servlet addservlet ctx default servlet defaultservlet ctx add servlet mapping addservletmapping tomcat start web socket client websocketclient client web socket client websocketclient get port getport send web socket websocket handshake client writer write tester echo server testerechoserver config path basic http crlf client writer write host foo crlf client writer write upgrade websocket crlf client writer write connection upgrade crlf client writer write web socket websocket version crlf client writer write web socket websocket key todo crlf client writer write crlf client writer flush upgrade response string response line responseline client reader read line readline assert true asserttrue response line responseline starts with startswith http string accept string response header line responseheaderline client reader read line readline response header line responseheaderline equals response header line responseheaderline starts with startswith web socket websocket accept accept response header line responseheaderline substring response header line responseheaderline index of indexof response header line responseheaderline client reader read line readline assert true asserttrue accept message digest messagedigest sha helper message digest messagedigest get instance getinstance sha sha helper reset sha helper update todo get bytes getbytes c converter cconverter iso string source base encode sha helper digest accept assert equals assertequals source accept sha helper reset sha helper update tod get bytes getbytes c converter cconverter iso source base encode sha helper digest accept assert false assertfalse source equals accept finished socket client close test test bug testbug exception tomcat tomcat get tomcat instance gettomcatinstance tomcat enable naming enablenaming file system doc base docbase required context ctx tomcat add context addcontext tomcat add servlet addservlet ctx bug bug servlet ctx add servlet mapping addservletmapping bug create resource context environment contextenvironment env context environment contextenvironment env set name setname bug ws inbound wsinbound jndi env set type settype string get name getname env set value setvalue bug ws inbound wsinbound test message ctx get naming resources getnamingresources add environment addenvironment env tomcat start web socket client websocketclient client web socket client websocketclient get port getport send web socket websocket handshake client writer write http crlf client writer write host foo crlf client writer write upgrade websocket crlf client writer write connection upgrade crlf client writer write web socket websocket version crlf client writer write web socket websocket key todo crlf client writer write crlf client writer flush upgrade response string response line responseline client reader read line readline assert true asserttrue response line responseline starts with startswith http swallow headers string response header line responseheaderline client reader read line readline response header line responseheaderline equals response header line responseheaderline client reader read line readline web socket websocket string msg client read message readmessage assert equals assertequals bug ws inbound wsinbound test message msg finished socket client close bug servlet web socket servlet websocketservlet serialversionuid override stream inbound streaminbound create web socket inbound createwebsocketinbound string sub protocol subprotocol http servlet request httpservletrequest request bug ws inbound wsinbound bug ws inbound wsinbound message inbound messageinbound string test message test message string jndi bug message override on open onopen ws outbound wsoutbound out bound outbound string msg error javax naming context init ctx initctx initial context initialcontext msg string init ctx initctx lookup java comp env jndi naming exception namingexception print stack trace printstacktrace char buffer charbuffer char buffer charbuffer wrap msg out bound outbound write text message writetextmessage io exception ioexception override on binary message onbinarymessage byte buffer bytebuffer message io exception ioexception ignore override on text message ontextmessage char buffer charbuffer message io exception ioexception ignore web socket client websocketclient output stream outputstream is continuation iscontinuation string encoding iso socket socket writer writer custom reader customreader reader web socket client websocketclient port socket address socketaddress add r addr inet socket address inetsocketaddress localhost port socket socket socket set so timeout setsotimeout socket connect add r addr socket get output stream getoutputstream writer output stream writer outputstreamwriter encoding reader custom reader customreader socket get input stream getinputstream encoding exception runtime exception runtimeexception close io exception ioexception socket close send message sendmessage string message final fragment finalfragment io exception ioexception byte chunk bytechunk byte chunk bytechunk char chunk charchunk char chunk charchunk b converter bconverter b converter bconverter utf append message convert len get length getlength assert true asserttrue len is continuation iscontinuation constants opc ode opcode continuation constants opc ode opcode text final fragment finalfragment write write len mask write write write write payload write get bytes getbytes get start getstart len flush frame continuation frame is continuation iscontinuation final fragment finalfragment string read message readmessage io exception ioexception skip reader read payload length len reader read assert true asserttrue len read payload reader set encoding setencoding utf reader read len real reader thi n thin wrapper input stream encoding reading reading headers iso body utf thread safe performing custom reader customreader input stream inputstream mark supported marksupported c converter cconverter custom reader customreader input stream inputstream string encoding io exception ioexception buffered input stream bufferedinputstream mark supported marksupported mark supported marksupported c converter cconverter encoding set encoding setencoding string encoding io exception ioexception c converter cconverter encoding read io exception ioexception read string read len io exception ioexception byte chunk bytechunk byte chunk bytechunk char chunk charchunk char chunk charchunk read read len read read read get bytes getbytes read len read set end setend len convert to string tostring string read line readline io exception ioexception byte chunk bytechunk byte chunk bytechunk char chunk charchunk char chunk charchunk read read append read mark supported marksupported mark read mark supported marksupported reset read set end setend read convert to string tostring