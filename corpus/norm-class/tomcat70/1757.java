licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina filters java io exception ioexception java nio charset charset java util hash map hashmap java util list java util map javax servlet servlet exception servletexception javax servlet http http servlet httpservlet javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse org junit assert equals assertequals org junit test org apache catalina context org apache catalina deploy filter def filterdef org apache catalina deploy filter map filtermap org apache catalina startup tomcat org apache catalina startup tomcat base test tomcatbasetest org apache tomcat util buf byte chunk bytechunk test add char set filter testaddcharsetfilter tomcat base test tomcatbasetest test test non e specified mode testnonespecifiedmode exception do test dotest iso test test non e specified mode testnonespecifiedmode exception do test dotest iso test test non e specified mode testnonespecifiedmode exception do test dotest iso test test default testdefault exception do test dotest iso test test default mixed case testdefaultmixedcase exception do test dotest iso test test system testsystem exception do test dotest system charset default charset defaultcharset test test system mixed case testsystemmixedcase exception do test dotest sy st em system charset default charset defaultcharset test testutf exception do test dotest utf utf do test dotest string encoding string expected exception do test dotest encoding expected do test dotest string encoding string expected mode exception setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext add servlet charset servlet charsetservlet servlet charset servlet charsetservlet mode tomcat add servlet addservlet ctx servlet servlet ctx add servlet mapping addservletmapping servlet add filter filter def filterdef filter def filterdef filter def filterdef filter def filterdef set filter class setfilterclass add default charset filter adddefaultcharsetfilter get name getname filter def filterdef set filter name setfiltername filter encoding filter def filterdef add init parameter addinitparameter encoding encoding ctx add filter def addfilterdef filter def filterdef filter map filtermap filter map filtermap filter map filtermap filter map filtermap set filter name setfiltername filter filter map filtermap add servlet name addservletname servlet ctx add filter map addfiltermap filter map filtermap tomcat start map string list string headers hash map hashmap string list string get url geturl http localhost get port getport byte chunk bytechunk headers list string ct headers ctheaders headers content type assert equals assertequals ct headers ctheaders size string ct headers ctheaders assert equals assertequals text plain charset expected charset servlet charsetservlet http servlet httpservlet serialversionuid string output mode charset servlet charsetservlet mode mode mode override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception mode resp set content type setcontenttype text plain resp set content type setcontenttype text plain charset iso resp set content type setcontenttype text plain resp set character encoding setcharacterencoding iso resp set content type setcontenttype text plain charset iso resp get writer getwriter print output