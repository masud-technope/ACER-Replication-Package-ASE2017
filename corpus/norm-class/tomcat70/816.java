licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache coyote http filters java byte array input stream bytearrayinputstream java byte array output stream bytearrayoutputstream java file java file input stream fileinputstream java io exception ioexception java output stream outputstream java util array list arraylist java util arrays java util list java util zip gzip input stream gzipinputstream org junit assert array equals assertarrayequals org junit assert equals assertequals org junit test org apache catalina util io tools iotools rep roduces reproduces current appears jvm bug note test standard test suite execute code ant test code testflushablegzipoutputstream test test bug testbug exception byte array output stream bytearrayoutputstream byte out stream byteoutstream byte array output stream bytearrayoutputstream output stream outputstream output flushablegzipoutputstream byte out stream byteoutstream file sources dir sourcesdir file test org apache coyote http filters list parts array list arraylist load file loadfile file sources dir sourcesdir bug parts add flow bytes flowbytes output output flush load file loadfile file sources dir sourcesdir bug parts add flow bytes flowbytes output output flush data get bytes getbytes ascii parts add output write output flush output close byte array input stream bytearrayinputstream byte in stream byteinstream byte array input stream bytearrayinputstream byte out stream byteoutstream to byte array tobytearray gzip input stream gzipinputstream inflater stream inflaterstream gzip input stream gzipinputstream byte in stream byteinstream byte array output stream bytearrayoutputstream sink byte array output stream bytearrayoutputstream io tools iotools flow inflater stream inflaterstream sink sink close decompressed bytes decompressedbytes sink to byte array tobytearray original length originallength bytes parts assert array equals assertarrayequals bytes arrays copy of range copyofrange decompressed bytes decompressedbytes original length originallength original length originallength bytes length original length originallength bytes length assert equals assertequals original length originallength decompressed bytes decompressedbytes length test code write test test write char testwritechar exception string phrase apache tomcat data phrase get bytes getbytes utf byte array output stream bytearrayoutputstream byte out stream byteoutstream byte array output stream bytearrayoutputstream output stream outputstream output flushablegzipoutputstream byte out stream byteoutstream output write data data length output write data output flush data length output write data output write data output close byte array input stream bytearrayinputstream byte in stream byteinstream byte array input stream bytearrayinputstream byte out stream byteoutstream to byte array tobytearray gzip input stream gzipinputstream inflater stream inflaterstream gzip input stream gzipinputstream byte in stream byteinstream byte array output stream bytearrayoutputstream sink byte array output stream bytearrayoutputstream io tools iotools flow inflater stream inflaterstream sink sink close decompressed bytes decompressedbytes sink to byte array tobytearray assert equals assertequals data length decompressed bytes decompressedbytes length assert array equals assertarrayequals data arrays copy of range copyofrange decompressed bytes decompressedbytes data length data length loads file memory load file loadfile file file io exception ioexception byte array output stream bytearrayoutputstream byte out stream byteoutstream byte array output stream bytearrayoutputstream file input stream fileinputstream input file input stream fileinputstream file io tools iotools flow input byte out stream byteoutstream input close byte out stream byteoutstream to byte array tobytearray writes data stream returns size file flow bytes flowbytes bytes output stream outputstream output io exception ioexception output write io tools iotools writes small port ions portions natural byte array input stream bytearrayinputstream byte in stream byteinstream byte array input stream bytearrayinputstream bytes io tools iotools flow byte in stream byteinstream output byte in stream byteinstream close