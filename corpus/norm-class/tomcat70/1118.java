licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat websocket java i o exception ioexception java net uri java nio byte buffer bytebuffer java nio channels write pending exception writependingexception java nio charset standard chars ets standardcharsets java security principal java util collections java util hash set hashset java util list java util map java util java util concurrent concurrent hash map concurrenthashmap java util concurrent atomic atomic long atomiclong javax websocket close reason closereason javax websocket close reason closereason close code closecode javax websocket close reason closereason close codes closecodes javax websocket deployment exception deploymentexception javax websocket endpoint javax websocket endpoint config endpointconfig javax websocket extension javax websocket message handler messagehandler javax websocket message handler messagehandler partial javax websocket message handler messagehandler javax websocket pong message pongmessage javax websocket remote endpoint remoteendpoint javax websocket send result sendresult javax websocket session javax websocket web socket container websocketcontainer org apache juli logging log org apache juli logging log factory logfactory org apache tomcat instance manager instancemanager org apache tomcat util exception utils exceptionutils org apache tomcat util res string manager stringmanager ws session wssession session ellipsis single character per iods periods row continuation ellipsis bytes get bytes getbytes standard chars ets standardcharsets utf ellipsis bytes utf ellipsis bytes len ellipsis bytes length string manager stringmanager string manager stringmanager get manager getmanager constants atomic long atomiclong ids atomic long atomiclong log log log factory logfactory get log getlog ws session wssession endpoint local endpoint localendpoint ws remote endpoint impl base wsremoteendpointimplbase ws remote endpoint wsremoteendpoint remote endpoint remoteendpoint async remote endpoint async remoteendpointasync remote endpoint remoteendpoint basic remote endpoint basic remoteendpointbasic class loader classloader application class loader applicationclassloader ws web socket container wswebsocketcontainer web socket container websocketcontainer uri request uri requesturi map string list string request parameter map requestparametermap string query string querystring principal user principal userprincipal endpoint config endpointconfig endpoint config endpointconfig list extension negotiated extensions negotiatedextensions string sub protocol subprotocol map string string path parameters pathparameters secure string http session id httpsessionid string expected handle message types string message handler messagehandler text message handler textmessagehandler expected handle message types byte buffer bytebuffer message handler messagehandler binary message handler binarymessagehandler message handler messagehandler pong message pongmessage pong message handler pongmessagehandler open object state lock statelock object map string object user properties userproperties concurrent hash map concurrenthashmap string object max binary message buffer size maxbinarymessagebuffersize constants buffer size max text message buffer size maxtextmessagebuffersize constants buffer size max idle timeout maxidletimeout last active lastactive system current time millis currenttimemillis map future to send handler futuretosendhandler future to send handler futuretosendhandler futures concurrent hash map concurrenthashmap future to send handler futuretosendhandler future to send handler futuretosendhandler creates web socket websocket session communication points result link thread get context class loader getcontextclassloader time constructor called calling link endpoint on close onclose session close reason closereason param local endpoint localendpoint param ws remote endpoint wsremoteendpoint param negotiated extensions negotiatedextensions deployment exception deploymentexception ws session wssession endpoint local endpoint localendpoint ws remote endpoint impl base wsremoteendpointimplbase ws remote endpoint wsremoteendpoint ws web socket container wswebsocketcontainer ws web socket container wswebsocketcontainer uri request uri requesturi map string list string request parameter map requestparametermap string query string querystring principal user principal userprincipal string http session id httpsessionid list extension negotiated extensions negotiatedextensions string sub protocol subprotocol map string string path parameters pathparameters secure endpoint config endpointconfig endpoint config endpointconfig deployment exception deploymentexception local endpoint localendpoint local endpoint localendpoint ws remote endpoint wsremoteendpoint ws remote endpoint wsremoteendpoint ws remote endpoint wsremoteendpoint set session setsession remote endpoint async remoteendpointasync ws remote endpoint async wsremoteendpointasync ws remote endpoint wsremoteendpoint remote endpoint basic remoteendpointbasic ws remote endpoint basic wsremoteendpointbasic ws remote endpoint wsremoteendpoint web socket container websocketcontainer ws web socket container wswebsocketcontainer application class loader applicationclassloader thread current thread currentthread get context class loader getcontextclassloader ws remote endpoint wsremoteendpoint set send timeout setsendtimeout ws web socket container wswebsocketcontainer get default async send timeout getdefaultasyncsendtimeout max binary message buffer size maxbinarymessagebuffersize web socket container websocketcontainer get default max binary message buffer size getdefaultmaxbinarymessagebuffersize max text message buffer size maxtextmessagebuffersize web socket container websocketcontainer get default max text message buffer size getdefaultmaxtextmessagebuffersize max idle timeout maxidletimeout web socket container websocketcontainer get default max session idle timeout getdefaultmaxsessionidletimeout request uri requesturi request uri requesturi request parameter map requestparametermap request parameter map requestparametermap collections empty map emptymap request parameter map requestparametermap request parameter map requestparametermap query string querystring query string querystring user principal userprincipal user principal userprincipal http session id httpsessionid http session id httpsessionid negotiated extensions negotiatedextensions negotiated extensions negotiatedextensions sub protocol subprotocol sub protocol subprotocol sub protocol subprotocol sub protocol subprotocol path parameters pathparameters path parameters pathparameters secure secure ws remote endpoint wsremoteendpoint set encode rs setencoders endpoint config endpointconfig endpoint config endpointconfig endpoint config endpointconfig user properties userproperties put all putall endpoint config endpointconfig get user properties getuserproperties to hex string tohexstring ids get and increment getandincrement instance manager instancemanager instance manager instancemanager web socket container websocketcontainer get instance manager getinstancemanager instance manager instancemanager instance manager instancemanager new instance newinstance local endpoint localendpoint exception deployment exception deploymentexception get string getstring ws session wssession instance new instancenew log is debug enabled isdebugenabled log debug get string getstring ws session wssession created override web socket container websocketcontainer get container getcontainer check state checkstate web socket container websocketcontainer override add message handler addmessagehandler message handler messagehandler listener target util get message type getmessagetype listener do add message handler doaddmessagehandler target listener override add message handler addmessagehandler clazz partial handler illegal state exception illegalstateexception do add message handler doaddmessagehandler clazz handler override add message handler addmessagehandler clazz handler illegal state exception illegalstateexception do add message handler doaddmessagehandler clazz handler suppress warnings suppresswarnings unchecked do add message handler doaddmessagehandler target message handler messagehandler listener check state checkstate message handlers require decoders map text messages binary messages frame processing code expects binary message handlers accept byte buffer bytebuffer pojo message handler wrappers designed wrap arbitrary objects message handlers messagehandlers wrap message handlers messagehandlers easily message handler result messagehandlerresult mh results mhresults util get message handlers getmessagehandlers target listener endpoint config endpointconfig message handler result messagehandlerresult mh result mhresult mh results mhresults mh result mhresult get type gettype text text message handler textmessagehandler illegal state exception illegalstateexception get string getstring ws session wssession duplicate handler text duplicatehandlertext text message handler textmessagehandler mh result mhresult get handler gethandler binary binary message handler binarymessagehandler illegal state exception illegalstateexception get string getstring ws session wssession duplicate handler binary duplicatehandlerbinary binary message handler binarymessagehandler mh result mhresult get handler gethandler pong pong message handler pongmessagehandler illegal state exception illegalstateexception get string getstring ws session wssession duplicate handler pong duplicatehandlerpong message handler messagehandler handler mh result mhresult get handler gethandler handler message handler messagehandler pong message handler pongmessagehandler message handler messagehandler pong message pongmessage handler illegal state exception illegalstateexception get string getstring ws session wssession invalid handler type pong invalidhandlertypepong illegal argument exception illegalargumentexception get string getstring ws session wssession unknown handler type unknownhandlertype listener mh result mhresult get type gettype override message handler messagehandler get message handlers getmessagehandlers check state checkstate message handler messagehandler result hash set hashset message handler messagehandler binary message handler binarymessagehandler result add binary message handler binarymessagehandler text message handler textmessagehandler result add text message handler textmessagehandler pong message handler pongmessagehandler result add pong message handler pongmessagehandler result override remove message handler removemessagehandler message handler messagehandler listener check state checkstate listener message handler messagehandler wrapped listener wrapped message handler wrappedmessagehandler wrapped wrapped message handler wrappedmessagehandler listener get wrapped handler getwrappedhandler wrapped wrapped listener removed wrapped equals text message handler textmessagehandler listener equals text message handler textmessagehandler text message handler textmessagehandler removed wrapped equals binary message handler binarymessagehandler listener equals binary message handler binarymessagehandler binary message handler binarymessagehandler removed wrapped equals pong message handler pongmessagehandler listener equals pong message handler pongmessagehandler pong message handler pongmessagehandler removed removed problem illegal state exception illegalstateexception get string getstring ws session wssession remove handler failed removehandlerfailed listener override string get protocol version getprotocolversion check state checkstate constants version header override string get negotiated sub protocol getnegotiatedsubprotocol check state checkstate sub protocol subprotocol override list extension get negotiated extensions getnegotiatedextensions check state checkstate negotiated extensions negotiatedextensions override is secure issecure check state checkstate secure override is open isopen open override get max idle timeout getmaxidletimeout check state checkstate max idle timeout maxidletimeout override set max idle timeout setmaxidletimeout timeout check state checkstate max idle timeout maxidletimeout timeout override set max binary message buffer size setmaxbinarymessagebuffersize max check state checkstate max binary message buffer size maxbinarymessagebuffersize max override get max binary message buffer size getmaxbinarymessagebuffersize check state checkstate max binary message buffer size maxbinarymessagebuffersize override set max text message buffer size setmaxtextmessagebuffersize max check state checkstate max text message buffer size maxtextmessagebuffersize max override get max text message buffer size getmaxtextmessagebuffersize check state checkstate max text message buffer size maxtextmessagebuffersize override session get open sessions getopensessions check state checkstate web socket container websocketcontainer get open sessions getopensessions local endpoint localendpoint override remote endpoint remoteendpoint async get async remote getasyncremote check state checkstate remote endpoint async remoteendpointasync override remote endpoint remoteendpoint basic get basic remote getbasicremote check state checkstate remote endpoint basic remoteendpointbasic override close i o exception ioexception close close reason closereason close codes closecodes normal closure override close close reason closereason close reason closereason i o exception ioexception do close doclose close reason closereason close reason closereason web socket websocket internal close method spec requires local endpoint receives timeout do close doclose close reason closereason close reason message closereasonmessage close reason closereason close reason local closereasonlocal checked loc king locking open state lock statelock open log is debug enabled isdebugenabled log debug get string getstring ws session wssession do close doclose ws remote endpoint wsremoteendpoint set batching allowed setbatchingallowed i o exception ioexception log warn get string getstring ws session wssession flush fail on close flushfailonclose fire endpoint on error fireendpointonerror output closed send close message sendclosemessage close reason message closereasonmessage fire endpoint on close fireendpointonclose close reason local closereasonlocal i o exception ioexception ioe i o exception ioexception get string getstring ws session wssession message failed messagefailed send result sendresult send result sendresult ioe future to send handler futuretosendhandler futures key set keyset on result onresult called close message received happen called protocol error protocol handler protocolhandler force closing connection on close onclose close reason closereason close reason closereason state lock statelock closed ws remote endpoint wsremoteendpoint set batching allowed setbatchingallowed i o exception ioexception log warn get string getstring ws session wssession flush fail on close flushfailonclose fire endpoint on error fireendpointonerror open output closed send close message sendclosemessage close reason closereason fire endpoint on close fireendpointonclose close reason closereason closed close socket ws remote endpoint wsremoteendpoint close fire endpoint on close fireendpointonclose close reason closereason close reason closereason fire on close onclose event throwable throwable instance manager instancemanager instance manager instancemanager web socket container websocketcontainer get instance manager getinstancemanager thread thread current thread currentthread class loader classloader get context class loader getcontextclassloader set context class loader setcontextclassloader application class loader applicationclassloader local endpoint localendpoint on close onclose close reason closereason throwable exception utils exceptionutils handle throwable handlethrowable throwable instance manager instancemanager instance manager instancemanager destroy instance destroyinstance local endpoint localendpoint throwable exception utils exceptionutils handle throwable handlethrowable throwable throwable set context class loader setcontextclassloader throwable fire endpoint on error fireendpointonerror throwable fire endpoint on error fireendpointonerror throwable throwable fire on error onerror event thread thread current thread currentthread class loader classloader get context class loader getcontextclassloader set context class loader setcontextclassloader application class loader applicationclassloader local endpoint localendpoint on error onerror throwable set context class loader setcontextclassloader send close message sendclosemessage close reason closereason close reason closereason maximum size payload control message byte buffer bytebuffer msg byte buffer bytebuffer all ocate allocate close code closecode close code closecode close reason closereason get close code getclosecode closed abnormally wire close code closecode close codes closecodes closed abnormally protocol error msg put short putshort close codes closecodes protocol error get code getcode msg put short putshort close code closecode get code getcode string reason close reason closereason get reason phrase getreasonphrase reason reason length append close reason with truncation appendclosereasonwithtruncation msg reason msg flip ws remote endpoint wsremoteendpoint start message block startmessageblock constants opc ode opcode close msg i o exception ioexception ioe handle close exception handlecloseexception ioe close code closecode write pending exception writependingexception wpe handle close exception handlecloseexception wpe close code closecode web socket container websocketcontainer unregister session unregistersession local endpoint localendpoint handle close exception handlecloseexception exception close code closecode close code closecode deal exception log is debug enabled isdebugenabled log debug get string getstring ws session wssession send close fail sendclosefail ws remote endpoint wsremoteendpoint close error handling close code closecode close codes closecodes closed abnormally local endpoint localendpoint on error onerror unit tests access method append close reason with truncation appendclosereasonwithtruncation byte buffer bytebuffer msg string reason close code maximum bytes left reason phrase truncated care ensure bytes truncated middle multi utf character reason bytes reasonbytes reason get bytes getbytes standard chars ets standardcharsets utf reason bytes reasonbytes length truncate msg reason bytes reasonbytes truncate remaining ellipsis bytes len pos bytes next bytesnext reason substring pos pos get bytes getbytes standard chars ets standardcharsets utf remaining bytes next bytesnext length msg bytes next bytesnext remaining bytes next bytesnext length pos bytes next bytesnext reason substring pos pos get bytes getbytes standard chars ets standardcharsets utf msg ellipsis bytes session aware link future to send handler futuretosendhandler for cibly forcibly closed session closes link future to send handler futuretosendhandler completes register future registerfuture future to send handler futuretosendhandler fail state lock statelock open is close message isclosemessage web socket websocket session open close message futures is done isdone completed session closed register session closes completes construct exception sync block fail fail i o exception ioexception ioe i o exception ioexception get string getstring ws session wssession message failed messagefailed send result sendresult send result sendresult ioe on result onresult remove link future to send handler futuretosendhandler tracked instances unregister future unregisterfuture future to send handler futuretosendhandler futures remove override uri getrequesturi check state checkstate request uri requesturi override map string list string get request parameter map getrequestparametermap check state checkstate request parameter map requestparametermap override string get query string getquerystring check state checkstate query string querystring override principal get user principal getuserprincipal check state checkstate user principal userprincipal override map string string get path parameters getpathparameters check state checkstate path parameters pathparameters override string get id getid override map string object get user properties getuserproperties check state checkstate user properties userproperties endpoint get local getlocal local endpoint localendpoint string get http session id gethttpsessionid http session id httpsessionid message handler messagehandler get text message handler gettextmessagehandler text message handler textmessagehandler message handler messagehandler get binary message handler getbinarymessagehandler binary message handler binarymessagehandler message handler messagehandler pong message pongmessage get pong message handler getpongmessagehandler pong message handler pongmessagehandler update last active updatelastactive last active lastactive system current time millis currenttimemillis check expiration checkexpiration timeout max idle timeout maxidletimeout timeout system current time millis currenttimemillis last active lastactive timeout string msg get string getstring ws session wssession timeout do close doclose close reason closereason close codes closecodes msg close reason closereason close codes closecodes closed abnormally msg check state checkstate closed rfc web socket websocket connection considered closed peer received web socket websocket close frame illegal state exception illegalstateexception get string getstring ws session wssession closed enum open output closed closed