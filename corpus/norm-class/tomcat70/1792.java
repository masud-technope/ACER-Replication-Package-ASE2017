licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina filters java io exception ioexception java util array list arraylist java util hash map hashmap java util list java util map javax servlet servlet exception servletexception javax servlet http http servlet httpservlet javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse org junit assert equals assertequals org junit assert not null assertnotnull org junit assert null assertnull org junit assert true asserttrue org junit test org apache catalina context org apache catalina authenticator authenticator base authenticatorbase org apache catalina authenticator basic authenticator basicauthenticator org apache catalina deploy filter def filterdef org apache catalina deploy filter map filtermap org apache catalina deploy login config loginconfig org apache catalina deploy security collection securitycollection org apache catalina deploy security constraint securityconstraint org apache catalina startup tomcat org apache catalina startup tomcat base test tomcatbasetest org apache tomcat util buf c converter cconverter org apache tomcat util buf byte chunk bytechunk org apache tomcat util code c codec binary base test rest csrf prevention filter testrestcsrfpreventionfilter tomcat base test tomcatbasetest cookies cookies cookies string method string method post post string http prefix http localhost string context path login string uri services string uri csrf services custom ers customers string list customers services custom ers customers string remove customer services custom ers customers remove customer removecustomer string add customer services custom ers customers add customer addcustomer string remove customers services custom ers customers remove all custom ers removeallcustomers string filter init param paths acc epting params pathsacceptingparams string servlet tester servlet testerservlet string filter csrf string customers list response custom ers customers list string customer removed response customer removed string customer response customer string invalid non ce nonce invalid nonce string invalid non ce nonce string user user string pwd pwd string role role string method basic basic credentials basiccredentials credentials basic credentials basiccredentials method user pwd string client header authorization string server cookie header cookie string client cookie header cookie session timeout mins tomcat tomcat context context list string cookies array list arraylist string string valid non ce validnonce override set up setup exception set up setup tomcat get tomcat instance gettomcatinstance tomcat add user adduser user pwd tomcat add role addrole user role set up application setupapplication tomcat start test test rest csrf protection with header testrestcsrfprotectionwithheader exception test clear get testclearget test clear post testclearpost test get first fetch testgetfirstfetch test valid post testvalidpost test invalid post testinvalidpost test get second fetch testgetsecondfetch test test rest csrf protection with request params testrestcsrfprotectionwithrequestparams exception test get first fetch testgetfirstfetch test valid post with request params testvalidpostwithrequestparams test invalid post with request params testinvalidpostwithrequestparams test clear get testclearget exception do test dotest method list customers credentials cookies http servlet response httpservletresponse customers list response test clear post testclearpost exception do test dotest method post remove customer credentials cookies http servlet response httpservletresponse forbidden constants csrf non ce nonce header required test get first fetch testgetfirstfetch exception do test dotest method list customers credentials cookies http servlet response httpservletresponse customers list response constants csrf non ce nonce header fetch test valid post testvalidpost exception do test dotest method post remove customer credentials cookies http servlet response httpservletresponse customer removed response valid non ce validnonce test invalid post testinvalidpost exception do test dotest method post remove customer credentials cookies http servlet response httpservletresponse forbidden constants csrf non ce nonce header fetch constants csrf non ce nonce header required do test dotest method post remove customer credentials cookies http servlet response httpservletresponse forbidden invalid non ce nonce constants csrf non ce nonce header required do test dotest method post remove customer credentials cookies http servlet response httpservletresponse forbidden invalid non ce nonce constants csrf non ce nonce header required do test dotest method post remove customer credentials cookies http servlet response httpservletresponse forbidden constants csrf non ce nonce header required test get second fetch testgetsecondfetch exception do test dotest method list customers credentials cookies http servlet response httpservletresponse customers list response constants csrf non ce nonce header fetch valid non ce validnonce test valid post with request params testvalidpostwithrequestparams exception string valid body validbody constants csrf non ce nonce header valid non ce validnonce string invalid body invalidbody constants csrf non ce nonce header invalid non ce nonce do test dotest method post remove customer credentials valid body validbody get bytes getbytes c converter cconverter iso cookies http servlet response httpservletresponse customer removed response do test dotest method post add customer credentials valid body validbody get bytes getbytes c converter cconverter iso cookies http servlet response httpservletresponse customer response do test dotest method post remove customer credentials invalid body invalidbody get bytes getbytes c converter cconverter iso cookies http servlet response httpservletresponse customer removed response valid non ce validnonce test invalid post with request params testinvalidpostwithrequestparams exception string valid body validbody constants csrf non ce nonce header valid non ce validnonce string invalid body invalidbody constants csrf non ce nonce header invalid non ce nonce string invalid body invalidbody constants csrf non ce nonce header constants csrf non ce nonce header fetch do test dotest method post remove customers credentials valid body validbody get bytes getbytes c converter cconverter iso cookies http servlet response httpservletresponse forbidden constants csrf non ce nonce header required do test dotest method post remove customer credentials invalid body invalidbody get bytes getbytes c converter cconverter iso cookies http servlet response httpservletresponse forbidden constants csrf non ce nonce header required do test dotest method post remove customer credentials invalid body invalidbody get bytes getbytes c converter cconverter iso cookies http servlet response httpservletresponse forbidden constants csrf non ce nonce header required do test dotest string method string uri basic credentials basiccredentials credentials body use cookie usecookie expectedrc string expected response expectedresponse string nonce expect csrf h expectcsrfrh string expectedcsrfrhv exception map string list string req headers reqheaders hash map hashmap string list string map string list string resp headers respheaders hash map hashmap string list string add non ce addnonce req headers reqheaders nonce use cookie usecookie add cookies addcookies req headers reqheaders add credentials addcredentials req headers reqheaders credentials byte chunk bytechunk byte chunk bytechunk method equals method get url geturl http prefix get port getport uri req headers reqheaders resp headers respheaders post url posturl body http prefix get port getport uri req headers reqheaders resp headers respheaders assert equals assertequals expectedrc expectedrc http servlet response httpservletresponse assert equals assertequals expected response expectedresponse to string tostring list string new cookies newcookies resp headers respheaders server cookie header save cookies savecookies new cookies newcookies expect csrf h expectcsrfrh assert null assertnull resp headers respheaders constants csrf non ce nonce header list string resp header value respheadervalue resp headers respheaders constants csrf non ce nonce header assert not null assertnotnull resp header value respheadervalue expectedcsrfrhv assert true asserttrue resp header value respheadervalue expectedcsrfrhv valid non ce validnonce resp header value respheadervalue save cookies savecookies list string new cookies newcookies new cookies newcookies new cookies newcookies size string header new cookies newcookies cookies add header substring header index of indexof add cookies addcookies map string list string req headers reqheaders cookies cookies size string builder stringbuilder cookie header cookieheader string builder stringbuilder string cookie cookies cookie header cookieheader append cookie header cookieheader append cookie add request header addrequestheader req headers reqheaders client cookie header cookie header cookieheader to string tostring add non ce addnonce map string list string req headers reqheaders string nonce nonce add request header addrequestheader req headers reqheaders constants csrf non ce nonce header nonce add credentials addcredentials map string list string req headers reqheaders basic credentials basiccredentials credentials credentials add request header addrequestheader req headers reqheaders client header credentials get credentials getcredentials add request header addrequestheader map string list string req headers reqheaders string key string list string value list valuelist array list arraylist string value list valuelist add req headers reqheaders key value list valuelist set up application setupapplication exception context tomcat add context addcontext context path login system get property getproperty java tmp dir tmpdir context set session timeout setsessiontimeout session timeout mins tomcat add servlet addservlet context servlet tester servlet testerservlet context add servlet mapping addservletmapping uri servlet filter def filterdef filter def filterdef filter def filterdef filter def filterdef set filter name setfiltername filter filter def filterdef set filter class setfilterclass rest csrf prevention filter restcsrfpreventionfilter get canonical name getcanonicalname filter def filterdef add init parameter addinitparameter filter init param remove customer add customer context add filter def addfilterdef filter def filterdef filter map filtermap filter map filtermap filter map filtermap filter map filtermap set filter name setfiltername filter filter map filtermap addurlpattern uri csrf context add filter map addfiltermap filter map filtermap security collection securitycollection collection security collection securitycollection collection add pattern addpattern uri security constraint securityconstraint security constraint securityconstraint add auth role addauthrole role add collection addcollection collection context add constraint addconstraint login config loginconfig login config loginconfig set auth method setauthmethod method context set login config setloginconfig authenticator base authenticatorbase basic authenticator basicauthenticator basic authenticator basicauthenticator context get pipeline getpipeline add valve addvalve basic authenticator basicauthenticator basic credentials basiccredentials string method string username string password string credentials basic credentials basiccredentials string a method amethod string a username ausername string a password apassword method a method amethod username a username ausername password a password apassword string user credentials usercredentials username password credentials bytes credentialsbytes user credentials usercredentials get bytes getbytes c converter cconverter iso string base base encode base encodebase string credentials bytes credentialsbytes credentials method base string get credentials getcredentials credentials tester servlet testerservlet http servlet httpservlet serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception list customers equals get requested path getrequestedpath req resp get writer getwriter print customers list response override do post dopost http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception remove customer equals get requested path getrequestedpath req resp get writer getwriter print customer removed response add customer equals get requested path getrequestedpath req resp get writer getwriter print customer response string get requested path getrequestedpath http servlet request httpservletrequest request string path request get servlet path getservletpath request get path info getpathinfo path path request get path info getpathinfo path