licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina session java file java file input stream fileinputstream java io exception ioexception org junit fail org junit test design session manager depends thread safety number classes cases javadoc unclear thread safety tests written test thread safety key classes name d named threading automatically executed unit tests threading link file input stream fileinputstream read methods methods isn obvious thread safe pre windows jdk thread safe osx jdk thread safe pre assume link file input stream fileinputstream read thread safe test test file input stream testfileinputstream exception do test file input stream dotestfileinputstream do test file input stream dotestfileinputstream do test file input stream dotestfileinputstream do test file input stream dotestfileinputstream do test file input stream dotestfileinputstream thread count threadcount exception assumes ant release updated releases file file file output release dev bin apache tomcat dev zip file input stream fileinputstream fis file input stream fileinputstream file thread threads thread thread count threadcount fis reader thread fisreaderthread run nables runnables fis reader thread fisreaderthread thread count threadcount thread count threadcount run nables runnables fis reader thread fisreaderthread fis threads thread run nables runnables start system current time millis currenttimemillis thread count threadcount threads start thread count threadcount threads join run nables runnables isfailed fail interrupted exception interruptedexception print stack trace printstacktrace fail get message getmessage system current time millis currenttimemillis byte count bytecount thread count threadcount byte count bytecount run nables runnables get byte count getbytecount string builder stringbuilder result string builder stringbuilder result append threads result append thread count threadcount result append time result append start result append bytes result append byte count bytecount system println result to string tostring fis reader thread fisreaderthread runnable file input stream fileinputstream fis small buffer process slow buffer byte count bytecount fail fis reader thread fisreaderthread file input stream fileinputstream fis fis fis override read read byte count bytecount read uncomment sync block test adding sync fixes issues platforms fis thread safe fis read fis read buffer io exception ioexception print stack trace printstacktrace fail read get byte count getbytecount byte count bytecount isfailed fail