licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat util modeler modules java file not found exception filenotfoundexception java file output stream fileoutputstream java input stream inputstream java net url java util array list arraylist java util hash map hashmap java util list javax management attribute javax management m bean server mbeanserver javax management object name objectname javax management loading m let mlet javax xml transform transformer exception transformerexception org apache juli logging log org apache juli logging log factory logfactory org apache tomcat util dom util domutil org apache tomcat util modeler attribute info attributeinfo org apache tomcat util modeler base model bean basemodelmbean org apache tomcat util modeler managed bean managedbean org apache tomcat util modeler registry org dom document org dom node create mbeans based config file format extended version mlet class loading classloading don support explicit class loader classloader tag class loader classloader mbean standard m let bean mletmbean custom xxx add special attribute reference loader mbean xxx figure deal load ers loaders deprecated unused removed tomcat deprecated m beans source mbeanssource mode ler source modelersource m beans source bean mbeanssourcembean log log log factory logfactory get log getlog m beans source mbeanssource registry registry string type original loading loading list object name objectname mbeans array list arraylist object name objectname loader loaded loaderloaded document document hash map hashmap object name objectname node object node hash map hashmap object name objectname node last update lastupdate update interval updateinterval set registry setregistry registry reg registry reg set location setlocation string loc location loc single component loaded param type set type settype string type type type override set source setsource object source source source override object get source getsource source string get location getlocation location list mbeans created source implement runtime services override list object name objectname getmbeans mbeans override list object name objectname load descriptors loaddescriptors registry registry string type object source exception set registry setregistry registry set type settype type set source setsource source execute mbeans start exception registry invoke mbeans start exception registry invoke mbeans override init exception mbeans execute registry registry registry get registry getregistry registry invoke mbeans init destroy exception registry invoke mbeans destroy override load exception comp at compat execute execute exception registry registry registry get registry getregistry input stream inputstream stream get input stream getinputstream system current time millis currenttimemillis document dom util domutil read xml readxml stream don care root node node descriptors n descriptorsn document get document element getdocumentelement descriptors n descriptorsn log error descriptors node first mbean n firstmbeann dom util domutil get child getchild descriptors n descriptorsn first mbean n firstmbeann single mlet log is debug enabled isdebugenabled log debug child descriptors n descriptorsn first mbean n firstmbeann descriptors n descriptorsn m bean server mbeanserver server registry get registry getregistry get bean server getmbeanserver xxx clean work around workaround loader loaded loaderloaded register loader find ant classes object name objectname default loader defaultloader object name objectname modeler loader modeler m let mlet mlet m let mlet url get class getclass get class loader getclassloader server registermbean mlet default loader defaultloader loader loaded loaderloaded process nodes node mbean n mbeann first mbean n firstmbeann mbean n mbeann mbean n mbeann dom util domutil get next getnext mbean n mbeann node element node string node name nodename mbean n mbeann get node name getnodename mbean off icial official mbean equals node name nodename mlet equals node name nodename string code dom util domutil get attribute getattribute mbean n mbeann code string object name objectname dom util domutil get attribute getattribute mbean n mbeann object name objectname object name objectname object name objectname dom util domutil get attribute getattribute mbean n mbeann log is debug enabled isdebugenabled log debug processing mbean object name objectname object name objectname code code args grouped constructor direct childs node constructor n constructorn dom util domutil get child getchild mbean n mbeann constructor constructor n constructorn constructor n constructorn mbean n mbeann process arg processarg constructor n constructorn object name objectname oname object name objectname object name objectname server is registered isregistered oname wrap model mbean xxx support standard bean descriptors source standardmbeandescriptorssource string modelmbean base model bean basemodelmbean get name getname server creatembean modelmbean oname object code string string get name getname mode ler source modelersource get name getname mbeans add oname object node oname mbean n mbeann xxx arguments loader exception log error error creating mbean object name objectname node first att n firstattn dom util domutil get child getchild mbean n mbeann attribute node desc n descn first att n firstattn desc n descn desc n descn dom util domutil get next getnext desc n descn process attribute processattribute server desc n descn object name objectname jmx operation equals node name nodename string dom util domutil get attribute getattribute mbean n mbeann object name objectname dom util domutil get attribute getattribute mbean n mbeann string operation dom util domutil get attribute getattribute mbean n mbeann operation log is debug enabled isdebugenabled log debug processing invoke object name objectname code operation object name objectname oname object name objectname process arg processarg mbean n mbeann server invoke oname operation exception log error error invoke operation managed bean managedbean managed managed bean managedbean dom util domutil set attributes setattributes managed mbean n mbeann node first n firstn process attribute info first n firstn dom util domutil get child getchild mbean n mbeann attribute node desc n descn first n firstn desc n descn desc n descn dom util domutil get next getnext desc n descn attribute info attributeinfo attribute info attributeinfo dom util domutil set attributes setattributes desc n descn managed add attribute addattribute system current time millis currenttimemillis log info reading mbeans loading exception log error error reading mbeans override update field updatefield object name objectname oname string object loading log info xxx update field updatefield oname node object node oname log info node oname node att node attnode dom util domutil find child with att findchildwithatt attribute att node attnode existing attribute att node attnode get owner document getownerdocument create element createelement attribute dom util domutil set attribute setattribute att node attnode append child appendchild att node attnode string old value oldvalue dom util domutil get attribute getattribute att node attnode old value oldvalue convert values text content dom util domutil remove attribute removeattribute att node attnode dom util domutil set text settext att node attnode to string tostring store store mbeans xxx add background thread store per iodically periodically override save xxx customize based standard descriptor doesn work call att triger work att delayed time system current time millis currenttimemillis location time last update lastupdate update interval updateinterval last update lastupdate time file output stream fileoutputstream fos file output stream fileoutputstream location dom util domutil write xml writexml document fos transformer exception transformerexception log error error writing file not found exception filenotfoundexception log error error writing process attribute processattribute m bean server mbeanserver server node desc n descn string object name objectname string att name attname dom util domutil get attribute getattribute desc n descn string dom util domutil get attribute getattribute desc n descn dom util domutil get attribute getattribute desc n descn type string type cdata dom util domutil get content getcontent desc n descn log is debug enabled isdebugenabled log debug attribute object name objectname att name attname object name objectname oname object name objectname object name objectname find type type registry get type gettype oname att name attname type log info find attribute object name objectname att name attname object value o valueo registry convert value convertvalue type server set attribute setattribute oname attribute att name attname value o valueo exception log error error processing attribute object name objectname att name attname process arg processarg node mbean n mbeann node first arg n firstargn dom util domutil get child getchild mbean n mbeann arg process args node arg n argn first arg n firstargn arg n argn arg n argn dom util domutil get next getnext arg n argn dom util domutil get attribute getattribute arg n argn type string dom util domutil get attribute getattribute arg n argn cdata dom util domutil get content getcontent arg n argn