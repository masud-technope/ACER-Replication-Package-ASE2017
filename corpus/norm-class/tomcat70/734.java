licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache coyote http java buffered reader bufferedreader java file java io exception ioexception java input stream inputstream java input stream reader inputstreamreader java output stream outputstream java output stream writer outputstreamwriter java print writer printwriter java reader java writer java net inet socket address inetsocketaddress java net socket java net socket address socketaddress java nio char buffer charbuffer java util hash map hashmap java util list java util map java util concurrent count down latch countdownlatch javax servlet async context asynccontext javax servlet dispatcher type dispatchertype javax servlet servlet exception servletexception javax servlet http cookie javax servlet http http servlet httpservlet javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse org junit assert equals assertequals org junit assert false assertfalse org junit assert true asserttrue org junit org junit test org apache catalina context org apache catalina wrapper org apache catalina deploy security collection securitycollection org apache catalina deploy security constraint securityconstraint org apache catalina startup simple http client simplehttpclient org apache catalina startup tester servlet testerservlet org apache catalina startup tomcat org apache catalina startup tomcat base test tomcatbasetest org apache tomcat util buf c converter cconverter org apache tomcat util buf byte chunk bytechunk test abstract http testabstracthttp processor tomcat base test tomcatbasetest test test response with error chunked testresponsewitherrorchunked exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctxt tomcat add context addcontext add servlet tomcat add servlet addservlet ctxt chunked response with error servlet chunkedresponsewitherrorservlet response with error servlet responsewitherrorservlet ctxt add servlet mapping addservletmapping chunked response with error servlet chunkedresponsewitherrorservlet tomcat start string request http simple http client simplehttpclient crlf host simple http client simplehttpclient crlf simple http client simplehttpclient crlf client client client tomcat get connector getconnector get local port getlocalport client set request setrequest string request client connect client process request processrequest expected response response incomplete chunked body assert true asserttrue client is response isresponse chunk assert false assertfalse client get response body getresponsebody ends with endswith portion text assert true asserttrue client get response body getresponsebody ends with endswith response with error servlet responsewitherrorservlet http servlet httpservlet serialversionuid use chunks usechunks response with error servlet responsewitherrorservlet use chunks usechunks use chunks usechunks use chunks usechunks override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception resp set content type setcontenttype text plain resp set character encoding setcharacterencoding utf use chunks usechunks longer response fail complete resp set content length setcontentlength print writer printwriter resp get writer getwriter print flush resp flush buffer flushbuffer print flush resp flush buffer flushbuffer print runtime exception runtimeexception request servlet exception servletexception d eliberate deliberate failure test test with unknown expectation testwithunknownexpectation exception tomcat tomcat get tomcat instance gettomcatinstance normal tomcat root context file root file test webapp tomcat add webapp addwebapp root get absolute path getabsolutepath tomcat start string request post echo params jsp http simple http client simplehttpclient crlf host simple http client simplehttpclient crlf expect unknoen simple http client simplehttpclient crlf simple http client simplehttpclient crlf client client client tomcat get connector getconnector get local port getlocalport client set request setrequest string request client connect client process request processrequest assert true asserttrue client is response isresponse test testwithtevoid exception tomcat tomcat get tomcat instance gettomcatinstance normal tomcat root context file root file test webapp tomcat add webapp addwebapp root get absolute path getabsolutepath tomcat start string request post echo params jsp http simple http client simplehttpclient crlf host simple http client simplehttpclient crlf transfer encoding simple http client simplehttpclient crlf content length simple http client simplehttpclient crlf content type application form url encoded urlencoded simple http client simplehttpclient crlf simple http client simplehttpclient crlf test data client client client tomcat get connector getconnector get local port getlocalport client set request setrequest string request client connect client process request processrequest assert true asserttrue client is response isresponse test testwithtebuffered exception tomcat tomcat get tomcat instance gettomcatinstance normal tomcat root context file root file test webapp tomcat add webapp addwebapp root get absolute path getabsolutepath tomcat start string request post echo params jsp http simple http client simplehttpclient crlf host simple http client simplehttpclient crlf transfer encoding buf fered buffered simple http client simplehttpclient crlf content length simple http client simplehttpclient crlf content type application form url encoded urlencoded simple http client simplehttpclient crlf simple http client simplehttpclient crlf test data client client client tomcat get connector getconnector get local port getlocalport client set request setrequest string request client connect client process request processrequest assert true asserttrue client is response isresponse test testwithtechunked exception do test with chunked dotestwithtechunked test test with chunked with l testwithtechunkedwithcl exception do test with chunked dotestwithtechunked do test with chunked dotestwithtechunked withcl exception tomcat tomcat get tomcat instance gettomcatinstance normal tomcat root context file root file test webapp tomcat add webapp addwebapp root get absolute path getabsolutepath tomcat start string request post echo params jsp http simple http client simplehttpclient crlf host simple http client simplehttpclient crlf withcl content length simple http client simplehttpclient crlf transfer encoding chunked simple http client simplehttpclient crlf content type application form url encoded urlencoded simple http client simplehttpclient crlf connection close simple http client simplehttpclient crlf simple http client simplehttpclient crlf simple http client simplehttpclient crlf test data simple http client simplehttpclient crlf simple http client simplehttpclient crlf simple http client simplehttpclient crlf client client client tomcat get connector getconnector get local port getlocalport client set request setrequest string request client connect client process request processrequest assert true asserttrue client is response isresponse assert true asserttrue client get response body getresponsebody test data test testwithteidentity exception tomcat tomcat get tomcat instance gettomcatinstance normal tomcat root context file root file test webapp tomcat add webapp addwebapp root get absolute path getabsolutepath tomcat start string request post echo params jsp http simple http client simplehttpclient crlf host simple http client simplehttpclient crlf transfer encoding identity simple http client simplehttpclient crlf content length simple http client simplehttpclient crlf content type application form url encoded urlencoded simple http client simplehttpclient crlf connection close simple http client simplehttpclient crlf simple http client simplehttpclient crlf test data client client client tomcat get connector getconnector get local port getlocalport client set request setrequest string request client connect client process request processrequest assert true asserttrue client is response isresponse assert true asserttrue client get response body getresponsebody test data test test with saved request testwithtesavedrequest exception tomcat tomcat get tomcat instance gettomcatinstance normal tomcat root context file root file test webapp tomcat add webapp addwebapp root get absolute path getabsolutepath tomcat start string request post echo params jsp http simple http client simplehttpclient crlf host simple http client simplehttpclient crlf transfer encoding saved request savedrequest simple http client simplehttpclient crlf content length simple http client simplehttpclient crlf content type application form url encoded urlencoded simple http client simplehttpclient crlf simple http client simplehttpclient crlf test data client client client tomcat get connector getconnector get local port getlocalport client set request setrequest string request client connect client process request processrequest assert true asserttrue client is response isresponse test testwithteunsupported exception tomcat tomcat get tomcat instance gettomcatinstance normal tomcat root context file root file test webapp tomcat add webapp addwebapp root get absolute path getabsolutepath tomcat start string request post echo params jsp http simple http client simplehttpclient crlf host simple http client simplehttpclient crlf transfer encoding unsupported simple http client simplehttpclient crlf content length simple http client simplehttpclient crlf content type application form url encoded urlencoded simple http client simplehttpclient crlf simple http client simplehttpclient crlf test data client client client tomcat get connector getconnector get local port getlocalport client set request setrequest string request client connect client process request processrequest assert true asserttrue client is response isresponse test test pipe lining testpipelining exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctxt tomcat add context addcontext add servlet tomcat add servlet addservlet ctxt tester servlet testerservlet tester servlet testerservlet ctxt add servlet mapping addservletmapping foo tester servlet testerservlet tomcat start string request part requestpart foo http simple http client simplehttpclient crlf string request part requestpart host simple http client simplehttpclient crlf simple http client simplehttpclient crlf client client client tomcat get connector getconnector get local port getlocalport client set request setrequest string request part requestpart request part requestpart client set request pause setrequestpause client set use content length setusecontentlength client connect runnable send runnable override client send request sendrequest client send request sendrequest interrupted exception interruptedexception runtime exception runtimeexception io exception ioexception runtime exception runtimeexception thread thread send start sleep request request thread sleep read response client read response readresponse assert false assertfalse client is response isresponse assert true asserttrue client is response isresponse assert equals assertequals client get response body getresponsebody read response sleep read block data process client read response readresponse assert false assertfalse client is response isresponse assert true asserttrue client is response isresponse assert equals assertequals client get response body getresponsebody test test chunking testchunking no content length nocontentlength exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctxt tomcat add context addcontext tomcat add servlet addservlet ctxt no content length flushing servlet nocontentlengthflushingservlet no content length flushing servlet nocontentlengthflushingservlet ctxt add servlet mapping addservletmapping test no content length flushing servlet nocontentlengthflushingservlet tomcat start byte chunk bytechunk response body responsebody byte chunk bytechunk map string list string response headers responseheaders hash map hashmap string list string get url geturl http localhost get port getport test response body responsebody response headers responseheaders assert equals assertequals http servlet response httpservletresponse assert true asserttrue response headers responseheaders contains key containskey transfer encoding list string encodings response headers responseheaders transfer encoding assert equals assertequals encodings size assert equals assertequals chunked encodings test test no chunking testnochunking no content length connection close nocontentlengthconnectionclose exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctxt tomcat add context addcontext tomcat add servlet addservlet ctxt no content length connection close flushing servlet nocontentlengthconnectioncloseflushingservlet no content length connection close flushing servlet nocontentlengthconnectioncloseflushingservlet ctxt add servlet mapping addservletmapping test no content length connection close flushing servlet nocontentlengthconnectioncloseflushingservlet tomcat start byte chunk bytechunk response body responsebody byte chunk bytechunk map string list string response headers responseheaders hash map hashmap string list string get url geturl http localhost get port getport test response body responsebody response headers responseheaders assert equals assertequals http servlet response httpservletresponse assert true asserttrue response headers responseheaders contains key containskey connection list string connections response headers responseheaders connection assert equals assertequals connections size assert equals assertequals close connections assert false assertfalse response headers responseheaders contains key containskey transfer encoding assert equals assertequals response body responsebody to string tostring test test bug testbug exception do test bug dotestbug test test bug testbug exception do test bug dotestbug do test bug dotestbug flush exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctxt tomcat add context addcontext tomcat add servlet addservlet ctxt l arg e header servlet largeheaderservlet l arg e header servlet largeheaderservlet flush ctxt add servlet mapping addservletmapping test l arg e header servlet largeheaderservlet tomcat start byte chunk bytechunk response body responsebody byte chunk bytechunk map string list string response headers responseheaders hash map hashmap string list string get url geturl http localhost get port getport test response body responsebody response headers responseheaders assert equals assertequals http servlet response httpservletresponse internal server error response body responsebody get length getlength standard error hand lign handlign triggered assert false assertfalse response body responsebody to string tostring fail count down latch countdownlatch bug latch count down latch countdownlatch count down latch countdownlatch bug latch count down latch countdownlatch count down latch countdownlatch bug latch count down latch countdownlatch bug is second request issecondrequest bug request state leaked requeststateleaked test test bug testbug exception tomcat tomcat get tomcat instance gettomcatinstance tomcat get connector getconnector set property setproperty processor cache processorcache tomcat get connector getconnector set property setproperty max threads maxthreads file system doc base docbase required context ctxt tomcat add context addcontext tomcat add servlet addservlet ctxt async bug servlet ctxt add servlet mapping addservletmapping async tomcat start string request async http host localhost get port getport connection alive cache control max age accept text html application xhtml xml application xml image web p webp user agent request accept encoding gzip def late deflate sdch accept language cookie leak string request async http host localhost get port getport connection alive cache control max age accept text html application xhtml xml application xml image web p webp user agent request accept encoding gzip def late deflate sdch accept language socket connection connection socket localhost get port getport connection set so linger setsolinger writer writer output stream writer outputstreamwriter connection get output stream getoutputstream c converter cconverter get charset getcharset ascii writer write request writer flush bug latch await connection close connection connection close io exception ioexception ioe bug latch await bug is second request issecondrequest connection socket localhost get port getport connection set so linger setsolinger writer writer output stream writer outputstreamwriter connection get output stream getoutputstream c converter cconverter get charset getcharset ascii writer write request writer flush connection get input stream getinputstream read connection connection close io exception ioexception ioe bug latch await bug request state leaked requeststateleaked fail leaked requests https apache org bug zilla bugzilla bug cgi test test non testnon xx response with expectation xxresponsewithexpectation exception do test non dotestnon xx response and expectation xxresponseandexpectation test test non testnon xx response without expectation xxresponsewithoutexpectation exception do test non dotestnon xx response and expectation xxresponseandexpectation do test non dotestnon xx response and expectation xxresponseandexpectation use expectation useexpectation exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext tomcat add servlet addservlet ctx echo echo body servlet echobodyservlet ctx add servlet mapping addservletmapping echo echo security collection securitycollection collection security collection securitycollection collection add pattern addpattern security constraint securityconstraint constraint security constraint securityconstraint constraint add auth role addauthrole constraint add collection addcollection collection ctx add constraint addconstraint constraint tomcat start xx response client xxresponseclient client xx response client xxresponseclient use expectation useexpectation client set port setport get port getport client do resource request doresourcerequest http localhost get port getport echo http hello world helloworld assert true asserttrue client is response isresponse assert true asserttrue client check connection header checkconnectionheader bug servlet http servlet httpservlet serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception bug is second request issecondrequest cookie cookies req get cookies getcookies cookies cookies length cookie cookie req get cookies getcookies cookie get name getname equals ignore case equalsignorecase leak bug request state leaked requeststateleaked bug latch count down countdown tomcat parse cookies request req get cookies getcookies req set attribute setattribute org apache catalina async supported async context asynccontext async context asynccontext req start async startasync async context asynccontext set timeout settimeout bug latch count down countdown print writer printwriter writer async context asynccontext get response getresponse get writer getwriter writer print writer flush bug latch count down countdown l arg e header servlet largeheaderservlet http servlet httpservlet serialversionuid flush l arg e header servlet largeheaderservlet flush flush flush override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception string large value largevalue char buffer charbuffer all ocate allocate to string tostring replace resp set header setheader test large value largevalue flush resp flush buffer flushbuffer resp set content type setcontenttype text plain resp get writer getwriter print fail result chunking http no content length flushing servlet nocontentlengthflushingservlet http servlet httpservlet serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception resp set status setstatus http servlet response httpservletresponse resp set content type setcontenttype text plain resp get writer getwriter write resp flush buffer flushbuffer result chunking http no content length connection close flushing servlet nocontentlengthconnectioncloseflushingservlet http servlet httpservlet serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception resp set status setstatus http servlet response httpservletresponse resp set content type setcontenttype text event stream resp add header addheader connection close resp flush buffer flushbuffer resp get writer getwriter write resp flush buffer flushbuffer client simple http client simplehttpclient client port set port setport port override is response body k isresponsebodyok get response body getresponsebody test data part ially partially read chunked input swallowed read async processing test test bug testbug exception tomcat tomcat get tomcat instance gettomcatinstance real doc base docbase temp context root tomcat add context addcontext system get property getproperty java tmp dir tmpdir wrapper tomcat add servlet addservlet root bug bug servlet set async supported setasyncsupported root add servlet mapping addservletmapping test bug tomcat start bug client client bug client client set port setport tomcat get connector getconnector get local port getlocalport client set use content length setusecontentlength client connect client do request dorequest assert true asserttrue client get response line getresponseline client is response isresponse assert true asserttrue client is response body k isresponsebodyok request ensure remaining body swallowed client reset response resetresponse client process request processrequest assert true asserttrue client is response isresponse assert true asserttrue client is response body k isresponsebodyok client disconnect bug servlet http servlet httpservlet serialversionuid override do put doput http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception async context asynccontext req start async startasync start runnable override resp set content type setcontenttype text plain resp set character encoding setcharacterencoding utf resp get writer getwriter print io exception ioexception complete bug client simple http client simplehttpclient exception do request dorequest string request string request http localhost test http crlf transfer encoding chunked crlf crlf crlf request crlf crlf crlf set request setrequest request blocks response read process request processrequest exception override is response body k isresponsebodyok get response body getresponsebody get response body getresponsebody xx response client xxresponseclient simple http client simplehttpclient string header expect expect string header connection connection close use expectation useexpectation xx response client xxresponseclient use expectation useexpectation use expectation useexpectation use expectation useexpectation do resource request doresourcerequest string resource uri resourceuri string request body requestbody exception string builder stringbuilder request head requesthead string builder stringbuilder request head requesthead append resource uri resourceuri append crlf use expectation useexpectation request head requesthead append header expect append crlf request head requesthead append crlf request head requesthead append request body requestbody append crlf string request string request request head requesthead to string tostring request do request dorequest request do request dorequest string request exception set request setrequest request connect process request processrequest disconnect override is response body k isresponsebodyok check connection header checkconnectionheader list string response headers responseheaders get response headers getresponseheaders string header response headers responseheaders header connection equals header use expectation useexpectation test test bug testbug exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext tomcat add servlet addservlet ctx bug bug servlet ctx add servlet mapping addservletmapping test bug tomcat start byte chunk bytechunk response body responsebody byte chunk bytechunk map string list string response headers responseheaders hash map hashmap string list string head url headurl http localhost get port getport test response body responsebody response headers responseheaders assert equals assertequals http servlet response httpservletresponse assert equals assertequals response body responsebody get length getlength assert false assertfalse response headers responseheaders contains key containskey content length bug servlet http servlet httpservlet serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception todo auto generated method stub do get doget req resp override do head dohead http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception resp set content length long setcontentlengthlong resp flush buffer flushbuffer tests request completed dispatch request body fully read test test request body swallowing testrequestbodyswallowing exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext sempahore servlet sempahoreservlet servlet sempahore servlet sempahoreservlet wrapper tomcat add servlet addservlet ctx test servlet set async supported setasyncsupported ctx add servlet mapping addservletmapping test test tomcat start hand craft client complete control timing socket address socketaddress add r addr inet socket address inetsocketaddress localhost get port getport socket socket socket socket set so timeout setsotimeout socket connect add r addr output stream outputstream socket get output stream getoutputstream writer writer output stream writer outputstreamwriter iso input stream inputstream socket get input stream getinputstream reader input stream reader inputstreamreader iso buffered reader bufferedreader reader buffered reader bufferedreader write headers writer write post test http writer write host localhost writer write transfer encoding chunked writer write writer flush validate response validateresponse reader write request body writer write writer write writer write writer write writer flush write request writer write post test http writer write host localhost writer write transfer encoding chunked writer write writer flush read response validate response validateresponse reader write request body writer write writer write writer write writer write writer flush socket close validate response validateresponse buffered reader bufferedreader reader io exception ioexception response code string reader read line readline assert equals assertequals http equals reader read line readline sempahore servlet sempahoreservlet http servlet httpservlet serialversionuid override do post dopost http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception dispatcher type dispatchertype async equals req get dispatcher type getdispatchertype resp set content type setcontenttype text plain resp set character encoding setcharacterencoding utf resp get writer getwriter write req start async startasync dispatch