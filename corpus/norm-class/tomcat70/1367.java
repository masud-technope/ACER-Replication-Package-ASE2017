licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina filters java io exception ioexception java serializable java util hash set hashset java util linked hash map linkedhashmap java util map java util javax servlet filter chain filterchain javax servlet servlet exception servletexception javax servlet servlet request servletrequest javax servlet servlet response servletresponse javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse javax servlet http http servlet response wrapper httpservletresponsewrapper javax servlet http http session httpsession basic csrf protection web application filter assumes filter mapped link http servlet response httpservletresponse encoderedirecturl string link http servlet response httpservletresponse encodeurl string encode url s urls returned client csrf prevention filter csrfpreventionfilter csrf prevention filter base csrfpreventionfilterbase string entry points entrypoints hash set hashset string nonce cache size noncecachesize entry points url s urls tested presence valid nonce provide navigate application navigating entry points limited http requests trigger security sensitive actions param entry points entrypoints comma separated list url s urls configured entry points set entry points setentrypoints string entry points entrypoints string values entry points entrypoints split string values entry points entrypoints add trim sets number issued non ces nonces cached lru basis support parallel requests limited refresh browser behaviors result sub mission submission previous nonce current param nonce cache size noncecachesize number non ces nonces cache set non ce cache size setnoncecachesize nonce cache size noncecachesize nonce cache size noncecachesize nonce cache size noncecachesize override do filter dofilter servlet request servletrequest request servlet response servletresponse response filter chain filterchain chain io exception ioexception servlet exception servletexception servlet response servletresponse w response wresponse request http servlet request httpservletrequest response http servlet response httpservletresponse http servlet request httpservletrequest req http servlet request httpservletrequest request http servlet response httpservletresponse res http servlet response httpservletresponse response skip non ce check skipnoncecheck constants method equals req get method getmethod entry points entrypoints get requested path getrequestedpath req skip non ce check skipnoncecheck http session httpsession session req get session getsession suppress warnings suppresswarnings unchecked lru cache lrucache string nonce cache noncecache session lru cache lrucache string session get attribute getattribute constants csrf non ce nonce session attr skip non ce check skipnoncecheck string previous non ce previousnonce req get parameter getparameter constants csrf non ce nonce request param nonce cache noncecache previous non ce previousnonce nonce cache noncecache previous non ce previousnonce res send error senderror get deny status getdenystatus nonce cache noncecache nonce cache noncecache lru cache lrucache string nonce cache size noncecachesize session session req get session getsession session set attribute setattribute constants csrf non ce nonce session attr nonce cache noncecache string new non ce newnonce generate non ce generatenonce nonce cache noncecache add new non ce newnonce w response wresponse csrf response wrapper csrfresponsewrapper res new non ce newnonce w response wresponse response chain do filter dofilter request w response wresponse csrf response wrapper csrfresponsewrapper http servlet response wrapper httpservletresponsewrapper string nonce csrf response wrapper csrfresponsewrapper http servlet response httpservletresponse response string nonce response nonce nonce override deprecated string encode redirect url encoderedirecturl string url encoderedirecturl url override string encoderedirecturl string url add non ce addnonce encoderedirecturl url override deprecated string encode url encodeurl string url encodeurl url override string encodeurl string url add non ce addnonce encodeurl url url nonce query string param url url modified param nonce nonce add string add non ce addnonce string url url nonce url string path url string query string anchor pound path index of indexof pound anchor path substring pound path path substring pound question path index of indexof question query path substring question path path substring question string builder stringbuilder string builder stringbuilder path query length append query append append append constants csrf non ce nonce request param append append nonce append anchor to string tostring lru cache lrucache serializable serialversionuid internal implementation map cache implementation concerned map cache lru cache lrucache cache size cachesize cache linked hash map linkedhashmap serialversionuid override remove eldest entry removeeldestentry map entry eldest size cache size cachesize add key cache cache key key cache cache contains key containskey key