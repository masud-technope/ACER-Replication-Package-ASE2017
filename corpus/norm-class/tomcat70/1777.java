licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina authenticator java file java io exception ioexception java security principal java security privileged action privilegedaction java security privileged action exception privilegedactionexception java security privileged exception action privilegedexceptionaction java util linked hash map linkedhashmap java util regex pattern javax security subject javax security login login context logincontext javax security login login exception loginexception javax servlet http http servlet response httpservletresponse org apache catalina lifecycle exception lifecycleexception org apache catalina realm org apache catalina connector request org apache catalina deploy login config loginconfig org apache catalina startup bootstrap org apache juli logging log org apache juli logging log factory logfactory org apache tomcat util buf byte chunk bytechunk org apache tomcat util buf message bytes messagebytes org apache tomcat util code c codec binary base org apache tomcat util comp at compat jre vendor jrevendor org ietf jgss gss context gsscontext org ietf jgss gss credential gsscredential org ietf jgss gss exception gssexception org ietf jgss gss manager gssmanager org ietf jgss oid spnego authenticator spnego kerberos support built java successful kerberos authentication depends correct configuration multiple components configuration invalid error messages cryptic google search point direction spnego authenticator spnegoauthenticator authenticator base authenticatorbase log log log factory logfactory get log getlog spnego authenticator spnegoauthenticator string login config name loginconfigname constants login module string get login config name getloginconfigname login config name loginconfigname set login config name setloginconfigname string login config name loginconfigname login config name loginconfigname login config name loginconfigname store delegate d credential storedelegatedcredential is store delegate d credential isstoredelegatedcredential store delegate d credential storedelegatedcredential set store delegate d credential setstoredelegatedcredential store delegate d credential storedelegatedcredential store delegate d credential storedelegatedcredential store delegate d credential storedelegatedcredential pattern no keep alive user agents nokeepaliveuseragents string get no keep alive user agents getnokeepaliveuseragents pattern no keep alive user agents nokeepaliveuseragents pattern set no keep alive user agents setnokeepaliveuseragents string no keep alive user agents nokeepaliveuseragents no keep alive user agents nokeepaliveuseragents no keep alive user agents nokeepaliveuseragents length no keep alive user agents nokeepaliveuseragents no keep alive user agents nokeepaliveuseragents pattern compile no keep alive user agents nokeepaliveuseragents apply java applyjava get apply java getapplyjava apply java applyjava set apply java setapplyjava apply java applyjava apply java applyjava apply java applyjava override string get auth method getauthmethod constants spnego method override string get info getinfo org apache catalina authenticator spnego authenticator spnegoauthenticator override init internal initinternal lifecycle exception lifecycleexception init internal initinternal kerberos configuration file location string krb conf system get property getproperty constants krb conf property krb conf system property tomcat file krb conf file conffile file bootstrap get catalina base getcatalinabase constants krb conf system set property setproperty constants krb conf property krb conf file conffile get absolute path getabsolutepath jaas configuration file location string jaas conf jaasconf system get property getproperty constants jaas conf property jaas conf jaasconf system property tomcat file jaas conf file jaasconffile file bootstrap get catalina base getcatalinabase constants jaas conf system set property setproperty constants jaas conf property jaas conf file jaasconffile get absolute path getabsolutepath override authenticate request request http servlet response httpservletresponse response login config loginconfig config io exception ioexception check for cached authentication checkforcachedauthentication request response message bytes messagebytes authorization request get coyote request getcoyoterequest get mime headers getmimeheaders get value getvalue authorization authorization log is debug enabled isdebugenabled log debug get string getstring authenticator no auth header noauthheader response set header setheader authenticate negotiate response send error senderror http servlet response httpservletresponse unauthorized authorization to bytes tobytes byte chunk bytechunk authorizationbc authorization get byte chunk getbytechunk authorizationbc starts with ignore case startswithignorecase negotiate log is debug enabled isdebugenabled log debug get string getstring spnego authenticator spnegoauthenticator auth header not neg o authheadernotnego response set header setheader authenticate negotiate response send error senderror http servlet response httpservletresponse unauthorized authorizationbc set offset setoffset authorizationbc get offset getoffset decoded base decode base decodebase authorizationbc get buffer getbuffer authorizationbc get offset getoffset authorizationbc get length getlength get apply java getapplyjava spnego token fixer spnegotokenfixer decoded decoded length log is debug enabled isdebugenabled log debug get string getstring spnego authenticator spnegoauthenticator auth header no token authheadernotoken response set header setheader authenticate negotiate response send error senderror http servlet response httpservletresponse unauthorized login context logincontext gss context gsscontext gss context gsscontext out token outtoken principal principal login context logincontext get login config name getloginconfigname login login exception loginexception log error get string getstring spnego authenticator spnegoauthenticator service login fail serviceloginfail response send error senderror http servlet response httpservletresponse internal server error subject subject get subject getsubject assume gss context gsscontext state less stateless todo confirm assumption gss manager gssmanager manager gss manager gssmanager get instance getinstance ibm jdk under stands understands ind efinite indefinite lifetime credential lifetime credentiallifetime jre vendor jrevendor ibm jvm credential lifetime credentiallifetime gss credential gsscredential indefinite lifetime credential lifetime credentiallifetime gss credential gsscredential lifetime privileged exception action privilegedexceptionaction gss credential gsscredential action privileged exception action privilegedexceptionaction gss credential gsscredential override gss credential gsscredential gss exception gssexception manager create credential createcredential credential lifetime credentiallifetime oid gss credential gsscredential accept gss context gsscontext manager create context createcontext subject do as doas subject action out token outtoken subject do as doas get subject getsubject accept action acceptaction gss context gsscontext decoded out token outtoken log is debug enabled isdebugenabled log debug get string getstring spnego authenticator spnegoauthenticator ticket validate fail ticketvalidatefail start response set header setheader authenticate negotiate response send error senderror http servlet response httpservletresponse unauthorized principal subject do as doas subject authenticate action authenticateaction context get realm getrealm gss context gsscontext store delegate d credential storedelegatedcredential gss exception gssexception log is debug enabled isdebugenabled log debug get string getstring spnego authenticator spnegoauthenticator ticket validate fail ticketvalidatefail response set header setheader authenticate negotiate response send error senderror http servlet response httpservletresponse unauthorized privileged action exception privilegedactionexception throwable get cause getcause gss exception gssexception log is debug enabled isdebugenabled log debug get string getstring spnego authenticator spnegoauthenticator service login fail serviceloginfail log error get string getstring spnego authenticator spnegoauthenticator service login fail serviceloginfail response set header setheader authenticate negotiate response send error senderror http servlet response httpservletresponse unauthorized gss context gsscontext gss context gsscontext dispose gss exception gssexception log out logout login exception loginexception send response token success failure response set header setheader authenticate negotiate base encode base encodebase string out token outtoken principal register request response principal constants spnego method principal get name getname pattern no keep alive user agents nokeepaliveuseragents message bytes messagebytes request get coyote request getcoyoterequest get mime headers getmimeheaders get value getvalue user agent matcher to string tostring matches response set header setheader connection close response send error senderror http servlet response httpservletresponse unauthorized gss credential privileged action accept action acceptaction privileged exception action privilegedexceptionaction gss context gsscontext gss context gsscontext decoded accept action acceptaction gss context gsscontext context decoded token decodedtoken gss context gsscontext context decoded decoded token decodedtoken override gss exception gssexception gss context gsscontext accept sec context acceptseccontext decoded decoded length authenticate action authenticateaction privileged action privilegedaction principal realm realm gss context gsscontext gss context gsscontext store delegate d credential storedelegatedcredential authenticate action authenticateaction realm realm gss context gsscontext gss context gsscontext store delegate d credential storedelegatedcredential realm realm gss context gsscontext gss context gsscontext store delegate d credential storedelegatedcredential store delegate d credential storedelegatedcredential override principal realm authenticate gss context gsscontext store delegate d credential storedelegatedcredential hack inc ompatibility incompatibility spnego implementation windows spnego implementation java update onwards int roduced introduced change bug https bugs open jdk openjdk java net browse jdk not e note change applied suggested bug report clear windows java tomcat fault java wrong hack works ordering list mech types mechtypes neg token init negtokeninit token spnego token fixer spnegotokenfixer token spnego token fixer spnegotokenfixer fixer spnego token fixer spnegotokenfixer token fixer token pos spnego token fixer spnegotokenfixer token token token fixes token place unexpected abort process tag length oid tag length tag length tag length as int lengthasint tag start mech type mechtype list read mech types mechtypes ordered mech types len mechtypeslen length as int lengthasint mech types start mechtypesstart pos linked hash map linkedhashmap string mech type entries mechtypeentries linked hash map linkedhashmap string pos mech types start mechtypesstart mech types len mechtypeslen pos string key oid as string oidasstring pos mech type entries mechtypeentries key construct ordered mech type mechtype list replacement mech types len mechtypeslen replacement pos replacementpos mech type entries mechtypeentries remove system arraycopy token replacement replacement pos replacementpos replacement pos replacementpos markers mech type entries mechtypeentries values system arraycopy token markers replacement replacement pos replacementpos markers replacement pos replacementpos markers replace original mech type mechtype list ordered system arraycopy replacement token mech types start mechtypesstart mech types len mechtypeslen tag expected token pos xff expected length retain length consume valid len length as int lengthasint pos len token length length as int lengthasint len token pos xff len bytes len len bytes len len len len token pos xff len oid string expected expected equals oid as string oidasstring string oid as string oidasstring tag string builder stringbuilder result string builder stringbuilder len length as int lengthasint special token pos xff result append result append result append write len token pos xff write write result append result append write result to string tostring