licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat jdbc test java sql connection java sql result set resultset java sql statement java util concurrent count down latch countdownlatch java util concurrent java util concurrent time unit timeunit javax sql data source datasource org junit org junit test org apache tomcat jdbc pool data source proxy datasourceproxy org apache tomcat jdbc test driver driver connect count test connectcounttest default test case defaulttestcase sleep get long getlong sleep long value longvalue complete get long getlong complete long value longvalue print thread printthread get boolean getboolean print thread printthread count down latch countdownlatch latch override org apache tomcat jdbc pool data source datasource create default data source createdefaultdatasource todo auto generated method stub org apache tomcat jdbc pool data source datasource create default data source createdefaultdatasource get pool properties getpoolproperties set driver class name setdriverclassname driver get name getname get pool properties getpoolproperties set url seturl driver url get pool properties getpoolproperties set initial size setinitialsize get pool properties getpoolproperties set max idle setmaxidle get pool properties getpoolproperties set min idle setminidle get pool properties getpoolproperties set max active setmaxactive override tear down teardown exception driver reset tear down teardown print thread results printthreadresults test thread testthread threads string active expected min fetch minfetch max max fetch maxfetch min total fetch totalfetch max wait maxwait minwait max totalwait threads length test thread testthread threads total fetch totalfetch nroffetch totalwait totalwait max wait maxwait math max max wait maxwait max wait maxwait minwait math min minwait minwait min fetch minfetch math min min fetch minfetch nroffetch max fetch maxfetch math max max fetch maxfetch nroffetch connect count test connectcounttest print thread printthread system println get name getname fetch nroffetch max fetch time max wait maxwait max close time cmax system println max fetch max fetch maxfetch min fetch min fetch minfetch average fetch total fetch totalfetch threads length system println max wait max wait maxwait min wait minwait average wait totalwait total fetch totalfetch system println max active active expected active expected test testdbcpthreads connections exception system println testdbcpthreads connections starting fairness dbcp threadcount transfer properties transferproperties t data source tdatasource get connection getconnection close latch count down latch countdownlatch threadcount start system current time millis currenttimemillis test thread testthread threads test thread testthread threadcount threadcount threads test thread testthread threads set name setname tomcat dbcp threads t data source tdatasource threadcount threads start latch await complete time unit timeunit milliseconds system println latch timed delta system current time millis currenttimemillis start print thread results printthreadresults threads testdbcpthreads connections driver connect count connectcount system println test completed delta test test pool threads testpoolthreads connections exception system println test pool threads testpoolthreads connections starting fairness tomcat jdbc fair threadcount transfer properties transferproperties datasource get connection getconnection close latch count down latch countdownlatch threadcount start system current time millis currenttimemillis test thread testthread threads test thread testthread threadcount threadcount threads test thread testthread threads set name setname tomcat pool threads datasource threadcount threads start latch await complete time unit timeunit milliseconds system println latch timed delta system current time millis currenttimemillis start print thread results printthreadresults threads test pool threads testpoolthreads connections driver connect count connectcount system println test completed delta test test pool threads testpoolthreads connections fair exception system println test pool threads testpoolthreads connections fair starting fairness tomcat jdbc fair threadcount datasource get pool properties getpoolproperties set fair queue setfairqueue transfer properties transferproperties datasource get connection getconnection close latch count down latch countdownlatch threadcount start system current time millis currenttimemillis test thread testthread threads test thread testthread threadcount threadcount threads test thread testthread threads set name setname tomcat pool threads datasource threadcount threads start latch await complete time unit timeunit milliseconds system println latch timed delta system current time millis currenttimemillis start print thread results printthreadresults threads test pool threads testpoolthreads connections fair driver connect count connectcount system println test completed delta test test pool threads testpoolthreads connections fair async fairasync exception system println test pool threads testpoolthreads connections fair async fairasync starting fairness tomcat jdbc fair async threadcount datasource get pool properties getpoolproperties set fair queue setfairqueue datasource get pool properties getpoolproperties set initial size setinitialsize datasource get pool properties getpoolproperties get max active getmaxactive transfer properties transferproperties datasource get connection getconnection close latch count down latch countdownlatch threadcount start system current time millis currenttimemillis test thread testthread threads test thread testthread threadcount threadcount threads test thread testthread threads set name setname tomcat pool threads async threads datasource threadcount threads start latch await complete time unit timeunit milliseconds system println latch timed delta system current time millis currenttimemillis start print thread results printthreadresults threads test pool threads testpoolthreads connections fair async fairasync driver connect count connectcount system println test completed delta test thread testthread thread data source datasource string query sleep async minwait max max wait maxwait totalwait total cmax totalcmax cmax nroffetch total runtime totalruntime override system current time millis currenttimemillis connect count test connectcounttest system current time millis currenttimemillis connect count test connectcounttest complete start system nano time nanotime connection con async connection data source proxy datasourceproxy get connection async getconnectionasync con con get connection getconnection delta system nano time nanotime start totalwait delta max wait maxwait math max delta max wait maxwait minwait math min delta minwait nroffetch query statement con create statement createstatement result set resultset execute query executequery query close close connect count test connectcounttest sleep sleep connect count test connectcounttest sleep interrupted exception interruptedexception int errupted interrupted cst art cstart system nano time nanotime con con close exception print stack trace printstacktrace cdelta system nano time nanotime cst art cstart total cmax totalcmax cdelta cmax math max cdelta cmax total runtime totalruntime system nano time nanotime start exception print stack trace printstacktrace connect count test connectcounttest latch count down countdown system get property getproperty print thread stats system println get name getname t max tmax time retrieve connection max wait maxwait t total ttotal time retrieve connection totalwait t average taverage time retrieve connection totalwait nroffetch t max tmax time close connection cmax t total ttotal time close connection total cmax totalcmax t average taverage time close connection total cmax totalcmax nroffetch t run trun time total runtime totalruntime t nr tnr fetch nroffetch