licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina util java file java file input stream fileinputstream java io exception ioexception java input stream inputstream java util array list arraylist java util iterator java util locale java util no such element exception nosuchelementexception java util string tokenizer stringtokenizer java util jar jar input stream jarinputstream java util jar manifest javax naming binding javax naming naming enumeration namingenumeration javax naming naming exception namingexception javax naming directory dir context dircontext org apache catalina context org apache naming resources resource org apache tomcat util exception utils exceptionutils org apache tomcat util res string manager stringmanager ensures extension dependencies resolved web application met builds master list extensions application valid ates validates extensions http docs oracle java se javase docs guide extensions spec html detailed exp lanation explanation extension mechanism java author greg murray author just yna justyna horwat extension validator extensionvalidator org apache juli logging log log org apache juli logging log factory logfactory get log getlog extension validator extensionvalidator string resources string manager stringmanager string manager stringmanager get manager getmanager org apache catalina util array list arraylist extension container available extensions containeravailableextensions array list arraylist manifest resource manifestresource container manifest resources containermanifestresources array list arraylist manifest resource manifestresource initializer loads container level extensions web applications method scans extension directories java ext dirs system property system path scanned jar files extensions check container level optional packages string system classpath systemclasspath system get property getproperty java path string tokenizer stringtokenizer str tok strtok string tokenizer stringtokenizer system classpath systemclasspath file path separator pathseparator build list jar files classpath str tok strtok has more tokens hasmoretokens string classpath item classpathitem str tok strtok next token nexttoken classpath item classpathitem to lower case tolowercase locale english ends with endswith jar file item file classpath item classpathitem item is file isfile add system resource addsystemresource item io exception ioexception log error get string getstring extension validator extensionvalidator fail load failload item add folders list add folder list addfolderlist java ext dirs methods runtime validation web application method jndi resources located code dir context dircontext code loc ates locates web application manifest file meta inf directory application manifest files jar file located web inf lib directory creates code array list arraylist code code manifest res orce manifestresorce code objects objects passed validate manifest resources validatemanifestresources method validation param dir context dircontext jndi root web application param context context logger path application required extensions satisfied validate application validateapplication dir context dircontext dir context dircontext context context io exception ioexception string app name appname context get name getname array list arraylist manifest resource manifestresource app manifest resources appmanifestresources array list arraylist manifest resource manifestresource valid dir context dircontext find manifest web application input stream inputstream input stream inputstream naming enumeration namingenumeration binding wne dir context dircontext list bindings listbindings meta inf binding binding wne next element nextelement binding get name getname to upper case touppercase locale english equals manifest resource resource resource dir context dircontext lookup meta inf binding get name getname input stream inputstream resource stream content streamcontent manifest manifest manifest input stream inputstream input stream inputstream close input stream inputstream manifest resource manifestresource mre manifest resource manifestresource get string getstring extension validator extensionvalidator web application manifest manifest manifest resource manifestresource war app manifest resources appmanifestresources add mre naming exception namingexception nex no such element exception nosuchelementexception nse input stream inputstream input stream inputstream close throwable exception utils exceptionutils handle throwable handlethrowable locate manifests bundle d bundled jar s jars naming enumeration namingenumeration binding error reporting string jar name jarname dir context dircontext list bindings listbindings web inf lib has more elements hasmoreelements binding binding next element nextelement jar name jarname binding get name getname jar name jarname to lower case tolowercase locale english ends with endswith jar object obj dir context dircontext lookup web inf lib jar name jarname obj resource directory named xxx jar ignore resource resource resource obj input stream inputstream resource stream content streamcontent manifest jmanifest get manifest getmanifest input stream inputstream jmanifest manifest resource manifestresource mre manifest resource manifestresource jar name jarname jmanifest manifest resource manifestresource application app manifest resources appmanifestresources add mre naming exception namingexception nex io exception ioexception ioe io exception ioexception jar jar name jarname ioe input stream inputstream input stream inputstream close throwable exception utils exceptionutils handle throwable handlethrowable validate manifest resources validatemanifestresources app name appname app manifest resources appmanifestresources checks system jar file manifest adds container manifest resources param jar file jarfile system jar manifest add add system resource addsystemresource file jar file jarfile io exception ioexception input stream inputstream file input stream fileinputstream jar file jarfile manifest manifest get manifest getmanifest manifest manifest resource manifestresource mre manifest resource manifestresource jar file jarfile get absolute path getabsolutepath manifest manifest resource manifestresource system container manifest resources containermanifestresources add mre close io exception ioexception methods valid ates validates code array list arraylist code code manifest resource manifestresource code objects method requires application context root application runtime code returned extension dependencies represented code manifest resource manifestresource code objects met method provide validation web application parameters param app name appname application error messages param resources list code manifest resource manifestresource code objects validated manifest resource file requirements met validate manifest resources validatemanifestresources string app name appname array list arraylist manifest resource manifestresource resources passes failure count failurecount array list arraylist extension available extensions availableextensions iterator manifest resource manifestresource resources iterator has next hasnext manifest resource manifestresource mre array list arraylist extension required list requiredlist mre get required extensions getrequiredextensions required list requiredlist build list extensions available extensions availableextensions available extensions availableextensions build available extensions list buildavailableextensionslist resources container available extensions containeravailableextensions container available extensions containeravailableextensions build available extensions list buildavailableextensionslist container manifest resources containermanifestresources iter ate iterate list required extensions iterator extension rit required list requiredlist iterator rit has next hasnext extension required ext requiredext rit check application extension available extensions availableextensions iterator extension ait available extensions availableextensions iterator ait has next hasnext extension target ext targetext ait target ext targetext is compatible with iscompatiblewith required ext requiredext required ext requiredext set fulfilled setfulfilled check container level list extension container available extensions containeravailableextensions iterator extension cit container available extensions containeravailableextensions iterator cit has next hasnext extension target ext targetext cit target ext targetext is compatible with iscompatiblewith required ext requiredext required ext requiredext set fulfilled setfulfilled failure log info get string getstring extension validator extensionvalidator extension error app name appname mre get resource name getresourcename required ext requiredext get extension name getextensionname passes failure count failurecount passes log info get string getstring extension validator extensionvalidator extension validation error app name appname failure count failurecount passes build list extensions build list time iter ate iterate list required extensions extensions code main fest resource mainfestresource code objects code hash map hashmap code returned dependency list processing pass key implementation version note list built dependency checked performance optimization param resources list code manifest resource manifestresource code objects hash map hashmap map extensions array list arraylist extension build available extensions list buildavailableextensionslist array list arraylist manifest resource manifestresource resources array list arraylist extension available list availablelist iterator manifest resource manifestresource resources iterator has next hasnext manifest resource manifestresource mre array list arraylist extension list mre get available extensions getavailableextensions list iterator extension values list iterator values has next hasnext extension ext values available list availablelist available list availablelist array list arraylist extension available list availablelist add ext available list availablelist add ext available list availablelist manifest jar file war file param in stream instream input stream war jar file war jar manifest manifest get manifest getmanifest input stream inputstream in stream instream io exception ioexception manifest manifest jar input stream jarinputstream jin jin jar input stream jarinputstream in stream instream manifest jin get manifest getmanifest jin close jin jin jin close throwable exception utils exceptionutils handle throwable handlethrowable manifest add jar s jars extension list add folder list addfolderlist string property files extensions directory string extensions dir extensionsdir system get property getproperty property extensions dir extensionsdir string tokenizer stringtokenizer extensions tok extensionstok string tokenizer stringtokenizer extensions dir extensionsdir file path separator pathseparator extensions tok extensionstok has more tokens hasmoretokens file target dir targetdir file extensions tok extensionstok next token nexttoken target dir targetdir is directory isdirectory file files target dir targetdir list files listfiles files files length files get name getname to lower case tolowercase locale english ends with endswith jar files is file isfile add system resource addsystemresource files io exception ioexception log error get string getstring extension validator extensionvalidator fail load failload files