licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat websocket java net uri java util arrays java util list javax servlet servlet context event servletcontextevent javax websocket client endpoint config clientendpointconfig javax websocket container provider containerprovider javax websocket deployment exception deploymentexception javax websocket endpoint config endpointconfig javax websocket on open onopen javax websocket session javax websocket web socket container websocketcontainer javax websocket server server container servercontainer javax websocket server server endpoint serverendpoint javax websocket server server endpoint config serverendpointconfig org junit org junit test org apache catalina context org apache catalina servlets default servlet defaultservlet org apache catalina startup tomcat org apache tomcat websocket tester message count client testermessagecountclient tester program matic endpoint testerprogrammaticendpoint org apache tomcat websocket server constants org apache tomcat websocket server ws context listener wscontextlistener test ws sub protocols testwssubprotocols web socket base test websocketbasetest test test ws sub protocols testwssubprotocols exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx add application listener addapplicationlistener config get name getname tomcat add servlet addservlet ctx default servlet defaultservlet ctx add servlet mapping addservletmapping tomcat start web socket container websocketcontainer ws container wscontainer container provider containerprovider get web socket container getwebsocketcontainer tomcat start session ws session wssession ws container wscontainer connect to server connecttoserver tester program matic endpoint testerprogrammaticendpoint client endpoint config clientendpointconfig builder create preferred sub protocols preferredsubprotocols arrays as list aslist build uri localhost get port getport sub protocols endpoint subprotocolsendpoint path basic assert true asserttrue ws session wssession is open isopen ws session wssession get negotiated sub protocol getnegotiatedsubprotocol assert true asserttrue ws session wssession get negotiated sub protocol getnegotiatedsubprotocol is empty isempty ws session wssession close sub protocols endpoint subprotocolsendpoint recycle ws session wssession ws container wscontainer connect to server connecttoserver tester program matic endpoint testerprogrammaticendpoint client endpoint config clientendpointconfig builder create preferred sub protocols preferredsubprotocols arrays as list aslist build uri localhost get port getport sub protocols endpoint subprotocolsendpoint path basic assert true asserttrue ws session wssession is open isopen assert equals assertequals ws session wssession get negotiated sub protocol getnegotiatedsubprotocol client thread move faster server wait upto sub protocols subprotocols count count sub protocols endpoint subprotocolsendpoint sub protocols subprotocols count thread sleep assert not null assertnotnull sub protocols endpoint subprotocolsendpoint sub protocols subprotocols assert array equals assertarrayequals string sub protocols endpoint subprotocolsendpoint sub protocols subprotocols to array toarray string ws session wssession close sub protocols endpoint subprotocolsendpoint recycle server endpoint serverendpoint echo sub protocols subprotocols sub protocols endpoint subprotocolsendpoint string path basic echo list string sub protocols subprotocols on open onopen process open processopen suppress warnings suppresswarnings unused session session endpoint config endpointconfig epc sub protocols subprotocols server endpoint config serverendpointconfig epc get sub protocols getsubprotocols recycle sub protocols subprotocols config ws context listener wscontextlistener override context initialized contextinitialized servlet context event servletcontextevent sce context initialized contextinitialized sce server container servercontainer server container servercontainer sce get servlet context getservletcontext get attribute getattribute constants server container servlet context attribute add endpoint addendpoint sub protocols endpoint subprotocolsendpoint deployment exception deploymentexception illegal state exception illegalstateexception