licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina realm java security principal java sql connection java sql prepared statement preparedstatement java sql result set resultset java sql sql exception sqlexception java util array list arraylist javax naming context javax sql data source datasource org apache catalina lifecycle exception lifecycleexception org apache naming context bindings contextbindings data source realm datasourcerealm realm base realmbase instance variables generated string roles prepared statement preparedstatement string prepared roles preparedroles generated string credentials prepared statement preparedstatement string prepared credentials preparedcredentials jndi jdbc data source datasource string data source name datasourcename descriptive realm implementation string info org apache catalina realm data source realm datasourcerealm context local datasource local data source localdatasource descriptive realm implementation string data source realm datasourcerealm column user role table names role string role name col rolenamecol column user table holds user credentials string user cred col usercredcol column user table holds user string user name col usernamecol table holds relation user roles string user role table userroletable table holds user data string user table usertable properties jndi jdbc data source datasource string get data source name getdatasourcename data source name datasourcename jndi jdbc data source datasource param data source name datasourcename jndi jdbc data source datasource set data source name setdatasourcename string data source name datasourcename data source name datasourcename data source name datasourcename datasource looked webapp jndi context get local data source getlocaldatasource local data source localdatasource datasource looked webapp jndi context param local data source localdatasource flag set local data source setlocaldatasource local data source localdatasource local data source localdatasource local data source localdatasource column user role table names role string get role name col getrolenamecol role name col rolenamecol column user role table names role param role name col rolenamecol column set role name col setrolenamecol string role name col rolenamecol role name col rolenamecol role name col rolenamecol column user table holds user credentials string get user cred col getusercredcol user cred col usercredcol column user table holds user credentials param user cred col usercredcol column set user cred col setusercredcol string user cred col usercredcol user cred col usercredcol user cred col usercredcol column user table holds user string get user name col getusernamecol user name col usernamecol column user table holds user param user name col usernamecol column set user name col setusernamecol string user name col usernamecol user name col usernamecol user name col usernamecol table holds relation user roles string get user role table getuserroletable user role table userroletable table holds relation user roles param user role table userroletable table set user role table setuserroletable string user role table userroletable user role table userroletable user role table userroletable table holds user data string get user table getusertable user table usertable table holds user data param user table usertable table set user table setusertable string user table usertable user table usertable user table usertable descriptive realm implementation version number format code description version code override string get info getinfo info methods principal username credentials code code errors jdbc connection executing query don authenticate event log ged logged connection closed subsequent request automatically open param username username principal param credentials password credentials auth enticating authenticating username override principal authenticate string username string credentials authenticate don bother database username credentials connection db connection dbconnection ensure open database connection db connection dbconnection open db connection dbconnection connection open fails authenticated acquire principal object user authenticate db connection dbconnection username credentials close db connection dbconnection methods methods principal username credentials code code param db connection dbconnection database connection param username username principal param credentials password credentials auth enticating authenticating username principal authenticate connection db connection dbconnection string username string credentials authenticate don bother database username credentials container log containerlog is trace enabled istraceenabled container log containerlog trace get string getstring data source realm datasourcerealm authenticate failure authenticatefailure username user credentials string db credentials dbcredentials get password getpassword db connection dbconnection username db credentials dbcredentials user database w ast e waste bit time reveal user exist compare credentials comparecredentials credentials get class getclass get name getname container log containerlog is trace enabled istraceenabled container log containerlog trace get string getstring data source realm datasourcerealm authenticate failure authenticatefailure username validate user credentials validated compare credentials comparecredentials credentials db credentials dbcredentials validated container log containerlog is trace enabled istraceenabled container log containerlog trace get string getstring data source realm datasourcerealm authenticate success authenticatesuccess username container log containerlog is trace enabled istraceenabled container log containerlog trace get string getstring data source realm datasourcerealm authenticate failure authenticatefailure username array list arraylist string list get roles getroles db connection dbconnection username create suitable principal user generic principal genericprincipal username credentials list close database connection param db connection dbconnection connection closed close connection db connection dbconnection database connection closed db connection dbconnection commit auto committed db connection dbconnection get auto commit getautocommit db connection dbconnection commit sql exception sqlexception container log containerlog error exception commit ting committing connection closing close database connection log errors db connection dbconnection close sql exception sqlexception container log containerlog error get string getstring data source realm datasourcerealm close open database connection connection database connection open context context local data source localdatasource context context bindings contextbindings get class loader getclassloader context context context lookup comp env context get server getserver get global naming context getglobalnamingcontext data source datasource data source datasource data source datasource context lookup data source name datasourcename data source datasource get connection getconnection exception container log containerlog error get string getstring data source realm datasourcerealm exception realm implementation override string get name getname password principal user override string get password getpassword string username connection db connection dbconnection ensure open database connection db connection dbconnection open db connection dbconnection get password getpassword db connection dbconnection username close db connection dbconnection password principal user param db connection dbconnection database connection param username username password retrieved string get password getpassword connection db connection dbconnection string username result set resultset prepared statement preparedstatement stmt string db credentials dbcredentials stmt credentials db connection dbconnection username stmt execute query executequery db credentials dbcredentials get string getstring db credentials dbcredentials db credentials dbcredentials trim sql exception sqlexception container log containerlog error get string getstring data source realm datasourcerealm get password getpassword exception username close stmt stmt close sql exception sqlexception container log containerlog error get string getstring data source realm datasourcerealm get password getpassword exception username principal user override principal get principal getprincipal string username connection db connection dbconnection open db connection dbconnection generic principal genericprincipal username generic principal genericprincipal username get password getpassword db connection dbconnection username get roles getroles db connection dbconnection username close db connection dbconnection roles user param username username roles retrieved array list arraylist string get roles getroles string username connection db connection dbconnection ensure open database connection db connection dbconnection open db connection dbconnection get roles getroles db connection dbconnection username close db connection dbconnection roles user param db connection dbconnection database connection param username username roles retrieved array list arraylist string get roles getroles connection db connection dbconnection string username all roles mode allrolesmode all roles mode allrolesmode strict mode is role store defined isrolestoredefined defined don spend cycles result set resultset prepared statement preparedstatement stmt array list arraylist string list stmt roles db connection dbconnection username stmt execute query executequery list array list arraylist string string role get string getstring role list add role trim list sql exception sqlexception container log containerlog error get string getstring data source realm datasourcerealm get roles getroles exception username close stmt stmt close sql exception sqlexception container log containerlog error get string getstring data source realm datasourcerealm get roles getroles exception username prepared statement preparedstatement configured perform select required retrieve user credentials username param db connection dbconnection database connection param username username credentials retrieved exception sql exception sqlexception database error occurs prepared statement preparedstatement credentials connection db connection dbconnection string username sql exception sqlexception prepared statement preparedstatement credentials db connection dbconnection prepare statement preparestatement prepared credentials preparedcredentials credentials set string setstring username credentials prepared statement preparedstatement configured perform select required retrieve user roles username param db connection dbconnection database connection param username username roles retrieved exception sql exception sqlexception database error occurs prepared statement preparedstatement roles connection db connection dbconnection string username sql exception sqlexception prepared statement preparedstatement roles db connection dbconnection prepare statement preparestatement prepared roles preparedroles roles set string setstring username roles is role store defined isrolestoredefined user role table userroletable role name col rolenamecol lifecycle methods prepare active methods component implement requirements link org apache catalina util lifecycle base lifecyclebase start internal startinternal exception lifecycle exception lifecycleexception component detects fatal error prevents component override start internal startinternal lifecycle exception lifecycleexception create roles prepared statement preparedstatement string string builder stringbuilder temp string builder stringbuilder select temp append role name col rolenamecol temp append temp append user role table userroletable temp append temp append user name col usernamecol temp append prepared roles preparedroles temp to string tostring create credentials prepared statement preparedstatement string temp string builder stringbuilder select temp append user cred col usercredcol temp append temp append user table usertable temp append temp append user name col usernamecol temp append prepared credentials preparedcredentials temp to string tostring start internal startinternal