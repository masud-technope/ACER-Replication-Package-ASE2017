licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina tribes group int erceptors interceptors java util concurrent atomic atomic boolean atomicboolean org apache catalina tribes channel org apache catalina tribes channel exception channelexception org apache catalina tribes channel interceptor channelinterceptor org apache catalina tribes channel message channelmessage org apache catalina tribes member org apache catalina tribes unique id uniqueid org apache catalina tribes group absolute order absoluteorder org apache catalina tribes group channel interceptor base channelinterceptorbase org apache catalina tribes group interceptor payload interceptorpayload org apache catalina tribes channel data channeldata org apache catalina tribes x byte buffer xbytebuffer org apache catalina tribes membership member impl memberimpl org apache catalina tribes membership membership org apache catalina tribes util arrays org apache catalina tribes util uuid generator uuidgenerator org apache juli logging log org apache juli logging log factory logfactory title auto merging leader election algorithm description implementation simple coordinator algorithm sel ects selects coordinator merges groups automatically members discovered were nt werent algorithm blocking meaning tra nsactions transactions coordination phase implementation based bre wed brewed algorithm absolute order absoluteorder membership pass token ring current membership absolute order absoluteorder scenario nodes net work network priority absolute order absoluteorder work nodes receiving pings nodes meaning node receives pings node node happen multicast problem occurs members members members members members tribes membership implementation rel ies relies multicast pack ets packets arrive nodes correctly guaranteeing exp lain explain algorithm works simplicity assume send operation nodes algorithm work messages over lap overlap depend absolute order scenario online time eval phase thinks leader thinks leader thinks leader leader token phase sends message ldr src mbrs message view sends message ldr src mbrs message view receives ldr src mbrs sends ldr src mbrs receives ldr src mbrs aware sends ldr src mbrs receives ldr src mbrs sends ldr src mbrs receives ldr src mbrs sends ldr src mbrs receives ldr src mbrs sends sends ldr src mbrs receives ldr src mbrs holds message add list members receives ldr src mbrs point ldr mbrs ldr mbrs ldr mbrs ldr mbrs ldr mbrs message doesn reaches original sender dropped higher leader thinks view id viewid correct point arrived membership nodes info rmed informed synchronize simply perform check receives original ldr src mbrs arrived ldr src mbrs condition res end resend token sends ldr src mbrs receives token complete option ally optionally send message ldr src mbrs confirmed install accept view assume arrives priority higher priority assume sees view waits token arrive token arrives scenario happen scenario sees token arrive sends ldr src mbrs receives ldr src mbrs sends ldr src mbrs receives ldr src mbrs sends sends ldr src mbrs chain continues receives token time option ally optionally sends ldr src mbrs confirmed ensure view implemented nodes time send view conf message confirmed message optional id eally ideally int erceptor interceptor tcp failure detector tcpfailuredetector ensure correct members hips memberships simplified finite state machine statemachine suck writing machines head confused day document algorithm diagram diagrams href http people apache org fhanik tribes docs leader election init iate initiate election jpg init iate initiate election href http people apache org fhanik tribes docs leader election message arrives jpg receive election message author filip hanik version non blocking coordinator nonblockingcoordinator channel interceptor base channelinterceptorbase log log log factory logfactory get log getlog non blocking coordinator nonblockingcoordinator header coordination message coord header coordination request coord request coordination confirmation blocking install ations installations coord conf alive message coord alive time wait coordination timeout wait for coord msg timeout waitforcoordmsgtimeout current view membership view current view id viewid unique id uniqueid view id viewid non blocking nonblocking membership membership membership running election running unique id uniqueid suggestedview id suggestedviewid membership suggested view suggestedview started starts vc startsvc xffff object election mutex electionmutex object atomic boolean atomicboolean coord msg received coordmsgreceived atomic boolean atomicboolean non blocking coordinator nonblockingcoordinator coord ination coordination handling start election startelection force channel exception channelexception election mutex electionmutex member impl memberimpl local member impl memberimpl get local member getlocalmember member impl memberimpl membership get members getmembers fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt start elect election init ated initated length view id viewid unique id uniqueid uuid generator uuidgenerator randomuuid view membership local absolute order absoluteorder comp handle view conf handleviewconf create election msg createelectionmsg local local local view member election suggestedview id suggestedviewid view arrays diff view suggested view suggestedview local length arrays diff suggested view suggestedview view local length suggestedview id suggestedviewid suggested view suggestedview fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt elect abandoned election abandoned running election matches view fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt elect abandoned election abandoned election running election running allowed view arrays diff view membership local length arrays diff membership view local length fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt elect abandoned election abandoned view matches membership view installed prio absolute order absoluteorder comp compare local leader view member impl memberimpl leader prio local local equals leader force coordination message coordinationmessage msg create election msg createelectionmsg local leader suggestedview id suggestedviewid msg get id getid suggested view suggestedview membership local absolute order absoluteorder comp arrays fill suggested view suggestedview msg get members getmembers fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt process elect election sending request send election msg sendelectionmsg local msg coord msg received coordmsgreceived fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt wait msg election waiting request election mutex electionmutex wait wait for coord msg timeout waitforcoordmsgtimeout interrupted exception interruptedexception thread int errupted interrupted suggestedview id suggestedviewid coord msg received coordmsgreceived message arrived send coord msg fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt wait msg election waiting time d timed start election startelection fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt elect abandoned election abandoned waiting time d timed fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt elect abandoned election abandoned received message coordination message coordinationmessage create election msg createelectionmsg member impl memberimpl local member impl memberimpl member impl memberimpl leader membership membership local absolute order absoluteorder comp arrays fill member impl memberimpl mbrs get members getmembers reset coordination message coordinationmessage msg coordination message coordinationmessage leader local mbrs unique id uniqueid uuid generator uuidgenerator randomuuid coord request msg send election msg sendelectionmsg member impl memberimpl local member impl memberimpl coordination message coordinationmessage msg channel exception channelexception fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt send msg sending election message get name getname send message sendmessage member create data createdata msg local send election msg to next inline sendelectionmsgtonextinline member impl memberimpl local coordination message coordinationmessage msg channel exception channelexception arrays next index nextindex local msg get members getmembers current msg leader msg get members getmembers current send election msg sendelectionmsg local msg get members getmembers current msg channel exception channelexception log warn unable send election message msg get members getmembers current current arrays next index nextindex msg get members getmembers current msg get members getmembers current member get next in line getnextinline member impl memberimpl local member impl memberimpl member impl memberimpl result length result channel data channeldata create data createdata coordination message coordinationmessage msg member impl memberimpl local msg write channel data channeldata data channel data channeldata data set address setaddress local data set message setmessage msg get buffer getbuffer data set options setoptions channel send options ack data set timestamp settimestamp system current time millis currenttimemillis data view change viewchange unique id uniqueid view id viewid member view invoke listeners alive member mbr tcp failure detector tcpfailuredetector member alive memberalive mbr coord alive wait for coord msg timeout waitforcoordmsgtimeout wait for coord msg timeout waitforcoordmsgtimeout get option flag getoptionflag membership merge on arrive mergeonarrive coordination message coordinationmessage msg member sender fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt pre merge pre merge member impl memberimpl local member impl memberimpl get local member getlocalmember membership merged membership local absolute order absoluteorder comp arrays fill merged msg get members getmembers arrays fill merged get members getmembers member diff arrays diff merged membership local diff length alive diff merged remove member removemember member impl memberimpl diff member added memberadded diff fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt post merge post merge merged process coord message processcoordmessage coordination message coordinationmessage msg member sender channel exception channelexception coord msg received coordmsgreceived coord msg received coordmsgreceived election mutex electionmutex election mutex electionmutex notify all notifyall msg timestamp system current time millis currenttimemillis membership merged merge on arrive mergeonarrive msg sender is view conf isviewconf msg handle view conf handleviewconf msg sender merged handle token handletoken msg sender merged handle token handletoken coordination message coordinationmessage msg member sender membership merged channel exception channelexception member impl memberimpl local member impl memberimpl get local member getlocalmember local equals msg get source getsource message msg src local handle my token handlemytoken local msg sender merged handle other token handleothertoken local msg sender merged handle my token handlemytoken member impl memberimpl local coordination message coordinationmessage msg member sender membership merged channel exception channelexception local equals msg get leader getleader leader ship leadership change arrays same members samemembers msg get members getmembers merged get members getmembers msg type coord conf send message sendmessage arrays remove msg get members getmembers local create data createdata msg local handle view conf handleviewconf msg local merged membership change suggested view suggestedview membership local absolute order absoluteorder comp suggestedview id suggestedviewid msg get id getid arrays fill suggested view suggestedview merged get members getmembers msg view merged get members getmembers send election msg to next inline sendelectionmsgtonextinline local msg leader ship leadership change suggested view suggestedview suggestedview id suggestedviewid msg view merged get members getmembers send election msg to next inline sendelectionmsgtonextinline local msg handle other token handleothertoken member impl memberimpl local coordination message coordinationmessage msg member sender membership merged channel exception channelexception local equals msg get leader getleader leader start election startelection msg view merged get members getmembers send election msg to next inline sendelectionmsgtonextinline local msg handle view conf handleviewconf coordination message coordinationmessage msg member sender membership merged channel exception channelexception view view id viewid msg get id getid equals view id viewid view membership member impl memberimpl get local member getlocalmember absolute order absoluteorder comp arrays fill view msg get members getmembers view id viewid msg get id getid view id viewid equals suggestedview id suggestedviewid suggested view suggestedview suggestedview id suggestedviewid suggested view suggestedview absolute order absoluteorder comp compare suggested view suggestedview get members getmembers merged get members getmembers suggested view suggestedview suggestedview id suggestedviewid view change viewchange view id viewid view get members getmembers fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt conf acc epted accepted view suggestedview id suggestedviewid has higher priority hashigherpriority merged get members getmembers membership get members getmembers start election startelection is view conf isviewconf coordination message coordinationmessage msg arrays msg get type gettype coord conf coord conf length has higher priority hashigherpriority member complete member local local local length complete complete length absolute order absoluteorder absolute order absoluteorder complete absolute order absoluteorder absolute order absoluteorder local absolute order absoluteorder comp compare complete local returns coordinator member member get coordinator getcoordinator view view has members hasmembers view get members getmembers member get view getview view view has members hasmembers view get members getmembers member unique id uniqueid get view id getviewid view id viewid block messages election halt release lock messages election completed release wait election wait for release waitforrelease overridden methods channel int erceptor interceptor base override start svc channel exception channelexception membership setup membership setupmembership started fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt start start start starts vc startsvc started view view membership member impl memberimpl get local member getlocalmember absolute order absoluteorder comp fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt start start start election startelection override svc channel exception channelexception halt election mutex electionmutex started started fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt starts vc startsvc view view id viewid suggested view suggestedview suggestedview id suggestedviewid membership reset fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt release override send message sendmessage member destination channel message channelmessage msg interceptor payload interceptorpayload payload channel exception channelexception wait for release waitforrelease send message sendmessage destination msg payload override message received messagereceived channel message channelmessage msg arrays msg get message getmessage get bytes direct getbytesdirect coord alive coord alive length ignore message alive message fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt msg arrive alive message arrays msg get message getmessage get bytes direct getbytesdirect coord header coord header length coordination message coordinationmessage cmsg coordination message coordinationmessage msg get message getmessage member cmbr cmsg get members getmembers fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt msg arrive coord msg arrived arrays to name string tonamestring cmbr process coord message processcoordmessage cmsg msg get address getaddress channel exception channelexception log error error processing coordination message fatal message received messagereceived msg override member added memberadded member member member added memberadded member member added memberadded member member elect membership setup membership setupmembership membership member alive memberalive member impl memberimpl member member added memberadded member fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt mbr add member add member get name getname started elect start election startelection channel exception channelexception log error unable start election member override member disappeared memberdisappeared member member membership remove member removemember member impl memberimpl member member disappeared memberdisappeared member fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt mbr del member remove member get name getname started is coordinator iscoordinator is highest ishighest member disappears coordinator start start election startelection channel exception channelexception log error unable start election member removed is highest ishighest member local get local member getlocalmember membership get members getmembers length absolute order absoluteorder comp compare local membership get members getmembers is coordinator iscoordinator member coord get coordinator getcoordinator coord get local member getlocalmember equals coord override heartbeat member impl memberimpl local member impl memberimpl get local member getlocalmember view arrays diff view membership local length arrays diff membership view local length is highest ishighest fire interceptor event fireinterceptorevent coordination event coordinationevent coordination event coordinationevent evt start elect heartbeat inc onsistency inconsistency restart election start election startelection exception log error unable perform heartbeat heartbeat members override has members hasmembers membership has members hasmembers current cluster members members empty array override member get members getmembers membership get members getmembers param mbr member member override member get member getmember member mbr membership get member getmember mbr member represents node member override member get local member getlocalmember inc alive incalive member local get local member getlocalmember inc alive incalive view local setup membership setupmembership local setup membership setupmembership membership membership membership member impl memberimpl get local member getlocalmember absolute order absoluteorder comp coordination message coordinationmessage ldr src mbrs x byte buffer xbytebuffer buf member impl memberimpl leader member impl memberimpl source member impl memberimpl view unique id uniqueid type deprecated unused removed tomcat deprecated timestamp system current time millis currenttimemillis coordination message coordinationmessage x byte buffer xbytebuffer buf buf buf parse coordination message coordinationmessage member impl memberimpl leader member impl memberimpl source member impl memberimpl view unique id uniqueid type buf x byte buffer xbytebuffer leader leader source source view view type type write get header getheader non blocking coordinator nonblockingcoordinator coord header member impl memberimpl get leader getleader leader parse leader member impl memberimpl get source getsource source parse source unique id uniqueid get id getid parse member impl memberimpl get members getmembers view parse view get type gettype type parse type x byte buffer xbytebuffer get buffer getbuffer buf parse header offset leader ldr len ldrlen x byte buffer xbytebuffer to int toint buf get bytes direct getbytesdirect offset offset ldr ldr len ldrlen system arraycopy buf get bytes direct getbytesdirect offset ldr ldr len ldrlen leader member impl memberimpl get member getmember ldr offset ldr len ldrlen source src len srclen x byte buffer xbytebuffer to int toint buf get bytes direct getbytesdirect offset offset src src len srclen system arraycopy buf get bytes direct getbytesdirect offset src src len srclen source member impl memberimpl get member getmember src offset src len srclen view mbr count mbrcount x byte buffer xbytebuffer to int toint buf get bytes direct getbytesdirect offset offset view member impl memberimpl mbr count mbrcount view length mbr len mbrlen x byte buffer xbytebuffer to int toint buf get bytes direct getbytesdirect offset offset mbr mbr len mbrlen system arraycopy buf get bytes direct getbytesdirect offset mbr mbr len mbrlen view member impl memberimpl get member getmember mbr offset mbr len mbrlen unique id uniqueid buf get bytes direct getbytesdirect offset offset type system arraycopy buf get bytes direct getbytesdirect offset type type length offset write buf reset header buf append coord header coord header length leader ldr leader get data getdata buf append ldr length buf append ldr ldr length ldr source src source get data getdata buf append src length buf append src src length src view buf append view length view length mbr view get data getdata buf append mbr length buf append mbr mbr length buf append get bytes getbytes get bytes getbytes length buf append type type length override fire interceptor event fireinterceptorevent interceptor event interceptorevent event event coordination event coordinationevent coordination event coordinationevent event type coordination event coordinationevent evt conf log info event coordination event coordinationevent interceptor event interceptorevent evt start evt mbr add evt mbr del evt start elect evt process elect evt msg arrive evt pre merge evt post merge evt wait msg evt send msg evt evt conf evt elect abandoned type channel interceptor channelinterceptor int erceptor interceptor member coord member mbrs string info membership view membership suggested view suggestedview coordination event coordinationevent type channel interceptor channelinterceptor int erceptor interceptor string info type type int erceptor interceptor int erceptor interceptor coord non blocking coordinator nonblockingcoordinator int erceptor interceptor get coordinator getcoordinator mbrs non blocking coordinator nonblockingcoordinator int erceptor interceptor membership get members getmembers info info view non blocking coordinator nonblockingcoordinator int erceptor interceptor view suggested view suggestedview non blocking coordinator nonblockingcoordinator int erceptor interceptor suggested view suggestedview override get event type geteventtype type override string get event type desc geteventtypedesc type evt start evt start info evt mbr add evt mbr add info evt mbr del evt mbr del info evt start elect evt start elect info evt process elect evt process elect info evt msg arrive evt msg arrive info evt pre merge evt pre merge info evt post merge evt post merge info evt wait msg evt wait msg info evt send msg evt send msg info evt evt info evt conf evt conf info evt elect abandoned evt elect abandoned info unknown override channel interceptor channelinterceptor get interceptor getinterceptor int erceptor interceptor override string to string tostring string builder stringbuilder buf string builder stringbuilder coordination event coordinationevent type buf append type append t local tlocal member local int erceptor interceptor get local member getlocalmember buf append local local get name getname append t coord tcoord buf append coord coord get name getname append t view tview buf append arrays to name string tonamestring view view get members getmembers append t suggested tsuggested view buf append arrays to name string tonamestring suggested view suggestedview suggested view suggestedview get members getmembers append t members tmembers buf append arrays to name string tonamestring mbrs append t info tinfo buf append info append buf to string tostring