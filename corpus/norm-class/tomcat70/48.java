licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina valves java io exception ioexception java security access controller accesscontroller java security privileged action privilegedaction javax servlet servlet exception servletexception javax servlet http http servlet response httpservletresponse org apache catalina container org apache catalina context org apache catalina engine org apache catalina globals org apache catalina host org apache catalina manager org apache catalina session org apache catalina store org apache catalina connector request org apache catalina connector response org apache catalina session persistent manager persistentmanager org apache tomcat util security privileged set tccl privilegedsettccl valve request session persistence intended sticky load balance rs balancers usage constraint work correctly requires persistent manager persistentmanager usage constraint work correctly assumes request exists session time author jean fred eric frederic clere persistent valve persistentvalve valve base valvebase saves couple calls get class loader getclassloader request high load calls hot spot minor profile r profiler class loader classloader class loader classloader persistent valve persistentvalve get class loader getclassloader cl bind required clbindrequired persistent valve persistentvalve instance variables descriptive implementation string info org apache catalina valves persistent valve persistentvalve properties descriptive valve implementation override string get info getinfo info override set container setcontainer container container set container setcontainer container container engine container host cl bind required clbindrequired cl bind required clbindrequired methods select child context process request based request uri matching context http error param request request processed param response response produced exception io exception ioexception input output error occurred exception servlet exception servletexception servlet error occurred override invoke request request response response io exception ioexception servlet exception servletexception select context request context context request get context getcontext context response send error senderror http servlet response httpservletresponse internal server error get string getstring standard host standardhost no context nocontext update session access time session string session id sessionid request get requested session id getrequestedsessionid manager manager context get manager getmanager session id sessionid manager persistent manager persistentmanager store store persistent manager persistentmanager manager get store getstore store session session session store load session id sessionid exception container get logger getlogger error deserialize error deserializeerror session session is valid isvalid is session stale issessionstale session system current time millis currenttimemillis container get logger getlogger is debug enabled isdebugenabled container get logger getlogger debug session swapped invalid expired session expire store remove session id sessionid session set manager setmanager manager session set id setid session id sessionid manager add session standard session standardsession session activate session access session end access endaccess container get logger getlogger is debug enabled isdebugenabled container get logger getlogger debug session id sessionid session id sessionid valve process request get next getnext invoke request response processing async don store session request is async isasync read session id sessionid response http session httpsession hsess hreq get session getsession session hsess hsess request get session internal getsessioninternal exception hsess string new session id newsessionid hsess new session id newsessionid hsess get id internal getidinternal container get logger getlogger is debug enabled isdebugenabled container get logger getlogger debug new session id newsessionid new session id newsessionid new session id newsessionid bind context store session remove manager manager persistent manager persistentmanager session session manager find session findsession new session id newsessionid store store persistent manager persistentmanager manager get store getstore store session session is valid isvalid is session stale issessionstale session system current time millis currenttimemillis store save session persistent manager persistentmanager manager remove super removesuper session session recycle container get logger getlogger is debug enabled isdebugenabled container get logger getlogger debug new session id newsessionid store store session session valid session to string tostring session is valid isvalid stale is session stale issessionstale session system current time millis currenttimemillis container get logger getlogger is debug enabled isdebugenabled container get logger getlogger debug new session id newsessionid manager manager unbind session idle longer expiration supplied time fixme belongs session is session stale issessionstale session session time now timenow session max inactive interval maxinactiveinterval session get max inactive interval getmaxinactiveinterval max inactive interval maxinactiveinterval truncate time idle timeidle time now timenow session get this accessed time getthisaccessedtime time idle timeidle max inactive interval maxinactiveinterval bind context context bind context current thread cl bind required clbindrequired context get loader getloader globals security enabled privileged action privilegedaction privileged set tccl privilegedsettccl context get loader getloader get class loader getclassloader access controller accesscontroller do privileged doprivileged thread current thread currentthread set context class loader setcontextclassloader context get loader getloader get class loader getclassloader unbind cl bind required clbindrequired globals security enabled privileged action privilegedaction privileged set tccl privilegedsettccl class loader classloader access controller accesscontroller do privileged doprivileged thread current thread currentthread set context class loader setcontextclassloader class loader classloader