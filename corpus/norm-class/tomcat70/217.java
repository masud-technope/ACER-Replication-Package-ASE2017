licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina session java external izable externalizable java io exception ioexception java not serializable exception notserializableexception java object input objectinput java object input stream objectinputstream java object output objectoutput java object output stream objectoutputstream java write aborted exception writeabortedexception java security principal java util array list arraylist java util hashtable java util concurrent concurrent hash map concurrenthashmap java util concurrent atomic atomic integer atomicinteger java util concurrent locks lock java util concurrent locks reentrant read write lock reentrantreadwritelock org apache catalina manager org apache catalina session listener sessionlistener org apache catalina catalina cluster catalinacluster org apache catalina cluster manager clustermanager org apache catalina cluster message clustermessage org apache catalina cluster session clustersession org apache catalina realm generic principal genericprincipal org apache catalina session manager base managerbase org apache catalina session standard manager standardmanager org apache catalina session standard session standardsession org apache catalina tribes replication stream replicationstream org apache catalina tribes tipis replicated map entry replicatedmapentry org apache tomcat util res string manager stringmanager standard session standardsession session track deltas request author filip hanik delta session deltasession standard session standardsession external izable externalizable cluster session clustersession replicated map entry replicatedmapentry org apache juli logging log log org apache juli logging log factory logfactory get log getlog delta session deltasession string manager string manager stringmanager string manager stringmanager get manager getmanager constants instance variables primary session expire expire inactivity receive session wire session message request server is primary session isprimarysession delta request action info delta request deltarequest delta request deltarequest time session replicated distributed exp iring expiring session last time replicated lasttimereplicated system current time millis currenttimemillis lock diff lock difflock reentrant read write lock reentrantreadwritelock write lock writelock version delta session deltasession construct session manager param manager manager session delta session deltasession manager manager manager reset delta request resetdeltarequest replicated map entry replicatedmapentry object changed replication locked override is dirty isdirty get delta request getdeltarequest get size getsize returns map extract diff get diff getdiff serialize entire object override is diff able isdiffable returns diff sets dirty map io exception ioexception override get diff getdiff io exception ioexception lock get delta request getdeltarequest serialize unlock class loader classloader get class loaders getclassloaders manager backup manager backupmanager backup manager backupmanager manager get class loaders getclassloaders manager cluster manager base clustermanagerbase cluster manager base clustermanagerbase manager get class loaders getclassloaders manager standard manager standardmanager standard manager standardmanager standard manager standardmanager manager cluster manager base clustermanagerbase get class loaders getclassloaders get container getcontainer manager manager base managerbase manager base managerbase manager base managerbase manager cluster manager base clustermanagerbase get class loaders getclassloaders get container getcontainer applies diff existing object param diff param offset param length io exception ioexception override apply diff applydiff diff offset length io exception ioexception class not found exception classnotfoundexception lock replication stream replicationstream stream cluster manager clustermanager get manager getmanager get replication stream getreplicationstream diff offset length class loader classloader context loader contextloader thread current thread currentthread get context class loader getcontextclassloader class loader classloader load ers loaders get class loaders getclassloaders load ers loaders load ers loaders length thread current thread currentthread set context class loader setcontextclassloader load ers loaders get delta request getdeltarequest read external readexternal stream get delta request getdeltarequest execute cluster manager clustermanager get manager getmanager is notify listeners on replication isnotifylistenersonreplication stream close thread current thread currentthread set context class loader setcontextclassloader context loader contextloader unlock resets current diff res ets resets dirty flag override reset diff resetdiff reset delta request resetdeltarequest lock serialization override lock diff lock difflock lock unlock serialization override unlock diff lock difflock unlock override set owner setowner object owner owner cluster manager clustermanager get manager getmanager cluster manager clustermanager cluster manager clustermanager owner set manager setmanager set valid setvalid set primary session setprimarysession access reset delta request resetdeltarequest end access endaccess returns replicate object accessed override is access rep licate isaccessreplicate repl delta repldelta system current time millis currenttimemillis get last time replicated getlasttimereplicated max inactive interval maxinactiveinterval repl delta repldelta max inactive interval maxinactiveinterval access existing object override access entry accessentry access set primary session setprimarysession end access endaccess session properties returns session primary session manager expire timeout override is primary session isprimarysession is primary session isprimarysession sets primary session param primary session primarysession flag override set primary session setprimarysession primary session primarysession is primary session isprimarysession primary session primarysession inherit doc inheritdoc override set id setid string notify set id setid notify reset delta request resetdeltarequest session identifier session param session identifier override set id setid string set id setid reset delta request resetdeltarequest override set max inactive interval setmaxinactiveinterval int erval interval set max inactive interval setmaxinactiveinterval int erval interval set max inactive interval setmaxinactiveinterval int erval interval add delta request adddeltarequest max inactive interval maxinactiveinterval int erval interval add delta request adddeltarequest delta request deltarequest lock delta request deltarequest set max inactive interval setmaxinactiveinterval int erval interval unlock code is new isnew code flag session param is new isnew code is new isnew code flag override set new setnew is new isnew set new setnew is new isnew set new setnew is new isnew add delta request adddeltarequest set new setnew is new isnew add delta request adddeltarequest delta request deltarequest lock delta request deltarequest set new setnew is new isnew unlock authenticated principal session code authenticator code cache authenticated principal avoid expensive code realm authenticate code calls request param principal principal code code override set principal setprincipal principal principal set principal setprincipal principal set principal setprincipal principal principal add delta request adddeltarequest lock set principal setprincipal principal add delta request adddeltarequest delta request deltarequest delta request deltarequest set principal setprincipal principal unlock authentication type authenticate cached principal param auth type authtype cached authentication type override set auth type setauthtype string auth type authtype set auth type setauthtype auth type authtype set auth type setauthtype string auth type authtype add delta request adddeltarequest lock set auth type setauthtype auth type authtype add delta request adddeltarequest delta request deltarequest delta request deltarequest set auth type setauthtype auth type authtype unlock code is valid isvalid code flag session override is valid isvalid is valid isvalid exp iring expiring activity check access count accesscount max inactive interval maxinactiveinterval time now timenow system current time millis currenttimemillis time idle timeidle access start time idle timeidle time now timenow last accessed time lastaccessedtime time idle timeidle time now timenow this accessed time thisaccessedtime is primary session isprimarysession time idle timeidle max inactive interval maxinactiveinterval expire time idle timeidle max inactive interval maxinactiveinterval session idle allowed primary session crashed requests coming memory leak expire is valid isvalid access register replication valve replicationvalve cross context crosscontext support override end access endaccess end access endaccess manager cluster manager base clustermanagerbase cluster manager base clustermanagerbase manager register session at replication valve registersessionatreplicationvalve session methods perform internal processing required invalid ate invalidate session triggering exception session expired param notify notify listeners demise session override expire notify expire notify expire notify notify cluster notifycluster is valid isvalid is valid isvalid check loc king locking is valid isvalid is valid isvalid manager string expired id expiredid get id internal getidinternal notify cluster notifycluster expired id expiredid manager delta manager deltamanager delta manager deltamanager dmanager delta manager deltamanager manager catalina cluster catalinacluster cluster dmanager get cluster getcluster cluster message clustermessage msg dmanager request completed requestcompleted expired id expiredid msg cluster send msg expire notify notify cluster notifycluster log is debug enabled isdebugenabled log debug get string getstring delta session deltasession not ifying notifying cluster manager clustermanager manager get name getname value of valueof is primary session isprimarysession expired id expiredid manager delta manager deltamanager delta manager deltamanager manager session expired sessionexpired expired id expiredid release object references initialize instance variables preparation reuse object override recycle lock recycle delta request deltarequest clear unlock string representation object override string to string tostring string builder stringbuilder string builder stringbuilder append delta session deltasession append append to string tostring override add session listener addsessionlistener session listener sessionlistener listener add session listener addsessionlistener listener add session listener addsessionlistener session listener sessionlistener listener add delta request adddeltarequest lock add session listener addsessionlistener listener add delta request adddeltarequest delta request deltarequest listener replicated session listener replicatedsessionlistener delta request deltarequest add session listener addsessionlistener listener unlock override remove session listener removesessionlistener session listener sessionlistener listener remove session listener removesessionlistener listener remove session listener removesessionlistener session listener sessionlistener listener add delta request adddeltarequest lock remove session listener removesessionlistener listener add delta request adddeltarequest delta request deltarequest listener replicated session listener replicatedsessionlistener delta request deltarequest remove session listener removesessionlistener listener unlock session methods override read external readexternal object input objectinput io exception ioexception class not found exception classnotfoundexception lock read object data readobjectdata unlock read serialized version contents session object object input stream req uiring requiring standard session standardsession serialized param stream object input stream read exception class not found exception classnotfoundexception unknown exception io exception ioexception input output error occurs override read object data readobjectdata object input stream objectinputstream stream class not found exception classnotfoundexception io exception ioexception read object readobject object input objectinput stream read object data readobjectdata object input objectinput stream class not found exception classnotfoundexception io exception ioexception read object readobject stream write serialized version contents session object object output stream req uiring requiring standard session standardsession serialized param stream object output stream write exception io exception ioexception input output error occurs override write object data writeobjectdata object output stream objectoutputstream stream io exception ioexception write object data writeobjectdata object output objectoutput stream write object data writeobjectdata object output objectoutput stream io exception ioexception write object writeobject stream reset delta request resetdeltarequest lock delta request deltarequest record all actions recordallactions manager cluster manager base clustermanagerbase cluster manager base clustermanagerbase manager is record all actions isrecordallactions delta request deltarequest delta request deltarequest get id internal getidinternal record all actions recordallactions delta request deltarequest reset delta request deltarequest set session id setsessionid get id internal getidinternal unlock delta request deltarequest get delta request getdeltarequest delta request deltarequest reset delta request resetdeltarequest delta request deltarequest http session httpsession properties http session httpsession methods remove object bound session session object bound method method executes object code http session binding listener httpsessionbindinglistener code container calls code value unbound valueunbound code object param object remove session param notify notify int erested interested listeners attribute removed exception illegal state exception illegalstateexception method called invalid ated invalidated session override remove attribute removeattribute string notify remove attribute removeattribute notify remove attribute removeattribute string notify add delta request adddeltarequest validate current is valid isvalid illegal state exception illegalstateexception get string getstring standard session standardsession remove attribute removeattribute ise remove attribute internal removeattributeinternal notify add delta request adddeltarequest bind object session object bound session object replaced method executes object code http session binding listener httpsessionbindinglistener code container calls code value bound valuebound code object param object bound param object bound exception illegal argument exception illegalargumentexception attempt add serializable object environment marked distributable exception illegal state exception illegalstateexception method called invalid ated invalidated session override set attribute setattribute string object set attribute setattribute set attribute setattribute string object notify add delta request adddeltarequest illegal argument exception illegalargumentexception get string getstring standard session standardsession set attribute setattribute name null namenull remove attribute removeattribute remove attribute removeattribute lock set attribute setattribute notify add delta request adddeltarequest delta request deltarequest exclude delta request deltarequest set attribute setattribute unlock http session httpsession methods read serialized version session object object input stream implementation note reference owning manager res tored restored method explicitly param stream input stream read exception class not found exception classnotfoundexception unknown exception io exception ioexception input output error occurs override read object readobject object input stream objectinputstream stream class not found exception classnotfoundexception io exception ioexception read object readobject object input objectinput stream read object readobject object input objectinput stream class not found exception classnotfoundexception io exception ioexception deserialize scalar instance variables manager auth type authtype creation time creationtime stream read object readobject long value longvalue last accessed time lastaccessedtime stream read object readobject long value longvalue max inactive interval maxinactiveinterval integer stream read object readobject int value intvalue is new isnew stream read object readobject boolean value booleanvalue is valid isvalid stream read object readobject boolean value booleanvalue this accessed time thisaccessedtime stream read object readobject long value longvalue version stream read object readobject long value longvalue has principal hasprincipal stream read boolean readboolean principal has principal hasprincipal principal serializable principal serializableprincipal read principal readprincipal stream set id setid string stream read object readobject string stream read object readobject log is debug enabled isdebugenabled log debug get string getstring delta session deltasession read session readsession deserialize attribute count attribute values attributes attributes concurrent hash map concurrenthashmap string object integer stream read object readobject int value intvalue is valid save isvalidsave is valid isvalid is valid isvalid string string stream read object readobject object stream read object readobject write aborted exception writeabortedexception wae wae get cause getcause not serializable exception notserializableexception wae web application stopped exclude attributes is valid isvalid is valid save isvalidsave session listeners integer stream read object readobject int value intvalue listeners listeners array list arraylist session listener sessionlistener session listener sessionlistener listener session listener sessionlistener stream read object readobject listeners add listener notes notes hashtable string object activate override write external writeexternal object output objectoutput java io exception ioexception lock write object writeobject unlock write serialized version session object object output stream implementation note owning manager stored serialized representation session calling code read object readobject code manager explicitly implementation note attribute serializable unbound session actions http session binding listener httpsessionbindinglistener attributes code distributable code property manager code code param stream output stream write exception io exception ioexception input output error occurs override write object writeobject object output stream objectoutputstream stream io exception ioexception write object writeobject object output objectoutput stream write object writeobject object output objectoutput stream io exception ioexception write scalar instance variables manager stream write object writeobject value of valueof creation time creationtime stream write object writeobject value of valueof last accessed time lastaccessedtime stream write object writeobject integer value of valueof max inactive interval maxinactiveinterval stream write object writeobject value of valueof is new isnew stream write object writeobject value of valueof is valid isvalid stream write object writeobject value of valueof this accessed time thisaccessedtime stream write object writeobject value of valueof version stream write boolean writeboolean get principal getprincipal get principal getprincipal serializable principal serializableprincipal write principal writeprincipal generic principal genericprincipal principal stream stream write object writeobject log is debug enabled isdebugenabled log debug get string getstring delta session deltasession write session writesession acc umulate accumulate names serializable serializable attributes string array list arraylist string save names savenames array list arraylist string array list arraylist object save values savevalues array list arraylist object length object attributes exclude is attribute distributable isattributedistributable save names savenames add save values savevalues add serialize attribute count serializable attributes save names savenames size stream write object writeobject integer value of valueof stream write object writeobject save names savenames stream write object writeobject save values savevalues not serializable exception notserializableexception log error get string getstring standard session standardsession not serializable notserializable save names savenames serializable listeners array list arraylist session listener sessionlistener save listeners savelisteners array list arraylist session listener sessionlistener session listener sessionlistener listener listeners listener replicated session listener replicatedsessionlistener save listeners savelisteners add listener stream write object writeobject integer value of valueof save listeners savelisteners size session listener sessionlistener listener save listeners savelisteners stream write object writeobject listener methods attribute check val idity validity object get attribute internal getattributeinternal string attributes remove attribute internal removeattributeinternal string notify add delta request adddeltarequest lock remove attribute collection object attributes remove attribute internal removeattributeinternal notify add delta request adddeltarequest delta request deltarequest exclude delta request deltarequest remove attribute removeattribute unlock override get last time replicated getlasttimereplicated last time replicated lasttimereplicated override get version getversion version override set last time replicated setlasttimereplicated last time replicated lasttimereplicated last time replicated lasttimereplicated last time replicated lasttimereplicated override set version setversion version version version set access count setaccesscount count access count accesscount activity check access count accesscount atomic integer atomicinteger access count accesscount access count accesscount count