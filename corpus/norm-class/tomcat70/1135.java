licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license websocket chat java io exception ioexception java util java util concurrent copy on write array set copyonwritearrayset java util concurrent atomic atomic integer atomicinteger javax websocket on close onclose javax websocket on error onerror javax websocket on message onmessage javax websocket on open onopen javax websocket session javax websocket server server endpoint serverendpoint org apache juli logging log org apache juli logging log factory logfactory util html filter htmlfilter server endpoint serverendpoint websocket chat chat annotation chatannotation log log log factory logfactory get log getlog chat annotation chatannotation string guest prefix guest atomic integer atomicinteger connection ids connectionids atomic integer atomicinteger chat annotation chatannotation connections copy on write array set copyonwritearrayset chat annotation chatannotation string nickname session session chat annotation chatannotation nickname guest prefix connection ids connectionids get and increment getandincrement on open onopen start session session session session connections add string message string format nickname joined broadcast message on close onclose connections remove string message string format nickname disconnected broadcast message on message onmessage incoming string message trust client string filtered message filteredmessage string format nickname html filter htmlfilter filter message to string tostring broadcast filtered message filteredmessage on error onerror on error onerror throwable throwable log error chat error to string tostring broadcast string msg chat annotation chatannotation client connections client client session get basic remote getbasicremote send text sendtext msg io exception ioexception log debug chat error failed send message client connections remove client client session close io exception ioexception string message string format client nickname disconnected broadcast message