licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina users java file java file output stream fileoutputstream java io exception ioexception java input stream inputstream java output stream writer outputstreamwriter java print writer printwriter java util hash map hashmap java util iterator org apache catalina globals org apache catalina group org apache catalina role org apache catalina user org apache catalina user database userdatabase org apache juli logging log org apache juli logging log factory logfactory org apache tomcat util digester abstract object creation factory abstractobjectcreationfactory org apache tomcat util digester digester org apache tomcat util file config file loader configfileloader org apache tomcat util res string manager stringmanager org xml sax attributes concrete implementation link user database userdatabase loads defined users groups roles memory data structure xml file persistent storage author craig mc clanahan mcclanahan memory user database memoryuserdatabase user database userdatabase log log log factory logfactory get log getlog memory user database memoryuserdatabase create instance values memory user database memoryuserdatabase create instance values param unique global identifier user database memory user database memoryuserdatabase string instance variables link group defined database keyed group hash map hashmap string group groups hash map hashmap string group unique global identifier user database string relative code catalina base code absolute pathname xml file save persistent string pathname conf tomcat users xml relative absolute pathname file stored renaming progress string pathname old pathnameold pathname relative absolute pathname file write prior renaming string pathname new pathnamenew pathname flag indicating user database read read only readonly link role defined database keyed role hash map hashmap string role roles hash map hashmap string role string manager string manager stringmanager string manager stringmanager get manager getmanager constants link user defined database keyed user hash map hashmap string user users hash map hashmap string user properties link group defined user database override iterator group get groups getgroups groups groups values iterator unique global identifier user database override string get id getid relative absolute pathname persistent storage file string get path name getpathname pathname relative absolute pathname persistent storage file param pathname pathname set path name setpathname string pathname pathname pathname pathname old pathnameold pathname pathname new pathnamenew pathname returning read only readonly status user database get readonly getreadonly read only readonly setting read only readonly status user database param read only readonly status set readonly setreadonly read only readonly read only readonly read only readonly link role defined user database override iterator role get roles getroles roles roles values iterator link user defined user database override iterator user get use rs getusers users users values iterator methods finalize access user database exception exception exception thrown closing override close exception save groups users users clear groups clear create link group defined user database param groupname group group unique param description description group override group create group creategroup string groupname string description groupname groupname length string msg get string getstring memory user database memoryuserdatabase null group nullgroup log warn msg illegal argument exception illegalargumentexception msg memory group memorygroup group memory group memorygroup groupname description groups groups group get group name getgroupname group group create link role defined user database param rolename role group unique param description description group override role create role createrole string rolename string description rolename rolename length string msg get string getstring memory user database memoryuserdatabase null role nullrole log warn msg illegal argument exception illegalargumentexception msg memory role memoryrole role memory role memoryrole rolename description roles roles role get role name getrolename role role create link user defined user database param username log on logon username user unique param password log on logon password user param full name fullname full user override user create user createuser string username string password string full name fullname username username length string msg get string getstring memory user database memoryuserdatabase null user nulluser log warn msg illegal argument exception illegalargumentexception msg memory user memoryuser user memory user memoryuser username password full name fullname users users user get username getusername user user link group group code code param groupname group override group find group findgroup string groupname groups groups groupname link role role code code param rolename role override role find role findrole string rolename roles roles rolename link user user code code param username user override user find user finduser string username users users username initialize access user database exception exception exception thrown opening override open exception groups users erase previous groups users users clear groups clear roles clear string path name pathname get path name getpathname input stream inputstream config file loader configfileloader get input stream getinputstream path name pathname construct digester read xml input file digester digester digester digester set feature setfeature http apache org xml features java encodings exception log warn get string getstring memory user database memoryuserdatabase xml feature encoding xmlfeatureencoding digester add factory create addfactorycreate tomcat users group memory group creation factory memorygroupcreationfactory digester add factory create addfactorycreate tomcat users role memory role creation factory memoryrolecreationfactory digester add factory create addfactorycreate tomcat users user memory user creation factory memoryusercreationfactory parse xml input load database digester parse io exception ioexception ioe log error get string getstring memory user database memoryuserdatabase file not found filenotfound path name pathname close io exception ioexception ioe remove link group user database param group group removed override remove group removegroup group group groups iterator user users get use rs getusers users has next hasnext user user users user remove group removegroup group groups remove group get group name getgroupname remove link role user database param role role removed override remove role removerole role role roles iterator group groups get groups getgroups groups has next hasnext group group groups group remove role removerole role iterator user users get use rs getusers users has next hasnext user user users user remove role removerole role roles remove role get role name getrolename remove link user user database param user user removed override remove user removeuser user user users users remove user get username getusername check permissions save user database persistent storage location is write able iswriteable file file file pathname file is absolute isabsolute file file system get property getproperty globals catalina base prop pathname file dir file get parent file getparentfile dir exists dir is directory isdirectory dir can write canwrite save updated persistent storage location user database exception exception exception thrown saving override save exception get readonly getreadonly log error get string getstring memory user database memoryuserdatabase read only readonly is write able iswriteable log warn get string getstring memory user database memoryuserdatabase not per sistable notpersistable write contents temporary file file file new filenew file pathname new pathnamenew file new filenew is absolute isabsolute file new filenew file system get property getproperty globals catalina base prop pathname new pathnamenew print writer printwriter writer configure print writer printwriter file output stream fileoutputstream fos file output stream fileoutputstream file new filenew output stream writer outputstreamwriter osw output stream writer outputstreamwriter fos utf writer print writer printwriter osw print file prolog writer println xml version encoding utf writer println tomcat users print entries defined role group user iterator values values get roles getroles values has next hasnext writer print writer println values values get groups getgroups values has next hasnext writer print writer println values values get use rs getusers values has next hasnext writer print writer println memory user memoryuser values to xml toxml print file epilog writer println tomcat users check errors occurred printin g printing writer check error checkerror writer close file new filenew delete io exception ioexception get string getstring memory user database memoryuserdatabase write exception writeexception file new filenew get absolute path getabsolutepath writer close io exception ioexception writer writer close file new filenew delete perform required renames per manently permanently save file file file old fileold file pathname old pathnameold file old fileold is absolute isabsolute file old fileold file system get property getproperty globals catalina base prop pathname old pathnameold file old fileold delete file file orig fileorig file pathname file orig fileorig is absolute isabsolute file orig fileorig file system get property getproperty globals catalina base prop pathname file orig fileorig exists file old fileold delete file orig fileorig rename to renameto file old fileold io exception ioexception get string getstring memory user database memoryuserdatabase rename old renameold file old fileold get absolute path getabsolutepath file new filenew rename to renameto file orig fileorig file old fileold exists file old fileold rename to renameto file orig fileorig io exception ioexception get string getstring memory user database memoryuserdatabase rename new renamenew file orig fileorig get absolute path getabsolutepath file old fileold delete string representation user database userdatabase override string to string tostring string builder stringbuilder string builder stringbuilder memory user database memoryuserdatabase append append pathname append pathname append group count groupcount append groups size append role count rolecount append roles size append user count usercount append users size append to string tostring methods code string manager stringmanager code messages string manager stringmanager get string manager getstringmanager digester object creation factory group instances memory group creation factory memorygroupcreationfactory abstract object creation factory abstractobjectcreationfactory memory group creation factory memorygroupcreationfactory memory user database memoryuserdatabase database database database override object create object createobject attributes attributes string groupname attributes get value getvalue groupname groupname groupname attributes get value getvalue string description attributes get value getvalue description string roles attributes get value getvalue roles group group database create group creategroup groupname description roles roles length string rolename comma roles index of indexof comma rolename roles substring comma trim roles roles substring comma rolename roles trim roles rolename length role role database find role findrole rolename role role database create role createrole rolename group add role addrole role group memory user database memoryuserdatabase database digester object creation factory role instances memory role creation factory memoryrolecreationfactory abstract object creation factory abstractobjectcreationfactory memory role creation factory memoryrolecreationfactory memory user database memoryuserdatabase database database database override object create object createobject attributes attributes string rolename attributes get value getvalue rolename rolename rolename attributes get value getvalue string description attributes get value getvalue description role role database create role createrole rolename description role memory user database memoryuserdatabase database digester object creation factory user instances memory user creation factory memoryusercreationfactory abstract object creation factory abstractobjectcreationfactory memory user creation factory memoryusercreationfactory memory user database memoryuserdatabase database database database override object create object createobject attributes attributes string username attributes get value getvalue username username username attributes get value getvalue string password attributes get value getvalue password string full name fullname attributes get value getvalue full name fullname full name fullname full name fullname attributes get value getvalue full name fullname string groups attributes get value getvalue groups string roles attributes get value getvalue roles user user database create user createuser username password full name fullname groups groups length string groupname comma groups index of indexof comma groupname groups substring comma trim groups groups substring comma groupname groups trim groups groupname length group group database find group findgroup groupname group group database create group creategroup groupname user add group addgroup group roles roles length string rolename comma roles index of indexof comma rolename roles substring comma trim roles roles substring comma rolename roles trim roles rolename length role role database find role findrole rolename role role database create role createrole rolename user add role addrole role user memory user database memoryuserdatabase database