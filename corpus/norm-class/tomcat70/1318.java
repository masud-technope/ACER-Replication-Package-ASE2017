licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat jdbc pool java sql sql exception sqlexception java sql statement java util hash map hashmap java util properties java util concurrent atomic atomic boolean atomicboolean java util concurrent locks reentrant read write lock reentrantreadwritelock org apache juli logging log org apache juli logging log factory logfactory org apache tomcat jdbc pool int erceptor interceptor connection state connectionstate represents pooled connection holds reference link java sql connection object author filip hanik version pooled connection pooledconnection logger log log log factory logfactory get log getlog pooled connection pooledconnection string prop user pool utilities poolutilities prop user string prop password pool utilities poolutilities prop password validate connection borrowed flag validate borrow validate connection returned flag validate validate connection idle flag validate idle validate connection initialized flag validate init properties connection pool pool configuration poolconfiguration pool properties poolproperties underlying database connection java sql connection connection xa connection xaconnection javax sql xa connection xaconnection xa connection xaconnection track abandon traces string holds thread dump string abandon trace abandontrace timestamp connection touched pool timestamp lock connection reentrant read write lock reentrantreadwritelock lock reentrant read write lock reentrantreadwritelock connection discarded pool discarded timestamp time connect method called last connected lastconnected timestamp track validation int ervals intervals last valid ated lastvalidated system current time millis currenttimemillis parent connection pool connectionpool parent hash map hashmap object object attributes hash map hashmap object object connection version connectionversion weak reference cache list int erceptors interceptors connection don create list int erceptors interceptors time borrow connection jdbc interceptor jdbcinterceptor handler atomic boolean atomicboolean released atomic boolean atomicboolean suspect java sql driver driver constructor param prop pool properties param parent parent connection pool pooled connection pooledconnection pool configuration poolconfiguration prop connection pool connectionpool parent pool properties poolproperties prop parent parent connection version connectionversion parent get pool version getpoolversion get connection version getconnectionversion connection version connectionversion check user checkuser string username string password get pool properties getpoolproperties is alternate username allowed isalternateusernameallowed username username pool properties poolproperties get username getusername password password pool properties poolproperties get password getpassword string stored usr storedusr string get attributes getattributes prop user string stored pwd storedpwd string get attributes getattributes prop password result username stored usr storedusr result result username username equals stored usr storedusr result result password stored pwd storedpwd password password equals stored pwd storedpwd username get attributes getattributes remove prop user get attributes getattributes prop user username password get attributes getattributes remove prop password get attributes getattributes prop password password result connects underlying connection database sql exception sqlexception method link release called sql exception sqlexception driver instantiation fails sql exception sqlexception call link java sql driver connect string java util properties fails sql exception sqlexception properties configured call link java sql connection set auto commit setautocommit link java sql connection set catalog setcatalog string link java sql connection set transaction isolation settransactionisolation link java sql connection set read only setreadonly fails connect sql exception sqlexception released sql exception sqlexception connection released reestablished connection disconnect exception log debug unable disconnect previous connection pool properties poolproperties get data source getdatasource pool properties poolproperties getdatasourcejndi todo lookup jndi pool properties poolproperties get data source getdatasource connect using data source connectusingdatasource connect using driver connectusingdriver expect int erceptor interceptor pool properties poolproperties get jdbc int erceptors getjdbcinterceptors pool properties poolproperties get jdbc int erceptors getjdbcinterceptors index of indexof connection state connectionstate get name getname pool properties poolproperties get jdbc int erceptors getjdbcinterceptors index of indexof connection state connectionstate get simple name getsimplename pool properties poolproperties get default transaction isolation getdefaulttransactionisolation data source factory datasourcefactory unknown transactionisolation connection set transaction isolation settransactionisolation pool properties poolproperties get default transaction isolation getdefaulttransactionisolation pool properties poolproperties get default read only getdefaultreadonly connection set read only setreadonly pool properties poolproperties get default read only getdefaultreadonly boolean value booleanvalue pool properties poolproperties get default auto commit getdefaultautocommit connection set auto commit setautocommit pool properties poolproperties get default auto commit getdefaultautocommit boolean value booleanvalue pool properties poolproperties get default catalog getdefaultcatalog connection set catalog setcatalog pool properties poolproperties get default catalog getdefaultcatalog discarded last connected lastconnected system current time millis currenttimemillis connect using data source connectusingdatasource sql exception sqlexception string usr string pwd get attributes getattributes contains key containskey prop user usr string get attributes getattributes prop user usr pool properties poolproperties get username getusername get attributes getattributes prop user usr get attributes getattributes contains key containskey prop password pwd string get attributes getattributes prop password pwd pool properties poolproperties get password getpassword get attributes getattributes prop password pwd pool properties poolproperties get data source getdatasource javax sql xa data source xadatasource javax sql xa data source xadatasource xds javax sql xa data source xadatasource pool properties poolproperties get data source getdatasource usr pwd xa connection xaconnection xds getxaconnection usr pwd connection xa connection xaconnection get connection getconnection xa connection xaconnection xds getxaconnection connection xa connection xaconnection get connection getconnection pool properties poolproperties get data source getdatasource javax sql data source datasource javax sql data source datasource javax sql data source datasource pool properties poolproperties get data source getdatasource usr pwd connection get connection getconnection usr pwd connection get connection getconnection pool properties poolproperties get data source getdatasource javax sql connection pool data source connectionpooldatasource javax sql connection pool data source connectionpooldatasource javax sql connection pool data source connectionpooldatasource pool properties poolproperties get data source getdatasource usr pwd connection get pooled connection getpooledconnection usr pwd get connection getconnection connection get pooled connection getpooledconnection get connection getconnection sql exception sqlexception data source datasource unknown pool properties poolproperties get data source getdatasource pool properties poolproperties get data source getdatasource get class getclass connect using driver connectusingdriver sql exception sqlexception driver log is debug enabled isdebugenabled log debug ins tantiating instantiating driver pool properties poolproperties get driver class name getdriverclassname url pool properties poolproperties get url geturl driver java sql driver for name forname pool properties poolproperties get driver class name getdriverclassname pooled connection pooledconnection get class loader getclassloader new instance newinstance java lang exception log is debug enabled isdebugenabled log debug unable instantiate jdbc driver sql exception sqlexception sql exception sqlexception get message getmessage init cause initcause string driverurl pool properties poolproperties get url geturl string usr string pwd get attributes getattributes contains key containskey prop user usr string get attributes getattributes prop user usr pool properties poolproperties get username getusername get attributes getattributes prop user usr get attributes getattributes contains key containskey prop password pwd string get attributes getattributes prop password pwd pool properties poolproperties get password getpassword get attributes getattributes prop password pwd properties properties pool utilities poolutilities clone pool properties poolproperties get db properties getdbproperties usr properties set property setproperty prop user usr pwd properties set property setproperty prop password pwd connection driver connect driverurl properties exception log is debug enabled isdebugenabled log debug unable connect database parent jmx pool jmxpool parent jmx pool jmxpool notify org apache tomcat jdbc pool jmx connection pool connectionpool notify connect connection pool connectionpool get stack trace getstacktrace sql exception sqlexception sql exception sqlexception sql exception sqlexception sql exception sqlexception get message getmessage init cause initcause connection sql exception sqlexception driver driver returned url driverurl connect called disconnect called is initialized isinitialized connection issues call link disconnect argument call link connect sql exception sqlexception call link connect fails reconnect sql exception sqlexception disconnect connect reconnect disconnects connection exceptions log ged logged debug level param finalize call link connection pool connectionpool finalize pooled connection pooledconnection called disconnect finalize is discarded isdiscarded connection set discarded setdiscarded connection parent disconnect event disconnectevent finalize xa connection xaconnection connection close xa connection xaconnection close exception ignore log is debug enabled isdebugenabled log debug unable close underlying sql connection ignore connection xa connection xaconnection last connected lastconnected finalize parent finalize returns abandon timeout milliseconds abandon timeout milliseconds get abandon timeout getabandontimeout pool properties poolproperties get remove abandoned timeout getremoveabandonedtimeout max pool properties poolproperties get remove abandoned timeout getremoveabandonedtimeout returns connection pool configured validation action param action do validate dovalidate action action pooled connection pooledconnection validate borrow pool properties poolproperties is test on borrow istestonborrow action pooled connection pooledconnection validate pool properties poolproperties is test on return istestonreturn action pooled connection pooledconnection validate idle pool properties poolproperties is test while idle istestwhileidle action pooled connection pooledconnection validate init pool properties poolproperties is test on connect istestonconnect action pooled connection pooledconnection validate init pool properties poolproperties getinitsql returns object valid pool call get expired action getexpiredaction follow expired methods validate validate action validateaction validate validate action validateaction valid ates validates connection param validate action validateaction action link validate borrow link validate idle link validate init link validate param sql sql validation link pool configuration poolconfiguration setinitsql string called action link validate init init sql validation connection validated returns validation performed link pool configuration poolconfiguration set validation interval setvalidationinterval called positive validation failed caller close connection returned session left unknown initialization validate validate action validateaction string sql is discarded isdiscarded do validate dovalidate validate action validateaction validation required init sql props don bother valid ating validating system current time millis currenttimemillis validate action validateaction validate init pool properties poolproperties get validation interval getvalidationinterval last valid ated lastvalidated pool properties poolproperties get validation interval getvalidationinterval pool properties poolproperties get validator getvalidator pool properties poolproperties get validator getvalidator validate connection validate action validateaction last valid ated lastvalidated get pool properties getpoolproperties get log validation errors getlogvalidationerrors log error custom validation pool properties poolproperties get validator getvalidator failed string query sql validate action validateaction validate init pool properties poolproperties getinitsql query pool properties poolproperties getinitsql query query pool properties poolproperties get validation query getvalidationquery statement stmt stmt connection create statement createstatement validation query timeout validationquerytimeout pool properties poolproperties get validation query timeout getvalidationquerytimeout validation query timeout validationquerytimeout stmt set query timeout setquerytimeout validation query timeout validationquerytimeout stmt execute query stmt close last valid ated lastvalidated exception get pool properties getpoolproperties get log validation errors getlogvalidationerrors log warn sql validation error log is debug enabled isdebugenabled log debug unable validate object stmt stmt close exception ignore validate time limit object remain unused released link pool configuration poolconfiguration get min evictable idle time millis getminevictableidletimemillis get release time getreleasetime pool properties poolproperties get min evictable idle time millis getminevictableidletimemillis method called time checked in timecheckedin get release time getreleasetime method disconnects connection logs error debug mode sets link released flag attempts connect cached object fail link connect connection pool atomic decrement pool size counter time method called method called release disconnect exception log is debug enabled isdebugenabled log debug unable close sql connection released compare and set compareandset pool stack trace check checked param trace stack trace connection set stack trace setstacktrace string trace abandon trace abandontrace trace returns stack trace connection borrowed stack trace stack trace trace string get stack trace getstacktrace abandon trace abandontrace sets timestamp connection timestamp operation performed param timestamp timestamp defined link system current time millis currenttimemillis set timestamp settimestamp timestamp timestamp timestamp set suspect setsuspect is suspect issuspect suspect set suspect setsuspect suspect suspect suspect int erceptor interceptor call method connection closed returned pool param discarded valid illegal state exception illegalstateexception method called set discarded setdiscarded discarded discarded discarded illegal state exception illegalstateexception unable change connection discarded discarded discarded timestamp connection validated flag track link pool configuration poolconfiguration set validation interval setvalidationinterval validation int erval interval param last valid ated lastvalidated timestamp defined link system current time millis currenttimemillis set last valid ated setlastvalidated last valid ated lastvalidated last valid ated lastvalidated last valid ated lastvalidated sets pool configuration connection connection pool object shared link connection pool connectionpool param pool properties poolproperties set pool properties setpoolproperties pool configuration poolconfiguration pool properties poolproperties pool properties poolproperties pool properties poolproperties times tamps timestamps pool action time stamps timestamps typically connections borrowed pool track link pool configuration poolconfiguration set remove abandoned timeout setremoveabandonedtimeout abandon time outs timeouts timestamp reset link org apache tomcat jdbc pool int erceptor interceptor reset abandoned timer resetabandonedtimer invoke object java lang reflect method object timestamp pool action defined link system current time millis currenttimemillis get timestamp gettimestamp timestamp returns discarded flag discarded flag link disconnect called called connection returned pool is discarded isdiscarded discarded returns timestamp successful validation query execution timestamp successful validation query execution defined link system current time millis currenttimemillis get last valid ated getlastvalidated last valid ated lastvalidated returns configuration connection pool configuration connection pool pool configuration poolconfiguration get pool properties getpoolproperties pool properties poolproperties locks connection link pool configuration poolconfiguration is pool sweeper enabled ispoolsweeperenabled link pool configuration poolconfiguration get use lock getuselock connection lock ensures thread safety multiple threads performing operations connection noop performance lock pool properties poolproperties get use lock getuselock pool properties poolproperties is pool sweeper enabled ispoolsweeperenabled optimized lock concurrency lock write lock writelock lock unlocks connection sweeper enabled noop performance unlock pool properties poolproperties get use lock getuselock pool properties poolproperties is pool sweeper enabled ispoolsweeperenabled optimized lock concurrency lock write lock writelock unlock returns underlying connection underlying jdbc connection returned jdbc driver javax sql pooled connection pooledconnection get connection getconnection java sql connection get connection getconnection connection returns underlying connection underlying connection returned data source datasource javax sql xa connection xaconnection getxaconnection xa connection xaconnection returns timestamp connection connected database successful call link java sql driver connect string java util properties timestamp connection created defined link system current time millis currenttimemillis get last connected getlastconnected last connected lastconnected returns handler int erceptor interceptor chain int erceptor interceptor connection jdbc interceptor jdbcinterceptor get handler gethandler handler set handler sethandler jdbc interceptor jdbcinterceptor handler handler handler handler jdbc interceptor jdbcinterceptor int erceptor interceptor handler int erceptor interceptor int erceptor interceptor reset int erceptor interceptor int erceptor interceptor get next getnext handler handler override string to string tostring pooled connection pooledconnection connection connection to string tostring returns connection released won t wont reused method link release called is released isreleased released hash map hashmap object object get attributes getattributes attributes