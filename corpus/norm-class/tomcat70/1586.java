licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat websocket java file java net uri java net url java util queue java util concurrent count down latch countdownlatch java util concurrent time unit timeunit javax websocket client endpoint config clientendpointconfig javax websocket container provider containerprovider javax websocket message handler messagehandler javax websocket session javax websocket web socket container websocketcontainer org junit org junit assume org junit test org apache catalina context org apache catalina servlets default servlet defaultservlet org apache catalina startup tomcat org apache tomcat util net tester support testersupport org apache tomcat websocket tester message count client testermessagecountclient basic text basictext org apache tomcat websocket tester message count client testermessagecountclient sleeping text sleepingtext org apache tomcat websocket tester message count client testermessagecountclient tester program matic endpoint testerprogrammaticendpoint test web socket frame client l testwebsocketframeclientssl web socket base test websocketbasetest test test connect to server endpoint l testconnecttoserverendpointssl exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx add application listener addapplicationlistener tester firehose server testerfirehoseserver config get name getname tomcat add servlet addservlet ctx default servlet defaultservlet ctx add servlet mapping addservletmapping tester support testersupport init ssl initssl tomcat tomcat start web socket container websocketcontainer ws container wscontainer container provider containerprovider get web socket container getwebsocketcontainer client endpoint config clientendpointconfig client endpoint config clientendpointconfig client endpoint config clientendpointconfig builder create build url truststore url truststoreurl get class getclass get class loader getclassloader get resource getresource org apache tomcat util net jks file truststore file truststorefile file truststore url truststoreurl touri client endpoint config clientendpointconfig get user properties getuserproperties ws web socket container wswebsocketcontainer ssl truststore property truststore file truststorefile get absolute path getabsolutepath session ws session wssession ws container wscontainer connect to server connecttoserver tester program matic endpoint testerprogrammaticendpoint client endpoint config clientendpointconfig uri wss localhost get port getport tester firehose server testerfirehoseserver config path count down latch countdownlatch latch count down latch countdownlatch tester firehose server testerfirehoseserver message count basic text basictext handler basic text basictext latch ws session wssession add message handler addmessagehandler handler ws session wssession get basic remote getbasicremote send text sendtext system println message waiting data ignore latch result message count test number messages arr ived arrived handler get latch getlatch await tester firehose server testerfirehoseserver wait time millis time unit timeunit milliseconds queue string messages handler get messages getmessages assert equals assertequals tester firehose server testerfirehoseserver message count messages size string message messages assert equals assertequals tester firehose server testerfirehoseserver message message test test bug testbug exception todo investigate options test pass http bio connector assume assume false assumefalse skip test bio todo investigate options pass http bio connector get tomcat instance gettomcatinstance get connector getconnector get protocol handler class name getprotocolhandlerclassname equals org apache coyote http http protocol tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx add application listener addapplicationlistener tester firehose server testerfirehoseserver config get name getname tomcat add servlet addservlet ctx default servlet defaultservlet ctx add servlet mapping addservletmapping tester support testersupport init ssl initssl tomcat tomcat start web socket container websocketcontainer ws container wscontainer container provider containerprovider get web socket container getwebsocketcontainer client endpoint config clientendpointconfig client endpoint config clientendpointconfig client endpoint config clientendpointconfig builder create build client endpoint config clientendpointconfig get user properties getuserproperties ws web socket container wswebsocketcontainer ssl truststore property test org apache tomcat util net jks session ws session wssession ws container wscontainer connect to server connecttoserver tester program matic endpoint testerprogrammaticendpoint client endpoint config clientendpointconfig uri wss localhost get port getport tester firehose server testerfirehoseserver config path process incoming messages slowly message handler messagehandler handler sleeping text sleepingtext ws session wssession add message handler addmessagehandler handler ws session wssession get basic remote getbasicremote send text sendtext wait buf fers buffers fill send timeout count limit tester firehose server testerfirehoseserver wait time millis system err println waiting server report error tester firehose server testerfirehoseserver endpoint get error count geterrorcount count limit thread sleep count tester firehose server testerfirehoseserver endpoint get error count geterrorcount fail error reported endpoint timeout expected wait seconds connection closed system err println waiting connection closed count limit tester firehose server testerfirehoseserver send time millis tester firehose server testerfirehoseserver endpoint get open connection count getopenconnectioncount count limit thread sleep count open connection count openconnectioncount tester firehose server testerfirehoseserver endpoint get open connection count getopenconnectioncount open connection count openconnectioncount fail open connection count openconnectioncount connections open close client session ws session wssession close