licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina connector java io exception ioexception javax servlet servlet exception servletexception javax servlet http http servlet httpservlet javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse org junit assert true asserttrue org junit test org apache catalina context org apache catalina startup simple http client simplehttpclient org apache catalina startup tomcat org apache catalina startup tomcat base test tomcatbasetest test keep alive count testkeepalivecount tomcat base test tomcatbasetest test test http testhttp exception test keep alive client testkeepaliveclient client test keep alive client testkeepaliveclient client do http dohttp request test test http testhttp exception test keep alive client testkeepaliveclient client test keep alive client testkeepaliveclient client do http dohttp request test keep alive client testkeepaliveclient simple http client simplehttpclient init init init tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context root tomcat add context addcontext tomcat add servlet addservlet root simple simple servlet simpleservlet root add servlet mapping addservletmapping test simple tomcat get connector getconnector set property setproperty max keep alive requests maxkeepaliverequests tomcat get connector getconnector set property setproperty so timeout sotimeout tomcat get connector getconnector set property setproperty keep alive timeout keepalivetimeout init do http dohttp request exception tomcat tomcat get tomcat instance gettomcatinstance init tomcat start set port setport tomcat get connector getconnector get local port getlocalport open connection connect send request parts string request string request test http crlf crlf set request setrequest request blocks response read process request processrequest passed read line readline close connection disconnect reset tomcat assert true asserttrue passed do http dohttp request exception tomcat tomcat get tomcat instance gettomcatinstance init tomcat start set port setport tomcat get connector getconnector get local port getlocalport open connection connect send request parts string request string request test http crlf host localhost crlf connection alive crlf alive crlf crlf set request setrequest request blocks response read process request processrequest assert true asserttrue get response line getresponseline get response line getresponseline trim starts with startswith http passed read line readline close connection disconnect reset tomcat assert true asserttrue passed override is response body k isresponsebodyok simple servlet simpleservlet http servlet httpservlet serialversionuid override service http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception resp set content length setcontentlength resp flush buffer flushbuffer