licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat websocket java file java i o exception ioexception java net socket timeout exception sockettimeoutexception java net uri java net url java nio byte buffer bytebuffer java util array list arraylist java util list java util queue java util java util concurrent count down latch countdownlatch java util concurrent execution exception executionexception java util concurrent java util concurrent time unit timeunit javax servlet servlet context event servletcontextevent javax websocket client endpoint config clientendpointconfig javax websocket container provider containerprovider javax websocket deployment exception deploymentexception javax websocket endpoint javax websocket endpoint config endpointconfig javax websocket extension javax websocket message handler messagehandler javax websocket on message onmessage javax websocket session javax websocket web socket container websocketcontainer javax websocket server server container servercontainer javax websocket server server endpoint serverendpoint javax websocket server server endpoint config serverendpointconfig org junit org junit assume org junit test org apache catalina context org apache catalina servlets default servlet defaultservlet org apache catalina startup tomcat org apache coyote http http protocol org apache tomcat util net tester support testersupport org apache tomcat websocket tester message count client testermessagecountclient basic binary basicbinary org apache tomcat websocket tester message count client testermessagecountclient basic handler basichandler org apache tomcat websocket tester message count client testermessagecountclient basic text basictext org apache tomcat websocket tester message count client testermessagecountclient tester endpoint testerendpoint org apache tomcat websocket tester message count client testermessagecountclient tester programmatic endpoint testerprogrammaticendpoint org apache tomcat websocket server constants org apache tomcat websocket server ws context listener wscontextlistener test ws web socket container testwswebsocketcontainer web socket base test websocketbasetest string message empty string message string qwerty string message text message binary timeout margin plenty gump lot slower start wait string builder stringbuilder string builder stringbuilder append message text to string tostring test test connect to server endpoint testconnecttoserverendpoint exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx add application listener addapplicationlistener tester echo server testerechoserver config get name getname tomcat add servlet addservlet ctx default servlet defaultservlet ctx add servlet mapping addservletmapping tomcat start web socket container websocketcontainer ws container wscontainer container provider containerprovider get web socket container getwebsocketcontainer artificially small trigger https apache org bug zilla bugzilla bug cgi ws container wscontainer set default max binary message buffer size setdefaultmaxbinarymessagebuffersize session ws session wssession ws container wscontainer connect to server connecttoserver tester programmatic endpoint testerprogrammaticendpoint client endpoint config clientendpointconfig builder create build uri get host name gethostname get port getport tester echo server testerechoserver config path async count down latch countdownlatch latch count down latch countdownlatch basic text basictext handler basic text basictext latch ws session wssession add message handler addmessagehandler handler ws session wssession get basic remote getbasicremote send text sendtext message string latch result latchresult handler get latch getlatch await time unit timeunit seconds assert true asserttrue latch result latchresult queue string messages handler get messages getmessages assert equals assertequals messages size assert equals assertequals message string messages peek ws web socket container wswebsocketcontainer ws container wscontainer destroy test expected javax websocket deployment exception deploymentexception test connect to server endpoint invalid scheme testconnecttoserverendpointinvalidscheme exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx add application listener addapplicationlistener tester echo server testerechoserver config get name getname tomcat start web socket container websocketcontainer ws container wscontainer container provider containerprovider get web socket container getwebsocketcontainer ws container wscontainer connect to server connecttoserver tester programmatic endpoint testerprogrammaticendpoint client endpoint config clientendpointconfig builder create build uri ftp get host name gethostname get port getport tester echo server testerechoserver config path async test expected javax websocket deployment exception deploymentexception test connect to server endpoint no host testconnecttoserverendpointnohost exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx add application listener addapplicationlistener tester echo server testerechoserver config get name getname tomcat start web socket container websocketcontainer ws container wscontainer container provider containerprovider get web socket container getwebsocketcontainer ws container wscontainer connect to server connecttoserver tester programmatic endpoint testerprogrammaticendpoint client endpoint config clientendpointconfig builder create build uri tester echo server testerechoserver config path async test test small text buffer client text message testsmalltextbufferclienttextmessage exception do buffer test dobuffertest test test small text buffer client binary message testsmalltextbufferclientbinarymessage exception do buffer test dobuffertest test test small text buffer server text message testsmalltextbufferservertextmessage exception do buffer test dobuffertest test test small text buffer server binary message testsmalltextbufferserverbinarymessage exception do buffer test dobuffertest test test small binary buffer client text message testsmallbinarybufferclienttextmessage exception do buffer test dobuffertest test test small binary buffer client binary message testsmallbinarybufferclientbinarymessage exception do buffer test dobuffertest test test small binary buffer server text message testsmallbinarybufferservertextmessage exception do buffer test dobuffertest test test small binary buffer server binary message testsmallbinarybufferserverbinarymessage exception do buffer test dobuffertest do buffer test dobuffertest is text buffer istextbuffer is server buffer isserverbuffer is text message istextmessage pass exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx add application listener addapplicationlistener tester echo server testerechoserver config get name getname tomcat add servlet addservlet ctx default servlet defaultservlet ctx add servlet mapping addservletmapping web socket container websocketcontainer ws container wscontainer container provider containerprovider get web socket container getwebsocketcontainer is server buffer isserverbuffer is text buffer istextbuffer ctx add parameter addparameter org apache tomcat websocket server constants text buffer size servlet context init param ctx add parameter addparameter org apache tomcat websocket server constants binary buffer size servlet context init param is text buffer istextbuffer ws container wscontainer set default max text message buffer size setdefaultmaxtextmessagebuffersize ws container wscontainer set default max binary message buffer size setdefaultmaxbinarymessagebuffersize tomcat start session ws session wssession ws container wscontainer connect to server connecttoserver tester programmatic endpoint testerprogrammaticendpoint client endpoint config clientendpointconfig builder create build uri get host name gethostname get port getport tester echo server testerechoserver config path basic basic handler basichandler handler count down latch countdownlatch latch count down latch countdownlatch tester endpoint testerendpoint tep tester endpoint testerendpoint ws session wssession get user properties getuserproperties endpoint tep set latch setlatch latch is text message istextmessage handler basic text basictext latch handler basic binary basicbinary latch ws session wssession add message handler addmessagehandler handler is text message istextmessage ws session wssession get basic remote getbasicremote send text sendtext message text ws session wssession get basic remote getbasicremote send binary sendbinary byte buffer bytebuffer wrap message binary i o exception ioexception ioe latch result latchresult handler get latch getlatch await time unit timeunit seconds assert true asserttrue latch result latchresult queue messages handler get messages getmessages pass assert equals assertequals messages size is text message istextmessage assert equals assertequals message text messages peek assert equals assertequals byte buffer bytebuffer wrap message binary messages peek session chance complete close process ws session wssession is open isopen thread sleep assert false assertfalse ws session wssession is open isopen test test write timeout client container testwritetimeoutclientcontainer exception do test write timeout client dotestwritetimeoutclient test test write timeout client endpoint testwritetimeoutclientendpoint exception do test write timeout client dotestwritetimeoutclient do test write timeout client dotestwritetimeoutclient set timeout on container settimeoutoncontainer exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx add application listener addapplicationlistener blocking config blockingconfig get name getname tomcat add servlet addservlet ctx default servlet defaultservlet ctx add servlet mapping addservletmapping web socket container websocketcontainer ws container wscontainer container provider containerprovider get web socket container getwebsocketcontainer async timeout set timeout on container settimeoutoncontainer ws container wscontainer set async send timeout setasyncsendtimeout timeout tomcat start session ws session wssession ws container wscontainer connect to server connecttoserver tester programmatic endpoint testerprogrammaticendpoint client endpoint config clientendpointconfig builder create build uri get host name gethostname get port getport blocking config blockingconfig path set timeout on container settimeoutoncontainer ws session wssession get async remote getasyncremote set send timeout setsendtimeout timeout last send lastsend send net work network buf fers buffers fill block timeout kicks exception exception last send lastsend system current time millis currenttimemillis ws session wssession get async remote getasyncremote send binary sendbinary byte buffer bytebuffer wrap message binary exception exception timeout system current time millis currenttimemillis last send lastsend clear server side block prevent blocks server shutdown cleanly blocking pojo blockingpojo clear block clearblock close client session background process manager backgroundprocessmanager shut ws session wssession close string msg time timeout check correct time passed assert true asserttrue msg timeout timeout margin check timeout was n wasn assert true asserttrue msg timeout timeout assert not null assertnotnull exception test test write timeout server container testwritetimeoutservercontainer exception do test write timeout server dotestwritetimeoutserver test test write timeout server endpoint testwritetimeoutserverendpoint exception do test write timeout server dotestwritetimeoutserver timeout on container timeoutoncontainer do test write timeout server dotestwritetimeoutserver set timeout on container settimeoutoncontainer exception work bio assume assume false assumefalse skip ping skipping test feature work bio connector get protocol getprotocol equals http protocol get name getname note sorts horrible statics test api classes tests access instances simply isn timeout on container timeoutoncontainer set timeout on container settimeoutoncontainer tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx add application listener addapplicationlistener constant tx config constanttxconfig get name getname tomcat add servlet addservlet ctx default servlet defaultservlet ctx add servlet mapping addservletmapping web socket container websocketcontainer ws container wscontainer container provider containerprovider get web socket container getwebsocketcontainer tomcat start session ws session wssession ws container wscontainer connect to server connecttoserver tester programmatic endpoint testerprogrammaticendpoint client endpoint config clientendpointconfig builder create build uri get host name gethostname get port getport constant tx config constanttxconfig path ws session wssession add message handler addmessagehandler blocking binary handler blockingbinaryhandler loops loops thread sleep constant tx endpoint constanttxendpoint get running getrunning loops close client session background process manager backgroundprocessmanager shut ws session wssession close check exception thrown assert not null assertnotnull constant tx endpoint constanttxendpoint get exception getexception assert equals assertequals execution exception executionexception constant tx endpoint constanttxendpoint get exception getexception get class getclass assert not null assertnotnull constant tx endpoint constanttxendpoint get exception getexception get cause getcause assert equals assertequals socket timeout exception sockettimeoutexception constant tx endpoint constanttxendpoint get exception getexception get cause getcause get class getclass check correct time passed assert true asserttrue constant tx endpoint constanttxendpoint get timeout gettimeout timeout check timeout was n wasn assert true asserttrue constant tx endpoint constanttxendpoint get timeout gettimeout timeout blocking config blockingconfig ws context listener wscontextlistener string path block override context initialized contextinitialized servlet context event servletcontextevent sce context initialized contextinitialized sce server container servercontainer server container servercontainer sce get servlet context getservletcontext get attribute getattribute constants server container servlet context attribute reset blocking blocking pojo blockingpojo reset block resetblock add endpoint addendpoint blocking pojo blockingpojo deployment exception deploymentexception illegal state exception illegalstateexception server endpoint serverendpoint block blocking pojo blockingpojo object monitor object enable block ign blockign block clear current block clear block clearblock monitor blocking pojo blockingpojo block monitor notify all notifyall reset block resetblock monitor block suppress warnings suppresswarnings unused on message onmessage echo text message echotextmessage session session string msg monitor block monitor wait interrupted exception interruptedexception suppress warnings suppresswarnings unused on message onmessage echo binary message echobinarymessage session session byte buffer bytebuffer msg monitor block monitor wait interrupted exception interruptedexception blocking binary handler blockingbinaryhandler message handler messagehandler partial byte buffer bytebuffer override on message onmessage byte buffer bytebuffer message part messagepart thread sleep timeout interrupted exception interruptedexception constant tx endpoint constanttxendpoint endpoint retrieve test timeout exception exception running override on open onopen session session endpoint config endpointconfig config reset timeout exception running test ws web socket container testwswebsocketcontainer timeout on container timeoutoncontainer session get async remote getasyncremote set send timeout setsendtimeout timeout close message written blocking write fail reduce timeout test comp letes completes faster session get user properties getuserproperties ws remote endpoint impl base wsremoteendpointimplbase b locking blocking send timeout property value of valueof send net work network buf fers buffers fill block timeout kicks last send lastsend last send lastsend system current time millis currenttimemillis session get async remote getasyncremote send binary sendbinary byte buffer bytebuffer wrap message binary execution exception executionexception exception interrupted exception interruptedexception exception timeout system current time millis currenttimemillis last send lastsend running get timeout gettimeout timeout exception get exception getexception exception get running getrunning running constant tx config constanttxconfig ws context listener wscontextlistener string path test override context initialized contextinitialized servlet context event servletcontextevent sce context initialized contextinitialized sce server container servercontainer server container servercontainer sce get servlet context getservletcontext get attribute getattribute constants server container servlet context attribute add endpoint addendpoint server endpoint config serverendpointconfig builder create constant tx endpoint constanttxendpoint path build test ws web socket container testwswebsocketcontainer timeout on container timeoutoncontainer set async send timeout setasyncsendtimeout timeout deployment exception deploymentexception illegal state exception illegalstateexception test test get open sessions testgetopensessions exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx add application listener addapplicationlistener tester echo server testerechoserver config get name getname tomcat add servlet addservlet ctx default servlet defaultservlet ctx add servlet mapping addservletmapping tomcat start web socket container websocketcontainer ws container wscontainer container provider containerprovider get web socket container getwebsocketcontainer endpoint a endpointa endpoint a endpointa endpoint a endpointa session connect to echo server connecttoechoserver ws container wscontainer endpoint a endpointa tester echo server testerechoserver config path basic session connect to echo server connecttoechoserver ws container wscontainer endpoint a endpointa tester echo server testerechoserver config path basic session connect to echo server connecttoechoserver ws container wscontainer endpoint a endpointa tester echo server testerechoserver config path basic endpoint b endpointb endpoint b endpointb endpoint b endpointb session connect to echo server connecttoechoserver ws container wscontainer endpoint b endpointb tester echo server testerechoserver config path basic session connect to echo server connecttoechoserver ws container wscontainer endpoint b endpointb tester echo server testerechoserver config path basic session set a seta get open sessions getopensessions assert equals assertequals set a seta size assert true asserttrue set a seta remove assert true asserttrue set a seta remove assert true asserttrue set a seta remove close set a seta get open sessions getopensessions assert equals assertequals set a seta size assert false assertfalse set a seta remove assert true asserttrue set a seta remove assert true asserttrue set a seta remove session set b setb get open sessions getopensessions assert equals assertequals set b setb size assert true asserttrue set b setb remove assert true asserttrue set b setb remove close sessions explicitly gump reports session remains open test close close close close test test session exp iry container testsessionexpirycontainer exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx add application listener addapplicationlistener tester echo server testerechoserver config get name getname tomcat add servlet addservlet ctx default servlet defaultservlet ctx add servlet mapping addservletmapping tomcat start access implementation methods config uri ng configuring unit tests ws web socket container wswebsocketcontainer ws container wscontainer ws web socket container wswebsocketcontainer container provider containerprovider get web socket container getwebsocketcontainer timeout ws container wscontainer set default max session idle timeout setdefaultmaxsessionidletimeout ws container wscontainer set process period setprocessperiod endpoint a endpointa endpoint a endpointa endpoint a endpointa connect to echo server connecttoechoserver ws container wscontainer endpoint a endpointa tester echo server testerechoserver config path basic connect to echo server connecttoechoserver ws container wscontainer endpoint a endpointa tester echo server testerechoserver config path basic session connect to echo server connecttoechoserver ws container wscontainer endpoint a endpointa tester echo server testerechoserver config path basic check sessions open session set a seta get open sessions getopensessions assert equals assertequals set a seta size count is open isopen is open isopen count count thread sleep is open isopen session session set a seta session is open isopen is open isopen is open isopen session session set a seta session is open isopen system err println session session get id getid open fail open sessions test test session exp iry session testsessionexpirysession exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx add application listener addapplicationlistener tester echo server testerechoserver config get name getname tomcat add servlet addservlet ctx default servlet defaultservlet ctx add servlet mapping addservletmapping tomcat start access implementation methods config uri ng configuring unit tests ws web socket container wswebsocketcontainer ws container wscontainer ws web socket container wswebsocketcontainer container provider containerprovider get web socket container getwebsocketcontainer timeout ws container wscontainer set default max session idle timeout setdefaultmaxsessionidletimeout ws container wscontainer set process period setprocessperiod endpoint a endpointa endpoint a endpointa endpoint a endpointa session connect to echo server connecttoechoserver ws container wscontainer endpoint a endpointa tester echo server testerechoserver config path basic set max idle timeout setmaxidletimeout session connect to echo server connecttoechoserver ws container wscontainer endpoint a endpointa tester echo server testerechoserver config path basic set max idle timeout setmaxidletimeout session connect to echo server connecttoechoserver ws container wscontainer endpoint a endpointa tester echo server testerechoserver config path basic set max idle timeout setmaxidletimeout check sessions open session set a seta get open sessions getopensessions expected expected assert equals assertequals expected get open count getopencount set a seta count get open count getopencount set a seta expected count count thread sleep expected assert equals assertequals get open count getopencount set a seta get open count getopencount session sessions result session session sessions session is open isopen result result session connect to echo server connecttoechoserver web socket container websocketcontainer ws container wscontainer endpoint endpoint string path exception ws container wscontainer connect to server connecttoserver endpoint client endpoint config clientendpointconfig builder create build uri get host name gethostname get port getport path endpoint a endpointa endpoint override on open onopen session session endpoint config endpointconfig config endpoint b endpointb endpoint override on open onopen session session endpoint config endpointconfig config test test connect to server endpoint l testconnecttoserverendpointssl exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx add application listener addapplicationlistener tester echo server testerechoserver config get name getname tomcat add servlet addservlet ctx default servlet defaultservlet ctx add servlet mapping addservletmapping tester support testersupport init ssl initssl tomcat tomcat start web socket container websocketcontainer ws container wscontainer container provider containerprovider get web socket container getwebsocketcontainer client endpoint config clientendpointconfig client endpoint config clientendpointconfig client endpoint config clientendpointconfig builder create build url truststore url truststoreurl get class getclass get class loader getclassloader get resource getresource org apache tomcat util net jks file truststore file truststorefile file truststore url truststoreurl touri client endpoint config clientendpointconfig get user properties getuserproperties ws web socket container wswebsocketcontainer ssl truststore property truststore file truststorefile get absolute path getabsolutepath session ws session wssession ws container wscontainer connect to server connecttoserver tester programmatic endpoint testerprogrammaticendpoint client endpoint config clientendpointconfig uri wss get host name gethostname get port getport tester echo server testerechoserver config path async count down latch countdownlatch latch count down latch countdownlatch basic text basictext handler basic text basictext latch ws session wssession add message handler addmessagehandler handler ws session wssession get basic remote getbasicremote send text sendtext message string latch result latchresult handler get latch getlatch await time unit timeunit seconds assert true asserttrue latch result latchresult queue string messages handler get messages getmessages assert equals assertequals messages size assert equals assertequals message string messages peek test test max message size testmaxmessagesize exception do max message size domaxmessagesize tester echo server testerechoserver config path basic limit tester echo server testerechoserver basic limit low basiclimitlow max size test test max message size testmaxmessagesize exception do max message size domaxmessagesize tester echo server testerechoserver config path basic limit tester echo server testerechoserver basic limit low basiclimitlow max size test test max message size testmaxmessagesize exception do max message size domaxmessagesize tester echo server testerechoserver config path basic limit tester echo server testerechoserver basic limit low basiclimitlow max size test test max message size testmaxmessagesize exception do max message size domaxmessagesize tester echo server testerechoserver config path basic limit high tester echo server testerechoserver basic limit high basiclimithigh max size test test max message size testmaxmessagesize exception do max message size domaxmessagesize tester echo server testerechoserver config path basic limit high tester echo server testerechoserver basic limit high basiclimithigh max size test test max message size testmaxmessagesize exception do max message size domaxmessagesize tester echo server testerechoserver config path basic limit high tester echo server testerechoserver basic limit high basiclimithigh max size do max message size domaxmessagesize string path size expect open expectopen exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx add application listener addapplicationlistener tester echo server testerechoserver config get name getname tomcat add servlet addservlet ctx default servlet defaultservlet ctx add servlet mapping addservletmapping tomcat start web socket container websocketcontainer ws container wscontainer container provider containerprovider get web socket container getwebsocketcontainer session connect to echo server connecttoechoserver ws container wscontainer endpoint a endpointa path client server validate background process count validatebackgroundprocesscount string builder stringbuilder msg string builder stringbuilder size msg append get basic remote getbasicremote send text sendtext msg to string tostring wait seconds client session open open is open isopen count open expect open expectopen count thread sleep count open is open isopen assert equals assertequals value of valueof expect open expectopen value of valueof is open isopen close session expected open expect open expectopen close ensure server client shutdown validate background process count validatebackgroundprocesscount validate background process count validatebackgroundprocesscount expected exception count count start wait background process manager backgroundprocessmanager get instance getinstance get process count getprocesscount expected thread sleep count assert equals assertequals expected background process manager backgroundprocessmanager get instance getinstance get process count getprocesscount test test per message def alte client testpermessagedefalteclient exception do test per message def alte client dotestpermessagedefalteclient message string test test per message def alte client testpermessagedefalteclient exception do test per message def alte client dotestpermessagedefalteclient message empty test test per message def alte client testpermessagedefalteclient exception do test per message def alte client dotestpermessagedefalteclient message string test test per message def alte client testpermessagedefalteclient exception do test per message def alte client dotestpermessagedefalteclient message empty do test per message def alte client dotestpermessagedefalteclient string msg count exception tomcat tomcat get tomcat instance gettomcatinstance real doc base docbase temp context ctx tomcat add context addcontext system get property getproperty java tmp dir tmpdir ctx add application listener addapplicationlistener tester echo server testerechoserver config get name getname tomcat add servlet addservlet ctx default servlet defaultservlet ctx add servlet mapping addservletmapping tomcat start extension per message def late permessagedeflate ws extension wsextension per message def late permessagedeflate list extension extensions array list arraylist extension extensions add per message def late permessagedeflate client endpoint config clientendpointconfig client config clientconfig client endpoint config clientendpointconfig builder create extensions extensions build web socket container websocketcontainer ws container wscontainer container provider containerprovider get web socket container getwebsocketcontainer session ws session wssession ws container wscontainer connect to server connecttoserver tester programmatic endpoint testerprogrammaticendpoint client config clientconfig uri get host name gethostname get port getport tester echo server testerechoserver config path async count down latch countdownlatch latch count down latch countdownlatch count basic text basictext handler basic text basictext latch msg ws session wssession add message handler addmessagehandler handler count ws session wssession get basic remote getbasicremote send text sendtext msg latch result latchresult handler get latch getlatch await time unit timeunit seconds assert true asserttrue latch result latchresult ws web socket container wswebsocketcontainer ws container wscontainer destroy override easily test proxy string get host name gethostname localhost