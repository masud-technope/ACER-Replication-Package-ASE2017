licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina core java i o exception ioexception java lang reflect invocation target exception invocationtargetexception java security access controller accesscontroller java security privileged action privilegedaction java util array list arraylist java util hash map hashmap java util list java util map java util concurrent atomic atomic boolean atomicboolean javax naming naming exception namingexception javax servlet async context asynccontext javax servlet async event asyncevent javax servlet async listener asynclistener javax servlet request dispatcher requestdispatcher javax servlet servlet context servletcontext javax servlet servlet exception servletexception javax servlet servlet request servletrequest javax servlet servlet response servletresponse javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse org apache catalina async dispatcher asyncdispatcher org apache catalina context org apache catalina globals org apache catalina host org apache catalina valve org apache catalina connector request org apache coyote action code actioncode org apache coyote async context callback asynccontextcallback org apache coyote request info requestinfo org apache juli logging log org apache juli logging log factory logfactory org apache tomcat instance manager instancemanager org apache tomcat util exception utils exceptionutils org apache tomcat util res string manager stringmanager org apache tomcat util security privileged get tccl privilegedgettccl org apache tomcat util security privileged set tccl privilegedsettccl author fhanik async context impl asynccontextimpl async context asynccontext async context callback asynccontextcallback log log log factory logfactory get log getlog async context impl asynccontextimpl string manager stringmanager string manager stringmanager get manager getmanager constants request sequence multiple start dispatch container threads previous dispatch int erfere interfere start lock prevents happening dedicated object user code lock async context asynccontext container code locks object dead locks deadlocks occur object async context lock asynccontextlock object servlet request servletrequest servlet request servletrequest servlet response servletresponse servlet response servletresponse list async listener wrapper asynclistenerwrapper listeners array list arraylist async listener wrapper asynclistenerwrapper has original request and response hasoriginalrequestandresponse runnable dispatch context context timeout async event asyncevent event request request instance manager instancemanager instance manager instancemanager async context impl asynccontextimpl request request log is debug enabled isdebugenabled log debug logdebug constructor request request override complete log is debug enabled isdebugenabled log debug logdebug complete check request get coyote request getcoyoterequest action action code actioncode async complete override fire on complete fireoncomplete list async listener wrapper asynclistenerwrapper listeners copy listenerscopy array list arraylist async listener wrapper asynclistenerwrapper listeners copy listenerscopy add all addall listeners class loader classloader oldcl globals security enabled privileged action privilegedaction class loader classloader privileged get tccl privilegedgettccl oldcl access controller accesscontroller do privileged doprivileged oldcl thread current thread currentthread get context class loader getcontextclassloader class loader classloader newcl context get loader getloader get class loader getclassloader globals security enabled privileged action privilegedaction privileged set tccl privilegedsettccl newcl access controller accesscontroller do privileged doprivileged thread current thread currentthread set context class loader setcontextclassloader newcl async listener wrapper asynclistenerwrapper listener listeners copy listenerscopy listener fire on complete fireoncomplete event throwable exception utils exceptionutils handle throwable handlethrowable log warn on complete oncomplete failed listener type listener get class getclass get name getname clear servlet request response clearservletrequestresponse globals security enabled privileged action privilegedaction privileged set tccl privilegedsettccl oldcl access controller accesscontroller do privileged doprivileged thread current thread currentthread set context class loader setcontextclassloader oldcl timeout atomic boolean atomicboolean result atomic boolean atomicboolean request get coyote request getcoyoterequest action action code actioncode async timeout result result class loader classloader oldcl thread current thread currentthread get context class loader getcontextclassloader class loader classloader newcl request get context getcontext get loader getloader get class loader getclassloader thread current thread currentthread set context class loader setcontextclassloader newcl list async listener wrapper asynclistenerwrapper listeners copy listenerscopy array list arraylist async listener wrapper asynclistenerwrapper listeners copy listenerscopy add all addall listeners async listener wrapper asynclistenerwrapper listener listeners copy listenerscopy listener fire on timeout fireontimeout event throwable exception utils exceptionutils handle throwable handlethrowable log warn on timeout ontimeout failed listener type listener get class getclass get name getname request get coyote request getcoyoterequest action action code actioncode async timingout result result thread current thread currentthread set context class loader setcontextclassloader oldcl override dispatch check string path string path info pathinfo servlet request servletrequest servlet request servletrequest get request getrequest servlet request servletrequest http servlet request httpservletrequest http servlet request httpservletrequest http servlet request httpservletrequest servlet request servletrequest path get servlet path getservletpath path info pathinfo get path info getpathinfo path request get servlet path getservletpath path info pathinfo request get path info getpathinfo path info pathinfo path path info pathinfo dispatch path override dispatch string path check dispatch get request getrequest get servlet context getservletcontext path override dispatch servlet context servletcontext context string path async context lock asynccontextlock log is debug enabled isdebugenabled log debug logdebug dispatch check dispatch illegal state exception illegalstateexception get string getstring async context impl asynccontextimpl dispatching started dispatchingstarted request get attribute getattribute async request uri request set attribute setattribute async request uri request getrequesturi request set attribute setattribute async context path request get context path getcontextpath request set attribute setattribute async servlet path request get servlet path getservletpath request set attribute setattribute async path info request get path info getpathinfo request set attribute setattribute async query string request get query string getquerystring request dispatcher requestdispatcher request dispatcher requestdispatcher context get request dispatcher getrequestdispatcher path request dispatcher requestdispatcher async dispatcher asyncdispatcher unsupported operation exception unsupportedoperationexception get string getstring async context impl asynccontextimpl no async dispatcher noasyncdispatcher async dispatcher asyncdispatcher application dispatcher applicationdispatcher async dispatcher asyncdispatcher request dispatcher requestdispatcher servlet request servletrequest servlet request servletrequest get request getrequest servlet response servletresponse servlet response servletresponse get response getresponse runnable runnable override request get coyote request getcoyoterequest action action code actioncode async dispatched application dispatcher applicationdispatcher dispatch servlet request servletrequest servlet response servletresponse exception runtime exception runtimeexception dispatch request get coyote request getcoyoterequest action action code actioncode async dispatch clear servlet request response clearservletrequestresponse override servlet request servletrequest get request getrequest check servlet request servletrequest illegal state exception illegalstateexception get string getstring async context impl asynccontextimpl request ise servlet request servletrequest override servlet response servletresponse get response getresponse check servlet response servletresponse illegal state exception illegalstateexception get string getstring async context impl asynccontextimpl response ise servlet response servletresponse override start runnable log is debug enabled isdebugenabled log debug logdebug start check runnable wrapper runnable wrapper runnablewrapper context request get coyote request getcoyoterequest action action code actioncode async wrapper override add listener addlistener async listener asynclistener listener check async listener wrapper asynclistenerwrapper wrapper async listener wrapper asynclistenerwrapper wrapper set listener setlistener listener listeners add wrapper override add listener addlistener async listener asynclistener listener servlet request servletrequest servlet request servletrequest servlet response servletresponse servlet response servletresponse check async listener wrapper asynclistenerwrapper wrapper async listener wrapper asynclistenerwrapper wrapper set listener setlistener listener wrapper set servlet request setservletrequest servlet request servletrequest wrapper set servlet response setservletresponse servlet response servletresponse listeners add wrapper suppress warnings suppresswarnings unchecked override async listener asynclistener create listener createlistener clazz servlet exception servletexception check listener listener get instance manager getinstancemanager new instance newinstance clazz get name getname clazz get class loader getclassloader instantiation exception instantiationexception servlet exception servletexception servlet exception servletexception illegal access exception illegalaccessexception servlet exception servletexception servlet exception servletexception invocation target exception invocationtargetexception exception utils exceptionutils handle throwable handlethrowable get cause getcause servlet exception servletexception servlet exception servletexception naming exception namingexception servlet exception servletexception servlet exception servletexception class not found exception classnotfoundexception servlet exception servletexception servlet exception servletexception exception exception utils exceptionutils handle throwable handlethrowable get cause getcause servlet exception servletexception servlet exception servletexception listener recycle log is debug enabled isdebugenabled log debug logdebug recycle context dispatch event has original request and response hasoriginalrequestandresponse instance manager instancemanager listeners clear request clear servlet request response clearservletrequestresponse timeout clear servlet request response clearservletrequestresponse servlet request servletrequest servlet response servletresponse is started isstarted atomic boolean atomicboolean result atomic boolean atomicboolean request get coyote request getcoyoterequest action action code actioncode async started result result set started setstarted context context servlet request servletrequest request servlet response servletresponse response original request response originalrequestresponse async context lock asynccontextlock request get coyote request getcoyoterequest action action code actioncode async start context context servlet request servletrequest request servlet response servletresponse response has original request and response hasoriginalrequestandresponse original request response originalrequestresponse event async event asyncevent request response list async listener wrapper asynclistenerwrapper listeners copy listenerscopy array list arraylist async listener wrapper asynclistenerwrapper listeners copy listenerscopy add all addall listeners listeners clear async listener wrapper asynclistenerwrapper listener listeners copy listenerscopy listener fire on start async fireonstartasync event throwable exception utils exceptionutils handle throwable handlethrowable log warn on start async onstartasync failed listener type listener get class getclass get name getname override has original request and response hasoriginalrequestandresponse check has original request and response hasoriginalrequestandresponse do internal dispatch dointernaldispatch servlet exception servletexception i o exception ioexception log is debug enabled isdebugenabled log debug logdebug int dispatch intdispatch runnable runnable dispatch dispatch runnable request is async isasync fire on complete fireoncomplete runtime exception runtimeexception get cause getcause servlet exception servletexception servlet exception servletexception get cause getcause get cause getcause i o exception ioexception i o exception ioexception get cause getcause servlet exception servletexception override get timeout gettimeout check timeout override set timeout settimeout timeout check timeout timeout request get coyote request getcoyoterequest action action code actioncode async set timeout settimeout value of valueof timeout set error state seterrorstate throwable fire on error fireonerror request set attribute setattribute request dispatcher requestdispatcher error exception request get coyote request getcoyoterequest action action code actioncode async error fire on error fireonerror async event asyncevent error event errorevent async event asyncevent event get async context getasynccontext event get supplied request getsuppliedrequest event get supplied response getsuppliedresponse list async listener wrapper asynclistenerwrapper listeners copy listenerscopy array list arraylist async listener wrapper asynclistenerwrapper listeners copy listenerscopy add all addall listeners async listener wrapper asynclistenerwrapper listener listeners copy listenerscopy listener fire on error fireonerror error event errorevent throwable exception utils exceptionutils handle throwable handlethrowable log warn on error onerror failed listener type listener get class getclass get name getname atomic boolean atomicboolean result atomic boolean atomicboolean request get coyote request getcoyoterequest action action code actioncode async error result result srv search error dispatch servlet response servletresponse http servlet response httpservletresponse http servlet response httpservletresponse servlet response servletresponse set status setstatus http servlet response httpservletresponse internal server error host host host context get parent getparent valve std host valve stdhostvalve host get pipeline getpipeline get basic getbasic std host valve stdhostvalve standard host valve standardhostvalve standard host valve standardhostvalve std host valve stdhostvalve throwable request request get response getresponse request get coyote request getcoyoterequest action action code actioncode async error result result error error call complete dispatch complete async processing complete log debug logdebug string method string r hash code rhashcode string cr hash code crhashcode string rp hash code rphashcode string stage string builder stringbuilder uri string builder stringbuilder request r hash code rhashcode cr hash code crhashcode rp hash code rphashcode stage uri append r hash code rhashcode integer to hex string tohexstring request hash code hashcode org apache coyote request coyote request coyoterequest request get coyote request getcoyoterequest coyote request coyoterequest cr hash code crhashcode rp hash code rphashcode stage cr hash code crhashcode integer to hex string tohexstring coyote request coyoterequest hash code hashcode request info requestinfo coyote request coyoterequest get request processor getrequestprocessor rp hash code rphashcode stage rp hash code rphashcode integer to hex string tohexstring hash code hashcode stage integer to string tostring get s tag e getstage uri append request getrequesturi request get query string getquerystring uri append uri append request get query string getquerystring string thread name threadname thread current thread currentthread get name getname len thread name threadname length len thread name threadname thread name threadname substring len len string msg string format req c req creq s tag e stage thread method uri r hash code rhashcode cr hash code crhashcode rp hash code rphashcode stage thread name threadname method uri log is trace enabled istraceenabled log trace msg debug exception debugexception log debug msg instance manager instancemanager get instance manager getinstancemanager instance manager instancemanager context standard context standardcontext instance manager instancemanager standard context standardcontext context get instance manager getinstancemanager instance manager instancemanager default instance manager defaultinstancemanager hash map hashmap string map string string context get class getclass get class loader getclassloader instance manager instancemanager check request async context asynccontext recycle d recycled illegal state exception illegalstateexception get string getstring async context impl asynccontextimpl request ended requestended debug exception debugexception exception serialversionuid runnable wrapper runnablewrapper runnable runnable wrapped context context runnable wrapper runnablewrapper runnable wrapped context ctxt wrapped wrapped context ctxt override class loader classloader oldcl globals security enabled privileged action privilegedaction class loader classloader privileged get tccl privilegedgettccl oldcl access controller accesscontroller do privileged doprivileged oldcl thread current thread currentthread get context class loader getcontextclassloader globals security enabled privileged action privilegedaction privileged set tccl privilegedsettccl context get loader getloader get class loader getclassloader access controller accesscontroller do privileged doprivileged thread current thread currentthread set context class loader setcontextclassloader context get loader getloader get class loader getclassloader wrapped globals security enabled privileged action privilegedaction privileged set tccl privilegedsettccl oldcl access controller accesscontroller do privileged doprivileged thread current thread currentthread set context class loader setcontextclassloader oldcl