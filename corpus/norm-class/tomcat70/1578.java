licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina session java buffered input stream bufferedinputstream java buffered output stream bufferedoutputstream java byte array input stream bytearrayinputstream java byte array output stream bytearrayoutputstream java io exception ioexception java input stream inputstream java object input stream objectinputstream java object output stream objectoutputstream java sql connection java sql driver java sql prepared statement preparedstatement java sql result set resultset java sql sql exception sqlexception java util array list arraylist java util properties javax naming context javax naming initial context initialcontext javax naming naming exception namingexception javax sql data source datasource org apache catalina container org apache catalina lifecycle exception lifecycleexception org apache catalina loader org apache catalina session org apache juli logging log org apache tomcat util exception utils exceptionutils implementation link org apache catalina store store stores serialized session objects database sessions saved subject expired based inactivity author bip the lin thelin jdbc store jdbcstore store base storebase descriptive implementation string info jdbc store jdbcstore context store string register store logging string store name storename jdbc store jdbcstore register background thread string thread name threadname jdbc store jdbcstore connection username connect database string connection name connectionname connection url connect database string connection password connectionpassword connection string conn ecting connecting string connectionurl database connection connection db connection dbconnection instance jdbc driver connection factory driver driver driver string driver name drivername jndi resource string data source name datasourcename data source datasource data source datasource data source datasource table cols table string session table sessiontable tomcat sessions column engine host context string session app col sessionappcol app column string session id col sessionidcol data column string session data col sessiondatacol data code valid column string session valid col sessionvalidcol valid max inactive column string session max inactive col sessionmaxinactivecol max inactive maxinactive accessed column string session last accessed col sessionlastaccessedcol last access lastaccess sql variables variable hold code get size getsize code prepared statement prepared statement preparedstatement prepared size sql preparedsizesql variable hold code save code prepared statement prepared statement preparedstatement prepared save sql preparedsavesql variable hold code clear code prepared statement prepared statement preparedstatement prepared clear sql preparedclearsql variable hold code remove code prepared statement prepared statement preparedstatement prepared remove sql preparedremovesql variable hold code load code prepared statement prepared statement preparedstatement prepared load sql preparedloadsql properties info store override string get info getinfo info instance built container string get name getname container container manager get container getcontainer string context name contextname container get name getname context name contextname starts with startswith context name contextname context name contextname string host name hostname string engine name enginename container get parent getparent container host container get parent getparent host name hostname host get name getname host get parent getparent engine name enginename host get parent getparent get name getname engine name enginename host name hostname context name contextname thread store string get thread name getthreadname thread name threadname store logging override string get store name getstorename store name storename driver store param driver name drivername driver set driver name setdrivername string driver name drivername string old driver name olddrivername driver name drivername driver name drivername driver name drivername support fire property change firepropertychange driver name drivername old driver name olddrivername driver name drivername driver name drivername driver name drivername driver store string get driver name getdrivername driver name drivername username connect database string get connection name getconnectionname connection name connectionname username connect database param connection name connectionname username set connection name setconnectionname string connection name connectionname connection name connectionname connection name connectionname password connect database string get connection password getconnectionpassword connection password connectionpassword password connect database param connection password connectionpassword user password set connection password setconnectionpassword string connection password connectionpassword connection password connectionpassword connection password connectionpassword connection url store param connectionurl connection url setconnectionurl string connectionurl string old conn string oldconnstring connectionurl connectionurl connectionurl support fire property change firepropertychange connectionurl old conn string oldconnstring connectionurl connection url store string getconnectionurl connectionurl table store param session table sessiontable table set session table setsessiontable string session table sessiontable string old session table oldsessiontable session table sessiontable session table sessiontable session table sessiontable support fire property change firepropertychange session table sessiontable old session table oldsessiontable session table sessiontable table store string get session table getsessiontable session table sessiontable app column table param session app col sessionappcol column set session app col setsessionappcol string session app col sessionappcol string old session app col oldsessionappcol session app col sessionappcol session app col sessionappcol session app col sessionappcol support fire property change firepropertychange session app col sessionappcol old session app col oldsessionappcol session app col sessionappcol web application column table string get session app col getsessionappcol session app col sessionappcol column table param session id col sessionidcol column set session id col setsessionidcol string session id col sessionidcol string old session id col oldsessionidcol session id col sessionidcol session id col sessionidcol session id col sessionidcol support fire property change firepropertychange session id col sessionidcol old session id col oldsessionidcol session id col sessionidcol column table string get session id col getsessionidcol session id col sessionidcol data column table param session data col sessiondatacol column set session data col setsessiondatacol string session data col sessiondatacol string old session data col oldsessiondatacol session data col sessiondatacol session data col sessiondatacol session data col sessiondatacol support fire property change firepropertychange session data col sessiondatacol old session data col oldsessiondatacol session data col sessiondatacol data column table string get session data col getsessiondatacol session data col sessiondatacol code valid column table param session valid col sessionvalidcol column set session valid col setsessionvalidcol string session valid col sessionvalidcol string old session valid col oldsessionvalidcol session valid col sessionvalidcol session valid col sessionvalidcol session valid col sessionvalidcol support fire property change firepropertychange session valid col sessionvalidcol old session valid col oldsessionvalidcol session valid col sessionvalidcol code valid column string get session valid col getsessionvalidcol session valid col sessionvalidcol code max inactive column table param session max inactive col sessionmaxinactivecol column set session max inactive col setsessionmaxinactivecol string session max inactive col sessionmaxinactivecol string old session max inactive col oldsessionmaxinactivecol session max inactive col sessionmaxinactivecol session max inactive col sessionmaxinactivecol session max inactive col sessionmaxinactivecol support fire property change firepropertychange session max inactive col sessionmaxinactivecol old session max inactive col oldsessionmaxinactivecol session max inactive col sessionmaxinactivecol code max inactive column string get session max inactive col getsessionmaxinactivecol session max inactive col sessionmaxinactivecol code accessed column table param session last accessed col sessionlastaccessedcol column set session last accessed col setsessionlastaccessedcol string session last accessed col sessionlastaccessedcol string old session last accessed col oldsessionlastaccessedcol session last accessed col sessionlastaccessedcol session last accessed col sessionlastaccessedcol session last accessed col sessionlastaccessedcol support fire property change firepropertychange session last accessed col sessionlastaccessedcol old session last accessed col oldsessionlastaccessedcol session last accessed col sessionlastaccessedcol code accessed column string get session last accessed col getsessionlastaccessedcol session last accessed col sessionlastaccessedcol jndi data source datasource factory access param data source name datasourcename jndi data source datasource factory set data source name setdatasourcename string data source name datasourcename data source name datasourcename equals data source name datasourcename trim manager get container getcontainer get logger getlogger warn get string getstring get store name getstorename missing data source name missingdatasourcename data source name datasourcename data source name datasourcename jndi data source datasource factory string get data source name getdatasourcename data source name datasourcename methods override string expired keys expiredkeys io exception ioexception override string io exception ioexception array session identifiers sessions saved store sessions length array returned param expired only expiredonly flag expired sessions returned array list session id s ids exception io exception ioexception input output error occurred string expired only expiredonly io exception ioexception string number of tries numberoftries number of tries numberoftries connection conn get connection getconnection conn string string keys sql keyssql select session id col sessionidcol session table sessiontable session app col sessionappcol expired only expiredonly keys sql keyssql session last accessed col sessionlastaccessedcol session max inactive col sessionmaxinactivecol prepared statement preparedstatement prepared keys sql preparedkeyssql conn prepare statement preparestatement keys sql keyssql prepared keys sql preparedkeyssql set string setstring get name getname expired only expiredonly prepared keys sql preparedkeyssql set long setlong system current time millis currenttimemillis result set resultset rst prepared keys sql preparedkeyssql execute query executequery array list arraylist string tmp keys tmpkeys array list arraylist string rst rst tmp keys tmpkeys add rst get string getstring tmp keys tmpkeys to array toarray string tmp keys tmpkeys size block number of tries numberoftries rst rst close prepared keys sql preparedkeyssql close sql exception sqlexception manager get container getcontainer get logger getlogger error get string getstring get store name getstorename sql exception sqlexception string db connection dbconnection close db connection dbconnection release conn number of tries numberoftries int eger integer count sessions saved store sessions code code returned count sessions saved store exception io exception ioexception input output error occurred override get size getsize io exception ioexception size result set resultset rst number of tries numberoftries number of tries numberoftries connection conn get connection getconnection conn size prepared size sql preparedsizesql string size sql sizesql select count session id col sessionidcol session table sessiontable session app col sessionappcol prepared size sql preparedsizesql conn prepare statement preparestatement size sql sizesql prepared size sql preparedsizesql set string setstring get name getname rst prepared size sql preparedsizesql execute query executequery rst size rst get int getint block number of tries numberoftries sql exception sqlexception manager get container getcontainer get logger getlogger error get string getstring get store name getstorename sql exception sqlexception db connection dbconnection close db connection dbconnection rst rst close sql exception sqlexception release conn number of tries numberoftries size load session code code session code code returned param type code string code stored code session code exception class not found exception classnotfoundexception error occurs exception io exception ioexception input output error occurred override session load string class not found exception classnotfoundexception io exception ioexception result set resultset rst standard session standardsession session class loader classloader class loader classloader object input stream objectinputstream ois org apache catalina context context org apache catalina context manager get container getcontainer log container log containerlog context get logger getlogger loader loader context get loader getloader loader class loader classloader loader get class loader getclassloader number of tries numberoftries number of tries numberoftries connection conn get connection getconnection conn class loader classloader old thread context l oldthreadcontextcl thread current thread currentthread get context class loader getcontextclassloader prepared load sql preparedloadsql string load sql loadsql select session id col sessionidcol session data col sessiondatacol session table sessiontable session id col sessionidcol session app col sessionappcol prepared load sql preparedloadsql conn prepare statement preparestatement load sql loadsql prepared load sql preparedloadsql set string setstring prepared load sql preparedloadsql set string setstring get name getname rst prepared load sql preparedloadsql execute query executequery rst class loader classloader thread current thread currentthread set context class loader setcontextclassloader class loader classloader ois get object input stream getobjectinputstream rst get binary stream getbinarystream container log containerlog is debug enabled isdebugenabled container log containerlog debug get string getstring get store name getstorename loading session table sessiontable session standard session standardsession manager create empty session createemptysession session read object data readobjectdata ois session set manager setmanager manager container log containerlog is debug enabled isdebugenabled container log containerlog debug get store name getstorename persisted data object block number of tries numberoftries sql exception sqlexception container log containerlog error get string getstring get store name getstorename sql exception sqlexception db connection dbconnection close db connection dbconnection rst rst close sql exception sqlexception ois ois close io exception ioexception thread current thread currentthread set context class loader setcontextclassloader old thread context l oldthreadcontextcl release conn number of tries numberoftries session remove session session identifier store session method takes action param session identifier session removed exception io exception ioexception input output error occurs override remove string io exception ioexception number of tries numberoftries number of tries numberoftries connection conn get connection getconnection conn remove conn block number of tries numberoftries sql exception sqlexception manager get container getcontainer get logger getlogger error get string getstring get store name getstorename sql exception sqlexception db connection dbconnection close db connection dbconnection release conn number of tries numberoftries manager get container getcontainer get logger getlogger is debug enabled isdebugenabled manager get container getcontainer get logger getlogger debug get string getstring get store name getstorename removing session table sessiontable remove session session identifier store session method takes action param session identifier session removed param conn open connection sql exception sqlexception error occurs talking database remove string connection conn sql exception sqlexception prepared remove sql preparedremovesql string remove sql removesql delete session table sessiontable session id col sessionidcol session app col sessionappcol prepared remove sql preparedremovesql conn prepare statement preparestatement remove sql removesql prepared remove sql preparedremovesql set string setstring prepared remove sql preparedremovesql set string setstring get name getname prepared remove sql preparedremovesql execute remove sessions store exception io exception ioexception input output error occurs override clear io exception ioexception number of tries numberoftries number of tries numberoftries connection conn get connection getconnection conn prepared clear sql preparedclearsql string clear sql clearsql delete session table sessiontable session app col sessionappcol prepared clear sql preparedclearsql conn prepare statement preparestatement clear sql clearsql prepared clear sql preparedclearsql set string setstring get name getname prepared clear sql preparedclearsql execute block number of tries numberoftries sql exception sqlexception manager get container getcontainer get logger getlogger error get string getstring get store name getstorename sql exception sqlexception db connection dbconnection close db connection dbconnection release conn number of tries numberoftries save session store param session session stored exception io exception ioexception input output error occurs override save session session io exception ioexception object output stream objectoutputstream oos byte array output stream bytearrayoutputstream bos byte array input stream bytearrayinputstream bis input stream inputstream number of tries numberoftries number of tries numberoftries connection conn get connection getconnection conn sessions exist remove insert todo check exists database update remove session get id internal getidinternal conn bos byte array output stream bytearrayoutputstream oos object output stream objectoutputstream buffered output stream bufferedoutputstream bos standard session standardsession session write object data writeobjectdata oos oos close oos obs bos to byte array tobytearray size obs length bis byte array input stream bytearrayinputstream obs size buffered input stream bufferedinputstream bis size prepared save sql preparedsavesql string save sql savesql insert session table sessiontable session id col sessionidcol session app col sessionappcol session data col sessiondatacol session valid col sessionvalidcol session max inactive col sessionmaxinactivecol session last accessed col sessionlastaccessedcol values prepared save sql preparedsavesql conn prepare statement preparestatement save sql savesql prepared save sql preparedsavesql set string setstring session get id internal getidinternal prepared save sql preparedsavesql set string setstring get name getname prepared save sql preparedsavesql set binary stream setbinarystream size prepared save sql preparedsavesql set string setstring session is valid isvalid prepared save sql preparedsavesql set int setint session get max inactive interval getmaxinactiveinterval prepared save sql preparedsavesql set long setlong session get last accessed time getlastaccessedtime prepared save sql preparedsavesql execute block number of tries numberoftries sql exception sqlexception manager get container getcontainer get logger getlogger error get string getstring get store name getstorename sql exception sqlexception db connection dbconnection close db connection dbconnection io exception ioexception oos oos close bis bis close close release conn number of tries numberoftries manager get container getcontainer get logger getlogger is debug enabled isdebugenabled manager get container getcontainer get logger getlogger debug get string getstring get store name getstorename saving session get id internal getidinternal session table sessiontable methods check connection store code code closed reopen returns code code connection established code connection code connection succeeded connection get connection getconnection connection conn conn open conn conn is closed isclosed manager get container getcontainer get logger getlogger info get string getstring get store name getstorename checkconnectiondbclosed conn open conn conn is closed isclosed manager get container getcontainer get logger getlogger info get string getstring get store name getstorename check connection re open fail checkconnectiondbreopenfail sql exception sqlexception manager get container getcontainer get logger getlogger error get string getstring get store name getstorename checkconnectionsqlexception to string tostring conn open database connection store database connection ready exception sql exception sqlexception database error occurs connection open sql exception sqlexception database connection open db connection dbconnection db connection dbconnection data source name datasourcename data source datasource context init ctx initctx init ctx initctx initial context initialcontext context env ctx envctx context init ctx initctx lookup java comp env data source datasource data source datasource env ctx envctx lookup data source name datasourcename naming exception namingexception manager get container getcontainer get logger getlogger error get string getstring get store name getstorename wrong data source wrongdatasource data source name datasourcename data source datasource data source datasource get connection getconnection instantiate database driver driver clazz for name forname driver name drivername driver driver clazz new instance newinstance class not found exception classnotfoundexception manager get container getcontainer get logger getlogger error get string getstring get store name getstorename check connection class not found exception checkconnectionclassnotfoundexception to string tostring sql exception sqlexception instantiation exception instantiationexception manager get container getcontainer get logger getlogger error get string getstring get store name getstorename check connection class not found exception checkconnectionclassnotfoundexception to string tostring sql exception sqlexception illegal access exception illegalaccessexception manager get container getcontainer get logger getlogger error get string getstring get store name getstorename check connection class not found exception checkconnectionclassnotfoundexception to string tostring sql exception sqlexception open connection properties props properties connection name connectionname props user connection name connectionname connection password connectionpassword props password connection password connectionpassword db connection dbconnection driver connect connectionurl props db connection dbconnection set auto commit setautocommit db connection dbconnection close database connection param db connection dbconnection connection closed close connection db connection dbconnection database connection closed db connection dbconnection close prepared statements prepared size sql preparedsizesql close throwable exception utils exceptionutils handle throwable handlethrowable prepared size sql preparedsizesql prepared save sql preparedsavesql close throwable exception utils exceptionutils handle throwable handlethrowable prepared save sql preparedsavesql prepared clear sql preparedclearsql close throwable exception utils exceptionutils handle throwable handlethrowable prepared remove sql preparedremovesql close throwable exception utils exceptionutils handle throwable handlethrowable prepared remove sql preparedremovesql prepared load sql preparedloadsql close throwable exception utils exceptionutils handle throwable handlethrowable prepared load sql preparedloadsql commit auto commit autocommit db connection dbconnection get auto commit getautocommit db connection dbconnection commit sql exception sqlexception manager get container getcontainer get logger getlogger error get string getstring get store name getstorename commitsqlexception close database connection log errors db connection dbconnection close sql exception sqlexception manager get container getcontainer get logger getlogger error get string getstring get store name getstorename close to string tostring db connection dbconnection release connection connection pool param conn connection released release connection conn data source datasource close conn start component implement requirements link org apache catalina util lifecycle base lifecyclebase start internal startinternal exception lifecycle exception lifecycleexception component detects fatal error prevents component override start internal startinternal lifecycle exception lifecycleexception data source name datasourcename connection pool open connection database db connection dbconnection get connection getconnection start internal startinternal component implement requirements link org apache catalina util lifecycle base lifecyclebase stop internal stopinternal exception lifecycle exception lifecycleexception component detects fatal error prevents component override stop internal stopinternal lifecycle exception lifecycleexception stop internal stopinternal close release db connection dbconnection db connection dbconnection commit sql exception sqlexception close db connection dbconnection