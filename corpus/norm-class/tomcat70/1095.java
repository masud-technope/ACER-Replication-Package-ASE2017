licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat jdbc test java sql connection java sql driver manager drivermanager java sql driver property info driverpropertyinfo java sql result set resultset java sql sql exception sqlexception java sql sql feature not supported exception sqlfeaturenotsupportedexception java sql statement java util properties java util logging logger org junit org junit org junit org junit test org apache tomcat jdbc pool int erceptor interceptor query timeout interceptor querytimeoutinterceptor test validation query timeout testvalidationquerytimeout default test case defaulttestcase timeout is timeout set istimeoutset string long query longquery select test test test test test set up setup sql exception sqlexception driver manager drivermanager register driver registerdriver mock driver mockdriver mock driver datasource set driver class name setdriverclassname mock driver mockdriver get name getname datasource set url seturl mock driver mockdriver url required trigger validation query execution datasource set initial size setinitialsize datasource set test on borrow settestonborrow datasource set validation interval setvalidationinterval datasource set validation query setvalidationquery select datasource set validation query timeout setvalidationquerytimeout timeout timeout is timeout set istimeoutset override tear down teardown sql exception sqlexception driver manager drivermanager deregister driver deregisterdriver mock driver mockdriver test test validation query timeout enabled testvalidationquerytimeoutenabled exception test on borrow testonborrow triggers validation query datasource get connection getconnection assert true asserttrue is timeout set istimeoutset test test validation query timeout disabled testvalidationquerytimeoutdisabled exception datasource set validation query timeout setvalidationquerytimeout test on borrow testonborrow triggers validation query datasource get connection getconnection assert false assertfalse is timeout set istimeoutset test test validation query timeout with query timeout interceptor testvalidationquerytimeoutwithquerytimeoutinterceptor exception int erceptor timeout interceptortimeout datasource set jdbc int erceptors setjdbcinterceptors query timeout interceptor querytimeoutinterceptor get name getname query timeout querytimeout int erceptor timeout interceptortimeout test on borrow testonborrow triggers validation query connection con datasource get connection getconnection assert true asserttrue is timeout set istimeoutset inc rease increase expected timeout int erceptor interceptor timeout create statement query timeout int erceptor interceptor statement con create statement createstatement assert equals assertequals int erceptor timeout interceptortimeout get query timeout getquerytimeout close con prepare statement preparestatement assert equals assertequals int erceptor timeout interceptortimeout get query timeout getquerytimeout close con prepare call preparecall assert equals assertequals int erceptor timeout interceptortimeout get query timeout getquerytimeout close con close pull connection check timeout is timeout set istimeoutset datasource get connection getconnection assert true asserttrue is timeout set istimeoutset test depends execution time validation query longer pass fails test expected sql exception sqlexception test validation query timeout on connection testvalidationquerytimeoutonconnection exception mock driver datasource set driver class name setdriverclassname org driver datasource set url seturl jdbc test query timeout close exit required trigger validation query execution datasource set test on connect settestonconnect datasource set validation interval setvalidationinterval datasource set validation query setvalidationquery long query longquery datasource set validation query timeout setvalidationquerytimeout datasource get connection getconnection test expected sql exception sqlexception test validation invalid on connection testvalidationinvalidonconnection exception mock driver datasource set driver class name setdriverclassname org driver datasource set url seturl jdbc test query timeout close exit required trigger validation query execution datasource set test on borrow settestonborrow datasource set initial size setinitialsize datasource set test on connect settestonconnect datasource set validation interval setvalidationinterval datasource set validation query setvalidationquery select datasource set validation query timeout setvalidationquerytimeout datasource get connection getconnection test test long validation query time testlongvalidationquerytime exception mock driver datasource set driver class name setdriverclassname org driver datasource set url seturl jdbc test query timeout close exit connection con datasource get connection getconnection statement stmt start stmt con create statement createstatement query timeout test slowing stmt set query timeout setquerytimeout query takes longer req uirement requirement tests properly start system current time millis currenttimemillis stmt execute long query longquery sql exception sqlexception system current time millis currenttimemillis stmt stmt close con con close assert true asserttrue start assert true asserttrue start test test validation query timeout on borrow testvalidationquerytimeoutonborrow exception mock driver datasource set driver class name setdriverclassname org driver datasource set url seturl jdbc test query timeout close exit required trigger validation query execution datasource set test on borrow settestonborrow datasource set validation interval setvalidationinterval datasource set validation query setvalidationquery long query longquery datasource set validation query timeout setvalidationquerytimeout validation query times connection connection con datasource get connection getconnection assert not null assertnotnull con statement con create statement createstatement result set resultset execute query executequery select close close con close mock driver connection statement implementations verify set query timeout setquerytimeout called mock driver mockdriver java sql driver string url jdbc tomcat mock mock driver mockdriver override acceptsurl string url sql exception sqlexception url url equals mock driver mockdriver url override connection connect string url properties info sql exception sqlexception mock connection mockconnection info override get major version getmajorversion override get minor version getminorversion override driver property info driverpropertyinfo get property info getpropertyinfo string url properties info sql exception sqlexception override jdbc compliant jdbccompliant code code sql feature not supported exception sqlfeaturenotsupportedexception logger get parent logger getparentlogger sql feature not supported exception sqlfeaturenotsupportedexception mock connection mockconnection org apache tomcat jdbc test driver connection mock connection mockconnection properties info info override statement create statement createstatement sql exception sqlexception mock statement mockstatement mock statement mockstatement org apache tomcat jdbc test driver statement override set query timeout setquerytimeout seconds sql exception sqlexception set query timeout setquerytimeout seconds assert equals assertequals timeout seconds is timeout set istimeoutset