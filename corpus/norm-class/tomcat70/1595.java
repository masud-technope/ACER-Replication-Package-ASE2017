licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina core java i o exception ioexception java print writer printwriter java security access controller accesscontroller java security privileged action exception privilegedactionexception java security privileged exception action privilegedexceptionaction javax servlet dispatcher type dispatchertype javax servlet request dispatcher requestdispatcher javax servlet servlet javax servlet servlet exception servletexception javax servlet servlet output stream servletoutputstream javax servlet servlet request servletrequest javax servlet servlet request wrapper servletrequestwrapper javax servlet servlet response servletresponse javax servlet servlet response wrapper servletresponsewrapper javax servlet unavailable exception unavailableexception javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse org apache catalina async dispatcher asyncdispatcher org apache catalina context org apache catalina globals org apache catalina instance event instanceevent org apache catalina wrapper org apache catalina connector client abort exception clientabortexception org apache catalina connector request org apache catalina connector request facade requestfacade org apache catalina connector response org apache catalina connector response facade responsefacade org apache catalina util instance support instancesupport org apache tomcat util exception utils exceptionutils org apache tomcat util res string manager stringmanager standard implementation code request dispatcher requestdispatcher code request for warded forwarded resource create ultimate response include output resource response resource implementation application level servlets wrap request response objects passed called resource wrapping classes extend code javax servlet servlet request wrapper servletrequestwrapper code code javax servlet servlet response wrapper servletresponsewrapper code author craig mc clanahan mcclanahan application dispatcher applicationdispatcher async dispatcher asyncdispatcher request dispatcher requestdispatcher strict servlet compliance wrap object strict servlet compliance globals strict servlet compliance string wrap same object wrapsameobject system get property getproperty org apache catalina core application dispatcher applicationdispatcher wrap object wrap same object wrapsameobject wrap object strict servlet compliance wrap object parse boolean parseboolean wrap same object wrapsameobject privileged for ward privilegedforward privileged exception action privilegedexceptionaction servlet request servletrequest request servlet response servletresponse response privileged for ward privilegedforward servlet request servletrequest request servlet response servletresponse response request request response response override java lang exception do for ward doforward request response privileged include privilegedinclude privileged exception action privilegedexceptionaction servlet request servletrequest request servlet response servletresponse response privileged include privilegedinclude servlet request servletrequest request servlet response servletresponse response request request response response override servlet exception servletexception i o exception ioexception do include doinclude request response privileged dispatch privilegeddispatch privileged exception action privilegedexceptionaction servlet request servletrequest request servlet response servletresponse response privileged dispatch privilegeddispatch servlet request servletrequest request servlet response servletresponse response request request response response override servlet exception servletexception i o exception ioexception do dispatch dodispatch request response pass request dispatcher instance variables thr eading threading issues complex pass single servlet request servletrequest servlet response servletresponse objects servlet request servletrequest request servlet response servletresponse response including outer request outerrequest request outer response outerresponse response including including outer most outermost request passed invoked servlet servlet request servletrequest outer request outerrequest outer most outermost response passed invoked servlet servlet response servletresponse outer response outerresponse request wrapper created installed servlet request servletrequest wrap request wraprequest response wrapper created installed servlet response servletresponse wrap response wrapresponse performing include including outer most outermost http servlet request httpservletrequest chain http servlet request httpservletrequest hrequest outer most outermost http servlet response httpservletresponse chain http servlet response httpservletresponse hresponse construct instance configured parameters servlet path servletpath path info pathinfo code code assumed request dispatcher requestdispatcher acquired path param wrapper wrapper resource for warded forwarded included required param requesturi request uri resource param servlet path servletpath revised servlet path resource param path info pathinfo revised extra path resource param query string querystring query string parameters included request param servlet named dispatcher created code code application dispatcher applicationdispatcher wrapper wrapper string requesturi string servlet path servletpath string path info pathinfo string query string querystring string save configuration parameters wrapper wrapper context context wrapper get parent getparent requesturi requesturi servlet path servletpath servlet path servletpath path info pathinfo path info pathinfo query string querystring query string querystring wrapper standard wrapper standardwrapper support standard wrapper standardwrapper wrapper get instance support getinstancesupport support instance support instancesupport wrapper instance variables context request dispatcher requestdispatcher context context descriptive implementation string info org apache catalina core application dispatcher applicationdispatcher servlet named dispatcher string extra path request dispatcher requestdispatcher string path info pathinfo query string parameters request dispatcher requestdispatcher string query string querystring request uri request dispatcher requestdispatcher string requesturi servlet path request dispatcher requestdispatcher string servlet path servletpath string manager stringmanager string manager stringmanager string manager stringmanager get manager getmanager constants instance support instancesupport instance wrapper send dispatch dispatch events instance support instancesupport support wrapper resource for warded forwarded included wrapper wrapper properties descriptive implementation string get info getinfo info methods request response resource processing runtime exception i o exception ioexception servlet exception servletexception thrown called servlet prop agated propagated caller param request servlet request for warded forwarded param response servlet response for warded forwarded exception i o exception ioexception input output error occurs exception servlet exception servletexception servlet exception occurs override servlet request servletrequest request servlet response servletresponse response servlet exception servletexception i o exception ioexception globals security enabled privileged for ward privilegedforward privileged for ward privilegedforward request response access controller accesscontroller do privileged doprivileged privileged action exception privilegedactionexception exception get exception getexception servlet exception servletexception servlet exception servletexception i o exception ioexception do for ward doforward request response do for ward doforward servlet request servletrequest request servlet response servletresponse response servlet exception servletexception i o exception ioexception reset output buf fered buffered headers cookies response is committed iscommitted illegal state exception illegalstateexception get string getstring application dispatcher applicationdispatcher ise response reset buffer resetbuffer illegal state exception illegalstateexception handle request response request response wrap object check srv srv compliance check same objects checksameobjects request response wrap response wrapresponse handle http named dispatcher servlet path servletpath path info pathinfo application http request applicationhttprequest wrequest application http request applicationhttprequest wrap request wraprequest http servlet request httpservletrequest hrequest hrequest wrequest setrequesturi hrequest getrequesturi wrequest set context path setcontextpath hrequest get context path getcontextpath wrequest set servlet path setservletpath hrequest get servlet path getservletpath wrequest set path info setpathinfo hrequest get path info getpathinfo wrequest set query string setquerystring hrequest get query string getquerystring process request processrequest request response handle http path based application http request applicationhttprequest wrequest application http request applicationhttprequest wrap request wraprequest string context path contextpath context get path getpath http servlet request httpservletrequest hrequest hrequest hrequest get attribute getattribute request dispatcher requestdispatcher request uri wrequest set attribute setattribute request dispatcher requestdispatcher request uri hrequest getrequesturi wrequest set attribute setattribute request dispatcher requestdispatcher context path hrequest get context path getcontextpath wrequest set attribute setattribute request dispatcher requestdispatcher servlet path hrequest get servlet path getservletpath wrequest set attribute setattribute request dispatcher requestdispatcher path info hrequest get path info getpathinfo wrequest set attribute setattribute request dispatcher requestdispatcher query string hrequest get query string getquerystring wrequest set context path setcontextpath context path contextpath wrequest setrequesturi requesturi wrequest set servlet path setservletpath servlet path servletpath wrequest set path info setpathinfo path info pathinfo query string querystring wrequest set query string setquerystring query string querystring wrequest set query params setqueryparams query string querystring process request processrequest request response request is async started isasyncstarted response written async handling real close order support error processing wrapper get logger getlogger is debug enabled isdebugenabled wrapper get logger getlogger debug disabling response futher output response response facade responsefacade response facade responsefacade response finish longer instance request facade requestfacade wrapper get logger getlogger is debug enabled isdebugenabled wrapper get logger getlogger debug response vehiculed wrapper response get class getclass get name getname close print writer printwriter writer response get writer getwriter writer close illegal state exception illegalstateexception servlet output stream servletoutputstream stream response get output stream getoutputstream stream close illegal state exception illegalstateexception i o exception ioexception i o exception ioexception prepare request based filter configuration param request servlet request processing param response servlet response creating param exception i o exception ioexception input output error occurs exception servlet exception servletexception servlet error occurs process request processrequest servlet request servletrequest request servlet response servletresponse response i o exception ioexception servlet exception servletexception dispatcher type dispatchertype dis int disint dispatcher type dispatchertype request get attribute getattribute globals dispatcher type attr dis int disint do invoke doinvoke context get fire request listeners on for war ds getfirerequestlistenersonforwards context fire request init event firerequestinitevent request do invoke doinvoke do invoke doinvoke dis int disint dispatcher type dispatchertype error outer request outerrequest set attribute setattribute globals dispatcher request path attr get combined path getcombinedpath outer request outerrequest set attribute setattribute globals dispatcher type attr dispatcher type dispatchertype invoke outer request outerrequest response invoke outer request outerrequest response context get fire request listeners on for war ds getfirerequestlistenersonforwards context fire request destroy event firerequestdestroyevent request combine servlet path servletpath path info pathinfo path info pathinfo code code servlet path servletpath code code code code returned combined path path info pathinfo appended servlet info servletinfo string get combined path getcombinedpath servlet path servletpath path info pathinfo servlet path servletpath servlet path servletpath path info pathinfo include response resource current response runtime exception i o exception ioexception servlet exception servletexception thrown called servlet prop agated propagated caller param request servlet request including param response servlet response appended exception i o exception ioexception input output error occurs exception servlet exception servletexception servlet exception occurs override include servlet request servletrequest request servlet response servletresponse response servlet exception servletexception i o exception ioexception globals security enabled privileged include privilegedinclude privileged include privilegedinclude request response access controller accesscontroller do privileged doprivileged privileged action exception privilegedactionexception exception get exception getexception servlet exception servletexception servlet exception servletexception i o exception ioexception do include doinclude request response do include doinclude servlet request servletrequest request servlet response servletresponse response servlet exception servletexception i o exception ioexception handle request response request response wrap object check srv srv compliance check same objects checksameobjects request response create wrapped response request wrap response wrapresponse handle http named dispatcher include application http request applicationhttprequest wrequest application http request applicationhttprequest wrap request wraprequest wrequest set attribute setattribute globals name d named dispatcher attr servlet path servletpath wrequest set servlet path setservletpath servlet path servletpath wrequest set attribute setattribute globals dispatcher type attr dispatcher type dispatchertype include wrequest set attribute setattribute globals dispatcher request path attr get combined path getcombinedpath invoke outer request outerrequest outer response outerresponse handle http path based include application http request applicationhttprequest wrequest application http request applicationhttprequest wrap request wraprequest string context path contextpath context get path getpath requesturi wrequest set attribute setattribute request dispatcher requestdispatcher include request uri requesturi context path contextpath wrequest set attribute setattribute request dispatcher requestdispatcher include context path context path contextpath servlet path servletpath wrequest set attribute setattribute request dispatcher requestdispatcher include servlet path servlet path servletpath path info pathinfo wrequest set attribute setattribute request dispatcher requestdispatcher include path info path info pathinfo query string querystring wrequest set attribute setattribute request dispatcher requestdispatcher include query string query string querystring wrequest set query params setqueryparams query string querystring wrequest set attribute setattribute globals dispatcher type attr dispatcher type dispatchertype include wrequest set attribute setattribute globals dispatcher request path attr get combined path getcombinedpath invoke outer request outerrequest outer response outerresponse override dispatch servlet request servletrequest request servlet response servletresponse response servlet exception servletexception i o exception ioexception globals security enabled privileged dispatch privilegeddispatch privileged dispatch privilegeddispatch request response access controller accesscontroller do privileged doprivileged privileged action exception privilegedactionexception exception get exception getexception servlet exception servletexception servlet exception servletexception i o exception ioexception do dispatch dodispatch request response do dispatch dodispatch servlet request servletrequest request servlet response servletresponse response servlet exception servletexception i o exception ioexception handle request response request response create wrapped response request wrap response wrapresponse application http request applicationhttprequest wrequest application http request applicationhttprequest wrap request wraprequest query string querystring wrequest set query params setqueryparams query string querystring wrequest set attribute setattribute globals dispatcher type attr dispatcher type dispatchertype async wrequest set attribute setattribute globals dispatcher request path attr get combined path getcombinedpath wrequest set context path setcontextpath context get path getpath wrequest setrequesturi requesturi wrequest set servlet path setservletpath servlet path servletpath wrequest set path info setpathinfo path info pathinfo query string querystring wrequest set query string setquerystring query string querystring wrequest set query params setqueryparams query string querystring invoke outer request outerrequest outer response outerresponse methods resource represented request dispatcher requestdispatcher process request create append response strong implementation note strong implementation assumes filters applied for warded forwarded included resource original request param request servlet request processing param response servlet response creating exception i o exception ioexception input output error occurs exception servlet exception servletexception servlet error occurs invoke servlet request servletrequest request servlet response servletresponse response i o exception ioexception servlet exception servletexception checking context class loader classloader current context class loader classloader saving setting context class loader classloader context class loader classloader class loader classloader oldccl thread current thread currentthread get context class loader getcontextclassloader class loader classloader context class loader contextclassloader context get loader getloader get class loader getclassloader oldccl context class loader contextclassloader thread current thread currentthread set context class loader setcontextclassloader context class loader contextclassloader oldccl initialize local variables http servlet response httpservletresponse hresponse hresponse servlet servlet i o exception ioexception io exception ioexception servlet exception servletexception servlet exception servletexception runtime exception runtimeexception runtime exception runtimeexception unavailable check servlet marked unavailable wrapper is unavailable isunavailable wrapper get logger getlogger warn get string getstring application dispatcher applicationdispatcher is unavailable isunavailable wrapper get name getname wrapper get available getavailable max hresponse set date header setdateheader retry hresponse send error senderror http servlet response httpservletresponse service unavailable get string getstring application dispatcher applicationdispatcher is unavailable isunavailable wrapper get name getname unavailable all ocate allocate servlet instance process request unavailable servlet wrapper all ocate allocate servlet exception servletexception wrapper get logger getlogger error get string getstring application dispatcher applicationdispatcher all ocate exception allocateexception wrapper get name getname standard wrapper standardwrapper get root cause getrootcause servlet exception servletexception throwable exception utils exceptionutils handle throwable handlethrowable wrapper get logger getlogger error get string getstring application dispatcher applicationdispatcher all ocate exception allocateexception wrapper get name getname servlet exception servletexception servlet exception servletexception get string getstring application dispatcher applicationdispatcher all ocate exception allocateexception wrapper get name getname servlet filter chain filterchain application filter factory applicationfilterfactory factory application filter factory applicationfilterfactory get instance getinstance application filter chain applicationfilterchain filter chain filterchain factory create filter chain createfilterchain request wrapper servlet call service method all ocated allocated servlet instance support fire instance event fireinstanceevent instance event instanceevent dispatch event servlet request response includes for wards forwards servlet filter chain filterchain filter chain filterchain do filter dofilter request response servlet service method called filter chain filterchain support fire instance event fireinstanceevent instance event instanceevent dispatch event servlet request response client abort exception clientabortexception support fire instance event fireinstanceevent instance event instanceevent dispatch event servlet request response io exception ioexception i o exception ioexception support fire instance event fireinstanceevent instance event instanceevent dispatch event servlet request response wrapper get logger getlogger error get string getstring application dispatcher applicationdispatcher service exception serviceexception wrapper get name getname io exception ioexception unavailable exception unavailableexception support fire instance event fireinstanceevent instance event instanceevent dispatch event servlet request response wrapper get logger getlogger error get string getstring application dispatcher applicationdispatcher service exception serviceexception wrapper get name getname servlet exception servletexception wrapper unavailable servlet exception servletexception support fire instance event fireinstanceevent instance event instanceevent dispatch event servlet request response throwable root cause rootcause standard wrapper standardwrapper get root cause getrootcause root cause rootcause client abort exception clientabortexception wrapper get logger getlogger error get string getstring application dispatcher applicationdispatcher service exception serviceexception wrapper get name getname root cause rootcause servlet exception servletexception runtime exception runtimeexception support fire instance event fireinstanceevent instance event instanceevent dispatch event servlet request response wrapper get logger getlogger error get string getstring application dispatcher applicationdispatcher service exception serviceexception wrapper get name getname runtime exception runtimeexception release filter chain request filter chain filterchain filter chain filterchain release throwable exception utils exceptionutils handle throwable handlethrowable wrapper get logger getlogger error get string getstring standard wrapper standardwrapper release filters releasefilters wrapper get name getname deallocate all ocated allocated servlet instance servlet wrapper deallocate servlet servlet exception servletexception wrapper get logger getlogger error get string getstring application dispatcher applicationdispatcher deallocate exception deallocateexception wrapper get name getname servlet exception servletexception throwable exception utils exceptionutils handle throwable handlethrowable wrapper get logger getlogger error get string getstring application dispatcher applicationdispatcher deallocate exception deallocateexception wrapper get name getname servlet exception servletexception servlet exception servletexception get string getstring application dispatcher applicationdispatcher deallocate exception deallocateexception wrapper get name getname reset context loader oldccl thread current thread currentthread set context class loader setcontextclassloader oldccl unwrap request response needed bug zilla bugzilla unwrap request unwraprequest unwrap response unwrapresponse recycle request recycle request wrapper recyclerequestwrapper rethrow exception thrown invoked servlet io exception ioexception io exception ioexception servlet exception servletexception servlet exception servletexception runtime exception runtimeexception runtime exception runtimeexception unwrap request wrapped unwrap request unwraprequest wrap request wraprequest outer request outerrequest is async started isasyncstarted outer request outerrequest get async context getasynccontext has original request and response hasoriginalrequestandresponse servlet request servletrequest previous servlet request servletrequest current outer request outerrequest current container request current request current request facade requestfacade remove current request wrapper current wrap request wraprequest servlet request servletrequest servlet request wrapper servletrequestwrapper current get request getrequest previous outer request outerrequest servlet request wrapper servletrequestwrapper previous set request setrequest advance request chain previous current current servlet request wrapper servletrequestwrapper current get request getrequest unwrap response wrapped unwrap response unwrapresponse wrap response wrapresponse outer request outerrequest is async started isasyncstarted outer request outerrequest get async context getasynccontext has original request and response hasoriginalrequestandresponse servlet response servletresponse previous servlet response servletresponse current outer response outerresponse current container response current response current response facade responsefacade remove current response wrapper current wrap response wrapresponse servlet response servletresponse servlet response wrapper servletresponsewrapper current get response getresponse previous outer response outerresponse servlet response wrapper servletresponsewrapper previous set response setresponse advance response chain previous current current servlet response wrapper servletresponsewrapper current get response getresponse create request wrapper inserted spot request chain servlet request servletrequest wrap request wraprequest locate request insert front servlet request servletrequest previous servlet request servletrequest current outer request outerrequest current hrequest current http servlet request httpservletrequest hrequest http servlet request httpservletrequest current current servlet request wrapper servletrequestwrapper current application http request applicationhttprequest current application request applicationrequest previous current current servlet request wrapper servletrequestwrapper current get request getrequest instantiate wrapper point insert chain servlet request servletrequest wrapper current application http request applicationhttprequest current request current http servlet request httpservletrequest compute cross context crosscontext flag http servlet request httpservletrequest hcurrent http servlet request httpservletrequest current cross context crosscontext outer request outerrequest application http request applicationhttprequest outer request outerrequest request outer request outerrequest http servlet request httpservletrequest http servlet request httpservletrequest houter request houterrequest http servlet request httpservletrequest outer request outerrequest object context path contextpath houter request houterrequest get attribute getattribute request dispatcher requestdispatcher include context path context path contextpath context path contextpath houter request houterrequest get context path getcontextpath cross context crosscontext context get path getpath equals context path contextpath wrapper application http request applicationhttprequest hcurrent context cross context crosscontext wrapper application request applicationrequest current previous outer request outerrequest wrapper servlet request wrapper servletrequestwrapper previous set request setrequest wrapper wrap request wraprequest wrapper wrapper create response wrapper inserted spot response chain servlet response servletresponse wrap response wrapresponse locate response insert front servlet response servletresponse previous servlet response servletresponse current outer response outerresponse current hresponse current http servlet response httpservletresponse hresponse http servlet response httpservletresponse current hresponse including current servlet response wrapper servletresponsewrapper current application http response applicationhttpresponse current application response applicationresponse previous current current servlet response wrapper servletresponsewrapper current get response getresponse instantiate wrapper point insert chain servlet response servletresponse wrapper current application http response applicationhttpresponse current response current http servlet response httpservletresponse wrapper application http response applicationhttpresponse http servlet response httpservletresponse current including wrapper application response applicationresponse current including previous outer response outerresponse wrapper servlet response wrapper servletresponsewrapper previous set response setresponse wrapper wrap response wrapresponse wrapper wrapper check same objects checksameobjects servlet request servletrequest app request apprequest servlet response servletresponse app response appresponse servlet exception servletexception servlet request servletrequest original request originalrequest application filter chain applicationfilterchain get last service d request getlastservicedrequest servlet response servletresponse original response originalresponse application filter chain applicationfilterchain get last service d response getlastservicedresponse for wards forwards valves original values original request originalrequest original response originalresponse servlet request servletrequest dispatched request dispatchedrequest app request apprequest find request passed service method original request originalrequest servlet request wrapper servletrequestwrapper servlet request wrapper servletrequestwrapper original request originalrequest get request getrequest original request originalrequest servlet request wrapper servletrequestwrapper original request originalrequest get request getrequest compare dispatched request original request originalrequest equals dispatched request dispatchedrequest dispatched request dispatchedrequest servlet request wrapper servletrequestwrapper dispatched request dispatchedrequest servlet request wrapper servletrequestwrapper dispatched request dispatchedrequest get request getrequest servlet exception servletexception get string getstring application dispatcher applicationdispatcher spec violation specviolation request servlet response servletresponse dispatched response dispatchedresponse app response appresponse find response passed service method original response originalresponse servlet response wrapper servletresponsewrapper servlet response wrapper servletresponsewrapper original response originalresponse get response getresponse original response originalresponse servlet response wrapper servletresponsewrapper original response originalresponse get response getresponse compare dispatched response original response originalresponse equals dispatched response dispatchedresponse dispatched response dispatchedresponse servlet response wrapper servletresponsewrapper dispatched response dispatchedresponse servlet response wrapper servletresponsewrapper dispatched response dispatchedresponse get response getresponse servlet exception servletexception get string getstring application dispatcher applicationdispatcher spec violation specviolation response recycle request wrapper recyclerequestwrapper wrap request wraprequest application http request applicationhttprequest application http request applicationhttprequest wrap request wraprequest recycle