licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat websocket java eof exception eofexception java file java file input stream fileinputstream java io exception ioexception java input stream inputstream java net inet socket address inetsocketaddress java net proxy java net proxy selector proxyselector java net socket address socketaddress java net uri java nio byte buffer bytebuffer java nio channels asynchronous channel group asynchronouschannelgroup java nio channels asynchronous socket channel asynchronoussocketchannel java nio charset standard char sets standardcharsets java security key store keystore java util array list arraylist java util arrays java util collections java util hash map hashmap java util hash set hashset java util iterator java util list java util locale java util map java util map entry java util random java util java util concurrent concurrent hash map concurrenthashmap java util concurrent execution exception executionexception java util concurrent java util concurrent time unit timeunit java util concurrent timeout exception timeoutexception javax net ssl ssl context sslcontext javax net ssl ssl engine sslengine javax net ssl ssl exception sslexception javax net ssl trust manager factory trustmanagerfactory javax websocket client endpoint clientendpoint javax websocket client endpoint config clientendpointconfig javax websocket close reason closereason javax websocket close reason closereason close codes closecodes javax websocket deployment exception deploymentexception javax websocket endpoint javax websocket extension javax websocket handshake response handshakeresponse javax websocket session javax websocket web socket container websocketcontainer org apache juli logging log org apache juli logging log factory logfactory org apache tomcat instance manager instancemanager org apache tomcat util code c codec binary base org apache tomcat util res string manager stringmanager org apache tomcat websocket pojo pojo endpoint client pojoendpointclient ws web socket container wswebsocketcontainer web socket container websocketcontainer background process backgroundprocess property configure passed link ssl engine sslengine set enabled protocols setenabledprotocols string comma separated string string ssl protocols property org apache tomcat websocket ssl protocols string ssl truststore property org apache tomcat websocket ssl truststore string ssl truststore pwd property org apache tomcat websocket ssl truststore pwd string ssl truststore pwd change it changeit property configure ssl context sslcontext instance ssl context sslcontext property ssl truststore properties string ssl context property org apache tomcat websocket ssl context property configure timeout milliseconds establishing web socket websocket connection server link timeout string timeout property org apache tomcat websocket timeout timeout string manager stringmanager string manager stringmanager get manager getmanager constants random random random crlf bytes get bytes getbytes standard char sets standardcharsets iso root uri bytes get bytes getbytes standard char sets standardcharsets iso http version bytes http get bytes getbytes standard char sets standardcharsets iso asynchronous channel group asynchronouschannelgroup asynchronous channel group asynchronouschannelgroup object asynchronous channel group lock asynchronouschannelgrouplock object log log log factory logfactory get log getlog ws web socket container wswebsocketcontainer map endpoint ws session wssession endpoint session map endpointsessionmap hash map hashmap endpoint ws session wssession map ws session wssession ws session wssession sessions concurrent hash map concurrenthashmap ws session wssession ws session wssession object end point session map lock endpointsessionmaplock object default async timeout defaultasynctimeout max binary message buffer size maxbinarymessagebuffersize constants buffer size max text message buffer size maxtextmessagebuffersize constants buffer size default max session idle timeout defaultmaxsessionidletimeout background process count backgroundprocesscount process period processperiod constants process period instance manager instancemanager instance manager instancemanager instance manager instancemanager get instance manager getinstancemanager instance manager instancemanager set instance manager setinstancemanager instance manager instancemanager instance manager instancemanager instance manager instancemanager instance manager instancemanager override session connect to server connecttoserver object pojo uri path deployment exception deploymentexception client endpoint clientendpoint annotation pojo get class getclass get annotation getannotation client endpoint clientendpoint annotation deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer missing annotation missingannotation pojo get class getclass get name getname endpoint pojo endpoint client pojoendpointclient pojo arrays as list aslist annotation decoders client endpoint config clientendpointconfig configurator configurator clazz configuratorclazz annotation configurator client endpoint config clientendpointconfig configurator configurator client endpoint config clientendpointconfig configurator equals configurator clazz configuratorclazz configurator configurator clazz configuratorclazz new instance newinstance instantiation exception instantiationexception deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer default configurator fail defaultconfiguratorfail illegal access exception illegalaccessexception deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer default configurator fail defaultconfiguratorfail client endpoint config clientendpointconfig builder builder client endpoint config clientendpointconfig builder create avoid npe api jar configurator builder configurator configurator client endpoint config clientendpointconfig config builder decoders arrays as list aslist annotation decoders encoders arrays as list aslist annotation encoders preferred sub protocols preferredsubprotocols arrays as list aslist annotation sub protocols subprotocols build connect to server connecttoserver config path override session connect to server connecttoserver annotated endpoint class annotatedendpointclass uri path deployment exception deploymentexception object pojo pojo annotated endpoint class annotatedendpointclass new instance newinstance instantiation exception instantiationexception deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer endpoint create fail endpointcreatefail annotated endpoint class annotatedendpointclass get name getname illegal access exception illegalaccessexception deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer endpoint create fail endpointcreatefail annotated endpoint class annotatedendpointclass get name getname connect to server connecttoserver pojo path override session connect to server connecttoserver endpoint clazz client endpoint config clientendpointconfig client endpoint configuration clientendpointconfiguration uri path deployment exception deploymentexception endpoint endpoint endpoint clazz new instance newinstance instantiation exception instantiationexception deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer endpoint create fail endpointcreatefail clazz get name getname illegal access exception illegalaccessexception deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer endpoint create fail endpointcreatefail clazz get name getname connect to server connecttoserver endpoint client endpoint configuration clientendpointconfiguration path override session connect to server connecttoserver endpoint endpoint client endpoint config clientendpointconfig client endpoint configuration clientendpointconfiguration uri path deployment exception deploymentexception secure byte buffer bytebuffer proxy connect proxyconnect uri proxy path proxypath validate scheme build proxy path proxypath string scheme path get scheme getscheme equals ignore case equalsignorecase scheme proxy path proxypath uri create http path to string tostring substring wss equals ignore case equalsignorecase scheme proxy path proxypath uri create https path to string tostring substring secure deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer path wrong scheme pathwrongscheme scheme validate host string host path get host gethost host deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer path no host pathnohost port path get port getport socket address socketaddress check proxy configured javadoc list proxy proxies proxy selector proxyselector get default getdefault select proxy path proxypath proxy selected proxy selectedproxy proxy proxy proxies proxy type equals proxy type http proxy add ress address inet socket address inetsocketaddress inet socket address inetsocketaddress inet inet socket address inetsocketaddress inet is unresolved isunresolved inet socket address inetsocketaddress inet get host name gethostname inet get port getport selected proxy selectedproxy proxy proxy configured create port equals ignore case equalsignorecase scheme inet socket address inetsocketaddress host wss scheme validation inet socket address inetsocketaddress host inet socket address inetsocketaddress host port proxy connect proxyconnect create proxy request createproxyrequest host port create initial http request open web socket websocket connection map string list string req headers reqheaders create request headers createrequestheaders host port client endpoint configuration clientendpointconfiguration get preferred sub protocols getpreferredsubprotocols client endpoint configuration clientendpointconfiguration get extensions getextensions client endpoint configuration clientendpointconfiguration get configurator getconfigurator before request beforerequest req headers reqheaders constants origin header req headers reqheaders contains key containskey constants origin header list string origin values originvalues array list arraylist string origin values originvalues add constants origin header req headers reqheaders constants origin header origin values originvalues byte buffer bytebuffer request create request createrequest path req headers reqheaders asynchronous socket channel asynchronoussocketchannel socket channel socketchannel socket channel socketchannel asynchronous socket channel asynchronoussocketchannel open get asynchronous channel group getasynchronouschannelgroup io exception ioexception ioe deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer asynchronous socket channel fail asynchronoussocketchannelfail ioe connection timeout timeout timeout string timeout value timeoutvalue string client endpoint configuration clientendpointconfiguration get user properties getuserproperties timeout property timeout value timeoutvalue timeout value of valueof timeout value timeoutvalue int value intvalue size ws frame wsframe input buffer byte buffer bytebuffer response byte buffer bytebuffer all ocate allocate max binary message buffer size maxbinarymessagebuffersize string sub protocol subprotocol success list extension extensions agreed extensionsagreed array list arraylist extension transformation transformation open connection f connect fconnect socket channel socketchannel connect async channel wrapper asyncchannelwrapper channel proxy connect proxyconnect f connect fconnect timeout time unit timeunit milliseconds proxy connect clear text channel async channel wrapper non secure asyncchannelwrappernonsecure socket channel socketchannel write request writerequest channel proxy connect proxyconnect timeout http response httpresponse http response httpresponse process response processresponse response channel timeout http response httpresponse get status getstatus deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer proxy connect fail proxyconnectfail selected proxy selectedproxy integer to string tostring http response httpresponse get status getstatus exception channel channel close deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer http request failed httprequestfailed secure secure wrapper created proxy connect tls point wrap original asynchronous socket channel asynchronoussocketchannel ssl engine sslengine ssl engine sslengine createsslengine client endpoint configuration clientendpointconfiguration get user properties getuserproperties channel async channel wrapper secure asyncchannelwrappersecure socket channel socketchannel ssl engine sslengine channel wrap point was n wasn wrapped process proxy connect channel async channel wrapper non secure asyncchannelwrappernonsecure socket channel socketchannel f connect fconnect timeout time unit timeunit milliseconds f handshake fhandshake channel handshake f handshake fhandshake timeout time unit timeunit milliseconds write request writerequest channel request timeout http response httpresponse http response httpresponse process response processresponse response channel timeout todo handle redirects http response httpresponse status deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer invalid status invalidstatus integer to string tostring http response httpresponse status handshake response handshakeresponse handshake response handshakeresponse http response httpresponse get handshake response gethandshakeresponse client endpoint configuration clientendpointconfiguration get configurator getconfigurator after response afterresponse handshake response handshakeresponse protocol list string protocol headers protocolheaders handshake response handshakeresponse get headers getheaders constants protocol header protocol headers protocolheaders protocol headers protocolheaders size sub protocol subprotocol protocol headers protocolheaders size sub protocol subprotocol protocol headers protocolheaders deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer invalid sub protocol invalidsubprotocol extensions header handle multiple headers list string ext headers extheaders handshake response handshakeresponse get headers getheaders constants extensions header ext headers extheaders string ext header extheader ext headers extheaders util parse extension header parseextensionheader extensions agreed extensionsagreed ext header extheader build transformations transformation factory transformationfactory factory transformation factory transformationfactory get instance getinstance extension extension extensions agreed extensionsagreed list list extension parameter wrapper array list arraylist list extension parameter wrapper add extension get parameters getparameters transformation factory create extension get name getname wrapper deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer invalid extension parameters invalidextensionparameters transformation transformation transformation set next setnext success execution exception executionexception deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer http request failed httprequestfailed interrupted exception interruptedexception deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer http request failed httprequestfailed ssl exception sslexception deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer http request failed httprequestfailed eof exception eofexception deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer http request failed httprequestfailed timeout exception timeoutexception deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer http request failed httprequestfailed success channel close web socket websocket ws remote endpoint impl client wsremoteendpointimplclient ws remote endpoint client wsremoteendpointclient ws remote endpoint impl client wsremoteendpointimplclient channel ws session wssession ws session wssession ws session wssession endpoint ws remote endpoint client wsremoteendpointclient extensions agreed extensionsagreed sub protocol subprotocol collections string string empty map emptymap secure client endpoint configuration clientendpointconfiguration ws frame client wsframeclient ws frame client wsframeclient ws frame client wsframeclient response channel ws session wssession transformation ws frame wsframe adds transformations copy completed transformation chain remote point ws remote endpoint client wsremoteendpointclient set transformation settransformation ws frame client wsframeclient get transformation gettransformation endpoint on open onopen ws session wssession client endpoint configuration clientendpointconfiguration register session registersession endpoint ws session wssession server messages web socket websocket connection established depending exact timing messages sat input buffer waiting read trigger data read event process input buffer note current thread thread on message onmessage not ifications notifications special sub sequent subsequent data read events handled threads async channel group asyncchannelgroup executor ws frame client wsframeclient start input processing startinputprocessing ws session wssession write request writerequest async channel wrapper asyncchannelwrapper channel byte buffer bytebuffer request timeout timeout exception timeoutexception interrupted exception interruptedexception execution exception executionexception to write towrite request limit integer f write fwrite channel write request integer this write thiswrite f write fwrite timeout time unit timeunit milliseconds to write towrite this write thiswrite int value intvalue to write towrite f write fwrite channel write request this write thiswrite f write fwrite timeout time unit timeunit milliseconds to write towrite this write thiswrite int value intvalue byte buffer bytebuffer create proxy request createproxyrequest string host port string builder stringbuilder request string builder stringbuilder request append connect request append host port request append request append port request append http n proxy nproxy connection alive n connection nconnection keep alive keepalive n host nhost request append host port request append request append port request append bytes request to string tostring get bytes getbytes standard char sets standardcharsets iso byte buffer bytebuffer wrap bytes register session registersession endpoint endpoint ws session wssession ws session wssession ws session wssession is open isopen session closed on open onopen register end point session map lock endpointsessionmaplock endpoint session map endpointsessionmap size background process manager backgroundprocessmanager get instance getinstance register ws session wssession ws sessions wssessions endpoint session map endpointsessionmap endpoint ws sessions wssessions ws sessions wssessions hash set hashset ws session wssession endpoint session map endpointsessionmap endpoint ws sessions wssessions ws sessions wssessions add ws session wssession sessions ws session wssession ws session wssession unregister session unregistersession endpoint endpoint ws session wssession ws session wssession end point session map lock endpointsessionmaplock ws session wssession ws sessions wssessions endpoint session map endpointsessionmap endpoint ws sessions wssessions ws sessions wssessions remove ws session wssession ws sessions wssessions size endpoint session map endpointsessionmap remove endpoint endpoint session map endpointsessionmap size background process manager backgroundprocessmanager get instance getinstance unregister sessions remove ws session wssession session get open sessions getopensessions endpoint endpoint hash set hashset session result hash set hashset session end point session map lock endpointsessionmaplock ws session wssession sessions endpoint session map endpointsessionmap endpoint sessions result add all addall sessions result map string list string create request headers createrequestheaders string host port list string sub protocols subprotocols list extension extensions map string list string headers hash map hashmap string list string host header list string host values hostvalues array list arraylist string port host values hostvalues add host host values hostvalues add host port headers constants host header host values hostvalues upgrade header list string upgrade values upgradevalues array list arraylist string upgrade values upgradevalues add constants upgrade header headers constants upgrade header upgrade values upgradevalues connection header list string connection values connectionvalues array list arraylist string connection values connectionvalues add constants connection header headers constants connection header connection values connectionvalues web socket websocket version header list string ws version values wsversionvalues array list arraylist string ws version values wsversionvalues add constants version header headers constants version header ws version values wsversionvalues web socket websocket key list string ws key values wskeyvalues array list arraylist string ws key values wskeyvalues add generate ws key value generatewskeyvalue headers constants key header ws key values wskeyvalues web socket websocket protocols sub protocols subprotocols sub protocols subprotocols size headers constants protocol header sub protocols subprotocols web socket websocket extensions extensions extensions size headers constants extensions header generate extension headers generateextensionheaders extensions headers list string generate extension headers generateextensionheaders list extension extensions list string result array list arraylist string extensions size extension extension extensions string builder stringbuilder header string builder stringbuilder header append extension get name getname extension parameter param extension get parameters getparameters header append header append param get name getname string param get value getvalue length header append header append result add header to string tostring result string generate ws key value generatewskeyvalue key bytes keybytes random next bytes nextbytes key bytes keybytes base encode base encodebase string key bytes keybytes byte buffer bytebuffer create request createrequest uri uri map string list string req headers reqheaders byte buffer bytebuffer result byte buffer bytebuffer all ocate allocate request result bytes path uri get path getpath equals uri get path getpath root uri bytes uri get raw path getrawpath get bytes getbytes standard char sets standardcharsets iso result path string query uri get raw query getrawquery query result result query get bytes getbytes standard char sets standardcharsets iso result http version bytes headers iterator entry string list string iter req headers reqheaders entry set entryset iterator iter has next hasnext entry string list string entry iter add header addheader result entry get key getkey entry get value getvalue terminating crlf result crlf result flip result add header addheader byte buffer bytebuffer result string key list string values string builder stringbuilder string builder stringbuilder iterator string iter values iterator iter has next hasnext append iter iter has next hasnext append append iter result key get bytes getbytes standard char sets standardcharsets iso result get bytes getbytes standard char sets standardcharsets iso result to string tostring get bytes getbytes standard char sets standardcharsets iso result crlf process response blocking http response fully received execution exception executionexception interrupted exception interruptedexception deployment exception deploymentexception timeout exception timeoutexception http response httpresponse process response processresponse byte buffer bytebuffer response async channel wrapper asyncchannelwrapper channel timeout interrupted exception interruptedexception execution exception executionexception deployment exception deploymentexception eof exception eofexception timeout exception timeoutexception map string list string headers case ins ensitive key map caseinsensitivekeymap list string status read status readstatus read headers readheaders string read headers readheaders entering loop buffer empty start loop buffer fully read response clear blocking read integer read channel read response integer bytes read bytesread read timeout time unit timeunit milliseconds bytes read bytesread int value intvalue eof exception eofexception response flip response has remaining hasremaining read headers readheaders read line readline response read line readline response equals read headers readheaders ends with endswith read status readstatus parse headers parseheaders headers status parse status parsestatus read status readstatus http response httpresponse status ws handshake response wshandshakeresponse headers parse status parsestatus string deployment exception deploymentexception client under stands understands http rfc specific string parts trim split connect proxy response parts length http equals parts http equals parts deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer invalid status invalidstatus integer parse int parseint parts number format exception numberformatexception nfe deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer invalid status invalidstatus parse headers parseheaders string map string list string headers treat headers single values index of indexof log warn get string getstring ws web socket container wswebsocketcontainer invalid header invalidheader header names insensitive string header name headername substring trim to lower case tolowercase locale english multi headers stored single header client expected handle split ting splitting individual values string header value headervalue substring trim list string values headers header name headername values values array list arraylist string headers header name headername values values add header value headervalue string read line readline byte buffer bytebuffer response iso string builder stringbuilder string builder stringbuilder response has remaining hasremaining response append to string tostring ssl engine sslengine createsslengine map string object user properties userproperties deployment exception deploymentexception custom ssl context sslcontext ssl context sslcontext ssl context sslcontext ssl context sslcontext user properties userproperties ssl context property ssl context sslcontext create ssl context ssl context sslcontext ssl context sslcontext get instance getinstance tls trust store string ssl trust store value ssltruststorevalue string user properties userproperties ssl truststore property ssl trust store value ssltruststorevalue string ssl trust store pwd value ssltruststorepwdvalue string user properties userproperties ssl truststore pwd property ssl trust store pwd value ssltruststorepwdvalue ssl trust store pwd value ssltruststorepwdvalue ssl truststore pwd file key store file keystorefile file ssl trust store value ssltruststorevalue key store keystore key store keystore get instance getinstance jks input stream inputstream file input stream fileinputstream key store file keystorefile load ssl trust store pwd value ssltruststorepwdvalue to char array tochararray close io exception ioexception ioe trust manager factory trustmanagerfactory tmf trust manager factory trustmanagerfactory get instance getinstance trust manager factory trustmanagerfactory get default algorithm getdefaultalgorithm tmf init ssl context sslcontext init tmf get trust managers gettrustmanagers ssl context sslcontext init ssl engine sslengine engine ssl context sslcontext createsslengine string ssl protocols value sslprotocolsvalue string user properties userproperties ssl protocols property ssl protocols value sslprotocolsvalue engine set enabled protocols setenabledprotocols ssl protocols value sslprotocolsvalue split engine set use client mode setuseclientmode engine exception deployment exception deploymentexception get string getstring ws web socket container wswebsocketcontainer ssl engine fail sslenginefail override get default max session idle timeout getdefaultmaxsessionidletimeout default max session idle timeout defaultmaxsessionidletimeout override set default max session idle timeout setdefaultmaxsessionidletimeout timeout default max session idle timeout defaultmaxsessionidletimeout timeout override get default max binary message buffer size getdefaultmaxbinarymessagebuffersize max binary message buffer size maxbinarymessagebuffersize override set default max binary message buffer size setdefaultmaxbinarymessagebuffersize max max binary message buffer size maxbinarymessagebuffersize max override get default max text message buffer size getdefaultmaxtextmessagebuffersize max text message buffer size maxtextmessagebuffersize override set default max text message buffer size setdefaultmaxtextmessagebuffersize max max text message buffer size maxtextmessagebuffersize max inherit doc inheritdoc implementation support extensions override extension get installed extensions getinstalledextensions collections empty set emptyset inherit doc inheritdoc implementation override get default async send timeout getdefaultasyncsendtimeout default async timeout defaultasynctimeout inherit doc inheritdoc implementation override set async send timeout setasyncsendtimeout timeout default async timeout defaultasynctimeout timeout cleans resources web socket websocket sessions created container includes closing sessions can celling cancelling link blocking read writes destroy close reason closereason close reason closereason close codes closecodes get string getstring ws web socket container wswebsocketcontainer shutdown ws session wssession session sessions key set keyset session close io exception ioexception ioe log debug get string getstring ws web socket container wswebsocketcontainer session close fail sessionclosefail session get id getid ioe registered asynchronous channel group asynchronouschannelgroup asynchronous channel group lock asynchronouschannelgrouplock asynchronous channel group asynchronouschannelgroup async channel group util asyncchannelgrouputil unregister asynchronous channel group asynchronouschannelgroup asynchronous channel group asynchronouschannelgroup get asynchronous channel group getasynchronouschannelgroup async channel group util asyncchannelgrouputil share common group web socket websocket clients asynchronous channel group asynchronouschannelgroup result asynchronous channel group asynchronouschannelgroup result asynchronous channel group lock asynchronouschannelgrouplock asynchronous channel group asynchronouschannelgroup asynchronous channel group asynchronouschannelgroup async channel group util asyncchannelgrouputil register result asynchronous channel group asynchronouschannelgroup result background process backgroundprocess methods override background process backgroundprocess method called background process count backgroundprocesscount background process count backgroundprocesscount process period processperiod background process count backgroundprocesscount ws session wssession ws session wssession sessions key set keyset ws session wssession check expiration checkexpiration override set process period setprocessperiod period process period processperiod period inherit doc inheritdoc session exp irations expirations processed seconds override get process period getprocessperiod process period processperiod http response httpresponse status handshake response handshakeresponse handshake response handshakeresponse http response httpresponse status handshake response handshakeresponse handshake response handshakeresponse status status handshake response handshakeresponse handshake response handshakeresponse get status getstatus status handshake response handshakeresponse get handshake response gethandshakeresponse handshake response handshakeresponse