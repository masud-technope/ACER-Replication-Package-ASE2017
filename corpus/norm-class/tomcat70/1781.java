licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat jdbc test java lang management management factory managementfactory java sql callable statement callablestatement java sql connection java sql prepared statement preparedstatement java sql result set resultset java sql statement java util map java util concurrent atomic atomic integer atomicinteger javax management attribute change notification attributechangenotification javax management notification javax management notification listener notificationlistener org junit org junit test org apache tomcat jdbc pool connection pool connectionpool org apache tomcat jdbc pool int erceptor interceptor slow query report slowqueryreport org apache tomcat jdbc pool int erceptor interceptor slow query report jmx slowqueryreportjmx test slow query report testslowqueryreport default test case defaulttestcase test test slow sql testslowsql exception count init datasource set max active setmaxactive datasource set jdbc int erceptors setjdbcinterceptors slow query report slowqueryreport get name getname threshold connection con datasource get connection getconnection string slow sql slowsql select count test val ewq val rre val sda val dad ada count statement con create statement createstatement result set resultset execute query executequery slow sql slowsql close close map string slow query report slowqueryreport query stats querystats map slow query report slowqueryreport get pool stats getpoolstats datasource get pool getpool get name getname assert not null assertnotnull map assert equals assertequals map size string key map key set keyset iterator slow query report slowqueryreport query stats querystats stats map key system println stats stats count prepared statement preparedstatement con prepare statement preparestatement slow sql slowsql result set resultset execute query executequery close close system println stats stats count callable statement callablestatement con prepare call preparecall slow sql slowsql result set resultset execute query executequery close close system println stats stats connection pool connectionpool pool datasource get pool getpool con close tear down teardown clean pool closed assert null assertnull slow query report slowqueryreport get pool stats getpoolstats pool get name getname test test slow sql jmx testslowsqljmx exception count init datasource set max active setmaxactive datasource set jdbc int erceptors setjdbcinterceptors slow query report jmx slowqueryreportjmx get name getname threshold notify pool notifypool connection con datasource get connection getconnection string slow sql slowsql select count test val ewq count statement con create statement createstatement result set resultset execute query executequery slow sql slowsql close close map string slow query report slowqueryreport query stats querystats map slow query report slowqueryreport get pool stats getpoolstats datasource get pool getpool get name getname assert not null assertnotnull map assert equals assertequals map size string key map key set keyset iterator slow query report slowqueryreport query stats querystats stats map key system println stats stats client listener clientlistener listener client listener clientlistener connection pool connectionpool pool datasource get pool getpool management factory managementfactory get platform bean server getplatformmbeanserver add notification listener addnotificationlistener slow query report jmx slowqueryreportjmx get object name getobjectname slow query report jmx slowqueryreportjmx pool get name getname listener count prepared statement preparedstatement con prepare statement preparestatement slow sql slowsql result set resultset execute query executequery close close system println stats stats count callable statement callablestatement con prepare call preparecall slow sql slowsql result set resultset execute query executequery close close system println stats stats assert equals assertequals expecting received count not ifications notifications count listener notification count notificationcount con close tear down teardown clean pool closed assert null assertnull slow query report slowqueryreport get pool stats getpoolstats pool get name getname test test fast sql testfastsql exception count init datasource set max active setmaxactive datasource set jdbc int erceptors setjdbcinterceptors slow query report slowqueryreport get name getname connection con datasource get connection getconnection string fast sql fastsql datasource get validation query getvalidationquery count statement con create statement createstatement result set resultset execute query executequery fast sql fastsql close close map string slow query report slowqueryreport query stats querystats map slow query report slowqueryreport get pool stats getpoolstats datasource get pool getpool get name getname assert not null assertnotnull map assert equals assertequals map size connection pool connectionpool pool datasource get pool getpool con close tear down teardown assert null assertnull slow query report slowqueryreport get pool stats getpoolstats pool get name getname test test failed sql testfailedsql exception count init datasource set max active setmaxactive datasource set jdbc int erceptors setjdbcinterceptors slow query report slowqueryreport get name getname connection con datasource get connection getconnection string slow sql slowsql select existent count statement con create statement createstatement result set resultset execute query executequery slow sql slowsql close exception close map string slow query report slowqueryreport query stats querystats map slow query report slowqueryreport get pool stats getpoolstats datasource get pool getpool get name getname assert not null assertnotnull map assert equals assertequals map size connection pool connectionpool pool datasource get pool getpool string key map key set keyset iterator slow query report slowqueryreport query stats querystats stats map key system println stats stats con close tear down teardown assert null assertnull slow query report slowqueryreport get pool stats getpoolstats pool get name getname client listener clientlistener notification listener notificationlistener atomic integer atomicinteger notification count notificationcount atomic integer atomicinteger override handle notification handlenotification notification notification object handback notification count notificationcount increment and get incrementandget system println n received nreceived notification system println t class name tclassname notification get class getclass get name getname system println t source tsource notification get source getsource system println t type ttype notification get type gettype system println t message tmessage notification get message getmessage notification attribute change notification attributechangenotification attribute change notification attributechangenotification acn attribute change notification attributechangenotification notification system println t attribute name tattributename acn get attribute name getattributename system println t attribute type tattributetype acn get attribute type getattributetype system println t new value tnewvalue acn get new value getnewvalue system println t old value toldvalue acn get old value getoldvalue