licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache coyote http filters java io exception ioexception java output stream outputstream java util zip def later deflater java util zip gzip output stream gzipoutputstream extension link gzip output stream gzipoutputstream work around workaround couple standin g standing jdk bugs href http bugs sun bug database bugdatabase view bug bug bug href http bugs sun bug database bugdatabase view bug bug bug gzip output flushed flushablegzipoutputstream gzip output stream gzipoutputstream flushablegzipoutputstream output stream outputstream io exception ioexception res erve reserve real data flushing stream last byte lastbyte has last byte haslastbyte flag compression enabled write operation flag reenable compression flagreenablecompression override write bytes io exception ioexception write bytes bytes length override write bytes offset length io exception ioexception length flush last byte flushlastbyte length reenable compression reenablecompression write bytes offset length remember last byte rememberlastbyte bytes offset length override write io exception ioexception flush last byte flushlastbyte remember last byte rememberlastbyte override finish io exception ioexception flush last byte flushlastbyte io exception ioexception ignore finish override close io exception ioexception flush last byte flushlastbyte io exception ioexception close reenable compression reenablecompression flag reenable compression flagreenablecompression def finished flag reenable compression flagreenablecompression def set level setlevel def later deflater compression remember last byte rememberlastbyte last byte lastbyte has last byte haslastbyte flush last byte flushlastbyte io exception ioexception has last byte haslastbyte reenable compression reenablecompression clear flag write fail has last byte haslastbyte write last byte lastbyte override flush io exception ioexception has last byte haslastbyte tricky force def later deflater flush data switching compression level per plexingly perplexingly simple work around workaround http dev eloper developer java sun dev eloper developer bug parade bugparade bugs html def finished def set level setlevel def later deflater compression flush last byte flushlastbyte flag reenable compression flagreenablecompression flush calling def late deflate runs dry implementation hold data flushed override def late deflate io exception ioexception len len def def late deflate buf buf length len write buf len len