licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat websocket server java buffered reader bufferedreader java io exception ioexception java input stream reader inputstreamreader java net socket javax websocket close reason closereason close code closecode org apache tomcat util buf c converter cconverter client testing web socket websocket behavior differs standard client behavior tester ws close client testerwscloseclient masking key maskingkey socket socket tester ws close client testerwscloseclient string host port exception socket socket host port read timeout failure test doesn hang socket set so timeout setsotimeout disable nagle algorithm ensure pack ets packets todo hoping writes wait tcp ack tcp rst test cases socket set tcp no delay settcpnodelay http upgrade httpupgrade string path io exception ioexception string req create upgrade request createupgraderequest path write req get bytes getbytes c converter cconverter utf read upgrade response readupgraderesponse send message sendmessage string text io exception ioexception write create frame createframe text get bytes getbytes c converter cconverter utf send close frame sendcloseframe close code closecode close code closecode io exception ioexception code close code closecode get code getcode code bytes codebytes code bytes codebytes code code bytes codebytes code write create frame createframe code bytes codebytes read upgrade response readupgraderesponse io exception ioexception buffered reader bufferedreader buffered reader bufferedreader input stream reader inputstreamreader socket get input stream getinputstream read line readline is empty isempty close socket closesocket io exception ioexception enable linger ensure close returns tcp closing handshake completes socket set so linger setsolinger socket close send tcp rst tcp closing handshake force close socket forceclosesocket io exception ioexception linger sends tcp rst timeout expires socket set so linger setsolinger socket close write bytes io exception ioexception socket get output stream getoutputstream write bytes socket get output stream getoutputstream flush string create upgrade request createupgraderequest string path string upgrade request lines upgraderequestlines path http connection upgrade host localhost origin localhost web socket websocket key oe v ao kn oevaoakn jsuqv wfg web socket websocket version upgrade websocket string buffer stringbuffer string buffer stringbuffer string upgrade request lines upgraderequestlines append append append to string tostring create frame createframe fin op code opcode payload frame payload length frame op code opcode fin frame payload length frame masking key maskingkey frame masking key maskingkey frame masking key maskingkey frame masking key maskingkey payload length frame payload masking key maskingkey frame