licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina valves java io exception ioexception java util array list arraylist java util collections java util iterator java util list javax servlet servlet exception servletexception javax servlet http http session httpsession javax servlet http http session event httpsessionevent javax servlet http http session listener httpsessionlistener org apache catalina context org apache catalina lifecycle org apache catalina lifecycle event lifecycleevent org apache catalina lifecycle exception lifecycleexception org apache catalina lifecycle listener lifecyclelistener org apache catalina lifecycle state lifecyclestate org apache catalina comet comet event cometevent org apache catalina comet comet processor cometprocessor org apache catalina connector comet event impl cometeventimpl org apache catalina connector request org apache catalina connector response implementation valve tracks comet connections closes session expires webapp reloaded valve attached context author remy maucherat comet connection manager valve cometconnectionmanagervalve valve base valvebase http session listener httpsessionlistener lifecycle listener lifecyclelistener constructor comet connection manager valve cometconnectionmanagervalve instance variables descriptive implementation string info org apache catalina valves comet connection manager valve cometconnectionmanagervalve list current comet connections list request comet requests cometrequests collections synchronized list synchronizedlist array list arraylist request session attribute store list comet connections string comet requests attribute cometrequestsattribute org apache tomcat comet connection list connectionlist start component implement requirements link org apache catalina util lifecycle base lifecyclebase start internal startinternal exception lifecycle exception lifecycleexception component detects fatal error prevents component override start internal startinternal lifecycle exception lifecycleexception container context container add lifecycle listener addlifecyclelistener set state setstate lifecycle state lifecyclestate starting component implement requirements link org apache catalina util lifecycle base lifecyclebase stop internal stopinternal exception lifecycle exception lifecycleexception component detects fatal error prevents component override stop internal stopinternal lifecycle exception lifecycleexception set state setstate lifecycle state lifecyclestate stopping container context container remove lifecycle listener removelifecyclelistener override lifecycle event lifecycleevent lifecycle event lifecycleevent event lifecycle event equals event get type gettype container stopped close current connections iterator request iterator comet requests cometrequests iterator iterator has next hasnext request request iterator remove session tracking attribute isn serializable required http session httpsession session request get session getsession session session remove attribute removeattribute comet requests attribute cometrequestsattribute close comet connection comet event impl cometeventimpl comet event cometevent request get event getevent comet event cometevent set event type seteventtype comet event cometevent event type eventtype comet event cometevent set event sub type seteventsubtype comet event cometevent event sub type eventsubtype webapp reload get next getnext event request request get response getresponse comet event cometevent exception container get logger getlogger warn get string getstring comet connection manager valve cometconnectionmanagervalve event comet event cometevent close io exception ioexception container get logger getlogger warn get string getstring comet connection manager valve cometconnectionmanagervalve event comet requests cometrequests clear methods descriptive valve implementation override string get info getinfo info register requests tracking needed param request servlet request processed param response servlet response created exception io exception ioexception input output error occurs exception servlet exception servletexception servlet error occurs override invoke request request response response io exception ioexception servlet exception servletexception perform request get next getnext invoke request response request is comet iscomet response is closed isclosed start tracking connection event comet mode http session httpsession session request get session getsession track connection webapp reload comet requests cometrequests add request track connection session expiration session request requests request session get attribute getattribute comet requests attribute cometrequestsattribute requests requests request requests request session set attribute setattribute comet requests attribute cometrequestsattribute requests request new requests newrequests request requests length requests length new requests newrequests requests new requests newrequests requests length request session set attribute setattribute comet requests attribute cometrequestsattribute new requests newrequests events update connection param request servlet request processed param response servlet response created exception io exception ioexception input output error occurs exception servlet exception servletexception servlet error occurs override event request request response response comet event cometevent event io exception ioexception servlet exception servletexception perform request get next getnext event request response event response is closed isclosed event get event type geteventtype comet event cometevent event type eventtype event get event type geteventtype comet event cometevent event type eventtype error event get event sub type geteventsubtype comet event cometevent event sub type eventsubtype timeout remove connection webapp reload tracking comet requests cometrequests remove request remove connection session expiration tracking note session invalid ated invalidated session listener clean http session httpsession session request get session getsession session session request reqs reqs request session get attribute getattribute comet requests attribute cometrequestsattribute illegal state exception illegalstateexception ise reqs reqs length reqs request reqs length request new connection infos newconnectioninfos request reqs length pos reqs length reqs request new connection infos newconnectioninfos pos reqs session set attribute setattribute comet requests attribute cometrequestsattribute new connection infos newconnectioninfos illegal state exception illegalstateexception ise session remove attribute removeattribute comet requests attribute cometrequestsattribute illegal state exception illegalstateexception ise override session created sessioncreated http session event httpsessionevent noop override session destroyed sessiondestroyed http session event httpsessionevent close comet connections session request reqs request get session getsession get attribute getattribute comet requests attribute cometrequestsattribute reqs reqs length request req reqs comet event impl cometeventimpl event req get event getevent event set event type seteventtype comet event cometevent event type eventtype event set event sub type seteventsubtype comet event cometevent event sub type eventsubtype session comet processor cometprocessor req get wrapper getwrapper get servlet getservlet event event event close exception req get wrapper getwrapper get parent getparent get logger getlogger warn get string getstring comet connection manager valve cometconnectionmanagervalve listener event listenerevent