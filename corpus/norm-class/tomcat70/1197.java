licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina deploy java file java io exception ioexception java util hash map hashmap javax management m bean server mbeanserver javax management object name objectname org apache catalina container org apache catalina context org apache catalina engine org apache catalina globals org apache catalina host org apache catalina lifecycle exception lifecycleexception org apache catalina cluster deployer clusterdeployer org apache catalina cluster listener clusterlistener org apache catalina cluster message clustermessage org apache catalina tribes member org apache catalina util context name contextname org apache juli logging log org apache juli logging log factory logfactory org apache tomcat util modeler registry org apache tomcat util res string manager stringmanager farm war deployer deploy undeploy web applications war cluster host admin directories watch dir watchdir directory watch deploy dir deploydir directory install applications temp dir tempdir temporary directory temporarydirectory store binary data down loading downloading war cluster support deployment war files easier send wire author filip hanik author peter rossbach farm war deployer farmwardeployer cluster listener clusterlistener cluster deployer clusterdeployer file change listener filechangelistener variables log log log factory logfactory get log getlog farm war deployer farmwardeployer string manager stringmanager string manager stringmanager get manager getmanager constants descriptive implementation string info farm war deployer farmwardeployer instance variables started hash map hashmap string file message factory filemessagefactory file factories filefactories hash map hashmap string file message factory filemessagefactory deployment directory string deploy dir deploydir file deploy dir file deploydirfile temporary directory string temp dir tempdir file temp dir file tempdirfile watch directory string watch dir watchdir file watch dir file watchdirfile watch enabled watchenabled war watcher warwatcher watcher iteration count background processing count frequency farm watch dir watchdir check cluster wide deployment amount back grond process backgrondprocess calls amount checks occur process deploy frequency processdeployfrequency path context descriptors deployed file config base configbase host host host host app base appbase file app base appbase m bean mbean server m bean server mbeanserver m bean server mbeanserver deployer object name objectname object name objectname oname maximum valid time seconds file message factory filemessagefactory max valid time maxvalidtime constructor farm war deployer farmwardeployer descriptive deployer implementation version number format code description version code string get info getinfo info logic override start exception started container hcontainer get cluster getcluster get container getcontainer hcontainer host log error get string getstring farm war deployer farmwardeployer host only hostonly host host hcontainer check correct engine host setup container econtainer host get parent getparent econtainer engine log error get string getstring farm war deployer farmwardeployer host parent engine hostparentengine host get name getname engine engine engine econtainer string hostname hostname host get name getname oname object name objectname engine get name getname type deployer host hostname exception log error get string getstring farm war deployer farmwardeployer mbean name fail mbeannamefail engine get name getname hostname watch enabled watchenabled watcher war watcher warwatcher get watch dir file getwatchdirfile log is info enabled isinfoenabled log info get string getstring farm war deployer farmwardeployer watch dir watchdir get watch dir getwatchdir host get xml base getxmlbase config base configbase get absolute path getabsolutepath host get xml base getxmlbase string builder stringbuilder xml dir xmldir string builder stringbuilder conf xml dir xmldir append xml dir xmldir append engine get name getname xml dir xmldir append xml dir xmldir append host get name getname config base configbase get absolute path getabsolutepath xml dir xmldir to string tostring retrieve m bean mbean server m bean server mbeanserver registry get registry getregistry get bean server getmbeanserver started count get cluster getcluster add cluster listener addclusterlistener log is info enabled isinfoenabled log info get string getstring farm war deployer farmwardeployer started cluster wide deploy m ents deployments org apache catalina cluster deployer clusterdeployer override lifecycle exception lifecycleexception started get cluster getcluster remove cluster listener removeclusterlistener count watcher watcher clear watcher log is info enabled isinfoenabled log info get string getstring farm war deployer farmwardeployer stopped clean deploy dir cleandeploydir java lang unsupported operation exception unsupportedoperationexception get string getstring farm war deployer farmwardeployer not impl emented notimplemented clean deploy dir cleandeploydir callback cluster message received cluster broadcast invoking message received messagereceived receiver param msg cluster message clustermessage message received cluster override message received messagereceived cluster message clustermessage msg msg file message filemessage file message filemessage fmsg file message filemessage msg log is debug enabled isdebugenabled log debug get string getstring farm war deployer farmwardeployer msg rx deploy msgrxdeploy fmsg get context name getcontextname fmsg get file name getfilename file message factory filemessagefactory factory get factory getfactory fmsg todo correct app service factory write message writemessage fmsg message received war file completed string factory get file getfile get name getname ends with endswith war war file deploy able deployable file get deploy dir file getdeploydirfile string context name contextname fmsg get context name getcontextname is service d isserviced context name contextname add service d addserviced context name contextname remove context name contextname factory get file getfile rename to renameto deploy able deployable log error get string getstring farm war deployer farmwardeployer rename fail renamefail factory get file getfile deploy able deployable check context name contextname remove service d removeserviced context name contextname log is debug enabled isdebugenabled log debug get string getstring farm war deployer farmwardeployer deploy end deployend context name contextname log error get string getstring farm war deployer farmwardeployer servicing deploy servicingdeploy context name contextname exception log error remove factory removefactory fmsg msg undeploy message undeploymessage undeploy message undeploymessage umsg undeploy message undeploymessage msg string context name contextname umsg get context name getcontextname log is debug enabled isdebugenabled log debug get string getstring farm war deployer farmwardeployer msg rx undeploy msgrxundeploy context name contextname is service d isserviced context name contextname add service d addserviced context name contextname remove context name contextname remove service d removeserviced context name contextname log is debug enabled isdebugenabled log debug get string getstring farm war deployer farmwardeployer undeploy end undeployend context name contextname log error get string getstring farm war deployer farmwardeployer servicing uneploy servicinguneploy context name contextname exception log error java io exception ioexception log error get string getstring farm war deployer farmwardeployer msg ioe msgioe create factory tra nsported transported war files param msg factory app message war files java file not found exception filenotfoundexception java io exception ioexception file message factory filemessagefactory get factory getfactory file message filemessage msg java file not found exception filenotfoundexception java io exception ioexception file write to file writetofile file get temp dir file gettempdirfile msg get file name getfilename file message factory filemessagefactory factory file factories filefactories msg get file name getfilename factory factory file message factory filemessagefactory get instance getinstance write to file writetofile factory set max valid time setmaxvalidtime max valid time maxvalidtime file factories filefactories msg get file name getfilename factory factory remove file war messages param msg remove factory removefactory file message filemessage msg file factories filefactories remove msg get file name getfilename cluster invokes message received messagereceived cluster receiver accept dec line decline message messages big accept method message header param msg cluster message clustermessage returns message received messagereceived invoked returned message received messagereceived method invoked override accept cluster message clustermessage msg msg file message filemessage msg undeploy message undeploymessage install web application web application archive url container members cluster context application installed locally container event containerevent type code install event code registered listeners newly created code context code argument param context name contextname context application installed unique param webapp war file unpacked directory structure web application installed exception illegal argument exception illegalargumentexception context malformed exception illegal state exception illegalstateexception context deployed exception io exception ioexception input output error encountered installation override install string context name contextname file webapp io exception ioexception member members get cluster getcluster get members getmembers members length member local member localmember get cluster getcluster get local member getlocalmember file message factory filemessagefactory factory file message factory filemessagefactory get instance getinstance webapp file message filemessage msg file message filemessage local member localmember webapp get name getname context name contextname log is debug enabled isdebugenabled log debug get string getstring farm war deployer farmwardeployer send start sendstart context name contextname webapp msg factory read message readmessage msg msg members length log is debug enabled isdebugenabled log debug get string getstring farm war deployer farmwardeployer send fragment sendfragment context name contextname webapp members get cluster getcluster send msg members msg factory read message readmessage msg log is debug enabled isdebugenabled log debug get string getstring farm war deployer farmwardeployer send end sendend context name contextname webapp remove existing web application attached context application removed container event containerevent type code remove event code registered listeners removed code context code argument deletes web application war file directory exist host app base appbase param context name contextname context application removed param undeploy flag remove web application server exception illegal argument exception illegalargumentexception context malformed exception illegal argument exception illegalargumentexception context identify installed web application exception io exception ioexception input output error occurs removal override remove string context name contextname undeploy io exception ioexception get cluster getcluster get members getmembers length log is info enabled isinfoenabled log info get string getstring farm war deployer farmwardeployer remove start removestart context name contextname member local member localmember get cluster getcluster get local member getlocalmember undeploy message undeploymessage msg undeploy message undeploymessage local member localmember system current time millis currenttimemillis undeploy context name contextname system current time millis currenttimemillis context name contextname undeploy log is debug enabled isdebugenabled log debug get string getstring farm war deployer farmwardeployer remove tx msg removetxmsg context name contextname cluster send msg remove locally undeploy is service d isserviced context name contextname add service d addserviced context name contextname remove context name contextname remove service d removeserviced context name contextname log error get string getstring farm war deployer farmwardeployer remove fail remote removefailremote context name contextname exception log error get string getstring farm war deployer farmwardeployer remove fail local removefaillocal context name contextname modification watch dir watchdir war detected org apache catalina deploy file change listener filechangelistener file modified filemodified file override file modified filemodified file new war newwar file deploy war deploywar file get deploy dir file getdeploydirfile new war newwar get name getname context name contextname context name contextname deploy war deploywar get name getname deploy war deploywar exists deploy war deploywar last modified lastmodified new war newwar last modified lastmodified log is info enabled isinfoenabled log info get string getstring farm war deployer farmwardeployer already deployed alreadydeployed get name getname log is info enabled isinfoenabled log info get string getstring farm war deployer farmwardeployer mod install modinstall get name getname deploy war deploywar get absolute path getabsolutepath install local is service d isserviced get name getname add service d addserviced get name getname copy new war newwar deploy war deploywar check get name getname remove service d removeserviced get name getname log error get string getstring farm war deployer farmwardeployer servicing deploy servicingdeploy get name getname deploy war deploywar get name getname install get name getname deploy war deploywar exception log error get string getstring farm war deployer farmwardeployer mod install fail modinstallfail war remove watch dir watchdir org apache catalina deploy file change listener filechangelistener file removed fileremoved file override file removed fileremoved file remove war removewar context name contextname context name contextname remove war removewar get name getname log is info enabled isinfoenabled log info get string getstring farm war deployer farmwardeployer remove local removelocal get name getname remove get name getname exception log error get string getstring farm war deployer farmwardeployer remove local fail removelocalfail file object representing application root directory host file get app base getappbase app base appbase app base appbase file file file host get app base getappbase file is absolute isabsolute file file system get property getproperty globals catalina base prop host get app base getappbase app base appbase file get canonical file getcanonicalfile io exception ioexception app base appbase file app base appbase invoke remove method deployer remove string context name contextname exception todo handle remove work dir content context nicer context context context host find child findchild context name contextname context log is debug enabled isdebugenabled log debug get string getstring farm war deployer farmwardeployer undeploy local undeploylocal context name contextname context string base name basename context get base name getbasename file war file get app base getappbase base name basename war file dir file get app base getappbase base name basename file xml file config base configbase base name basename xml war exists war delete log error get string getstring farm war deployer farmwardeployer delete fail deletefail war dir exists undeploy dir undeploydir dir xml delete log error get string getstring farm war deployer farmwardeployer delete fail deletefail xml perform deployment remove internal host config hostconfig check context name contextname delete directory including contents sub directories subdirectories recursively param dir file object representing directory deleted undeploy dir undeploydir file dir string files dir list files files string files length file file file dir files file is directory isdirectory undeploy dir undeploydir file file delete log error get string getstring farm war deployer farmwardeployer delete fail deletefail file dir delete log error get string getstring farm war deployer farmwardeployer delete fail deletefail dir call watcher check deploy org apache catalina cluster deployer clusterdeployer background process backgroundprocess override background process backgroundprocess started watch enabled watchenabled count count process deploy frequency processdeployfrequency count watcher check remove invalid file factories removeinvalidfilefactories deployer operations invoke check method deployer check string exception string params string signature java lang string m bean server mbeanserver invoke oname check params signature invoke check method deployer is service d isserviced string exception string params string signature java lang string result m bean server mbeanserver invoke oname is service d isserviced params signature result boolean value booleanvalue invoke check method deployer add service d addserviced string exception string params string signature java lang string m bean server mbeanserver invoke oname add service d addserviced params signature invoke check method deployer remove service d removeserviced string exception string params string signature java lang string m bean server mbeanserver invoke oname remove service d removeserviced params signature instance get ters getters set ters setters override equals object listener equals listener override hash code hashcode hash code hashcode string get deploy dir getdeploydir deploy dir deploydir file get deploy dir file getdeploydirfile deploy dir file deploydirfile deploy dir file deploydirfile file dir get absolute path getabsolutepath get deploy dir getdeploydir deploy dir file deploydirfile dir dir set deploy dir setdeploydir string deploy dir deploydir deploy dir deploydir deploy dir deploydir string get temp dir gettempdir temp dir tempdir file get temp dir file gettempdirfile temp dir file tempdirfile temp dir file tempdirfile file dir get absolute path getabsolutepath get temp dir gettempdir temp dir file tempdirfile dir dir set temp dir settempdir string temp dir tempdir temp dir tempdir temp dir tempdir string get watch dir getwatchdir watch dir watchdir file get watch dir file getwatchdirfile watch dir file watchdirfile watch dir file watchdirfile file dir get absolute path getabsolutepath get watch dir getwatchdir watch dir file watchdirfile dir dir set watch dir setwatchdir string watch dir watchdir watch dir watchdir watch dir watchdir is watch enabled iswatchenabled watch enabled watchenabled get watch enabled getwatchenabled watch enabled watchenabled set watch enabled setwatchenabled watch enabled watchenabled watch enabled watchenabled watch enabled watchenabled frequency watcher checks get process deploy frequency getprocessdeployfrequency process deploy frequency processdeployfrequency watcher checks frequency param process expires frequency processexpiresfrequency manager checks frequency set process deploy frequency setprocessdeployfrequency process expires frequency processexpiresfrequency process expires frequency processexpiresfrequency process deploy frequency processdeployfrequency process expires frequency processexpiresfrequency get max valid time getmaxvalidtime max valid time maxvalidtime set max valid time setmaxvalidtime max valid time maxvalidtime max valid time maxvalidtime max valid time maxvalidtime copy file temp directory param copy temp param host app base appbase directory copy successful copy file file java file input stream fileinputstream java file output stream fileoutputstream exists create new file createnewfile log error get string getstring file new fail filenewfail java file input stream fileinputstream java file output stream fileoutputstream buf len read buf len write buf len io exception ioexception log error get string getstring farm war deployer farmwardeployer file copy fail filecopyfail close io exception ioexception log debug get string getstring farm war deployer farmwardeployer stream cannot be closed streamcannotbeclosed input stream inputstream close io exception ioexception log debug get string getstring farm war deployer farmwardeployer stream cannot be closed streamcannotbeclosed output stream outputstream remove invalid file factories removeinvalidfilefactories string file names filenames file factories filefactories key set keyset to array toarray string string file name filename file names filenames file message factory filemessagefactory factory file factories filefactories file name filename factory is valid isvalid file factories filefactories remove file name filename file get absolute path getabsolutepath string path file dir file path file base file system get property getproperty globals catalina base prop dir is absolute isabsolute dir file base dir get path getpath dir dir get canonical file getcanonicalfile io exception ioexception ignore dir