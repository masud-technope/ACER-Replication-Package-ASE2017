licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina core java beans property change listener propertychangelistener java beans property change support propertychangesupport java io exception ioexception java security access controller accesscontroller java security privileged action privilegedaction java util array list arraylist java util hash map hashmap java util hashtable java util iterator java util list java util concurrent blocking queue blockingqueue java util concurrent callable java util concurrent copy on write array list copyonwritearraylist java util concurrent java util concurrent linked blocking queue linkedblockingqueue java util concurrent thread factory threadfactory java util concurrent thread pool executor threadpoolexecutor java util concurrent time unit timeunit java util concurrent atomic atomic integer atomicinteger java util concurrent locks lock java util concurrent locks read write lock readwritelock java util concurrent locks reentrant read write lock reentrantreadwritelock javax management object name objectname javax naming directory dir context dircontext javax servlet servlet exception servletexception org apache catalina access log accesslog org apache catalina cluster org apache catalina container org apache catalina container event containerevent org apache catalina container listener containerlistener org apache catalina globals org apache catalina lifecycle org apache catalina lifecycle exception lifecycleexception org apache catalina lifecycle state lifecyclestate org apache catalina loader org apache catalina manager org apache catalina pipeline org apache catalina realm org apache catalina valve org apache catalina connector request org apache catalina connector response org apache catalina mbeans m bean utils mbeanutils org apache catalina util lifecycle bean base lifecyclembeanbase org apache juli logging log org apache juli logging log factory logfactory org apache naming resources proxy dir context proxydircontext org apache tomcat util exception utils exceptionutils org apache tomcat util res string manager stringmanager implementation container providing common functionality required implementation classes extending base implement code get info getinfo code implement replacement code invoke code subclasses base include support pipeline object defines processing performed request received code invoke code method util izing utilizing chain res ponsibility responsibility design pattern subclass encapsulate processing functionality code valve code configure valve pipeline calling code set basic setbasic code implementation fires property change events java beans javabeans design pattern singleton properties add ition addition fires code container event containerevent code events listeners register code add container listener addcontainerlistener code table border type data description align center code add child addchild code align center code container code child container container align center code link get pipeline getpipeline pipeline add valve addvalve code align center code valve code valve container align center code remove child removechild code align center code container code child container removed container align center code link get pipeline getpipeline pipeline remove valve removevalve code align center code valve code valve removed container align center code start code align center code code container started align center code code align center code code container stopped table subclasses fire additional events document comments implementation todo review synch ronisation synchronisation background processing bug author craig mc clanahan mcclanahan container base containerbase lifecycle bean base lifecyclembeanbase container org apache juli logging log log org apache juli logging log factory logfactory get log getlog container base containerbase perform add child addchild permissions add child addchild called xml parser stack xml parser privileges tomcat privileged add child privilegedaddchild privileged action privilegedaction container child privileged add child privilegedaddchild container child child child override add child internal addchildinternal child instance variables child containers belonging container keyed hash map hashmap string container children hash map hashmap string container processor delay component background processor delay backgroundprocessordelay container event listeners container impl emented implemented copy on write array list copyonwritearraylist listeners invoke methods add remove listeners read write lock readwritelock trigger deadlock list container listener containerlistener listeners copy on write array list copyonwritearraylist container listener containerlistener loader implementation container loader loader logger implementation container log logger logger string log name logname manager implementation container manager manager cluster container cluster cluster human readable container string parent container container child container parent parent loader configured install loader class loader classloader parent class loader parentclassloader pipeline object container pipeline pipeline standard pipeline standardpipeline realm container realm realm lock control access realm read write lock readwritelock realm lock realmlock reentrant read write lock reentrantreadwritelock resources dir context dircontext object container dir context dircontext resources string manager string manager stringmanager string manager stringmanager get manager getmanager constants children started automatically start children startchildren property change support component property change support propertychangesupport support property change support propertychangesupport background thread thread thread background thread completion semaphore thread done threaddone access log requests handled container handled earlier processing chain access log accesslog access log accesslog access log scan complete accesslogscancomplete number threads process start events children container start stop threads startstopthreads thread pool executor threadpoolexecutor start stop executor startstopexecutor properties override get start stop threads getstartstopthreads start stop threads startstopthreads handles special values get start stop threads internal getstartstopthreadsinternal result get start stop threads getstartstopthreads positive values unchanged result result runtime get runtime getruntime available processors availableprocessors runtime get runtime getruntime available processors availableprocessors result runtime get runtime getruntime available processors availableprocessors result result result result override set start stop threads setstartstopthreads start stop threads startstopthreads start stop threads startstopthreads start stop threads startstopthreads local copies ensure thread safety thread pool executor threadpoolexecutor executor start stop executor startstopexecutor executor new threads newthreads get start stop threads internal getstartstopthreadsinternal executor set maximum pool size setmaximumpoolsize new threads newthreads executor set core pool size setcorepoolsize new threads newthreads delay invocation background process backgroundprocess method container children child containers invoked delay negative thread setting positive thread spawn waiting amount time thread invoke execute per iodic executeperiodic method container children override get background processor delay getbackgroundprocessordelay background processor delay backgroundprocessordelay delay invocation execute method container children param delay delay seconds invocation background process backgroundprocess methods override set background processor delay setbackgroundprocessordelay delay background processor delay backgroundprocessordelay delay descriptive container implementation version number format code description version code override string get info getinfo get class getclass get name getname loader container loader loader parent container code code override loader get loader getloader loader loader parent parent get loader getloader loader container param loader newly loader override set loader setloader loader loader change components loader old loader oldloader loader old loader oldloader loader loader loader component get state getstate is available isavailable old loader oldloader old loader oldloader lifecycle lifecycle old loader oldloader lifecycle exception lifecycleexception log error container base containerbase set loader setloader start component loader loader set container setcontainer get state getstate is available isavailable loader loader lifecycle lifecycle loader start lifecycle exception lifecycleexception log error container base containerbase set loader setloader start report property change int erested interested listeners support fire property change firepropertychange loader old loader oldloader loader logger container override log get logger getlogger logger logger logger log factory logfactory get log getlog log name logname logger manager container manager manager parent container code code override manager get manager getmanager manager manager parent parent get manager getmanager manager container param manager newly manager override set manager setmanager manager manager change components manager old manager oldmanager manager old manager oldmanager manager manager manager component old manager oldmanager lifecycle lifecycle old manager oldmanager lifecycle old manager oldmanager destroy lifecycle exception lifecycleexception log error container base containerbase set manager setmanager destroy start component manager manager set container setcontainer get state getstate is available isavailable manager lifecycle lifecycle manager start lifecycle exception lifecycleexception log error container base containerbase set manager setmanager start report property change int erested interested listeners support fire property change firepropertychange manager old manager oldmanager manager object util ized utilized mapping component deprecated override object get mapping object getmappingobject cluster container cluster cluster parent container code code override cluster get cluster getcluster cluster cluster parent parent get cluster getcluster cluster container param cluster newly cluster override set cluster setcluster cluster cluster change components cluster old cluster oldcluster cluster old cluster oldcluster cluster cluster cluster component get state getstate is available isavailable old cluster oldcluster old cluster oldcluster lifecycle lifecycle old cluster oldcluster lifecycle exception lifecycleexception log error container base containerbase set cluster setcluster start component cluster cluster set container setcontainer get state getstate is available isavailable cluster cluster lifecycle lifecycle cluster start lifecycle exception lifecycleexception log error container base containerbase set cluster setcluster start report property change int erested interested listeners support fire property change firepropertychange cluster old cluster oldcluster cluster string suitable humans describes container child containers belonging parent container names unique override string get name getname string suitable humans describes container child containers belonging parent container names unique param container exception illegal state exception illegalstateexception container children parent container changed override set name setname string string old name oldname support fire property change firepropertychange old name oldname children container started automatically container get start children getstartchildren start children startchildren children container started automatically container param start children startchildren start children startchildren flag set start children setstartchildren start children startchildren old start children oldstartchildren start children startchildren start children startchildren start children startchildren support fire property change firepropertychange start children startchildren old start children oldstartchildren start children startchildren container container child defined parent code code override container get parent getparent parent parent container container child container ref use refuse attached container throwing exception param container container container child exception illegal argument exception illegalargumentexception container ref uses refuses attached container override set parent setparent container container container old parent oldparent parent parent container support fire property change firepropertychange parent old parent oldparent parent parent loader web application call meaningful strong strong loader configured override class loader classloader get parent class loader getparentclassloader parent class loader parentclassloader parent class loader parentclassloader parent parent get parent class loader getparentclassloader class loader classloader get system class loader getsystemclassloader parent loader web application call meaningful strong strong loader configured passed argument loader constructor param parent parent loader override set parent class loader setparentclassloader class loader classloader parent class loader classloader old parent class loader oldparentclassloader parent class loader parentclassloader parent class loader parentclassloader parent support fire property change firepropertychange parent class loader parentclassloader old parent class loader oldparentclassloader parent class loader parentclassloader pipeline object manages valves container override pipeline get pipeline getpipeline pipeline realm container realm realm parent container code code override realm get realm getrealm lock realm lock realmlock read lock readlock lock realm realm parent parent get realm getrealm unlock realm get realm internal getrealminternal lock realm lock realmlock read lock readlock lock realm unlock realm container param realm newly realm override set realm setrealm realm realm lock realm lock realmlock write lock writelock lock change components realm old realm oldrealm realm old realm oldrealm realm realm realm component get state getstate is available isavailable old realm oldrealm old realm oldrealm lifecycle lifecycle old realm oldrealm lifecycle exception lifecycleexception log error container base containerbase set realm setrealm start component realm realm set container setcontainer get state getstate is available isavailable realm realm lifecycle lifecycle realm start lifecycle exception lifecycleexception log error container base containerbase set realm setrealm start report property change int erested interested listeners support fire property change firepropertychange realm old realm oldrealm realm unlock resources dir context dircontext object container resources object resources parent container code code override dir context dircontext get resources getresources resources resources parent parent get resources getresources resources dir context dircontext object container param resources newly dir context dircontext override set resources setresources dir context dircontext resources called standard context standardcontext set resources setresources standard context standardcontext start container base containerbase add child internal addchildinternal change components dir context dircontext old resources oldresources resources old resources oldresources resources hashtable string string env hashtable string string get parent getparent env proxy dir context proxydircontext host get parent getparent get name getname env proxy dir context proxydircontext context get name getname resources proxy dir context proxydircontext env resources report property change int erested interested listeners support fire property change firepropertychange resources old resources oldresources resources container methods add child container container supported prior adding container children child code set parent setparent code method called container argument method thrown code illegal argument exception illegalargumentexception code container chooses attached container param child child container exception illegal argument exception illegalargumentexception exception thrown code set parent setparent code method child container exception illegal argument exception illegalargumentexception child unique existing children container exception illegal state exception illegalstateexception container support child containers override add child addchild container child globals security enabled privileged action privilegedaction privileged add child privilegedaddchild child access controller accesscontroller do privileged doprivileged add child internal addchildinternal child add child internal addchildinternal container child log is debug enabled isdebugenabled log debug add child child children children child get name getname illegal argument exception illegalargumentexception add child addchild child child get name getname unique iae child set parent setparent children child get name getname child loc king locking children object problems get state getstate is available isavailable lifecycle state lifecyclestate starting prep equals get state getstate start children startchildren child start lifecycle exception lifecycleexception log error container base containerbase add child addchild start illegal state exception illegalstateexception container base containerbase add child addchild start fire container event firecontainerevent add child event child add container event listener component param listener listener add override add container listener addcontainerlistener container listener containerlistener listener listeners add listener add property change listener component param listener listener add override add property change listener addpropertychangelistener property change listener propertychangelistener listener support add property change listener addpropertychangelistener listener child container container code code param child container retrieved override container find child findchild string children children children containers container container children length array returned override container find children findchildren children container container children size children values to array toarray container listeners container container registered container listeners length array returned override container listener containerlistener find container listeners findcontainerlisteners container listener containerlistener container listener containerlistener listeners to array toarray process request produce response invoking valve pipeline basic valve param request request processed param response response produced exception illegal state exception illegalstateexception pipeline basic valve configured container exception io exception ioexception input output error occurred processing exception servlet exception servletexception servlet exception servletexception thrown processing request override invoke request request response response io exception ioexception servlet exception servletexception pipeline get first getfirst invoke request response remove existing child container association parent container param child existing child container removed override remove child removechild container child child child get state getstate is available isavailable child lifecycle exception lifecycleexception log error container base containerbase remove child removechild child lifecycle state lifecyclestate destroying equals child get state getstate child destroy lifecycle exception lifecycleexception log error container base containerbase remove child removechild destroy children children child get name getname children remove child get name getname fire container event firecontainerevent remove child event child remove container event listener component param listener listener remove override remove container listener removecontainerlistener container listener containerlistener listener listeners remove listener remove property change listener component param listener listener remove override remove property change listener removepropertychangelistener property change listener propertychangelistener listener support remove property change listener removepropertychangelistener listener override init internal initinternal lifecycle exception lifecycleexception blocking queue blockingqueue runnable start stop queue startstopqueue linked blocking queue linkedblockingqueue runnable start stop executor startstopexecutor thread pool executor threadpoolexecutor get start stop threads internal getstartstopthreadsinternal get start stop threads internal getstartstopthreadsinternal time unit timeunit seconds start stop queue startstopqueue start stop thread factory startstopthreadfactory get name getname start stop startstop start stop executor startstopexecutor allow core thread time out allowcorethreadtimeout init internal initinternal start component implement requirements link org apache catalina util lifecycle base lifecyclebase start internal startinternal exception lifecycle exception lifecycleexception component detects fatal error prevents component override start internal startinternal lifecycle exception lifecycleexception start sub ordinate subordinate components loader loader lifecycle lifecycle loader start logger get logger getlogger manager manager lifecycle lifecycle manager start cluster cluster lifecycle lifecycle cluster start realm realm get realm internal getrealminternal realm realm lifecycle lifecycle realm start resources resources lifecycle lifecycle resources start start child containers container children find children findchildren list array list arraylist children length add start stop executor startstopexecutor sub mit submit start child startchild children fail result result exception log error get string getstring container base containerbase threaded start failed threadedstartfailed fail fail lifecycle exception lifecycleexception get string getstring container base containerbase threaded start failed threadedstartfailed start valves pipeline including basic pipeline lifecycle lifecycle pipeline start set state setstate lifecycle state lifecyclestate starting start thread thread start threadstart component implement requirements link org apache catalina util lifecycle base lifecyclebase stop internal stopinternal exception lifecycle exception lifecycleexception component detects fatal error prevents component override stop internal stopinternal lifecycle exception lifecycleexception thread thread stop threadstop set state setstate lifecycle state lifecyclestate stopping valves pipeline including basic pipeline lifecycle lifecycle pipeline get state getstate is available isavailable lifecycle pipeline child containers container children find children findchildren list array list arraylist children length add start stop executor startstopexecutor sub mit submit stop child stopchild children fail result result exception log error get string getstring container base containerbase threaded stop failed threadedstopfailed fail fail lifecycle exception lifecycleexception get string getstring container base containerbase threaded stop failed threadedstopfailed sub ordinate subordinate components resources resources lifecycle lifecycle resources realm realm get realm internal getrealminternal realm realm lifecycle lifecycle realm cluster cluster lifecycle lifecycle cluster manager manager lifecycle lifecycle manager get state getstate is available isavailable lifecycle manager loader loader lifecycle lifecycle loader override destroy internal destroyinternal lifecycle exception lifecycleexception manager manager lifecycle lifecycle manager destroy realm realm get realm internal getrealminternal realm realm lifecycle lifecycle realm destroy cluster cluster lifecycle lifecycle cluster destroy loader loader lifecycle lifecycle loader destroy valves pipeline including basic pipeline lifecycle lifecycle pipeline destroy remove children container dest royed destroyed container child find children findchildren remove child removechild child required child dest royed destroyed parent parent remove child removechild init fails start stop executor startstopexecutor start stop executor startstopexecutor shutdown now shutdownnow destroy internal destroyinternal check container access log parent parent no op noop access log override log access logaccess request request response response time use default usedefault log ged logged get access log getaccesslog get access log getaccesslog log request response time log ged logged get parent getparent logger request response log ged logged get parent getparent log access logaccess request response time use default usedefault log ged logged override access log accesslog get access log getaccesslog access log scan complete accesslogscancomplete access log accesslog access log adapter accesslogadapter adapter valve valves get pipeline getpipeline get valves getvalves valve valve valves valve access log accesslog adapter adapter access log adapter accesslogadapter access log accesslog valve adapter add access log accesslog valve adapter access log accesslog adapter access log scan complete accesslogscancomplete access log accesslog pipeline methods convenience method intended digester simplify process adding valves containers link pipeline add valve addvalve valve full details components digester link get pipeline getpipeline link add valve addvalve valve implementation alternative method digester param valve valve exception illegal argument exception illegalargumentexception container ref used refused accept valve exception illegal argument exception illegalargumentexception valve ref uses refuses container exception illegal state exception illegalstateexception valve container add valve addvalve valve valve pipeline add valve addvalve valve execute periodic task reloading method invoked class loading classloading context container unexpected throw ables throwables caught log ged logged override background process backgroundprocess get state getstate is available isavailable cluster cluster background process backgroundprocess exception log warn get string getstring container base containerbase background process backgroundprocess cluster cluster loader loader background process backgroundprocess exception log warn get string getstring container base containerbase background process backgroundprocess loader loader manager manager background process backgroundprocess exception log warn get string getstring container base containerbase background process backgroundprocess manager manager realm realm get realm internal getrealminternal realm realm background process backgroundprocess exception log warn get string getstring container base containerbase background process backgroundprocess realm realm valve current pipeline get first getfirst current current background process backgroundprocess exception log warn get string getstring container base containerbase background process backgroundprocess valve current current current get next getnext fire lifecycle event firelifecycleevent lifecycle per iodic periodic event methods notify container event listeners event occurred container implementation performs not ification notification sync hronously synchronously calling thread param type event type param data event data override fire container event firecontainerevent string type object data listeners size container event containerevent event container event containerevent type data note iterator int ernally internally safe container listener containerlistener listener listeners listener container event containerevent event abbreviated container logging messages string log name logname log name logname log name logname string logger name loggername container current current string current get name getname equals starts with startswith logger name loggername logger name loggername logger name loggername current current get parent getparent log name logname container base containerbase get name getname logger name loggername log name logname jmx registration override string get domain internal getdomaininternal m bean utils mbeanutils get domain getdomain object name objectname get children getchildren object name objectname result object name objectname children size iterator container children values iterator has next hasnext object container base containerbase result container base containerbase get object name getobjectname result background thread start background thread per iodically periodically check session time outs timeouts thread start threadstart thread background processor delay backgroundprocessordelay thread done threaddone string thread name threadname container background processor containerbackgroundprocessor to string tostring thread thread container background processor containerbackgroundprocessor thread name threadname thread set daemon setdaemon thread start background thread per iodically periodically checking session time outs timeouts thread stop threadstop thread thread done threaddone thread int errupt interrupt thread join interrupted exception interruptedexception thread thread invoke background process backgroundprocess method container children fixed delay container background processor containerbackgroundprocessor runnable override throwable string unexpected death message unexpecteddeathmessage get string getstring container base containerbase background process backgroundprocess unexpected thread death unexpectedthreaddeath thread current thread currentthread get name getname thread done threaddone thread sleep background processor delay backgroundprocessordelay interrupted exception interruptedexception thread done threaddone container parent container get mapping object getmappingobject class loader classloader thread current thread currentthread get context class loader getcontextclassloader parent get loader getloader parent get loader getloader get class loader getclassloader process children processchildren parent runtime exception runtimeexception error thread done threaddone log error unexpected death message unexpecteddeathmessage process children processchildren container container class loader classloader container get loader getloader thread current thread currentthread set context class loader setcontextclassloader container get loader getloader get class loader getclassloader container background process backgroundprocess throwable exception utils exceptionutils handle throwable handlethrowable log error exception invoking periodic operation thread current thread currentthread set context class loader setcontextclassloader container children container find children findchildren children length children get background processor delay getbackgroundprocessordelay process children processchildren children start child startchild callable container child start child startchild container child child child override call lifecycle exception lifecycleexception child start stop child stopchild callable container child stop child stopchild container child child child override call lifecycle exception lifecycleexception child get state getstate is available isavailable child start stop thread factory startstopthreadfactory thread factory threadfactory thread group threadgroup group atomic integer atomicinteger thread number threadnumber atomic integer atomicinteger string name prefix nameprefix start stop thread factory startstopthreadfactory string name prefix nameprefix security manager securitymanager system get security manager getsecuritymanager group get thread group getthreadgroup thread current thread currentthread get thread group getthreadgroup name prefix nameprefix name prefix nameprefix override thread new thread newthread runnable thread thread thread group name prefix nameprefix thread number threadnumber get and increment getandincrement thread set daemon setdaemon thread