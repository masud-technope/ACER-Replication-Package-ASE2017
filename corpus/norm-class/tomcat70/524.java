licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat util http file upload fileupload java byte array output stream bytearrayoutputstream java io exception ioexception java input stream inputstream java output stream outputstream java unsupported encoding exception unsupportedencodingexception org apache tomcat util http file upload fileupload file upload base fileuploadbase fileuploadioexception org apache tomcat util http file upload fileupload util closeable org apache tomcat util http file upload fileupload util streams level api processing file uploads process data str eams streams conf orming conforming mime multipart format defined href http ietf org rfc rfc txt rfc arbitrarily large amounts data stream processed constant memory usage format stream defined code multipart body preamble encapsulation close delimiter epilogue encapsulation delimiter body crlf delimiter boundary crlf close delimiter boundary preamble ignore epilogue ignore body header crlf body header header crlf header header header header print able printable ascii characters header ascii characters amp body data arbitrary data code note body data mulipart entity limited support single pass processing nested str eams streams nested stream strong required strong boundary token length parent stream link set boundary setboundary usage pre multipart stream multipartstream multipart stream multipartstream multipart stream multipartstream input boundary next part nextpart multipart stream multipartstream skip preamble skippreamble output stream outputstream output next part nextpart string header multipart stream multipartstream read headers readheaders process headers create output stream multipart stream multipartstream read body data readbodydata output next part nextpart multipart stream multipartstream read boundary readboundary multipart stream multipartstream malformed stream exception malformedstreamexception stream failed follow required syntax io exception ioexception read write error occurred pre multipart stream multipartstream internal invoke link progress listener progresslistener progress not ifier progressnotifier listener invoke progress listener progresslistener listener number expected bytes content length contentlength number bytes read bytes read bytesread number items read items creates instance listener content length param p listener plistener listener invoke param p content length pcontentlength expected content length progress not ifier progressnotifier progress listener progresslistener p listener plistener p content length pcontentlength listener p listener plistener content length contentlength p content length pcontentlength called bytes read param p bytes pbytes number bytes read not e bytes read notebytesread p bytes pbytes number bytes read input stream bytes read bytesread p bytes pbytes notify listener notifylistener called file item detected not e item noteitem items notify listener notifylistener called not ifying notifying listener notify listener notifylistener listener listener update bytes read bytesread content length contentlength items manifest constants carriage ascii character feed ascii character dash ascii character dash maximum length code header code processed kilobytes bytes header size max length buffer processing request bufsize sequence marks code header code code crlf crlf crlfcrlf code header separator sequence delimiter encapsulation code crlf code field separator sequence delimiter encapsulation stream code code stream terminator dash dash sequence p recedes precedes boundary code crlf code boundary prefix dash dash data members input stream data read input stream inputstream input length boundary token leading code crlf code boundary length boundarylength amount data bytes buffer order detect delimiters rel iably reliably keep region keepregion sequence part itions partitions stream boundary table knuth morris pratt search algorithm boundary table boundarytable length buffer processing request buf size bufsize buffer processing request buffer valid character buffer head buf size bufsize head valid character buffer tail buf size bufsize tail content encoding reading headers string header encoding headerencoding progress not ifier notifier progress not ifier progressnotifier not ifier notifier constructs code multipart stream multipartstream code custom size buffer note buffer big boundary string characters dash data small buffer size setting degrade performance param input code input stream inputstream code serve data source param boundary token div iding dividing stream code encapsulations code param buf size bufsize size buffer bytes param p not ifier pnotifier not ifier notifier calling progress listener illegal argument exception illegalargumentexception buffer size small multipart stream multipartstream input stream inputstream input boundary buf size bufsize progress not ifier progressnotifier p not ifier pnotifier boundary illegal argument exception illegalargumentexception boundary prepend boundary chop trailing body data tokens boundary length boundarylength boundary length boundary prefix length buf size bufsize boundary length boundarylength illegal argument exception illegalargumentexception buffer size multipart stream multipartstream small input input buf size bufsize math max buf size bufsize boundary length boundarylength buffer buf size bufsize not ifier notifier p not ifier pnotifier boundary boundary length boundarylength boundary table boundarytable boundary length boundarylength keep region keepregion boundary length system arraycopy boundary prefix boundary boundary prefix length system arraycopy boundary boundary boundary prefix length boundary length compute boundary table computeboundarytable head tail constructs code multipart stream multipartstream code size buffer param input code input stream inputstream code serve data source param boundary token div iding dividing stream code encapsulations code param p not ifier pnotifier object calling progress listener multipart stream multipartstream input stream inputstream progress not ifier progressnotifier multipart stream multipartstream input stream inputstream input boundary progress not ifier progressnotifier p not ifier pnotifier input boundary bufsize p not ifier pnotifier methods retrieves character encoding reading headers individual code code platform encoding encoding read headers string get header encoding getheaderencoding header encoding headerencoding specifies character encoding reading headers individual parts code code platform encoding param encoding encoding read headers set header encoding setheaderencoding string encoding header encoding headerencoding encoding reads code buffer code ref ills refills input stream io exception ioexception data read byte readbyte io exception ioexception buffer dep leted depleted head tail head ref ill refill tail input read buffer head buf size bufsize tail data io exception ioexception data not ifier notifier not ifier notifier not e bytes read notebytesread tail buffer head skips code boundary code token checks code encapsulations code contained stream code code encapsulations stream code code fileuploadioexception bytes read stream exc eeded exceeded size limits malformed stream exception malformedstreamexception stream ends unexpectedly fails follow required syntax read boundary readboundary fileuploadioexception malformed stream exception malformedstreamexception marker next chunk nextchunk head boundary length boundarylength marker read byte readbyte marker boundary marker read byte readbyte array equals arrayequals marker stream terminator next chunk nextchunk array equals arrayequals marker field separator next chunk nextchunk malformed stream exception malformedstreamexception unexpected characters follow boundary fileuploadioexception io exception ioexception malformed stream exception malformedstreamexception stream ended unexpectedly next chunk nextchunk boundary token partitioning stream method single pass processing nested multipart str eams streams boundary token nested stream code required code length boundary token parent stream rest oring restoring parent stream boundary token processing nested stream left application param boundary boundary parsing nested stream illegal boundary exception illegalboundaryexception code boundary code length parsed set boundary setboundary boundary illegal boundary exception illegalboundaryexception boundary length boundary length boundarylength boundary prefix length illegal boundary exception illegalboundaryexception length boundary token changed system arraycopy boundary boundary boundary prefix length boundary length compute boundary table computeboundarytable compute table knuth morris pratt search algorithm compute boundary table computeboundarytable position candidate boundary table boundarytable boundary table boundarytable position boundary length boundarylength boundary position boundary candidate boundary table boundarytable position candidate candidate position candidate candidate boundary table boundarytable candidate boundary table boundarytable position position reads code header code current code encapsulation code headers returned verbatim input stream including trailing code crlf code marker parsing left application strong todo strong limiting maximum header size protect abuse code header code current encapsulation fileuploadioexception bytes read stream exc eeded exceeded size limits malformed stream exception malformedstreamexception stream ends unexpectedly string read headers readheaders fileuploadioexception malformed stream exception malformedstreamexception support multi characters byte array output stream bytearrayoutputstream baos byte array output stream bytearrayoutputstream size header separator length read byte readbyte fileuploadioexception io exception ioexception malformed stream exception malformedstreamexception stream ended unexpectedly size header size max malformed stream exception malformedstreamexception string format header bytes properly terminated integer value of valueof header size max header separator baos write string headers header encoding headerencoding headers baos to string tostring header encoding headerencoding unsupported encoding exception unsupportedencodingexception headers baos to string tostring headers baos to string tostring headers reads code body data code current code encapsulation code writes contents output code stream code arbitrary large amounts data processed method constant size buffer link multipart stream multipartstream input stream inputstream multipart stream multipartstream progress not ifier progressnotifier constructor param output code stream code write data method equivalent link discard body data discardbodydata amount data written malformed stream exception malformedstreamexception stream ends unexpectedly io exception ioexception error occurs read body data readbodydata output stream outputstream output malformed stream exception malformedstreamexception io exception ioexception streams copy closes input stream streams copy new input stream newinputstream output creates link item input stream iteminputstream instance link item input stream iteminputstream item input stream iteminputstream new input stream newinputstream item input stream iteminputstream reads code body data code current code encapsulation code discards method skip encapsulations don don under stand understand amount data discarded malformed stream exception malformedstreamexception stream ends unexpectedly io exception ioexception error occurs discard body data discardbodydata malformed stream exception malformedstreamexception io exception ioexception read body data readbodydata finds code encapsulation code code code code encapsulation code stream io exception ioexception error occurs skip preamble skippreamble io exception ioexception delimiter p rec eeded preceeded crlf system arraycopy boundary boundary boundary length boundary length boundarylength boundary length compute boundary table computeboundarytable discard data delimiter discard body data discardbodydata encapsulation read boundary readboundary malformed stream exception malformedstreamexception restore delimiter system arraycopy boundary boundary boundary length boundary length boundarylength boundary length boundary boundary compute boundary table computeboundarytable comp ares compares code count code bytes arrays code code code code param array compare param array compare param count bytes compared code code code count code bytes arrays code code code code equal array equals arrayequals count count searches code buffer code starting code position code param find param pos starting position searching position counting code buffer code code code find byte findbyte pos pos tail buffer searches code boundary code code buffer code region delimited code head code code tail code position boundary counting code buffer code code code find separator findseparator buffer pos bufferpos head table pos tablepos buffer pos bufferpos tail table pos tablepos buffer buffer pos bufferpos boundary table pos tablepos table pos tablepos boundary table boundarytable table pos tablepos buffer pos bufferpos table pos tablepos table pos tablepos boundary length boundarylength buffer pos bufferpos boundary length boundarylength thrown input stream fails follow required syntax malformed stream exception malformedstreamexception io exception ioexception uid serial izing serializing instance serialversionuid constructs code malformed stream exception malformedstreamexception code detail message malformed stream exception malformedstreamexception constructs code malformed stream exception malformedstreamexception code detail message param message detail message malformed stream exception malformedstreamexception string message message thrown attempt setting invalid boundary token illegal boundary exception illegalboundaryexception io exception ioexception serialversionuid constructs code illegal boundary exception illegalboundaryexception code detail message illegal boundary exception illegalboundaryexception constructs code illegal boundary exception illegalboundaryexception code detail message param message detail message illegal boundary exception illegalboundaryexception string message message link input stream inputstream reading items contents item input stream iteminputstream input stream inputstream closeable number bytes read total number bytes hold boundary pad current offset buffer pos stream closed closed creates instance item input stream iteminputstream find separator findseparator called finding separator find separator findseparator pos multipart stream multipartstream find separator findseparator pos tail head keep region keepregion pad keep region keepregion pad tail head returns number bytes read stream number bytes read get bytes read getbytesread total returns number bytes blocking io exception ioexception error occurs number bytes buffer override io exception ioexception pos tail head pad pos head offset converting negative bytes int egers integers positive offset returns stream stream negative int eger integer eof io exception ioexception error occurred override read io exception ioexception closed file item stream fileitemstream item skipped exception itemskippedexception make available makeavailable total buffer head positive offset reads bytes buffer param destination buffer write param offset buffer param len maximum number bytes read number bytes read eof io exception ioexception error occurred override read len io exception ioexception closed file item stream fileitemstream item skipped exception itemskippedexception len res res res make available makeavailable res res math min res len system arraycopy buffer head res head res total res res closes input stream io exception ioexception error occurred override close io exception ioexception close closes input stream param p close underlying pcloseunderlying close underlying stream hard close io exception ioexception error occurred close p close underlying pcloseunderlying io exception ioexception closed p close underlying pcloseunderlying closed input close make available makeavailable skip closed skips number bytes param bytes number bytes skip number bytes skipped io exception ioexception error occurred override skip bytes io exception ioexception closed file item stream fileitemstream item skipped exception itemskippedexception make available makeavailable res math min bytes head res res attempts read data number bytes io exception ioexception error occurred make available makeavailable io exception ioexception pos move data buffer total tail head pad system arraycopy buffer tail pad buffer pad ref ill refill buffer data head tail pad bytes read bytesread input read buffer tail buf size bufsize tail bytes read bytesread pad amount left buffer boundary signal error condition string msg stream ended unexpectedly malformed stream exception malformedstreamexception msg not ifier notifier not ifier notifier not e bytes read notebytesread bytes read bytesread tail bytes read bytesread find separator findseparator pos returns stream closed stream closed override is closed isclosed closed