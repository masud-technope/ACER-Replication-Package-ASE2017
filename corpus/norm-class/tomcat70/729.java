licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat jdbc pool java lang weak reference weakreference java lang reflect constructor java lang reflect invocation handler invocationhandler java lang reflect proxy java security access controller accesscontroller java security privileged action privilegedaction java sql connection java sql sql exception sqlexception java util collections java util concurrent modification exception concurrentmodificationexception java util hash set hashset java util iterator java util java util timer java util timer task timertask java util concurrent blocking queue blockingqueue java util concurrent count down latch countdownlatch java util concurrent execution exception executionexception java util concurrent java util concurrent linked blocking queue linkedblockingqueue java util concurrent thread pool executor threadpoolexecutor java util concurrent time unit timeunit java util concurrent timeout exception timeoutexception java util concurrent atomic atomic boolean atomicboolean java util concurrent atomic atomic integer atomicinteger java util concurrent atomic atomic long atomiclong org apache juli logging log org apache juli logging log factory logfactory connection pool connectionpool domain objects registering mbean server string pool jmx domain tomcat jdbc prefix type jmx registration string pool jmx type prefix pool jmx domain type logger log log log factory logfactory get log getlog connection pool connectionpool instance quick access variable carries size pool rel ying relying queue implementation iter ates iterates exact count atomic integer atomicinteger size atomic integer atomicinteger connection pool properties pool instantiated pool configuration poolconfiguration pool properties poolproperties connections todo should n shouldn blocking queue simply list hold objects blocking queue blockingqueue pooled connection pooledconnection busy idle connections blocking queue blockingqueue pooled connection pooledconnection idle thread responsible checking abandoned idle threads pool cleaner poolcleaner pool cleaner poolcleaner pool closed flag closed new proxy instance newproxyinstance performs operation optimized simply store constructor constructor proxy class constructor proxyclassconstructor executor service cancel futures thread pool executor threadpoolexecutor cancel lator cancellator thread pool executor threadpoolexecutor time unit timeunit milliseconds linked blocking queue linkedblockingqueue runnable reference jmx mbean org apache tomcat jdbc pool jmx connection pool connectionpool jmx pool jmxpool counter track threads waiting connection atomic integer atomicinteger wait count waitcount atomic integer atomicinteger atomic long atomiclong pool version poolversion atomic long atomiclong min instantiate connection pool create connections initial size initialsize larger link pool properties poolproperties reused connection pool param prop pool properties poolproperties properties connection pool sql exception sqlexception connection pool connectionpool pool configuration poolconfiguration prop sql exception sqlexception setup quick access variables pools init prop retrieves connection connection block connection connection retrieved cancelled order connection returned pool reference connection connection sql exception sqlexception connection get connection async getconnectionasync sql exception sqlexception pooled connection pooledconnection borrow connection borrowconnection connection future connectionfuture sql exception sqlexception get message getmessage index of indexof no wait nowait retrieve underlying queue supports idle fair blocking queue fairblockingqueue pooled connection pooledconnection pcf fair blocking queue fairblockingqueue pooled connection pooledconnection idle poll async pollasync connection future connectionfuture pcf idle multi lock fair blocking queue multilockfairblockingqueue pooled connection pooledconnection pcf multi lock fair blocking queue multilockfairblockingqueue pooled connection pooledconnection idle poll async pollasync connection future connectionfuture pcf sql exception sqlexception connection pool misconfigured doesn support async retrieval fair property borrows connection pool connection idle queue pool reached link pool properties poolproperties max active maxactive max active maxactive connections connection returned connection pool attempt fetch connection link pool properties poolproperties max wait maxwait max wait maxwait milliseconds connection java sql connection javax sql pooled connection pooledconnection ref lection reflection proxy wrapping underlying object sql exception sqlexception wait times failure occurs creating connection connection get connection getconnection sql exception sqlexception check connection pooled connection pooledconnection con borrow connection borrowconnection setup connection setupconnection con borrows connection pool connection idle queue pool reached link pool properties poolproperties max active maxactive max active maxactive connections connection returned connection pool attempt fetch connection link pool properties poolproperties max wait maxwait max wait maxwait milliseconds connection java sql connection javax sql pooled connection pooledconnection ref lection reflection proxy wrapping underlying object sql exception sqlexception wait times failure occurs creating connection connection get connection getconnection string username string password sql exception sqlexception check connection pooled connection pooledconnection con borrow connection borrowconnection username password setup connection setupconnection con returns pool string pool string get name getname get pool properties getpoolproperties get pool name getpoolname number threads waiting connection number threads waiting connection get wait count getwaitcount wait count waitcount returns pool properties connection pool pool properties poolproperties pool configuration poolconfiguration get pool properties getpoolproperties pool properties poolproperties returns total size pool includes busy idle connections number established connections database get size getsize size returns number connections number established connections application get active getactive busy size returns number idle connections number established connections get idle getidle idle size returns link close close called connection pool unusable is closed isclosed closed methods config ures configures pooled connection proxy proxy link java sql connection link javax sql pooled connection pooledconnection interfaces calls link java sql connection methods prop agated propagated actual jdbc connection link java sql connection close method param con link pooled connection pooledconnection wrap proxy link java sql connection object wrapping pooled connection sql exception sqlexception int erceptor interceptor configured proxy instantiated connection setup connection setupconnection pooled connection pooledconnection con sql exception sqlexception fetch cached int erceptor interceptor proxy connection jdbc interceptor jdbcinterceptor handler con get handler gethandler handler build proxy handler handler proxy connection proxyconnection con get pool properties getpoolproperties is use equals isuseequals int erceptor interceptor chain pool properties poolproperties interceptor definition interceptordefinition proxies get pool properties getpoolproperties get jdbc int erceptors as array getjdbcinterceptorsasarray proxies length create instance jdbc interceptor jdbcinterceptor int erceptor interceptor proxies get interceptor class getinterceptorclass new instance newinstance configure properties int erceptor interceptor set properties setproperties proxies get properties getproperties setup chain int erceptor interceptor set next setnext handler call reset int erceptor interceptor reset con configure held connection handler int erceptor interceptor exception sql exception sqlexception sql exception sqlexception unable instantiate int erceptor interceptor chain init cause initcause cache handler iteration con set handler sethandler handler jdbc interceptor jdbcinterceptor handler cached handler reset reset con get next getnext get proxy constructor getproxyconstructor con getxaconnection create proxy todo optimization track connection returned properly don generate facade connection connection get pool properties getpoolproperties get use disposable connection facade getusedisposableconnectionfacade connection connection proxy class constructor proxyclassconstructor new instance newinstance object disposable connection facade disposableconnectionfacade handler connection connection proxy class constructor proxyclassconstructor new instance newinstance object handler connection connection exception sql exception sqlexception sql exception sqlexception init cause initcause creates caches link java lang reflect constructor instantiate proxy object cache creation constructor slow constructor instantiate wrapper object no such method exception nosuchmethodexception constructor get proxy constructor getproxyconstructor no such method exception nosuchmethodexception cache constructor proxy class constructor proxyclassconstructor proxy class proxyclass proxy get proxy class getproxyclass connection pool connectionpool get class loader getclassloader java sql connection javax sql pooled connection pooledconnection javax sql xa connection xaconnection proxy get proxy class getproxyclass connection pool connectionpool get class loader getclassloader java sql connection javax sql pooled connection pooledconnection proxy class constructor proxyclassconstructor proxy class proxyclass get constructor getconstructor invocation handler invocationhandler proxy class constructor proxyclassconstructor closes pool disconnects idle connections active connections closed link java sql connection close close method called underlying connection returned pool param force close active connections close force closed closed prevent threads entering closed background thread pool cleaner poolcleaner pool cleaner poolcleaner stop running stoprunning release idle connections blocking queue blockingqueue pooled connection pooledconnection pool idle size idle force busy idle pool size retrieve connection pooled connection pooledconnection con pool poll time unit timeunit milliseconds close retrieve con close connection pool idle release con abandon con pool size con pool poll time unit timeunit milliseconds interrupted exception interruptedexception get pool properties getpoolproperties get propagate int err upt state getpropagateinterruptstate thread current thread currentthread int errupt interrupt pool size force pool busy pool busy get pool properties getpoolproperties is jmx enabled isjmxenabled jmx pool jmxpool pool properties poolproperties interceptor definition interceptordefinition proxies get pool properties getpoolproperties get jdbc int erceptors as array getjdbcinterceptorsasarray proxies length jdbc interceptor jdbcinterceptor int erceptor interceptor proxies get interceptor class getinterceptorclass new instance newinstance int erceptor interceptor set properties setproperties proxies get properties getproperties int erceptor interceptor pool closed poolclosed exception log debug unable info rm inform int erceptor interceptor pool closure close pool closepool initialize connection pool called constructor param properties pool properties poolproperties properties initialize pool sql exception sqlexception initialization fails init pool configuration poolconfiguration properties sql exception sqlexception pool properties poolproperties properties pool properly configured check pool configuration checkpoolconfiguration properties space extra flow bit busy linked blocking queue linkedblockingqueue pooled connection pooledconnection space extra flow bit properties is fair queue isfairqueue idle fair blocking queue fairblockingqueue pooled connection pooledconnection idle multi lock fair blocking queue multilockfairblockingqueue pooled connection pooledconnection idle linked transfer queue linkedtransferqueue pooled connection pooledconnection idle array blocking queue arrayblockingqueue pooled connection pooledconnection properties get max active getmaxactive idle linked blocking queue linkedblockingqueue pooled connection pooledconnection initialize pool cleaner initializepoolcleaner properties create jmx m bean mbean get pool properties getpoolproperties is jmx enabled isjmxenabled creatembean parse create initial int erceptors interceptors letting pool started int erceptors interceptors connection pool properties poolproperties interceptor definition interceptordefinition proxies get pool properties getpoolproperties get jdbc int erceptors as array getjdbcinterceptorsasarray proxies length log is debug enabled isdebugenabled log debug creating int erceptor interceptor instance proxies get interceptor class getinterceptorclass jdbc interceptor jdbcinterceptor int erceptor interceptor proxies get interceptor class getinterceptorclass new instance newinstance int erceptor interceptor set properties setproperties proxies get properties getproperties int erceptor interceptor pool started poolstarted exception log error unable info rm inform int erceptor interceptor pool start jmx pool jmxpool jmx pool jmxpool notify org apache tomcat jdbc pool jmx connection pool connectionpool notify init get stack trace getstacktrace close sql exception sqlexception sql exception sqlexception init cause initcause initialize pool initial members pooled connection pooledconnection initial pool initialpool pooled connection pooledconnection pool properties poolproperties get initial size getinitialsize initial pool initialpool length don wait content ion contention initial pool initialpool borrow connection borrowconnection sql exception sqlexception log error unable create initial connections pool pool properties poolproperties is ignore exception on pre load isignoreexceptiononpreload jmx pool jmxpool jmx pool jmxpool notify org apache tomcat jdbc pool jmx connection pool connectionpool notify init get stack trace getstacktrace close members idle pool initial pool initialpool length initial pool initialpool return connection returnconnection initial pool initialpool exception closed check pool configuration checkpoolconfiguration pool configuration poolconfiguration properties pool properly configured properties get max active getmaxactive log warn max active maxactive smaller setting max active maxactive pool properties poolproperties max active properties set max active setmaxactive pool properties poolproperties max active properties get max active getmaxactive properties get initial size getinitialsize log warn initial size initialsize larger max active maxactive setting initial size initialsize properties get max active getmaxactive properties set initial size setinitialsize properties get max active getmaxactive properties get min idle getminidle properties get max active getmaxactive log warn min idle minidle larger max active maxactive setting min idle minidle properties get max active getmaxactive properties set min idle setminidle properties get max active getmaxactive properties get max idle getmaxidle properties get max active getmaxactive log warn max idle maxidle larger max active maxactive setting max idle maxidle properties get max active getmaxactive properties set max idle setmaxidle properties get max active getmaxactive properties get max idle getmaxidle properties get min idle getminidle log warn max idle maxidle smaller min idle minidle setting max idle maxidle properties get min idle getminidle properties set max idle setmaxidle properties get min idle getminidle initialize pool cleaner initializepoolcleaner pool configuration poolconfiguration properties evictor thread supposed start properties is pool sweeper enabled ispoolsweeperenabled pool cleaner poolcleaner pool cleaner poolcleaner properties get time between eviction runs millis gettimebetweenevictionrunsmillis pool cleaner poolcleaner start terminate pool cleaner terminatepoolcleaner pool cleaner poolcleaner pool cleaner poolcleaner stop running stoprunning pool cleaner poolcleaner connection pooling impl logic thread safe abandon connection sig nals signals connection abandoned disconnect connection log stack trace log abanded logabanded param con pooled connection pooledconnection abandon pooled connection pooledconnection con con con lock string trace con get stack trace getstacktrace get pool properties getpoolproperties is log abandoned islogabandoned log warn connection abandoned con trace jmx pool jmxpool jmx pool jmxpool notify org apache tomcat jdbc pool jmx connection pool connectionpool notify abandon trace release connection release con con unlock thread safe suspect connection link abandon pooled connection pooledconnection abandoning connection log warning suspect flag link pooled connection pooledconnection log abandoned logabandoned param con pooled connection pooledconnection suspect pooled connection pooledconnection con con con is suspect issuspect con lock string trace con get stack trace getstacktrace get pool properties getpoolproperties is log abandoned islogabandoned log warn connection marked suspect abandoned con system current time millis currenttimemillis con get timestamp gettimestamp trace jmx pool jmxpool jmx pool jmxpool notify org apache tomcat jdbc pool jmx connection pool connectionpool suspect abandoned not ification notification trace con set suspect setsuspect con unlock thread safe release connection param con pooled connection pooledconnection release pooled connection pooledconnection con con con lock con release counter decremented size add and get addandget con set handler sethandler con unlock not ified notified wait count waitcount idle offer create thread safe retrieve connection pool param wait time wait overrides max wait maxwait properties max wait maxwait wait time pooled connection pooledconnection sql exception sqlexception pooled connection pooledconnection borrow connection borrowconnection wait string username string password sql exception sqlexception is closed isclosed sql exception sqlexception connection pool closed current time stamp system current time millis currenttimemillis pooled connection pooledconnection con idle poll con configure connection pooled connection pooledconnection result borrow connection borrowconnection con username password result result connection size get pool properties getpoolproperties get max active getmaxactive atomic duplicate check size add and get addandget get pool properties getpoolproperties get max active getmaxactive threads passed size decrement and get decrementandget create connection limit create connection createconnection con username password calculate wait time iteration max wait maxwait wait passed wait time pool property wait max wait maxwait get pool properties getpoolproperties get max wait getmaxwait max get pool properties getpoolproperties get max wait getmaxwait time towait timetowait math max max wait maxwait system current time millis currenttimemillis wait count waitcount increment and get incrementandget retrieve existing connection con idle poll time towait timetowait time unit timeunit milliseconds interrupted exception interruptedexception get pool properties getpoolproperties get propagate int err upt state getpropagateinterruptstate thread current thread currentthread int errupt interrupt sql exception sqlexception sql exception sqlexception pool wait int errupted interrupted init cause initcause wait count waitcount decrement and get decrementandget max wait maxwait con wait jmx pool jmxpool jmx pool jmxpool notify org apache tomcat jdbc pool jmx connection pool connectionpool pool empty pool empty wait pool exhausted exception poolexhaustedexception thread current thread currentthread get name getname no wait nowait pool empty unable fetch connection busy size didn connection time d timed con system current time millis currenttimemillis max wait maxwait jmx pool jmxpool jmx pool jmxpool notify org apache tomcat jdbc pool jmx connection pool connectionpool pool empty pool empty timeout pool exhausted exception poolexhaustedexception thread current thread currentthread get name getname timeout pool empty unable fetch connection max wait maxwait seconds size size busy busy size idle idle size last wait lastwait time towait timetowait timeout creates jdbc connection connect database param timestamp called param not used notused argument pooled connection pooledconnection connected sql exception sqlexception pooled connection pooledconnection create connection createconnection pooled connection pooledconnection not used notused string username string password sql exception sqlexception connections create pooled connection pooledconnection con create username con get attributes getattributes pooled connection pooledconnection prop user username password con get attributes getattributes pooled connection pooledconnection prop password password error connect validate connection con lock con connect con validate pooled connection pooledconnection validate init lock cont ented contented con set timestamp settimestamp get pool properties getpoolproperties is log abandoned islogabandoned con set stack trace setstacktrace get thread dump getthreaddump busy offer con log debug connection doesn fit busy array connection trace able traceable con clean sql exception sqlexception validation query failed enable log validation errors logvalidationerrors details exception error log is debug enabled isdebugenabled log debug unable create jdbc connection sql exception sqlexception sql exception sqlexception sql exception sqlexception sql exception sqlexception get message getmessage init cause initcause con error release con con unlock valid ates validates config ures configures idle connection param timestamp param con connection validate configure con sql exception sqlexception validation error pooled connection pooledconnection borrow connection borrowconnection pooled connection pooledconnection con string username string password sql exception sqlexception connection flag nullify set to null settonull con lock user check usercheck con check user checkuser username password con is released isreleased con is discarded isdiscarded con is initialized isinitialized connection discarded connection don attempt connect reconnect user check usercheck user check usercheck con is discarded isdiscarded con validate pooled connection pooledconnection validate borrow timestamp con set timestamp settimestamp get pool properties getpoolproperties is log abandoned islogabandoned stack trace pool con set stack trace setstacktrace get thread dump getthreaddump busy offer con log debug connection doesn fit busy array connection trace able traceable con connection should n shouldn poll con reconnect validation mode validationmode get pool properties getpoolproperties is test on connect istestonconnect get pool properties getpoolproperties getinitsql pooled connection pooledconnection validate init pooled connection pooledconnection validate borrow con validate validation mode validationmode timestamp con set timestamp settimestamp get pool properties getpoolproperties is log abandoned islogabandoned stack trace pool con set stack trace setstacktrace get thread dump getthreaddump busy offer con log debug connection doesn fit busy array connection trace able traceable con validation failed sql exception sqlexception failed validate newly established connection exception release con set to null settonull sql exception sqlexception sql exception sqlexception sql exception sqlexception sql exception sqlexception get message getmessage init cause initcause con unlock set to null settonull con terminate current transaction connection param con code code connection termination succeeded code code terminate transaction terminatetransaction pooled connection pooledconnection con equals con get pool properties getpoolproperties get default auto commit getdefaultautocommit get pool properties getpoolproperties get rollback on return getrollbackonreturn auto commit autocommit con get connection getconnection get auto commit getautocommit auto commit autocommit con get connection getconnection rollback get pool properties getpoolproperties get commit on return getcommitonreturn auto commit autocommit con get connection getconnection get auto commit getautocommit auto commit autocommit con get connection getconnection commit sql exception sqlexception log warn unable terminate transaction connection closed determines connection closed pool param con connection param action validation action performed connection closed should close shouldclose pooled connection pooledconnection con action con get connection version getconnectionversion get pool version getpoolversion con is discarded isdiscarded is closed isclosed con validate action terminate transaction terminatetransaction con get pool properties getpoolproperties get max age getmaxage system current time millis currenttimemillis con get last connected getlastconnected get pool properties getpoolproperties get max age getmaxage returns connection pool pool closed connection released connection busy queue released link pool properties poolproperties test on return testonreturn validated param con pooled connection pooledconnection returned pool return connection returnconnection pooled connection pooledconnection con is closed isclosed connection pool closed close connection returning release con con con lock con is suspect issuspect pool properties poolproperties is log abandoned islogabandoned log is info enabled isinfoenabled log info connection con marked suspect returned processing time system current time millis currenttimemillis con get timestamp gettimestamp busy remove con should close shouldclose con pooled connection pooledconnection validate con set stack trace setstacktrace con set timestamp settimestamp system current time millis currenttimemillis idle size pool properties poolproperties get max idle getmaxidle pool properties poolproperties is pool sweeper enabled ispoolsweeperenabled idle offer con log is debug enabled isdebugenabled log debug connection con closed returned pool idle idle size max idle maxidle pool properties poolproperties get max idle getmaxidle idle offer failed release con log is debug enabled isdebugenabled log debug connection con closed returned pool release con log is debug enabled isdebugenabled log debug connection con closed returned pool busy remove failed release con con unlock check in checkin determines connection abandoned based link pool properties poolproperties abandon when percentage full abandonwhenpercentagefull setting connection abandoned should abandon shouldabandon pool properties poolproperties is remove abandoned isremoveabandoned pool properties poolproperties get abandon when percentage full getabandonwhenpercentagefull busy size max pool properties poolproperties get max active getmaxactive per c perc pool properties poolproperties get abandon when percentage full getabandonwhenpercentagefull max per c perc iter ates iterates busy connections checks connections time d timed check abandoned checkabandoned busy size iterator pooled connection pooledconnection locked busy iterator sto get pool properties getpoolproperties get suspect timeout getsuspecttimeout locked has next hasnext pooled connection pooledconnection con locked set to null settonull con lock ignore idle con con is released isreleased time con get timestamp gettimestamp system current time millis currenttimemillis should abandon shouldabandon time con get abandon timeout getabandontimeout busy remove con abandon con set to null settonull sto time sto suspect con con unlock set to null settonull con concurrent modification exception concurrentmodificationexception log debug check abandoned checkabandoned failed exception log warn check abandoned checkabandoned failed retried iter ates iterates idle connections res izes resizes idle pool based parameters link pool properties poolproperties max idle maxidle link pool properties poolproperties min idle minidle link pool properties poolproperties min evictable idle time millis minevictableidletimemillis check idle checkidle check idle checkidle check idle checkidle ignore min size ignoreminsize idle size system current time millis currenttimemillis iterator pooled connection pooledconnection unlocked idle iterator ignore min size ignoreminsize idle size get pool properties getpoolproperties get min idle getminidle unlocked has next hasnext pooled connection pooledconnection con unlocked set to null settonull con lock con clean busy con time con get timestamp gettimestamp should release idle shouldreleaseidle con time release con idle remove con set to null settonull con unlock set to null settonull con concurrent modification exception concurrentmodificationexception log debug check idle checkidle failed exception log warn check idle checkidle failed retried should release idle shouldreleaseidle pooled connection pooledconnection con time con get connection version getconnectionversion get pool version getpoolversion con get release time getreleasetime time con get release time getreleasetime get size getsize get pool properties getpoolproperties get min idle getminidle for ces forces validation idle connections link pool properties poolproperties test while idle testwhileidle test all idle testallidle idle size iterator pooled connection pooledconnection unlocked idle iterator unlocked has next hasnext pooled connection pooledconnection con unlocked con lock con clean busy con con validate pooled connection pooledconnection validate idle idle remove con release con con unlock concurrent modification exception concurrentmodificationexception log debug test all idle testallidle failed exception log warn test all idle testallidle failed retried creates stack trace representing existing thread current string object representing current todo investigate simply store link java lang thread get stack trace getstacktrace elements string get thread dump getthreaddump exception exception fill in stack trace fillinstacktrace get stack trace getstacktrace convert exception string param throwable string representing stack trace string get stack trace getstacktrace throwable java byte array output stream bytearrayoutputstream bout java byte array output stream bytearrayoutputstream java print stream printstream writer java print stream printstream bout print stack trace printstacktrace writer string result bout to string tostring get message getmessage get message getmessage length get message getmessage result result create pooled connection object connected validated pooled connection object pooled connection pooledconnection create increment counter incrementcounter increment counter incrementcounter size increment and get incrementandget pooled connection pooledconnection con pooled connection pooledconnection get pool properties getpoolproperties con purges connections pool connections connections purge d purged returned pool call purges connections idle pool purge active connections link purge on return purgeonreturn purge purge on return purgeonreturn check idle checkidle purges connections returned pool call purge idle connections purge idle connections link purge purge on return purgeonreturn pool version poolversion increment and get incrementandget hook perform actions pooled connection object disconnected discarded param con finalize pooled connection pooledconnection con jdbc interceptor jdbcinterceptor handler con get handler gethandler handler handler reset handler handler get next getnext hook perform actions pooled connection object disconnected discarded param con disconnect event disconnectevent pooled connection pooledconnection con final izing finalizing jdbc interceptor jdbcinterceptor handler con get handler gethandler handler handler disconnected con final izing finalizing handler handler get next getnext object registered jmx not ifications notifications object implementing link org apache tomcat jdbc pool jmx connection pool bean connectionpoolmbean org apache tomcat jdbc pool jmx connection pool connectionpool get jmx pool getjmxpool jmx pool jmxpool create m bean mbean object registered creatembean jmx pool jmxpool org apache tomcat jdbc pool jmx connection pool connectionpool exception log warn unable start jmx int egration integration connection pool instance get name getname monitored tread safe wrapper regular queue ret rieves retrieves pooled connection object performs initialization int erceptors interceptors validation rules thread safe cancel lab le cancellable author fhanik connection future connectionfuture connection runnable pooled connection pooledconnection pc future pcfuture atomic boolean atomicboolean configured atomic boolean atomicboolean count down latch countdownlatch latch count down latch countdownlatch connection result sql exception sqlexception atomic boolean atomicboolean cancelled atomic boolean atomicboolean pooled connection pooledconnection connection future connectionfuture pooled connection pooledconnection pcf pc future pcfuture pcf connection future connectionfuture pooled connection pooledconnection sql exception sqlexception result connection pool connectionpool setup connection setupconnection configured inherit doc inheritdoc override cancel may int err upt if running mayinterruptifrunning cancelled cancelled compare and set compareandset cancel retrieving connection returning pool connection pool connectionpool cancel lator cancellator execute inherit doc inheritdoc override connection interrupted exception interruptedexception execution exception executionexception max time unit timeunit milliseconds timeout exception timeoutexception execution exception executionexception inherit doc inheritdoc override connection timeout time unit timeunit unit interrupted exception interruptedexception execution exception executionexception timeout exception timeoutexception pooled connection pooledconnection pc future pcfuture timeout unit result result configured compare and set compareandset borrow connection borrowconnection system current time millis currenttimemillis result connection pool connectionpool setup connection setupconnection sql exception sqlexception latch count down countdown reach thread config uri ng configuring actual connection should n shouldn block latch await timeout unit result execution exception executionexception result inherit doc inheritdoc override is cancelled iscancelled pc future pcfuture is cancelled iscancelled cancelled inherit doc inheritdoc override is done isdone pc future pcfuture is done isdone method executed cancelled executor override complete connection con pool con close execution exception executionexception exception connection pool connectionpool log error unable cancel connection future connectionfuture timer pool clean timer poolcleantimer hash set hashset pool cleaner poolcleaner clean ers cleaners hash set hashset pool cleaner poolcleaner register cleaner registercleaner pool cleaner poolcleaner cleaner unregister cleaner unregistercleaner cleaner clean ers cleaners add cleaner pool clean timer poolcleantimer class loader classloader loader thread current thread currentthread get context class loader getcontextclassloader thread current thread currentthread set context class loader setcontextclassloader connection pool connectionpool get class loader getclassloader create timer thread privileged action privilegedaction reference web application loader created thread inherited access control context inheritedaccesscontrolcontext privileged action privilegedaction timer privileged new timer privilegednewtimer pool clean timer poolcleantimer access controller accesscontroller do privileged doprivileged thread current thread currentthread set context class loader setcontextclassloader loader pool clean timer poolcleantimer schedule cleaner cleaner sleep time sleeptime cleaner sleep time sleeptime unregister cleaner unregistercleaner pool cleaner poolcleaner cleaner removed clean ers cleaners remove cleaner removed cleaner cancel pool clean timer poolcleantimer pool clean timer poolcleantimer purge clean ers cleaners size pool clean timer poolcleantimer cancel pool clean timer poolcleantimer privileged new timer privilegednewtimer privileged action privilegedaction timer override timer timer tomcat jdbc pool cleaner system identity hash code identityhashcode connection pool connectionpool get class loader getclassloader system current time millis currenttimemillis timer task timertask get pool clean ers getpoolcleaners collections timer task timertask unmodifiable set unmodifiableset clean ers cleaners get pool version getpoolversion pool version poolversion timer get pool timer getpooltimer pool clean timer poolcleantimer pool cleaner poolcleaner timer task timertask weak reference weakreference connection pool connectionpool pool sleep time sleeptime pool cleaner poolcleaner connection pool connectionpool pool sleep time sleeptime pool weak reference weakreference connection pool connectionpool pool sleep time sleeptime sleep time sleeptime sleep time sleeptime log warn data base database connection pool evicter thread int erval interval def aulting defaulting seconds sleep time sleeptime sleep time sleeptime log warn data base database connection pool evicter thread int erval interval override connection pool connectionpool pool pool pool stop running stoprunning pool is closed isclosed pool get pool properties getpoolproperties is remove abandoned isremoveabandoned pool get pool properties getpoolproperties get suspect timeout getsuspecttimeout pool check abandoned checkabandoned pool get pool properties getpoolproperties get min idle getminidle pool idle size pool check idle checkidle pool get pool properties getpoolproperties is test while idle istestwhileidle pool test all idle testallidle exception log error start register cleaner registercleaner stop running stoprunning unregister cleaner unregistercleaner