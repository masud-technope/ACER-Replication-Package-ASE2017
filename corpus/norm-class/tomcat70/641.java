licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat util buf java file java net malformedurlexception java net url java util regex pattern utility working uri s uris url s urls uri util uriutil pattern pattern exclamation mark pattern compile pattern pattern caret pattern compile pattern pattern ast erisk asterisk pattern compile uri util uriutil utility hide constructor determine character allowed scheme uri rfc param character test code character allowed code is scheme char isschemechar character is letter or digit isletterordigit determine uri string code scheme code component param uri uri test code scheme code has scheme hasscheme char sequence charsequence uri len uri length len uri char at charat uri util uriutil is scheme char isschemechar url build jar url buildjarurl file jar file jarfile malformedurlexception build jar url buildjarurl jar file jarfile url build jar url buildjarurl file jar file jarfile string entry path entrypath malformedurlexception build jar url buildjarurl jar file jarfile touri to string tostring entry path entrypath url build jar url buildjarurl string file url string fileurlstring malformedurlexception build jar url buildjarurl file url string fileurlstring url build jar url buildjarurl string file url string fileurlstring string entry path entrypath malformedurlexception string safe string safestring make safe for jar url makesafeforjarurl file url string fileurlstring string builder stringbuilder string builder stringbuilder append jar append safe string safestring append entry path entrypath append make safe for jar url makesafeforjarurl entry path entrypath url to string tostring url build jar safe url buildjarsafeurl file file malformedurlexception string safe make safe for jar url makesafeforjarurl file touri to string tostring url safe testing mark t markt desktop iteration string replace all replaceall switching implementation pre compiled patterns pattern matcher input replace all replaceall replacement reduced note small absolute time single iteration web application jar s jars add opt imisation optimisation pulled separate method handle unusual sequences string make safe for jar url makesafeforjarurl string input special meaning jar url sequence properly escaped string tmp pattern exclamation mark matcher input replace all replaceall tomcat custom jar war url handling treats special tmp pattern caret matcher tmp replace all replaceall pattern ast erisk asterisk matcher tmp replace all replaceall