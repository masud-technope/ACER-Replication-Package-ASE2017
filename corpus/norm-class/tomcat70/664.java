licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat jdbc bugs java sql connection java sql driver manager drivermanager java sql sql exception sqlexception java util array list arraylist java util arrays java util collection java util list java util concurrent array blocking queue arrayblockingqueue java util concurrent count down latch countdownlatch java util concurrent atomic atomic integer atomicinteger org junit org junit test org junit runner run with runwith org junit run ners runners parameterized org apache tomcat jdbc pool connection pool connectionpool org apache tomcat jdbc pool data source datasource org apache tomcat jdbc pool pool exhausted exception poolexhaustedexception org apache tomcat jdbc pool pool properties poolproperties org apache tomcat jdbc test default properties defaultproperties run with runwith parameterized bug fair queue fairqueue bug fair fair queue fairqueue fair parameterized parameters collection parameters arrays as list aslist object object object test test pool testpool sql exception sqlexception interrupted exception interruptedexception driver manager drivermanager set login timeout setlogintimeout pool properties poolproperties pool properties poolproperties default properties defaultproperties threads count threadscount pool properties poolproperties set max active setmaxactive threads count threadscount pool properties poolproperties set max idle setmaxidle threads count threadscount pool properties poolproperties set min idle setminidle pool properties poolproperties set max wait setmaxwait pool properties poolproperties set initial size setinitialsize pool properties poolproperties set remove abandoned setremoveabandoned pool properties poolproperties set remove abandoned timeout setremoveabandonedtimeout pool properties poolproperties set rollback on return setrollbackonreturn pool properties poolproperties set fair queue setfairqueue fair queue fairqueue data source datasource data source datasource pool properties poolproperties count down latch countdownlatch opened latch openedlatch count down latch countdownlatch threads count threadscount count down latch countdownlatch closed latch closedlatch count down latch countdownlatch threads count threadscount count down latch countdownlatch to close latch tocloselatch count down latch countdownlatch threads count threadscount thread runnable override connection connection get connection getconnection opened latch openedlatch count down countdown to close latch tocloselatch await connection close closed latch closedlatch count down countdown exception system err println step get message getmessage start opened latch openedlatch await connection pool connectionpool pool get pool getpool initialized busy connections assert equals assertequals pool get idle getidle assert equals assertequals threads count threadscount pool get active getactive assert equals assertequals threads count threadscount pool get size getsize list thread threads array list arraylist thread threads count threadscount thread thread thread runnable override get connection getconnection exception system err println step get message getmessage thread start threads add thread thread thread threads thread int errupt interrupt thread thread threads thread join active connections assert equals assertequals pool get idle getidle assert equals assertequals threads count threadscount pool get active getactive assert equals assertequals threads count threadscount pool get size getsize to close latch tocloselatch count down countdown closed latch closedlatch await bug active connections unable establish connections threads count threadscount assert equals assertequals threads count threadscount pool get idle getidle assert equals assertequals pool get active getactive assert equals assertequals threads count threadscount pool get size getsize atomic integer atomicinteger failed count failedcount atomic integer atomicinteger array blocking queue arrayblockingqueue connection cons array blocking queue arrayblockingqueue connection threads count threadscount threads clear threads count threadscount thread thread thread runnable override cons add get connection getconnection pool exhausted exception poolexhaustedexception failed count failedcount increment and get incrementandget system err println step get message getmessage exception system err println step get message getmessage runtime exception runtimeexception thread start threads add thread thread thread threads thread join assert equals assertequals failed count failedcount assert equals assertequals pool get idle getidle assert equals assertequals threads count threadscount pool get active getactive assert equals assertequals threads count threadscount pool get size getsize connection con cons con close assert equals assertequals threads count threadscount pool get idle getidle assert equals assertequals pool get active getactive assert equals assertequals threads count threadscount pool get size getsize