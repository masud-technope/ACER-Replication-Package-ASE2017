licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina session java io exception ioexception java util arrays java util concurrent atomic atomic integer atomicinteger javax servlet servlet exception servletexception javax servlet http http servlet httpservlet javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse javax servlet http http session httpsession org junit org junit org junit org junit test org apache catalina context org apache catalina lifecycle exception lifecycleexception org apache catalina session org apache catalina core standard context standardcontext org apache catalina startup tomcat org apache catalina startup tomcat base test tomcatbasetest org apache catalina valves persistent valve persistentvalve test persistent manager int egration testpersistentmanagerintegration tomcat base test tomcatbasetest string activity check org apache catalina session standard session standardsession activity check string old activity check oldactivitycheck doc umented documented config manager html activity check property persistent manager persistentmanager function correctly set activity check setactivitycheck old activity check oldactivitycheck system set property setproperty activity check reset activity check resetactivitycheck old activity check oldactivitycheck system set property setproperty activity check old activity check oldactivitycheck system clear property clearproperty activity check wait system clock update systems windows clock granularity tens milliseconds wait for c lock update waitforclockupdate interrupted exception interruptedexception start time starttime system current time millis currenttimemillis wait time waittime thread sleep wait time waittime wait time waittime system current time millis currenttimemillis start time starttime wait session access counter positive wait while session is active waitwhilesessionisactive standard session standardsession session interrupted exception interruptedexception max wait time maxwaittime system current time millis currenttimemillis atomic integer atomicinteger access count accesscount session access count accesscount access count accesscount wait connector request recycle completes updates last accessed time lastaccessedtime assert true asserttrue system current time millis currenttimemillis max wait time maxwaittime thread sleep test no session create nosessioncreate io exception ioexception lifecycle exception lifecycleexception setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required standard context standardcontext ctx standard context standardcontext tomcat add context addcontext ctx set distributable setdistributable tomcat add servlet addservlet ctx dummy servlet dummyservlet dummy servlet dummyservlet ctx add servlet mapping addservletmapping dummy dummy servlet dummyservlet persistent manager persistentmanager manager persistent manager persistentmanager tester store testerstore store tester store testerstore manager set store setstore store manager set max idle backup setmaxidlebackup ctx set manager setmanager manager ctx add valve addvalve persistent valve persistentvalve tomcat start assert equals assertequals manager get active sessions getactivesessions assert true asserttrue sessions managed manager get session ids full getsessionidsfull is empty isempty assert equals assertequals session get url geturl http localhost get port getport dummy create session to string tostring assert equals assertequals manager get active sessions getactivesessions assert true asserttrue sessions created manager get session ids full getsessionidsfull is empty isempty test test create session and pass ivate testcreatesessionandpassivate io exception ioexception lifecycle exception lifecycleexception class not found exception classnotfoundexception setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required standard context standardcontext ctx standard context standardcontext tomcat add context addcontext ctx set distributable setdistributable tomcat add servlet addservlet ctx dummy servlet dummyservlet dummy servlet dummyservlet ctx add servlet mapping addservletmapping dummy dummy servlet dummyservlet persistent manager persistentmanager manager persistent manager persistentmanager tester store testerstore store tester store testerstore manager set store setstore store manager set max idle backup setmaxidlebackup ctx set manager setmanager manager ctx add valve addvalve persistent valve persistentvalve tomcat start assert equals assertequals active sessions manager get active sessions getactivesessions assert true asserttrue sessions managed manager get session ids full getsessionidsfull is empty isempty string session id sessionid get url geturl http localhost get port getport dummy create session to string tostring assert not null assertnotnull session stored store load session id sessionid assert equals assertequals sessions pass ivated passivated manager get active sessions getactivesessions assert true asserttrue session created manager get session ids full getsessionidsfull is empty isempty test backs up once backsuponce io exception ioexception lifecycle exception lifecycleexception interrupted exception interruptedexception setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx set distributable setdistributable tomcat add servlet addservlet ctx dummy servlet dummyservlet dummy servlet dummyservlet ctx add servlet mapping addservletmapping dummy dummy servlet dummyservlet persistent manager persistentmanager manager persistent manager persistentmanager tester store testerstore store tester store testerstore manager set store setstore store manager set max idle backup setmaxidlebackup ctx set manager setmanager manager tomcat start string session id sessionid get url geturl http localhost get port getport dummy to string tostring note persistence manager persistencemanager find session findsession silently updates session last accessed time lastaccessedtime call work session session manager find session findsession session id sessionid wait request processing ends request recycle updates session last accessed time lastaccessedtime session end access endaccess wait while session is active waitwhilesessionisactive standard session standardsession session last accessed time lastaccessedtime session get last accessed time internal getlastaccessedtimeinternal session idle max idle backup maxidlebackup eligible persistence wait waiting bit accessed time session wait for c lock update waitforclockupdate manager process persistence checks processpersistencechecks assert equals assertequals arrays as list aslist session id sessionid store get saved ids getsavedids assert equals assertequals last accessed time lastaccessedtime session get last accessed time internal getlastaccessedtimeinternal session accessed save performed wait for c lock update waitforclockupdate manager process persistence checks processpersistencechecks assert equals assertequals arrays as list aslist session id sessionid store get saved ids getsavedids assert equals assertequals last accessed time lastaccessedtime session get last accessed time internal getlastaccessedtimeinternal access session session access session end access endaccess session accessed saved manager process persistence checks processpersistencechecks assert equals assertequals arrays as list aslist session id sessionid session id sessionid store get saved ids getsavedids session accessed save happen manager process persistence checks processpersistencechecks assert equals assertequals arrays as list aslist session id sessionid session id sessionid store get saved ids getsavedids dummy servlet dummyservlet http servlet httpservlet serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception create session createsession parse boolean parseboolean req get parameter getparameter create session http session httpsession session req get session getsession create session createsession session resp get writer getwriter print session string session get id getid resp get writer getwriter print