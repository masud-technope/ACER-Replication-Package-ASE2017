licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina connector java io exception ioexception javax servlet servlet exception servletexception javax servlet http http servlet httpservlet javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse org junit org junit test org apache catalina context org apache catalina startup simple http client simplehttpclient org apache catalina startup tomcat org apache catalina startup tomcat base test tomcatbasetest test max connections testmaxconnections tomcat base test tomcatbasetest max connections so timeout sotimeout connect timeout connecttimeout test test connector testconnector exception init connect thread connectthread connect thread connectthread length connect thread connectthread set name setname connect thread connectthread length start thread sleep length join assert equals assertequals max connections simple servlet simpleservlet get max connections getmaxconnections connect thread connectthread thread override test client testclient client test client testclient client do http dohttp request exception init exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context root tomcat add context addcontext tomcat add servlet addservlet root simple simple servlet simpleservlet root add servlet mapping addservletmapping test simple tomcat get connector getconnector set property setproperty max keep alive requests maxkeepaliverequests tomcat get connector getconnector set property setproperty max threads maxthreads tomcat get connector getconnector set property setproperty so timeout sotimeout tomcat get connector getconnector set property setproperty keep alive timeout keepalivetimeout tomcat get connector getconnector set property setproperty max connections maxconnections integer to string tostring max connections tomcat get connector getconnector set property setproperty accept count acceptcount tomcat start test client testclient simple http client simplehttpclient do http dohttp request exception set port setport get port getport start system current time millis currenttimemillis open connection connect connect timeout connecttimeout so timeout sotimeout send request parts string request string request test http crlf crlf set request setrequest request passed blocks response read process request processrequest system current time millis currenttimemillis log info thread current thread currentthread get name getname request complete start passed read line readline close connection disconnect reset assert true asserttrue passed override is response body k isresponsebodyok simple servlet simpleservlet http servlet httpservlet serialversionuid current connections currentconnections max connections maxconnections override service http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception increment thread sleep test max connections testmaxconnections so timeout sotimeout interrupted exception interruptedexception resp set content length setcontentlength resp flush buffer flushbuffer decrement increment current connections currentconnections current connections currentconnections max connections maxconnections max connections maxconnections current connections currentconnections decrement current connections currentconnections get max connections getmaxconnections max connections maxconnections