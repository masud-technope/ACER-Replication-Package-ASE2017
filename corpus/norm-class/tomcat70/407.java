licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache coyote http upgrade java io exception ioexception javax servlet servlet output stream servletoutputstream org apache coyote http upgrade servlet write listener writelistener org apache tomcat util exception utils exceptionutils org apache tomcat util res string manager stringmanager servlet methods link servlet output stream servletoutputstream abstract servlet output stream abstractservletoutputstream servlet output stream servletoutputstream string manager stringmanager string manager stringmanager get manager getmanager constants ensure is ready isready on write possible onwritepossible consistent view buffer fire listener firelistener determining listener fire object fire listener lock firelistenerlock object ensure thread writes socket time buffer consistently updated unwritten data write note hold lock checking buffer data depending result form synchronization required fire listener lock firelistenerlock object write lock writelock object close required closerequired start blocking mode write listener writelistener listener guarded fire listener lock firelistenerlock fire listener firelistener class loader classloader application loader applicationloader writes guarded write lock writelock buffer buffer pos bufferpos buffer limit bufferlimit async write buffer size asyncwritebuffersize abstract servlet output stream abstractservletoutputstream async write buffer size asyncwritebuffersize async write buffer size asyncwritebuffersize async write buffer size asyncwritebuffersize buffer async write buffer size asyncwritebuffersize servlet method is ready isready listener illegal state exception illegalstateexception get string getstring upgrade sos can write canwrite ise buffer fire listener firelistener determining listener fire fire listener lock firelistenerlock result buffer limit bufferlimit fire listener firelistener result result servlet method set write listener setwritelistener write listener writelistener listener listener illegal argument exception illegalargumentexception get string getstring upgrade sos write listener writelistener listener illegal argument exception illegalargumentexception get string getstring upgrade sos write listener writelistener listener listener application loader applicationloader thread current thread currentthread get context class loader getcontextclassloader is close required iscloserequired close required closerequired override write io exception ioexception write lock writelock pre write checks prewritechecks write internal writeinternal override write len io exception ioexception write lock writelock pre write checks prewritechecks write internal writeinternal len override close io exception ioexception close required closerequired do close doclose pre write checks prewritechecks buffer limit bufferlimit illegal state exception illegalstateexception get string getstring upgrade sis write ise hold write lock writelock call method write internal writeinternal len io exception ioexception listener simple blocking do write dowrite len blocking blocking read complete do write dowrite add socket poller poller trigger write event method finished updating buffer write lock writelock sync buffer updated write executes written do write dowrite len written len buffer partial write existing buffer increment current position buffer pos bufferpos written partial write bytes left bytesleft len written bytes left bytesleft buffer length buffer bytes left bytesleft bytes left bytesleft async write buffer size asyncwritebuffersize buffer length async write buffer size asyncwritebuffersize buffer async write buffer size asyncwritebuffersize buffer pos bufferpos buffer limit bufferlimit bytes left bytesleft system arraycopy written buffer buffer pos bufferpos buffer limit bufferlimit buffer limit bufferlimit on write possible onwritepossible io exception ioexception write lock writelock buffer limit bufferlimit write internal writeinternal buffer buffer pos bufferpos buffer limit bufferlimit buffer pos bufferpos throwable exception utils exceptionutils handle throwable handlethrowable on error onerror io exception ioexception io exception ioexception io exception ioexception is ready isready on write possible onwritepossible consistent view buffer fire listener firelistener determining listener fire fire fire listener lock firelistenerlock buffer limit bufferlimit fire listener firelistener fire listener firelistener fire fire thread thread thread current thread currentthread class loader classloader original class loader originalclassloader thread get context class loader getcontextclassloader thread set context class loader setcontextclassloader application loader applicationloader listener on write possible onwritepossible thread set context class loader setcontextclassloader original class loader originalclassloader on error onerror throwable listener thread thread thread current thread currentthread class loader classloader original class loader originalclassloader thread get context class loader getcontextclassloader thread set context class loader setcontextclassloader application loader applicationloader listener on error onerror thread set context class loader setcontextclassloader original class loader originalclassloader method overridden concrete implementations base ensure concurrent calls method socket ensuring write lock writelock held making calls method do write dowrite block len io exception ioexception do flush doflush io exception ioexception do close doclose io exception ioexception