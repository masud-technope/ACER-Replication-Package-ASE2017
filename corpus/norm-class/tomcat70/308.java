licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license websocket drawboard java awt color java awt graphics java awt rendering h ints renderinghints java awt image buffered image bufferedimage java byte array output stream bytearrayoutputstream java io exception ioexception java nio byte buffer bytebuffer java util array list arraylist java util list java util timer java util timer task timertask java util concurrent locks reentrant lock reentrantlock javax image io imageio imageio websocket drawboard wsmessages binary web socket message binarywebsocketmessage websocket drawboard wsmessages string web socket message stringwebsocketmessage room represents drawboard number users part icipate participate note instance methods invoked calling link invoke and wait invokeandwait runnable ensure access correctly room specifies type room message client note sending simple string messages product ion production apps json lib object level messages number single prefixed string sending message enum message type messagetype error error message error draw messsage drawmesssage serialized draw message drawmessage prefixed current player link player last received message id lastreceivedmessageid multiple draw messages concat enated concatenated separator draw message image message imagemessage number current players room message binary web socket websocket message follow current room image png message room sends player image message player changed playerchanged player removed room player changed flag message type messagetype flag flag flag lock synchronize access room reentrant lock reentrantlock room lock roomlock reentrant lock reentrantlock room shutdown closed code code out going outgoing draw messages drawmessages buf fered buffered drawmessage broadcast timer drawmessagebroadcasttimer ticks buffer draw messages timer sends buf fered buffered draw messages drawmessages client regular int erval interval avoid sending lot small messages tcp over head overhead high cpu usage timer drawmessage broadcast timer drawmessagebroadcasttimer timer timer delay current active broadcast timer task broadcast task scheduled task scheduled player enters room can celled cancelled player exits room avoid unnecessary timer executions timer task timertask active broadcast timer task activebroadcasttimertask current image room drawboard draw messages drawmessages received p layers players draw n drawn image buffered image bufferedimage room image roomimage buffered image bufferedimage buffered image bufferedimage type rgb graphics room graphics roomgraphics room image roomimage create graphics creategraphics maximum number players join room max player count list joined players list player players array list arraylist player room room graphics roomgraphics set rendering hint setrenderinghint rendering h ints renderinghints key ant ialiasing antialiasing rendering h ints renderinghints ant ialias antialias clear image white background room graphics roomgraphics set background setbackground color white room graphics roomgraphics clear rect clearrect room image roomimage get width getwidth room image roomimage get height getheight timer task timertask create broadcast timer task createbroadcasttimertask timer task timertask override invoke and wait invokeandwait runnable override broadcast timer tick broadcasttimertick creates player client adds room param client client player create and add player createandaddplayer client client players size max player count illegal state exception illegalstateexception maximum player count max player count reached player player client broadcast players player joined broadcast room message broadcastroommessage message type messagetype player changed add player list players add broacast timer task scheduled create active broadcast timer task activebroadcasttimertask active broadcast timer task activebroadcasttimertask create broadcast timer task createbroadcasttimertask drawmessage broadcast timer drawmessagebroadcasttimer schedule active broadcast timer task activebroadcasttimertask timer delay timer delay send current number players current room image string content string value of valueof players size send room message sendroommessage message type messagetype image message content store image png byte array output stream bytearrayoutputstream bout byte array output stream bytearrayoutputstream imageio write room image roomimage png bout io exception ioexception send image binary message binary web socket message binarywebsocketmessage msg binary web socket message binarywebsocketmessage byte buffer bytebuffer wrap bout to byte array tobytearray get client getclient send message sendmessage msg player remove from room removefromroom param internal remove player internalremoveplayer player removed players remove removed player left room cancel broadcast timer task players size cancel task note happen timer task timertask execute timer thread waits players player list executes prevent timer task timertask subclass bool an boolan cancel instance variable query invocation room invoke and wait invokeandwait active broadcast timer task activebroadcasttimertask cancel active broadcast timer task activebroadcasttimertask broadcast player removed broadcast room message broadcastroommessage message type messagetype player changed player handle draw message handledrawmessage draw message drawmessage param param msg param msg id msgid internal handle draw message internalhandledrawmessage player draw message drawmessage msg msg id msgid set last received message id setlastreceivedmessageid msg id msgid draw room message roommessage room image msg draw room graphics roomgraphics broadcast draw message broadcast draw message broadcastdrawmessage msg broadcasts drawboard message connected players note draw messages drawmessages link broadcast draw message broadcastdrawmessage draw message drawmessage method buffer prefix correct received message param type param content broadcast room message broadcastroommessage message type messagetype type string content player players send room message sendroommessage type content broadcast draw message drawmessage buffer message link drawmessage broadcast timer drawmessagebroadcasttimer broadcast regular int erval interval pref ixing prefixing player current link player last received message id lastreceivedmessageid param msg broadcast draw message broadcastdrawmessage draw message drawmessage msg buffer draw messages string msg str msgstr msg to string tostring player players string string value of valueof get last received message id getlastreceivedmessageid msg str msgstr send room message sendroommessage message type messagetype draw message player players get buffered draw messages getbuffereddrawmessages add msg tick handler broadcast timer broadcasttimer broadcast timer tick broadcasttimertick player players string builder stringbuilder string builder stringbuilder list draw message drawmessage draw messages drawmessages get buffered draw messages getbuffereddrawmessages draw messages drawmessages size draw messages drawmessages size draw message drawmessage msg draw messages drawmessages string string value of valueof get last received message id getlastreceivedmessageid msg to string tostring append append draw messages drawmessages clear send room message sendroommessage message type messagetype draw message to string tostring list cached link runnable prevent recursive invocation run nables runnables thread variable thread time code code list runnable cached run nables cachedrunnables sub mits submits runnable room executor waits executed simply runnable block note runnable recursively calls invoke and wait invokeandwait runnable room executed recursively cached original runnable finished behavior executor param task invoke and wait invokeandwait runnable task cache original invoke and wait invokeandwait finished room lock roomlock is held by current thread isheldbycurrentthread cached run nables cachedrunnables cached run nables cachedrunnables array list arraylist runnable cached run nables cachedrunnables add task room lock roomlock lock explicit ely explicitely overwrite ensure data consistency current thread cached run nables cachedrunnables closed task cached run nables runnables cached run nables cachedrunnables cached run nables cachedrunnables size closed cached run nables cachedrunnables cached run nables cachedrunnables room lock roomlock unlock shuts room executor roomexecutor drawmessage broadcast timer drawmessagebroadcasttimer shutdown invoke and wait invokeandwait runnable override closed drawmessage broadcast timer drawmessagebroadcasttimer cancel room graphics roomgraphics dispose player part icipates participates room link room link client note player object join room client player room player belongs room room room buf fers buffers draw message received player last received message id lastreceivedmessageid client client buffered draw messages drawmessages timer list draw message drawmessage buf fered draw messages buffereddrawmessages array list arraylist draw message drawmessage list draw message drawmessage get buffered draw messages getbuffereddrawmessages buf fered draw messages buffereddrawmessages player room room client client room room client client room get room getroom room client get client getclient client removes player room client disconnects remove from room removefromroom room room internal remove player internalremoveplayer room get last received message id getlastreceivedmessageid last received message id lastreceivedmessageid set last received message id setlastreceivedmessageid last received message id lastreceivedmessageid handles draw message drawmessage drawing room image broadcasting connected players param msg param msg id msgid handle draw message handledrawmessage draw message drawmessage msg msg id msgid room internal handle draw message internalhandledrawmessage msg msg id msgid s ends sends room message param type param content send room message sendroommessage message type messagetype type string content content type null pointer exception nullpointerexception string complete msg completemsg string value of valueof type flag content client send message sendmessage string web socket message stringwebsocketmessage complete msg completemsg