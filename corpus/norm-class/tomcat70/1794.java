licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina loader java io exception ioexception java util concurrent linked blocking queue linkedblockingqueue java util concurrent thread pool executor threadpoolexecutor java util concurrent time unit timeunit javax servlet servlet exception servletexception javax servlet http http servlet httpservlet javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse org junit org junit test org apache catalina context org apache catalina core standard context standardcontext org apache catalina startup tomcat org apache catalina startup tomcat base test tomcatbasetest test webapp class loader executor memory leak testwebappclassloaderexecutormemoryleak tomcat base test tomcatbasetest test test timer thread leak testtimerthreadleak exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx standard context standardcontext standard context standardcontext ctx set clear references stop threads setclearreferencesstopthreads executor servlet executorservlet executor servlet executorservlet executor servlet executorservlet tomcat add servlet addservlet ctx task servlet taskservlet executor servlet executorservlet ctx add servlet mapping addservletmapping task servlet taskservlet tomcat start trigger timer thread creation get url geturl http localhost get port getport context ctx thread exists thread memory leak thread sleep interrupted exception interruptedexception assert true asserttrue executor servlet executorservlet tpe is shutdown isshutdown assert true asserttrue executor servlet executorservlet tpe is terminated isterminated executor servlet executorservlet http servlet httpservlet serialversionuid n tasks ntasks tp size tpsize thread pool executor threadpoolexecutor tpe override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception resp get writer getwriter println current thread served servlet tpe thread pool executor threadpoolexecutor tp size tpsize tp size tpsize time unit timeunit milliseconds linked blocking queue linkedblockingqueue runnable task tasks task n tasks ntasks n tasks ntasks tasks task task tpe execute tasks resp get writer getwriter println started n tasks ntasks tasks thread pool executor threadpoolexecutor resp get writer getwriter flush task runnable string task string override thread current thread currentthread is interrupted isinterrupted thread sleep system println thread current thread currentthread get class getclass thread current thread currentthread get name getname executing interrupted exception interruptedexception system println thread current thread currentthread get class getclass thread current thread currentthread get name getname exiting