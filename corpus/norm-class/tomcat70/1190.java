licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina filters java io exception ioexception java net httpurlconnection java net url java util calendar java util list java util map entry java util string tokenizer stringtokenizer java util time zone timezone javax servlet servlet exception servletexception javax servlet http http servlet httpservlet javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse org junit org junit test org apache catalina context org apache catalina deploy filter def filterdef org apache catalina deploy filter map filtermap org apache catalina filters expires filter expiresfilter duration org apache catalina filters expires filter expiresfilter duration unit durationunit org apache catalina filters expires filter expiresfilter expires configuration expiresconfiguration org apache catalina filters expires filter expiresfilter starting point startingpoint org apache catalina startup tomcat org apache catalina startup tomcat base test tomcatbasetest test expires filter testexpiresfilter tomcat base test tomcatbasetest string temp dir system get property getproperty java tmp dir tmpdir test test configuration testconfiguration exception tomcat tomcat get tomcat instance gettomcatinstance context root tomcat add context addcontext temp dir filter def filterdef filter def filterdef filter def filterdef filter def filterdef add init parameter addinitparameter expires default expiresdefault access month filter def filterdef add init parameter addinitparameter expires by type expiresbytype text html access month days hours filter def filterdef add init parameter addinitparameter expires by type expiresbytype image gif modification hours minutes filter def filterdef add init parameter addinitparameter expires by type expiresbytype image jpg filter def filterdef add init parameter addinitparameter expires by type expiresbytype video mpeg filter def filterdef add init parameter addinitparameter expires excluded response status codes expiresexcludedresponsestatuscodes expires filter expiresfilter expires filter expiresfilter expires filter expiresfilter filter def filterdef set filter setfilter expires filter expiresfilter filter def filterdef set filter class setfilterclass expires filter expiresfilter get name getname filter def filterdef set filter name setfiltername expires filter expiresfilter get name getname root add filter def addfilterdef filter def filterdef filter map filtermap filter map filtermap filter map filtermap filter map filtermap set filter name setfiltername expires filter expiresfilter get name getname filter map filtermap addurlpattern tomcat start verify excluded response status codes excluded response status codes excludedresponsestatuscodes expires filter expiresfilter get excluded response status codes as ints getexcludedresponsestatuscodesasints assert equals assertequals excluded response status codes excludedresponsestatuscodes length assert equals assertequals excluded response status codes excludedresponsestatuscodes assert equals assertequals excluded response status codes excludedresponsestatuscodes verify configuration expires configuration expiresconfiguration expires configuration expiresconfiguration expires filter expiresfilter get default expires configuration getdefaultexpiresconfiguration assert equals assertequals starting point startingpoint access time expires configuration expiresconfiguration get starting point getstartingpoint assert equals assertequals expires configuration expiresconfiguration get durations getdurations size assert equals assertequals duration unit durationunit month expires configuration expiresconfiguration get durations getdurations get unit getunit assert equals assertequals expires configuration expiresconfiguration get durations getdurations get amount getamount verify text html expires configuration expiresconfiguration expires configuration expiresconfiguration expires filter expiresfilter get expires configuration by content type getexpiresconfigurationbycontenttype text html assert equals assertequals starting point startingpoint access time expires configuration expiresconfiguration get starting point getstartingpoint assert equals assertequals expires configuration expiresconfiguration get durations getdurations size duration one month onemonth expires configuration expiresconfiguration get durations getdurations assert equals assertequals duration unit durationunit month one month onemonth get unit getunit assert equals assertequals one month onemonth get amount getamount duration fifteen days fifteendays expires configuration expiresconfiguration get durations getdurations assert equals assertequals duration unit durationunit day fifteen days fifteendays get unit getunit assert equals assertequals fifteen days fifteendays get amount getamount duration two h ours twohours expires configuration expiresconfiguration get durations getdurations assert equals assertequals duration unit durationunit hour two h ours twohours get unit getunit assert equals assertequals two h ours twohours get amount getamount verify image gif expires configuration expiresconfiguration expires configuration expiresconfiguration expires filter expiresfilter get expires configuration by content type getexpiresconfigurationbycontenttype image gif assert equals assertequals starting point startingpoint modification time expires configuration expiresconfiguration get starting point getstartingpoint assert equals assertequals expires configuration expiresconfiguration get durations getdurations size duration five h ours fivehours expires configuration expiresconfiguration get durations getdurations assert equals assertequals duration unit durationunit hour five h ours fivehours get unit getunit assert equals assertequals five h ours fivehours get amount getamount duration three min utes threeminutes expires configuration expiresconfiguration get durations getdurations assert equals assertequals duration unit durationunit minute three min utes threeminutes get unit getunit assert equals assertequals three min utes threeminutes get amount getamount verify image jpg expires configuration expiresconfiguration expires configuration expiresconfiguration expires filter expiresfilter get expires configuration by content type getexpiresconfigurationbycontenttype image jpg assert equals assertequals starting point startingpoint access time expires configuration expiresconfiguration get starting point getstartingpoint assert equals assertequals expires configuration expiresconfiguration get durations getdurations size duration ten thousand seconds tenthousandseconds expires configuration expiresconfiguration get durations getdurations assert equals assertequals duration unit durationunit ten thousand seconds tenthousandseconds get unit getunit assert equals assertequals ten thousand seconds tenthousandseconds get amount getamount verify video mpeg expires configuration expiresconfiguration expires configuration expiresconfiguration expires filter expiresfilter get expires configuration by content type getexpiresconfigurationbycontenttype video mpeg assert equals assertequals starting point startingpoint modification time expires configuration expiresconfiguration get starting point getstartingpoint assert equals assertequals expires configuration expiresconfiguration get durations getdurations size duration twenty thousand seconds twentythousandseconds expires configuration expiresconfiguration get durations getdurations assert equals assertequals duration unit durationunit twenty thousand seconds twentythousandseconds get unit getunit assert equals assertequals twenty thousand seconds twentythousandseconds get amount getamount tomcat test resource empty content processed test test empty content testemptycontent exception http servlet httpservlet servlet http servlet httpservlet serialversionuid override service http servlet request httpservletrequest request http servlet response httpservletresponse response servlet exception servletexception io exception ioexception response set content type setcontenttype text plain content written response validate servlet integer value of valueof test test parse expires configuration combined duration testparseexpiresconfigurationcombinedduration expires filter expiresfilter expires filter expiresfilter expires filter expiresfilter expires configuration expiresconfiguration actual configuration actualconfiguration expires filter expiresfilter parse expires configuration parseexpiresconfiguration access month days hours assert equals assertequals starting point startingpoint access time actual configuration actualconfiguration get starting point getstartingpoint assert equals assertequals actual configuration actualconfiguration get durations getdurations size test test parse expires configuration mono duration testparseexpiresconfigurationmonoduration expires filter expiresfilter expires filter expiresfilter expires filter expiresfilter expires configuration expiresconfiguration actual configuration actualconfiguration expires filter expiresfilter parse expires configuration parseexpiresconfiguration access hours assert equals assertequals starting point startingpoint access time actual configuration actualconfiguration get starting point getstartingpoint assert equals assertequals actual configuration actualconfiguration get durations getdurations size assert equals assertequals actual configuration actualconfiguration get durations getdurations get amount getamount assert equals assertequals duration unit durationunit hour actual configuration actualconfiguration get durations getdurations get unit getunit test test skip because cache control max age is defined testskipbecausecachecontrolmaxageisdefined exception http servlet httpservlet servlet http servlet httpservlet serialversionuid override service http servlet request httpservletrequest request http servlet response httpservletresponse response servlet exception servletexception io exception ioexception response set content type setcontenttype text xml charset utf response add header addheader cache control max age response get writer getwriter print validate servlet integer value of valueof test test excluded response status code testexcludedresponsestatuscode exception http servlet httpservlet servlet http servlet httpservlet serialversionuid override service http servlet request httpservletrequest request http servlet response httpservletresponse response servlet exception servletexception io exception ioexception response set status setstatus http servlet response httpservletresponse modified response add header addheader e tag etag response add date header adddateheader system current time millis currenttimemillis validate servlet http servlet response httpservletresponse modified test test null content type testnullcontenttype exception http servlet httpservlet servlet http servlet httpservlet serialversionuid override service http servlet request httpservletrequest request http servlet response httpservletresponse response servlet exception servletexception io exception ioexception response set content type setcontenttype validate servlet integer value of valueof test test skip because expires is defined testskipbecauseexpiresisdefined exception http servlet httpservlet servlet http servlet httpservlet serialversionuid override service http servlet request httpservletrequest request http servlet response httpservletresponse response servlet exception servletexception io exception ioexception response set content type setcontenttype text xml charset utf response add date header adddateheader expires system current time millis currenttimemillis response get writer getwriter print validate servlet test test use content type expires configuration testusecontenttypeexpiresconfiguration exception http servlet httpservlet servlet http servlet httpservlet serialversionuid override service http servlet request httpservletrequest request http servlet response httpservletresponse response servlet exception servletexception io exception ioexception response set content type setcontenttype text xml charset utf response get writer getwriter print validate servlet integer value of valueof test test use content type without charset expires configuration testusecontenttypewithoutcharsetexpiresconfiguration exception http servlet httpservlet servlet http servlet httpservlet serialversionuid override service http servlet request httpservletrequest request http servlet response httpservletresponse response servlet exception servletexception io exception ioexception response set content type setcontenttype text xml charset iso response get writer getwriter print validate servlet integer value of valueof test test use default configuration testusedefaultconfiguration exception http servlet httpservlet servlet http servlet httpservlet serialversionuid override service http servlet request httpservletrequest request http servlet response httpservletresponse response servlet exception servletexception io exception ioexception response set content type setcontenttype image jpeg response get writer getwriter print validate servlet integer value of valueof test test use default configuration testusedefaultconfiguration exception http servlet httpservlet servlet http servlet httpservlet serialversionuid override service http servlet request httpservletrequest request http servlet response httpservletresponse response servlet exception servletexception io exception ioexception response set content type setcontenttype image jpeg response add header addheader cache control response get writer getwriter print validate servlet integer value of valueof test test use major type expires configuration testusemajortypeexpiresconfiguration exception http servlet httpservlet servlet http servlet httpservlet serialversionuid override service http servlet request httpservletrequest request http servlet response httpservletresponse response servlet exception servletexception io exception ioexception response set content type setcontenttype text json charset iso response get writer getwriter print validate servlet integer value of valueof validate http servlet httpservlet servlet integer expected max age in seconds expectedmaxageinseconds exception validate servlet expected max age in seconds expectedmaxageinseconds httpurlconnection http validate http servlet httpservlet servlet integer expected max age in seconds expectedmaxageinseconds expected response status code expectedresponsestatuscode exception set up setup tomcat tomcat get tomcat instance gettomcatinstance context root tomcat add context addcontext temp dir filter def filterdef filter def filterdef filter def filterdef filter def filterdef add init parameter addinitparameter expires default expiresdefault access minute filter def filterdef add init parameter addinitparameter expires by type expiresbytype text xml charset utf access minutes filter def filterdef add init parameter addinitparameter expires by type expiresbytype text xml access minutes filter def filterdef add init parameter addinitparameter expires by type expiresbytype text access minutes filter def filterdef add init parameter addinitparameter expires excluded response status codes expiresexcludedresponsestatuscodes filter def filterdef set filter class setfilterclass expires filter expiresfilter get name getname filter def filterdef set filter name setfiltername expires filter expiresfilter get name getname root add filter def addfilterdef filter def filterdef filter map filtermap filter map filtermap filter map filtermap filter map filtermap set filter name setfiltername expires filter expiresfilter get name getname filter map filtermap addurlpattern root add filter map addfiltermap filter map filtermap tomcat add servlet addservlet root servlet get class getclass get name getname servlet root add servlet mapping addservletmapping test servlet get class getclass get name getname tomcat start calendar get instance getinstance time zone timezone get time zone gettimezone gmt time before in millis timebeforeinmillis system current time millis currenttimemillis test httpurlconnection httpurlconnection httpurlconnection url http localhost tomcat get connector getconnector get local port getlocalport test open connection openconnection validate assert equals assertequals expected response status code expectedresponsestatuscode httpurlconnection get response code getresponsecode string builder stringbuilder msg string builder stringbuilder entry string list string field httpurlconnection get header fields getheaderfields entry set entryset string field get value getvalue msg append field get key getkey field get key getkey system println msg integer actual max age in seconds actualmaxageinseconds string cache control header cachecontrolheader httpurlconnection get header field getheaderfield cache control cache control header cachecontrolheader actual max age in seconds actualmaxageinseconds actual max age in seconds actualmaxageinseconds string tokenizer stringtokenizer cache control tokenizer cachecontroltokenizer string tokenizer stringtokenizer cache control header cachecontrolheader cache control tokenizer cachecontroltokenizer has more tokens hasmoretokens actual max age in seconds actualmaxageinseconds string cache directive cachedirective cache control tokenizer cachecontroltokenizer next token nexttoken string tokenizer stringtokenizer cache directive tokenizer cachedirectivetokenizer string tokenizer stringtokenizer cache directive cachedirective cache directive tokenizer cachedirectivetokenizer count tokens counttokens string key cache directive tokenizer cachedirectivetokenizer next token nexttoken trim string cache directive tokenizer cachedirectivetokenizer next token nexttoken trim key equals ignore case equalsignorecase max age actual max age in seconds actualmaxageinseconds integer value of valueof expected max age in seconds expectedmaxageinseconds assert null assertnull actual max age in seconds actualmaxageinseconds actual max age in seconds actualmaxageinseconds actual max age in seconds actualmaxageinseconds assert not null assertnotnull actual max age in seconds actualmaxageinseconds delta in seconds deltainseconds math abs actual max age in seconds actualmaxageinseconds int value intvalue expected max age in seconds expectedmaxageinseconds int value intvalue assert true asserttrue actual max age in seconds actualmaxageinseconds actual max age in seconds actualmaxageinseconds expected max age in seconds expectedmaxageinseconds expected max age in seconds expectedmaxageinseconds request time time before in millis timebeforeinmillis content type httpurlconnection get content type getcontenttype delta in seconds deltainseconds tomcat test test ints to comma delimited string testintstocommadelimitedstring string actual expires filter expiresfilter ints to comma delimited string intstocommadelimitedstring string expected assert equals assertequals expected actual