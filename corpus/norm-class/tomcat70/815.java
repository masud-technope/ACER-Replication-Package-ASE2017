licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina startup java buffered reader bufferedreader java file not found exception filenotfoundexception java io exception ioexception java input stream inputstream java input stream reader inputstreamreader java net url java nio charset charset java util array list arraylist java util collections java util enumeration java util iterator java util linked hash set linkedhashset java util list java util regex pattern javax servlet servlet context servletcontext org apache catalina context org apache tomcat util buf uri util uriutil variation java jar service loader serviceloader resp ects respects exclusion rules web applications intended loading servlet container initializers servletcontainerinitializers defined servlet implementation attempt lazy loading container required intro spec t introspect implementations discovered servlet context servletcontext defines ordered libs jar s jars web inf lib named included search provider configuration files ordered libs defined jar s jars searched provider configuration files providers defined resources parent class loader classloader returned provider classes loaded context class loader classloader javax servlet servlet container initializer servletcontainerinitializer java util service loader serviceloader webapp service loader webappserviceloader string lib web inf lib string services meta inf services charset utf charset for name forname utf context context servlet context servletcontext servlet context servletcontext pattern container sci filter pattern containerscifilterpattern construct loader load services servlet context servletcontext param context context webapp service loader webappserviceloader context context context context servlet context servletcontext context get servlet context getservletcontext string container sci filter containerscifilter context get container sci filter getcontainerscifilter container sci filter containerscifilter container sci filter containerscifilter length container sci filter pattern containerscifilterpattern pattern compile container sci filter containerscifilter container sci filter pattern containerscifilterpattern load providers service type param service type servicetype type service load unmodifiable collection service providers io exception ioexception problem loading service list load service type servicetype io exception ioexception string config file configfile services service type servicetype get name getname linked hash set linkedhashset string application services found applicationservicesfound linked hash set linkedhashset string linked hash set linkedhashset string container services found containerservicesfound linked hash set linkedhashset string class loader classloader loader servlet context servletcontext get class loader getclassloader servlet context servletcontext ordered libs jar s jars web inf lib loading services suppress warnings suppresswarnings unchecked list string ordered libs orderedlibs list string servlet context servletcontext get attribute getattribute servlet context servletcontext ordered libs ordered libs orderedlibs handle ordered libs string lib ordered libs orderedlibs url jar url jarurl servlet context servletcontext get resource getresource lib lib jar url jarurl happen ignore string base jar url jarurl to external form toexternalform url url base ends with endswith url url base config file configfile url uri util uriutil build jar url buildjarurl base config file configfile parse config file parseconfigfile application services found applicationservicesfound url file not found exception filenotfoundexception parent class loader classloader loader context get parent class loader getparentclassloader enumeration url resources loader resources class loader classloader get system resources getsystemresources config file configfile resources loader get resources getresources config file configfile resources has more elements hasmoreelements parse config file parseconfigfile container services found containerservicesfound resources next element nextelement filter discovered container sci s scis required container sci filter pattern containerscifilterpattern iterator string iter container services found containerservicesfound iterator iter has next hasnext container sci filter pattern containerscifilterpattern matcher iter find iter remove add application services container services ensure container services loaded container services found containerservicesfound add all addall application services found applicationservicesfound load discovered services container services found containerservicesfound is empty isempty collections empty list emptylist load services loadservices service type servicetype container services found containerservicesfound parse config file parseconfigfile linked hash set linkedhashset string services found servicesfound url url io exception ioexception input stream inputstream buffered reader bufferedreader reader url open stream openstream input stream reader inputstreamreader input stream reader inputstreamreader utf reader buffered reader bufferedreader string reader read line readline index of indexof substring trim length services found servicesfound add reader reader close close list load services loadservices service type servicetype linked hash set linkedhashset string services found servicesfound io exception ioexception class loader classloader loader servlet context servletcontext get class loader getclassloader list services array list arraylist services found servicesfound size string service class serviceclass services found servicesfound clazz for name forname service class serviceclass loader services add service type servicetype clazz new instance newinstance class not found exception classnotfoundexception io exception ioexception instantiation exception instantiationexception io exception ioexception illegal access exception illegalaccessexception io exception ioexception class cast exception classcastexception io exception ioexception collections unmodifiable list unmodifiablelist services