licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina core java buffered reader bufferedreader java io exception ioexception java input stream reader inputstreamreader java output stream writer outputstreamwriter java print writer printwriter java writer java net socket java util arrays java util collection javax servlet multipart config element multipartconfigelement javax servlet servlet exception servletexception javax servlet annotation multipart config multipartconfig javax servlet http http servlet httpservlet javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse javax servlet http org junit assert null assertnull org junit assert true asserttrue org junit org junit test org apache catalina context org apache catalina wrapper org apache catalina startup simple http client simplehttpclient org apache catalina startup tomcat org apache catalina startup tomcat base test tomcatbasetest org apache juli logging log org apache juli logging log factory logfactory test swallow aborted uploads testswallowaborteduploads tomcat base test tomcatbasetest log log log factory logfactory get log getlog test swallow aborted uploads testswallowaborteduploads test size limited uploads correctly handle connection draining exception do aborted upload test doaborteduploadtest aborted upload client aborteduploadclient client limited swallow exception client do request dorequest limited swallow log is debug enabled isdebugenabled log debug response client get response line getresponseline log debug response headers client get response headers getresponseheaders log debug response body client get response body getresponsebody log debug exception client test aborted post correctly handle connection draining exception doabortedposttest abortedpostclient client status swallow exception client do request dorequest status swallow log is debug enabled isdebugenabled log debug response client get response line getresponseline log debug response headers client get response headers getresponseheaders log debug response body client get response body getresponsebody log info exception client test test aborted upload unlimited swallow testaborteduploadunlimitedswallow log info unlimited swallow enabled aborted upload client aborteduploadclient client aborted upload client aborteduploadclient exception do aborted upload test doaborteduploadtest client assert null assertnull unlimited upload swallow enabled generates client exception assert true asserttrue unlimited upload swallow enabled returns error status code client is response isresponse client reset test test aborted upload unlimited no swallow testaborteduploadunlimitednoswallow log info unlimited swallow disabled aborted upload client aborteduploadclient client aborted upload client aborteduploadclient exception do aborted upload test doaborteduploadtest client assert null assertnull unlimited upload swallow disabled generates client exception assert true asserttrue unlimited upload swallow disabled returns error status code client is response isresponse client reset test test aborted upload limited swallow testaborteduploadlimitedswallow log info limited swallow enabled aborted upload client aborteduploadclient client aborted upload client aborteduploadclient exception do aborted upload test doaborteduploadtest client assert null assertnull limited upload swallow enabled generates client exception assert true asserttrue limited upload swallow enabled returns status code client is response isresponse client reset test test aborted upload limited no swallow testaborteduploadlimitednoswallow log info limited swallow disabled aborted upload client aborteduploadclient client aborted upload client aborteduploadclient exception do aborted upload test doaborteduploadtest client assert true asserttrue limited upload swallow disabled generate client exception java net socket exception socketexception client reset test testabortedpostokswallow log info aborted swallow enabled abortedpostclient client abortedpostclient exception doabortedposttest client http servlet response httpservletresponse assert null assertnull unlimited upload swallow enabled generates client exception assert true asserttrue unlimited upload swallow enabled returns error status code client is response isresponse client reset test testabortedpostoknoswallow log info aborted swallow disabled abortedpostclient client abortedpostclient exception doabortedposttest client http servlet response httpservletresponse assert null assertnull unlimited upload swallow disabled generates client exception assert true asserttrue unlimited upload swallow disabled returns error status code client is response isresponse client reset test testabortedpost swallow log info aborted swallow enabled abortedpostclient client abortedpostclient exception doabortedposttest client http servlet response httpservletresponse request entity large assert null assertnull limited upload swallow enabled generates client exception assert true asserttrue limited upload swallow enabled returns error status code client is response isresponse client reset test testabortedpost no swallow noswallow log info aborted swallow disabled abortedpostclient client abortedpostclient exception doabortedposttest client http servlet response httpservletresponse request entity large assert true asserttrue limited upload swallow disabled generate client exception java net socket exception socketexception client reset multipart config multipartconfig aborted upload servlet aborteduploadservlet http servlet httpservlet serialversionuid override do post dopost http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception print writer printwriter resp get writer getwriter resp set content type setcontenttype text plain resp set character encoding setcharacterencoding utf string builder stringbuilder string builder stringbuilder collection req get parts getparts log debug count append count log debug count size append count size log debug get name getname size get size getsize append get name getname size get size getsize illegal state exception illegalstateexception log debug illegal state exception illegalstateexception get parts getparts append illegal state exception illegalstateexception get parts getparts resp set status setstatus throwable log error exception get parts getparts append resp set status setstatus print to string tostring resp flush buffer flushbuffer test connection draining upload large aborted upload client aborteduploadclient simple http client simplehttpclient string uri upload aborted uploadaborted string servlet name servletname upload aborted uploadaborted limit size limitsize huge size hugesize init context context init limited swallow exception init tomcat tomcat get tomcat instance gettomcatinstance context tomcat add context addcontext temp dir wrapper tomcat add servlet addservlet context servlet name servletname aborted upload servlet aborteduploadservlet choose upload file size limit limited set multipart config element setmultipartconfigelement multipart config element multipartconfigelement limit size limitsize set multipart config element setmultipartconfigelement multipart config element multipartconfigelement context add servlet mapping addservletmapping uri servlet name servletname context set swallow aborted uploads setswallowaborteduploads swallow tomcat start set port setport tomcat get connector getconnector get local port getlocalport init exception do request dorequest limited swallow body huge size hugesize arrays fill body init limited swallow open connection connect send request body method string request string boundary simple boundary simpleboundary string builder stringbuilder string builder stringbuilder append append boundary append crlf append content disposition form data append crlf append crlf append body append crlf append append boundary append append crlf encode content bytes characters string content string to string tostring get bytes getbytes utf ascii request string post http localhost get port getport uri http crlf host localhost crlf connection close crlf content type multipart form data boundary boundary crlf content length content length crlf crlf content crlf set request setrequest request blocks response read process request processrequest close connection disconnect exception override is response body k isresponsebodyok don care abortedpostservlet http servlet httpservlet serialversionuid status set status setstatus status status status override do post dopost http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception resp set content type setcontenttype text plain resp set character encoding setcharacterencoding utf resp set status setstatus status print writer printwriter resp get writer getwriter print resp flush buffer flushbuffer test connection draining upload large abortedpostclient simple http client simplehttpclient string uri upload aborted uploadaborted string servlet name servletname upload aborted uploadaborted huge size hugesize init context context init status swallow exception init tomcat tomcat get tomcat instance gettomcatinstance context tomcat add context addcontext temp dir abortedpostservlet servlet abortedpostservlet servlet set status setstatus status tomcat add servlet addservlet context servlet name servletname servlet context add servlet mapping addservletmapping uri servlet name servletname context set swallow aborted uploads setswallowaborteduploads swallow tomcat start set port setport tomcat get connector getconnector get local port getlocalport init exception do request dorequest status swallow body huge size hugesize arrays fill body init status swallow open connection connect send request body method string request string content string body request string post http localhost get port getport uri http crlf host localhost crlf connection close crlf content length content length crlf crlf content crlf set request setrequest request blocks response read process request processrequest close connection disconnect exception override is response body k isresponsebodyok don care test testchunkedputlimit exception do test chunked t dotestchunkedput test testchunkedputnolimit exception do test chunked t dotestchunkedput do test chunked t dotestchunkedput limit exception tomcat tomcat get tomcat instance gettomcatinstance tomcat add context addcontext temp dir limit tomcat get connector getconnector set attribute setattribute max swallow size maxswallowsize tomcat start exception write ex writeex exception read ex readex string response line responseline socket conn conn socket localhost get port getport writer writer output stream writer outputstreamwriter conn get output stream getoutputstream ascii writer write exist http writer write host writer write transfer encoding chunked writer write request fully written write write writer write writer write abc def abcdef exception write ex writeex buffered reader bufferedreader reader buffered reader bufferedreader input stream reader inputstreamreader conn get input stream getinputstream ascii response line responseline reader read line readline io exception ioexception read ex readex conn conn close limit assert not null assertnotnull write ex writeex assert null assertnull write ex writeex assert null assertnull read ex readex assert not null assertnotnull response line responseline assert true asserttrue response line responseline