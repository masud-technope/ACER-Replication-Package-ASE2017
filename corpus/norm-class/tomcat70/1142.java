licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache coyote http java byte array output stream bytearrayoutputstream java util zip gzip output stream gzipoutputstream org junit assert true asserttrue org junit test org apache coyote response org apache coyote http filters gzip output filter gzipoutputfilter org apache tomcat util buf byte chunk bytechunk test demonstrate int eraction interaction gzip flushing output filter test gzip output filter testgzipoutputfilter test int eraction interaction betwen gzip flushing idea create internal output buffer response attach active gzipoutputfilter output buffer output stream internal buffer byte array output stream bytearrayoutputstream inspect output bytes write chunk gzipoutputfilter invoke flush internal output buffer internaloutputbuffer read byte array output stream bytearrayoutputstream find written flushed find expected wrting gzip output stream gzipoutputstream close force flushing compare size arrays close shorter exception test test flushing with gzip testflushingwithgzip exception response internal output buffer internaloutputbuffer byte array output stream bytearrayoutputstream response res response internal output buffer internaloutputbuffer iob internal output buffer internaloutputbuffer res byte array output stream bytearrayoutputstream bos byte array output stream bytearrayoutputstream iob output stream outputstream bos res set output buffer setoutputbuffer iob gzip output filter gzipoutputfilter attach internal output buffer internaloutputbuffer gzip output filter gzipoutputfilter gzip output filter gzipoutputfilter iob add filter addfilter iob add active filter addactivefilter write chunk byte chunk bytechunk chunk byte chunk bytechunk tomcat dev elopers developers bug jdk get bytes getbytes chunk append length iob do write dowrite chunk res flush internal output buffer internaloutputbuffer iob flush read byte array output stream bytearrayoutputstream find written flushed data found datafound bos to byte array tobytearray find expected wrting gzip output stream gzipoutputstream close force flushing byte array output stream bytearrayoutputstream gbos byte array output stream bytearrayoutputstream gzip output stream gzipoutputstream gos gzip output stream gzipoutputstream gbos gos write gos close read expected data data expected dataexpected gbos to byte array tobytearray data flushed assert true asserttrue data found datafound length data expected dataexpected length