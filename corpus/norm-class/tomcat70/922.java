licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina servlets java buffered output stream bufferedoutputstream java buffered reader bufferedreader java file java file output stream fileoutputstream java i o exception ioexception java input stream inputstream java input stream reader inputstreamreader java output stream outputstream java unsupported encoding exception unsupportedencodingexception java net url decoder urldecoder java util array list arraylist java util java util enumeration java util hashtable java util list java util locale java util map entry java util string tokenizer stringtokenizer java util vector java util regex pattern javax servlet request dispatcher requestdispatcher javax servlet servlet config servletconfig javax servlet servlet context servletcontext javax servlet servlet exception servletexception javax servlet servlet output stream servletoutputstream javax servlet http cookie javax servlet http http servlet httpservlet javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse javax servlet http http session httpsession org apache catalina util i o tools iotools org apache juli logging log org apache juli logging log factory logfactory org apache tomcat util res string manager stringmanager cgi invoking servlet web applications execute scripts comply common gate way gateway cgi specification named path info invoke servlet note code comp iles compiles works simple cgi cases exhaustive testing beta quality feedback app rec iated appreciated author instance servlet mapped code web app web inf web xml code code web app cgi bin code request code http localhost web app cgi bin dir script path info pathinfo code result execution script code web app root web inf cgi dir script code script code path info code code path info pathinfo code recommendation house cgi scripts code webapp web inf cgi code ensure accidentally expose cgi scripts code cgis cleanly ensconced web inf content area cgi location mentioned flexibility cgi s cgis cgi search path start web app root dir webapprootdir file separator cgi path prefix cgipathprefix web app root dir webapprootdir cgi path prefix cgipathprefix cgi path prefix cgipathprefix defined setting servlet cgi path prefix cgipathprefix init parameter cgi specification derived href http cgi spec golux http cgi spec golux work progress amp expired int ernet internet draft note actual rfc describing cgi specification exists behavior servlet differs specification cited doc umented documented bug instance specification cited differs community practice bcp instances doc umented documented email href http tomcat apache org lists html tomcat group amendments canonical metavariables cgi specification defines canonical metavariables exc erpt excerpt cgi specification pre type content length content type gateway path info path translated query string remote addr remote host remote ident remote user request method script server server port server protocol server software pre meta variables metavariables names protocol http accept canonical description request header fields number meaning fields change independently specification cgi specification exc erpt excerpt implementation notes standard input handling script accepts standard input client start sending input timeout period servlet assume input coming carry running script script standard input closed handling input client undefined behavior undesirable servlet enhanced handle thr eading threading s pawned spawned process stdin stdout stderr hard find cgi scripts timing receiving input init parameter code stderr timeout stderrtimeout code web apps webapps cgi handling servlet meta variable metavariable values cgi specification implementations choose represent missing values implementation specific manner define manner implementation chooses define required metavariables metavariables undefined path translated sole exception rule cgi specification nph parsed header implementation implementation support cgi nph concept server ensures data supplied script precisely supplied client unaltered server function servlet container including tomcat designed parse alter cgi specific variables nph functionality diff icu lt difficult support cgi specification comp liant compliant servers support nph output servers support nph output unconditionally comp liant compliant implementation main tains maintains unconditional compliance specification nph support cgi specification located href http cgi spec golux http cgi spec golux todo support setting headers location headers don work support coll apsing collapsing multiple header lines rfc ensure handling post method int erfere interfere filters refactor debug code core ensure header handling preserves encoding rewrite cgi runner cgirunner ref actor refactor cgi runner cgirunner cgi environment cgienvironment classes document handling cgi stdin stdin revisit i o exception ioexception handling cgi runner cgirunner documentation confirm servlet input stream servletinputstream cgi runner cgirunner needed add todo list author martin dengler root martindengler author amy roh cgi servlet cgiservlet http servlet httpservlet log log log factory logfactory get log getlog cgi servlet cgiservlet string manager stringmanager string manager stringmanager get manager getmanager cgi servlet cgiservlet string sep system get property getproperty separator vars copied craig mc clanahan mcclanahan invoke r servlet invokerservlet serialversionuid cgi search path start web app root dir webapprootdir file separator cgi path prefix cgipathprefix web app root dir webapprootdir cgi path prefix cgipathprefix string cgi path prefix cgipathprefix executable script string cgi executable cgiexecutable per l perl additional arguments executable list string cgi executable args cgiexecutableargs encoding parameters string parameter encoding parameterencoding system get property getproperty file encoding utf time milliseconds wait reading stderr complete terminating cgi process stderr timeout stderrtimeout regular expression select http headers passed cgi process environment variables environment variable http header converter upper prefixed code http code code code characters converted code code pattern env http headers pattern envhttpheaderspattern pattern compile accept cache control cookie host ref erer referer user agent object ensure multiple threads don expand file object expand file lock expandfilelock object shell environment variables passed cgi script hashtable string string shell env shellenv hashtable string string sets instance variables modified craig mc clanahan mcclanahan invoke r servlet invokerservlet param config code servlet config servletconfig code object servlet configuration initialization parameters exception servlet exception servletexception exception occurred int erferes interferes servlet normal operation override init servlet config servletconfig config servlet exception servletexception init config properties initialization parameters cgi path prefix cgipathprefix get servlet config getservletconfig get init parameter getinitparameter cgi path prefix cgipathprefix pass shell environment passshellenvironment parse boolean parseboolean get servlet config getservletconfig get init parameter getinitparameter pass shell environment passshellenvironment pass shell environment passshellenvironment shell env shellenv put all putall system get env getenv get servlet config getservletconfig get init parameter getinitparameter executable cgi executable cgiexecutable get servlet config getservletconfig get init parameter getinitparameter executable get servlet config getservletconfig get init parameter getinitparameter executable arg list string args array list arraylist string string arg get servlet config getservletconfig get init parameter getinitparameter executable arg arg args add arg cgi executable args cgiexecutableargs args get servlet config getservletconfig get init parameter getinitparameter parameter encoding parameterencoding parameter encoding parameterencoding get servlet config getservletconfig get init parameter getinitparameter parameter encoding parameterencoding get servlet config getservletconfig get init parameter getinitparameter stderr timeout stderrtimeout stderr timeout stderrtimeout parse long parselong get servlet config getservletconfig get init parameter getinitparameter stderr timeout stderrtimeout get servlet config getservletconfig get init parameter getinitparameter env http headers envhttpheaders env http headers pattern envhttpheaderspattern pattern compile get servlet config getservletconfig get init parameter getinitparameter env http headers envhttpheaders logs servlet api container copied snoop all servlet snoopallservlet craig mc clanahan mcclanahan param unused param req http servlet request httpservletrequest object source param res unused exception i o exception ioexception write operation exception occurs deprecated link print servlet environment printservletenvironment http servlet request httpservletrequest removed tomcat onwards deprecated print servlet environment printservletenvironment servlet output stream servletoutputstream http servlet request httpservletrequest req http servlet response httpservletresponse res i o exception ioexception print servlet environment printservletenvironment req logs servlet api container based snoop all servlet snoopallservlet craig mc clanahan mcclanahan param req http servlet request httpservletrequest object source exception i o exception ioexception write operation exception occurs print servlet environment printservletenvironment http servlet request httpservletrequest req i o exception ioexception document properties servlet request servletrequest log trace servlet request servletrequest properties enumeration string attrs req get attribute names getattributenames attrs has more elements hasmoreelements string attr attrs next element nextelement log trace request attribute attr req get attribute getattribute attr log trace character encoding req get character encoding getcharacterencoding log trace content length req get content length getcontentlength log trace content type req get content type getcontenttype enumeration locale locales req get locales getlocales locales has more elements hasmoreelements locale locale locales next element nextelement log trace locale locale enumeration string params req get parameter names getparameternames params has more elements hasmoreelements string param params next element nextelement string req get parameter values getparametervalues param log trace request parameter param log trace protocol req get protocol getprotocol log trace remote address req get remote addr getremoteaddr log trace remote host req get remote host getremotehost log trace scheme req get scheme getscheme log trace secure req is secure issecure log trace server req get server name getservername log trace server port req get server port getserverport document properties http servlet request httpservletrequest log trace http servlet request httpservletrequest properties log trace type req get auth type getauthtype log trace context path req get context path getcontextpath cookie cookies req get cookies getcookies cookies cookie cookie cookies log trace cookie cookie get name getname cookie get value getvalue enumeration string headers req get header names getheadernames headers has more elements hasmoreelements string header headers next element nextelement log trace http header header req get header getheader header log trace method req get method getmethod log trace path info req get path info getpathinfo log trace path translated req get path translated getpathtranslated log trace query string req get query string getquerystring log trace remote user req get remote user getremoteuser log trace requested session req get requested session id getrequestedsessionid log trace requested session cookie req is requested session id from cookie isrequestedsessionidfromcookie log trace requested session url req is requested session id from l isrequestedsessionidfromurl log trace requested session valid req is requested session id valid isrequestedsessionidvalid log trace request uri req getrequesturi log trace servlet path req get servlet path getservletpath log trace user principal req get user principal getuserprincipal process current session http session httpsession session req get session getsession session document session properties log trace http session httpsession properties log trace session get id getid log trace creation time session get creation time getcreationtime log trace accessed time session get last accessed time getlastaccessedtime log trace max inactive interval session get max inactive interval getmaxinactiveinterval document session attributes attrs session get attribute names getattributenames attrs has more elements hasmoreelements string attr attrs next element nextelement log trace session attribute attr session get attribute getattribute attr document servlet configuration properties log trace servlet config servletconfig properties log trace servlet get servlet config getservletconfig get servlet name getservletname document servlet configuration initialization parameters params get servlet config getservletconfig get init parameter names getinitparameternames params has more elements hasmoreelements string param params next element nextelement string get servlet config getservletconfig get init parameter getinitparameter param log trace servlet init param param document servlet context properties log trace servlet context servletcontext properties log trace major version get servlet context getservletcontext get major version getmajorversion log trace minor version get servlet context getservletcontext get minor version getminorversion log trace real path get servlet context getservletcontext get real path getrealpath log trace server info get servlet context getservletcontext get server info getserverinfo document servlet context initialization parameters log trace servlet context servletcontext initialization parameters params get servlet context getservletcontext get init parameter names getinitparameternames params has more elements hasmoreelements string param params next element nextelement string get servlet context getservletcontext get init parameter getinitparameter param log trace servlet context init param param document servlet context attributes log trace servlet context servletcontext attributes attrs get servlet context getservletcontext get attribute names getattributenames attrs has more elements hasmoreelements string attr attrs next element nextelement log trace servlet context attribute attr get servlet context getservletcontext get attribute getattribute attr cgi gate way gateway service delegates link do get doget http servlet request httpservletrequest http servlet response httpservletresponse param req http servlet request httpservletrequest passed servlet container param res http servlet response httpservletresponse passed servlet container exception servlet exception servletexception servlet specific exception occurs exception i o exception ioexception read write exception occurs override do post dopost http servlet request httpservletrequest req http servlet response httpservletresponse res i o exception ioexception servlet exception servletexception do get doget req res cgi gate way gateway service param req http servlet request httpservletrequest passed servlet container param res http servlet response httpservletresponse passed servlet container exception servlet exception servletexception servlet specific exception occurs exception i o exception ioexception read write exception occurs override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse res servlet exception servletexception i o exception ioexception cgi environment cgienvironment cgi env cgienv cgi environment cgienvironment req get servlet context getservletcontext cgi env cgienv is valid isvalid cgi runner cgirunner cgi cgi runner cgirunner cgi env cgienv get command getcommand cgi env cgienv get environment getenvironment cgi env cgienv get working directory getworkingdirectory cgi env cgienv get parameters getparameters post equals req get method getmethod cgi set input setinput req get input stream getinputstream cgi set response setresponse res cgi res send error senderror log is trace enabled istraceenabled string cgi env lines cgienvlines cgi env cgienv to string tostring split sep string cgi env line cgienvline cgi env lines cgienvlines log trace cgi env line cgienvline print servlet environment printservletenvironment req behaviour depends status code status calls set status setstatus returns cgi servlet provide response body status calls send error senderror status returns standard error mechanism provide response body set status setstatus http servlet response httpservletresponse response status i o exception ioexception status http servlet response httpservletresponse bad request response send error senderror status response set status setstatus status encapsulates cgi environment rules derive environment servlet container request cgi environment cgienvironment context enclosing servlet servlet context servletcontext context context path enclosing servlet string context path contextpath servlet uri enclosing servlet string servlet path servletpath path info pathinfo current request string path info pathinfo real file system directory enclosing servlet web app string web app root dir webapprootdir temp dir tempdir context expand scripts unexpanded wars file tmp dir tmpdir derived cgi environment hashtable string string env cgi command invoked string command cgi command desired working directory file working directory workingdirectory cgi command command parameters array list arraylist string cmd line parameters cmdlineparameters array list arraylist string object valid valid creates cgi environment cgienvironment derives environment query parameters working directory cgi command param req http servlet request httpservletrequest servlet api param context servlet context servletcontext servlet api i o exception ioexception error occurred cgi environment cgienvironment http servlet request httpservletrequest req servlet context servletcontext context i o exception ioexception setup from context setupfromcontext context setup from request setupfromrequest req valid setcgienvironment req valid working directory workingdirectory file command substring command last index of lastindexof file separator working directory workingdirectory servlet context servletcontext cgi variables param context servlet context servletcontext servlet api setup from context setupfromcontext servlet context servletcontext context context context web app root dir webapprootdir context get real path getrealpath tmp dir tmpdir file context get attribute getattribute servlet context servletcontext temp dir tempdir http servlet request httpservletrequest cgi variables param req http servlet request httpservletrequest servlet api unsupported encoding exception unsupportedencodingexception unknown encoding setup from request setupfromrequest http servlet request httpservletrequest req unsupported encoding exception unsupportedencodingexception is included isincluded request include req get attribute getattribute request dispatcher requestdispatcher include request uri is included isincluded is included isincluded context path contextpath string req get attribute getattribute request dispatcher requestdispatcher include context path servlet path servletpath string req get attribute getattribute request dispatcher requestdispatcher include servlet path path info pathinfo string req get attribute getattribute request dispatcher requestdispatcher include path info context path contextpath req get context path getcontextpath servlet path servletpath req get servlet path getservletpath path info pathinfo req get path info getpathinfo path info pathinfo servlet path servletpath path info pathinfo path info pathinfo servlet path servletpath cgi command req get method getmethod equals req get method getmethod equals post req get method getmethod equals head string is included isincluded string req get attribute getattribute request dispatcher requestdispatcher include query string req get query string getquerystring index of indexof string tokenizer stringtokenizer qs tokens qstokens string tokenizer stringtokenizer qs tokens qstokens has more tokens hasmoretokens cmd line parameters cmdlineparameters add url decoder urldecoder decode qs tokens qstokens next token nexttoken parameter encoding parameterencoding resolves core cgi script uri pre servlet cgi gateway cgigateway dir realcgiscript path info pathinfo pre path catalina mywebapp dir realcgiscript script name scriptname servlet cgi gateway cgigateway dir realcgiscript cgi name cginame dir realcgiscript realcgiscript cgi search algorithm search real path webapp root find directory get path translated getpathtranslated reading searching left cgi search path start web app root dir webapprootdir file separator cgi path prefix cgipathprefix web app root dir webapprootdir cgi path prefix cgipathprefix cgi path prefix cgipathprefix defined setting servlet cgi path prefix cgipathprefix init parameter param path info pathinfo string http servlet request httpservletrequest get path info getpathinfo param web app root dir webapprootdir string context get real path getrealpath param context path contextpath string http servlet request httpservletrequest get context path getcontextpath param servlet path servletpath string http servlet request httpservletrequest get servlet path getservletpath param cgi path prefix cgipathprefix sub directory subdirectory web app root dir webapprootdir web app cgi s cgis stored cgi search path start web app root dir webapprootdir file separator cgi path prefix cgipathprefix web app root dir webapprootdir cgi path prefix cgipathprefix cgi path prefix cgipathprefix defined setting servlet cgi path prefix cgipathprefix init parameter code path code full file system path valid cgi script cgi code script name scriptname code cgi variable script full url path valid cgi script cgi code cgi name cginame code servlet path info pathinfo fragment cgi script code code simple directories cgi script cgi string findcgi string path info pathinfo string web app root dir webapprootdir string context path contextpath string servlet path servletpath string cgi path prefix cgipathprefix string path string string script name scriptname web app root dir webapprootdir web app root dir webapprootdir last index of lastindexof file separator web app root dir webapprootdir length str ip strip trailing web app root dir webapprootdir web app root dir webapprootdir web app root dir webapprootdir substring web app root dir webapprootdir length cgi path prefix cgipathprefix web app root dir webapprootdir web app root dir webapprootdir file separator cgi path prefix cgipathprefix log is debug enabled isdebugenabled log debug get string getstring cgi servlet cgiservlet find path path info pathinfo web app root dir webapprootdir file current location currentlocation file web app root dir webapprootdir string tokenizer stringtokenizer dir walker dirwalker string tokenizer stringtokenizer path info pathinfo log is debug enabled isdebugenabled log debug get string getstring cgi servlet cgiservlet find location current location currentlocation get absolute path getabsolutepath string builder stringbuilder cgi name builder cginamebuilder string builder stringbuilder current location currentlocation is file isfile dir walker dirwalker has more elements hasmoreelements string next element nextelement string dir walker dirwalker next element nextelement current location currentlocation file current location currentlocation next element nextelement cgi name builder cginamebuilder append append next element nextelement log is debug enabled isdebugenabled log debug get string getstring cgi servlet cgiservlet find location current location currentlocation get absolute path getabsolutepath string cgi name cginame cgi name builder cginamebuilder to string tostring current location currentlocation is file isfile string path current location currentlocation get absolute path getabsolutepath current location currentlocation get name getname equals context path contextpath script name scriptname servlet path servletpath script name scriptname context path contextpath servlet path servletpath servlet path servletpath equals cgi name cginame script name scriptname script name scriptname cgi name cginame log is debug enabled isdebugenabled log debug get string getstring cgi servlet cgiservlet find path script name scriptname cgi name cginame string path script name scriptname cgi name cginame constructs cgi environment supplied invoked cgi script rel ies relies heavily servlet api methods findcgi param req request cgi invocation environment problem environment i o exception ioexception error occurred setcgienvironment http servlet request httpservletrequest req i o exception ioexception method ugly est vie ugliness hope apologies marv albert hashtable string string envp hashtable string string add shell environment variables envp put all putall shell env shellenv add cgi environment variables string s path info orig spathinfoorig string s path info i spathinfocgi string s path translated i spathtranslatedcgi string scgifullpath string scgiscriptname string scgifullname string scginame string scginames s path info orig spathinfoorig path info pathinfo s path info orig spathinfoorig s path info orig spathinfoorig s path info orig spathinfoorig web app root dir webapprootdir app deployed exp loded exploded form web app root dir webapprootdir tmp dir tmpdir to string tostring expandcgiscript scginames findcgi s path info orig spathinfoorig web app root dir webapprootdir context path contextpath servlet path servletpath cgi path prefix cgipathprefix scgifullpath scginames scgiscriptname scginames scgifullname scginames scginame scginames scgifullpath scgiscriptname scgifullname scginame envp server software tomcat envp server nulls to blanks nullstoblanks req get server name getservername envp gateway cgi envp server protocol nulls to blanks nullstoblanks req get protocol getprotocol port req get server port getserverport integer i port iport port integer value of valueof integer value of valueof port envp server port i port iport to string tostring envp request method nulls to blanks nullstoblanks req get method getmethod envp request uri nulls to blanks nullstoblanks req getrequesturi path info determined scgifullname scgifullname method findcgi scgifullname equal path info pathinfo fragment corresponds actual cgi script path info request get path info getpathinfo substring scgifullname length method findcgi real work path info pathinfo path info pathinfo substring scgifullname length length s path info i spathinfocgi s path info i spathinfocgi path info pathinfo substring scgifullname length envp path info s path info i spathinfocgi path translated determined path info implied real cgi script account demonstrates servlet info servlet cgi gw cgigw dir dir cgi trans trans cgi full path cgifullpath servlet cgi gw cgigw dir dir cgi path info trans trans web app root dir webapprootdir servlet context servletcontext get real path getrealpath path translated servlet context servletcontext get real path getrealpath trans trans path translated web app root dir webapprootdir s path info i spathinfocgi s path info i spathinfocgi blank cgi specification dict ates dictates path translated meta variable metavariable defined equals s path info i spathinfocgi s path translated i spathtranslatedcgi context get real path getrealpath s path info i spathinfocgi s path translated i spathtranslatedcgi equals s path translated i spathtranslatedcgi noop envp path translated nulls to blanks nullstoblanks s path translated i spathtranslatedcgi envp script nulls to blanks nullstoblanks scgiscriptname envp query string nulls to blanks nullstoblanks req get query string getquerystring envp remote host nulls to blanks nullstoblanks req get remote host getremotehost envp remote addr nulls to blanks nullstoblanks req get remote addr getremoteaddr envp type nulls to blanks nullstoblanks req get auth type getauthtype envp remote user nulls to blanks nullstoblanks req get remote user getremoteuser full compliance envp remote ident envp content type nulls to blanks nullstoblanks req get content type getcontenttype note cgi spec content length undefined content servlet api spec content length contentlength req get content length getcontentlength string s content length scontentlength content length contentlength integer to string tostring content length contentlength envp content length s content length scontentlength enumeration string headers req get header names getheadernames string header headers has more elements hasmoreelements header header headers next element nextelement to upper case touppercase locale english remind for got forgot previous remind env http headers pattern envhttpheaderspattern matcher header matches envp http header replace req get header getheader header file fcgifullpath file scgifullpath command fcgifullpath get canonical path getcanonicalpath kicks envp tomcat script path command php envp script filename command env envp extra cts extracts requested resource web app archive context work directory enable cgi script executed expandcgiscript string builder stringbuilder src path srcpath string builder stringbuilder string builder stringbuilder dest path destpath string builder stringbuilder input stream inputstream paths depend mapping cgi path prefix cgipathprefix src path srcpath append path info pathinfo context get resource as stream getresourceasstream src path srcpath to string tostring dest path destpath append tmp dir tmpdir dest path destpath append path info pathinfo essentially search algorithm findcgi src path srcpath append cgi path prefix cgipathprefix string tokenizer stringtokenizer path walker pathwalker string tokenizer stringtokenizer path info pathinfo start element path walker pathwalker has more elements hasmoreelements src path srcpath append src path srcpath append path walker pathwalker next element nextelement context get resource as stream getresourceasstream src path srcpath to string tostring dest path destpath append tmp dir tmpdir dest path destpath append dest path destpath append src path srcpath didn find log warn get string getstring cgi servlet cgiservlet expand not found expandnotfound src path srcpath file file dest path destpath to string tostring exists close i o exception ioexception log warn get string getstring cgi servlet cgiservlet expand close fail expandclosefail src path srcpath don expand exists create directories file dir get parent file getparentfile dir mkdirs dir is directory isdirectory log warn get string getstring cgi servlet cgiservlet expand create dir fail expandcreatedirfail dir get absolute path getabsolutepath expand file lock expandfilelock file doesn exist exists create file create new file createnewfile file output stream fileoutputstream fos file output stream fileoutputstream copy data i o tools iotools flow fos close i o exception ioexception log warn get string getstring cgi servlet cgiservlet expand error expanderror fos close log is debug enabled isdebugenabled log debug get string getstring cgi servlet cgiservlet expand ok expandok src path srcpath dest path destpath i o exception ioexception ioe log warn get string getstring cgi servlet cgiservlet expand fail expandfail src path srcpath dest path destpath ioe exists delete log warn get string getstring cgi servlet cgiservlet expand delete fail expanddeletefail get absolute path getabsolutepath returns cgi environment multi text format cgi environment info override string to string tostring string builder stringbuilder string builder stringbuilder append cgi environment cgienvironment info append sep is valid isvalid append validity append sep append environment values append sep entry string string entry env entry set entryset append append entry get key getkey append append bla nks to string blankstostring entry get value getvalue blank append append sep append derived command append nulls to blanks nullstoblanks command append append sep append working directory working directory workingdirectory append working directory workingdirectory to string tostring append append sep append command params append sep string param cmd line parameters cmdlineparameters append append param append append sep append validity append sep append cgi script append sep append check http servlet request httpservletrequest path info pathinfo property append sep append meant exist ant existant executable file append sep append path info append sep to string tostring derived command string command string string get command getcommand command derived cgi working directory working directory file get working directory getworkingdirectory working directory workingdirectory derived cgi environment cgi environment hashtable string string get environment getenvironment env derived cgi query parameters cgi query parameters array list arraylist string get parameters getparameters cmd line parameters cmdlineparameters val idity validity status environment valid is valid isvalid valid converts strings blank strings param string converted string original empty string original code code string nulls to blanks nullstoblanks string nulls to string nullstostring converts strings string param could be null couldbenull string converted param sub for nulls subfornulls string string string original substitute string original code code string nulls to string nullstostring string could be null couldbenull string sub for nulls subfornulls could be null couldbenull sub for nulls subfornulls could be null couldbenull converts blank strings string param could be blank couldbeblank string converted param sub for blanks subforblanks string blank string string original substitute string original code code empty string bla nks to string blankstostring string could be blank couldbeblank string sub for blanks subforblanks equals could be blank couldbeblank could be blank couldbeblank sub for blanks subforblanks could be blank couldbeblank encapsulates know ledge knowledge cgi script script desired environment option ally optionally input output str eams streams exp oses exposes code code method invoke cgi cgi environment settings derived passed constructor input output str eams streams code set input setinput code code set response setresponse code methods cgi runner cgirunner script command executed string command environment invoking cgi script hashtable string string env working directory invoking cgi script file command parameters passed invoked script array list arraylist string params stdin passed cgi script input stream inputstream stdin response object headers output stream http servlet response httpservletresponse response tracking object info ready to run readytorun creates cgi runner cgirunner initial izes initializes environment working directory query parameters input output str eams streams optional code set input setinput code code set response setresponse code methods param command string full path command executed param env hashtable desired script environment param file script desired working directory param params array list arraylist script query command parameters strings cgi runner cgirunner string command hashtable string string env file array list arraylist string params command command env env params params update ready status updatereadystatus checks sets ready status update ready status updatereadystatus command env params response ready to run readytorun ready to run readytorun ready status ready code code exception ready is ready isready ready to run readytorun sets http servlet response httpservletresponse object headers send output param response http servlet response httpservletresponse set response setresponse http servlet response httpservletresponse response response response update ready status updatereadystatus sets standard input passed invoked cgi script param stdin input stream inputstream set input setinput input stream inputstream stdin stdin stdin update ready status updatereadystatus converts hashtable string array converting key pair hashtable string form key hash key hashkey hash hash key hashkey to string tostring param hashtable convert converted string array exception null pointer exception nullpointerexception hash key string hash to string array hashtostringarray hashtable string null pointer exception nullpointerexception vector string vector string enumeration string has more elements hasmoreelements string next element nextelement add to string tostring string str arr strarr string size copy into copyinto str arr strarr str arr strarr executes cgi script desired environment current working directory input output str eams streams cgi specification rec ommedations recommedations servers provide code query code component script uri command arguments scripts unencoded characters command arguments generated unambiguous manner servers type meta variable metavariable code scheme code token code authorization code supplied request header code getcgienvironment code method applicable servers current working directory directory script located invoking server implementations define behavior cases allowed characters path info pathinfo implementation ascii nul character url encoded int ernet internet s tandards standards allowed characters path segments implementation terminal segments path i o exceptions ioexceptions thrown code code code code path segments implementation code code code code path characters result i o exception ioexception thrown happen tomcat normal ises normalises requesturi determining context path contextpath servlet path servletpath path info pathinfo implementation limitations implementation impo s e impose limitations doc umented documented implementation limited servlet container house implementation primary cgi variable values derived indirectly container implementation servlet api methods exception i o exception ioexception problems reading writing occur java lang runtime exec string command string envp file dir i o exception ioexception is ready isready i o exception ioexception get class getclass get name getname ready log is debug enabled isdebugenabled log debug envp env command command command index of indexof file separator file separator command index of indexof file separator command index of indexof file separator i o exception ioexception get class getclass get name getname illegal character cgi command path detected running cgi command original content structure http bugs sun bug database bugdatabase view bug bug major modifications martin dengler runtime buffered reader bufferedreader cgi header reader cgiheaderreader input stream inputstream cgi output cgioutput buffered reader bufferedreader commands std err commandsstderr thread err reader thread errreaderthread buffered output stream bufferedoutputstream commands std in commandsstdin process proc buf read bufread list string cmd and args cmdandargs array list arraylist string cgi executable cgiexecutable length cmd and args cmdandargs add cgi executable cgiexecutable cgi executable args cgiexecutableargs cmd and args cmdandargs add all addall cgi executable args cgiexecutableargs cmd and args cmdandargs add command cmd and args cmdandargs add all addall params runtime get runtime getruntime proc exec cmd and args cmdandargs to array toarray string cmd and args cmdandargs size hash to string array hashtostringarray env string s content length scontentlength env content length equals s content length scontentlength commands std in commandsstdin buffered output stream bufferedoutputstream proc get output stream getoutputstream i o tools iotools flow stdin commands std in commandsstdin commands std in commandsstdin flush commands std in commandsstdin close wait process exit process wait for waitfor use less useless situation http bugs sun bug database bugdatabase view bug bug is running isrunning commands std err commandsstderr buffered reader bufferedreader input stream reader inputstreamreader proc get error stream geterrorstream buffered reader bufferedreader s td err rdr stderrrdr commands std err commandsstderr err reader thread errreaderthread thread override send to log sendtolog s td err rdr stderrrdr err reader thread errreaderthread start input stream inputstream cgi header stream cgiheaderstream http header input stream httpheaderinputstream proc get input stream getinputstream cgi header reader cgiheaderreader buffered reader bufferedreader input stream reader inputstreamreader cgi header stream cgiheaderstream careful send error senderror called response body standard error process output cgi process isn read process hang skip body skipbody is running isrunning headers string cgi header reader cgiheaderreader read line readline equals log is trace enabled istraceenabled log trace add header addheader starts with startswith http skip body skipbody set status setstatus response get from http status line getscfromhttpstatusline index of indexof string header substring index of indexof trim string substring index of indexof trim header equals ignore case equalsignorecase status skip body skipbody set status setstatus response getscfromcgistatusheader response add header addheader header log info get string getstring cgi servlet cgiservlet run bad header runbadheader write output b buf bbuf output stream outputstream response get output stream getoutputstream cgi output cgioutput proc get input stream getinputstream skip body skipbody buf read bufread cgi output cgioutput read b buf bbuf log is trace enabled istraceenabled log trace output buf read bufread bytes data write b buf bbuf buf read bufread external process hang buf read bufread buf read bufread cgi output cgioutput read b buf bbuf noop read data exception alive proc exit value exitvalue is running isrunning illegal thread state exception illegalthreadstateexception thread sleep interrupted exception interruptedexception replacement process wait for waitfor i o exception ioexception log warn get string getstring cgi servlet cgiservlet run fail runfail close header reader cgi header reader cgiheaderreader cgi header reader cgiheaderreader close i o exception ioexception ioe log warn get string getstring cgi servlet cgiservlet run header reader fail runheaderreaderfail ioe close output stream cgi output cgioutput cgi output cgioutput close i o exception ioexception ioe log warn get string getstring cgi servlet cgiservlet run output stream fail runoutputstreamfail ioe error stream reader finished err reader thread errreaderthread err reader thread errreaderthread join stderr timeout stderrtimeout interrupted exception interruptedexception log warn get string getstring cgi servlet cgiservlet run reader int erupt runreaderinterupt proc proc destroy proc parses status extra cts extracts status code param http status rfc extracted status code code representing internal error valid status code extracted get from http status line getscfromhttpstatusline string status start statusstart index of indexof status start statusstart length status start statusstart valid http status log warn get string getstring cgi servlet cgiservlet run invalid status runinvalidstatus http servlet response httpservletresponse internal server error string status substring status start statusstart status start statusstart status code statuscode status code statuscode integer parse int parseint status number format exception numberformatexception nfe log warn get string getstring cgi servlet cgiservlet run invalid status runinvalidstatus status http servlet response httpservletresponse internal server error status code statuscode parses cgi status header extra cts extracts status code param cgi status form code digit digit digit reason phrase code extracted status code code representing internal error valid status code extracted getscfromcgistatusheader string length valid status log warn get string getstring cgi servlet cgiservlet run invalid status runinvalidstatus http servlet response httpservletresponse internal server error string status substring status code statuscode status code statuscode integer parse int parseint status number format exception numberformatexception nfe log warn get string getstring cgi servlet cgiservlet run invalid status runinvalidstatus status http servlet response httpservletresponse internal server error status code statuscode send to log sendtolog buffered reader bufferedreader rdr string line count linecount rdr read line readline log warn get string getstring cgi servlet cgiservlet run std err runstderr line count linecount i o exception ioexception log warn get string getstring cgi servlet cgiservlet run std err fail runstderrfail rdr close i o exception ioexception log warn get string getstring cgi servlet cgiservlet run std err fail runstderrfail line count linecount log warn get string getstring cgi servlet cgiservlet run std err count runstderrcount integer value of valueof line count linecount input stream reading http headers reads upto including blank lines terminating headers content read bytes characters http header input stream httpheaderinputstream input stream inputstream character header input stream inputstream input http header input stream httpheaderinputstream input stream inputstream the input theinput input the input theinput character java input stream inputstream read override read i o exception ioexception header input read character header character header character http header input stream httpheaderinputstream cgi servlet cgiservlet