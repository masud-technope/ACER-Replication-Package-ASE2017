licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina valves java io exception ioexception java util enumeration java util map java util concurrent concurrent hash map concurrenthashmap java util regex pattern javax servlet servlet exception servletexception javax servlet http http session httpsession javax servlet http http session binding event httpsessionbindingevent javax servlet http http session binding listener httpsessionbindinglistener org apache catalina lifecycle exception lifecycleexception org apache catalina connector request org apache catalina connector response org apache juli logging log org apache juli logging log factory logfactory web crawlers trigger creation thousands sessions crawl site result memory consumption valve ensures crawlers single session normal users provide session token requests crawler session manager valve crawlersessionmanagervalve valve base valvebase http session binding listener httpsessionbindinglistener log log log factory logfactory get log getlog crawler session manager valve crawlersessionmanagervalve map string string client ip session id clientipsessionid concurrent hash map concurrenthashmap string string map string string session id client ip sessionidclientip concurrent hash map concurrenthashmap string string string crawler user agents crawleruseragents yahoo slurp feed fetcher feedfetcher google pattern ua pattern uapattern session inactive interval sessioninactiveinterval specifies constructor async support configured crawler session manager valve crawlersessionmanagervalve regular expression link pattern identify crawlers based user agent header google bot googlebot bin gbot bingbot yahoo slurp param crawler user agents crawleruseragents regular expression link pattern set crawler user agents setcrawleruseragents string crawler user agents crawleruseragents crawler user agents crawleruseragents crawler user agents crawleruseragents crawler user agents crawleruseragents crawler user agents crawleruseragents length ua pattern uapattern ua pattern uapattern pattern compile crawler user agents crawleruseragents set crawler user agents setcrawleruseragents string current regular expression match user age nts agents string get crawler user agents getcrawleruseragents crawler user agents crawleruseragents session timeout seconds crawler session typically user session seconds param session inactive interval sessioninactiveinterval timeout crawler sessions set session inactive interval setsessioninactiveinterval session inactive interval sessioninactiveinterval session inactive interval sessioninactiveinterval session inactive interval sessioninactiveinterval set session inactive interval setsessioninactiveinterval current timeout seconds get session inactive interval getsessioninactiveinterval session inactive interval sessioninactiveinterval map string string get client ip session id getclientipsessionid client ip session id clientipsessionid override init internal initinternal lifecycle exception lifecycleexception init internal initinternal ua pattern uapattern pattern compile crawler user agents crawleruseragents override invoke request request response response io exception ioexception servlet exception servletexception is bot isbot string session id sessionid string client ip clientip log is debug enabled isdebugenabled log debug request hash code hashcode client ip clientip request get remote addr getremoteaddr requested session id requestedsessionid request get requested session id getrequestedsessionid incoming request valid session action required request get session getsession crawler check headers enumeration string ua headers uaheaders request get headers getheaders user agent string ua header uaheader ua headers uaheaders has more elements hasmoreelements ua header uaheader ua headers uaheaders next element nextelement header assume bot ua header uaheader ua headers uaheaders has more elements hasmoreelements log is debug enabled isdebugenabled log debug request hash code hashcode user agent useragent ua header uaheader ua pattern uapattern matcher ua header uaheader matches is bot isbot log is debug enabled isdebugenabled log debug request hash code hashcode bot user agent useragent ua header uaheader bot session is bot isbot client ip clientip request get remote addr getremoteaddr session id sessionid client ip session id clientipsessionid client ip clientip session id sessionid request set requested session id setrequestedsessionid session id sessionid log is debug enabled isdebugenabled log debug request hash code hashcode sessionid session id sessionid get next getnext invoke request response is bot isbot session id sessionid bot created session not e note http session httpsession request get session getsession client ip session id clientipsessionid client ip clientip get id getid session id client ip sessionidclientip get id getid client ip clientip value unbound valueunbound called session expiration set attribute setattribute get class getclass get name getname set max inactive interval setmaxinactiveinterval session inactive interval sessioninactiveinterval log is debug enabled isdebugenabled log debug request hash code hashcode bot session sessionid get id getid log is debug enabled isdebugenabled log debug request hash code hashcode bot session accessed sessionid session id sessionid override value bound valuebound http session binding event httpsessionbindingevent event noop override value unbound valueunbound http session binding event httpsessionbindingevent event string client ip clientip session id client ip sessionidclientip remove event get session getsession get id getid client ip clientip client ip session id clientipsessionid remove client ip clientip