licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina tribes transport nio java io exception ioexception java net socket address socketaddress java nio byte buffer bytebuffer java nio channels cancelled key exception cancelledkeyexception java nio channels data gram channel datagramchannel java nio channels readable byte channel readablebytechannel java nio channels selection key selectionkey java nio channels socket channel socketchannel java nio channels writable byte channel writablebytechannel org apache catalina tribes channel message channelmessage org apache catalina tribes channel receiver channelreceiver org apache catalina tribes remote process exception remoteprocessexception org apache catalina tribes unique id uniqueid org apache catalina tribes buffer pool bufferpool org apache catalina tribes channel data channeldata org apache catalina tribes listen callback listencallback org apache catalina tribes object reader objectreader org apache catalina tribes transport abstract rx task abstractrxtask org apache catalina tribes transport constants org apache catalina tribes util logs worker thread drain channels echo input instance constructed reference owning thread pool object started thread loops waiting awakened service channel selection key selectionkey object worker tasked calling service channel servicechannel method selection key selectionkey object service channel servicechannel method stores key reference thread object calls notify wake channel drained worker thread returns parent pool author filip hanik nio replication task nioreplicationtask abstract rx task abstractrxtask org apache juli logging log log org apache juli logging log factory logfactory get log getlog nio replication task nioreplicationtask byte buffer bytebuffer buffer selection key selectionkey key rx buf size rxbufsize nio receiver nioreceiver receiver nio replication task nioreplicationtask listen callback listencallback callback nio receiver nioreceiver receiver callback receiver receiver loop waiting work override buffer size get rx buf size getrxbufsize key channel data gram channel datagramchannel size channel receiver channelreceiver max udp size get options getoptions option dir ect direct buffer option dir ect direct buffer buffer byte buffer bytebuffer all ocate direct allocatedirect size buffer byte buffer bytebuffer all ocate allocate size buffer clear key log is trace enabled istraceenabled log trace servicing key key object reader objectreader reader object reader objectreader key attachment reader log is trace enabled istraceenabled log trace object reader can celling cancelling key cancel key cancelkey key log is trace enabled istraceenabled log trace draining channel key drain channel drainchannel key reader exception cancelled key exception cancelledkeyexception io exception ioexception log is debug enabled isdebugenabled log debug io exception ioexception replication worker unable drain channel probable alive socket closed get message getmessage log warn io exception ioexception replication worker unable drain channel probable alive socket closed get message getmessage log is error enabled iserrorenabled log error exception caught tcp replication thread tcpreplicationthread drain channel drainchannel cancel key cancelkey key key ready pool get task pool gettaskpool return worker returnworker called init iate initiate unit work worker thread selection key selectionkey object method method key service d serviced time waking worker thread returning main selection loop key int erest interest updated remove read selector ignore read read iness readiness channel worker thread servicing service channel servicechannel selection key selectionkey key log is trace enabled istraceenabled log trace service key key object reader objectreader reader object reader objectreader key attachment reader reader set last access setlastaccess system current time millis currenttimemillis key key key int erest ops interestops key int erest ops interestops selection key selectionkey read key int erest ops interestops key int erest ops interestops selection key selectionkey write actual code drains channel key method assumes key modified prior invocation turn selection int erest interest read method completes enables read calls wakeup selector selector resume watching channel drain channel drainchannel selection key selectionkey key object reader objectreader reader exception reader set last access setlastaccess system current time millis currenttimemillis reader access readable byte channel readablebytechannel channel readable byte channel readablebytechannel key channel count buffer empty buffer clear socket address socketaddress saddr channel socket channel socketchannel loop data channel blocking count channel read buffer buffer readable buffer flip buffer has array hasarray reader append buffer array count reader append buffer count buffer empty buffer clear reader has package haspackage channel data gram channel datagramchannel data gram channel datagramchannel dchannel data gram channel datagramchannel channel saddr dchannel receive buffer buffer readable buffer flip buffer has array hasarray reader append buffer array buffer limit buffer position reader append buffer buffer limit buffer position buffer empty buffer clear count reader has package haspackage pkg cnt pkgcnt reader count count pkg cnt pkgcnt stream packages process remote eof remoteeof key channel message channelmessage msgs pkg cnt pkgcnt channel data channeldata empty data array reader execute register read data send avoid dead locks register for read registerforread key reader msgs length send ack ack request remote server comp leting completing request considered async hronized asynchronized request channel data channeldata send ack async sendackasync msgs get options getoptions send ack sendack key writable byte channel writablebytechannel channel constants ack command saddr logs messages is trace enabled istraceenabled logs messages trace nio replication thread nioreplicationthread received msg unique id uniqueid msgs get unique id getuniqueid java sql timestamp system current time millis currenttimemillis throwable process message get callback getcallback message data received messagedatareceived msgs send ack request complete server sending ack remote server considered request channel data channeldata send ack sync sendacksync msgs get options getoptions send ack sendack key writable byte channel writablebytechannel channel constants ack command saddr remote process exception remoteprocessexception log is debug enabled isdebugenabled log error processing cluster message failed channel data channeldata send ack sync sendacksync msgs get options getoptions send ack sendack key writable byte channel writablebytechannel channel constants fail ack command saddr exception log error processing cluster message failed channel data channeldata send ack sync sendacksync msgs get options getoptions send ack sendack key writable byte channel writablebytechannel channel constants fail ack command saddr get use buffer pool getusebufferpool buffer pool bufferpool get buffer pool getbufferpool return buffer returnbuffer msgs get message getmessage msgs set message setmessage count remote eof remoteeof key remote eof remoteeof selection key selectionkey key close channel eof invalid ates invalidates key log is debug enabled isdebugenabled log debug channel closed remote disconnecting cancel key cancelkey key register for read registerforread selection key selectionkey key object reader objectreader reader log is trace enabled istraceenabled log trace adding key read event key reader finish register read int erest interest runnable runnable override key is valid isvalid cycle selector key active key selector wakeup resume int erest interest read write resume ops resumeops key int erest ops interestops selection key selectionkey read key int erest ops interestops resume ops resumeops log is trace enabled istraceenabled log trace registering key read key cancelled key exception cancelledkeyexception ckx nio receiver nioreceiver can celled key cancelledkey key log is trace enabled istraceenabled log trace ckx can celling cancelling key key exception log error error registering key read key receiver add event addevent cancel key cancelkey selection key selectionkey key log is trace enabled istraceenabled log trace adding key cancel event key object reader objectreader reader object reader objectreader key attachment reader reader set cancelled setcancelled reader finish runnable runnable override log is trace enabled istraceenabled log trace can celling cancelling key key nio receiver nioreceiver can celled key cancelledkey key receiver add event addevent send reply ack now ledgement acknowledgement sends busy write ack small buffer param key param channel send ack sendack selection key selectionkey key writable byte channel writablebytechannel channel command socket address socketaddress udpaddr byte buffer bytebuffer buf byte buffer bytebuffer wrap command total channel data gram channel datagramchannel data gram channel datagramchannel dchannel data gram channel datagramchannel channel todo check optimization channel thread total command length total dchannel send buf udpaddr total command length total channel write buf log is trace enabled istraceenabled log trace ack channel socket channel socketchannel socket channel socketchannel channel socket get inet address getinetaddress data gram channel datagramchannel channel socket get inet address getinetaddress java io exception ioexception log warn unable send ack channel channel disconnected get message getmessage set rx buf size setrxbufsize rx buf size rxbufsize rx buf size rxbufsize rx buf size rxbufsize get rx buf size getrxbufsize rx buf size rxbufsize