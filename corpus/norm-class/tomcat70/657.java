licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat jdbc test java sql connection java util concurrent atomic atomic integer atomicinteger org junit org junit org junit org junit test org apache tomcat jdbc pool data source datasource org apache tomcat jdbc test driver driver test concurrency testconcurrency default test case defaulttestcase debug get boolean getboolean jdbc debug data source datasource set up setup exception create default data source createdefaultdatasource get pool properties getpoolproperties set driver class name setdriverclassname driver get name getname get pool properties getpoolproperties set url seturl driver url get pool properties getpoolproperties set initial size setinitialsize get pool properties getpoolproperties set max idle setmaxidle get pool properties getpoolproperties set min idle setminidle get pool properties getpoolproperties set max active setmaxactive get pool properties getpoolproperties set remove abandoned setremoveabandoned get pool properties getpoolproperties set log abandoned setlogabandoned get pool properties getpoolproperties set test while idle settestwhileidle get pool properties getpoolproperties set min evictable idle time millis setminevictableidletimemillis get pool properties getpoolproperties set time between eviction runs millis settimebetweenevictionrunsmillis set fair queue setfairqueue override tear down teardown exception close driver reset tear down teardown test test simple testsimple exception get connection getconnection close iter atomic integer atomicinteger loopcount atomic integer atomicinteger runnable runnable override loopcount increment and get incrementandget iter connection con get connection getconnection thread sleep con close exception loopcount iter print stack trace printstacktrace thread threads thread threads length threads thread threads length threads start loopcount iter assert true asserttrue size comparison get pool getpool get size getsize debug system println size get pool getpool get size getsize system println get pool getpool get active getactive system println idle get pool getpool get idle getidle system println wait get pool getpool get wait count getwaitcount thread sleep exception loopcount iter print stack trace printstacktrace threads length threads join assert equals assertequals size comparison get pool getpool get size getsize assert equals assertequals idle comparison get pool getpool get idle getidle assert equals assertequals comparison get pool getpool get active getactive assert equals assertequals connect count driver connect count connectcount test test brutal testbrutal exception get pool properties getpoolproperties set remove abandoned setremoveabandoned get pool properties getpoolproperties set remove abandoned timeout setremoveabandonedtimeout get pool properties getpoolproperties set min evictable idle time millis setminevictableidletimemillis get pool properties getpoolproperties set time between eviction runs millis settimebetweenevictionrunsmillis get connection getconnection close iter atomic integer atomicinteger loopcount atomic integer atomicinteger runnable runnable override loopcount increment and get incrementandget iter connection con get connection getconnection con close exception loopcount iter print stack trace printstacktrace thread threads thread threads length threads thread threads length threads start loopcount iter assert true asserttrue size comparison get pool getpool get size getsize get pool getpool test all idle testallidle get pool getpool check abandoned checkabandoned get pool getpool check idle checkidle exception loopcount iter print stack trace printstacktrace threads length threads join system println connect count driver connect count connectcount system println dis connect disconnect count driver disconnect count disconnectcount assert equals assertequals size comparison get pool getpool get size getsize assert equals assertequals idle comparison get pool getpool get idle getidle assert equals assertequals comparison get pool getpool get active getactive assert equals assertequals connect count driver connect count connectcount test test brutal non fair testbrutalnonfair exception get pool properties getpoolproperties set remove abandoned setremoveabandoned get pool properties getpoolproperties set remove abandoned timeout setremoveabandonedtimeout get pool properties getpoolproperties set min evictable idle time millis setminevictableidletimemillis get pool properties getpoolproperties set time between eviction runs millis settimebetweenevictionrunsmillis get connection getconnection close iter atomic integer atomicinteger loopcount atomic integer atomicinteger runnable runnable override loopcount increment and get incrementandget iter connection con get connection getconnection con close exception loopcount iter print stack trace printstacktrace thread threads thread threads length threads thread threads length threads start loopcount iter assert true asserttrue size comparison get pool getpool get size getsize get pool getpool test all idle testallidle get pool getpool check abandoned checkabandoned get pool getpool check idle checkidle exception loopcount iter print stack trace printstacktrace threads length threads join system println connect count driver connect count connectcount system println dis connect disconnect count driver disconnect count disconnectcount assert equals assertequals size comparison get pool getpool get size getsize assert equals assertequals idle comparison get pool getpool get idle getidle assert equals assertequals comparison get pool getpool get active getactive assert equals assertequals connect count driver connect count connectcount