licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat util buf java nio byte buffer bytebuffer java nio char buffer charbuffer java nio charset charset decoder charsetdecoder java nio charset code r result coderresult decodes bytes utf extra cted extracted apache harmony modified reject code points dfff rfc standard java decoder reject modified reject code points greater ffff standard java decoder rejects harmony utf decoder charset decoder charsetdecoder table utf charset correspondence length sequence visit http ietf org rfc rfc txt not e note oxxxxxx x oxxxxxxx xxx xxxx xxxxxxx oyyyyy oxxxxxx yyy yyxxxxxx ozzzz oyyyyyy oxxxxxx zzzz yyyy zzzzyyyy yyxxxxxx ouuu ouuzzzz oyyyyyy oxxxxxx uuuuu zzzz yyyy zzzzyyyy yyxxxxxx remaining bytes remainingbytes owwwwww oyyyyy ozzzz ouuu remaining numbers remainingnumbers lower encoding limit lowerencodinglimit utf decoder c converter cconverter utf override code r result coderresult decode loop decodeloop byte buffer bytebuffer char buffer charbuffer has array hasarray has array hasarray decode has array decodehasarray decode not has array decodenothasarray code r result coderresult decode not has array decodenothasarray byte buffer bytebuffer char buffer charbuffer out remaining outremaining remaining pos position limit limit pos limit out remaining outremaining code r result coderresult overflow jchar jchar jchar jchar tail remaining bytes remainingbytes jchar tail code r result coderresult malformed for length malformedforlength limit pos tail harder code r result coderresult underflow next byte nextbyte tail next byte nextbyte xff next byte nextbyte code r result coderresult malformed for length malformedforlength jchar jchar next byte nextbyte jchar remaining numbers remainingnumbers tail jchar lower encoding limit lowerencodinglimit tail encoded octets code r result coderresult malformed for length malformedforlength pos tail apache tomcat test jchar jchar xdfff code r result coderresult unmappable for length unmappableforlength apache tomcat test jchar ffff code r result coderresult unmappable for length unmappableforlength jchar xffff jchar out remaining outremaining out remaining outremaining code r result coderresult overflow jchar jchar xdc out remaining outremaining pos code r result coderresult underflow position pos code r result coderresult decode has array decodehasarray byte buffer bytebuffer char buffer charbuffer out remaining outremaining remaining pos position limit limit b arr barr array c arr carr array in index limit inindexlimit limit array offset arrayoffset in index inindex pos array offset arrayoffset out index outindex position array offset arrayoffset face consequences in index inindex in index limit inindexlimit out remaining outremaining in index inindex jchar b arr barr in index inindex jchar jchar jchar invalid tail tail remaining bytes remainingbytes jchar tail position in index inindex array offset arrayoffset position out index outindex array offset arrayoffset code r result coderresult malformed for length malformedforlength additional checks detect invalid sequences asap checks derived unicode chapter table check tail available tailavailable in index limit inindexlimit in index inindex tail available tailavailable jchar jchar b arr barr in index inindex position in index inindex array offset arrayoffset position out index outindex array offset arrayoffset code r result coderresult malformed for length malformedforlength jchar b arr barr in index inindex position in index inindex array offset arrayoffset position out index outindex array offset arrayoffset code r result coderresult malformed for length malformedforlength jchar jchar b arr barr in index inindex position in index inindex array offset arrayoffset position out index outindex array offset arrayoffset code r result coderresult malformed for length malformedforlength jchar b arr barr in index inindex position in index inindex array offset arrayoffset position out index outindex array offset arrayoffset code r result coderresult malformed for length malformedforlength jchar jchar b arr barr in index inindex position in index inindex array offset arrayoffset position out index outindex array offset arrayoffset code r result coderresult malformed for length malformedforlength jchar b arr barr in index inindex xff b arr barr in index inindex xff xbf position in index inindex array offset arrayoffset position out index outindex array offset arrayoffset code r result coderresult malformed for length malformedforlength jchar jchar b arr barr in index inindex position in index inindex array offset arrayoffset position out index outindex array offset arrayoffset code r result coderresult malformed for length malformedforlength jchar b arr barr in index inindex position in index inindex array offset arrayoffset position out index outindex array offset arrayoffset code r result coderresult malformed for length malformedforlength check expected tail available tailavailable tail b arr barr in index inindex position in index inindex array offset arrayoffset position out index outindex array offset arrayoffset code r result coderresult malformed for length malformedforlength check fourth expected tail available tailavailable tail b arr barr in index inindex position in index inindex array offset arrayoffset position out index outindex array offset arrayoffset code r result coderresult malformed for length malformedforlength tail available tailavailable tail tail next byte nextbyte b arr barr in index inindex xff next byte nextbyte position in index inindex array offset arrayoffset position out index outindex array offset arrayoffset code r result coderresult malformed for length malformedforlength jchar jchar next byte nextbyte jchar remaining numbers remainingnumbers tail jchar lower encoding limit lowerencodinglimit tail encoded octets position in index inindex array offset arrayoffset position out index outindex array offset arrayoffset code r result coderresult malformed for length malformedforlength in index inindex tail apache tomcat test jchar jchar xdfff code r result coderresult unmappable for length unmappableforlength apache tomcat test jchar ffff code r result coderresult unmappable for length unmappableforlength jchar xffff c arr carr out index outindex jchar out remaining outremaining out remaining outremaining code r result coderresult overflow c arr carr out index outindex jchar c arr carr out index outindex jchar xdc out remaining outremaining position in index inindex array offset arrayoffset position out index outindex array offset arrayoffset out remaining outremaining in index inindex in index limit inindexlimit code r result coderresult overflow code r result coderresult underflow