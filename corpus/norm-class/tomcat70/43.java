licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat websocket server java net uri java util concurrent atomic atomic integer atomicinteger javax servlet servlet context event servletcontextevent javax websocket client endpoint clientendpoint javax websocket close reason closereason javax websocket container provider containerprovider javax websocket deployment exception deploymentexception javax websocket on close onclose javax websocket on error onerror javax websocket on message onmessage javax websocket on open onopen javax websocket session javax websocket web socket container websocketcontainer javax websocket server server container servercontainer javax websocket server server endpoint config serverendpointconfig org junit org junit test org apache catalina context org apache catalina servlets default servlet defaultservlet org apache catalina startup tomcat org apache tomcat websocket web socket base test websocketbasetest test close bug testclosebug web socket base test websocketbasetest test test on error not called when closing connection testonerrornotcalledwhenclosingconnection throwable tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx add application listener addapplicationlistener bug server config serverconfig get name getname tomcat add servlet addservlet ctx default servlet defaultservlet ctx add servlet mapping addservletmapping web socket container websocketcontainer ws container wscontainer container provider containerprovider get web socket container getwebsocketcontainer tomcat start bug client endpoint clientendpoint client bug client endpoint clientendpoint uri uri uri localhost get port getport bug server config serverconfig path session session ws container wscontainer connect to server connecttoserver client uri wait session open server count count bug server endpoint serverendpoint get open session count getopensessioncount count thread sleep assert not equals assertnotequals bug server endpoint serverendpoint get open session count getopensessioncount close session session close wait session close server count count bug server endpoint serverendpoint get open session count getopensessioncount count thread sleep assert equals assertequals bug server endpoint serverendpoint get open session count getopensessioncount ensure errors reported server assert equals assertequals bug server endpoint serverendpoint get error count geterrorcount client get error geterror client get error geterror client endpoint clientendpoint bug client endpoint clientendpoint throwable on error onerror on error onerror throwable throwable get error geterror bug server config serverconfig ws context listener wscontextlistener string path bug override context initialized contextinitialized servlet context event servletcontextevent sce context initialized contextinitialized sce server container servercontainer server container servercontainer sce get servlet context getservletcontext get attribute getattribute constants server container servlet context attribute server endpoint config serverendpointconfig server endpoint config serverendpointconfig builder create bug server endpoint serverendpoint path build add endpoint addendpoint deployment exception deploymentexception runtime exception runtimeexception bug server endpoint serverendpoint atomic integer atomicinteger open session count opensessioncount atomic integer atomicinteger atomic integer atomicinteger error count errorcount atomic integer atomicinteger get open session count getopensessioncount open session count opensessioncount get error count geterrorcount error count errorcount on open onopen on open onopen open session count opensessioncount increment and get incrementandget on message onmessage on message onmessage suppress warnings suppresswarnings unused session session string message system println received message message on error onerror on error onerror throwable error count errorcount increment and get incrementandget print stack trace printstacktrace on close onclose on close onclose suppress warnings suppresswarnings unused close reason closereason open session count opensessioncount decrement and get decrementandget