licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat websocket java net uri java nio byte buffer bytebuffer java util concurrent count down latch countdownlatch java util concurrent time unit timeunit javax websocket client endpoint config clientendpointconfig javax websocket container provider containerprovider javax websocket pong message pongmessage javax websocket session javax websocket web socket container websocketcontainer org junit org junit test org apache catalina context org apache catalina servlets default servlet defaultservlet org apache catalina startup tomcat org apache tomcat websocket tester message count client testermessagecountclient tester endpoint testerendpoint org apache tomcat websocket tester message count client testermessagecountclient tester program matic endpoint testerprogrammaticendpoint test ws ping pong messages testwspingpongmessages web socket base test websocketbasetest byte buffer bytebuffer application data applicationdata byte buffer bytebuffer wrap string mydata get bytes getbytes test test ping pong messages testpingpongmessages exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext ctx add application listener addapplicationlistener tester echo server testerechoserver config get name getname tomcat add servlet addservlet ctx default servlet defaultservlet ctx add servlet mapping addservletmapping tomcat start web socket container websocketcontainer ws container wscontainer container provider containerprovider get web socket container getwebsocketcontainer tomcat start session ws session wssession ws container wscontainer connect to server connecttoserver tester program matic endpoint testerprogrammaticendpoint client endpoint config clientendpointconfig builder create build uri localhost get port getport tester echo server testerechoserver config path async count down latch countdownlatch latch count down latch countdownlatch tester endpoint testerendpoint tep tester endpoint testerendpoint ws session wssession get user properties getuserproperties endpoint tep set latch setlatch latch pong message handler pongmessagehandler handler pong message handler pongmessagehandler latch ws session wssession add message handler addmessagehandler handler ws session wssession get basic remote getbasicremote send ping sendping application data applicationdata latch result latchresult handler get latch getlatch await time unit timeunit seconds assert true asserttrue latch result latchresult assert array equals assertarrayequals application data applicationdata array handler get messages getmessages peek get application data getapplicationdata array pong message handler pongmessagehandler tester message count client testermessagecountclient basic handler basichandler pong message pongmessage pong message handler pongmessagehandler count down latch countdownlatch latch latch override on message onmessage pong message pongmessage message get messages getmessages add message get latch getlatch get latch getlatch count down countdown