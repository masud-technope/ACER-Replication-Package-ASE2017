licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina session java file java file input stream fileinputstream java file not found exception filenotfoundexception java file output stream fileoutputstream java io exception ioexception java object input stream objectinputstream java object output stream objectoutputstream java util array list arraylist java util list org junit assert equals assertequals org junit assert not same assertnotsame org junit fail org junit test org apache catalina realm generic principal genericprincipal test serializable principal testserializableprincipal simple serialization serialization test bug suppress warnings suppresswarnings test test write read principal testwritereadprincipal file temp dir tempdir file system get property getproperty tomcat test temp output tmp temp dir tempdir mkdirs temp dir tempdir is directory isdirectory fail unable create temporary directory test create principal serialize list string roles array list arraylist string roles add role a rolea roles add role b roleb tester principal testerprincipal tp original tporiginal tester principal testerprincipal generic principal genericprincipal gp original gporiginal generic principal genericprincipal usr pwd roles tp original tporiginal temporary file serialization test file file file file create temp file createtempfile ser temp dir tempdir io exception ioexception print stack trace printstacktrace fail ioe creating temporary file generic principal genericprincipal gp new gpnew serialization file output stream fileoutputstream fos object output stream objectoutputstream oos fos file output stream fileoutputstream file oos object output stream objectoutputstream fos serializable principal serializableprincipal write principal writeprincipal gp original gporiginal oos file not found exception filenotfoundexception print stack trace printstacktrace fail fnfe creating object output stream io exception ioexception print stack trace printstacktrace fail ioe serial izing serializing principal oos oos close io exception ioexception fos fos close io exception ioexception serialize principal file input stream fileinputstream fis object input stream objectinputstream ois fis file input stream fileinputstream file ois object input stream objectinputstream fis gp new gpnew serializable principal serializableprincipal read principal readprincipal ois file not found exception filenotfoundexception print stack trace printstacktrace fail fnfe reading object output stream io exception ioexception print stack trace printstacktrace fail ioe serial izing serializing principal class not found exception classnotfoundexception print stack trace printstacktrace fail cnfe serial izing serializing principal ois ois close io exception ioexception fis fis close io exception ioexception file delete system println failed delete file test original serialized versions assert equals assertequals user names gp original gporiginal get name getname gp new gpnew get name getname assert equals assertequals pass words passwords gp original gporiginal get password getpassword gp new gpnew get password getpassword assert equals assertequals number roles gp original gporiginal get roles getroles length gp new gpnew get roles getroles length gp original gporiginal get roles getroles length assert equals assertequals role gp original gporiginal get roles getroles gp new gpnew get roles getroles key tests bug assert not same assertnotsame principal gp new gpnew gp new gpnew get user principal getuserprincipal assert equals assertequals user names tp original tporiginal get name getname gp new gpnew get user principal getuserprincipal get name getname