licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina tribes membership java io exception ioexception java net bind exception bindexception java net data gram packet datagrampacket java net inet address inetaddress java net inet socket address inetsocketaddress java net multicast socket multicastsocket java net socket timeout exception sockettimeoutexception java util arrays java util concurrent executor service executorservice java util concurrent time unit timeunit org apache catalina tribes channel org apache catalina tribes member org apache catalina tribes membership listener membershiplistener org apache catalina tribes message listener messagelistener org apache catalina tribes group group channel groupchannel org apache catalina tribes channel data channeldata org apache catalina tribes x byte buffer xbytebuffer org apache catalina tribes util executor factory executorfactory membership implementation simple multicast representation multicast membership service responsible main taining maintaining list active cluster nodes cluster node fails send heartbeat node dismissed level implementation handles multicasting sockets java nio thread send receive timeout receive author filip hanik mcast service impl mcastserviceimpl org apache juli logging log log org apache juli logging log factory logfactory get log getlog mcast service mcastservice max packet size internal flag listen thread list ens listens multicasting socket do run sender dorunsender do run receiver dorunreceiver start level startlevel socket int end intend listen multicast socket multicastsocket socket local member int end intend broad member impl memberimpl member multicast address inet address inetaddress address multicast port port time takes member expire time to expiration timetoexpiration send broadcast alive smaller time to expiration timetoexpiration send frequency sendfrequency reuse send packet sendpacket create every time everytime data gram packet datagrampacket send packet sendpacket reuse receive packet receivepacket create every time everytime data gram packet datagrampacket receive packet receivepacket membership calculate members hips memberships arrive don arrive membership membership actual listener callback stuff membership listener membershiplistener service actual listener broadcast call backs callbacks message listener messagelistener msg service msgservice thread listen pings receiver thread receiverthread receiver thread send pings sender thread senderthread sender time live multicast pack ets packets mcastttl read timeout mcast socket mcast so timeout mcastsotimeout bind address inet address inetaddress mcast bind address mcastbindaddress times system fail recovery init iated initiated recovery counter recoverycounter time recovery thread sleeps recovery attempts recovery sleep time recoverysleeptime add ability turn recovery recovery enabled recoveryenabled dont int errupt interrupt sender receiver thread pass executor executor service executorservice executor executor factory executorfactory new thread pool newthreadpool time unit timeunit seconds disable enable local loop back loopback message local loop back disabled localloopbackdisabled channel channel create mcast service impl param member local member param send frequency sendfrequency time pings param expire time expiretime time member expire param port mcast port param bind bind address param mcast address mcastaddress mcast address param service callback service param local loop back disabled localloopbackdisabled disable loop back mode loopbackmode io exception ioexception mcast service impl mcastserviceimpl member impl memberimpl member send frequency sendfrequency expire time expiretime port inet address inetaddress bind inet address inetaddress mcast address mcastaddress ttl so timeout sotimeout membership listener membershiplistener service message listener messagelistener msg service msgservice local loop back disabled localloopbackdisabled io exception ioexception member member address mcast address mcastaddress port port mcast so timeout mcastsotimeout so timeout sotimeout mcastttl ttl mcast bind address mcastbindaddress bind time to expiration timetoexpiration expire time expiretime service service msg service msgservice msg service msgservice send frequency sendfrequency send frequency sendfrequency local loop back disabled localloopbackdisabled local loop back disabled localloopbackdisabled init init io exception ioexception setup socket setupsocket send packet sendpacket data gram packet datagrampacket max packet size max packet size send packet sendpacket set address setaddress address send packet sendpacket set port setport port receive packet receivepacket data gram packet datagrampacket max packet size max packet size receive packet receivepacket set address setaddress address receive packet receivepacket set port setport port member set command setcommand member get data getdata membership membership membership member setup socket setupsocket io exception ioexception mcast bind address mcastbindaddress log info attempting bind multicast socket address port socket multicast socket multicastsocket inet socket address inetsocketaddress address port bind exception bindexception log info binding multicast address failed binding port socket multicast socket multicastsocket port socket multicast socket multicastsocket port hint disable loop local machine messages socket set loop back mode setloopbackmode local loop back disabled localloopbackdisabled mcast bind address mcastbindaddress log is info enabled isinfoenabled log info setting multihome multicast mcast bind address mcastbindaddress socket set interface setinterface mcast bind address mcastbindaddress force timeout don block mcast so timeout mcastsotimeout mcast so timeout mcastsotimeout send frequency sendfrequency log is info enabled isinfoenabled log info setting cluster mcast so timeout sotimeout mcast so timeout mcastsotimeout socket set so timeout setsotimeout mcast so timeout mcastsotimeout mcastttl log is info enabled isinfoenabled log info setting cluster mcast ttl mcastttl socket set time to live settimetolive mcastttl start service param level starts receiver level starts sender io exception ioexception service fails start illegal state exception illegalstateexception service started start level io exception ioexception valid level channel mbr seq channel mbr seq receiver illegal state exception illegalstateexception mcast service mcastservice receive running sender socket join group joingroup address io exception ioexception iox log error unable join multicast group system multicasting enabled iox do run receiver dorunreceiver receiver receiver thread receiverthread receiver set daemon setdaemon receiver start valid level channel mbr seq channel mbr seq sender illegal state exception illegalstateexception mcast service mcastservice send running receiver socket join group joingroup address packet send do run sender dorunsender sender sender thread senderthread send frequency sendfrequency sender set daemon setdaemon sender start started receiver waited membership establish valid valid illegal argument exception illegalargumentexception invalid start level accept able acceptable levels channel mbr seq channel mbr seq pause wait for members waitformembers level start level startlevel start level startlevel level wait for members waitformembers level member wait memberwait send frequency sendfrequency log is info enabled isinfoenabled log info sleeping member wait memberwait milliseconds establish cluster membership start level level thread sleep member wait memberwait interrupted exception interruptedexception ignore log is info enabled isinfoenabled log info sleeping membership established start level level s tops stops service io exception ioexception service fails disconnect sockets level io exception ioexception valid level channel mbr seq channel mbr seq valid do run receiver dorunreceiver receiver receiver int errupt interrupt receiver level channel mbr seq channel mbr seq valid do run sender dorunsender sender sender int errupt interrupt sender valid illegal argument exception illegalargumentexception invalid level accept able acceptable levels channel mbr seq channel mbr seq start level startlevel start level startlevel level shutting send shutdown message close socket start level startlevel send message member set command setcommand member shutdown payload member get data getdata send leave mcast group socket leave group leavegroup address exception ignore socket close exception ignore member set service start time setservicestarttime start level startlevel receive data gram datagram packet loc king locking wait io exception ioexception receive io exception ioexception check expired checkexpired socket receive receive packet receivepacket receive packet receivepacket get length getlength max packet size log error multicast packet received drop ping dropping receive packet receivepacket get length getlength data receive packet receivepacket get length getlength system arraycopy receive packet receivepacket get data getdata receive packet receivepacket get offset getoffset data data length x byte buffer xbytebuffer first index of firstindexof data member impl memberimpl tribes mbr member data received memberdatareceived data member broadcasts received memberbroadcastsreceived data socket timeout exception sockettimeoutexception check expired checkexpired check expired checkexpired member data received memberdatareceived data member impl memberimpl member impl memberimpl get member getmember data log is trace enabled istraceenabled log trace mcast receive ping member runnable arrays equals get command getcommand member shutdown payload log is debug enabled isdebugenabled log debug member shutdown membership remove member removemember runnable override string thread current thread currentthread get name getname thread current thread currentthread set name setname membership member disappeared memberdisappeared service member disappeared memberdisappeared thread current thread currentthread set name setname membership member alive memberalive log is debug enabled isdebugenabled log debug mcast add member runnable override string thread current thread currentthread get name getname thread current thread currentthread set name setname membership member added memberadded service member added memberadded thread current thread currentthread set name setname executor execute member broadcasts received memberbroadcastsreceived log is trace enabled istraceenabled log trace mcast received broadcasts x byte buffer xbytebuffer buffer x byte buffer xbytebuffer buffer count packages countpackages count buffer count packages countpackages channel data channeldata data channel data channeldata count count data buffer extract package extractpackage illegal state exception illegalstateexception ise log debug unable decode message ise io exception ioexception log debug unable decode message runnable runnable override string thread current thread currentthread get name getname thread current thread currentthread set name setname membership member added memberadded data length data member equals data get address getaddress msg service msgservice message received messagereceived data throwable thread death threaddeath thread death threaddeath virtual machine error virtualmachineerror virtual machine error virtualmachineerror log error unable receive broadcast message thread current thread currentthread set name setname executor execute object expired mutex expiredmutex object check expired checkexpired expired mutex expiredmutex member impl memberimpl expired membership expire time to expiration timetoexpiration expired length member impl memberimpl member expired log is debug enabled isdebugenabled log debug mcast expire member expired runnable runnable override string thread current thread currentthread get name getname thread current thread currentthread set name setname membership member expired memberexpired service member disappeared memberdisappeared member thread current thread currentthread set name setname executor execute exception log error unable process member disappeared message send ping io exception ioexception send check expired checkexpired io exception ioexception send check expired checkexpired object send lock sendlock object send check expired checkexpired data gram packet datagrampacket packet io exception ioexception check expired checkexpired check expired checkexpired packet start level startlevel channel mbr seq channel mbr seq packet member log is trace enabled istraceenabled log trace mcast send ping member member data member get data getdata packet data gram packet datagrampacket data data length log is trace enabled istraceenabled log trace sending message broadcast packet get length getlength bytes member packet set address setaddress address packet set port setport port todo operation thread safe send lock sendlock socket send packet check expired checkexpired check expired checkexpired get service start time getservicestarttime member member get service start time getservicestarttime get recovery counter getrecoverycounter recovery counter recoverycounter is recovery enabled isrecoveryenabled recovery enabled recoveryenabled get recovery sleep time getrecoverysleeptime recovery sleep time recoverysleeptime channel get channel getchannel channel set channel setchannel channel channel channel channel receiver thread receiverthread thread error counter errorcounter receiver thread receiverthread string channel name channelname channel group channel groupchannel group channel groupchannel channel get name getname channel name channelname group channel groupchannel channel get name getname set name setname tribes membership receiver membershipreceiver channel name channelname override do run receiver dorunreceiver receive error counter errorcounter array index out of bounds exception arrayindexoutofboundsexception log is debug enabled isdebugenabled log debug invalid member mcast exception interrupted exception interruptedexception int errupted interrupted error counter errorcounter do run receiver dorunreceiver log warn error receiving mcast sleeping log is debug enabled isdebugenabled log debug error receiving mcast do run receiver dorunreceiver sleeping do run receiver dorunreceiver thread sleep exception ignore error counter errorcounter recovery counter recoverycounter error counter errorcounter recovery thread recoverythread recover mcast service impl mcastserviceimpl sender thread senderthread thread time error counter errorcounter sender thread senderthread time time time string channel name channelname channel group channel groupchannel group channel groupchannel channel get name getname channel name channelname group channel groupchannel channel get name getname set name setname tribes membership sender membershipsender channel name channelname override do run sender dorunsender send error counter errorcounter exception error counter errorcounter log warn unable send mcast message log debug unable send mcast message error counter errorcounter recovery counter recoverycounter error counter errorcounter recovery thread recoverythread recover mcast service impl mcastserviceimpl thread sleep time exception ignore recovery thread recoverythread thread running recover mcast service impl mcastserviceimpl parent running parent is recovery enabled isrecoveryenabled running thread recovery thread recoverythread parent string channel name channelname parent channel group channel groupchannel group channel groupchannel parent channel get name getname channel name channelname group channel groupchannel parent channel get name getname set name setname tribes membership recovery membershiprecovery channel name channelname set daemon setdaemon start mcast service impl mcastserviceimpl parent recovery thread recoverythread mcast service impl mcastserviceimpl parent parent parent stop service stopservice parent channel mbr seq channel mbr seq exception log warn recovery thread failed membership service start service startservice parent init parent start channel mbr seq channel mbr seq exception log warn recovery thread failed start membership service override success attempt success log is info enabled isinfoenabled log info tribes membership running recovery thread multicasting functional stop service stopservice start service startservice success log is info enabled isinfoenabled log info membership recovery successful success log is info enabled isinfoenabled log info recovery attempt attempt failed parent recovery sleep time recoverysleeptime seconds thread sleep parent recovery sleep time recoverysleeptime interrupted exception interruptedexception ignore running set recovery counter setrecoverycounter recovery counter recoverycounter recovery counter recoverycounter recovery counter recoverycounter set recovery enabled setrecoveryenabled recovery enabled recoveryenabled recovery enabled recoveryenabled recovery enabled recoveryenabled set recovery sleep time setrecoverysleeptime recovery sleep time recoverysleeptime recovery sleep time recoverysleeptime recovery sleep time recoverysleeptime