licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina valves java byte array input stream bytearrayinputstream java io exception ioexception java nio charset charset java security no such provider exception nosuchproviderexception java security cert certificate factory certificatefactory java security cert certificate javax servlet servlet exception servletexception org apache catalina globals org apache catalina connector request org apache catalina connector response org apache juli logging log org apache juli logging log factory logfactory mod proxy http client ssl included protocol mod mod proxy ajp client ssl tomcat additional configuration required http d httpd mod headers add ssl http headers tomcat valve read http headers insert request note ensure headers http d httpd requests prevent client spoofing ssl sending fake headers http d httpd conf add pre if module ifmodule ssl module request header requestheader ssl client cert ssl client cert request header requestheader ssl cipher ssl cipher request header requestheader ssl session ssl session request header requestheader ssl cipher use key size usekeysize ssl cipher use key size usekeysize if module ifmodule pre server xml configure valve engine element server xml pre engine valve class name classname org apache catalina valves ssl valve sslvalve host engine pre ssl valve sslvalve valve base valvebase log log log factory logfactory get log getlog ssl valve sslvalve string ssl client cert header sslclientcertheader ssl client cert string ssl cipher header sslcipherheader ssl cipher string ssl session id header sslsessionidheader ssl session string ssl cipher user key size header sslcipheruserkeysizeheader ssl cipher use key size usekeysize constructor ssl valve sslvalve string get ssl client cert header getsslclientcertheader ssl client cert header sslclientcertheader set ssl client cert header setsslclientcertheader string ssl client cert header sslclientcertheader ssl client cert header sslclientcertheader ssl client cert header sslclientcertheader string get ssl cipher header getsslcipherheader ssl cipher header sslcipherheader set ssl cipher header setsslcipherheader string ssl cipher header sslcipherheader ssl cipher header sslcipherheader ssl cipher header sslcipherheader string get ssl session id header getsslsessionidheader ssl session id header sslsessionidheader set ssl session id header setsslsessionidheader string ssl session id header sslsessionidheader ssl session id header sslsessionidheader ssl session id header sslsessionidheader string get ssl cipher user key size header getsslcipheruserkeysizeheader ssl cipher user key size header sslcipheruserkeysizeheader set ssl cipher user key size header setsslcipheruserkeysizeheader string ssl cipher user key size header sslcipheruserkeysizeheader ssl cipher user key size header sslcipheruserkeysizeheader ssl cipher user key size header sslcipheruserkeysizeheader string myget header mygetheader request request string header string strcert request get header getheader header strcert mod header writes ssl variable filled equals strcert strcert override invoke request request response response io exception ioexception servlet exception servletexception mod header converts rebuild client certificate string strcert myget header mygetheader request ssl client cert header sslclientcertheader strcert strcert length string strcert strcert replace string strcert strcert substring strcert length string strcert certificate string strcert strcert concat strcert string str certs strcerts strcert concat certificate byte array input stream bytearrayinputstream bais byte array input stream bytearrayinputstream str certs strcerts get bytes getbytes utf byte array input stream bytearrayinputstream bais byte array input stream bytearrayinputstream str certs strcerts get bytes getbytes charset default charset defaultcharset certificate jsse certs jssecerts string provider name providername string request get connector getconnector get property getproperty client cert provider clientcertprovider certificate factory certificatefactory provider name providername certificate factory certificatefactory get instance getinstance certificate factory certificatefactory get instance getinstance provider name providername certificate cert certificate generate certificate generatecertificate bais jsse certs jssecerts certificate jsse certs jssecerts cert java security cert certificate exception certificateexception log warn get string getstring ssl valve sslvalve cert error certerror str certs strcerts no such provider exception nosuchproviderexception log error get string getstring ssl valve sslvalve invalid provider invalidprovider provider name providername request set attribute setattribute globals certificates attr jsse certs jssecerts strcert myget header mygetheader request ssl cipher header sslcipherheader strcert request set attribute setattribute globals cipher suite attr strcert strcert myget header mygetheader request ssl session id header sslsessionidheader strcert request set attribute setattribute globals ssl session attr strcert request set attribute setattribute globals ssl session tomcat attr strcert strcert myget header mygetheader request ssl cipher user key size header sslcipheruserkeysizeheader strcert request set attribute setattribute globals key size attr integer value of valueof strcert get next getnext invoke request response