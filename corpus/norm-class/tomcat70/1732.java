licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina comet java io exception ioexception java input stream inputstream java output stream outputstream java net socket javax net socket factory socketfactory javax servlet servlet exception servletexception javax servlet http http servlet httpservlet javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse javax servlet http http session httpsession org junit assert equals assertequals org junit assert true asserttrue org junit fail org junit org junit assume org junit test org apache catalina context org apache catalina wrapper org apache catalina comet comet event cometevent event type eventtype org apache catalina connector comet event impl cometeventimpl org apache catalina connector request org apache catalina connector response org apache catalina startup tomcat org apache catalina startup tomcat base test tomcatbasetest org apache catalina valves tester access log valve testeraccesslogvalve org apache catalina valves valve base valvebase test comet processor testcometprocessor tomcat base test tomcatbasetest test test async close testasyncclose exception assume assume true assumetrue test skipped connector support comet is comet supported iscometsupported setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context root tomcat add context addcontext tomcat add servlet addservlet root comet simple comet servlet simplecometservlet root add servlet mapping addservletmapping comet comet tomcat add servlet addservlet root hello world servlet helloworldservlet root add servlet mapping addservletmapping root get pipeline getpipeline add valve addvalve async comet close valve asynccometclosevalve tomcat get connector getconnector set property setproperty connection timeout connectiontimeout tomcat start create connection comet servlet socket socket socket factory socketfactory get default getdefault create socket createsocket localhost get port getport socket set so timeout setsotimeout output stream outputstream socket get output stream getoutputstream string request line requestline post http localhost get port getport comet http write request line requestline get bytes getbytes write transfer encoding chunked get bytes getbytes write get bytes getbytes input stream inputstream socket get input stream getinputstream response reader thread responsereaderthread read thread readthread response reader thread responsereaderthread read thread readthread start wait comet request response finish count count read thread readthread get response getresponse ends with endswith thread sleep count count fail comet request complete send standard http request connection request line requestline http localhost get port getport http write request line requestline get bytes getbytes write get bytes getbytes check expected response count count read thread readthread get response getresponse hello world servlet helloworldservlet response text thread sleep count count fail comet request complete read thread readthread join close close test test sync close testsyncclose exception assume assume true assumetrue test skipped connector support comet is comet supported iscometsupported setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context root tomcat add context addcontext tomcat add servlet addservlet root comet comet close servlet cometcloseservlet root add servlet mapping addservletmapping comet comet tomcat add servlet addservlet root hello world servlet helloworldservlet root add servlet mapping addservletmapping tomcat get connector getconnector set property setproperty connection timeout connectiontimeout tomcat start create connection comet servlet socket socket socket factory socketfactory get default getdefault create socket createsocket localhost get port getport socket set so timeout setsotimeout output stream outputstream socket get output stream getoutputstream string request line requestline post http localhost get port getport comet http write request line requestline get bytes getbytes write transfer encoding chunked get bytes getbytes write get bytes getbytes don send data write get bytes getbytes input stream inputstream socket get input stream getinputstream response reader thread responsereaderthread read thread readthread response reader thread responsereaderthread read thread readthread start wait comet request response finish count count read thread readthread get response getresponse ends with endswith thread sleep count assert true asserttrue read thread readthread get response getresponse nok count fail comet request complete send standard http request connection request line requestline http localhost get port getport http write request line requestline get bytes getbytes write connection close get bytes getbytes write get bytes getbytes check expected response count count read thread readthread get response getresponse hello world servlet helloworldservlet response text thread sleep count count fail comet request complete read thread readthread join close close test test connection close testconnectionclose exception assume assume true assumetrue test skipped connector support comet is comet supported iscometsupported setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context root tomcat add context addcontext tomcat add servlet addservlet root comet connection close servlet connectioncloseservlet root add servlet mapping addservletmapping comet comet tomcat add servlet addservlet root hello world servlet helloworldservlet root add servlet mapping addservletmapping tomcat get connector getconnector set property setproperty connection timeout connectiontimeout tomcat start create connection comet servlet socket socket socket factory socketfactory get default getdefault create socket createsocket localhost get port getport socket set so timeout setsotimeout output stream outputstream socket get output stream getoutputstream string request line requestline post http localhost get port getport comet http write request line requestline get bytes getbytes write transfer encoding chunked get bytes getbytes write get bytes getbytes don send data write get bytes getbytes input stream inputstream socket get input stream getinputstream response reader thread responsereaderthread read thread readthread response reader thread responsereaderthread read thread readthread start wait comet request response finish count count read thread readthread get response getresponse ends with endswith thread sleep count count fail comet request complete read thread terminated cleanly server closed socket assert false assertfalse read thread readthread is alive isalive assert null assertnull read thread readthread get exception getexception close close test test simple comet client testsimplecometclient exception do simple comet test dosimplecomettest test test simple comet client begin fail testsimplecometclientbeginfail exception do simple comet test dosimplecomettest simple comet servlet simplecometservlet fail test test simple comet client read fail testsimplecometclientreadfail exception do simple comet test dosimplecomettest simple comet servlet simplecometservlet fail read test test simple comet client end fail testsimplecometclientendfail exception do simple comet test dosimplecomettest simple comet servlet simplecometservlet fail do simple comet test dosimplecomettest string init param initparam exception assume assume true assumetrue test skipped connector support comet is comet supported iscometsupported setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context root tomcat add context addcontext wrapper tomcat add servlet addservlet root comet simple comet servlet simplecometservlet init param initparam add init parameter addinitparameter init param initparam root add servlet mapping addservletmapping comet tester access log valve testeraccesslogvalve alv tester access log valve testeraccesslogvalve root get pipeline getpipeline add valve addvalve alv tomcat start create connection comet servlet socket socket socket factory socketfactory get default getdefault create socket createsocket localhost get port getport socket set so timeout setsotimeout output stream outputstream socket get output stream getoutputstream string request line requestline post http localhost get port getport http write request line requestline get bytes getbytes write transfer encoding chunked get bytes getbytes write get bytes getbytes ping writer thread pingwriterthread write thread writethread ping writer thread pingwriterthread write thread writethread start socket set so timeout setsotimeout input stream inputstream socket get input stream getinputstream response reader thread responsereaderthread read thread readthread response reader thread responsereaderthread read thread readthread start read thread readthread join close close string response read thread readthread get response getresponse split init param initparam normal response expected validate response assert equals assertequals http response assert equals assertequals server apache coyote response assert true asserttrue response starts with startswith cookie jsessionid assert equals assertequals content type text plain charset iso response assert equals assertequals transfer encoding chunked response assert true asserttrue response starts with startswith assert equals assertequals response assert equals assertequals response assert equals assertequals response assert equals assertequals response assert equals assertequals response assert equals assertequals client read bytes response assert equals assertequals response assert equals assertequals response assert equals assertequals client read bytes response assert equals assertequals response assert equals assertequals response assert equals assertequals client read bytes response assert equals assertequals response assert equals assertequals response assert equals assertequals client read bytes response assert equals assertequals response assert equals assertequals response assert equals assertequals client response assert equals assertequals response assert equals assertequals response expect lines assert equals assertequals response length response code client simple comet servlet simplecometservlet fail equals init param initparam assert equals assertequals http internal server error response alv validate access log validateaccesslog assert equals assertequals http response alv validate access log validateaccesslog tests comet connection closed tomcat connector stopped test test comet connector stop testcometconnectorstop exception assume assume true assumetrue test skipped connector support comet is comet supported iscometsupported setup tomcat instance simple comet servlet simplecometservlet servlet simple comet servlet simplecometservlet tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context root tomcat add context addcontext tomcat add servlet addservlet root comet servlet root add servlet mapping addservletmapping comet tomcat start create connection comet servlet socket socket socket factory socketfactory get default getdefault create socket createsocket localhost get port getport socket set so timeout setsotimeout output stream outputstream socket get output stream getoutputstream string request line requestline post http localhost get port getport http write request line requestline get bytes getbytes write transfer encoding chunked get bytes getbytes write get bytes getbytes ping writer thread pingwriterthread write thread writethread ping writer thread pingwriterthread write thread writethread start input stream inputstream socket get input stream getinputstream response reader thread responsereaderthread read thread readthread response reader thread responsereaderthread read thread readthread start couple ping messages written thread sleep tomcat get connector getconnector wait read write threads read thread readthread join write thread writethread join destroy connector executor event tomcat get connector getconnector destroy string response read thread readthread get response getresponse split string last message lastmessage string last response line lastresponseline response length last message lastmessage response last message lastmessage starts with startswith client response length last response line lastresponseline response last response line lastresponseline length string builder stringbuilder status string builder stringbuilder expected rel iable reliable write thread writethread exception java net socket exception socketexception reader thread readerthread exception message client response empty chunk comet event event occurred status append status status append n writer thread nwriterthread exception write thread writethread get exception getexception status append n reader thread nreaderthread exception read thread readthread get exception getexception status append n last nlast message last message lastmessage status append n last nlast response last response line lastresponseline status append n last nlast comet event servlet get last event getlastevent status append nend event occurred servlet get end event occurred getendeventoccurred write thread writethread get exception getexception last message lastmessage client event type eventtype equals servlet get last event getlastevent log error status log info status assert true asserttrue comet event received servlet get end event occurred getendeventoccurred assert true asserttrue comet event event received event type eventtype equals servlet get last event getlastevent is comet supported iscometsupported string protocol get tomcat instance gettomcatinstance get connector getconnector get protocol handler class name getprotocolhandlerclassname protocol nio protocol apr simple comet servlet simplecometservlet http servlet httpservlet comet processor cometprocessor serialversionuid string fail fail on begin failonbegin string fail read fail on read failonread string fail fail on end failonend fail on begin failonbegin fail on read failonread fail on end failonend event type eventtype last event lastevent end event occurred endeventoccurred event type eventtype get last event getlastevent last event lastevent get end event occurred getendeventoccurred end event occurred endeventoccurred override init servlet exception servletexception fail on begin failonbegin parse boolean parseboolean get servlet config getservletconfig get init parameter getinitparameter fail fail on read failonread parse boolean parseboolean get servlet config getservletconfig get init parameter getinitparameter fail read fail on end failonend parse boolean parseboolean get servlet config getservletconfig get init parameter getinitparameter fail override event comet event cometevent event io exception ioexception servlet exception servletexception http servlet request httpservletrequest request event get http servlet request gethttpservletrequest http servlet response httpservletresponse response event get http servlet response gethttpservletresponse http session httpsession session request get session getsession session set max inactive interval setmaxinactiveinterval last event lastevent event get event type geteventtype event get event type geteventtype event type eventtype fail on begin failonbegin io exception ioexception fail response set content type setcontenttype text plain response get writer getwriter print event get event type geteventtype event type eventtype read fail on read failonread io exception ioexception fail read input stream inputstream request get input stream getinputstream count read count string msg read count bytes response get writer getwriter print client msg event get event type geteventtype event type eventtype end event occurred endeventoccurred fail on end failonend io exception ioexception fail string msg response get writer getwriter print client msg event close string msg event get event type geteventtype event get event sub type geteventsubtype system print msg response get writer getwriter print msg event close response get writer getwriter flush comet close servlet cometcloseservlet http servlet httpservlet comet processor cometprocessor serialversionuid override event comet event cometevent event io exception ioexception servlet exception servletexception http servlet response httpservletresponse response event get http servlet response gethttpservletresponse response set content type setcontenttype text plain force chunked response test client expects response flush buffer flushbuffer response get writer getwriter print event close connection close servlet connectioncloseservlet http servlet httpservlet comet processor cometprocessor serialversionuid override event comet event cometevent event io exception ioexception servlet exception servletexception http servlet response httpservletresponse response event get http servlet response gethttpservletresponse response set content type setcontenttype text plain disable alive response set header setheader connection close response flush buffer flushbuffer response get writer getwriter print event close ping writer thread pingwriterthread thread ping count pingcount output stream outputstream exception ping writer thread pingwriterthread ping count pingcount output stream outputstream ping count pingcount ping count pingcount exception get exception getexception override ping count pingcount write get bytes getbytes write ping get bytes getbytes flush thread sleep write get bytes getbytes write get bytes getbytes exception response reader thread responsereaderthread thread input stream inputstream string builder stringbuilder response string builder stringbuilder exception response reader thread responsereaderthread input stream inputstream exception get exception getexception string get response getresponse response to string tostring override read response append read exception async comet close valve asynccometclosevalve valve base valvebase override invoke request request response response io exception ioexception servlet exception servletexception comet event impl cometeventimpl event comet event impl cometeventimpl request response get next getnext invoke request response request is comet iscomet thread async comet close thread asynccometclosethread event start async comet close thread asynccometclosethread thread comet event cometevent event async comet close thread asynccometclosethread comet event cometevent event event event override thread sleep event close exception print stack trace printstacktrace