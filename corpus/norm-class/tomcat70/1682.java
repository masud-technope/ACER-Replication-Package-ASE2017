licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license chat java io exception ioexception java input stream inputstream java print writer printwriter java util array list arraylist javax servlet servlet exception servletexception javax servlet http http servlet httpservlet javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse org apache catalina comet comet event cometevent org apache catalina comet comet processor cometprocessor helper implement comet functionality chat servlet chatservlet http servlet httpservlet comet processor cometprocessor serialversionuid string charset utf array list arraylist http servlet response httpservletresponse connections array list arraylist http servlet response httpservletresponse message sender messagesender message sender messagesender override init servlet exception servletexception message sender messagesender message sender messagesender thread message sender thread messagesenderthread thread message sender messagesender message sender messagesender get servlet context getservletcontext get context path getcontextpath message sender thread messagesenderthread set daemon setdaemon message sender thread messagesenderthread start override destroy connections clear message sender messagesender message sender messagesender process comet event param event comet event processed io exception ioexception servlet exception servletexception override event comet event cometevent event io exception ioexception servlet exception servletexception note servlets avoid mixin g mixing comet stuff regular connection processing http servlet request httpservletrequest request event get http servlet request gethttpservletrequest http servlet response httpservletresponse response event get http servlet response gethttpservletresponse event get event type geteventtype comet event cometevent event type eventtype string action request get parameter getparameter action action login equals action string nickname request get parameter getparameter nickname request get session getsession set attribute setattribute nickname nickname response send redirect sendredirect jsp event close string nickname string request get session getsession get attribute getattribute nickname string message request get parameter getparameter message message sender messagesender send nickname message response send redirect sendredirect post jsp event close request get session getsession get attribute getattribute nickname redirect login log redirect login session request get session getsession get id getid response send redirect sendredirect login jsp event close event request response event get event type geteventtype comet event cometevent event type eventtype error error event request response event get event type geteventtype comet event cometevent event type eventtype event request response event get event type geteventtype comet event cometevent event type eventtype read read event request response suppress warnings suppresswarnings unused comet event cometevent event http servlet request httpservletrequest request http servlet response httpservletresponse response io exception ioexception log session request get session getsession get id getid response set content type setcontenttype text html charset charset print writer printwriter writer response get writer getwriter writer println doctype html dtd html transitional http org html loose dtd writer println html head title jsp chat title head body bgcolor ffffff writer println div chat href chat click reload window div writer flush connections connections add response message sender messagesender send tomcat request get session getsession get attribute getattribute nickname joined chat comet event cometevent event http servlet request httpservletrequest request http servlet response httpservletresponse response io exception ioexception log session request get session getsession get id getid connections connections remove response print writer printwriter writer response get writer getwriter writer println body html event close error comet event cometevent event http servlet request httpservletrequest request http servlet response httpservletresponse response io exception ioexception log error session request get session getsession get id getid connections connections remove response event close read comet event cometevent event http servlet request httpservletrequest request http servlet response httpservletresponse response io exception ioexception input stream inputstream request get input stream getinputstream buf log read buf log read bytes string buf session request get session getsession get id getid log file event request response override service http servlet request httpservletrequest request http servlet response httpservletresponse response io exception ioexception servlet exception servletexception compatibility method equivalent method regular connection model response set content type setcontenttype text html charset charset print writer printwriter writer response get writer getwriter writer println doctype html dtd html transitional http org html loose dtd writer println html head title jsp chat title head body bgcolor ffffff writer println chat supports comet processing writer println configure connector supports comet writer println body html poller message sender messagesender runnable running array list arraylist string messages array list arraylist string message sender messagesender contructor running messages messages notify send string user string message messages messages add user message messages notify background thread list ens listens incoming tcp connections hands processor override loop receive shutdown command running string pending messages pendingmessages messages running messages size messages wait interrupted exception interruptedexception pending messages pendingmessages messages to array toarray string messages clear connections connections size print writer printwriter writer connections get writer getwriter pending messages pendingmessages length writer println div filter pending messages pendingmessages div writer flush io exception ioexception log io exception ioexception sending message filter message string characters sensitive html param message message string filtered author copied org apache catalina util request util requestutil filter string string filter string message message content message length message get chars getchars message length content string builder stringbuilder result string builder stringbuilder content length content length content result append result append result append amp result append quot result append content result to string tostring