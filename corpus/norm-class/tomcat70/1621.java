licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina authenticator java util array list arraylist java util hash map hashmap java util list java util map org junit assert equals assertequals org junit assert true asserttrue org junit test org apache catalina context org apache catalina deploy login config loginconfig org apache catalina deploy security collection securitycollection org apache catalina deploy security constraint securityconstraint org apache catalina startup tester servlet testerservlet org apache catalina startup tomcat org apache catalina startup tomcat base test tomcatbasetest org apache tomcat util buf byte chunk bytechunk org apache tomcat util security concurrent message digest concurrentmessagedigest org apache tomcat util security encoder test digest authenticator digestauthenticator non login authenticator nonloginauthenticator single sign on singlesignon valve active absence sso support webapp non login authenticator nonloginauthenticator simply access resources tests exercise auth enticating authenticating webapp digest authenticator digestauthenticator triggers additional sso logic web apps webapps note tests intended exercise sso logic authenticator comp rehensively comprehensively test logic paths resp onsibility responsibility sso test suite test on on login and digest authenticator testssononloginanddigestauthenticator tomcat base test tomcatbasetest string user user string pwd pwd string role role string http prefix http localhost string context path nologin nologin string context path digest digest string uri string uri any one can access anyonecanaccess timeout secs timeout delay msecs timeout secs timeout secs timeout delay msecs timeout secs string client header authorization string opaque opaque string non ce nonce nonce string realm realm string cnonce cnonce string string string qop string server cookies cookie string browser cookies cookie list string cookies access unprotected resource established sso session permitted test test accept public non login testacceptpublicnonlogin exception do test non login dotestnonlogin context path nologin uri access resource established sso session rejected forbidden status test test reject protected non login testrejectprotectednonlogin exception do test non login dotestnonlogin context path nologin uri log on logon access resource digest authentication establish sso session wait sso session times access resource rejected forbidden status successful authentication test test digest login session timeout testdigestloginsessiontimeout exception do test digest dotestdigest user pwd context path digest uri cnonce qop wait session expire thread sleep timeout delay msecs change client nonce succeed do test digest dotestdigest user pwd context path digest uri cnonce qop log on logon access resource digest authentication establish sso session access resource non login nonlogin webapp sending sso session cookie rejected forbidden status test test digest login reject protected without cookies testdigestloginrejectprotectedwithoutcookies exception do test digest dotestdigest user pwd context path digest uri cnonce qop do test non login dotestnonlogin context path nologin uri log on logon access resource digest authentication establish sso session access resource non login nonlogin webapp sending sso session cookie webapp successful status test test digest login accept protected with cookies testdigestloginacceptprotectedwithcookies exception do test digest dotestdigest user pwd context path digest uri cnonce qop do test non login dotestnonlogin context path nologin uri log on logon access resource digest authentication establish sso session access resource non login nonlogin webapp sending sso session cookie webapp successful status wait digest session expire sso session remain active non login nonlogin session expired access resource sso session expired successful status wait login session expire rejected forbidden status bug fix bugfix https apache org bug zilla bugzilla bug cgi test test digest expired accept protected with cookies testdigestexpiredacceptprotectedwithcookies exception do test digest dotestdigest user pwd context path digest uri cnonce qop do test non login dotestnonlogin context path nologin uri wait basic session expire non login nonlogin session exp iry expiry thread sleep timeout delay msecs do test non login dotestnonlogin context path nologin uri wait non login nonlogin session expire tear sso session time thread sleep timeout delay msecs do test non login dotestnonlogin context path nologin uri do test non login dotestnonlogin string uri add cookies addcookies expected reject expectedreject expectedrc exception map string list string req headers reqheaders hash map hashmap string list string map string list string resp headers respheaders hash map hashmap string list string byte chunk bytechunk byte chunk bytechunk add cookies addcookies add cookies addcookies req headers reqheaders get url geturl http prefix get port getport uri req headers reqheaders resp headers respheaders expected reject expectedreject assert equals assertequals expectedrc assert true asserttrue get length getlength assert equals assertequals assert equals assertequals to string tostring save cookies savecookies resp headers respheaders do test digest dotestdigest string user string pwd string uri expected reject expectedreject expectedrc use server non ce useservernonce use server opaque useserveropaque string string cnonce string qop req expect exception string digest uri digesturi uri list string array list arraylist string map string list string req headers reqheaders hash map hashmap string list string map string list string resp headers respheaders hash map hashmap string list string access attempt challenged add build digest response builddigestresponse user pwd digest uri digesturi realm cnonce qop req headers reqheaders client header byte chunk bytechunk byte chunk bytechunk get url geturl http prefix get port getport uri req headers reqheaders resp headers respheaders expected reject expectedreject assert equals assertequals expectedrc assert true asserttrue get length getlength assert equals assertequals assert equals assertequals to string tostring save cookies savecookies resp headers respheaders request succeed server nonce map string list string req headers reqheaders hash map hashmap string list string map string list string resp headers respheaders hash map hashmap string list string clear use server non ce useservernonce use server opaque useserveropaque add build digest response builddigestresponse user pwd digest uri digesturi get auth token getauthtoken resp headers respheaders realm get auth token getauthtoken resp headers respheaders non ce nonce get auth token getauthtoken resp headers respheaders opaque cnonce qop add build digest response builddigestresponse user pwd digest uri digesturi get auth token getauthtoken resp headers respheaders realm get auth token getauthtoken resp headers respheaders non ce nonce cnonce qop add build digest response builddigestresponse user pwd digest uri digesturi get auth token getauthtoken resp headers respheaders realm get auth token getauthtoken resp headers respheaders opaque cnonce qop req headers reqheaders client header recycle get url geturl http prefix get port getport uri req headers reqheaders resp headers respheaders req expect assert equals assertequals assert equals assertequals to string tostring save cookies savecookies resp headers respheaders assert equals assertequals assert true asserttrue get length getlength override set up setup exception set up setup create tomcat server memory realm tomcat tomcat get tomcat instance gettomcatinstance associate singe sign on singesignon valve contexts single sign on singlesignon sso single sign on singlesignon tomcat get host gethost get pipeline getpipeline add valve addvalve sso add test user role realm tomcat add user adduser user pwd tomcat add role addrole user role setup non login nonlogin login digest web apps webapps set up non login setupnonlogin tomcat set up digest setupdigest tomcat tomcat start set up non login setupnonlogin tomcat tomcat exception file system doc base docbase required context ctxt tomcat add context addcontext context path nologin ctxt set session timeout setsessiontimeout timeout secs add servlet tomcat add servlet addservlet ctxt tester servlet testerservlet tester servlet testerservlet ctxt add servlet mapping addservletmapping uri tester servlet testerservlet security collection securitycollection collection security collection securitycollection collection add pattern addpattern uri security constraint securityconstraint security constraint securityconstraint add auth role addauthrole role add collection addcollection collection ctxt add constraint addconstraint add unprotected servlet tomcat add servlet addservlet ctxt tester servlet testerservlet tester servlet testerservlet ctxt add servlet mapping addservletmapping uri tester servlet testerservlet security collection securitycollection collection security collection securitycollection collection add pattern addpattern uri security constraint securityconstraint security constraint securityconstraint add role sig nals signals access permitted add collection addcollection collection ctxt add constraint addconstraint configure authenticator login config loginconfig login config loginconfig set auth method setauthmethod ctxt set login config setloginconfig ctxt get pipeline getpipeline add valve addvalve non login authenticator nonloginauthenticator set up digest setupdigest tomcat tomcat exception file system doc base docbase required context ctxt tomcat add context addcontext context path digest ctxt set session timeout setsessiontimeout timeout secs add servlet tomcat add servlet addservlet ctxt tester servlet testerservlet tester servlet testerservlet ctxt add servlet mapping addservletmapping uri tester servlet testerservlet security collection securitycollection collection security collection securitycollection collection add pattern addpattern uri security constraint securityconstraint security constraint securityconstraint add auth role addauthrole role add collection addcollection collection ctxt add constraint addconstraint configure authenticator login config loginconfig login config loginconfig set auth method setauthmethod digest ctxt set login config setloginconfig ctxt get pipeline getpipeline add valve addvalve digest authenticator digestauthenticator string get auth token getauthtoken map string list string resp headers respheaders string token string prefix string suffix list string auth headers authheaders resp headers respheaders authenticator base authenticatorbase header assume string auth header authheader auth headers authheaders iterator string search for searchfor token prefix start auth header authheader index of indexof search for searchfor search for searchfor length auth header authheader index of indexof suffix start auth header authheader substring start notes rfc data data secret data concat secret data unq username unq realm pass wd passwd method digest uri request digest unq nonce unq cnonce unq qop string build digest response builddigestresponse string user string pwd string uri string realm string nonce string opaque string string cnonce string qop string user realm pwd string uri string digest string digest string response qop response nonce response nonce cnonce qop string response digest response string builder stringbuilder string builder stringbuilder append digest username append user append realm append realm append nonce append nonce append uri append uri append opaque append opaque append response append response append qop append qop append qop append append cnonce append cnonce append cnonce append to string tostring string digest string input encoder encode concurrent message digest concurrentmessagedigest digestmd input get bytes getbytes extract save server cookies incoming response save cookies savecookies map string list string resp headers respheaders save cookie values header prefix cookies resp headers respheaders server cookies add saved cookies out going outgoing request add cookies addcookies map string list string req headers reqheaders cookies cookies size req headers reqheaders browser cookies cookies