licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina valves java io exception ioexception java util array list arraylist java util arrays java util list javax servlet servlet exception servletexception org junit assert equals assertequals org junit assert false assertfalse org junit assert not null assertnotnull org junit assert null assertnull org junit assert true asserttrue org junit org junit test org apache catalina access log accesslog org apache catalina connector request org apache catalina connector response link remote ip valve remoteipvalve tests test remote ip valve testremoteipvalve remote addr and host tracker valve remoteaddrandhosttrackervalve valve base valvebase string remote addr remoteaddr string remote host remotehost string scheme secure server port serverport string get remote addr getremoteaddr remote addr remoteaddr string get remote host getremotehost remote host remotehost string get scheme getscheme scheme get server port getserverport server port serverport is secure issecure secure override invoke request request response response io exception ioexception servlet exception servletexception remote host remotehost request get remote host getremotehost remote addr remoteaddr request get remote addr getremoteaddr scheme request get scheme getscheme secure request is secure issecure server port serverport request get server port getserverport mock request mockrequest request override set attribute setattribute string object get coyote request getcoyoterequest get attributes getattributes override object get attribute getattribute string get coyote request getcoyoterequest get attribute getattribute test test list to comma delimited string testlisttocommadelimitedstring list string elements arrays as list aslist element element element string actual remote ip valve remoteipvalve list to comma delimited string listtocommadelimitedstring elements assert equals assertequals element element element actual test test list to comma delimited string empty list testlisttocommadelimitedstringemptylist list string elements array list arraylist string string actual remote ip valve remoteipvalve list to comma delimited string listtocommadelimitedstring elements assert equals assertequals actual test test comma delimited list to string array null list testcommadelimitedlisttostringarraynulllist string actual remote ip valve remoteipvalve list to comma delimited string listtocommadelimitedstring assert equals assertequals actual test test invoke allowed remote addr with null remote ip header testinvokeallowedremoteaddrwithnullremoteipheader exception prepare remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve set internal proxies setinternalproxies remote ip valve remoteipvalve set trusted proxies settrustedproxies proxy proxy proxy remote ip valve remoteipvalve set remote ip header setremoteipheader forwarded remote ip valve remoteipvalve set proxies header setproxiesheader forwarded remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote ip valve remoteipvalve set next setnext remote addr and host tracker valve remoteaddrandhosttrackervalve request request mock request mockrequest request set coyote request setcoyoterequest org apache coyote request request set remote addr setremoteaddr request set remote host setremotehost remote host original test remote ip valve remoteipvalve invoke request verify string actual forwarded for actualxforwardedfor request get header getheader forwarded assert null assertnull forwarded actual forwarded for actualxforwardedfor string actual forwarded by actualxforwardedby request get header getheader forwarded assert null assertnull forwarded actual forwarded by actualxforwardedby string actual remote addr actualremoteaddr remote addr and host tracker valve remoteaddrandhosttrackervalve get remote addr getremoteaddr assert equals assertequals remote addr remoteaddr actual remote addr actualremoteaddr string actual remote host actualremotehost remote addr and host tracker valve remoteaddrandhosttrackervalve get remote host getremotehost assert equals assertequals remote host remotehost remote host original actual remote host actualremotehost string actual post invoke remote addr actualpostinvokeremoteaddr request get remote addr getremoteaddr assert equals assertequals post invoke postinvoke remote addr remoteaddr actual post invoke remote addr actualpostinvokeremoteaddr string actual post invoke remote host actualpostinvokeremotehost request get remote host getremotehost assert equals assertequals post invoke postinvoke remote addr remoteaddr remote host original actual post invoke remote host actualpostinvokeremotehost test test invoke all proxies are trusted testinvokeallproxiesaretrusted exception prepare remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve set internal proxies setinternalproxies remote ip valve remoteipvalve set trusted proxies settrustedproxies proxy proxy proxy remote ip valve remoteipvalve set remote ip header setremoteipheader forwarded remote ip valve remoteipvalve set proxies header setproxiesheader forwarded remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote ip valve remoteipvalve set next setnext remote addr and host tracker valve remoteaddrandhosttrackervalve request request mock request mockrequest request set coyote request setcoyoterequest org apache coyote request request set remote addr setremoteaddr request set remote host setremotehost remote host original request get coyote request getcoyoterequest get mime headers getmimeheaders add value addvalue forwarded set string setstring proxy proxy test remote ip valve remoteipvalve invoke request verify string actual forwarded for actualxforwardedfor request get header getheader forwarded assert null assertnull proxies trusted forwarded actual forwarded for actualxforwardedfor string actual forwarded by actualxforwardedby request get header getheader forwarded assert equals assertequals proxies trusted forwarded proxy proxy actual forwarded by actualxforwardedby string actual remote addr actualremoteaddr remote addr and host tracker valve remoteaddrandhosttrackervalve get remote addr getremoteaddr assert equals assertequals remote addr remoteaddr actual remote addr actualremoteaddr string actual remote host actualremotehost remote addr and host tracker valve remoteaddrandhosttrackervalve get remote host getremotehost assert equals assertequals remote host remotehost actual remote host actualremotehost string actual post invoke remote addr actualpostinvokeremoteaddr request get remote addr getremoteaddr assert equals assertequals post invoke postinvoke remote addr remoteaddr actual post invoke remote addr actualpostinvokeremoteaddr string actual post invoke remote host actualpostinvokeremotehost request get remote host getremotehost assert equals assertequals post invoke postinvoke remote addr remoteaddr remote host original actual post invoke remote host actualpostinvokeremotehost test test invoke all proxies are trusted or internal testinvokeallproxiesaretrustedorinternal exception prepare remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve set internal proxies setinternalproxies remote ip valve remoteipvalve set trusted proxies settrustedproxies proxy proxy proxy remote ip valve remoteipvalve set remote ip header setremoteipheader forwarded remote ip valve remoteipvalve set proxies header setproxiesheader forwarded remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote ip valve remoteipvalve set next setnext remote addr and host tracker valve remoteaddrandhosttrackervalve request request mock request mockrequest request set coyote request setcoyoterequest org apache coyote request request set remote addr setremoteaddr request set remote host setremotehost remote host original request get coyote request getcoyoterequest get mime headers getmimeheaders add value addvalue forwarded set string setstring proxy proxy test remote ip valve remoteipvalve invoke request verify string actual forwarded for actualxforwardedfor request get header getheader forwarded assert null assertnull proxies trusted forwarded actual forwarded for actualxforwardedfor string actual forwarded by actualxforwardedby request get header getheader forwarded assert equals assertequals proxies trusted forwarded proxy proxy actual forwarded by actualxforwardedby string actual remote addr actualremoteaddr remote addr and host tracker valve remoteaddrandhosttrackervalve get remote addr getremoteaddr assert equals assertequals remote addr remoteaddr actual remote addr actualremoteaddr string actual remote host actualremotehost remote addr and host tracker valve remoteaddrandhosttrackervalve get remote host getremotehost assert equals assertequals remote host remotehost actual remote host actualremotehost string actual post invoke remote addr actualpostinvokeremoteaddr request get remote addr getremoteaddr assert equals assertequals post invoke postinvoke remote addr remoteaddr actual post invoke remote addr actualpostinvokeremoteaddr string actual post invoke remote host actualpostinvokeremotehost request get remote host getremotehost assert equals assertequals post invoke postinvoke remote addr remoteaddr remote host original actual post invoke remote host actualpostinvokeremotehost test test invoke all proxies are internal testinvokeallproxiesareinternal exception prepare remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve set internal proxies setinternalproxies remote ip valve remoteipvalve set trusted proxies settrustedproxies proxy proxy proxy remote ip valve remoteipvalve set remote ip header setremoteipheader forwarded remote ip valve remoteipvalve set proxies header setproxiesheader forwarded remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote ip valve remoteipvalve set next setnext remote addr and host tracker valve remoteaddrandhosttrackervalve request request mock request mockrequest request set coyote request setcoyoterequest org apache coyote request request set remote addr setremoteaddr request set remote host setremotehost remote host original request get coyote request getcoyoterequest get mime headers getmimeheaders add value addvalue forwarded set string setstring test remote ip valve remoteipvalve invoke request verify string actual forwarded for actualxforwardedfor request get header getheader forwarded assert null assertnull proxies internal forwarded actual forwarded for actualxforwardedfor string actual forwarded by actualxforwardedby request get header getheader forwarded assert null assertnull proxies internal forwarded actual forwarded by actualxforwardedby string actual remote addr actualremoteaddr remote addr and host tracker valve remoteaddrandhosttrackervalve get remote addr getremoteaddr assert equals assertequals remote addr remoteaddr actual remote addr actualremoteaddr string actual remote host actualremotehost remote addr and host tracker valve remoteaddrandhosttrackervalve get remote host getremotehost assert equals assertequals remote host remotehost actual remote host actualremotehost string actual post invoke remote addr actualpostinvokeremoteaddr request get remote addr getremoteaddr assert equals assertequals post invoke postinvoke remote addr remoteaddr actual post invoke remote addr actualpostinvokeremoteaddr string actual post invoke remote host actualpostinvokeremotehost request get remote host getremotehost assert equals assertequals post invoke postinvoke remote addr remoteaddr remote host original actual post invoke remote host actualpostinvokeremotehost test test invoke all proxies are trusted and remote addr match regexp testinvokeallproxiesaretrustedandremoteaddrmatchregexp exception prepare remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve set internal proxies setinternalproxies internal proxy remote ip valve remoteipvalve set trusted proxies settrustedproxies proxy proxy proxy remote ip valve remoteipvalve set remote ip header setremoteipheader forwarded remote ip valve remoteipvalve set proxies header setproxiesheader forwarded remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote ip valve remoteipvalve set next setnext remote addr and host tracker valve remoteaddrandhosttrackervalve request request mock request mockrequest request set coyote request setcoyoterequest org apache coyote request request set remote addr setremoteaddr request set remote host setremotehost remote host original request get coyote request getcoyoterequest get mime headers getmimeheaders add value addvalue forwarded set string setstring request get coyote request getcoyoterequest get mime headers getmimeheaders add value addvalue forwarded set string setstring proxy request get coyote request getcoyoterequest get mime headers getmimeheaders add value addvalue forwarded set string setstring proxy test remote ip valve remoteipvalve invoke request verify string actual forwarded for actualxforwardedfor request get header getheader forwarded assert null assertnull proxies trusted forwarded actual forwarded for actualxforwardedfor string actual forwarded by actualxforwardedby request get header getheader forwarded assert equals assertequals proxies trusted forwarded proxy proxy actual forwarded by actualxforwardedby string actual remote addr actualremoteaddr remote addr and host tracker valve remoteaddrandhosttrackervalve get remote addr getremoteaddr assert equals assertequals remote addr remoteaddr actual remote addr actualremoteaddr string actual remote host actualremotehost remote addr and host tracker valve remoteaddrandhosttrackervalve get remote host getremotehost assert equals assertequals remote host remotehost actual remote host actualremotehost string actual post invoke remote addr actualpostinvokeremoteaddr request get remote addr getremoteaddr assert equals assertequals post invoke postinvoke remote addr remoteaddr actual post invoke remote addr actualpostinvokeremoteaddr string actual post invoke remote host actualpostinvokeremotehost request get remote host getremotehost assert equals assertequals post invoke postinvoke remote addr remoteaddr remote host original actual post invoke remote host actualpostinvokeremotehost test test invoke xforwarded proto says https for incoming http request testinvokexforwardedprotosayshttpsforincominghttprequest exception prepare remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve set remote ip header setremoteipheader forwarded remote ip valve remoteipvalve set protocol header setprotocolheader forwarded proto remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote ip valve remoteipvalve set next setnext remote addr and host tracker valve remoteaddrandhosttrackervalve request request mock request mockrequest request set coyote request setcoyoterequest org apache coyote request client request set remote addr setremoteaddr request set remote host setremotehost request get coyote request getcoyoterequest get mime headers getmimeheaders add value addvalue forwarded set string setstring protocol request get coyote request getcoyoterequest get mime headers getmimeheaders add value addvalue forwarded proto set string setstring https request set secure setsecure request set server port setserverport request get coyote request getcoyoterequest scheme set string setstring http test remote ip valve remoteipvalve invoke request verify client string actual forwarded for actualxforwardedfor request get header getheader forwarded assert null assertnull int ermediate intermediate trusted proxy forwarded actual forwarded for actualxforwardedfor string actual forwarded by actualxforwardedby request get header getheader forwarded assert null assertnull int ermediate intermediate trusted proxy actual forwarded by actualxforwardedby string actual remote addr actualremoteaddr remote addr and host tracker valve remoteaddrandhosttrackervalve get remote addr getremoteaddr assert equals assertequals remote addr remoteaddr actual remote addr actualremoteaddr string actual remote host actualremotehost remote addr and host tracker valve remoteaddrandhosttrackervalve get remote host getremotehost assert equals assertequals remote host remotehost actual remote host actualremotehost string actual post invoke remote addr actualpostinvokeremoteaddr request get remote addr getremoteaddr assert equals assertequals post invoke postinvoke remote addr remoteaddr actual post invoke remote addr actualpostinvokeremoteaddr string actual post invoke remote host actualpostinvokeremotehost request get remote host getremotehost assert equals assertequals post invoke postinvoke remote addr remoteaddr actual post invoke remote host actualpostinvokeremotehost protocol string actual scheme actualscheme remote addr and host tracker valve remoteaddrandhosttrackervalve get scheme getscheme assert equals assertequals forwarded proto https https actual scheme actualscheme actual server port actualserverport remote addr and host tracker valve remoteaddrandhosttrackervalve get server port getserverport assert equals assertequals forwarded proto https actual server port actualserverport actual secure actualsecure remote addr and host tracker valve remoteaddrandhosttrackervalve is secure issecure assert true asserttrue forwarded proto https actual secure actualsecure actual post invoke secure actualpostinvokesecure request is secure issecure assert false assertfalse post invoke postinvoke secure actual post invoke secure actualpostinvokesecure actual post invoke server port actualpostinvokeserverport request get server port getserverport assert equals assertequals post invoke postinvoke server port serverport actual post invoke server port actualpostinvokeserverport string actual post invoke scheme actualpostinvokescheme request get scheme getscheme assert equals assertequals post invoke postinvoke scheme http actual post invoke scheme actualpostinvokescheme test test invoke xforwarded proto is null for incoming http request testinvokexforwardedprotoisnullforincominghttprequest exception prepare remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve set remote ip header setremoteipheader forwarded remote ip valve remoteipvalve set protocol header setprotocolheader forwarded proto remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote ip valve remoteipvalve set next setnext remote addr and host tracker valve remoteaddrandhosttrackervalve request request mock request mockrequest request set coyote request setcoyoterequest org apache coyote request client request set remote addr setremoteaddr request set remote host setremotehost request get coyote request getcoyoterequest get mime headers getmimeheaders add value addvalue forwarded set string setstring protocol forwarded proto request set secure setsecure request set server port setserverport request get coyote request getcoyoterequest scheme set string setstring http test remote ip valve remoteipvalve invoke request verify client string actual forwarded for actualxforwardedfor request get header getheader forwarded assert null assertnull int ermediate intermediate trusted proxy forwarded actual forwarded for actualxforwardedfor string actual forwarded by actualxforwardedby request get header getheader forwarded assert null assertnull int ermediate intermediate trusted proxy actual forwarded by actualxforwardedby string actual remote addr actualremoteaddr remote addr and host tracker valve remoteaddrandhosttrackervalve get remote addr getremoteaddr assert equals assertequals remote addr remoteaddr actual remote addr actualremoteaddr string actual remote host actualremotehost remote addr and host tracker valve remoteaddrandhosttrackervalve get remote host getremotehost assert equals assertequals remote host remotehost actual remote host actualremotehost string actual post invoke remote addr actualpostinvokeremoteaddr request get remote addr getremoteaddr assert equals assertequals post invoke postinvoke remote addr remoteaddr actual post invoke remote addr actualpostinvokeremoteaddr string actual post invoke remote host actualpostinvokeremotehost request get remote host getremotehost assert equals assertequals post invoke postinvoke remote addr remoteaddr actual post invoke remote host actualpostinvokeremotehost protocol string actual scheme actualscheme remote addr and host tracker valve remoteaddrandhosttrackervalve get scheme getscheme assert equals assertequals forwarded proto http actual scheme actualscheme actual server port actualserverport remote addr and host tracker valve remoteaddrandhosttrackervalve get server port getserverport assert equals assertequals forwarded proto actual server port actualserverport actual secure actualsecure remote addr and host tracker valve remoteaddrandhosttrackervalve is secure issecure assert false assertfalse forwarded proto actual secure actualsecure actual post invoke secure actualpostinvokesecure request is secure issecure assert false assertfalse post invoke postinvoke secure actual post invoke secure actualpostinvokesecure actual post invoke server port actualpostinvokeserverport request get server port getserverport assert equals assertequals post invoke postinvoke server port serverport actual post invoke server port actualpostinvokeserverport string actual post invoke scheme actualpostinvokescheme request get scheme getscheme assert equals assertequals post invoke postinvoke scheme http actual post invoke scheme actualpostinvokescheme test test invoke xforwarded proto says http for incoming https request testinvokexforwardedprotosayshttpforincominghttpsrequest exception prepare remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve set remote ip header setremoteipheader forwarded remote ip valve remoteipvalve set protocol header setprotocolheader forwarded proto remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote ip valve remoteipvalve set next setnext remote addr and host tracker valve remoteaddrandhosttrackervalve request request mock request mockrequest request set coyote request setcoyoterequest org apache coyote request client request set remote addr setremoteaddr request set remote host setremotehost request get coyote request getcoyoterequest get mime headers getmimeheaders add value addvalue forwarded set string setstring protocol request get coyote request getcoyoterequest get mime headers getmimeheaders add value addvalue forwarded proto set string setstring http request set secure setsecure request set server port setserverport request get coyote request getcoyoterequest scheme set string setstring https test remote ip valve remoteipvalve invoke request verify client string actual forwarded for actualxforwardedfor request get header getheader forwarded assert null assertnull int ermediate intermediate trusted proxy forwarded actual forwarded for actualxforwardedfor string actual forwarded by actualxforwardedby request get header getheader forwarded assert null assertnull int ermediate intermediate trusted proxy actual forwarded by actualxforwardedby string actual remote addr actualremoteaddr remote addr and host tracker valve remoteaddrandhosttrackervalve get remote addr getremoteaddr assert equals assertequals remote addr remoteaddr actual remote addr actualremoteaddr string actual remote host actualremotehost remote addr and host tracker valve remoteaddrandhosttrackervalve get remote host getremotehost assert equals assertequals remote host remotehost actual remote host actualremotehost string actual post invoke remote addr actualpostinvokeremoteaddr request get remote addr getremoteaddr assert equals assertequals post invoke postinvoke remote addr remoteaddr actual post invoke remote addr actualpostinvokeremoteaddr string actual post invoke remote host actualpostinvokeremotehost request get remote host getremotehost assert equals assertequals post invoke postinvoke remote addr remoteaddr actual post invoke remote host actualpostinvokeremotehost protocol string actual scheme actualscheme remote addr and host tracker valve remoteaddrandhosttrackervalve get scheme getscheme assert equals assertequals forwarded proto http http actual scheme actualscheme actual server port actualserverport remote addr and host tracker valve remoteaddrandhosttrackervalve get server port getserverport assert equals assertequals forwarded proto http actual server port actualserverport actual secure actualsecure remote addr and host tracker valve remoteaddrandhosttrackervalve is secure issecure assert false assertfalse forwarded proto http actual secure actualsecure actual post invoke secure actualpostinvokesecure request is secure issecure assert true asserttrue post invoke postinvoke secure actual post invoke secure actualpostinvokesecure actual post invoke server port actualpostinvokeserverport request get server port getserverport assert equals assertequals post invoke postinvoke server port serverport actual post invoke server port actualpostinvokeserverport string actual post invoke scheme actualpostinvokescheme request get scheme getscheme assert equals assertequals post invoke postinvoke scheme https actual post invoke scheme actualpostinvokescheme test test invoke xforwarded proto is null for incoming https request testinvokexforwardedprotoisnullforincominghttpsrequest exception prepare remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve set remote ip header setremoteipheader forwarded remote ip valve remoteipvalve set protocol header setprotocolheader forwarded proto remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote ip valve remoteipvalve set next setnext remote addr and host tracker valve remoteaddrandhosttrackervalve request request mock request mockrequest request set coyote request setcoyoterequest org apache coyote request client request set remote addr setremoteaddr request set remote host setremotehost request get coyote request getcoyoterequest get mime headers getmimeheaders add value addvalue forwarded set string setstring protocol don declare forwarded proto request set secure setsecure request set server port setserverport request get coyote request getcoyoterequest scheme set string setstring https test remote ip valve remoteipvalve invoke request verify client string actual forwarded for actualxforwardedfor request get header getheader forwarded assert null assertnull int ermediate intermediate trusted proxy forwarded actual forwarded for actualxforwardedfor string actual forwarded by actualxforwardedby request get header getheader forwarded assert null assertnull int ermediate intermediate trusted proxy actual forwarded by actualxforwardedby string actual remote addr actualremoteaddr remote addr and host tracker valve remoteaddrandhosttrackervalve get remote addr getremoteaddr assert equals assertequals remote addr remoteaddr actual remote addr actualremoteaddr string actual remote host actualremotehost remote addr and host tracker valve remoteaddrandhosttrackervalve get remote host getremotehost assert equals assertequals remote host remotehost actual remote host actualremotehost string actual post invoke remote addr actualpostinvokeremoteaddr request get remote addr getremoteaddr assert equals assertequals post invoke postinvoke remote addr remoteaddr actual post invoke remote addr actualpostinvokeremoteaddr string actual post invoke remote host actualpostinvokeremotehost request get remote host getremotehost assert equals assertequals post invoke postinvoke remote addr remoteaddr actual post invoke remote host actualpostinvokeremotehost protocol string actual scheme actualscheme remote addr and host tracker valve remoteaddrandhosttrackervalve get scheme getscheme assert equals assertequals forwarded proto https actual scheme actualscheme actual server port actualserverport remote addr and host tracker valve remoteaddrandhosttrackervalve get server port getserverport assert equals assertequals forwarded proto actual server port actualserverport actual secure actualsecure remote addr and host tracker valve remoteaddrandhosttrackervalve is secure issecure assert true asserttrue forwarded proto actual secure actualsecure actual post invoke secure actualpostinvokesecure request is secure issecure assert true asserttrue post invoke postinvoke secure actual post invoke secure actualpostinvokesecure actual post invoke server port actualpostinvokeserverport request get server port getserverport assert equals assertequals post invoke postinvoke server port serverport actual post invoke server port actualpostinvokeserverport string actual post invoke scheme actualpostinvokescheme request get scheme getscheme assert equals assertequals post invoke postinvoke scheme https actual post invoke scheme actualpostinvokescheme test test invoke not allowed remote addr testinvokenotallowedremoteaddr exception prepare remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve set internal proxies setinternalproxies remote ip valve remoteipvalve set trusted proxies settrustedproxies proxy proxy proxy remote ip valve remoteipvalve set remote ip header setremoteipheader forwarded remote ip valve remoteipvalve set proxies header setproxiesheader forwarded remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote ip valve remoteipvalve set next setnext remote addr and host tracker valve remoteaddrandhosttrackervalve request request mock request mockrequest request set coyote request setcoyoterequest org apache coyote request request set remote addr setremoteaddr allowed internal proxy request set remote host setremotehost allowed internal proxy host request get coyote request getcoyoterequest get mime headers getmimeheaders add value addvalue forwarded set string setstring proxy proxy test remote ip valve remoteipvalve invoke request verify string actual forwarded for actualxforwardedfor request get header getheader forwarded assert equals assertequals forwarded unchanged proxy proxy actual forwarded for actualxforwardedfor string actual forwarded by actualxforwardedby request get header getheader forwarded assert null assertnull forwarded actual forwarded by actualxforwardedby string actual remote addr actualremoteaddr remote addr and host tracker valve remoteaddrandhosttrackervalve get remote addr getremoteaddr assert equals assertequals remote addr remoteaddr allowed internal proxy actual remote addr actualremoteaddr string actual remote host actualremotehost remote addr and host tracker valve remoteaddrandhosttrackervalve get remote host getremotehost assert equals assertequals remote host remotehost allowed internal proxy host actual remote host actualremotehost string actual post invoke remote addr actualpostinvokeremoteaddr request get remote addr getremoteaddr assert equals assertequals post invoke postinvoke remote addr remoteaddr allowed internal proxy actual post invoke remote addr actualpostinvokeremoteaddr string actual post invoke remote host actualpostinvokeremotehost request get remote host getremotehost assert equals assertequals post invoke postinvoke remote addr remoteaddr allowed internal proxy host actual post invoke remote host actualpostinvokeremotehost test test invoke untrusted proxy in the chain testinvokeuntrustedproxyinthechain exception prepare remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve set internal proxies setinternalproxies remote ip valve remoteipvalve set trusted proxies settrustedproxies proxy proxy proxy remote ip valve remoteipvalve set remote ip header setremoteipheader forwarded remote ip valve remoteipvalve set proxies header setproxiesheader forwarded remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote ip valve remoteipvalve set next setnext remote addr and host tracker valve remoteaddrandhosttrackervalve request request mock request mockrequest request set coyote request setcoyoterequest org apache coyote request request set remote addr setremoteaddr request set remote host setremotehost remote host original request get coyote request getcoyoterequest get mime headers getmimeheaders add value addvalue forwarded set string setstring proxy untrusted proxy proxy test remote ip valve remoteipvalve invoke request verify string actual forwarded for actualxforwardedfor request get header getheader forwarded assert equals assertequals host untrusted proxy forwarded proxy actual forwarded for actualxforwardedfor string actual forwarded by actualxforwardedby request get header getheader forwarded assert equals assertequals host untrusted proxy forwarded proxy actual forwarded by actualxforwardedby string actual remote addr actualremoteaddr remote addr and host tracker valve remoteaddrandhosttrackervalve get remote addr getremoteaddr assert equals assertequals remote addr remoteaddr untrusted proxy actual remote addr actualremoteaddr string actual remote host actualremotehost remote addr and host tracker valve remoteaddrandhosttrackervalve get remote host getremotehost assert equals assertequals remote host remotehost untrusted proxy actual remote host actualremotehost string actual post invoke remote addr actualpostinvokeremoteaddr request get remote addr getremoteaddr assert equals assertequals post invoke postinvoke remote addr remoteaddr actual post invoke remote addr actualpostinvokeremoteaddr string actual post invoke remote host actualpostinvokeremotehost request get remote host getremotehost assert equals assertequals post invoke postinvoke remote addr remoteaddr remote host original actual post invoke remote host actualpostinvokeremotehost test test comma delimited list to string array testcommadelimitedlisttostringarray string actual remote ip valve remoteipvalve comma delimited list to string array commadelimitedlisttostringarray element element element string expected string element element element assert array equals assertarrayequals expected actual test test comma delimited list to string array mixed space chars testcommadelimitedlisttostringarraymixedspacechars string actual remote ip valve remoteipvalve comma delimited list to string array commadelimitedlisttostringarray element element element string expected string element element element assert array equals assertarrayequals expected actual test test request attributes for access log testrequestattributesforaccesslog exception prepare remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve remote ip valve remoteipvalve set remote ip header setremoteipheader forwarded remote ip valve remoteipvalve set protocol header setprotocolheader forwarded proto remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote addr and host tracker valve remoteaddrandhosttrackervalve remote ip valve remoteipvalve set next setnext remote addr and host tracker valve remoteaddrandhosttrackervalve request request mock request mockrequest request set coyote request setcoyoterequest org apache coyote request client request set remote addr setremoteaddr request set remote host setremotehost request get coyote request getcoyoterequest get mime headers getmimeheaders add value addvalue forwarded set string setstring protocol request set server port setserverport request get coyote request getcoyoterequest scheme set string setstring http test remote ip valve remoteipvalve invoke request verify assert equals assertequals org apache catalina access log accesslog server port serverport integer value of valueof request get attribute getattribute access log accesslog server port attribute assert equals assertequals org apache catalina access log accesslog remote addr remoteaddr request get attribute getattribute access log accesslog remote add r addr attribute assert equals assertequals org apache catalina access log accesslog remote host remotehost request get attribute getattribute access log accesslog remote host attribute assert array equals assertarrayequals string expected string actual expected assert null assertnull actual assert not null assertnotnull actual assert equals assertequals expected length actual length list string array list arraylist string add all addall arrays as list aslist expected list string array list arraylist string add all addall arrays as list aslist actual string entry assert true asserttrue remove entry assert true asserttrue is empty isempty