licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina tribes transport nio java eof exception eofexception java io exception ioexception java net inet socket address inetsocketaddress java nio byte buffer bytebuffer java nio channels data gram channel datagramchannel java nio channels selection key selectionkey java nio channels selector java nio channels socket channel socketchannel java util arrays org apache catalina tribes remote process exception remoteprocessexception org apache catalina tribes x byte buffer xbytebuffer org apache catalina tribes transport abstract sender abstractsender org apache juli logging log org apache juli logging log factory logfactory thread safe thread time machine handled process method connected connect connected connected set message setmessage ready write ready write write ready write ready read ready read read ready read transfer complete transfer complete connected author filip hanik version nio sender niosender abstract sender abstractsender log log log factory logfactory get log getlog nio sender niosender selector selector socket channel socketchannel socket channel socketchannel data gram channel datagramchannel data channel datachannel variables byte buffer bytebuffer read buf readbuf byte buffer bytebuffer writebuf current x byte buffer xbytebuffer ackbuf x byte buffer xbytebuffer remaining complete connecting nio sender niosender machine send data param key selection key selectionkey io exception ioexception process selection key selectionkey key wait for ack waitforack io exception ioexception ops key ready ops readyops key int erest ops interestops key int erest ops interestops ops disconnect called is connected isconnected connecting io exception ioexception sender disconnected selection key key is valid isvalid io exception ioexception key valid can celled cancelled key is connect able isconnectable socket channel socketchannel finish connect finishconnect complete connect completeconnect current key int erest ops interestops key int erest ops interestops selection key selectionkey write wait connection finish key int erest ops interestops key int erest ops interestops selection key selectionkey connect key is writable iswritable write complete writecomplete write key write complete writecomplete completed read ack wait for ack waitforack register read ack key int erest ops interestops key int erest ops interestops selection key selectionkey read ready set message setmessage reregister write int erest interest health check verify disconnected socket don register read wait for ack waitforack over head overhead read key set request count setrequestcount get request count getrequestcount complete write key int erest ops interestops key int erest ops interestops selection key selectionkey write key is readable isreadable read complete readcomplete read key read complete readcomplete set request count setrequestcount get request count getrequestcount key int erest ops interestops key int erest ops interestops selection key selectionkey read unknown happen log warn data unknown ready ops readyops ops io exception ioexception data unknown ready ops readyops ops configure socket configuresocket io exception ioexception socket channel socketchannel socket channel socketchannel configure blocking configureblocking socket channel socketchannel socket set send buffer size setsendbuffersize get tx buf size gettxbufsize socket channel socketchannel socket set receive buffer size setreceivebuffersize get rx buf size getrxbufsize socket channel socketchannel socket set so timeout setsotimeout get timeout gettimeout socket channel socketchannel socket set so linger setsolinger get so linger on getsolingeron get so linger on getsolingeron get so linger time getsolingertime socket channel socketchannel socket set tcp no delay settcpnodelay get tcp no delay gettcpnodelay socket channel socketchannel socket set keep alive setkeepalive get so keep alive getsokeepalive socket channel socketchannel socket set reuse address setreuseaddress get so reuse address getsoreuseaddress socket channel socketchannel socket setoobinline get oo inline getoobinline socket channel socketchannel socket set so linger setsolinger get so linger on getsolingeron get so linger time getsolingertime socket channel socketchannel socket set traffic class settrafficclass get so traffic class getsotrafficclass data channel datachannel data channel datachannel configure blocking configureblocking data channel datachannel socket set send buffer size setsendbuffersize get udp tx buf size getudptxbufsize data channel datachannel socket set receive buffer size setreceivebuffersize get udp rx buf size getudprxbufsize data channel datachannel socket set so timeout setsotimeout get timeout gettimeout data channel datachannel socket set reuse address setreuseaddress get so reuse address getsoreuseaddress data channel datachannel socket set traffic class settrafficclass get so traffic class getsotrafficclass complete connect completeconnect connected register writing set connected setconnected connecting set request count setrequestcount set connect time setconnecttime system current time millis currenttimemillis read selection key selectionkey key io exception ioexception message current read is udp based isudpbased data channel datachannel read read buf readbuf socket channel socketchannel read read buf readbuf stream read io exception ioexception unable receive ack message eof socket channel reached data read read read buf readbuf flip ackbuf append read buf readbuf read read buf readbuf clear ackbuf does package exist doespackageexist ackcmd ackbuf extract data package extractdatapackage get bytes getbytes ack arrays equals ackcmd org apache catalina tribes transport constants ack data fack arrays equals ackcmd org apache catalina tribes transport constants fail ack data fack get throw on failed ack getthrowonfailedack remote process exception remoteprocessexception received failed ack org apache catalina tribes transport constants fail ack data ack fack write selection key selectionkey key io exception ioexception is connected isconnected socket channel socketchannel data channel datachannel io exception ioexception nio sender niosender connected occur current remaining written starting protect buffer overwrite bytes written byteswritten is udp based isudpbased data channel datachannel write writebuf socket channel socketchannel write writebuf bytes written byteswritten eof exception eofexception remaining bytes written byteswritten reset position counter remaining remaining remaining message send complete connect blocking operation io exception ioexception todo implement org apache catalina tribes transport i data sender idatasender method override connect io exception ioexception connecting is connected isconnected connecting is connected isconnected io exception ioexception nio sender niosender connected read buf readbuf read buf readbuf get read buffer getreadbuffer read buf readbuf clear writebuf writebuf get write buffer getwritebuffer writebuf clear is udp based isudpbased inet socket address inetsocketaddress daddr inet socket address inetsocketaddress get address getaddress get udp port getudpport data channel datachannel io exception ioexception data gram datagram channel established connection progress data channel datachannel data gram channel datagramchannel open configure socket configuresocket data channel datachannel connect daddr complete connect completeconnect data channel datachannel register get selector getselector selection key selectionkey write inet socket address inetsocketaddress add r addr inet socket address inetsocketaddress get address getaddress get port getport socket channel socketchannel io exception ioexception socket channel established connection progress socket channel socketchannel socket channel socketchannel open configure socket configuresocket socket channel socketchannel connect add r addr complete connect completeconnect socket channel socketchannel register get selector getselector selection key selectionkey write socket channel socketchannel register get selector getselector selection key selectionkey connect disconnect todo implement org apache catalina tribes transport i data sender idatasender method override disconnect connecting set connected setconnected socket channel socketchannel socket channel socketchannel socket close exception socket close exception socket channel socketchannel close exception socket channel socketchannel data channel datachannel data channel datachannel socket close exception socket close exception data channel datachannel close exception data channel datachannel exception log error unable disconnect nio sender niosender msg get message getmessage log is debug enabled isdebugenabled log debug unable disconnect nio sender niosender msg get message getmessage reset is connected isconnected read buf readbuf read buf readbuf get read buffer getreadbuffer read buf readbuf read buf readbuf clear writebuf writebuf clear current ackbuf clear remaining complete set attempt setattempt set udp based setudpbased byte buffer bytebuffer get read buffer getreadbuffer get buffer getbuffer get rx buf size getrxbufsize byte buffer bytebuffer get write buffer getwritebuffer get buffer getbuffer get tx buf size gettxbufsize byte buffer bytebuffer get buffer getbuffer size get direct buffer getdirectbuffer byte buffer bytebuffer all ocate direct allocatedirect size byte buffer bytebuffer all ocate allocate size send message sendmessage param data channel message channelmessage io exception ioexception todo implement org apache catalina tribes transport i data sender idatasender method set message setmessage data io exception ioexception set message setmessage data data length set message setmessage data offset length io exception ioexception data current data remaining length ackbuf clear writebuf writebuf clear writebuf get buffer getbuffer length writebuf capacity length writebuf get buffer getbuffer length todo byte buffer bytebuffer wrap avoid copying data writebuf data offset length writebuf rewind limit don write wanted data writebuf limit length writebuf flip is connected isconnected is udp based isudpbased data channel datachannel register get selector getselector selection key selectionkey write socket channel socketchannel register get selector getselector selection key selectionkey write get message getmessage current is complete iscomplete complete selector get selector getselector selector set selector setselector selector selector selector selector set complete setcomplete complete complete complete