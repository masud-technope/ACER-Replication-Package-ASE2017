licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina realm java security principal java sql connection java sql driver java sql prepared statement preparedstatement java sql result set resultset java sql sql exception sqlexception java util array list arraylist java util properties org apache catalina lifecycle exception lifecycleexception org apache tomcat util exception utils exceptionutils implementation realm works jdbc supported database jdbc realm jdbcrealm how to howto details database configuration options realm implementation supports connection pooling doesn require synch ronisation synchronisation code authenticate code code get password getpassword code code roles code code get principal getprincipal code ugly connection logic code data source realm datasourcerealm code author craig mc clanahan mcclanahan author carson mc don ald mcdonald author ignacio ortega jdbc realm jdbcrealm realm base realmbase instance variables connection username connect database string connection name connectionname connection url connect database string connection password connectionpassword connection url connect database string connectionurl connection database connection db connection dbconnection instance jdbc driver connection factory driver driver jdbc driver string driver name drivername descriptive realm implementation string info org apache catalina realm jdbc realm jdbcrealm descriptive realm implementation string jdbc realm jdbcrealm prepared statement preparedstatement auth enticating authenticating users prepared statement preparedstatement prepared credentials preparedcredentials prepared statement preparedstatement identifying roles user prepared statement preparedstatement prepared roles preparedroles column user role table names role string role name col rolenamecol column user table holds user credentials string user cred col usercredcol column user table holds user string user name col usernamecol table holds relation user roles string user role table userroletable table holds user data string user table usertable properties username connect database string get connection name getconnectionname connection name connectionname username connect database param connection name connectionname username set connection name setconnectionname string connection name connectionname connection name connectionname connection name connectionname password connect database string get connection password getconnectionpassword connection password connectionpassword password connect database param connection password connectionpassword user password set connection password setconnectionpassword string connection password connectionpassword connection password connectionpassword connection password connectionpassword url connect database string getconnectionurl connectionurl url connect database param connectionurl connection url setconnectionurl string connectionurl connectionurl connectionurl jdbc driver string get driver name getdrivername driver name drivername jdbc driver param driver name drivername driver set driver name setdrivername string driver name drivername driver name drivername driver name drivername column user role table names role string get role name col getrolenamecol role name col rolenamecol column user role table names role param role name col rolenamecol column set role name col setrolenamecol string role name col rolenamecol role name col rolenamecol role name col rolenamecol column user table holds user credentials string get user cred col getusercredcol user cred col usercredcol column user table holds user credentials param user cred col usercredcol column set user cred col setusercredcol string user cred col usercredcol user cred col usercredcol user cred col usercredcol column user table holds user string get user name col getusernamecol user name col usernamecol column user table holds user param user name col usernamecol column set user name col setusernamecol string user name col usernamecol user name col usernamecol user name col usernamecol table holds relation user roles string get user role table getuserroletable user role table userroletable table holds relation user roles param user role table userroletable table set user role table setuserroletable string user role table userroletable user role table userroletable user role table userroletable table holds user data string get user table getusertable user table usertable table holds user data param user table usertable table set user table setusertable string user table usertable user table usertable user table usertable descriptive realm implementation version number format code description version code override string get info getinfo info methods principal username credentials code code errors jdbc connection executing query don authenticate event log ged logged connection closed subsequent request automatically open param username username principal param credentials password credentials auth enticating authenticating username override principal authenticate string username string credentials number number attempts connect database login attempt open database rewritten pooling support existing code signature prepared statements cached connections code sql exception sqlexception connection opened normal conditions including invalid login number of tries numberoftries number of tries numberoftries ensure open database connection open acquire principal object user principal principal authenticate db connection dbconnection username credentials principal principal sql exception sqlexception container log containerlog error get string getstring jdbc realm jdbcrealm exception db connection dbconnection close db connection dbconnection number of tries numberoftries worst scenario methods methods principal username credentials code code param db connection dbconnection database connection param username username principal param credentials password credentials auth enticating authenticating username principal authenticate connection db connection dbconnection string username string credentials authenticate don bother database username credentials container log containerlog is trace enabled istraceenabled container log containerlog trace get string getstring jdbc realm jdbcrealm authenticate failure authenticatefailure username user credentials string db credentials dbcredentials get password getpassword username db credentials dbcredentials user database w ast e waste bit time reveal user exist compare credentials comparecredentials credentials get class getclass get name getname container log containerlog is trace enabled istraceenabled container log containerlog trace get string getstring jdbc realm jdbcrealm authenticate failure authenticatefailure username validate user credentials validated compare credentials comparecredentials credentials db credentials dbcredentials validated container log containerlog is trace enabled istraceenabled container log containerlog trace get string getstring jdbc realm jdbcrealm authenticate success authenticatesuccess username container log containerlog is trace enabled istraceenabled container log containerlog trace get string getstring jdbc realm jdbcrealm authenticate failure authenticatefailure username array list arraylist string roles get roles getroles username create suitable principal user generic principal genericprincipal username credentials roles close database connection param db connection dbconnection connection closed close connection db connection dbconnection database connection closed db connection dbconnection close prepared statements prepared credentials preparedcredentials close throwable exception utils exceptionutils handle throwable handlethrowable prepared credentials preparedcredentials prepared roles preparedroles close throwable exception utils exceptionutils handle throwable handlethrowable prepared roles preparedroles close database connection log errors db connection dbconnection close sql exception sqlexception container log containerlog warn get string getstring jdbc realm jdbcrealm close db connection dbconnection prepared statement preparedstatement configured perform select required retrieve user credentials username param db connection dbconnection database connection param username username credentials retrieved exception sql exception sqlexception database error occurs prepared statement preparedstatement credentials connection db connection dbconnection string username sql exception sqlexception prepared credentials preparedcredentials string builder stringbuilder string builder stringbuilder select append user cred col usercredcol append append user table usertable append append user name col usernamecol append container log containerlog is debug enabled isdebugenabled container log containerlog debug credentials query to string tostring prepared credentials preparedcredentials db connection dbconnection prepare statement preparestatement to string tostring username prepared credentials preparedcredentials set null setnull java sql types var char varchar prepared credentials preparedcredentials set string setstring username prepared credentials preparedcredentials realm implementation override string get name getname password principal user override string get password getpassword string username user credentials string db credentials dbcredentials prepared statement preparedstatement stmt result set resultset number number attempts connect database login attempt open database rewritten pooling support existing code signature prepared statements cached connections code sql exception sqlexception connection opened normal conditions including invalid login number of tries numberoftries number of tries numberoftries ensure open database connection open stmt credentials db connection dbconnection username stmt execute query executequery db credentials dbcredentials get string getstring db connection dbconnection commit db credentials dbcredentials db credentials dbcredentials db credentials dbcredentials trim db credentials dbcredentials sql exception sqlexception container log containerlog error get string getstring jdbc realm jdbcrealm exception close sql exception sqlexception container log containerlog warn get string getstring jdbc realm jdbcrealm abnormal close result set abnormalcloseresultset close connection reopened time db connection dbconnection close db connection dbconnection number of tries numberoftries principal user override principal get principal getprincipal string username generic principal genericprincipal username get password getpassword username get roles getroles username roles gven user array list arraylist string get roles getroles string username all roles mode allrolesmode all roles mode allrolesmode strict mode is role store defined isrolestoredefined defined don spend cycles prepared statement preparedstatement stmt result set resultset number number attempts connect database login attempt open database rewritten wuth pooling support existing code signature prepared statements cached connections code sql exception sqlexception connection opened normal conditions including invalid login number of tries numberoftries number of tries numberoftries ensure open database connection open acc umulate accumulate user roles array list arraylist string role list rolelist array list arraylist string stmt roles db connection dbconnection username stmt execute query executequery string role get string getstring role role list rolelist add role trim close role list rolelist close sql exception sqlexception container log containerlog warn get string getstring jdbc realm jdbcrealm abnormal close result set abnormalcloseresultset db connection dbconnection commit sql exception sqlexception container log containerlog error get string getstring jdbc realm jdbcrealm exception db connection dbconnection close db connection dbconnection number of tries numberoftries open database connection realm exception sql exception sqlexception database error occurs connection open sql exception sqlexception database connection open db connection dbconnection db connection dbconnection instantiate database driver driver clazz for name forname driver name drivername driver driver clazz new instance newinstance throwable exception utils exceptionutils handle throwable handlethrowable sql exception sqlexception get message getmessage open connection properties props properties connection name connectionname props user connection name connectionname connection password connectionpassword props password connection password connectionpassword db connection dbconnection driver connect connectionurl props db connection dbconnection sql exception sqlexception get string getstring jdbc realm jdbcrealm open invalid url invalidurl driver name drivername connectionurl db connection dbconnection set auto commit setautocommit db connection dbconnection release connection recycle d recycled param db connection dbconnection connection released deprecated unused deprecated release connection db connection dbconnection pooling prepared statement preparedstatement configured perform select required retrieve user roles username param db connection dbconnection database connection param username username roles retrieved exception sql exception sqlexception database error occurs prepared statement preparedstatement roles connection db connection dbconnection string username sql exception sqlexception prepared roles preparedroles string builder stringbuilder string builder stringbuilder select append role name col rolenamecol append append user role table userroletable append append user name col usernamecol append prepared roles preparedroles db connection dbconnection prepare statement preparestatement to string tostring prepared roles preparedroles set string setstring username prepared roles preparedroles is role store defined isrolestoredefined user role table userroletable role name col rolenamecol lifecycle methods prepare active methods component implement requirements link org apache catalina util lifecycle base lifecyclebase start internal startinternal exception lifecycle exception lifecycleexception component detects fatal error prevents component override start internal startinternal lifecycle exception lifecycleexception startup database temp orarily temporarily unavailable open sql exception sqlexception container log containerlog error get string getstring jdbc realm jdbcrealm open start internal startinternal gracefully terminate active methods component implement requirements link org apache catalina util lifecycle base lifecyclebase stop internal stopinternal exception lifecycle exception lifecycleexception component detects fatal error reported override stop internal stopinternal lifecycle exception lifecycleexception stop internal stopinternal close open connection close db connection dbconnection