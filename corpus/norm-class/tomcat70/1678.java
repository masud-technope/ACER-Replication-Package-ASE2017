licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina tribes java byte array input stream bytearrayinputstream java byte array output stream bytearrayoutputstream java io exception ioexception java input stream inputstream java object input stream objectinputstream java object output stream objectoutputstream java serializable java nio byte buffer bytebuffer java util concurrent atomic atomic integer atomicinteger x byte buffer xbytebuffer dual functionality stores message bytes automatically buffer needed encode decode packages defined identified socket thread safe transfer start data bytes flt size bytes size data data bytes prev size data bytes tlf author filip hanik x byte buffer xbytebuffer org apache juli logging log log org apache juli logging log factory logfactory get log getlog x byte buffer xbytebuffer header bytes flt start data foo ter footer bytes tlf data variable hold data buf current length data buffer buf size bufsize flag discarding invalid packages flag append called data ins pected inspected doesn start code start data code thrown discard constructs x byte buffer xbytebuffer todo pool performance param size initial size buffer x byte buffer xbytebuffer size discard buf size discard discard x byte buffer xbytebuffer data discard data data length discard x byte buffer xbytebuffer data size discard length math max data length size buf length system arraycopy data buf data length buf size bufsize data length discard discard get length getlength buf size bufsize set length setlength size size buf length array index out of bounds exception arrayindexoutofboundsexception size larger existing buffer buf size bufsize size trim length buf size bufsize length array index out of bounds exception arrayindexoutofboundsexception trim bytes length buf size bufsize trim length buf size bufsize length reset buf size bufsize get bytes direct getbytesdirect buf returns bytes buffer exact length get bytes getbytes buf size bufsize system arraycopy buf buf size bufsize resets buffer clear buf size bufsize appends data buffer data incorrectly for matted formatted data start header returned data discarded param bytes appended param len number bytes append data appended correctly returns incorrect missing header length data append byte buffer bytebuffer len new count newcount buf size bufsize len new count newcount buf length expand new count newcount buf buf size bufsize len buf size bufsize new count newcount discard buf size bufsize start data length first index of firstindexof buf start data buf size bufsize log error discarded invalid header append new count newcount buf size bufsize new count newcount buf length expand new count newcount buf buf size bufsize buf size bufsize new count newcount append new count newcount buf size bufsize new count newcount buf length expand new count newcount x byte buffer xbytebuffer to bytes tobytes buf buf size bufsize buf size bufsize new count newcount append new count newcount buf size bufsize new count newcount buf length expand new count newcount x byte buffer xbytebuffer to bytes tobytes buf buf size bufsize buf size bufsize new count newcount append new count newcount buf size bufsize new count newcount buf length expand new count newcount x byte buffer xbytebuffer to bytes tobytes buf buf size bufsize buf size bufsize new count newcount append len length len len length len index out of bounds exception indexoutofboundsexception len new count newcount buf size bufsize len new count newcount buf length expand new count newcount system arraycopy buf buf size bufsize len buf size bufsize new count newcount discard buf size bufsize start data length first index of firstindexof buf start data buf size bufsize log error discarded invalid header expand new count newcount don change allocation str ategy strategy new buf newbuf math max buf length new count newcount system arraycopy buf new buf newbuf buf size bufsize buf new buf newbuf get capacity getcapacity buf length internal mechanism check complete exists buffer complete header compress size data foo ter footer exists buffer count packages countpackages count packages countpackages count packages countpackages cnt pos start data length start start buf size bufsize check start header x byte buffer xbytebuffer first index of firstindexof buf start start data buffer isn bytes start buf size bufsize start bytes compress flag needed count packages size bytes size to int toint buf pos total buffer hold start data length size data length pos start start data length size pos data length buf size bufsize check foo ter footer data new pos newpos first index of firstindexof buf pos data mismatch new pos newpos pos inc rease increase packet count cnt reset values start pos data length pos start start data length verify cnt method check exists buffer complete header options size data foo ter footer exists buffer does package exist doespackageexist count packages countpackages extra cts extracts message bytes exists illegal state exception illegalstateexception thrown param clear from buffer clearfrombuffer removed buffer returns actual message bytes header compress size foo ter footer included x byte buffer xbytebuffer extract data package extractdatapackage clear from buffer clearfrombuffer psize count packages countpackages psize java lang illegal state exception illegalstateexception exists x byte buffer xbytebuffer size to int toint buf start data length x byte buffer xbytebuffer xbuf buffer pool bufferpool get buffer pool getbufferpool get buffer getbuffer size xbuf set length setlength size system arraycopy buf start data length xbuf get bytes direct getbytesdirect size clear from buffer clearfrombuffer total size totalsize start data length size data length buf size bufsize buf size bufsize total size totalsize system arraycopy buf total size totalsize buf buf size bufsize xbuf channel data channeldata extract package extractpackage clear from buffer clearfrombuffer java io exception ioexception x byte buffer xbytebuffer xbuf extract data package extractdatapackage clear from buffer clearfrombuffer channel data channeldata cdata channel data channeldata get data from package getdatafrompackage xbuf cdata creates complete data param cdata message data contained full header size data foo ter footer create data package createdatapackage channel data channeldata cdata create data package createdatapackage cdata get data package getdatapackage avoid extra array creation dlength cdata get data package length getdatapackagelength length get data package length getdatapackagelength dlength data length offset system arraycopy start data data offset start data length offset start data length to bytes tobytes dlength data start data length offset cdata get data package getdatapackage data offset offset dlength system arraycopy data data offset data length offset data length data create data package createdatapackage data doff dlength buffer buf off bufoff buffer length buf off bufoff get data package length getdatapackagelength dlength array index out of bounds exception arrayindexoutofboundsexception unable create data buffer small system arraycopy start data buffer buf off bufoff start data length to bytes tobytes data length buffer buf off bufoff start data length system arraycopy data doff buffer buf off bufoff start data length dlength system arraycopy data buffer buf off bufoff start data length data length data length buffer get data package length getdatapackagelength data length datalength length header length start data length data length indicator actual data length data length datalength foo ter footer length data length length create data package createdatapackage data length get data package length getdatapackagelength data length result length create data package createdatapackage data data length result fill data package filldatapackage data doff dlength x byte buffer xbytebuffer buf pkg len pkglen get data package length getdatapackagelength dlength buf get capacity getcapacity pkg len pkglen buf expand pkg len pkglen create data package createdatapackage data doff dlength buf get bytes direct getbytesdirect buf get length getlength convert bytes param array bytes param offset int eger integer constructed bytes exception java lang array index out of bounds exception arrayindexoutofboundsexception to int toint xff xff xff xff convert bytes param array bytes param offset constructed bytes exception java lang array index out of bounds exception arrayindexoutofboundsexception to long tolong xff xff xff xff xff xff xff xff converts array param bool int eger integer array deprecated to bytes tobytes deprecated to bytes tobytes bool to bytes tobytes bool to bytes tobytes bool data offset data offset bool data converts array entry param array param offset array array entry to boolean toboolean offset offset converts int eger integer bytes param int eger integer bytes array deprecated to bytes tobytes deprecated to bytes tobytes to bytes tobytes to bytes tobytes offset offset offset offset offset converts bytes param bytes array deprecated to bytes tobytes deprecated to bytes tobytes to bytes tobytes to bytes tobytes offset offset offset offset offset offset offset offset offset string index of indexof pure bytes param src source bytes searched param src off srcoff offset source buffer param find string src matching find array first index of firstindexof src src off srcoff find result find length src length result find length src length result src off srcoff src length java lang array index out of bounds exception arrayindexoutofboundsexception src len srclen src length find len findlen find length find pos src off srcoff find pos src len srclen src pos pos pos src len srclen match bytes match src len srclen pos find len findlen assume exist find len findlen find src pos result pos src len srclen pos find len findlen matches pos result serializable deserialize data io exception ioexception class not found exception classnotfoundexception class cast exception classcastexception deserialize data data length serializable deserialize data offset length io exception ioexception class not found exception classnotfoundexception class cast exception classcastexception deserialize data offset length atomic integer atomicinteger invoke count invokecount atomic integer atomicinteger serializable deserialize data offset length class loader classloader cls io exception ioexception class not found exception classnotfoundexception class cast exception classcastexception invoke count invokecount add and get addandget object message cls cls class loader classloader data length input stream inputstream instream byte array input stream bytearrayinputstream data offset length object input stream objectinputstream stream stream cls length replication stream replicationstream instream cls object input stream objectinputstream instream message stream read object readobject instream close stream close message message serializable serializable message class cast exception classcastexception message wrong implement serializable message get class getclass get name getname serial izes serializes message cluster data param msg cluster message clustermessage serialized content array io exception ioexception serialize serializable msg io exception ioexception byte array output stream bytearrayoutputstream outs byte array output stream bytearrayoutputstream object output stream objectoutputstream object output stream objectoutputstream outs write object writeobject msg flush data outs to byte array tobytearray data set discard setdiscard discard discard discard get discard getdiscard discard