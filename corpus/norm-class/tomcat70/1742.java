licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat jdbc test java sql sql exception sqlexception java util arrays java util list java util concurrent callable java util concurrent executor service executorservice java util concurrent executors java util concurrent javax sql pooled connection pooledconnection org junit org junit test org apache tomcat jdbc test driver connection org apache tomcat jdbc test driver driver alternate username test alternateusernametest default test case defaulttestcase random system current time millis currenttimemillis next int nextint iterations test test username compare testusernamecompare exception test username testusername test username testusername allow username change allowusernamechange exception start system current time millis currenttimemillis without user withoutuser with user withuser without user withoutuser datasource set max active setmaxactive with user withuser without user withoutuser datasource set driver class name setdriverclassname driver get name getname datasource set url seturl jdbc tomcat test datasource set alternate username allowed setalternateusernameallowed allow username change allowusernamechange datasource get connection getconnection close test runner testrunner run ners runners test runner testrunner with user withuser without user withoutuser with user withuser test runner testrunner test runner testrunner foo bar datasource get pool properties getpoolproperties get username getusername datasource get pool properties getpoolproperties get password getpassword test runner testrunner test runner testrunner datasource get pool properties getpoolproperties get username getusername datasource get pool properties getpoolproperties get password getpassword run ners runners allow username change allowusernamechange run ners runners with user withuser executor service executorservice svc executors new fixed thread pool newfixedthreadpool with user withuser without user withoutuser list test result testresult svc invoke all invokeall arrays as list aslist run ners runners failures total with user withuser failures failures total iterations failures with user withuser failures total with user withuser iterations system current time millis currenttimemillis assert equals assertequals failures failures failures svc shutdown now shutdownnow datasource close system println connect calls driver connect count connectcount system println disconnect calls driver disconnect count disconnectcount system println iterations total start test test username compare again testusernamecompareagain exception test username compare testusernamecompare test test username compare not allowed testusernamecomparenotallowed exception test username testusername test result testresult iterations failures string last message lastmessage test runner testrunner callable test result testresult string username string password test result testresult result use user useuser test runner testrunner string user string pass string guser string gpass username user guser user password pass gpass pass use user useuser user override test result testresult call test result testresult test test result testresult pooled connection pooledconnection pcon iterations test iterations pcon use user useuser pooled connection pooledconnection alternate username test alternateusernametest datasource get connection getconnection username password pooled connection pooledconnection alternate username test alternateusernametest datasource get connection getconnection connection con connection pcon get connection getconnection assert true asserttrue username mismatch requested user username actual user con get username getusername con get username getusername equals username assert true asserttrue password mismatch requested password password actual password con get password getpassword con get password getpassword equals password sql exception sqlexception test failures test last message lastmessage get message getmessage print stack trace printstacktrace exception test failures test last message lastmessage get message getmessage print stack trace printstacktrace pcon pcon close exception ignore pcon result test result