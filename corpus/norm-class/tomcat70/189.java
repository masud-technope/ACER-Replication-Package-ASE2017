licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina core java i o exception ioexception java print writer printwriter java net uri java net uri syntax exception urisyntaxexception java util hash map hashmap java util linked hash map linkedhashmap java util list java util map java util concurrent executor service executorservice java util concurrent executors javax servlet async context asynccontext javax servlet async event asyncevent javax servlet async listener asynclistener javax servlet dispatcher type dispatchertype javax servlet generic servlet genericservlet javax servlet request dispatcher requestdispatcher javax servlet servlet javax servlet servlet exception servletexception javax servlet servlet request servletrequest javax servlet servlet request event servletrequestevent javax servlet servlet request listener servletrequestlistener javax servlet servlet request wrapper servletrequestwrapper javax servlet servlet response servletresponse javax servlet servlet response wrapper servletresponsewrapper javax servlet http http servlet httpservlet javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse org junit assert equals assertequals org junit assert not null assertnotnull org junit assert true asserttrue org junit org junit test org apache catalina context org apache catalina loader org apache catalina wrapper org apache catalina connector request org apache catalina connector response org apache catalina deploy error page errorpage org apache catalina startup tomcat org apache catalina startup tomcat base test tomcatbasetest org apache catalina valves tester access log valve testeraccesslogvalve org apache tomcat util buf byte chunk bytechunk org apache tomcat util buf u decoder udecoder org easymock easy mock easymock test async context impl testasynccontextimpl tomcat base test tomcatbasetest time request process threads start request time timeout thread checks timeout timeout margin timeout tests timeout string builder stringbuilder tracker reset tracker resettracker tracker string builder stringbuilder track string trace tracker append trace string get track gettrack tracker to string tostring test test bug testbug exception setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext bug servlet servlet bug servlet wrapper wrapper tomcat add servlet addservlet ctx servlet servlet wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping servlet tester access log valve testeraccesslogvalve alv tester access log valve testeraccesslogvalve ctx get pipeline getpipeline add valve addvalve alv tomcat start call servlet byte chunk bytechunk get url geturl http localhost get port getport assert equals assertequals to string tostring async thread chance finish counter servlet is done isdone counter thread sleep counter assert equals assertequals servlet get result getresult check access log alv validate access log validateaccesslog bug servlet thread sleep time bug servlet thread sleep time request time test test bug testbug exception setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext bug servlet servlet bug servlet wrapper wrapper tomcat add servlet addservlet ctx servlet servlet wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping servlet tester access log valve testeraccesslogvalve alv tester access log valve testeraccesslogvalve ctx get pipeline getpipeline add valve addvalve alv tomcat start call servlet byte chunk bytechunk get url geturl http localhost get port getport assert equals assertequals to string tostring async thread chance finish counter servlet is done isdone counter thread sleep counter assert equals assertequals servlet get result getresult check access log alv validate access log validateaccesslog bug servlet thread sleep time bug servlet thread sleep time request time test test async start no complete testasyncstartnocomplete exception reset tracker resettracker setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance min imise minimise pauses test tomcat get connector getconnector set attribute setattribute connection timeout connectiontimeout integer value of valueof file system doc base docbase required context ctx tomcat add context addcontext async start no complete servlet asyncstartnocompleteservlet servlet async start no complete servlet asyncstartnocompleteservlet wrapper wrapper tomcat add servlet addservlet ctx servlet servlet wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping servlet tester access log valve testeraccesslogvalve alv tester access log valve testeraccesslogvalve ctx get pipeline getpipeline add valve addvalve alv tomcat start call servlet time get url geturl http localhost get port getport echo assert equals assertequals get track gettrack reset tracker resettracker call servlet time request parameter get url geturl http localhost get port getport echo assert equals assertequals get track gettrack request complete listener finished processing wait seconds response check access log alv validate access log validateaccesslog async start no complete servlet asyncstartnocompleteservlet async timeout async start no complete servlet asyncstartnocompleteservlet async timeout timeout margin request time test test async start with complete testasyncstartwithcomplete exception setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext async start with complete servlet asyncstartwithcompleteservlet servlet async start with complete servlet asyncstartwithcompleteservlet wrapper wrapper tomcat add servlet addservlet ctx servlet servlet wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping servlet tester access log valve testeraccesslogvalve alv tester access log valve testeraccesslogvalve ctx get pipeline getpipeline add valve addvalve alv tomcat start call servlet byte chunk bytechunk byte chunk bytechunk map string list string headers hash map hashmap string list string get url geturl http localhost get port getport headers assert equals assertequals to string tostring list string content length contentlength headers content length assert not null assertnotnull content length contentlength assert equals assertequals content length contentlength size assert equals assertequals content length contentlength check access log alv validate access log validateaccesslog request time note servlet intended single threaded tests bug servlet http servlet httpservlet serialversionuid string builder stringbuilder result thread sleep time string get result getresult result to string tostring is done isdone override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception result string builder stringbuilder result append result append req is async started isasyncstarted req start async startasync set timeout settimeout result append result append req is async started isasyncstarted req get async context getasynccontext start runnable override result append result append req is async started isasyncstarted thread sleep thread sleep time result append result append req is async started isasyncstarted resp set content type setcontenttype text plain resp get writer getwriter print req get async context getasynccontext complete result append result append req is async started isasyncstarted interrupted exception interruptedexception result append i o exception ioexception result append point less pointless method call point debug ging debugging req get method getmethod note servlet intended single threaded tests bug servlet http servlet httpservlet serialversionuid string builder stringbuilder result thread sleep time string get result getresult result to string tostring is done isdone override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception result string builder stringbuilder result append result append req is async started isasyncstarted req start async startasync result append result append req is async started isasyncstarted req get async context getasynccontext start runnable override thread thread runnable override result append result append req is async started isasyncstarted thread sleep thread sleep time result append result append req is async started isasyncstarted resp set content type setcontenttype text plain resp get writer getwriter print req get async context getasynccontext complete result append result append req is async started isasyncstarted interrupted exception interruptedexception result append i o exception ioexception result append start point less pointless method call point debug ging debugging req get method getmethod async start no complete servlet asyncstartnocompleteservlet http servlet httpservlet async timeout serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception string echo req get parameter getparameter echo async context asynccontext actxt req start async startasync test async context impl testasynccontextimpl track echo test async context impl testasynccontextimpl track echo speed test reducing timeout actxt set timeout settimeout async timeout async start with complete servlet asyncstartwithcompleteservlet http servlet httpservlet serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception async context asynccontext actxt req start async startasync actxt set timeout settimeout resp set content type setcontenttype text plain resp get writer getwriter print actxt complete test test timeout listener complete no dispatch testtimeoutlistenercompletenodispatch exception work do test timeout dotesttimeout test test timeout listener no complete no dispatch testtimeoutlistenernocompletenodispatch exception trigger error do test timeout dotesttimeout test test timeout listener complete non async dispatch testtimeoutlistenercompletenonasyncdispatch exception trigger error do test timeout dotesttimeout test test timeout listener no complete non async dispatch testtimeoutlistenernocompletenonasyncdispatch exception work do test timeout dotesttimeout test test timeout listener complete async dispatch testtimeoutlistenercompleteasyncdispatch exception trigger error do test timeout dotesttimeout test test timeout listener no complete async dispatch testtimeoutlistenernocompleteasyncdispatch exception work do test timeout dotesttimeout test test timeout no listener testtimeoutnolistener exception work do test timeout dotesttimeout do test timeout dotesttimeout complete on timeout completeontimeout async dispatch asyncdispatch exception reset tracker resettracker string dispatch url dispatchurl async dispatch asyncdispatch async dispatch asyncdispatch boolean value booleanvalue dispatch url dispatchurl async dispatch url dispatchurl non async nonasync setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext timeout servlet timeoutservlet timeout timeout servlet timeoutservlet complete on timeout completeontimeout dispatch url dispatchurl wrapper wrapper tomcat add servlet addservlet ctx time timeout wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping start time async dispatch asyncdispatch async dispatch asyncdispatch boolean value booleanvalue async start runnable asyncstartrunnable async start runnable asyncstartrunnable async start runnable asyncstartrunnable wrapper async tomcat add servlet addservlet ctx async async start runnable asyncstartrunnable async set async supported setasyncsupported ctx add servlet mapping addservletmapping dispatch url dispatchurl async non async servlet nonasyncservlet non async nonasync non async servlet nonasyncservlet tomcat add servlet addservlet ctx non async nonasync non async nonasync ctx add servlet mapping addservletmapping dispatch url dispatchurl non async nonasync ctx add application listener addapplicationlistener tracking request listener trackingrequestlistener get name getname tester access log valve testeraccesslogvalve alv tester access log valve testeraccesslogvalve ctx get pipeline getpipeline add valve addvalve alv tester access log valve testeraccesslogvalve alv global alvglobal tester access log valve testeraccesslogvalve tomcat get host gethost get pipeline getpipeline add valve addvalve alv global alvglobal tomcat start get url geturl http localhost get port getport start i o exception ioexception ioe string builder stringbuilder expected string builder stringbuilder request initialized requestinitialized expected append timeout servlet get timeoutservletget complete on timeout completeontimeout expected append request destroyed requestdestroyed complete on timeout completeontimeout boolean value booleanvalue expected append on timeout ontimeout expected append on complete oncomplete expected append request destroyed requestdestroyed expected append on timeout ontimeout async dispatch asyncdispatch async dispatch asyncdispatch boolean value booleanvalue expected append on start async onstartasync runnable expected append non async servlet get nonasyncservletget expected append on complete oncomplete expected append request destroyed requestdestroyed request complete listener finished processing wait seconds response string expected track expectedtrack expected to string tostring count expected track expectedtrack equals get track gettrack count thread sleep count assert equals assertequals expected track expectedtrack get track gettrack check access log complete on timeout completeontimeout complete on timeout completeontimeout boolean value booleanvalue async dispatch asyncdispatch alv global alvglobal validate access log validateaccesslog timeout servlet timeoutservlet async timeout timeout servlet timeoutservlet async timeout timeout margin request time alv validate access log validateaccesslog timeout servlet timeoutservlet async timeout timeout servlet timeoutservlet async timeout timeout margin request time timeout delay timeoutdelay timeout servlet timeoutservlet async timeout async dispatch asyncdispatch async dispatch asyncdispatch boolean value booleanvalue complete on timeout completeontimeout boolean value booleanvalue extra timeout timeout delay timeoutdelay timeout servlet timeoutservlet async timeout alv global alvglobal validate access log validateaccesslog timeout delay timeoutdelay timeout delay timeoutdelay timeout margin request time alv validate access log validateaccesslog timeout delay timeoutdelay timeout delay timeoutdelay timeout margin request time timeout servlet timeoutservlet http servlet httpservlet serialversionuid complete on timeout completeontimeout string dispatch url dispatchurl async timeout timeout servlet timeoutservlet complete on timeout completeontimeout string dispatch url dispatchurl complete on timeout completeontimeout complete on timeout completeontimeout dispatch url dispatchurl dispatch url dispatchurl override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception req is async supported isasyncsupported test async context impl testasynccontextimpl track timeout servlet get timeoutservletget async context asynccontext req start async startasync set timeout settimeout async timeout complete on timeout completeontimeout add listener addlistener tracking listener trackinglistener complete on timeout completeontimeout boolean value booleanvalue dispatch url dispatchurl resp get writer getwriter print fail async unsupported test test dispatch single testdispatchsingle exception do test dispatch dotestdispatch test test dispatch double testdispatchdouble exception do test dispatch dotestdispatch test test dispatch multiple testdispatchmultiple exception do test dispatch dotestdispatch test test dispatch with thread single testdispatchwiththreadsingle exception do test dispatch dotestdispatch test test dispatch with thread double testdispatchwiththreaddouble exception do test dispatch dotestdispatch test test dispatch with thread multiple testdispatchwiththreadmultiple exception do test dispatch dotestdispatch do test dispatch dotestdispatch iter use thread usethread exception reset tracker resettracker setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext dispatching servlet dispatchingservlet dispatch dispatching servlet dispatchingservlet wrapper wrapper tomcat add servlet addservlet ctx dispatch dispatch wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping stage dispatch non async servlet nonasyncservlet non async nonasync non async servlet nonasyncservlet wrapper wrapper tomcat add servlet addservlet ctx non async nonasync non async nonasync wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping stage non async nonasync ctx add application listener addapplicationlistener tracking request listener trackingrequestlistener get name getname tester access log valve testeraccesslogvalve alv tester access log valve testeraccesslogvalve ctx get pipeline getpipeline add valve addvalve alv tomcat start string builder stringbuilder url string builder stringbuilder url append http localhost url append get port getport url append stage iter url append iter use thread usethread url append use thread usethread get url geturl url to string tostring string builder stringbuilder expected string builder stringbuilder request initialized requestinitialized loop iter loop expected append dispatching servlet get dispatchingservletget loop expected append non async servlet get nonasyncservletget expected append request destroyed requestdestroyed request complete listener finished processing wait seconds response string expected track expectedtrack expected to string tostring count expected track expectedtrack equals get track gettrack count thread sleep count assert equals assertequals expected track expectedtrack get track gettrack check access log alv validate access log validateaccesslog request time dispatching servlet dispatchingservlet http servlet httpservlet serialversionuid string iter param iter string dispatch check check add tracking listener addtrackinglistener complete on error completeonerror dispatching servlet dispatchingservlet add tracking listener addtrackinglistener complete on error completeonerror add tracking listener addtrackinglistener add tracking listener addtrackinglistener complete on error completeonerror complete on error completeonerror override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception equals req get parameter getparameter dispatch check req get dispatcher type getdispatchertype dispatcher type dispatchertype async track wrong dispatcher type wrongdispatchertype track dispatching servlet get dispatchingservletget iter integer parse int parseint req get parameter getparameter iter param async context asynccontext ctxt req start async startasync add tracking listener addtrackinglistener tracking listener trackinglistener listener tracking listener trackinglistener complete on error completeonerror ctxt add listener addlistener listener runnable runnable override iter ctxt dispatch stage iter param iter dispatch check ctxt dispatch stage equals req get parameter getparameter use thread usethread thread start non async servlet nonasyncservlet http servlet httpservlet serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception test async context impl testasynccontextimpl track non async servlet get nonasyncservletget test test listeners testlisteners exception reset tracker resettracker setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext tracking servlet trackingservlet tracking tracking servlet trackingservlet wrapper wrapper tomcat add servlet addservlet ctx tracking tracking wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping stage tracking timeout servlet timeoutservlet timeout timeout servlet timeoutservlet wrapper wrapper tomcat add servlet addservlet ctx timeout timeout wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping stage timeout tester access log valve testeraccesslogvalve alv tester access log valve testeraccesslogvalve ctx get pipeline getpipeline add valve addvalve alv tomcat start string builder stringbuilder url string builder stringbuilder url append http localhost url append get port getport url append stage get url geturl url to string tostring request complete listener finished processing wait seconds response string expected track expectedtrack dispatching servlet get dispatchingservletget dispatching servlet get dispatchingservletget on start async onstartasync timeout servlet get timeoutservletget on start async onstartasync on timeout ontimeout on complete oncomplete count expected track expectedtrack equals get track gettrack count thread sleep count assert equals assertequals expected track expectedtrack get track gettrack check access log alv validate access log validateaccesslog timeout servlet timeoutservlet async timeout timeout servlet timeoutservlet async timeout timeout margin request time tracking servlet trackingservlet http servlet httpservlet serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception test async context impl testasynccontextimpl track dispatching servlet get dispatchingservletget resp flush buffer flushbuffer tracking servlet trackingservlet tracking servlet trackingservlet async context asynccontext ctxt req start async startasync tracking listener trackinglistener listener tracking listener trackinglistener ctxt add listener addlistener listener ctxt set timeout settimeout runnable runnable override ctxt dispatch stage ctxt dispatch stage equals req get parameter getparameter use thread usethread thread start tracking listener trackinglistener async listener asynclistener complete on error completeonerror complete on timeout completeontimeout string dispatch url dispatchurl tracking listener trackinglistener complete on error completeonerror complete on timeout completeontimeout string dispatch url dispatchurl complete on error completeonerror complete on error completeonerror complete on timeout completeontimeout complete on timeout completeontimeout dispatch url dispatchurl dispatch url dispatchurl override on complete oncomplete async event asyncevent event i o exception ioexception test async context impl testasynccontextimpl track on complete oncomplete override on timeout ontimeout async event asyncevent event i o exception ioexception test async context impl testasynccontextimpl track on timeout ontimeout complete on timeout completeontimeout event get async context getasynccontext complete dispatch url dispatchurl event get async context getasynccontext dispatch dispatch url dispatchurl override on error onerror async event asyncevent event i o exception ioexception test async context impl testasynccontextimpl track on error onerror complete on error completeonerror event get async context getasynccontext complete override on start async onstartasync async event asyncevent event i o exception ioexception test async context impl testasynccontextimpl track on start async onstartasync sticky tracking listener stickytrackinglistener tracking listener trackinglistener sticky tracking listener stickytrackinglistener complete on error completeonerror complete on timeout completeontimeout string dispatch url dispatchurl complete on error completeonerror complete on timeout completeontimeout dispatch url dispatchurl override on start async onstartasync async event asyncevent event i o exception ioexception on start async onstartasync event add listener async context asynccontext event get async context getasynccontext add listener addlistener tracking request listener trackingrequestlistener servlet request listener servletrequestlistener override request destroyed requestdestroyed servlet request event servletrequestevent sre test async context impl testasynccontextimpl track request destroyed requestdestroyed override request initialized requestinitialized servlet request event servletrequestevent sre test async context impl testasynccontextimpl track request initialized requestinitialized test test dispatch error single testdispatcherrorsingle exception do test dispatch error dotestdispatcherror test test dispatch error double testdispatcherrordouble exception do test dispatch error dotestdispatcherror test test dispatch error multiple testdispatcherrormultiple exception do test dispatch error dotestdispatcherror test test dispatch error with thread single testdispatcherrorwiththreadsingle exception do test dispatch error dotestdispatcherror test test dispatch error with thread double testdispatcherrorwiththreaddouble exception do test dispatch error dotestdispatcherror test test dispatch error with thread multiple testdispatcherrorwiththreadmultiple exception do test dispatch error dotestdispatcherror test test dispatch error single then complete testdispatcherrorsinglethencomplete exception do test dispatch error dotestdispatcherror test test dispatch error double then complete testdispatcherrordoublethencomplete exception do test dispatch error dotestdispatcherror test test dispatch error multiple then complete testdispatcherrormultiplethencomplete exception do test dispatch error dotestdispatcherror test test dispatch error with thread single then complete testdispatcherrorwiththreadsinglethencomplete exception do test dispatch error dotestdispatcherror test test dispatch error with thread double then complete testdispatcherrorwiththreaddoublethencomplete exception do test dispatch error dotestdispatcherror test test dispatch error with thread multiple then complete testdispatcherrorwiththreadmultiplethencomplete exception do test dispatch error dotestdispatcherror do test dispatch error dotestdispatcherror iter use thread usethread complete on error completeonerror exception reset tracker resettracker setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext dispatching servlet dispatchingservlet dispatch dispatching servlet dispatchingservlet complete on error completeonerror wrapper wrapper tomcat add servlet addservlet ctx dispatch dispatch wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping stage dispatch error servlet errorservlet error error servlet errorservlet tomcat add servlet addservlet ctx error error ctx add servlet mapping addservletmapping stage error ctx add application listener addapplicationlistener tracking request listener trackingrequestlistener get name getname tester access log valve testeraccesslogvalve alv tester access log valve testeraccesslogvalve ctx get pipeline getpipeline add valve addvalve alv tomcat start string builder stringbuilder url string builder stringbuilder url append http localhost url append get port getport url append stage iter url append iter use thread usethread url append use thread usethread get url geturl url to string tostring string builder stringbuilder expected string builder stringbuilder request initialized requestinitialized loop iter loop expected append dispatching servlet get dispatchingservletget loop iter expected append on start async onstartasync loop expected append error servlet get errorservletget on error onerror on complete oncomplete request destroyed requestdestroyed request complete listener finished processing wait seconds response string expected track expectedtrack expected to string tostring count expected track expectedtrack equals get track gettrack count thread sleep count assert equals assertequals expected track expectedtrack get track gettrack check access log alv validate access log validateaccesslog request time error servlet errorservlet http servlet httpservlet serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception test async context impl testasynccontextimpl track error servlet get errorservletget original thread chance exit error report valve errorreportvalve exception thread sleep interrupted exception interruptedexception servlet exception servletexception servlet exception servletexception opps test test bug testbug exception reset tracker resettracker setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext async start runnable asyncstartrunnable servlet async start runnable asyncstartrunnable wrapper wrapper tomcat add servlet addservlet ctx servlet servlet wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping servlet tester access log valve testeraccesslogvalve alv tester access log valve testeraccesslogvalve ctx get pipeline getpipeline add valve addvalve alv tomcat start get url geturl http localhost get port getport request complete listener finished processing wait seconds response string expected track expectedtrack runnable on complete oncomplete count expected track expectedtrack equals get track gettrack count thread sleep count assert equals assertequals expected track expectedtrack get track gettrack check access log alv validate access log validateaccesslog async start runnable asyncstartrunnable thread sleep time async start runnable asyncstartrunnable thread sleep time request time async start runnable asyncstartrunnable http servlet httpservlet serialversionuid thread sleep time override do get doget http servlet request httpservletrequest request http servlet response httpservletresponse response servlet exception servletexception i o exception ioexception async context asynccontext async context asynccontext request start async startasync request response async context asynccontext add listener addlistener tracking listener trackinglistener async context asynccontext start runnable override thread sleep thread sleep time test async context impl testasynccontextimpl track runnable async context asynccontext complete exception print stack trace printstacktrace test test bug testbug exception setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext bug servlet servlet bug servlet wrapper wrapper tomcat add servlet addservlet ctx servlet servlet wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping servlet tester access log valve testeraccesslogvalve alv tester access log valve testeraccesslogvalve ctx get pipeline getpipeline add valve addvalve alv tomcat start call servlet map string list string headers linked hash map linkedhashmap string list string byte chunk bytechunk byte chunk bytechunk get url geturl http localhost get port getport headers assert equals assertequals assert equals assertequals to string tostring list string test header testheader headers assert not null assertnotnull test header testheader assert equals assertequals test header testheader size assert equals assertequals xyz test header testheader check access log alv validate access log validateaccesslog bug servlet thread sleep time bug servlet thread sleep time request time bug servlet http servlet httpservlet serialversionuid thread sleep time override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception async context asynccontext ctx req start async startasync ctx start runnable override thread sleep thread sleep time resp set header setheader xyz resp set content type setcontenttype text plain resp set content length setcontentlength get bytes getbytes length resp get writer getwriter print ctx complete exception print stack trace printstacktrace test test error handling testerrorhandling exception reset tracker resettracker setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext error servlet errorservlet error error servlet errorservlet tomcat add servlet addservlet ctx error error ctx add servlet mapping addservletmapping error error tester access log valve testeraccesslogvalve alv tester access log valve testeraccesslogvalve ctx get pipeline getpipeline add valve addvalve alv tomcat start string builder stringbuilder url string builder stringbuilder url append http localhost url append get port getport url append error get url geturl url to string tostring byte chunk bytechunk assert equals assertequals test complete access log chance log request thread sleep request time check access log alv validate access log validateaccesslog request time test test commit on complete testcommitoncomplete exception setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext async status servlet asyncstatusservlet async status servlet asyncstatusservlet async status servlet asyncstatusservlet http servlet response httpservletresponse bad request wrapper wrapper tomcat add servlet addservlet ctx async status servlet asyncstatusservlet async status servlet asyncstatusservlet wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping async status servlet asyncstatusservlet async status servlet asyncstatusservlet tester access log valve testeraccesslogvalve alv tester access log valve testeraccesslogvalve ctx get pipeline getpipeline add valve addvalve alv tomcat start string builder stringbuilder url string builder stringbuilder url append http localhost url append get port getport url append async status servlet asyncstatusservlet get url geturl url to string tostring byte chunk bytechunk assert equals assertequals http servlet response httpservletresponse bad request test complete access log chance log request thread sleep request time check access log alv validate access log validateaccesslog http servlet response httpservletresponse bad request request time async status servlet asyncstatusservlet http servlet httpservlet serialversionuid status async status servlet asyncstatusservlet status status status override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception async context asynccontext actxt req start async startasync resp set status setstatus status actxt complete test test bug testbug exception do test bug dotestbug test test bug testbug exception do test bug dotestbug test test bug testbug exception do test bug dotestbug test test bug testbug exception do test bug dotestbug do test bug dotestbug threaded custom error customerror exception setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext async error servlet asyncerrorservlet async error servlet asyncerrorservlet async error servlet asyncerrorservlet http servlet response httpservletresponse bad request threaded wrapper wrapper tomcat add servlet addservlet ctx async error servlet asyncerrorservlet async error servlet asyncerrorservlet wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping async error servlet asyncerrorservlet async error servlet asyncerrorservlet custom error customerror custom error servlet customerrorservlet custom error servlet customerrorservlet custom error servlet customerrorservlet tomcat add servlet addservlet ctx custom error servlet customerrorservlet custom error servlet customerrorservlet ctx add servlet mapping addservletmapping custom error servlet customerrorservlet custom error servlet customerrorservlet error page errorpage error page errorpage set location setlocation custom error servlet customerrorservlet ctx add error page adderrorpage tester access log valve testeraccesslogvalve alv tester access log valve testeraccesslogvalve ctx get pipeline getpipeline add valve addvalve alv tomcat start string builder stringbuilder url string builder stringbuilder url append http localhost url append get port getport url append async error servlet asyncerrorservlet byte chunk bytechunk res byte chunk bytechunk get url geturl url to string tostring res assert equals assertequals http servlet response httpservletresponse bad request srv handling error application resp onsibility responsibility error occurs application thread calling send error senderror complete expecting standard error mechanism kick viewed handling error string response body responsebody res to string tostring assert not null assertnotnull response body responsebody assert true asserttrue response body responsebody length custom error customerror assert true asserttrue response body responsebody response body responsebody custom error servlet customerrorservlet error message assert true asserttrue response body responsebody response body responsebody async error servlet asyncerrorservlet error message test complete access log chance log request thread sleep request time check access log alv validate access log validateaccesslog http servlet response httpservletresponse bad request request time custom error servlet customerrorservlet generic servlet genericservlet serialversionuid string error message custom error override service servlet request servletrequest req servlet response servletresponse res servlet exception servletexception i o exception ioexception res get writer getwriter print error message async error servlet asyncerrorservlet http servlet httpservlet serialversionuid string error message broke status threaded async error servlet asyncerrorservlet status threaded status status threaded threaded override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception async context asynccontext actxt req start async startasync actxt set timeout settimeout timeout threaded actxt start runnable override resp send error senderror status error message actxt complete i o exception ioexception resp send error senderror status error message actxt complete test test bug testbug exception setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext wrapper tomcat add servlet addservlet ctx servlet a servleta bug servlet a servleta set async supported setasyncsupported wrapper tomcat add servlet addservlet ctx servlet b servletb bug servlet b servletb set async supported setasyncsupported tomcat add servlet addservlet ctx servlet c servletc bug servlet c servletc ctx add servlet mapping addservletmapping servlet a servleta servlet a servleta ctx add servlet mapping addservletmapping servlet b servletb servlet b servletb ctx add servlet mapping addservletmapping servlet c servletc servlet c servletc tomcat start string builder stringbuilder url string builder stringbuilder url append http localhost url append get port getport url append servlet a servleta byte chunk bytechunk body byte chunk bytechunk get url geturl url to string tostring body assert equals assertequals http servlet response httpservletresponse assert equals assertequals body to string tostring bug servlet a servleta http servlet httpservlet serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception request dispatcher requestdispatcher req get request dispatcher getrequestdispatcher servlet b servletb req resp bug servlet b servletb http servlet httpservlet serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception async context asynccontext async req start async startasync debug ging debugging async set timeout settimeout executor service executorservice executor executors new single thread executor newsinglethreadexecutor executor sub mit submit runnable override async dispatch servlet c servletc executor shutdown bug servlet c servletc http servlet httpservlet serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception resp set content type setcontenttype text plain resp get writer getwriter print test test bug testbug exception setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext bug servlet a servleta servlet a servleta bug servlet a servleta wrapper tomcat add servlet addservlet ctx servlet a servleta servlet a servleta set async supported setasyncsupported tomcat add servlet addservlet ctx servlet b servletb bug servlet b servletb ctx add servlet mapping addservletmapping servlet a servleta servlet a servleta ctx add servlet mapping addservletmapping servlet b servletb servlet b servletb tomcat start string builder stringbuilder url string builder stringbuilder url append http localhost url append get port getport url append servlet a servleta byte chunk bytechunk body byte chunk bytechunk get url geturl url to string tostring body assert equals assertequals http servlet response httpservletresponse assert equals assertequals body to string tostring assert true asserttrue servlet a servleta is async when expected isasyncwhenexpected bug servlet a servleta http servlet httpservlet serialversionuid is async when expected isasyncwhenexpected override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception async point is async when expected isasyncwhenexpected is async when expected isasyncwhenexpected req is async started isasyncstarted async context asynccontext async req start async startasync async point is async when expected isasyncwhenexpected is async when expected isasyncwhenexpected req is async started isasyncstarted async start runnable override delayed original container thread exists async dispatch servlet b servletb thread sleep interrupted exception interruptedexception servlet exception servletexception async point is async when expected isasyncwhenexpected is async when expected isasyncwhenexpected req is async started isasyncstarted is async when expected isasyncwhenexpected is async when expected isasyncwhenexpected bug servlet b servletb http servlet httpservlet serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception resp set content type setcontenttype text plain resp get writer getwriter print test test timeout error dispatch non e testtimeouterrordispatchnone exception do test timeout error dispatch dotesttimeouterrordispatch test test timeout error dispatch non async testtimeouterrordispatchnonasync exception do test timeout error dispatch dotesttimeouterrordispatch test test timeout error dispatch async start testtimeouterrordispatchasyncstart exception do test timeout error dispatch dotesttimeouterrordispatch error page async mode errorpageasyncmode complete test test timeout error dispatch async complete testtimeouterrordispatchasynccomplete exception do test timeout error dispatch dotesttimeouterrordispatch error page async mode errorpageasyncmode complete test test timeout error dispatch async dispatch testtimeouterrordispatchasyncdispatch exception do test timeout error dispatch dotesttimeouterrordispatch error page async mode errorpageasyncmode dispatch do test timeout error dispatch dotesttimeouterrordispatch async error asyncerror error page async mode errorpageasyncmode mode exception reset tracker resettracker setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext timeout servlet timeoutservlet timeout timeout servlet timeoutservlet wrapper tomcat add servlet addservlet ctx time timeout set async supported setasyncsupported ctx add servlet mapping addservletmapping async time non async servlet nonasyncservlet non async nonasync non async servlet nonasyncservlet wrapper tomcat add servlet addservlet ctx non async nonasync non async nonasync set async supported setasyncsupported ctx add servlet mapping addservletmapping error non async nonasync non async nonasync async error page asyncerrorpage async error page asyncerrorpage async error page asyncerrorpage mode wrapper tomcat add servlet addservlet ctx async error page asyncerrorpage async error page asyncerrorpage set async supported setasyncsupported ctx add servlet mapping addservletmapping error async async error page asyncerrorpage async error asyncerror error page errorpage error page errorpage set error code seterrorcode async error asyncerror boolean value booleanvalue set location setlocation error async set location setlocation error non async nonasync ctx add error page adderrorpage ctx add application listener addapplicationlistener tracking request listener trackingrequestlistener get name getname tester access log valve testeraccesslogvalve alv tester access log valve testeraccesslogvalve ctx get pipeline getpipeline add valve addvalve alv tester access log valve testeraccesslogvalve alv global alvglobal tester access log valve testeraccesslogvalve tomcat get host gethost get pipeline getpipeline add valve addvalve alv global alvglobal tomcat start byte chunk bytechunk res byte chunk bytechunk get url geturl http localhost get port getport async res i o exception ioexception ioe string builder stringbuilder expected string builder stringbuilder expected append request initialized requestinitialized timeout servlet get timeoutservletget async error asyncerror async error asyncerror boolean value booleanvalue expected append async error page get asyncerrorpageget mode error page async mode errorpageasyncmode complete expected append no op noop mode error page async mode errorpageasyncmode complete expected append complete mode error page async mode errorpageasyncmode dispatch expected append dispatch non async servlet get nonasyncservletget expected append non async servlet get nonasyncservletget expected append request destroyed requestdestroyed request complete listener finished processing wait seconds response string expected track expectedtrack expected to string tostring count expected track expectedtrack equals get track gettrack count thread sleep count assert equals assertequals expected track expectedtrack get track gettrack check access log alv global alvglobal validate access log validateaccesslog timeout servlet timeoutservlet async timeout timeout servlet timeoutservlet async timeout timeout margin request time alv validate access log validateaccesslog timeout servlet timeoutservlet async timeout timeout servlet timeoutservlet async timeout timeout margin request time enum error page async mode errorpageasyncmode complete complete dispatch async error page asyncerrorpage http servlet httpservlet serialversionuid error page async mode errorpageasyncmode mode async error page asyncerrorpage error page async mode errorpageasyncmode mode mode mode override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception test async context impl testasynccontextimpl track async error page get asyncerrorpageget async context asynccontext ctxt req get async context getasynccontext mode complete test async context impl testasynccontextimpl track complete ctxt complete dispatch test async context impl testasynccontextimpl track dispatch ctxt dispatch error non async nonasync complete test async context impl testasynccontextimpl track no op noop impossible test test bug testbug exception setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext bug servlet a servleta bug servlet a servleta bug servlet a servleta wrapper wrapper tomcat add servlet addservlet ctx bug servlet a servleta bug servlet a servleta wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping bug servlet a servleta bug servlet a servleta bug servlet b servletb bug servlet b servletb bug servlet b servletb tomcat add servlet addservlet ctx bug servlet b servletb bug servlet b servletb ctx add servlet mapping addservletmapping bug servlet b servletb bug servlet b servletb tomcat start byte chunk bytechunk body byte chunk bytechunk get url geturl http localhost get port getport bug servlet a servleta bug servlet a servleta param bar body i o exception ioexception ioe ioe print stack trace printstacktrace assert equals assertequals http servlet response httpservletresponse body recycle get url geturl http localhost get port getport bug servlet b servletb body assert equals assertequals http servlet response httpservletresponse assert equals assertequals body to string tostring bug servlet a servleta http servlet httpservlet string param foo serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception req get parameter getparameter param async context asynccontext actxt req start async startasync actxt add listener addlistener bug async listener asynclistener actxt complete bug servlet b servletb http servlet httpservlet serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception resp set content type setcontenttype text plain print writer printwriter resp get writer getwriter string result req get parameter getparameter bug servlet a servleta param result write write fail bug async listener asynclistener async listener asynclistener override on complete oncomplete async event asyncevent event i o exception ioexception runtime exception runtimeexception testing bug override on timeout ontimeout async event asyncevent event i o exception ioexception override on error onerror async event asyncevent event i o exception ioexception override on start async onstartasync async event asyncevent event i o exception ioexception test test bug testbug exception do test bug dotestbug do get doget on error onerror on complete oncomplete test test bug testbug exception do test bug dotestbug loops do get doget do get doget on start async onstartasync do get doget on start async onstartasync on error onerror on complete oncomplete do test bug dotestbug string query string querystring string expected track expectedtrack exception reset tracker resettracker tomcat tomcat get tomcat instance gettomcatinstance context ctx tomcat add context addcontext wrapper tomcat add servlet addservlet async bug servlet set async supported setasyncsupported ctx add servlet mapping addservletmapping async async tomcat start get url geturl http localhost get port getport async query string querystring wait response count expected track expectedtrack equals get track gettrack count thread sleep count assert equals assertequals expected track expectedtrack get track gettrack bug servlet http servlet httpservlet serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception track do get doget async context asynccontext ctx req start async startasync ctx set timeout settimeout ctx add listener addlistener tracking listener trackinglistener async string loops param loopsparam req get parameter getparameter loops integer loops attr loopsattr integer req get attribute getattribute loops loops loops attr loopsattr loops loops attr loopsattr int value intvalue loops param loopsparam loops integer parse int parseint loops param loopsparam loops loops req set attribute setattribute loops integer value of valueof loops ctx dispatch servlet exception servletexception test test for bidden dispatching testforbiddendispatching exception reset tracker resettracker setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext non async servlet nonasyncservlet non async servlet nonasyncservlet non async servlet nonasyncservlet wrapper wrapper tomcat add servlet addservlet ctx non async servlet nonasyncservlet non async servlet nonasyncservlet wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping target non async servlet nonasyncservlet dispatching generic servlet dispatchinggenericservlet for bidden dispatching servlet forbiddendispatchingservlet dispatching generic servlet dispatchinggenericservlet wrapper wrapper tomcat add servlet addservlet ctx for bidden dispatching servlet forbiddendispatchingservlet for bidden dispatching servlet forbiddendispatchingservlet wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping for bidden dispatching servlet forbiddendispatchingservlet for bidden dispatching servlet forbiddendispatchingservlet tomcat start get url geturl http localhost get port getport for bidden dispatching servlet forbiddendispatchingservlet i o exception ioexception ioe ioe print stack trace printstacktrace request complete listener finished processing wait seconds response string expected track expectedtrack ok non async servlet get oknonasyncservletget count expected track expectedtrack equals get track gettrack count thread sleep count assert equals assertequals expected track expectedtrack get track gettrack dispatching generic servlet dispatchinggenericservlet generic servlet genericservlet serialversionuid string custom req resp crr string empty dispatch empty override service servlet request servletrequest req servlet response servletresponse resp servlet exception servletexception i o exception ioexception dispatcher type dispatchertype async req get dispatcher type getdispatchertype async context asynccontext async context asynccontext equals req get parameter getparameter custom req resp async context asynccontext req start async startasync servlet request wrapper servletrequestwrapper req servlet response wrapper servletresponsewrapper resp async context asynccontext req start async startasync equals req get parameter getparameter empty dispatch async context asynccontext dispatch async context asynccontext dispatch target async context asynccontext dispatch non existing servlet nonexistingservlet test async context impl testasynccontextimpl track fail illegal state exception illegalstateexception test async context impl testasynccontextimpl track test async context impl testasynccontextimpl track dispatching generic servlet get dispatchinggenericservletget test test dispatch with custom request response testdispatchwithcustomrequestresponse exception prepare application with generic servlet prepareapplicationwithgenericservlet string builder stringbuilder expected string builder stringbuilder expected append expected append custom generic servlet get customgenericservletget request application with generic servlet requestapplicationwithgenericservlet dispatch crr expected expected string builder stringbuilder expected append expected append dispatching generic servlet get dispatchinggenericservletget request application with generic servlet requestapplicationwithgenericservlet dispatch crr empty expected custom generic servlet customgenericservlet generic servlet genericservlet serialversionuid override service servlet request servletrequest req servlet response servletresponse res servlet exception servletexception i o exception ioexception req servlet request wrapper servletrequestwrapper res servlet response wrapper servletresponsewrapper test async context impl testasynccontextimpl track custom generic servlet get customgenericservletget test test empty dispatch testemptydispatch exception prepare application with generic servlet prepareapplicationwithgenericservlet string builder stringbuilder expected string builder stringbuilder expected append expected append dispatching generic servlet get dispatchinggenericservletget request application with generic servlet requestapplicationwithgenericservlet dispatch empty expected request application with generic servlet requestapplicationwithgenericservlet dispatch empty expected request application with generic servlet requestapplicationwithgenericservlet dispatch empty expected request application with generic servlet requestapplicationwithgenericservlet dispatch empty expected request application with generic servlet requestapplicationwithgenericservlet dispatch empty expected request application with generic servlet requestapplicationwithgenericservlet dispatch empty expected test test empty dispatch with custom request response testemptydispatchwithcustomrequestresponse exception prepare application with generic servlet prepareapplicationwithgenericservlet string builder stringbuilder expected string builder stringbuilder expected append expected append dispatching generic servlet get dispatchinggenericservletget request application with generic servlet requestapplicationwithgenericservlet dispatch crr empty expected request application with generic servlet requestapplicationwithgenericservlet dispatch crr empty expected request application with generic servlet requestapplicationwithgenericservlet dispatch crr empty expected request application with generic servlet requestapplicationwithgenericservlet dispatch crr empty expected request application with generic servlet requestapplicationwithgenericservlet dispatch crr empty expected request application with generic servlet requestapplicationwithgenericservlet dispatch crr empty expected prepare application with generic servlet prepareapplicationwithgenericservlet string context path contextpath exception setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext context path contextpath dispatching generic servlet dispatchinggenericservlet dispatch dispatching generic servlet dispatchinggenericservlet wrapper wrapper tomcat add servlet addservlet ctx dispatch dispatch wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping dispatch dispatch custom generic servlet customgenericservlet custom generic customgeneric custom generic servlet customgenericservlet wrapper wrapper tomcat add servlet addservlet ctx custom generic customgeneric custom generic customgeneric wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping target custom generic customgeneric tomcat start request application with generic servlet requestapplicationwithgenericservlet string path string builder stringbuilder expected content expectedcontent exception reset tracker resettracker get url geturl http localhost get port getport path request complete listener finished processing wait seconds response string expected track expectedtrack expected content expectedcontent to string tostring count expected track expectedtrack equals get track gettrack count thread sleep count assert equals assertequals expected track expectedtrack get track gettrack test test get request e testgetrequestise exception do test async e dotestasyncise test test get response e testgetresponseise exception do test async e dotestasyncise do test async e dotestasyncise use get request usegetrequest exception setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext asynciseservlet servlet asynciseservlet wrapper tomcat add servlet addservlet ctx asynciseservlet servlet set async supported setasyncsupported ctx add servlet mapping addservletmapping test asynciseservlet tomcat start byte chunk bytechunk response byte chunk bytechunk get url geturl http localhost get port getport test response assert equals assertequals http servlet response httpservletresponse has ise hasise use get request usegetrequest servlet get async context getasynccontext get request getrequest servlet get async context getasynccontext get response getresponse illegal state exception illegalstateexception ise has ise hasise assert true asserttrue has ise hasise acc essing accessing async context asynccontext ugly hack real application thread safe sort hack ise meant prev enting preventing asynciseservlet http servlet httpservlet serialversionuid async context asynccontext async context asynccontext override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception resp set content type setcontenttype text plain utf async context asynccontext req start async startasync commit response async context asynccontext complete async context asynccontext get async context getasynccontext async context asynccontext https apache org bug zilla bugzilla bug cgi test test async context listener clearing testasynccontextlistenerclearing exception reset tracker resettracker setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext servlet stage dispatching servlet tracking dispatchingservlettracking stage wrapper wrapper tomcat add servlet addservlet ctx stage stage wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping stage stage servlet stage dispatching servlet tracking dispatchingservlettracking stage wrapper wrapper tomcat add servlet addservlet ctx stage stage wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping stage stage servlet stage non async servlet nonasyncservlet tomcat add servlet addservlet ctx stage stage ctx add servlet mapping addservletmapping stage stage tester access log valve testeraccesslogvalve alv tester access log valve testeraccesslogvalve ctx get pipeline getpipeline add valve addvalve alv tomcat start get url geturl http localhost get port getport stage assert equals assertequals do get doget start async startasync do get doget start async startasync on start async onstartasync non async servlet get nonasyncservletget on complete oncomplete get track gettrack check access log alv validate access log validateaccesslog request time dispatching servlet tracking dispatchingservlettracking http servlet httpservlet serialversionuid string target add tracking listener addtrackinglistener dispatching servlet tracking dispatchingservlettracking string target add tracking listener addtrackinglistener target target add tracking listener addtrackinglistener add tracking listener addtrackinglistener override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception track do get doget start async startasync async context asynccontext req start async startasync add tracking listener addtrackinglistener add listener addlistener sticky tracking listener stickytrackinglistener dispatch target test test async request i testasyncrequesturi exception setup tomcat instance tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext servlet servlet async request uri servlet asyncrequesturiservlet wrapper wrapper tomcat add servlet addservlet ctx bug servlet wrapper set async supported setasyncsupported ctx add servlet mapping addservletmapping bug tomcat start string uri foo bar byte chunk bytechunk body get url geturl http localhost get port getport uri assert equals assertequals uri body to string tostring async request uri servlet asyncrequesturiservlet http servlet httpservlet serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception dispatcher type dispatchertype async equals req get dispatcher type getdispatchertype resp set content type setcontenttype text plain resp set character encoding setcharacterencoding utf resp get writer getwriter write req getrequesturi req start async startasync dispatch https apache org bug zilla bugzilla bug cgi comment test test timeout dispatch custom error page testtimeoutdispatchcustomerrorpage exception tomcat tomcat get tomcat instance gettomcatinstance context context tomcat add context addcontext tomcat add servlet addservlet timeout bug async servlet asyncservlet get name getname set async supported setasyncsupported custom error servlet customerrorservlet custom error servlet customerrorservlet custom error servlet customerrorservlet tomcat add servlet addservlet context custom error servlet customerrorservlet custom error servlet customerrorservlet context add servlet mapping addservletmapping timeout timeout context add servlet mapping addservletmapping error custom error servlet customerrorservlet error page errorpage error page errorpage error page errorpage error page errorpage set location setlocation error context add error page adderrorpage error page errorpage tomcat start byte chunk bytechunk response body responsebody byte chunk bytechunk get url geturl http localhost get port getport timeout response body responsebody assert equals assertequals assert equals assertequals custom error servlet customerrorservlet error message response body responsebody to string tostring bug async servlet asyncservlet http servlet httpservlet serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception req get attribute getattribute timeout resp send error senderror async context asynccontext context req start async startasync context set timeout settimeout context add listener addlistener async listener asynclistener override on timeout ontimeout async event asyncevent event i o exception ioexception http servlet response httpservletresponse response http servlet response httpservletresponse event get supplied response getsuppliedresponse response is committed iscommitted http servlet request httpservletrequest event get supplied request getsuppliedrequest set attribute setattribute timeout context dispatch override on start async onstartasync async event asyncevent event i o exception ioexception override on error onerror async event asyncevent event i o exception ioexception override on complete oncomplete async event asyncevent event i o exception ioexception test test async listener sup ply request response testasynclistenersupplyrequestresponse servlet request servletrequest servlet request servletrequest easy mock easymock create mock createmock servlet request servletrequest servlet response servletresponse servlet response servletresponse easy mock easymock create mock createmock servlet response servletresponse async listener asynclistener listener async listener asynclistener override on timeout ontimeout async event asyncevent event i o exception ioexception check request response checkrequestresponse event override on start async onstartasync async event asyncevent event i o exception ioexception check request response checkrequestresponse event override on error onerror async event asyncevent event i o exception ioexception check request response checkrequestresponse event override on complete oncomplete async event asyncevent event i o exception ioexception check request response checkrequestresponse event check request response checkrequestresponse async event asyncevent event assert equals assertequals servlet request servletrequest event get supplied request getsuppliedrequest assert equals assertequals servlet response servletresponse event get supplied response getsuppliedresponse context context easy mock easymock create mock createmock context loader loader easy mock easymock create mock createmock loader response response response request request request request set coyote request setcoyoterequest org apache coyote request request set context setcontext context async context impl asynccontextimpl async context impl asynccontextimpl request easy mock easymock expect context get application event listeners getapplicationeventlisteners and return andreturn easy mock easymock expect context get loader getloader and return andreturn loader easy mock easymock expect loader get class loader getclassloader and return andreturn easy mock easymock rep lay replay context loader add listener addlistener listener servlet request servletrequest servlet response servletresponse set started setstarted context request response add listener addlistener listener servlet request servletrequest servlet response servletresponse set error state seterrorstate exception fire on complete fireoncomplete easy mock easymock verify context loader https apache org bug zilla bugzilla bug cgi test test async dispatch url with spaces testasyncdispatchurlwithspaces exception do test dispatch with spaces dotestdispatchwithspaces test test for ward dispatch url with spaces testforwarddispatchurlwithspaces exception do test dispatch with spaces dotestdispatchwithspaces do test dispatch with spaces dotestdispatchwithspaces async exception tomcat tomcat get tomcat instance gettomcatinstance context context tomcat add context addcontext async servlet async dispatch url with spaces servlet asyncdispatchurlwithspacesservlet wrapper tomcat add servlet addservlet context space set async supported setasyncsupported tomcat add servlet addservlet context space for ward dispatch url with spaces servlet forwarddispatchurlwithspacesservlet context add servlet mapping addservletmapping space space tomcat start byte chunk bytechunk response body responsebody byte chunk bytechunk get url geturl http localhost get port getport foo bar response body responsebody assert equals assertequals async dispatch url with spaces servlet asyncdispatchurlwithspacesservlet http servlet httpservlet serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception integer count obj countobj integer req get attribute getattribute count count count obj countobj count count obj countobj int value intvalue count req set attribute setattribute count integer value of valueof count string encoded uri encodeduri req getrequesturi u decoder udecoder u decoder udecoder u decoder udecoder string decoded uri decodeduri u decoder udecoder convert encoded uri encodeduri trigger error suppress warnings suppresswarnings unused uri uri encoded uri encodeduri uri syntax exception urisyntaxexception servlet exception servletexception count resp set content type setcontenttype text plain resp get writer getwriter print async context asynccontext req start async startasync dispatch decoded uri decodeduri for ward dispatch url with spaces servlet forwarddispatchurlwithspacesservlet http servlet httpservlet serialversionuid override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception i o exception ioexception integer count obj countobj integer req get attribute getattribute count count count obj countobj count count obj countobj int value intvalue count req set attribute setattribute count integer value of valueof count string encoded uri encodeduri req getrequesturi u decoder udecoder u decoder udecoder u decoder udecoder string decoded uri decodeduri u decoder udecoder convert encoded uri encodeduri trigger error suppress warnings suppresswarnings unused uri uri req getrequesturi uri syntax exception urisyntaxexception servlet exception servletexception count resp set content type setcontenttype text plain resp get writer getwriter print request dispatcher requestdispatcher req get request dispatcher getrequestdispatcher decoded uri decodeduri req resp