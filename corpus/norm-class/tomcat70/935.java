licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat jdbc pool int erceptor interceptor java lang management management factory managementfactory java util iterator java util map java util java util concurrent concurrent hash map concurrenthashmap java util concurrent atomic atomic long atomiclong javax management instance already exists exception instancealreadyexistsexception javax management instance not found exception instancenotfoundexception javax management listener not found exception listenernotfoundexception javax management m bean exception mbeanexception javax management m bean notification info mbeannotificationinfo javax management m bean registration exception mbeanregistrationexception javax management malformed object name exception malformedobjectnameexception javax management not compliant bean exception notcompliantmbeanexception javax management notification javax management notification broadcaster support notificationbroadcastersupport javax management notification emitter notificationemitter javax management notification filter notificationfilter javax management notification listener notificationlistener javax management object name objectname javax management runtime operations exception runtimeoperationsexception javax management open mbean openmbean composite data compositedata javax management open mbean openmbean composite data support compositedatasupport javax management open mbean openmbean composite type compositetype javax management open mbean openmbean open data exception opendataexception org apache juli logging log org apache juli logging log factory logfactory org apache tomcat jdbc pool connection pool connectionpool org apache tomcat jdbc pool pool properties poolproperties interceptor property interceptorproperty org apache tomcat jdbc pool pooled connection pooledconnection publishes data jmx not ifications notifications failures happen author fhanik slow query report jmx slowqueryreportjmx slow query report slowqueryreport notification emitter notificationemitter slow query report jmx bean slowqueryreportjmxmbean string slow query not ification notification slow query string failed query not ification notification failed query string object name attribute objectnameattribute object name objectname composite type compositetype slow query type log log log factory logfactory get log getlog slow query report jmx slowqueryreportjmx concurrent hash map concurrenthashmap string slow query report jmx bean slowqueryreportjmxmbean mbeans concurrent hash map concurrenthashmap string slow query report jmx bean slowqueryreportjmxmbean jmx stuff notification broadcaster support notificationbroadcastersupport not ifier notifier notification broadcaster support notificationbroadcastersupport override add notification listener addnotificationlistener notification listener notificationlistener listener notification filter notificationfilter filter object handback illegal argument exception illegalargumentexception not ifier notifier add notification listener addnotificationlistener listener filter handback override m bean notification info mbeannotificationinfo get notification info getnotificationinfo not ifier notifier get notification info getnotificationinfo override remove notification listener removenotificationlistener notification listener notificationlistener listener listener not found exception listenernotfoundexception not ifier notifier remove notification listener removenotificationlistener listener override remove notification listener removenotificationlistener notification listener notificationlistener listener notification filter notificationfilter filter object handback listener not found exception listenernotfoundexception not ifier notifier remove notification listener removenotificationlistener listener filter handback jmx stuff string pool name poolname atomic long atomiclong notify sequence notifysequence atomic long atomiclong notify pool notifypool connection pool connectionpool pool composite type compositetype get composite type getcompositetype slow query type slow query type composite type compositetype slow query report jmx slowqueryreportjmx get name getname composite data type query statistics query stats querystats get field names getfieldnames query stats querystats get field descriptions getfielddescriptions query stats querystats get field types getfieldtypes open data exception opendataexception log warn unable initialize composite data type jmx stats not ifications notifications slow query type override reset connection pool connectionpool parent pooled connection pooledconnection con reset parent con parent pool name poolname parent get name getname pool parent register jmx registerjmx override pool closed poolclosed connection pool connectionpool pool pool name poolname pool get name getname deregister jmx deregisterjmx pool closed poolclosed pool override pool started poolstarted connection pool connectionpool pool pool pool pool started poolstarted pool pool name poolname pool get name getname override string report failed query reportfailedquery string query object args string start throwable query report failed query reportfailedquery query args start notify jmx notifyjmx query failed query not ification notification query notify jmx notifyjmx string query string type sequence notify sequence notifysequence increment and get incrementandget is notify pool isnotifypool pool pool get jmx pool getjmxpool pool get jmx pool getjmxpool notify type query not ifier notifier notification notification notification type sequence system current time millis currenttimemillis query not ifier notifier send notification sendnotification notification runtime operations exception runtimeoperationsexception log is debug enabled isdebugenabled log debug unable send failed query notification override string report slow query reportslowquery string query object args string start delta query report slow query reportslowquery query args start delta notify jmx notifyjmx query slow query not ification notification query jmx operation names pools names pools stored data string get pool names getpoolnames string per pool stats perpoolstats key set keyset to array toarray string jmx operation pool pool unique jvm string get pool name getpoolname pool name poolname is notify pool isnotifypool notify pool notifypool set notify pool setnotifypool notify pool notifypool notify pool notifypool notify pool notifypool jmx operation remove stats connection pool reset stats resetstats concurrent hash map concurrenthashmap string query stats querystats queries per pool stats perpoolstats pool name poolname queries iterator string queries key set keyset iterator has next hasnext remove jmx operation returns queries collected slow query report composite data override composite data compositedata get slow queries d getslowqueriescd open data exception opendataexception composite data support compositedatasupport result concurrent hash map concurrenthashmap string query stats querystats queries per pool stats perpoolstats pool name poolname queries map entry string query stats querystats stats queries entry set entryset stats result composite data support compositedatasupport stats size iterator map entry string query stats querystats stats iterator pos has next hasnext map entry string query stats querystats entry query stats querystats entry get value getvalue result pos get composite data getcompositedata get composite type getcompositetype result deregister jmx deregisterjmx mbeans remove pool name poolname object name objectname oname get object name getobjectname get class getclass pool name poolname management factory managementfactory get platform bean server getplatformmbeanserver unregistermbean oname m bean registration exception mbeanregistrationexception log debug jmx deregistration failed instance not found exception instancenotfoundexception log debug jmx deregistration failed malformed object name exception malformedobjectnameexception log warn jmx deregistration failed runtime operations exception runtimeoperationsexception log warn jmx deregistration failed object name objectname get object name getobjectname clazz string pool name poolname malformed object name exception malformedobjectnameexception object name objectname oname map string interceptor property interceptorproperty properties get properties getproperties properties properties contains key containskey object name attribute objectnameattribute oname object name objectname properties object name attribute objectnameattribute get value getvalue oname object name objectname connection pool connectionpool pool jmx type prefix clazz get name getname pool name poolname oname register jmx registerjmx notify pool is notify pool isnotifypool get composite type getcompositetype object name objectname oname get object name getobjectname get class getclass pool name poolname mbeans put if absent putifabsent pool name poolname management factory managementfactory get platform bean server getplatformmbeanserver registermbean oname log warn slow query report slowqueryreport get name getname jmx support composite type malformed object name exception malformedobjectnameexception log error jmx registration failed jmx data exposed query stats runtime operations exception runtimeoperationsexception log error jmx registration failed jmx data exposed query stats m bean exception mbeanexception log error jmx registration failed jmx data exposed query stats instance already exists exception instancealreadyexistsexception log error jmx registration failed jmx data exposed query stats not compliant bean exception notcompliantmbeanexception log error jmx registration failed jmx data exposed query stats override set properties setproperties map string interceptor property interceptorproperty properties set properties setproperties properties string threshold notify pool notifypool interceptor property interceptorproperty properties threshold set notify pool setnotifypool parse boolean parseboolean get value getvalue