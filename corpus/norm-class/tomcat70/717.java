licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina filters java io exception ioexception java util enumeration java util hash map hashmap java util map javax servlet filter chain filterchain javax servlet servlet context servletcontext javax servlet servlet exception servletexception javax servlet servlet request servletrequest javax servlet servlet response servletresponse javax servlet http http servlet response httpservletresponse javax servlet http http session httpsession org junit assert null assertnull org junit assert true asserttrue org junit org junit test test rest csrf prevention filter testrestcsrfpreventionfilter string non ce nonce non ce nonce string invalid non ce nonce invalid non ce nonce string method string post method post string accepted path accepted jsp string accepted path accepted jsp string accepted paths accepted path accepted path rest csrf prevention filter restcsrfpreventionfilter filter tester request testerrequest request tester response testerresponse response tester filter chain testerfilterchain filter chain filterchain http session httpsession session set up setup filter rest csrf prevention filter restcsrfpreventionfilter override string generate nonce generatenonce non ce nonce request tester request testerrequest response tester response testerresponse filter chain filterchain tester filter chain testerfilterchain session tester session testersession test test get request no session no nonce testgetrequestnosessionnononce exception set request expectations setrequestexpectations method filter do filter dofilter request response filter chain filterchain verify continue chain verifycontinuechain test test post request no session no nonce testpostrequestnosessionnononce exception set request expectations setrequestexpectations post method filter do filter dofilter request response filter chain filterchain verify deny response verifydenyresponse http servlet response httpservletresponse forbidden test test post request session no nonce testpostrequestsessionnononce exception set request expectations setrequestexpectations post method session test post request header scenarios testpostrequestheaderscenarios test test post request session no nonce testpostrequestsessionnononce exception set request expectations setrequestexpectations post method session test post request header scenarios testpostrequestheaderscenarios non ce nonce test test post request session invalid nonce testpostrequestsessioninvalidnonce exception set request expectations setrequestexpectations post method session invalid non ce nonce test post request header scenarios testpostrequestheaderscenarios non ce nonce test test post request session valid nonce testpostrequestsessionvalidnonce exception set request expectations setrequestexpectations post method session non ce nonce test post request header scenarios testpostrequestheaderscenarios non ce nonce test test get fetch request session no nonce testgetfetchrequestsessionnononce exception set request expectations setrequestexpectations method session constants csrf non ce nonce header fetch filter do filter dofilter request response filter chain filterchain verify continue chain nonce available verifycontinuechainnonceavailable test test post fetch request session no nonce testpostfetchrequestsessionnononce exception set request expectations setrequestexpectations post method session constants csrf non ce nonce header fetch test post request header scenarios testpostrequestheaderscenarios test test get fetch request session nonce testgetfetchrequestsessionnonce exception set request expectations setrequestexpectations method session constants csrf non ce nonce header fetch session set attribute setattribute constants csrf non ce nonce session attr non ce nonce filter do filter dofilter request response filter chain filterchain verify continue chain nonce available verifycontinuechainnonceavailable test test post fetch request session nonce testpostfetchrequestsessionnonce exception set request expectations setrequestexpectations post method session constants csrf non ce nonce header fetch test post request header scenarios testpostrequestheaderscenarios non ce nonce test test post request custom deny status testpostrequestcustomdenystatus exception set request expectations setrequestexpectations post method filter set deny status setdenystatus http servlet response httpservletresponse bad request filter do filter dofilter request response filter chain filterchain verify deny response verifydenyresponse http servlet response httpservletresponse bad request test test post request valid nonce as parameter valid path testpostrequestvalidnonceasparametervalidpath exception set request expectations setrequestexpectations post method session string non ce nonce accepted path test post request params scenarios testpostrequestparamsscenarios non ce nonce test test post request valid nonce as parameter valid path testpostrequestvalidnonceasparametervalidpath exception set request expectations setrequestexpectations post method session string non ce nonce accepted path test post request params scenarios testpostrequestparamsscenarios non ce nonce test test post request invalid nonce as parameter valid path testpostrequestinvalidnonceasparametervalidpath exception set request expectations setrequestexpectations post method session string invalid non ce nonce accepted path test post request params scenarios testpostrequestparamsscenarios non ce nonce test test post request valid nonce as parameter invalid path testpostrequestvalidnonceasparameterinvalidpath exception set request expectations setrequestexpectations post method session string non ce nonce accepted path blah test post request params scenarios testpostrequestparamsscenarios non ce nonce test test post request valid nonce as parameter no path testpostrequestvalidnonceasparameternopath exception set request expectations setrequestexpectations post method session string non ce nonce accepted path test post request params scenarios testpostrequestparamsscenarios non ce nonce test test post request valid nonce as parameter no nonce in session testpostrequestvalidnonceasparameternononceinsession exception set request expectations setrequestexpectations post method session string non ce nonce accepted path test post request params scenarios testpostrequestparamsscenarios test test post request valid nonce as parameter invalid nonce as header testpostrequestvalidnonceasparameterinvalidnonceasheader exception set request expectations setrequestexpectations post method session invalid non ce nonce string non ce nonce accepted path test post request params scenarios testpostrequestparamsscenarios non ce nonce test test post request no nonce as parameter and header valid path testpostrequestnononceasparameterandheadervalidpath exception set request expectations setrequestexpectations post method session accepted path test post request params scenarios testpostrequestparamsscenarios non ce nonce test test post request multiple valid n onces as parameter valid path testpostrequestmultiplevalidnoncesasparametervalidpath exception set request expectations setrequestexpectations post method session string non ce nonce non ce nonce accepted path test post request params scenarios testpostrequestparamsscenarios non ce nonce test test post request multiple n onces as parameter valid path testpostrequestmultiplenoncesasparametervalidpath exception set request expectations setrequestexpectations post method session string non ce nonce invalid non ce nonce accepted path test post request params scenarios testpostrequestparamsscenarios non ce nonce test test post request multiple invalid n onces as parameter valid path testpostrequestmultipleinvalidnoncesasparametervalidpath exception set request expectations setrequestexpectations post method session string invalid non ce nonce invalid non ce nonce accepted path test post request params scenarios testpostrequestparamsscenarios non ce nonce test test request fetch nonce as parameter testgetrequestfetchnonceasparameter exception set request expectations setrequestexpectations method string constants csrf non ce nonce header fetch accepted path filter set paths acc epting params setpathsacceptingparams accepted paths filter do filter dofilter request response filter chain filterchain verify continue chain nonce not available verifycontinuechainnoncenotavailable test post request header scenarios testpostrequestheaderscenarios string session attr sessionattr deny response denyresponse exception test post request params scenarios testpostrequestparamsscenarios session attr sessionattr deny response denyresponse test post request params scenarios testpostrequestparamsscenarios string session attr sessionattr deny response denyresponse configure paths configurepaths exception session set attribute setattribute constants csrf non ce nonce session attr session attr sessionattr configure paths configurepaths filter set paths acc epting params setpathsacceptingparams accepted paths filter do filter dofilter request response filter chain filterchain deny response denyresponse verify deny response verifydenyresponse http servlet response httpservletresponse forbidden verify continue chain verifycontinuechain set request expectations setrequestexpectations string method http session httpsession session string header value headervalue set request expectations setrequestexpectations method session header value headervalue set request expectations setrequestexpectations string method http session httpsession session string header value headervalue string param values paramvalues string servlet path servletpath request set method setmethod method request set session setsession session request set header setheader constants csrf non ce nonce header header value headervalue request set parameter values setparametervalues param values paramvalues request set servlet path setservletpath servlet path servletpath verify continue chain verifycontinuechain assert true asserttrue filter chain filterchain is visited isvisited verify continue chain nonce available verifycontinuechainnonceavailable assert true asserttrue non ce nonce equals response get header getheader constants csrf non ce nonce header verify continue chain verifycontinuechain verify continue chain nonce not available verifycontinuechainnoncenotavailable assert null assertnull response get header getheader constants csrf non ce nonce header verify continue chain verifycontinuechain verify deny response verifydenyresponse status code statuscode assert true asserttrue constants csrf non ce nonce header required equals response get header getheader constants csrf non ce nonce header assert true asserttrue status code statuscode response get status getstatus assert true asserttrue filter chain filterchain is visited isvisited tester filter chain testerfilterchain filter chain filterchain visited override do filter dofilter servlet request servletrequest request servlet response servletresponse response io exception ioexception servlet exception servletexception visited is visited isvisited visited tester request testerrequest tester http servlet request testerhttpservletrequest http session httpsession session string param values paramvalues string servlet path servletpath set session setsession http session httpsession session session session override http session httpsession get session getsession create session set parameter values setparametervalues string param values paramvalues param values paramvalues param values paramvalues override string get parameter values getparametervalues string param values paramvalues set servlet path setservletpath string servlet path servletpath servlet path servletpath servlet path servletpath override string get servlet path getservletpath servlet path servletpath override string get path info getpathinfo tester response testerresponse tester http servlet response testerhttpservletresponse override send error senderror status string message io exception ioexception set status setstatus status tester session testersession http session httpsession map string object attributes hash map hashmap string object override get creation time getcreationtime override string get id getid override get last accessed time getlastaccessedtime override servlet context servletcontext get servlet context getservletcontext override set max inactive interval setmaxinactiveinterval int erval interval override get max inactive interval getmaxinactiveinterval override deprecated javax servlet http http session context httpsessioncontext get session context getsessioncontext override object get attribute getattribute string attributes override object get value getvalue string override enumeration string get attribute names getattributenames override string get value names getvaluenames override set attribute setattribute string object attributes override put value putvalue string object override remove attribute removeattribute string override remove value removevalue string override invalid ate invalidate override is new isnew