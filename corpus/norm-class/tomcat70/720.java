licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina filters java io exception ioexception java util hash set hashset java util java util regex pattern javax servlet filter chain filterchain javax servlet servlet exception servletexception javax servlet servlet request servletrequest javax servlet servlet response servletresponse javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse javax servlet http http session httpsession basic csrf protection api s apis filter assumes clients adapted transfer nonce csrf token header pre positive scenario client server fetch request jsessionid csrf token pair generation response fetch request jsessionid csrf token pair cached post request valid nonce jsessionid csrf token pair validation response post request negative scenario client server post request nonce jsessionid csrf token pair validation request rejected client server post request invalid nonce jsessionid csrf token pair validation request rejected pre rest csrf prevention filter restcsrfpreventionfilter csrf prevention filter base csrfpreventionfilterbase enum method type methodtype modifying method modifying method pattern modifying methods pattern pattern compile head options string paths acc epting params pathsacceptingparams hash set hashset string string paths delimiter pathsdelimiter override do filter dofilter servlet request servletrequest request servlet response servletresponse response filter chain filterchain chain io exception ioexception servlet exception servletexception request http servlet request httpservletrequest response http servlet response httpservletresponse method type methodtype m type mtype method type methodtype modifying method string method http servlet request httpservletrequest request get method getmethod method modifying methods pattern matcher method matches m type mtype method type methodtype modifying method rest csrf prevention strategy restcsrfpreventionstrategy strategy m type mtype modifying method strategy fetch request fetchrequest strategy state changing request statechangingrequest strategy apply http servlet request httpservletrequest request http servlet response httpservletresponse response chain do filter dofilter request response rest csrf prevention strategy restcsrfpreventionstrategy apply http servlet request httpservletrequest request http servlet response httpservletresponse response io exception ioexception string extract nonce from request header extractnoncefromrequestheader http servlet request httpservletrequest request string key request get header getheader key string extract nonce from request params extractnoncefromrequestparams http servlet request httpservletrequest request string key request get parameter values getparametervalues key store nonce to response storenoncetoresponse http servlet response httpservletresponse response string key string response set header setheader key string extract nonce from session extractnoncefromsession http session httpsession session string key session string session get attribute getattribute key store nonce to session storenoncetosession http session httpsession session string key object session set attribute setattribute key state changing request statechangingrequest rest csrf prevention strategy restcsrfpreventionstrategy override apply http servlet request httpservletrequest request http servlet response httpservletresponse response io exception ioexception is valid state changing request isvalidstatechangingrequest extract nonce from request extractnoncefromrequest request extract nonce from session extractnoncefromsession request get session getsession constants csrf non ce nonce session attr store nonce to response storenoncetoresponse response constants csrf non ce nonce header constants csrf non ce nonce header required response send error senderror get deny status getdenystatus get string getstring rest csrf prevention filter restcsrfpreventionfilter invalid nonce invalidnonce is valid state changing request isvalidstatechangingrequest string req nonce reqnonce string session nonce sessionnonce req nonce reqnonce session nonce sessionnonce req nonce reqnonce equals session nonce sessionnonce string extract nonce from request extractnoncefromrequest http servlet request httpservletrequest request string nonce from request noncefromrequest extract nonce from request header extractnoncefromrequestheader request constants csrf non ce nonce header nonce from request noncefromrequest equals nonce from request noncefromrequest get paths acc epting params getpathsacceptingparams is empty isempty get paths acc epting params getpathsacceptingparams get requested path getrequestedpath request nonce from request noncefromrequest extract nonce from request params extractnoncefromrequestparams request nonce from request noncefromrequest string extract nonce from request params extractnoncefromrequestparams http servlet request httpservletrequest request string params extract nonce from request params extractnoncefromrequestparams request constants csrf non ce nonce header params params length string nonce params string param params param equals nonce nonce fetch request fetchrequest rest csrf prevention strategy restcsrfpreventionstrategy override apply http servlet request httpservletrequest request http servlet response httpservletresponse response constants csrf non ce nonce header fetch equals ignore case equalsignorecase extract nonce from request header extractnoncefromrequestheader request constants csrf non ce nonce header string nonce from session str noncefromsessionstr extract nonce from session extractnoncefromsession request get session getsession constants csrf non ce nonce session attr nonce from session str noncefromsessionstr nonce from session str noncefromsessionstr generate nonce generatenonce store nonce to session storenoncetosession request get session getsession constants csrf non ce nonce session attr nonce from session str noncefromsessionstr store nonce to response storenoncetoresponse response constants csrf non ce nonce header nonce from session str noncefromsessionstr comma separated list url s urls accept non ces nonces request parameter csrf token cases nonce header provide request parameters csrf token header preference parameter request request parameters fetch nonce header param paths list pathslist comma separated list url s urls configured paths accepting request parameters nonce set paths acc epting params setpathsacceptingparams string paths list pathslist paths list pathslist string element paths list pathslist split paths delimiter pathsdelimiter paths acc epting params pathsacceptingparams add element trim string get paths acc epting params getpathsacceptingparams paths acc epting params pathsacceptingparams