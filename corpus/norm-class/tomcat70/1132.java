licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina authenticator java util array list arraylist java util hash map hashmap java util list java util map javax servlet http http servlet response httpservletresponse org junit assert equals assertequals org junit assert true asserttrue org junit test org apache catalina context org apache catalina deploy login config loginconfig org apache catalina deploy security collection securitycollection org apache catalina deploy security constraint securityconstraint org apache catalina session manager base managerbase org apache catalina startup tester servlet testerservlet org apache catalina startup tomcat org apache catalina startup tomcat base test tomcatbasetest org apache tomcat util buf c converter cconverter org apache tomcat util buf byte chunk bytechunk org apache tomcat util code c codec binary base test basic authenticator basicauthenticator non login authenticator nonloginauthenticator single sign on singlesignon valve active absence sso support authenticator classes simple behaviour testing operate independently confirm sso logic accidentally triggered test non login and basic authenticator testnonloginandbasicauthenticator tomcat base test tomcatbasetest cookies cookies cookies string user user string pwd pwd string role role string nice method basic string http prefix http localhost string context path nologin nologin string context path login login string uri string uri any one can access anyonecanaccess session timeout mins session timeout mins manager scan interval secs manager expire sessions fast extra delay secs timeout delay msecs session timeout mins manager scan interval secs manager expire sessions fast extra delay secs string client header authorization string server header auth enticate authenticate string server cookie header cookie string client cookie header cookie basic credentials basiccredentials credentials basic credentials basiccredentials good credentials basic credentials basiccredentials nice method user pwd basic credentials basiccredentials strange credentials basic credentials basiccredentials b as ic basic user pwd basic credentials basiccredentials bad credentials basic credentials basiccredentials nice method user wrong basic credentials basiccredentials bad method basic credentials basiccredentials bad method badmethod user pwd basic credentials basiccredentials space d spaced base basic credentials basiccredentials nice method user pwd basic credentials basiccredentials space d spaced use rname username basic credentials basiccredentials nice method user pwd basic credentials basiccredentials space d spaced password basic credentials basiccredentials nice method user pwd tomcat tomcat context basic context basiccontext context non login context nonlogincontext list string cookies access unprotected resource webapp login method defined permitted test test accept public non login testacceptpublicnonlogin exception do test non login dotestnonlogin context path nologin uri cookies http servlet response httpservletresponse access resource webapp login method defined rejected forbidden status test test reject protected non login testrejectprotectednonlogin exception do test non login dotestnonlogin context path nologin uri cookies http servlet response httpservletresponse forbidden access unprotected resource webapp basic login method defined permitted challenge test test accept public basic testacceptpublicbasic exception do test basic dotestbasic context path login uri credentials cookies http servlet response httpservletresponse access resource webapp basic login method defined access challenged unauthorized permitted authenticated test test accept protected basic testacceptprotectedbasic exception do test basic dotestbasic context path login uri credentials cookies http servlet response httpservletresponse unauthorized do test basic dotestbasic context path login uri good credentials cookies http servlet response httpservletresponse test accept protected basic testacceptprotectedbasic invalid password test test auth method bad credentials testauthmethodbadcredentials exception do test basic dotestbasic context path login uri credentials cookies http servlet response httpservletresponse unauthorized do test basic dotestbasic context path login uri bad credentials cookies http servlet response httpservletresponse unauthorized test accept protected basic testacceptprotectedbasic verify server rfc treating scheme token insensitive test test auth method case basic testauthmethodcasebasic exception do test basic dotestbasic context path login uri credentials cookies http servlet response httpservletresponse unauthorized do test basic dotestbasic context path login uri strange credentials cookies http servlet response httpservletresponse test accept protected basic testacceptprotectedbasic invalid authentication method note container ensures basic login method called basic authenticator basicauthenticator find expected authentication header method extract credentials request rejected unauthorized status rfc response body identify schemes accept able acceptable container test test auth method bad method testauthmethodbadmethod exception do test basic dotestbasic context path login uri credentials cookies http servlet response httpservletresponse unauthorized do test basic dotestbasic context path login uri bad method cookies http servlet response httpservletresponse unauthorized test accept protected basic testacceptprotectedbasic excess white space authentication method access challenged unauthorized permitted authenticated rfc define separation syntax scheme basic credentials tokens tomcat tolerates amount white space limits http header sizes returns test test auth method extra space testauthmethodextraspace exception do test basic dotestbasic context path login uri credentials cookies http servlet response httpservletresponse unauthorized do test basic dotestbasic context path login uri space d spaced base cookies http servlet response httpservletresponse test accept protected basic testacceptprotectedbasic white space username credential request rejected unauthorized status todo rfc define separation syntax scheme basic credentials tokens tomcat tolerate reasonable amount white space test test user extra space testuserextraspace exception do test basic dotestbasic context path login uri credentials cookies http servlet response httpservletresponse unauthorized do test basic dotestbasic context path login uri space d spaced use rname username cookies http servlet response httpservletresponse unauthorized test accept protected basic testacceptprotectedbasic white space password credential request rejected unauthorized status todo rfc define separation syntax scheme basic credentials tokens tomcat tolerate reasonable amount white space test test password extra space testpasswordextraspace exception do test basic dotestbasic context path login uri credentials cookies http servlet response httpservletresponse unauthorized do test basic dotestbasic context path login uri space d spaced password cookies http servlet response httpservletresponse unauthorized behaviour basic authentication create session server verify client required send valid authenticate header request access resources test test basic login without session testbasicloginwithoutsession exception identical test auth method case basic testauthmethodcasebasic do test basic dotestbasic context path login uri credentials cookies http servlet response httpservletresponse unauthorized do test basic dotestbasic context path login uri good credentials cookies http servlet response httpservletresponse access resource providing credentials conf irms confirms server retained data authenticate client expect challenged unauthorized do test basic dotestbasic context path login uri credentials cookies http servlet response httpservletresponse unauthorized provide credentials confirm resource accessed authentication header do test basic dotestbasic context path login uri good credentials cookies http servlet response httpservletresponse test optional behaviour basic authentication create session server server session cookie access resource credentials unauthorized status access resource providing credentials status server session cookie access resource session cookie repeat session cookie note form authenticator formauthenticator step process session fixation att acks attacks authenticator base authenticatorbase change session id on authentication changesessionidonauthentication setting basic authenticator basicauthenticator step process authenticator base authenticatorbase reissue session id sessionid test test basic login session persistence testbasicloginsessionpersistence exception set always use session setalwaysusesession identical test auth method case basic testauthmethodcasebasic do test basic dotestbasic context path login uri credentials cookies http servlet response httpservletresponse unauthorized do test basic dotestbasic context path login uri good credentials cookies http servlet response httpservletresponse confirm session rec ognised recognised server do test basic dotestbasic context path login uri credentials cookies http servlet response httpservletresponse unauthorized provide harvested session cookie authentication do test basic dotestbasic context path login uri credentials cookies http servlet response httpservletresponse cookie do test basic dotestbasic context path login uri credentials cookies http servlet response httpservletresponse verify timeout mechanism works basic sessions test flow test basic login session persistence testbasicloginsessionpersistence test test basic login session timeout testbasicloginsessiontimeout exception set always use session setalwaysusesession set r api d session timeout setrapidsessiontimeout identical test auth method case basic testauthmethodcasebasic do test basic dotestbasic context path login uri credentials cookies http servlet response httpservletresponse unauthorized do test basic dotestbasic context path login uri good credentials cookies http servlet response httpservletresponse provide harvested session cookie authentication list string original cookies originalcookies cookies do test basic dotestbasic context path login uri credentials cookies http servlet response httpservletresponse session time lose authentication thread sleep timeout delay msecs provide harvested session cookie authentication confirm expired do test basic dotestbasic context path login uri credentials cookies http servlet response httpservletresponse unauthorized basic reauthentication session do test basic dotestbasic context path login uri credentials cookies http servlet response httpservletresponse unauthorized do test basic dotestbasic context path login uri good credentials cookies http servlet response httpservletresponse par anoid paranoid verification same cookies samecookies original cookies originalcookies equals cookies assert true asserttrue same cookies samecookies log on logon access resource webapp basic authentication access resource webapp login method rejected forbidden status conf irming confirming cross authentication web apps webapps test test basic login reject protected testbasicloginrejectprotected exception do test basic dotestbasic context path login uri credentials cookies http servlet response httpservletresponse unauthorized do test basic dotestbasic context path login uri good credentials cookies http servlet response httpservletresponse do test non login dotestnonlogin context path nologin uri cookies http servlet response httpservletresponse forbidden session cookie basic webapp request access webapp login method equivalent single sign on signon valve verify cross authentication logic test basic login reject protected testbasicloginrejectprotected rejected forbidden status test test basic login reject protected with session testbasicloginrejectprotectedwithsession exception set always use session setalwaysusesession do test basic dotestbasic context path login uri credentials cookies http servlet response httpservletresponse unauthorized do test basic dotestbasic context path login uri good credentials cookies http servlet response httpservletresponse session cookie harvested webapp do test non login dotestnonlogin context path nologin uri cookies http servlet response httpservletresponse forbidden do test non login dotestnonlogin string uri use cookie usecookie expectedrc exception map string list string req headers reqheaders hash map hashmap string list string map string list string resp headers respheaders hash map hashmap string list string use cookie usecookie cookies req headers reqheaders client cookie header cookies byte chunk bytechunk byte chunk bytechunk get url geturl http prefix get port getport uri req headers reqheaders resp headers respheaders expectedrc http servlet response httpservletresponse assert equals assertequals expectedrc assert true asserttrue get length getlength assert equals assertequals to string tostring do test basic dotestbasic string uri basic credentials basiccredentials credentials use cookie usecookie expectedrc exception map string list string req headers reqheaders hash map hashmap string list string map string list string resp headers respheaders hash map hashmap string list string use cookie usecookie cookies req headers reqheaders client cookie header cookies credentials list string array list arraylist string add credentials get credentials getcredentials req headers reqheaders client header byte chunk bytechunk byte chunk bytechunk get url geturl http prefix get port getport uri req headers reqheaders resp headers respheaders expectedrc http servlet response httpservletresponse assert equals assertequals expectedrc assert true asserttrue get length getlength expectedrc http servlet response httpservletresponse unauthorized server identify accept able acceptable method method found methodfound list string auth headers authheaders resp headers respheaders server header string auth header authheader auth headers authheaders auth header authheader index of indexof nice method method found methodfound assert true asserttrue method found methodfound assert equals assertequals to string tostring list string new cookies newcookies resp headers respheaders server cookie header new cookies newcookies harvest cookies server sends cookies new cookies newcookies setup web apps webapps test not e note tear down teardown method tomcat override set up setup exception set up setup create tomcat server memory realm tomcat get tomcat instance gettomcatinstance add test user role realm tomcat add user adduser user pwd tomcat add role addrole user role setup non login nonlogin login web apps webapps set up non login setupnonlogin set up login setuplogin tomcat start set up non login setupnonlogin exception file system doc base docbase required non login context nonlogincontext tomcat add context addcontext context path nologin non login context nonlogincontext set session timeout setsessiontimeout session timeout mins add servlet context tomcat add servlet addservlet non login context nonlogincontext tester servlet testerservlet tester servlet testerservlet non login context nonlogincontext add servlet mapping addservletmapping uri tester servlet testerservlet security collection securitycollection collection security collection securitycollection collection add pattern addpattern uri security constraint securityconstraint security constraint securityconstraint add auth role addauthrole role add collection addcollection collection non login context nonlogincontext add constraint addconstraint add unprotected servlet context tomcat add servlet addservlet non login context nonlogincontext tester servlet testerservlet tester servlet testerservlet non login context nonlogincontext add servlet mapping addservletmapping uri tester servlet testerservlet security collection securitycollection collection security collection securitycollection collection add pattern addpattern uri security constraint securityconstraint security constraint securityconstraint add role signals access permitted add collection addcollection collection non login context nonlogincontext add constraint addconstraint configure authenticator inherit realm engine login config loginconfig login config loginconfig set auth method setauthmethod non login context nonlogincontext set login config setloginconfig authenticator base authenticatorbase non login authenticator nonloginauthenticator non login authenticator nonloginauthenticator non login context nonlogincontext get pipeline getpipeline add valve addvalve non login authenticator nonloginauthenticator set up login setuplogin exception file system doc base docbase required basic context basiccontext tomcat add context addcontext context path login basic context basiccontext set session timeout setsessiontimeout session timeout mins add servlet context tomcat add servlet addservlet basic context basiccontext tester servlet testerservlet tester servlet testerservlet basic context basiccontext add servlet mapping addservletmapping uri tester servlet testerservlet security collection securitycollection collection security collection securitycollection collection add pattern addpattern uri security constraint securityconstraint security constraint securityconstraint add auth role addauthrole role add collection addcollection collection basic context basiccontext add constraint addconstraint add unprotected servlet context tomcat add servlet addservlet basic context basiccontext tester servlet testerservlet tester servlet testerservlet basic context basiccontext add servlet mapping addservletmapping uri tester servlet testerservlet security collection securitycollection collection security collection securitycollection collection add pattern addpattern uri security constraint securityconstraint security constraint securityconstraint add role signals access permitted add collection addcollection collection basic context basiccontext add constraint addconstraint configure authenticator inherit realm engine login config loginconfig login config loginconfig set auth method setauthmethod basic basic context basiccontext set login config setloginconfig authenticator base authenticatorbase basic authenticator basicauthenticator basic authenticator basicauthenticator basic context basiccontext get pipeline getpipeline add valve addvalve basic authenticator basicauthenticator force behaviour auth enticators authenticators set always use session setalwaysusesession authenticator base authenticatorbase basic context basiccontext get authenticator getauthenticator set always use session setalwaysusesession authenticator base authenticatorbase non login context nonlogincontext get authenticator getauthenticator set always use session setalwaysusesession force rapid timeout scanning basic authentication webapp standard manager standardmanager service cycle time seconds session exp iry expiry scan cycles set r api d session timeout setrapidsessiontimeout manager base managerbase basic context basiccontext get manager getmanager set process expires frequency setprocessexpiresfrequency manager expire sessions fast encapsulate logic generate http header basic authentication note int ernally internally validate arguments basic credentials basiccredentials string method string username string password string credentials basic credentials basiccredentials string a method amethod string a username ausername string a password apassword method a method amethod username a username ausername password a password apassword string user credentials usercredentials username password credentials bytes credentialsbytes user credentials usercredentials get bytes getbytes c converter cconverter iso string base base encode base encodebase string credentials bytes credentialsbytes credentials method base string get credentials getcredentials credentials