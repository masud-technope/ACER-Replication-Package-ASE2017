licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat websocket java io exception ioexception java output stream outputstream java writer java nio byte buffer bytebuffer java nio char buffer charbuffer java nio charset charset encoder charsetencoder java nio charset code r result coderresult java util array deque arraydeque java util array list arraylist java util list java util queue java util concurrent execution exception executionexception java util concurrent java util concurrent time unit timeunit java util concurrent timeout exception timeoutexception java util concurrent atomic atomic boolean atomicboolean javax websocket close reason closereason javax websocket close reason closereason close codes closecodes javax websocket deployment exception deploymentexception javax websocket encode exception encodeexception javax websocket encoder javax websocket endpoint config endpointconfig javax websocket remote endpoint remoteendpoint javax websocket send handler sendhandler javax websocket send result sendresult org apache juli logging log org apache juli logging log factory logfactory org apache tomcat util buf utf encoder org apache tomcat util res string manager stringmanager ws remote endpoint impl base wsremoteendpointimplbase remote endpoint remoteendpoint string manager stringmanager string manager stringmanager get manager getmanager constants millis econds milliseconds seconds blocking send timeout string blocking send timeout property org apache tomcat websocket blocking send timeout log log log factory logfactory get log getlog ws remote endpoint impl base wsremoteendpointimplbase state machine statemachine state machine statemachine state machine statemachine int ermediate message handler intermediatemessagehandler int ermediate message handler intermediatemessagehandler int ermediate message handler intermediatemessagehandler transformation transformation message part in progress messagepartinprogress queue message part messagepart message part queue messagepartqueue array deque arraydeque message part messagepart object message part lock messagepartlock object closed fragmented next fragmented nextfragmented text next text nexttext max size web socket websocket header bytes byte buffer bytebuffer header buffer headerbuffer byte buffer bytebuffer all ocate allocate byte buffer bytebuffer output buffer outputbuffer byte buffer bytebuffer all ocate allocate constants buffer size charset encoder charsetencoder encoder utf encoder byte buffer bytebuffer encoder buffer encoderbuffer byte buffer bytebuffer all ocate allocate constants buffer size atomic boolean atomicboolean batching allowed batchingallowed atomic boolean atomicboolean send timeout sendtimeout ws session wssession ws session wssession list encoder entry encoderentry encoder entries encoderentries array list arraylist encoder entry encoderentry set transformation settransformation transformation transformation transformation transformation get send timeout getsendtimeout send timeout sendtimeout set send timeout setsendtimeout timeout send timeout sendtimeout timeout override set batching allowed setbatchingallowed batching allowed batchingallowed io exception ioexception old value oldvalue batching allowed batchingallowed get and set getandset batching allowed batchingallowed old value oldvalue batching allowed batchingallowed flush batch flushbatch override get batching allowed getbatchingallowed batching allowed batchingallowed override flush batch flushbatch io exception ioexception start message block startmessageblock constants internal opcode flush send bytes sendbytes byte buffer bytebuffer data io exception ioexception data illegal argument exception illegalargumentexception get string getstring ws remote endpoint wsremoteendpoint null data nulldata state machine statemachine binary start binarystart start message block startmessageblock constants opcode binary data state machine statemachine complete send bytes by future sendbytesbyfuture byte buffer bytebuffer data future to send handler futuretosendhandler future to send handler futuretosendhandler ws session wssession send bytes by completion sendbytesbycompletion data send bytes by completion sendbytesbycompletion byte buffer bytebuffer data send handler sendhandler handler data illegal argument exception illegalargumentexception get string getstring ws remote endpoint wsremoteendpoint null data nulldata handler illegal argument exception illegalargumentexception get string getstring ws remote endpoint wsremoteendpoint null handler nullhandler state update send handler stateupdatesendhandler sush state update send handler stateupdatesendhandler handler state machine statemachine binary start binarystart start message startmessage constants opcode binary data sush send partial bytes sendpartialbytes byte buffer bytebuffer partial byte partialbyte io exception ioexception partial byte partialbyte illegal argument exception illegalargumentexception get string getstring ws remote endpoint wsremoteendpoint null data nulldata state machine statemachine binary partial start binarypartialstart start message block startmessageblock constants opcode binary partial byte partialbyte state machine statemachine complete override send ping sendping byte buffer bytebuffer application data applicationdata io exception ioexception illegal argument exception illegalargumentexception application data applicationdata remaining illegal argument exception illegalargumentexception get string getstring ws remote endpoint wsremoteendpoint too much data toomuchdata start message block startmessageblock constants opcode ping application data applicationdata override send pong sendpong byte buffer bytebuffer application data applicationdata io exception ioexception illegal argument exception illegalargumentexception application data applicationdata remaining illegal argument exception illegalargumentexception get string getstring ws remote endpoint wsremoteendpoint too much data toomuchdata start message block startmessageblock constants opcode pong application data applicationdata send string sendstring string text io exception ioexception text illegal argument exception illegalargumentexception get string getstring ws remote endpoint wsremoteendpoint null data nulldata state machine statemachine text start textstart send partial string sendpartialstring char buffer charbuffer wrap text send string by future sendstringbyfuture string text future to send handler futuretosendhandler future to send handler futuretosendhandler ws session wssession send string by completion sendstringbycompletion text send string by completion sendstringbycompletion string text send handler sendhandler handler text illegal argument exception illegalargumentexception get string getstring ws remote endpoint wsremoteendpoint null data nulldata handler illegal argument exception illegalargumentexception get string getstring ws remote endpoint wsremoteendpoint null handler nullhandler state machine statemachine text start textstart text message send handler textmessagesendhandler tmsh text message send handler textmessagesendhandler handler char buffer charbuffer wrap text encoder encoder buffer encoderbuffer tmsh write text message send handler textmessagesendhandler update state machine statemachine comp letes completes send partial string sendpartialstring string fragment is last islast io exception ioexception fragment illegal argument exception illegalargumentexception get string getstring ws remote endpoint wsremoteendpoint null data nulldata state machine statemachine text partial start textpartialstart send partial string sendpartialstring char buffer charbuffer wrap fragment is last islast output stream outputstream get send stream getsendstream state machine statemachine stream start streamstart ws output stream wsoutputstream writer get send writer getsendwriter state machine statemachine write start writestart ws writer wswriter send partial string sendpartialstring char buffer charbuffer io exception ioexception timeout send message message trigger session close depending timing client session close read timeout timeout get blocking send timeout getblockingsendtimeout future to send handler futuretosendhandler future to send handler futuretosendhandler ws session wssession text message send handler textmessagesendhandler tmsh text message send handler textmessagesendhandler encoder encoder buffer encoderbuffer tmsh write timeout timeout time unit timeunit milliseconds interrupted exception interruptedexception handle send failure handlesendfailure execution exception executionexception io exception ioexception timeout exception timeoutexception io exception ioexception start message block startmessageblock op code opcode byte buffer bytebuffer payload io exception ioexception timeout send message message trigger session close depending timing client session close read timeout timeout get blocking send timeout getblockingsendtimeout future to send handler futuretosendhandler future to send handler futuretosendhandler ws session wssession op code opcode constants opcode close start message startmessage op code opcode payload timeout timeout time unit timeunit milliseconds interrupted exception interruptedexception handle send failure handlesendfailure execution exception executionexception io exception ioexception timeout exception timeoutexception io exception ioexception start message startmessage op code opcode byte buffer bytebuffer payload send handler sendhandler handler ws session wssession update last active updatelastactive list message part messagepart message parts messageparts array list arraylist message part messagepart message parts messageparts add message part messagepart op code opcode payload int ermediate message handler intermediatemessagehandler end message handler endmessagehandler handler message parts messageparts transformation send message part sendmessagepart message parts messageparts trigger sup pler suppler send handler sendhandler message parts messageparts size handler on result onresult send result sendresult message part messagepart message parts messageparts remove do write dowrite message part lock messagepartlock constants opcode close get op code getopcode get batching allowed getbatchingallowed happen late send batched messages session closed comp lain complain loudly log warn get string getstring ws remote endpoint wsremoteendpoint flush on close failed flushonclosefailed message part in progress messagepartinprogress control message message control message queue d queued chances subsequent data message queue d queued control message logic machine end message handler endmessagehandler text message send handler textmessagesendhandler ensures data message queue multiple control messages queue add queue message part queue messagepartqueue add message part in progress messagepartinprogress do write dowrite add remaining messages queue message part queue messagepartqueue add all addall message parts messageparts do write dowrite actual write sync block avoid deadlock message part lock messagepartlock write lock writelock coyote http upgrade abstract servlet output stream abstractservletoutputstream write message part writemessagepart end message endmessage send handler sendhandler handler send result sendresult result do write dowrite message part messagepart mp next mpnext message part lock messagepartlock fragmented next fragmented nextfragmented text next text nexttext mp next mpnext message part queue messagepartqueue poll mp next mpnext message part in progress messagepartinprogress closed session closed unexpectedly middle sending fragmented message closing endpoint point send message do write dowrite do write dowrite actual write sync block avoid deadlock message part lock messagepartlock write lock writelock coyote http upgrade abstract servlet output stream abstractservletoutputstream write message part writemessagepart mp next mpnext ws session wssession update last active updatelastactive nested handler handler handler handler on result onresult result write message part writemessagepart message part messagepart closed illegal state exception illegalstateexception get string getstring ws remote endpoint wsremoteendpoint closed constants internal opcode flush get op code getopcode next fragmented nextfragmented fragmented next text nexttext text output buffer outputbuffer flip send handler sendhandler flush handler flushhandler output buffer flush send handler outputbufferflushsendhandler output buffer outputbuffer get end handler getendhandler do write dowrite flush handler flushhandler output buffer outputbuffer control messages middle fragmented message fragmented text flags util is control iscontrol get op code getopcode next fragmented nextfragmented fragmented next text nexttext text get op code getopcode constants opcode close closed is text istext util is text istext get op code getopcode fragmented fragmented text is text istext illegal state exception illegalstateexception get string getstring ws remote endpoint wsremoteendpoint change type changetype next text nexttext text next fragmented nextfragmented is fin isfin was n wasn fragmented is fin isfin next fragmented nextfragmented next fragmented nextfragmented next text nexttext is text istext mask is masked ismasked mask util generate mask generatemask mask header buffer headerbuffer clear write header writeheader header buffer headerbuffer is fin isfin get rsv getrsv get op code getopcode is masked ismasked get payload getpayload mask header buffer headerbuffer flip get batching allowed getbatchingallowed is masked ismasked write output buffer output buffer send handler outputbuffersendhandler obsh output buffer send handler outputbuffersendhandler get end handler getendhandler header buffer headerbuffer get payload getpayload mask output buffer outputbuffer get batching allowed getbatchingallowed obsh write write do write dowrite get end handler getendhandler header buffer headerbuffer get payload getpayload get blocking send timeout getblockingsendtimeout object obj ws session wssession get user properties getuserproperties blocking send timeout property user timeout usertimeout obj user timeout usertimeout obj user timeout usertimeout blocking send timeout user timeout usertimeout long value longvalue wraps user handler point not ified notified message complete end message handler endmessagehandler send handler sendhandler ws remote endpoint impl base wsremoteendpointimplbase endpoint send handler sendhandler handler end message handler endmessagehandler ws remote endpoint impl base wsremoteendpointimplbase endpoint send handler sendhandler handler endpoint endpoint handler handler override on result onresult send result sendresult result endpoint end message endmessage handler result transformation split link message part messagepart multiple link message part messagepart handler handler additional link message part messagepart handler not ifies notifies link message part messagepart processed link message part messagepart queue started link message part messagepart link end message handler endmessagehandler original link message part messagepart int ermediate message handler intermediatemessagehandler send handler sendhandler ws remote endpoint impl base wsremoteendpointimplbase endpoint int ermediate message handler intermediatemessagehandler ws remote endpoint impl base wsremoteendpointimplbase endpoint endpoint endpoint override on result onresult send result sendresult result endpoint end message endmessage result send object sendobject object obj io exception ioexception encode exception encodeexception send object by future sendobjectbyfuture obj interrupted exception interruptedexception handle send failure with encode handlesendfailurewithencode execution exception executionexception handle send failure with encode handlesendfailurewithencode handle send failure handlesendfailure throwable io exception ioexception handle send failure with encode handlesendfailurewithencode encode exception encodeexception io exception ioexception handle send failure with encode handlesendfailurewithencode throwable io exception ioexception encode exception encodeexception unwrap execution exception execution exception executionexception get cause getcause close session ws session wssession do close doclose close reason closereason close codes closecodes get message getmessage close reason closereason close codes closecodes closed abnormally get message getmessage rethrow exception encode exception encodeexception encode exception encodeexception io exception ioexception io exception ioexception io exception ioexception send object by future sendobjectbyfuture object obj future to send handler futuretosendhandler future to send handler futuretosendhandler ws session wssession send object by completion sendobjectbycompletion obj suppress warnings suppresswarnings unchecked rawtypes send object by completion sendobjectbycompletion object obj send handler sendhandler completion obj illegal argument exception illegalargumentexception get string getstring ws remote endpoint wsremoteendpoint null data nulldata completion illegal argument exception illegalargumentexception get string getstring ws remote endpoint wsremoteendpoint null handler nullhandler note implementation convert primitives object equivalents users free encoders decoders encoder encoder find encoder findencoder obj encoder util is primitive isprimitive obj get class getclass string msg obj to string tostring send string by completion sendstringbycompletion msg completion encoder is assignable from isassignablefrom obj get class getclass byte buffer bytebuffer msg byte buffer bytebuffer wrap obj send bytes by completion sendbytesbycompletion msg completion encoder encoder text string msg encoder text encoder encode obj send string by completion sendstringbycompletion msg completion encoder encoder text stream textstream writer get send writer getsendwriter encoder text stream textstream encoder encode obj close io exception ioexception ioe completion on result onresult send result sendresult encoder encoder binary byte buffer bytebuffer msg encoder binary encoder encode obj send bytes by completion sendbytesbycompletion msg completion encoder encoder binary stream binarystream output stream outputstream get send stream getsendstream encoder binary stream binarystream encoder encode obj close io exception ioexception ioe completion on result onresult send result sendresult encode exception encodeexception obj get string getstring ws remote endpoint wsremoteendpoint no encoder noencoder obj get class getclass exception send result sendresult send result sendresult completion on result onresult set session setsession ws session wssession ws session wssession ws session wssession ws session wssession set encode rs setencoders endpoint config endpointconfig endpoint config endpointconfig deployment exception deploymentexception encoder entries encoderentries clear encoder encoder clazz encoderclazz endpoint config endpointconfig get encode rs getencoders encoder instance instance encoder clazz encoderclazz new instance newinstance instance init endpoint config endpointconfig instantiation exception instantiationexception deployment exception deploymentexception get string getstring ws remote endpoint wsremoteendpoint invalid encoder invalidencoder encoder clazz encoderclazz get name getname illegal access exception illegalaccessexception deployment exception deploymentexception get string getstring ws remote endpoint wsremoteendpoint invalid encoder invalidencoder encoder clazz encoderclazz get name getname encoder entry encoderentry entry encoder entry encoderentry util get encoder type getencodertype encoder clazz encoderclazz instance encoder entries encoderentries add entry encoder find encoder findencoder object obj encoder entry encoderentry entry encoder entries encoderentries entry get clazz getclazz is assignable from isassignablefrom obj get class getclass entry get encoder getencoder close encoder entry encoderentry entry encoder entries encoderentries entry get encoder getencoder destroy transformation handles input output closed closed output side transformation close do close doclose do write dowrite send handler sendhandler handler byte buffer bytebuffer data is masked ismasked do close doclose write header writeheader byte buffer bytebuffer header buffer headerbuffer fin rsv op code opcode masked byte buffer bytebuffer payload mask fin fin bit rsv fragment message op code opcode fragment continuation op code opcode header buffer headerbuffer masked write mask length length payload limit header buffer headerbuffer payload limit payload limit header buffer headerbuffer header buffer headerbuffer payload limit header buffer headerbuffer payload limit xff header buffer headerbuffer header buffer headerbuffer header buffer headerbuffer header buffer headerbuffer header buffer headerbuffer header buffer headerbuffer payload limit header buffer headerbuffer payload limit header buffer headerbuffer payload limit header buffer headerbuffer payload limit xff masked header buffer headerbuffer mask header buffer headerbuffer mask header buffer headerbuffer mask header buffer headerbuffer mask text message send handler textmessagesendhandler send handler sendhandler send handler sendhandler handler char buffer charbuffer message is last islast charset encoder charsetencoder encoder byte buffer bytebuffer buffer ws remote endpoint impl base wsremoteendpointimplbase endpoint is done isdone text message send handler textmessagesendhandler send handler sendhandler handler char buffer charbuffer message is last islast charset encoder charsetencoder encoder byte buffer bytebuffer encoder buffer encoderbuffer ws remote endpoint impl base wsremoteendpointimplbase endpoint handler handler message message is last islast is last islast encoder encoder reset buffer encoder buffer encoderbuffer endpoint endpoint write buffer clear code r result coderresult encoder encode message buffer is error iserror illegal argument exception illegalargumentexception to string tostring is done isdone is overflow isoverflow buffer flip endpoint start message startmessage constants opcode text buffer is done isdone is last islast override on result onresult send result sendresult result is done isdone endpoint state machine statemachine complete is last islast handler on result onresult result result isok handler on result onresult result closed send result sendresult send result sendresult io exception ioexception get string getstring ws remote endpoint wsremoteendpoint closed during message closedduringmessage handler on result onresult write write data output buffer flushing buffer fills output buffer send handler outputbuffersendhandler send handler sendhandler send handler sendhandler handler byte buffer bytebuffer header buffer headerbuffer byte buffer bytebuffer payload mask byte buffer bytebuffer output buffer outputbuffer flush required flushrequired ws remote endpoint impl base wsremoteendpointimplbase endpoint mask index maskindex output buffer send handler outputbuffersendhandler send handler sendhandler completion byte buffer bytebuffer header buffer headerbuffer byte buffer bytebuffer payload mask byte buffer bytebuffer output buffer outputbuffer flush required flushrequired ws remote endpoint impl base wsremoteendpointimplbase endpoint handler completion header buffer headerbuffer header buffer headerbuffer payload payload mask mask output buffer outputbuffer output buffer outputbuffer flush required flushrequired flush required flushrequired endpoint endpoint write write header header buffer headerbuffer has remaining hasremaining output buffer outputbuffer has remaining hasremaining output buffer outputbuffer header buffer headerbuffer header buffer headerbuffer has remaining hasremaining headers write flush output buffer outputbuffer flip endpoint do write dowrite output buffer outputbuffer write payload payload left payloadleft payload remaining payload limit payloadlimit payload limit output space outputspace output buffer outputbuffer remaining to write towrite payload left payloadleft payload left payloadleft output space outputspace to write towrite output space outputspace temp orarily temporarily reduce limit payload limit payload position to write towrite mask bulk copy output buffer outputbuffer payload to write towrite output buffer outputbuffer payload mask mask index maskindex xff mask index maskindex mask index maskindex payload left payloadleft output space outputspace restore original limit payload limit payload limit payloadlimit headers write flush output buffer outputbuffer flip endpoint do write dowrite output buffer outputbuffer flush required flushrequired output buffer outputbuffer flip output buffer outputbuffer remaining handler on result onresult send result sendresult endpoint do write dowrite output buffer outputbuffer handler on result onresult send result sendresult send handler sendhandler methods override on result onresult send result sendresult result result isok output buffer outputbuffer has remaining hasremaining endpoint do write dowrite output buffer outputbuffer output buffer outputbuffer clear write handler on result onresult result ensures tne output buffer cleared flushed output buffer flush send handler outputbufferflushsendhandler send handler sendhandler byte buffer bytebuffer output buffer outputbuffer send handler sendhandler handler output buffer flush send handler outputbufferflushsendhandler byte buffer bytebuffer output buffer outputbuffer send handler sendhandler handler output buffer outputbuffer output buffer outputbuffer handler handler override on result onresult send result sendresult result result isok output buffer outputbuffer clear handler on result onresult result ws output stream wsoutputstream output stream outputstream ws remote endpoint impl base wsremoteendpointimplbase endpoint byte buffer bytebuffer buffer byte buffer bytebuffer all ocate allocate constants buffer size object close lock closelock object closed ws output stream wsoutputstream ws remote endpoint impl base wsremoteendpointimplbase endpoint endpoint endpoint override write io exception ioexception closed illegal state exception illegalstateexception get string getstring ws remote endpoint wsremoteendpoint closed output stream closedoutputstream buffer remaining flush buffer override write len io exception ioexception closed illegal state exception illegalstateexception get string getstring ws remote endpoint wsremoteendpoint closed output stream closedoutputstream len length len len length len index out of bounds exception indexoutofboundsexception buffer remaining flush remaining buffer remaining written remaining len written buffer written remaining written remaining flush remaining buffer remaining buffer written len written override flush io exception ioexception closed illegal state exception illegalstateexception get string getstring ws remote endpoint wsremoteendpoint closed output stream closedoutputstream empty message constants streams drop empty messages buffer position do write dowrite override close io exception ioexception close lock closelock closed closed do write dowrite do write dowrite io exception ioexception constants streams drop empty messages buffer flip endpoint start message block startmessageblock constants opcode binary buffer endpoint state machine statemachine complete buffer clear ws writer wswriter writer ws remote endpoint impl base wsremoteendpointimplbase endpoint char buffer charbuffer buffer char buffer charbuffer all ocate allocate constants buffer size object close lock closelock object closed ws writer wswriter ws remote endpoint impl base wsremoteendpointimplbase endpoint endpoint endpoint override write cbuf len io exception ioexception closed illegal state exception illegalstateexception get string getstring ws remote endpoint wsremoteendpoint closed writer closedwriter len cbuf length len len cbuf length len index out of bounds exception indexoutofboundsexception buffer remaining flush remaining buffer remaining written remaining len written buffer cbuf written remaining written remaining flush remaining buffer remaining buffer cbuf written len written override flush io exception ioexception closed illegal state exception illegalstateexception get string getstring ws remote endpoint wsremoteendpoint closed writer closedwriter constants streams drop empty messages buffer position do write dowrite override close io exception ioexception close lock closelock closed closed do write dowrite do write dowrite io exception ioexception constants streams drop empty messages buffer flip endpoint send partial string sendpartialstring buffer buffer clear endpoint state machine statemachine complete encoder entry encoderentry clazz encoder encoder encoder entry encoderentry clazz encoder encoder clazz clazz encoder encoder get clazz getclazz clazz encoder get encoder getencoder encoder enum open stream writing writer writing binary partial writing binary partial ready binary full writing text partial writing text partial ready text full writing state machine statemachine open stream start streamstart check state checkstate open stream writing write start writestart check state checkstate open writer writing binary partial start binarypartialstart check state checkstate open binary partial ready binary partial writing binary start binarystart check state checkstate open binary full writing text partial start textpartialstart check state checkstate open text partial ready text partial writing text start textstart check state checkstate open text full writing complete check state checkstate text partial writing text full writing binary partial writing binary full writing stream writing writer writing open check state checkstate text partial writing binary partial writing stream writing writer writing text partial writing text partial ready binary partial writing binary partial ready writer writing leave stream writing leave permitted preceding check state checkstate call illegal state exception illegalstateexception bug code called check state checkstate required required illegal state exception illegalstateexception get string getstring ws remote endpoint wsremoteendpoint wrong state wrongstate state update send handler stateupdatesendhandler send handler sendhandler send handler sendhandler handler state update send handler stateupdatesendhandler send handler sendhandler handler handler handler override on result onresult send result sendresult result result isok state machine statemachine complete handler on result onresult result