licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina authenticator java file java io exception ioexception java util list java util string tokenizer stringtokenizer javax servlet servlet exception servletexception javax servlet http http servlet httpservlet javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse org junit assert false assertfalse org junit assert true asserttrue org junit fail org junit test org apache catalina context org apache catalina valve org apache catalina deploy login config loginconfig org apache catalina deploy security collection securitycollection org apache catalina deploy security constraint securityconstraint org apache catalina startup simple http client simplehttpclient org apache catalina startup test tomcat testtomcat map realm maprealm org apache catalina startup tester servlet testerservlet org apache catalina startup tomcat org apache catalina startup tomcat base test tomcatbasetest test form authentication sessions cookies client accept resp ond respond cookie jsessionid main tain maintain authenticated session matter session changed times client accept cookies main tain maintain persistent session server sends correct current jsessionid path parameter appended urls response achievable servlets jsps jstl encoded url inserted dynamic web work html not e note test tomcat somaple jsps conform webapp authenticate client accept cookies generate resource url dynamically include current session webapp satify turn change session id on authentication changesessionidonauthentication context degrade session fixation protection clients not e note mark t markt agree url s urls encoded session session proper browser unit test lot scr een screen scr api ng scraping cheating headers urls elegant cla ims claims gen erality generality test form authenticator testformauthenticator tomcat base test tomcatbasetest single tons singletons type safe unit test don par anoid paranoid client cookies client cookies client cookies server cookies server cookies server cookies server change sessid server freeze sessid server change sessid minimum session timeout timeout mins timeout delay msecs timeout mins form auth client formauthclient client tests server cookie carry current session authentication client prepared cookies request test test get with cookies testgetwithcookies exception do test dotest client cookies server cookies server change sessid test test post no continue with cookies testpostnocontinuewithcookies exception do test dotest post client cookies server cookies server change sessid test test post with continue and cookies testpostwithcontinueandcookies exception do test dotest post client cookies server cookies server change sessid bug test test post no continue post redirect with cookies testpostnocontinuepostredirectwithcookies exception do test dotest post post client cookies server cookies server change sessid bug test test post with continue post redirect with cookies testpostwithcontinuepostredirectwithcookies exception do test dotest post post client cookies server cookies server change sessid tests server context configured cookies session carried url path parameter bug test test get no server cookies testgetnoservercookies exception do test dotest client cookies server cookies server change sessid test test post no continue no server cookies testpostnocontinuenoservercookies exception do test dotest post client cookies server cookies server change sessid test test post with continue no server cookies testpostwithcontinuenoservercookies exception do test dotest post client cookies server cookies server change sessid variant bug test test post no continue post redirect no server cookies testpostnocontinuepostredirectnoservercookies exception do test dotest post post client cookies server cookies server change sessid variant bug test test post with continue post redirect no server cookies testpostwithcontinuepostredirectnoservercookies exception do test dotest post post client cookies server cookies server change sessid tests server context cookies client ref uses refuses session carried url path parameter test test get no client cookies testgetnoclientcookies exception do test dotest client cookies server cookies server change sessid test test post no continue no client cookies testpostnocontinuenoclientcookies exception do test dotest post client cookies server cookies server change sessid test test post with continue no client cookies testpostwithcontinuenoclientcookies exception do test dotest post client cookies server cookies server change sessid variant bug test test post no continue post redirect no client cookies testpostnocontinuepostredirectnoclientcookies exception do test dotest post post client cookies server cookies server change sessid variant bug test test post with continue post redirect no client cookies testpostwithcontinuepostredirectnoclientcookies exception do test dotest post post client cookies server cookies server change sessid tests exp lore explore quirky situations replicate scenarios test test no changed sessid with cookies testnochangedsessidwithcookies exception do test dotest client cookies server cookies server freeze sessid test test no changed sessid without cookies testnochangedsessidwithoutcookies exception do test dotest client cookies server cookies server freeze sessid test test timeout without cookies testtimeoutwithoutcookies exception string protected uri protecteduri do test dotest client cookies server cookies server freeze sessid wait session expire thread sleep timeout delay msecs expired session resource login challenge timeout status do test protected dotestprotected protected uri protecteduri form auth client formauthclient login required test do test selected methods dotestselectedmethods exception form auth client selected methods formauthclientselectedmethods client form auth client selected methods formauthclientselectedmethods request resource login client do resource request doresourcerequest test selected methods servlet selectedmethodsservlet param selected methods servlet selectedmethodsservlet assert true asserttrue client get response line getresponseline client is response isresponse assert true asserttrue client is response body k isresponsebodyok string original session id originalsessionid client get session id getsessionid client reset request replies login challenge client do resource request doresourcerequest post test security check form auth client base formauthclientbase login reply assert true asserttrue login failed client get response line getresponseline client is response isresponse assert true asserttrue client is response body k isresponsebodyok string redirect uri redirecturi client get redirect uri getredirecturi client reset request login successful follow redirect resource client do resource request doresourcerequest redirect uri redirecturi assert true asserttrue client is response isresponse assert true asserttrue client is response body k isresponsebodyok string new session id newsessionid client get session id getsessionid assert true asserttrue original session id originalsessionid equals new session id newsessionid client reset choreograph steps test dialog ue dialogue server authenticated access resource resp ond respond login challenge good credentials successful login follow redirect original repeatedly access resource demonstrate persistence authenticated session param resource method resourcemethod http method accessing resource param redirect method redirectmethod http method login form reply param use continue usecontinue http client expect param client should use cookies clientshouldusecookies client send cookies param server will use cookies serverwillusecookies server send cookies string do test dotest string resource method resourcemethod string redirect method redirectmethod use continue usecontinue client should use cookies clientshouldusecookies server will use cookies serverwillusecookies server will change sessid serverwillchangesessid exception client form auth client formauthclient client should use cookies clientshouldusecookies server will use cookies serverwillusecookies server will change sessid serverwillchangesessid request resource login client set use continue setusecontinue use continue usecontinue client do resource request doresourcerequest resource method resourcemethod assert true asserttrue client is response isresponse assert true asserttrue client is response body k isresponsebodyok string login uri loginuri client extract body uri extractbodyuri form auth client formauthclient login param tag form auth client formauthclient login resource string original session id originalsessionid server will use cookies serverwillusecookies client should use cookies clientshouldusecookies original session id originalsessionid client get session id getsessionid original session id originalsessionid client extract path session id extractpathsessionid login uri loginuri client reset request replies login challenge client set use continue setusecontinue use continue usecontinue client do login request dologinrequest login uri loginuri assert true asserttrue login failed client get response line getresponseline client is response isresponse assert true asserttrue client is response body k isresponsebodyok string redirect uri redirecturi client get redirect uri getredirecturi client reset request login successful follow redirect resource client do resource request doresourcerequest redirect method redirectmethod redirect uri redirecturi post equals redirect method redirectmethod client set use continue setusecontinue use continue usecontinue assert true asserttrue client is response isresponse assert true asserttrue client is response body k isresponsebodyok string protected uri protecteduri client extract body uri extractbodyuri form auth client formauthclient resource param tag form auth client formauthclient resource string new session id newsessionid server will use cookies serverwillusecookies client should use cookies clientshouldusecookies new session id newsessionid client get session id getsessionid new session id newsessionid client extract path session id extractpathsessionid protected uri protecteduri session id is changed sessionidischanged original session id originalsessionid equals new session id newsessionid assert true asserttrue session id is changed sessionidischanged server will change sessid serverwillchangesessid client reset sub sequent subsequent requests accessing resource do test protected dotestprotected resource method resourcemethod protected uri protecteduri use continue usecontinue form auth client formauthclient login successful requests issued protected uri protecteduri rep eatedly repeatedly access resource client log ged logged webapp current session attributes changed successful login follow redirect original repeatedly access resource demonstrate persistence authenticated session param resource method resourcemethod http method accessing resource param protected uri protecteduri access with our withour session id sessionid param use continue usecontinue http client expect param client should use cookies clientshouldusecookies client send cookies param server will use cookies serverwillusecookies server send cookies do test protected dotestprotected string resource method resourcemethod string protected uri protecteduri use continue usecontinue phase repeat count repeatcount exception sub sequent subsequent requests accessing resource repeat count repeatcount client set use continue setusecontinue use continue usecontinue client do resource request doresourcerequest resource method resourcemethod protected uri protecteduri assert true asserttrue client is response isresponse assert true asserttrue client is response body k isresponsebodyok phase client reset encapsulate logic needed suitably configured tomcat instance send http request process server response form auth client base formauthclientbase simple http client simplehttpclient string login param tag action string login resource security check string login reply username tomcat password tomcat string relative path examples jsp security string resource jsp string resource url relative path resource string resource param tag href param delim primitive tracking test phases verify html body login required red irecting redirecting login successful request count requestcount todo for got forgot change making string session parameter start session parameter do login request dologinrequest string login uri loginuri exception do resource request doresourcerequest post relative path login uri loginuri login reply prepare resource request http headers issue request kinds uri supported fully qualified uri minimal uri webapp path resource cookies supported test caller expected session path parameter do resource request doresourcerequest string method is full qual uri isfullqualuri string resource uri resourceuri string request tail requesttail exception build http request ass embling assembling uri string builder stringbuilder request head requesthead string builder stringbuilder request head requesthead append method append is full qual uri isfullqualuri request head requesthead append resource uri resourceuri resource uri resourceuri relative url request head requesthead append resource url request head requesthead append relative path append resource uri resourceuri equals method request head requesthead append role bar request head requesthead append http append crlf add constant http headers request head requesthead append host localhost append crlf request head requesthead append connection close append crlf optional http headers get use continue getusecontinue request head requesthead append expect append crlf get use cookies getusecookies string session id sessionid get session id getsessionid session id sessionid request head requesthead append cookie append session cookie append append session id sessionid append crlf pos ts posts deal request content post equals method request tail requesttail request tail requesttail role bar request head requesthead append content type application form url encoded urlencoded append crlf calculate post data length string len integer to string tostring request tail requesttail length request head requesthead append content length append len append crlf empty headers request head requesthead append crlf string request string request request head requesthead to string tostring request request tail requesttail do request dorequest request do request dorequest string request exception set request setrequest request connect process request processrequest disconnect request count requestcount verify server response html body expect based dialog ue dialogue position do test dotest override is response body k isresponsebodyok is response body k isresponsebodyok request count requestcount verify server response html body expect based dialog ue dialogue position caller is response body k isresponsebodyok test p has e testphase test p has e testphase login required request login assert contains assertcontains get response body getresponsebody title login examples title red irecting redirecting request result redirect body sub sequent subsequent requests role parameter string body get response body getresponsebody assert contains assertcontains body title examples title assert contains assertcontains body input type text role bar scan server response body extract url including path elements string extract body uri extractbodyuri string param tag paramtag string resource extract uri elements extracturielements list string elements get response body uri elements getresponsebodyurielements string full path fullpath string element elements element index of indexof param tag paramtag param tag paramtag length delim element char at charat element index of indexof resource last char ix lastcharix element index of indexof delim full path fullpath element substring last char ix lastcharix remove trailing parameters param delim paramdelim full path fullpath index of indexof param delim param delim paramdelim full path fullpath full path fullpath substring param delim paramdelim full path fullpath extract session path element exists url string extract path session id extractpathsessionid string url string session id sessionid i start istart url index of indexof session parameter start i start istart i start istart session parameter start length string remainder url substring i start istart string tokenizer stringtokenizer parser string tokenizer stringtokenizer remainder session path parameter tails parser has more elements hasmoreelements session id sessionid parser next token nexttoken session id sessionid url substring i start istart session id sessionid assert contains assertcontains string body string expected body expected fail response number request count requestcount body check failure expected substring expected n actual nactual body form auth client formauthclient form auth client base formauthclientbase form auth client formauthclient client should use cookies clientshouldusecookies server should use cookies servershouldusecookies server should change sessid servershouldchangesessid exception tomcat tomcat get tomcat instance gettomcatinstance file app dir appdir file get build directory getbuilddirectory web apps webapps examples context ctx tomcat add webapp addwebapp examples app dir appdir get absolute path getabsolutepath set use cookies setusecookies client should use cookies clientshouldusecookies ctx set cookies setcookies server should use cookies servershouldusecookies map realm maprealm realm map realm maprealm realm add user adduser tomcat tomcat realm add user role adduserrole tomcat tomcat ctx set realm setrealm realm tomcat start work tomcat started ctx set session timeout setsessiontimeout timeout mins valve pipeline established tomcat starts valve valves ctx get pipeline getpipeline get val ves getvalves valve valve valves valve authenticator base authenticatorbase authenticator base authenticatorbase valve set change session id on authentication setchangesessionidonauthentication server should change sessid servershouldchangesessid port tomcat starts set port setport get port getport encapsulate logic needed suitably configured tomcat instance send http request process server response resource http methods int erest interest post methods login form redirect methods authenticator process requests form auth client selected methods formauthclientselectedmethods form auth client base formauthclientbase form auth client selected methods formauthclientselectedmethods client should use cookies clientshouldusecookies server should use cookies servershouldusecookies server should change sessid servershouldchangesessid exception tomcat tomcat get tomcat instance gettomcatinstance file system doc base docbase required context ctx tomcat add context addcontext tomcat add servlet addservlet ctx selected methods selectedmethods selected methods servlet selectedmethodsservlet ctx add servlet mapping addservletmapping test selected methods selectedmethods login servlet resp ond respond client handle creating valid response form tomcat add servlet addservlet ctx login tester servlet testerservlet ctx add servlet mapping addservletmapping login login configure security constraints security constraint securityconstraint constraint security constraint securityconstraint security collection securitycollection collection security collection securitycollection collection set name setname protect collection add method addmethod collection add pattern addpattern test constraint add collection addcollection collection constraint add auth role addauthrole tomcat ctx add constraint addconstraint constraint configure authentication login config loginconfig login config loginconfig set auth method setauthmethod form set login page setloginpage login ctx set login config setloginconfig ctx get pipeline getpipeline add valve addvalve form authenticator formauthenticator set use cookies setusecookies client should use cookies clientshouldusecookies ctx set cookies setcookies server should use cookies servershouldusecookies map realm maprealm realm map realm maprealm realm add user adduser tomcat tomcat realm add user role adduserrole tomcat tomcat ctx set realm setrealm realm tomcat start work tomcat started ctx set session timeout setsessiontimeout timeout mins valve pipeline established tomcat starts valve valves ctx get pipeline getpipeline get val ves getvalves valve valve valves valve authenticator base authenticatorbase authenticator base authenticatorbase valve set change session id on authentication setchangesessionidonauthentication server should change sessid servershouldchangesessid port tomcat starts set port setport get port getport override is response body k isresponsebodyok is response isresponse assert true asserttrue get response body getresponsebody get response body getresponsebody assert false assertfalse get response body getresponsebody fail selected methods servlet selectedmethodsservlet http servlet httpservlet serialversionuid string param test param testparam string test value testvalue override do get doget http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception resp set content type setcontenttype text plain charset utf equals req get parameter getparameter param req is user in role isuserinrole tomcat resp get writer getwriter print resp get writer getwriter print fail override do post dopost http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception test do get doget req resp override do put doput http servlet request httpservletrequest req http servlet response httpservletresponse resp servlet exception servletexception io exception ioexception test do get doget req resp