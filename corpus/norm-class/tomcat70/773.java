licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat websocket server java eof exception eofexception java io exception ioexception java net socket timeout exception sockettimeoutexception java nio byte buffer bytebuffer java util queue java util concurrent concurrent linked queue concurrentlinkedqueue java util concurrent executor service executorservice javax websocket send handler sendhandler javax websocket send result sendresult org apache coyote http upgrade abstract servlet output stream abstractservletoutputstream org apache juli logging log org apache juli logging log factory logfactory org apache tomcat util res string manager stringmanager org apache tomcat websocket transformation org apache tomcat websocket ws remote endpoint impl base wsremoteendpointimplbase server side link javax websocket remote endpoint remoteendpoint implementation server send data client communication link javax servlet servlet output stream servletoutputstream ws remote endpoint impl server wsremoteendpointimplserver ws remote endpoint impl base wsremoteendpointimplbase string manager stringmanager string manager stringmanager get manager getmanager constants log log log factory logfactory get log getlog ws remote endpoint impl server wsremoteendpointimplserver queue on result runnable onresultrunnable on result run nables onresultrunnables concurrent linked queue concurrentlinkedqueue on result runnable onresultrunnable abstract servlet output stream abstractservletoutputstream sos ws write timeout wswritetimeout ws write timeout wswritetimeout executor service executorservice executor service executorservice send handler sendhandler handler byte buffer bytebuffer buf fers buffers timeout expiry timeoutexpiry close ws remote endpoint impl server wsremoteendpointimplserver abstract servlet output stream abstractservletoutputstream sos ws server container wsservercontainer server container servercontainer sos sos ws write timeout wswritetimeout server container servercontainer get timeout gettimeout executor service executorservice server container servercontainer get executor service getexecutorservice override is masked ismasked override do write dowrite send handler sendhandler handler byte buffer bytebuffer buf fers buffers handler handler buf fers buffers buf fers buffers thread triggered write dispatch required on write possible onwritepossible on write possible onwritepossible use dispatch usedispatch complete call sos is ready isready complete byte buffer bytebuffer buffer buf fers buffers buffer has remaining hasremaining complete sos write buffer array buffer array offset arrayoffset buffer limit buffer position buffer limit complete ws write timeout wswritetimeout unregister clear handler clearhandler use dispatch usedispatch close close io exception ioexception ioe ws write timeout wswritetimeout unregister clear handler clearhandler ioe use dispatch usedispatch close complete async write progress timeout get send timeout getsendtimeout timeout register timeout thread timeout expiry timeoutexpiry timeout system current time millis currenttimemillis ws write timeout wswritetimeout register override do close doclose handler close triggered wide range scenarios simple r simpler dispatch track method called thread triggered write clear handler clearhandler eof exception eofexception sos close io exception ioexception log is info enabled isinfoenabled log info get string getstring ws remote endpoint server wsremoteendpointserver close failed closefailed ws write timeout wswritetimeout unregister get timeout expiry gettimeoutexpiry timeout expiry timeoutexpiry called background thread call clear handler clearhandler use dispatch usedispatch method parameter call ers callers started method call ers callers correct use dispatch usedispatch on timeout ontimeout use dispatch usedispatch handler clear handler clearhandler socket timeout exception sockettimeoutexception use dispatch usedispatch close override set transformation settransformation transformation transformation overridden purely visible classes set transformation settransformation transformation param throwable error occurred param use dispatch usedispatch link send handler sendhandler on result onresult send result sendresult called thread keeping min d mind requirements link javax websocket remote endpoint remoteendpoint async clear handler clearhandler throwable use dispatch usedispatch setting result marks partial message complete update handler local copy sign alling signalling partial message send handler sendhandler handler handler buf fers buffers use dispatch usedispatch on result runnable onresultrunnable on result run nables onresultrunnables poll on result runnable onresultrunnable on result run nables onresultrunnables init executor service executorservice executor service executorservice is shutdown isshutdown executor call runnable str ictly strictly specification comp liant compliant cases shutdown close messages issue nested calls leading stack overflow bug issues nested calls reason separate thread req uirement requirement specification executor service executorservice execute on result onresult send result sendresult on result onresult send result sendresult on result runnable onresultrunnable runnable queue on result runnable onresultrunnable queue send handler sendhandler throwable on result runnable onresultrunnable queue on result runnable onresultrunnable queue queue queue init send handler sendhandler throwable override on result onresult send result sendresult on result onresult send result sendresult runnable queue finished note method takes age finish should n shouldn thread safety issues fields cleared queue add