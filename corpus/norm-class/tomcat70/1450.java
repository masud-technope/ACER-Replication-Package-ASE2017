licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat websocket server java io exception ioexception java nio charset standard chars ets standardcharsets java util array list arraylist java util collections java util enumeration java util linked hash map linkedhashmap java util list java util map java util map entry javax servlet servlet exception servletexception javax servlet servlet request servletrequest javax servlet servlet request wrapper servletrequestwrapper javax servlet servlet response servletresponse javax servlet http http servlet request httpservletrequest javax servlet http http servlet response httpservletresponse javax websocket endpoint javax websocket extension javax websocket handshake response handshakeresponse javax websocket server server endpoint config serverendpointconfig org apache catalina connector request facade requestfacade org apache tomcat util code c codec binary base org apache tomcat util res string manager stringmanager org apache tomcat util security concurrent message digest concurrentmessagedigest org apache tomcat websocket constants org apache tomcat websocket transformation org apache tomcat websocket transformation factory transformationfactory org apache tomcat websocket util org apache tomcat websocket ws handshake response wshandshakeresponse org apache tomcat websocket pojo pojo endpoint server pojoendpointserver upgrade util upgradeutil string manager stringmanager string manager stringmanager get manager getmanager org apache tomcat websocket server constants accept eafa get bytes getbytes standard chars ets standardcharsets iso upgrade util upgradeutil utility hide constructor checks http request includes valid upgrade request web socket note rfc limit http upgrade requests java web socket websocket spec impl ies implies limitation rfc requires web socket websocket upgrade is web socket upgrade request iswebsocketupgraderequest servlet request servletrequest request servlet response servletresponse response request http servlet request httpservletrequest response http servlet response httpservletresponse header contains token headercontainstoken http servlet request httpservletrequest request constants upgrade header constants upgrade header equals http servlet request httpservletrequest request get method getmethod do upgrade doupgrade ws server container wsservercontainer http servlet request httpservletrequest req http servlet response httpservletresponse resp server endpoint config serverendpointconfig map string string path params pathparams servlet exception servletexception io exception ioexception validate headers reject request validation fails string key string sub protocol subprotocol header contains token headercontainstoken req constants connection header constants connection header resp send error senderror http servlet response httpservletresponse bad request header contains token headercontainstoken req constants version header constants version header resp set status setstatus resp set header setheader constants version header constants version header key req get header getheader constants key header key resp send error senderror http servlet response httpservletresponse bad request origin check string origin req get header getheader constants origin header get configurator getconfigurator check origin checkorigin origin resp send error senderror http servlet response httpservletresponse forbidden protocols list string sub protocols subprotocols get tokens from header gettokensfromheader req constants protocol header sub protocol subprotocol get configurator getconfigurator get negotiated sub protocol getnegotiatedsubprotocol get sub protocols getsubprotocols sub protocols subprotocols extensions header handle multiple headers list extension extensions requested extensionsrequested array list arraylist extension enumeration string ext headers extheaders req get headers getheaders constants extensions header ext headers extheaders has more elements hasmoreelements util parse extension header parseextensionheader extensions requested extensionsrequested ext headers extheaders next element nextelement negotiation phase simply filters extensions server support applications custom config urator configurator list extension installed extensions installedextensions get extensions getextensions size installed extensions installedextensions constants installed extensions installed extensions installedextensions array list arraylist extension installed extensions installedextensions add all addall get extensions getextensions installed extensions installedextensions add all addall constants installed extensions list extension negotiated extensions p has e negotiatedextensionsphase get configurator getconfigurator get negotiated extensions getnegotiatedextensions installed extensions installedextensions extensions requested extensionsrequested negotiation phase create transformations applied connection note extension dropped point client requested configuration server unable support list transformation transformations create transformations createtransformations negotiated extensions p has e negotiatedextensionsphase list extension negotiated extensions p has e negotiatedextensionsphase transformations is empty isempty negotiated extensions p has e negotiatedextensionsphase collections empty list emptylist negotiated extensions p has e negotiatedextensionsphase array list arraylist extension transformations size transformation transformations negotiated extensions p has e negotiatedextensionsphase add get extension response getextensionresponse build transformation pipeline transformation transformation string builder stringbuilder response header extensions responseheaderextensions string builder stringbuilder transformation transformations response header extensions responseheaderextensions append append response header extensions responseheaderextensions get extension response getextensionresponse transformation transformation transformation set next setnext full pipeline validate rsv bits transformation transformation validate rsv bits validatersvbits servlet exception servletexception get string getstring upgrade util upgradeutil incompatible rsv incompatiblersv good accept connection resp set header setheader constants upgrade header constants upgrade header resp set header setheader constants connection header constants connection header resp set header setheader handshake response handshakeresponse web socket websocket accept get web socket accept getwebsocketaccept key sub protocol subprotocol sub protocol subprotocol length rfc explicitly valid resp set header setheader constants protocol header sub protocol subprotocol transformations is empty isempty resp set header setheader constants extensions header response header extensions responseheaderextensions to string tostring ws handshake request wshandshakerequest ws request wsrequest ws handshake request wshandshakerequest req path params pathparams ws handshake response wshandshakeresponse ws response wsresponse ws handshake response wshandshakeresponse ws per session server endpoint config wspersessionserverendpointconfig per session server endpoint config persessionserverendpointconfig ws per session server endpoint config wspersessionserverendpointconfig get configurator getconfigurator modify handshake modifyhandshake per session server endpoint config persessionserverendpointconfig ws request wsrequest ws response wsresponse ws request wsrequest finished add additional headers entry string list string entry ws response wsresponse get headers getheaders entry set entryset string header value headervalue entry get value getvalue resp add header addheader entry get key getkey header value headervalue endpoint clazz get endpoint class getendpointclass endpoint is assignable from isassignablefrom clazz endpoint get configurator getconfigurator get endpoint instance getendpointinstance clazz pojo endpoint server pojoendpointserver path params pojo per session server endpoint config persessionserverendpointconfig get user properties getuserproperties pojo endpoint server pojoendpointserver pojo path param key path params pathparams instantiation exception instantiationexception servlet exception servletexception small hack servlet api servlet request servletrequest req unwrap request servlet request wrapper servletrequestwrapper servlet request wrapper servletrequestwrapper get request getrequest request facade requestfacade ws http upgrade handler wshttpupgradehandler ws handler wshandler request facade requestfacade upgrade ws http upgrade handler wshttpupgradehandler ws handler wshandler pre init preinit per session server endpoint config persessionserverendpointconfig ws request wsrequest negotiated extensions p has e negotiatedextensionsphase sub protocol subprotocol transformation path params pathparams req is secure issecure servlet exception servletexception upgrade failed list transformation create transformations createtransformations list extension negotiated extensions negotiatedextensions transformation factory transformationfactory factory transformation factory transformationfactory get instance getinstance linked hash map linkedhashmap string list list extension parameter extension preferences extensionpreferences linked hash map linkedhashmap string list list extension parameter result smaller list transformation result array list arraylist transformation negotiated extensions negotiatedextensions size extension extension negotiated extensions negotiatedextensions list list extension parameter preferences extension preferences extensionpreferences extension get name getname preferences preferences array list arraylist list extension parameter extension preferences extensionpreferences extension get name getname preferences preferences add extension get parameters getparameters map entry string list list extension parameter entry extension preferences extensionpreferences entry set entryset transformation transformation factory create entry get key getkey entry get value getvalue transformation result add transformation result append string builder stringbuilder extension extension extension extension get name getname extension get name getname length append extension get name getname extension parameter extension get parameters getparameters append append get name getname get value getvalue append append get value getvalue works tokens quoted strings sophisticated parsing header contains token headercontainstoken http servlet request httpservletrequest req string header name headername string target enumeration string headers req get headers getheaders header name headername headers has more elements hasmoreelements string header headers next element nextelement string tokens header split string token tokens target equals ignore case equalsignorecase token trim works tokens quoted strings sophisticated parsing list string get tokens from header gettokensfromheader http servlet request httpservletrequest req string header name headername list string result array list arraylist string enumeration string headers req get headers getheaders header name headername headers has more elements hasmoreelements string header headers next element nextelement string tokens header split string token tokens result add token trim result string get web socket accept getwebsocketaccept string key digest concurrent message digest concurrentmessagedigest digestsha key get bytes getbytes standard chars ets standardcharsets iso accept base encode base encodebase string digest