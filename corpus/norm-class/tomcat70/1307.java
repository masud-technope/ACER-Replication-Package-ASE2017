licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat util http java io exception ioexception java lang reflect field java net socket exception socketexception javax servlet servlet exception servletexception javax servlet servlet request servletrequest javax servlet servlet response servletresponse javax servlet http http servlet httpservlet org junit assert equals assertequals org junit assert null assertnull org junit assert true asserttrue org junit test org apache catalina context org apache catalina connector request org apache catalina connector response org apache catalina startup simple http client simplehttpclient org apache catalina startup tomcat org apache catalina startup tomcat base test tomcatbasetest org apache catalina valves tester access log valve testeraccesslogvalve test mime headers testmimeheaders tomcat base test tomcatbasetest header count log valve headercountlogvalve alv setup headers test setupheaderstest tomcat tomcat context ctx tomcat add context addcontext get temporary directory gettemporarydirectory get absolute path getabsolutepath tomcat add servlet addservlet ctx servlet http servlet httpservlet serialversionuid override service servlet request servletrequest req servlet response servletresponse res servlet exception servletexception io exception ioexception res set content type setcontenttype text plain charset iso res get writer getwriter write ctx add servlet mapping addservletmapping servlet alv header count log valve headercountlogvalve tomcat get host gethost get pipeline getpipeline add valve addvalve alv run headers test runheaderstest success expected successexpected tomcat tomcat count expected max header count expectedmaxheadercount exception tomcat start string header simple http client simplehttpclient crlf string builder stringbuilder request string builder stringbuilder request append http simple http client simplehttpclient crlf count request append header request append simple http client simplehttpclient crlf client client client tomcat client set request setrequest string request to string tostring client connect client process request processrequest client disconnect socket exception socketexception success expected successexpected log error get message getmessage log warn get message getmessage success expected successexpected alv validate access log validateaccesslog response assert true asserttrue response client get response line getresponseline client get response line getresponseline client is response isresponse assert equals assertequals client get response body getresponsebody alv validate access log validateaccesslog connection aborted response assert true asserttrue response client get response line getresponseline client get response line getresponseline client is response isresponse max header count maxheadercount tomcat get connector getconnector get max header count getmaxheadercount assert equals assertequals expected max header count expectedmaxheadercount max header count maxheadercount max header count maxheadercount assert equals assertequals max header count maxheadercount alv array size arraysize max header count maxheadercount max http header size maxhttpheadersize integer tomcat get connector getconnector get attribute getattribute max http header size maxhttpheadersize int value intvalue header count headercount math min count max http header size maxhttpheadersize header length array size arraysize array size arraysize header count headercount array size arraysize assert equals assertequals array size arraysize alv array size arraysize test test header limits testheaderlimits exception bumping max http header size maxhttpheadersize tomcat tomcat get tomcat instance gettomcatinstance setup headers test setupheaderstest tomcat tomcat get connector getconnector set max header count setmaxheadercount run headers test runheaderstest tomcat test test header limits testheaderlimits exception process headers tomcat tomcat get tomcat instance gettomcatinstance setup headers test setupheaderstest tomcat run headers test runheaderstest tomcat test test header limits testheaderlimits exception process header tomcat tomcat get tomcat instance gettomcatinstance setup headers test setupheaderstest tomcat run headers test runheaderstest tomcat test test header limits testheaderlimits exception change max header count maxheadercount tomcat tomcat get tomcat instance gettomcatinstance setup headers test setupheaderstest tomcat tomcat get connector getconnector set max header count setmaxheadercount run headers test runheaderstest tomcat header count log valve headercountlogvalve tester access log valve testeraccesslogvalve array size arraysize override log request request response response time log request response time mime headers mimeheaders request get coyote request getcoyoterequest get mime headers getmimeheaders field headers array field headersarrayfield mime headers mimeheaders get declared field getdeclaredfield headers headers array field headersarrayfield set accessible setaccessible array size arraysize object headers array field headersarrayfield length exception assert null assertnull get message getmessage client simple http client simplehttpclient client tomcat tomcat set port setport tomcat get connector getconnector get local port getlocalport override is response body k isresponsebodyok