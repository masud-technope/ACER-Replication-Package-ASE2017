licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache tomcat websocket java io exception ioexception java nio byte buffer bytebuffer java util array list arraylist java util list java util zip data format exception dataformatexception java util zip deflater java util zip inflater javax websocket extension javax websocket extension parameter javax websocket send handler sendhandler org apache tomcat util res string manager stringmanager per message deflate permessagedeflate transformation string manager stringmanager string manager stringmanager get manager getmanager constants string server context takeover server context take over takeover string client context takeover client context take over takeover string server max window bits server max window bits string client max window bits client max window bits rsv bitmask eom bytes string per message permessage def late deflate server context takeover servercontexttakeover server max window bits servermaxwindowbits client context takeover clientcontexttakeover client max window bits clientmaxwindowbits is server isserver inflater inflater inflater byte buffer bytebuffer read buffer readbuffer byte buffer bytebuffer all ocate allocate constants buffer size deflater deflater deflater deflater compression eom buffer eom bytes length transformation skip decompression skipdecompression byte buffer bytebuffer write buffer writebuffer byte buffer bytebuffer all ocate allocate constants buffer size first compressed frame written firstcompressedframewritten per message deflate permessagedeflate negotiate list list parameter preferences is server isserver accept preference endpoint support list parameter preference preferences server context takeover servercontexttakeover server max window bits servermaxwindowbits client context takeover clientcontexttakeover client max window bits clientmaxwindowbits parameter param preference server context takeover equals param get name getname server context takeover servercontexttakeover server context takeover servercontexttakeover duplicate definition illegal argument exception illegalargumentexception get string getstring per message deflate permessagedeflate duplicate parameter duplicateparameter server context takeover client context takeover equals param get name getname client context takeover clientcontexttakeover client context takeover clientcontexttakeover duplicate definition illegal argument exception illegalargumentexception get string getstring per message deflate permessagedeflate duplicate parameter duplicateparameter client context takeover server max window bits equals param get name getname server max window bits servermaxwindowbits server max window bits servermaxwindowbits integer parse int parseint param get value getvalue server max window bits servermaxwindowbits server max window bits servermaxwindowbits illegal argument exception illegalargumentexception get string getstring per message deflate permessagedeflate invalid window size invalidwindowsize server max window bits integer value of valueof server max window bits servermaxwindowbits is server isserver server max window bits servermaxwindowbits note server window size issue client client assume server smaller window work duplicate definition illegal argument exception illegalargumentexception get string getstring per message deflate permessagedeflate duplicate parameter duplicateparameter server max window bits client max window bits equals param get name getname client max window bits clientmaxwindowbits param get value getvalue hint server client supports option java api java expose api control window size effectively hard code d coded client max window bits clientmaxwindowbits client max window bits clientmaxwindowbits integer parse int parseint param get value getvalue client max window bits clientmaxwindowbits client max window bits clientmaxwindowbits illegal argument exception illegalargumentexception get string getstring per message deflate permessagedeflate invalid window size invalidwindowsize client max window bits integer value of valueof client max window bits clientmaxwindowbits is server isserver client max window bits clientmaxwindowbits note client window size issue server server assume client smaller window work duplicate definition illegal argument exception illegalargumentexception get string getstring per message deflate permessagedeflate duplicate parameter duplicateparameter client max window bits unknown parameter illegal argument exception illegalargumentexception get string getstring per message deflate permessagedeflate unknown parameter unknownparameter param get name getname per message deflate permessagedeflate server context takeover servercontexttakeover server max window bits servermaxwindowbits client context takeover clientcontexttakeover client max window bits clientmaxwindowbits is server isserver failed negotiate agreeable terms per message deflate permessagedeflate server context takeover servercontexttakeover server max window bits servermaxwindowbits client context takeover clientcontexttakeover client max window bits clientmaxwindowbits is server isserver server context takeover servercontexttakeover server context takeover servercontexttakeover server max window bits servermaxwindowbits server max window bits servermaxwindowbits client context takeover clientcontexttakeover client context takeover clientcontexttakeover client max window bits clientmaxwindowbits client max window bits clientmaxwindowbits is server isserver is server isserver override transformation result transformationresult get more data getmoredata op code opcode fin rsv byte buffer bytebuffer dest io exception ioexception web socket websocket method pass str aight straight util is control iscontrol op code opcode get more data getmoredata op code opcode fin rsv dest util is continuation iscontinuation op code opcode frame message skip decompression skipdecompression rsv rsv bitmask pass uncompressed frames str aight straight skip decompression skipdecompression get more data getmoredata op code opcode fin rsv dest written used eom bytes usedeombytes dest remaining space destination fill written inflater inf late inflate dest array dest array offset arrayoffset dest position dest remaining data format exception dataformatexception io exception ioexception get string getstring per message deflate permessagedeflate def late failed deflatefailed dest position dest position written inflater needs input needsinput used eom bytes usedeombytes dest has remaining hasremaining read buffer readbuffer clear transformation result transformationresult next result nextresult get more data getmoredata op code opcode fin rsv rsv bitmask read buffer readbuffer inflater set input setinput read buffer readbuffer array read buffer readbuffer array offset arrayoffset read buffer readbuffer position transformation result transformationresult underflow equals next result nextresult next result nextresult transformation result transformationresult frame equals next result nextresult read buffer readbuffer position fin inflater set input setinput eom bytes used eom bytes usedeombytes transformation result transformationresult frame written fin is server isserver client context takeover clientcontexttakeover is server isserver server context takeover servercontexttakeover inflater reset transformation result transformationresult frame transformation result transformationresult overflow override validate rsv validatersv rsv op code opcode util is control iscontrol op code opcode rsv rsv bitmask validate rsv validatersv rsv op code opcode rsv next rsvnext rsv rsv rsv bitmask rsv next rsvnext rsv rsv bitmask validate rsv validatersv rsv next rsvnext op code opcode override extension get extension response getextensionresponse extension result ws extension wsextension list extension parameter params result get parameters getparameters server context takeover servercontexttakeover params add ws extension parameter wsextensionparameter server context takeover server max window bits servermaxwindowbits params add ws extension parameter wsextensionparameter server max window bits integer to string tostring server max window bits servermaxwindowbits client context takeover clientcontexttakeover params add ws extension parameter wsextensionparameter client context takeover client max window bits clientmaxwindowbits params add ws extension parameter wsextensionparameter client max window bits integer to string tostring client max window bits clientmaxwindowbits result override set next setnext transformation set next setnext override validate rsv bits validatersvbits rsv bitmask validate rsv bits validatersvbits rsv bitmask override list message part messagepart send message part sendmessagepart list message part messagepart uncompressed parts uncompressedparts list message part messagepart all compressed parts allcompressedparts array list arraylist message part messagepart message part messagepart uncompressed part uncompressedpart uncompressed parts uncompressedparts op code opcode uncompressed part uncompressedpart get op code getopcode util is control iscontrol op code opcode control messages middle messages compressed pass str aight straight all compressed parts allcompressedparts add uncompressed part uncompressedpart uncompressed part uncompressedpart get payload getpayload limit uncompressed part uncompressedpart is fin isfin deflater get bytes read getbytesread length messages compressed pass str aight straight all compressed parts allcompressedparts add uncompressed part uncompressedpart list message part messagepart compressed parts compressedparts array list arraylist message part messagepart byte buffer bytebuffer uncompressed payload uncompressedpayload uncompressed part uncompressedpart get payload getpayload send handler sendhandler uncompressed int ermediate handler uncompressedintermediatehandler uncompressed part uncompressedpart get int ermediate handler getintermediatehandler deflater set input setinput uncompressed payload uncompressedpayload array uncompressed payload uncompressedpayload array offset arrayoffset uncompressed payload uncompressedpayload position uncompressed payload uncompressedpayload remaining flush uncompressed part uncompressedpart is fin isfin deflater sync flush deflater flush def late required deflaterequired def late required deflaterequired byte buffer bytebuffer compressed payload compressedpayload write buffer writebuffer written deflater def late deflate compressed payload compressedpayload array compressed payload compressedpayload array offset arrayoffset compressed payload compressedpayload position compressed payload compressedpayload remaining flush compressed payload compressedpayload position compressed payload compressedpayload position written uncompressed part uncompressedpart is fin isfin compressed payload compressedpayload has remaining hasremaining deflater needs input needsinput move message point reached compressed message created message part messagepart compressed part compressedpart write buffer writebuffer required write buffer writebuffer byte buffer bytebuffer all ocate allocate constants buffer size flip compressed payload ready writing compressed payload compressedpayload flip fin uncompressed part uncompressedpart is fin isfin full compressed payload compressedpayload limit compressed payload compressedpayload capacity needs input needsinput deflater needs input needsinput fin full needs input needsinput compressed message drop eom bytes output compressed payload compressedpayload limit compressed payload compressedpayload limit eom bytes length compressed part compressedpart message part messagepart get rsv getrsv uncompressed part uncompressedpart op code opcode compressed payload compressedpayload uncompressed int ermediate handler uncompressedintermediatehandler uncompressed int ermediate handler uncompressedintermediatehandler def late required deflaterequired start new message startnewmessage full needs input needsinput write buffer full input message fully read output start compressed compressed part compressedpart message part messagepart get rsv getrsv uncompressed part uncompressedpart op code opcode compressed payload compressedpayload uncompressed int ermediate handler uncompressedintermediatehandler uncompressed int ermediate handler uncompressedintermediatehandler fin full needs input needsinput write buffer full input message fully read output data compressed part compressedpart message part messagepart get rsv getrsv uncompressed part uncompressedpart op code opcode compressed payload compressedpayload uncompressed int ermediate handler uncompressedintermediatehandler uncompressed int ermediate handler uncompressedintermediatehandler def late required deflaterequired fin full needs input needsinput write buffer full input fully read deflater output complete happened align buffer middle eom bytes write eom bytes data write eom buffer written eombufferwritten deflater def late deflate eom buffer eom buffer length deflater sync flush eom buffer written eombufferwritten eom buffer length eom completed compressed payload compressedpayload limit compressed payload compressedpayload limit eom bytes length eom buffer written eombufferwritten compressed part compressedpart message part messagepart get rsv getrsv uncompressed part uncompressedpart op code opcode compressed payload compressedpayload uncompressed int ermediate handler uncompressedintermediatehandler uncompressed int ermediate handler uncompressedintermediatehandler def late required deflaterequired start new message startnewmessage data write copy bytes write buffer write buffer writebuffer eom buffer eom buffer written eombufferwritten compressed part compressedpart message part messagepart get rsv getrsv uncompressed part uncompressedpart op code opcode compressed payload compressedpayload uncompressed int ermediate handler uncompressedintermediatehandler uncompressed int ermediate handler uncompressedintermediatehandler illegal state exception illegalstateexception happen add newly created compressed parts pass transformation compressed parts compressedparts add compressed part compressedpart send handler sendhandler uncompressed end handler uncompressedendhandler uncompressed part uncompressedpart get end handler getendhandler size compressed parts compressedparts size size compressed parts compressedparts size set end handler setendhandler uncompressed end handler uncompressedendhandler all compressed parts allcompressedparts add all addall compressed parts compressedparts all compressed parts allcompressedparts send message part sendmessagepart all compressed parts allcompressedparts start new message startnewmessage first compressed frame written firstcompressedframewritten is server isserver server context takeover servercontexttakeover is server isserver client context takeover clientcontexttakeover deflater reset get rsv getrsv message part messagepart uncompressed message part uncompressedmessagepart result uncompressed message part uncompressedmessagepart get rsv getrsv first compressed frame written firstcompressedframewritten result rsv bitmask first compressed frame written firstcompressedframewritten result override close transformation close inflater deflater