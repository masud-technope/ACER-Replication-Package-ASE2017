licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina loader java file java file output stream fileoutputstream java io exception ioexception java input stream inputstream java lang ins trument instrument class file transformer classfiletransformer java lang reflect method java security protection domain protectiondomain org junit assert equals assertequals org junit assert not null assertnotnull org junit assert same assertsame org junit fail org junit org junit after class afterclass org junit org junit before class beforeclass org junit test org apache catalina context org apache catalina startup tomcat org apache catalina startup tomcat base test tomcatbasetest org apache tomcat util http file upload fileupload file utils fileutils test webapp class loader weaving testwebappclassloaderweaving tomcat base test tomcatbasetest string prefix org apache catalina loader string webapp doc base before class beforeclass set up class setupclass exception webapp doc base system get property getproperty java tmp dir tmpdir test webapp class loader weaving testwebappclassloaderweaving file classes file webapp doc base web inf classes prefix classes mkdirs copy resource copyresource prefix tester never weaved class testerneverweavedclass file classes tester never weaved class testerneverweavedclass copy resource copyresource prefix tester unweaved class testerunweavedclass file classes tester unweaved class testerunweavedclass after class afterclass tear down class teardownclass exception file utils fileutils delete directory deletedirectory file webapp doc base tomcat tomcat context context webapp class loader webappclassloader loader override set up setup exception set up setup tomcat get tomcat instance gettomcatinstance context tomcat add context addcontext weaving webapp doc base tomcat start class loader classloader loader context get loader getloader get class loader getclassloader assert not null assertnotnull loader loader assert same assertsame loader correct webapp class loader webappclassloader loader get class getclass loader webapp class loader webappclassloader loader override tear down teardown exception loader context tomcat get host gethost remove child removechild context context tear down teardown test test no weaving testnoweaving exception string result invoke do method on class invokedomethodonclass loader tester never weaved class testerneverweavedclass assert equals assertequals result correct weaved result result invoke do method on class invokedomethodonclass loader tester unweaved class testerunweavedclass assert equals assertequals result correct unweaved result test test adding null transformer throws exception testaddingnulltransformerthrowsexception exception loader add transformer addtransformer fail expected exception illegal argument exception illegalargumentexception exception illegal argument exception illegalargumentexception ignore loading work weaving string result invoke do method on class invokedomethodonclass loader tester never weaved class testerneverweavedclass assert equals assertequals result correct weaved result result invoke do method on class invokedomethodonclass loader tester unweaved class testerunweavedclass assert equals assertequals result correct unweaved result test test added transformer ins truments class testaddedtransformerinstrumentsclass exception loader add transformer addtransformer replacement transformer replacementtransformer weaved replacement string result invoke do method on class invokedomethodonclass loader tester never weaved class testerneverweavedclass assert equals assertequals result correct weaved result result invoke do method on class invokedomethodonclass loader tester unweaved class testerunweavedclass assert equals assertequals result correct weaver result test test added transformer ins truments class testaddedtransformerinstrumentsclass exception loader add transformer addtransformer replacement transformer replacementtransformer weaved replacement string result invoke do method on class invokedomethodonclass loader tester never weaved class testerneverweavedclass assert equals assertequals result correct weaved result result invoke do method on class invokedomethodonclass loader tester unweaved class testerunweavedclass assert equals assertequals result correct weaver result test test transformers execute in order added testtransformersexecuteinorderadded exception loader add transformer addtransformer replacement transformer replacementtransformer weaved replacement loader add transformer addtransformer replacement transformer replacementtransformer weaved replacement string result invoke do method on class invokedomethodonclass loader tester never weaved class testerneverweavedclass assert equals assertequals result correct weaved result result invoke do method on class invokedomethodonclass loader tester unweaved class testerunweavedclass assert equals assertequals result correct weaver result test test transformers execute in order added testtransformersexecuteinorderadded exception loader add transformer addtransformer replacement transformer replacementtransformer weaved replacement loader add transformer addtransformer replacement transformer replacementtransformer weaved replacement string result invoke do method on class invokedomethodonclass loader tester never weaved class testerneverweavedclass assert equals assertequals result correct weaved result result invoke do method on class invokedomethodonclass loader tester unweaved class testerunweavedclass assert equals assertequals result correct weaver result test test removed transformer no longer ins truments testremovedtransformernolongerinstruments exception replacement transformer replacementtransformer removed replacement transformer replacementtransformer weaved replacement loader add transformer addtransformer removed loader remove transformer removetransformer removed string result invoke do method on class invokedomethodonclass loader tester never weaved class testerneverweavedclass assert equals assertequals result correct weaved result result invoke do method on class invokedomethodonclass loader tester unweaved class testerunweavedclass assert equals assertequals result correct unweaved result test test removed transformer no longer ins truments testremovedtransformernolongerinstruments exception loader add transformer addtransformer replacement transformer replacementtransformer weaved replacement replacement transformer replacementtransformer removed replacement transformer replacementtransformer weaved replacement loader add transformer addtransformer removed loader remove transformer removetransformer removed string result invoke do method on class invokedomethodonclass loader tester never weaved class testerneverweavedclass assert equals assertequals result correct weaved result result invoke do method on class invokedomethodonclass loader tester unweaved class testerunweavedclass assert equals assertequals result correct weaver result test test removed transformer no longer ins truments testremovedtransformernolongerinstruments exception loader add transformer addtransformer replacement transformer replacementtransformer weaved replacement replacement transformer replacementtransformer removed replacement transformer replacementtransformer weaved replacement loader add transformer addtransformer removed loader remove transformer removetransformer removed string result invoke do method on class invokedomethodonclass loader tester never weaved class testerneverweavedclass assert equals assertequals result correct weaved result result invoke do method on class invokedomethodonclass loader tester unweaved class testerunweavedclass assert equals assertequals result correct weaver result suppress warnings suppresswarnings deprecation test test copied class loader excludes resources and transformers testcopiedclassloaderexcludesresourcesandtransformers exception loader add transformer addtransformer replacement transformer replacementtransformer weaved replacement loader add transformer addtransformer replacement transformer replacementtransformer weaved replacement string result invoke do method on class invokedomethodonclass loader tester never weaved class testerneverweavedclass assert equals assertequals result correct weaved result result invoke do method on class invokedomethodonclass loader tester unweaved class testerunweavedclass assert equals assertequals result correct weaver result webapp class loader webappclassloader copied loader copiedloader loader copy without transformers copywithouttransformers result invoke do method on class invokedomethodonclass copied loader copiedloader tester never weaved class testerneverweavedclass assert equals assertequals result correct weaved result result invoke do method on class invokedomethodonclass copied loader copiedloader tester unweaved class testerunweavedclass assert equals assertequals fourth result correct unweaved result assert equals assertequals getantijarlocking match value of valueof loader getantijarlocking value of valueof copied loader copiedloader getantijarlocking assert equals assertequals get clear references http client keep alive thread getclearreferenceshttpclientkeepalivethread match value of valueof loader get clear references http client keep alive thread getclearreferenceshttpclientkeepalivethread value of valueof copied loader copiedloader get clear references http client keep alive thread getclearreferenceshttpclientkeepalivethread assert equals assertequals get clear references log factory release getclearreferenceslogfactoryrelease match value of valueof loader get clear references log factory release getclearreferenceslogfactoryrelease value of valueof copied loader copiedloader get clear references log factory release getclearreferenceslogfactoryrelease assert equals assertequals get clear references static getclearreferencesstatic match value of valueof loader get clear references static getclearreferencesstatic value of valueof copied loader copiedloader get clear references static getclearreferencesstatic assert equals assertequals get clear references stop threads getclearreferencesstopthreads match value of valueof loader get clear references stop threads getclearreferencesstopthreads value of valueof copied loader copiedloader get clear references stop threads getclearreferencesstopthreads assert equals assertequals get clear references stop timer threads getclearreferencesstoptimerthreads match value of valueof loader get clear references stop timer threads getclearreferencesstoptimerthreads value of valueof copied loader copiedloader get clear references stop timer threads getclearreferencesstoptimerthreads assert equals assertequals get context name getcontextname match loader get context name getcontextname copied loader copiedloader get context name getcontextname assert equals assertequals get delegate getdelegate match value of valueof loader get delegate getdelegate value of valueof copied loader copiedloader get delegate getdelegate assert equals assertequals get jar path getjarpath match loader get jar path getjarpath copied loader copiedloader get jar path getjarpath assert equals assertequals geturls match loader geturls length copied loader copiedloader geturls length assert same assertsame get parent getparent match loader get parent getparent copied loader copiedloader get parent getparent copy resource copyresource string file file exception input stream inputstream test webapp class loader weaving testwebappclassloaderweaving get class loader getclassloader get resource as stream getresourceasstream io exception ioexception resource classpath file output stream fileoutputstream file output stream fileoutputstream file read read write close io exception ioexception close io exception ioexception string invoke do method on class invokedomethodonclass webapp class loader base webappclassloaderbase loader string class name classname exception loader find class findclass org apache catalina loader class name classname assert not null assertnotnull loaded method get method getmethod do method domethod object new instance newinstance string invoke replacement transformer replacementtransformer class file transformer classfiletransformer string weave prefix tester unweaved class testerunweavedclass replacement replacement transformer replacementtransformer replacement replacement replacement override transform class loader classloader loader string class name classname protection domain protectiondomain weave equals class name classname replacement compiled version org apache catalina loader tester unweaved class testerunweavedclass do method domethod method returns weaver compiled oracle java weaved replacement compiled version org apache catalina loader tester unweaved class testerunweavedclass do method domethod method returns weaver compiled oracle java weaved replacement weaved replacement weaved replacement field contents generated code reg enerate regenerate alter tester unweaved class testerunweavedclass code desired recompile main method main string arguments exception input stream inputstream input test webapp class loader weaving testwebappclassloaderweaving get class loader getclassloader get resource as stream getresourceasstream org apache catalina loader tester unweaved class testerunweavedclass string builder stringbuilder builder string builder stringbuilder builder append system println weaved replacement input read input read string builder length length builder append system println builder to string tostring builder string builder stringbuilder builder append append builder append builder append system println builder to string tostring input close system println