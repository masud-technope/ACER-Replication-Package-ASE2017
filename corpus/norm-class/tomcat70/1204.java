licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina realm java io exception ioexception java security principal java util array list arraylist java util list javax servlet servlet security element servletsecurityelement javax servlet annotation servlet security servletsecurity org junit org junit test org apache catalina context org apache catalina connector request org apache catalina connector response org apache catalina deploy security collection securitycollection org apache catalina deploy security constraint securityconstraint org apache catalina startup tester map realm testermaprealm org apache tomcat unit test unittest tester context testercontext org apache tomcat unit test unittest tester request testerrequest org apache tomcat unit test unittest tester response testerresponse test realm base testrealmbase string user user string user user string user user string pwd password string role role string role role string role role string role role digested pass words passwords digested form password string pwd dcc deb string pwd sha baa string pwd prefix qn zd ydgyfeu pm q qnzdydgyfeuilpmq string pwd sha prefix sha ggi lb pgz g ggiulbpgzg salt password salttoprotectpassword string pwd ssha prefix ssha o lhvf vq fyk wu oflhvfqvqfykewu ppe q r z wx qrzywx wcm zwn cgfzc dvcm q dvcmq string role roles test test digest d testdigestmd exception do test digest digest passwords dotestdigestdigestpasswords pwd pwd test testdigestsha exception do test digest digest passwords dotestdigestdigestpasswords pwd sha pwd sha test test digest d testdigestmd prefix exception do test digest digest passwords dotestdigestdigestpasswords pwd pwd prefix test testdigestshaprefix exception do test digest digest passwords dotestdigestdigestpasswords pwd sha pwd sha prefix test testdigestsshaprefix exception do test digest digest passwords dotestdigestdigestpasswords pwd sha pwd ssha prefix do test digest digest passwords dotestdigestdigestpasswords string password string digest string digested password digestedpassword exception context context tester context testercontext tester map realm testermaprealm realm tester map realm testermaprealm realm set container setcontainer context realm set digest setdigest digest realm start realm add user adduser user digested password digestedpassword principal realm authenticate user password assert not null assertnotnull assert equals assertequals user get name getname test test user with single role testuserwithsinglerole io exception ioexception list string user roles userroles array list arraylist string list string constraint roles constraintroles array list arraylist string list string application roles applicationroles array list arraylist string configure test user roles userroles add role constraint roles constraintroles add role application roles applicationroles add role do role test doroletest user roles userroles constraint roles constraintroles application roles applicationroles test test user with no roles testuserwithnoroles io exception ioexception list string user roles userroles array list arraylist string list string constraint roles constraintroles array list arraylist string list string application roles applicationroles array list arraylist string configure test constraint roles constraintroles add role application roles applicationroles add role do role test doroletest user roles userroles constraint roles constraintroles application roles applicationroles test test user with single role and all roles testuserwithsingleroleandallroles io exception ioexception list string user roles userroles array list arraylist string list string constraint roles constraintroles array list arraylist string list string application roles applicationroles array list arraylist string configure test user roles userroles add role application roles applicationroles add role constraint roles constraintroles add role roles do role test doroletest user roles userroles constraint roles constraintroles application roles applicationroles test test user without no roles and all roles testuserwithoutnorolesandallroles io exception ioexception list string user roles userroles array list arraylist string list string constraint roles constraintroles array list arraylist string list string application roles applicationroles array list arraylist string configure test constraint roles constraintroles add role roles application roles applicationroles add role do role test doroletest user roles userroles constraint roles constraintroles application roles applicationroles test test all roles with no app role testallroleswithnoapprole io exception ioexception list string user roles userroles array list arraylist string list string constraint roles constraintroles array list arraylist string list string application roles applicationroles array list arraylist string configure test user roles userroles add role constraint roles constraintroles add role roles do role test doroletest user roles userroles constraint roles constraintroles application roles applicationroles test test no auth constraint testnoauthconstraint io exception ioexception constraint access list string application roles applicationroles array list arraylist string do role test doroletest application roles applicationroles combining constraints tests based scenarios test test combine constraints testcombineconstraints io exception ioexception allowed roles union roles constraints user role constraint list string user roles userroles array list arraylist string list string constraint one roles constraintoneroles array list arraylist string list string constraint two roles constrainttworoles array list arraylist string list string application roles applicationroles array list arraylist string user roles userroles add role constraint one roles constraintoneroles add role constraint two roles constrainttworoles add role application roles applicationroles add role application roles applicationroles add role do role test doroletest user roles userroles constraint one roles constraintoneroles constraint two roles constrainttworoles application roles applicationroles test test combine constraints testcombineconstraints io exception ioexception allowed roles union roles constraints user role constraint list string user roles userroles array list arraylist string list string constraint one roles constraintoneroles array list arraylist string list string constraint two roles constrainttworoles array list arraylist string list string application roles applicationroles array list arraylist string user roles userroles add role constraint one roles constraintoneroles add role constraint two roles constrainttworoles add role application roles applicationroles add role application roles applicationroles add role do role test doroletest user roles userroles constraint one roles constraintoneroles constraint two roles constrainttworoles application roles applicationroles test test combine constraints testcombineconstraints io exception ioexception allowed roles union roles constraints user role constraint list string user roles userroles array list arraylist string list string constraint one roles constraintoneroles array list arraylist string list string constraint two roles constrainttworoles array list arraylist string list string application roles applicationroles array list arraylist string user roles userroles add role constraint one roles constraintoneroles add role constraint two roles constrainttworoles add role application roles applicationroles add role application roles applicationroles add role do role test doroletest user roles userroles constraint one roles constraintoneroles constraint two roles constrainttworoles application roles applicationroles test test combine constraints testcombineconstraints io exception ioexception allowed roles union roles constraints app role user role constraint list string user roles userroles array list arraylist string list string constraint one roles constraintoneroles array list arraylist string list string constraint two roles constrainttworoles array list arraylist string list string application roles applicationroles array list arraylist string user roles userroles add role constraint one roles constraintoneroles add role constraint two roles constrainttworoles add role roles application roles applicationroles add role application roles applicationroles add role do role test doroletest user roles userroles constraint one roles constraintoneroles constraint two roles constrainttworoles application roles applicationroles test test combine constraints testcombineconstraints io exception ioexception allowed roles union roles constraints app role user role app constraint role list string user roles userroles array list arraylist string list string constraint one roles constraintoneroles array list arraylist string list string constraint two roles constrainttworoles array list arraylist string list string application roles applicationroles array list arraylist string user roles userroles add role constraint one roles constraintoneroles add role constraint two roles constrainttworoles add role roles application roles applicationroles add role application roles applicationroles add role do role test doroletest user roles userroles constraint one roles constraintoneroles constraint two roles constrainttworoles application roles applicationroles test test combine constraints testcombineconstraints io exception ioexception allowed roles union roles constraints app role user role app role list string user roles userroles array list arraylist string list string constraint one roles constraintoneroles array list arraylist string list string constraint two roles constrainttworoles array list arraylist string list string application roles applicationroles array list arraylist string user roles userroles add role constraint one roles constraintoneroles add role constraint two roles constrainttworoles add role roles application roles applicationroles add role application roles applicationroles add role do role test doroletest user roles userroles constraint one roles constraintoneroles constraint two roles constrainttworoles application roles applicationroles test test combine constraints testcombineconstraints io exception ioexception allowed roles union roles constraints app role user role list string user roles userroles array list arraylist string list string constraint one roles constraintoneroles array list arraylist string list string constraint two roles constrainttworoles array list arraylist string list string application roles applicationroles array list arraylist string constraint one roles constraintoneroles add role constraint two roles constrainttworoles add role roles application roles applicationroles add role application roles applicationroles add role do role test doroletest user roles userroles constraint one roles constraintoneroles constraint two roles constrainttworoles application roles applicationroles test test combine constraints testcombineconstraints io exception ioexception allowed roles union roles constraints constraint role implied role per mits permits unauthenticated users user authenticated list string constraint two roles constrainttworoles array list arraylist string list string application roles applicationroles array list arraylist string constraint two roles constrainttworoles add role application roles applicationroles add role do role test doroletest constraint two roles constrainttworoles application roles applicationroles test test combine constraints testcombineconstraints io exception ioexception allowed roles union roles constraints constraint role implied role per mits permits unauthenticated users user authenticated list string constraint two roles constrainttworoles array list arraylist string list string application roles applicationroles array list arraylist string constraint two roles constrainttworoles add role roles application roles applicationroles add role do role test doroletest constraint two roles constrainttworoles application roles applicationroles test test combine constraints testcombineconstraints io exception ioexception allowed roles union roles constraints constraint empty prevents access user matching constraint role list string user roles userroles array list arraylist string list string constraint one roles constraintoneroles array list arraylist string list string constraint two roles constrainttworoles array list arraylist string list string application roles applicationroles array list arraylist string user roles userroles add role constraint two roles constrainttworoles add role application roles applicationroles add role do role test doroletest user roles userroles constraint one roles constraintoneroles constraint two roles constrainttworoles application roles applicationroles test test combine constraints testcombineconstraints io exception ioexception allowed roles union roles constraints constraint empty prevents access user matching role list string user roles userroles array list arraylist string list string constraint one roles constraintoneroles array list arraylist string list string constraint two roles constrainttworoles array list arraylist string list string application roles applicationroles array list arraylist string user roles userroles add role constraint two roles constrainttworoles add role roles application roles applicationroles add role do role test doroletest user roles userroles constraint one roles constraintoneroles constraint two roles constrainttworoles application roles applicationroles param user roles userroles code code tests unauthenticated access access tested authenticated user listed roles param constraint roles constraintroles code code equivalent constraint empty list equivalent constraint defines roles do role test doroletest list string user roles userroles list string constraint roles constraintroles list string application roles applicationroles expected io exception ioexception list string constraint two roles constrainttworoles array list arraylist string constraint two roles constrainttworoles add role do role test doroletest user roles userroles constraint roles constraintroles constraint two roles constrainttworoles application roles applicationroles expected do role test doroletest list string user roles userroles list string constraint one roles constraintoneroles list string constraint two roles constrainttworoles list string application roles applicationroles expected io exception ioexception tester map realm testermaprealm map realm maprealm tester map realm testermaprealm configure security constraints resource security constraint securityconstraint constraint one constraintone security constraint securityconstraint constraint one roles constraintoneroles constraint one constraintone set auth constraint setauthconstraint string constraint role constraintrole constraint one roles constraintoneroles constraint one constraintone add auth role addauthrole constraint role constraintrole security constraint securityconstraint constraint two constrainttwo security constraint securityconstraint constraint two roles constrainttworoles constraint two constrainttwo set auth constraint setauthconstraint string constraint role constraintrole constraint two roles constrainttworoles constraint two constrainttwo add auth role addauthrole constraint role constraintrole security constraint securityconstraint constraints security constraint securityconstraint constraint one constraintone constraint two constrainttwo mock request response request request request response response tester response testerresponse context context tester context testercontext string application role applicationrole application roles applicationroles context add security role addsecurityrole application role applicationrole request set context setcontext context configure users realm user roles userroles generic principal genericprincipal generic principal genericprincipal user pwd user roles userroles request set user principal setuserprincipal check user meets constraints result map realm maprealm has resource permission hasresourcepermission request response constraints assert equals assertequals value of valueof expected value of valueof result test covers special servlet specification link javax servlet annotation http constraint httpconstraint test test http constraint testhttpconstraint io exception ioexception annotation test tester servlet security testerservletsecurity clazz tester servlet security testerservletsecurity servlet security servletsecurity servlet security servletsecurity clazz get annotation getannotation servlet security servletsecurity convert annotation constraints servlet security element servletsecurityelement servlet security element servletsecurityelement servlet security element servletsecurityelement servlet security servletsecurity security constraint securityconstraint constraints security constraint securityconstraint create constraints createconstraints servlet security element servletsecurityelement create separate constraint covers delete security constraint securityconstraint delete constraint deleteconstraint security constraint securityconstraint delete constraint deleteconstraint add auth role addauthrole role security collection securitycollection delete collection deletecollection security collection securitycollection delete collection deletecollection add method addmethod delete delete collection deletecollection add pattern addpattern delete constraint deleteconstraint add collection addcollection delete collection deletecollection tester map realm testermaprealm map realm maprealm tester map realm testermaprealm mock request response tester request testerrequest request tester request testerrequest response response tester response testerresponse context context request get context getcontext context add security role addsecurityrole role context add security role addsecurityrole role request set context setcontext context create principals list string user roles userroles array list arraylist string user roles userroles add role generic principal genericprincipal generic principal genericprincipal user pwd user roles userroles list string user roles userroles array list arraylist string user roles userroles add role generic principal genericprincipal generic principal genericprincipal user pwd user roles userroles list string user roles userroles array list arraylist string generic principal genericprincipal generic principal genericprincipal user pwd user roles userroles add constraints context security constraint securityconstraint constraint constraints context add constraint addconstraint constraint context add constraint addconstraint delete constraint deleteconstraint users perform request set method setmethod security constraint securityconstraint constraints get constraintsget map realm maprealm find security constraints findsecurityconstraints request context request set user principal setuserprincipal assert true asserttrue map realm maprealm has resource permission hasresourcepermission request response constraints get constraintsget request set user principal setuserprincipal assert true asserttrue map realm maprealm has resource permission hasresourcepermission request response constraints get constraintsget request set user principal setuserprincipal assert true asserttrue map realm maprealm has resource permission hasresourcepermission request response constraints get constraintsget request set user principal setuserprincipal assert true asserttrue map realm maprealm has resource permission hasresourcepermission request response constraints get constraintsget user perform post user role request set method setmethod post security constraint securityconstraint constraints post constraintspost map realm maprealm find security constraints findsecurityconstraints request context request set user principal setuserprincipal assert false assertfalse map realm maprealm has resource permission hasresourcepermission request response constraints post constraintspost request set user principal setuserprincipal assert true asserttrue map realm maprealm has resource permission hasresourcepermission request response constraints post constraintspost request set user principal setuserprincipal assert false assertfalse map realm maprealm has resource permission hasresourcepermission request response constraints post constraintspost request set user principal setuserprincipal assert false assertfalse map realm maprealm has resource permission hasresourcepermission request response constraints post constraintspost users application roles role role user user perform request set method setmethod security constraint securityconstraint constraints put constraintsput map realm maprealm find security constraints findsecurityconstraints request context request set user principal setuserprincipal assert false assertfalse map realm maprealm has resource permission hasresourcepermission request response constraints put constraintsput request set user principal setuserprincipal assert true asserttrue map realm maprealm has resource permission hasresourcepermission request response constraints put constraintsput request set user principal setuserprincipal assert true asserttrue map realm maprealm has resource permission hasresourcepermission request response constraints put constraintsput request set user principal setuserprincipal assert false assertfalse map realm maprealm has resource permission hasresourcepermission request response constraints put constraintsput user perform delete user role request set method setmethod delete security constraint securityconstraint constraints delete constraintsdelete map realm maprealm find security constraints findsecurityconstraints request context request set user principal setuserprincipal assert false assertfalse map realm maprealm has resource permission hasresourcepermission request response constraints delete constraintsdelete request set user principal setuserprincipal assert true asserttrue map realm maprealm has resource permission hasresourcepermission request response constraints delete constraintsdelete request set user principal setuserprincipal assert false assertfalse map realm maprealm has resource permission hasresourcepermission request response constraints delete constraintsdelete request set user principal setuserprincipal assert false assertfalse map realm maprealm has resource permission hasresourcepermission request response constraints delete constraintsdelete