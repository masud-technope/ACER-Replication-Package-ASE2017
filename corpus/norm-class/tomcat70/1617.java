licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina session java io exception ioexception java security access controller accesscontroller java security privileged action exception privilegedactionexception java security privileged exception action privilegedexceptionaction java util hash map hashmap java util hash set hashset java util map java util org apache catalina distributed manager distributedmanager org apache catalina lifecycle org apache catalina lifecycle exception lifecycleexception org apache catalina lifecycle state lifecyclestate org apache catalina session org apache catalina store org apache catalina security security util securityutil org apache juli logging log org apache juli logging log factory logfactory link manager base managerbase implement functionality required manager supports kind persistence rest arts restarts implementation note correct behavior session storing reloading depends external calls link lifecycle start link lifecycle methods correct times author craig mc clanahan mcclanahan author jean francois arcand persistent manager base persistentmanagerbase manager base managerbase distributed manager distributedmanager log log log factory logfactory get log getlog persistent manager base persistentmanagerbase privileged store clear privilegedstoreclear privileged exception action privilegedexceptionaction privileged store clear privilegedstoreclear noop override exception store clear privileged store remove privilegedstoreremove privileged exception action privilegedexceptionaction string privileged store remove privilegedstoreremove string override exception store remove privileged store load privilegedstoreload privileged exception action privilegedexceptionaction session string privileged store load privilegedstoreload string override session exception store load privileged store save privilegedstoresave privileged exception action privilegedexceptionaction session session privileged store save privilegedstoresave session session session session override exception store save session privileged store keys privilegedstorekeys privileged exception action privilegedexceptionaction string privileged store keys privilegedstorekeys noop override string exception store instance variables descriptive implementation string info persistent manager base persistentmanagerbase descriptive manager implementation logging string persistent manager base persistentmanagerbase key not e note session timestamp backup stored string persisted accessed time org apache catalina session persistent manager base persistentmanagerbase persisted last accessed time persistedlastaccessedtime store object manage session store store store save reload sessions manager code unload code code load code methods called save on restart saveonrestart session idle backed code sessions won backed max idle backup maxidlebackup minimum time seconds session idle eligible swapped disk active session count max active sessions maxactivesessions setting code sessions swapped active session count min idle swap minidleswap maximum time seconds session idle eligible swapped disk inactivity setting code sessions swapped inactivity max idle swap maxidleswap sessions swapped locks map string object session swap in locks sessionswapinlocks hash map hashmap string object properties seconds session request backed store code sessions backed timeout sessions ripe get max idle backup getmaxidlebackup max idle backup maxidlebackup sets option sessions store request sessions remain memory backed pass ivated passivated swapped session backed code sessions backed note hard limit sessions checked age limit per iodically periodically code process expires frequency processexpiresfrequency considered session ripe backing session idle code max idle backup maxidlebackup process expires frequency processexpiresfrequency engine background processor delay backgroundprocessordelay seconds time takes handle session expiration swap ping swapping tasks param backup number seconds accessed time written store set max idle backup setmaxidlebackup backup backup max idle backup maxidlebackup old backup oldbackup max idle backup maxidlebackup max idle backup maxidlebackup backup support fire property change firepropertychange max idle backup maxidlebackup integer value of valueof old backup oldbackup integer value of valueof max idle backup maxidlebackup maximum time seconds session idle eligible swapped disk inactivity code sessions swapped inactivity get max idle swap getmaxidleswap max idle swap maxidleswap sets maximum time seconds session idle eligible swapped disk inactivity setting code sessions swapped inactivity param max time seconds wait swap set max idle swap setmaxidleswap max max max idle swap maxidleswap old max idle swap oldmaxidleswap max idle swap maxidleswap max idle swap maxidleswap max support fire property change firepropertychange max idle swap maxidleswap integer value of valueof old max idle swap oldmaxidleswap integer value of valueof max idle swap maxidleswap minimum time seconds session idle eligible swapped disk active session count max active sessions maxactivesessions code sessions swapped active session count get min idle swap getminidleswap min idle swap minidleswap sets minimum time seconds session idle eligible swapped disk active session count max active sessions maxactivesessions setting code sessions swapped active session count param min time seconds swap set min idle swap setminidleswap min min idle swap minidleswap min old min idle swap oldminidleswap min idle swap minidleswap min idle swap minidleswap min support fire property change firepropertychange min idle swap minidleswap integer value of valueof old min idle swap oldminidleswap integer value of valueof min idle swap minidleswap descriptive manager implementation version number format code description version code override string get info getinfo info check session loaded memory param session session searched code session loaded memory code returned is loaded isloaded string find session findsession io exception ioexception log error checking is loaded isloaded get message getmessage override string get name getname store object manage persistent session storage manager param store store set store setstore store store store store store set manager setmanager store object manages persistent session storage manager store get store getstore store sessions saved manager shut properly requires link unload method called code sessions saved restart code get save on restart getsaveonrestart save on restart saveonrestart option save sessions store manager shut loaded manager starts sessions store picked manager started param save on restart saveonrestart code sessions saved restart code set save on restart setsaveonrestart save on restart saveonrestart save on restart saveonrestart save on restart saveonrestart old save on restart oldsaveonrestart save on restart saveonrestart save on restart saveonrestart save on restart saveonrestart support fire property change firepropertychange save on restart saveonrestart value of valueof old save on restart oldsaveonrestart value of valueof save on restart saveonrestart methods clear sessions store clear store clearstore store security util securityutil is package protection enabled ispackageprotectionenabled access controller accesscontroller do privileged doprivileged privileged store clear privilegedstoreclear privileged action exception privilegedactionexception exception exception get exception getexception log error exception clearing store exception exception store clear io exception ioexception log error exception clearing store inherit doc inheritdoc direct call process expires processexpires process persistence checks processpersistencechecks override process expires processexpires time now timenow system current time millis currenttimemillis session sessions find sessions findsessions expire here expirehere log is debug enabled isdebugenabled log debug start expire sessions get name getname time now timenow session count sessioncount sessions length sessions length sessions is valid isvalid expired sessions expiredsessions increment and get incrementandget expire here expirehere process persistence checks processpersistencechecks get store getstore get store getstore store base storebase store base storebase get store getstore process expires processexpires time end timeend system current time millis currenttimemillis log is debug enabled isdebugenabled log debug expire sessions get name getname processing time processingtime time end timeend time now timenow expired sessions expire here expirehere processing time processingtime time end timeend time now timenow called background thread active sessions checked expiration sessions swapped backed process persistence checks processpersistencechecks process max idle swaps processmaxidleswaps process max active swaps processmaxactiveswaps process max idle backups processmaxidlebackups inherit doc inheritdoc method checks persistence store persistence enabled functionality manager base managerbase override session find session findsession string io exception ioexception session session find session findsession safely session session session find session findsession session get id internal getidinternal session external calling code messing concurrency session access session end access endaccess session session session store session swap in swapin session remove session active sessions manager store persistent valve persistentvalve param session session removed remove super removesuper session session remove session load sessions persistence mechanism assuming marked valid passed expiration limit persistence supported method returns note method called middle manager middlemanager order subclass call start process persistence checks processpersistencechecks methods override load initialize internal data str uctures structures sessions clear store string ids security util securityutil is package protection enabled ispackageprotectionenabled ids access controller accesscontroller do privileged doprivileged privileged store keys privilegedstorekeys privileged action exception privilegedactionexception exception exception get exception getexception log error exception store load exception exception ids store io exception ioexception log error load sessions store get message getmessage ids length log is debug enabled isdebugenabled log debug get string getstring persistent manager persistentmanager loading string value of valueof swap in swapin ids io exception ioexception log error failed load session store get message getmessage inherit doc inheritdoc remove session store override remove session session update remove session update store remove session removesession session get id internal getidinternal remove session active sessions manager store param session removed remove session removesession string security util securityutil is package protection enabled ispackageprotectionenabled access controller accesscontroller do privileged doprivileged privileged store remove privilegedstoreremove privileged action exception privilegedactionexception exception exception get exception getexception log error exception store remove session removesession exception exception store remove io exception ioexception log error exception removing session get message getmessage save active sessions persistence mechanism persistence supported method returns note method called middle manager middlemanager order subclass call process persistence checks processpersistencechecks methods override unload store session sessions find sessions findsessions sessions length log is debug enabled isdebugenabled log debug get string getstring persistent manager persistentmanager unloading string value of valueof swap out swapout sessions io exception ioexception override get active sessions full getactivesessionsfull memory session count result get active sessions getactivesessions store session count result get store getstore get size getsize io exception ioexception ioe log warn get string getstring persistent manager persistentmanager store size exception storesizeexception result override string get session ids full getsessionidsfull string session ids sessionids hash set hashset string memory session list session ids sessionids add all addall sessions key set keyset store session list string store keys storekeys store keys storekeys get store getstore string store key storekey store keys storekeys session ids sessionids add store key storekey io exception ioexception log warn get string getstring persistent manager persistentmanager store keys exception storekeysexception session ids sessionids methods session store restore manager list active sessions session removed store swap ping swapping active session list invalid expiration res tored restored session code session swap in swapin string io exception ioexception store object swap in lock swapinlock purpose sync locks session loaded doesn matter lock removed thread enters method load session thread create swap in swapin lock session find session sessions carry swap in lock swapinlock session swap in locks sessionswapinlocks swap in lock swapinlock swap in lock swapinlock object session swap in locks sessionswapinlocks swap in lock swapinlock session session swap in lock swapinlock check thread loaded session manager session sessions session security util securityutil is package protection enabled ispackageprotectionenabled session access controller accesscontroller do privileged doprivileged privileged store load privilegedstoreload privileged action exception privilegedactionexception exception get exception getexception log error get string getstring persistent manager persistentmanager swap in exception swapinexception io exception ioexception io exception ioexception class not found exception classnotfoundexception class not found exception classnotfoundexception session store load class not found exception classnotfoundexception string msg get string getstring persistent manager persistentmanager deserialize error deserializeerror log error msg illegal state exception illegalstateexception msg session session is valid isvalid log error get string getstring persistent manager persistentmanager swap in invalid swapininvalid session expire remove session removesession session session log is debug enabled isdebugenabled log debug get string getstring persistent manager persistentmanager swap in swapin session set manager setmanager listeners standard session standardsession session tell new tellnew add session standard session standardsession session activate end access endaccess ensure time outs timeouts happen correctly access access count correct negative session access session end access endaccess lock removed session swap in locks sessionswapinlocks remove session remove session manager list active sessions write store session expiration invalid method param session session write swap out swapout session session io exception ioexception store session is valid isvalid standard session standardsession session pass ivate passivate write session writesession session remove session session recycle write session store modifying copy memory triggering pass ivation passivation events session invalid expiration write session writesession session session io exception ioexception store session is valid isvalid security util securityutil is package protection enabled ispackageprotectionenabled access controller accesscontroller do privileged doprivileged privileged store save privilegedstoresave session privileged action exception privilegedactionexception exception exception get exception getexception exception io exception ioexception io exception ioexception exception log error exception store write session writesession exception exception store save session io exception ioexception log error get string getstring persistent manager persistentmanager serialize error serializeerror session get id internal getidinternal start component implement requirements link org apache catalina util lifecycle base lifecyclebase start internal startinternal exception lifecycle exception lifecycleexception component detects fatal error prevents component override start internal startinternal lifecycle exception lifecycleexception start internal startinternal store log error store configured persistence disabled store lifecycle lifecycle store start set state setstate lifecycle state lifecyclestate starting component implement requirements link org apache catalina util lifecycle base lifecyclebase stop internal stopinternal exception lifecycle exception lifecycleexception component detects fatal error prevents component override stop internal stopinternal lifecycle exception lifecycleexception log is debug enabled isdebugenabled log debug stopping set state setstate lifecycle state lifecyclestate stopping get store getstore save on restart saveonrestart unload expire active sessions session sessions find sessions findsessions sessions length standard session standardsession session standard session standardsession sessions session is valid isvalid session expire get store getstore get store getstore lifecycle lifecycle get store getstore require random number generator res tarted restarted stop internal stopinternal methods swap idle sessions store idle process max idle swaps processmaxidleswaps get state getstate is available isavailable max idle swap maxidleswap session sessions find sessions findsessions time now timenow system current time millis currenttimemillis swap sessions idle longer max idle swap maxidleswap max idle swap maxidleswap sessions length standard session standardsession session standard session standardsession sessions session session is valid isvalid time idle timeidle standard session standardsession access start time idle timeidle time now timenow session get last accessed time internal getlastaccessedtimeinternal time idle timeidle time now timenow session get this accessed time internal getthisaccessedtimeinternal time idle timeidle max idle swap maxidleswap time idle timeidle min idle swap minidleswap session access count accesscount session access count accesscount session accessed skip log is debug enabled isdebugenabled log debug get string getstring persistent manager persistentmanager swap max idle swapmaxidle session get id internal getidinternal integer value of valueof time idle timeidle swap out swapout session io exception ioexception swap idle sessions store active process max active swaps processmaxactiveswaps get state getstate is available isavailable get max active sessions getmaxactivesessions session sessions find sessions findsessions fixme smarter algorithm lru limit get max active sessions getmaxactivesessions limit sessions length log is debug enabled isdebugenabled log debug get string getstring persistent manager persistentmanager too many active toomanyactive integer value of valueof sessions length toswap sessions length limit time now timenow system current time millis currenttimemillis sessions length toswap standard session standardsession session standard session standardsession sessions session time idle timeidle standard session standardsession access start time idle timeidle time now timenow session get last accessed time internal getlastaccessedtimeinternal time idle timeidle time now timenow session get this accessed time internal getthisaccessedtimeinternal time idle timeidle min idle swap minidleswap session access count accesscount session access count accesscount session accessed skip log is debug enabled isdebugenabled log debug get string getstring persistent manager persistentmanager swap too many active swaptoomanyactive session get id internal getidinternal integer value of valueof time idle timeidle swap out swapout session io exception ioexception toswap idle sessions process max idle backups processmaxidlebackups get state getstate is available isavailable max idle backup maxidlebackup session sessions find sessions findsessions time now timenow system current time millis currenttimemillis sessions idle longer max idle backup maxidlebackup max idle backup maxidlebackup sessions length standard session standardsession session standard session standardsession sessions session session is valid isvalid last accessed time lastaccessedtime session get last accessed time internal getlastaccessedtimeinternal persisted last accessed time persistedlastaccessedtime session get note getnote persisted accessed time persisted last accessed time persistedlastaccessedtime last accessed time lastaccessedtime persisted last accessed time persistedlastaccessedtime long value longvalue time idle timeidle standard session standardsession access start time idle timeidle time now timenow session get last accessed time internal getlastaccessedtimeinternal time idle timeidle time now timenow session get this accessed time internal getthisaccessedtimeinternal time idle timeidle max idle backup maxidlebackup log is debug enabled isdebugenabled log debug get string getstring persistent manager persistentmanager backup max idle backupmaxidle session get id internal getidinternal integer value of valueof time idle timeidle write session writesession session io exception ioexception session set note setnote persisted accessed time value of valueof last accessed time lastaccessedtime