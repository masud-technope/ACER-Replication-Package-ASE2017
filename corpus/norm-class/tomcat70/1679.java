licensed apache software foundation asf contributor license agreements notice file distributed work additional copyright ownership asf licenses file apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org apache catalina loader java byte array input stream bytearrayinputstream java file java file output stream fileoutputstream java file permission filepermission java i o exception ioexception java input stream inputstream java lang ins trument instrument class file transformer classfiletransformer java lang ins trument instrument illegal class format exception illegalclassformatexception java lang reference java lang weak reference weakreference java lang reflect field java lang reflect method java lang reflect modifier java net malformedurlexception java net url java net url class loader urlclassloader java nio charset charset java security access control exception accesscontrolexception java security access controller accesscontroller java security code source codesource java security permission java security permission collection permissioncollection java security policy java security privileged action privilegedaction java security protection domain protectiondomain java util array list arraylist java util collection java util collections java util concurrent modification exception concurrentmodificationexception java util enumeration java util hash map hashmap java util iterator java util linked hash map linkedhashmap java util linked hash set linkedhashset java util list java util map java util resource bundle resourcebundle java util java util concurrent concurrent hash map concurrenthashmap java util concurrent copy on write array list copyonwritearraylist java util concurrent thread pool executor threadpoolexecutor java util jar attributes java util jar attributes java util jar jar entry jarentry java util jar jar file jarfile java util jar manifest javax naming binding javax naming name class pair nameclasspair javax naming naming enumeration namingenumeration javax naming naming exception namingexception javax naming directory dir context dircontext org apache catalina globals org apache catalina lifecycle org apache catalina lifecycle exception lifecycleexception org apache catalina lifecycle listener lifecyclelistener org apache catalina lifecycle state lifecyclestate org apache naming jndi permission jndipermission org apache naming resources proxy dir context proxydircontext org apache naming resources resource org apache naming resources resource attributes resourceattributes org apache tomcat ins trumentable class loader instrumentableclassloader org apache tomcat util exception utils exceptionutils org apache tomcat util int rospection utils introspectionutils org apache tomcat util buf uri util uriutil org apache tomcat util comp at compat jre compat jrecompat org apache tomcat util comp at compat jre vendor jrevendor org apache tomcat util res string manager stringmanager org apache tomcat util security permission check permissioncheck special ized specialized web application loader loader full reimplementation code url class loader urlclassloader code jdk designed fully compatible normal code url class loader urlclassloader code internal behavior completely strong implementation note strong loader delegation model required specification system loader queried local repositories delegation parent loader occur web application override shared classes special handling jaxp xml parser interfaces jndi interfaces classes servlet api loaded webapp repositories code delegate code property application modify behavior move parent loader local repositories strong implementation note strong limitations jasper compilation technology repository classes servlet api loader strong implementation note strong loader generates source ur ls urls include full jar url loaded jar file setting security permission level contained jar strong implementation note strong local repositories searched order initial constructor subsequent calls code add repository addrepository code code add jar addjar code strong implementation note strong check sealing violations security security manager todo req uirement requirement provide proper lifecycle implementation current stub bed stubbed implementation strong implementation note strong loader link ins trumentable class loader instrumentableclassloader per mitting permitting web application classes ins trument instrument classes web application per mit permit ins trumentation instrumentation system container classes classes web apps author remy maucherat author craig mc clanahan mcclanahan webapp class loader base webappclassloaderbase url class loader urlclassloader lifecycle ins trumentable class loader instrumentableclassloader permission check permissioncheck org apache juli logging log log org apache juli logging log factory logfactory get log getlog webapp class loader base webappclassloaderbase charset charset utf charset for name forname utf list thread group threadgroup names ignore scanning web application started threads shut list string jvm thread group names array list arraylist string string jvm thread group system system string services prefix meta inf services string file suffix manifest manifest unknown manifest method class loading classloading lock method string manager stringmanager string manager stringmanager get manager getmanager constants register base loader parallel capable java jre s jres method get class loading lock method getclassloadinglockmethod jre compat jrecompat is jre isjre method register parallel registerparallel class loader classloader get declared method getdeclaredmethod register as parallel c apable registerasparallelcapable access controller accesscontroller do privileged doprivileged privileged action privilegedaction override register parallel registerparallel set accessible setaccessible register parallel registerparallel invoke get class loading lock method getclassloadinglockmethod class loader classloader get declared method getdeclaredmethod get class loading lock getclassloadinglock string exception class loading classloading lock method get class loading lock method getclassloadinglockmethod jvm thread group names add jvm thread group system jvm thread group names add rmi runtime privileged find resource by name privilegedfindresourcebyname privileged action privilegedaction resource entry resourceentry string string path manifest required manifestrequired privileged find resource by name privilegedfindresourcebyname string string path manifest required manifestrequired path path manifest required manifestrequired manifest required manifestrequired override resource entry resourceentry find resource internal findresourceinternal path manifest required manifestrequired privileged get class loader privilegedgetclassloader privileged action privilegedaction class loader classloader clazz privileged get class loader privilegedgetclassloader clazz clazz clazz override class loader classloader clazz get class loader getclassloader variables trigger classes proposed repository visible loader loaded factory typically trigger classes listed components int egrated integrated jdk versions jar files required earlier versions string triggers servlet api javax servlet servlet servlet api javax expression names allowed loaded webapp loader delegating string package triggers packagetriggers anti jar loc king locking code url rerouting accessing resources antijarlocking construct class loader classloader defined repositories parent class loader classloader webapp class loader base webappclassloaderbase url class loader classloader get parent getparent get system class loader getsystemclassloader parent class loader classloader string get class loader getclassloader get system class loader getsystemclassloader get parent getparent get parent getparent se class loader seclassloader security manager securitymanager system get security manager getsecuritymanager security manager securitymanager refresh policy refreshpolicy construct class loader classloader defined repositories parent class loader classloader method ref lection reflection link webapp loader webapploader create class loader createclassloader param parent parent loader webapp class loader base webappclassloaderbase class loader classloader parent url parent class loader classloader get parent getparent get system class loader getsystemclassloader parent class loader classloader string get class loader getclassloader get system class loader getsystemclassloader get parent getparent get parent getparent se class loader seclassloader security manager securitymanager system get security manager getsecuritymanager security manager securitymanager refresh policy refreshpolicy instance variables directory context access resources webapp dir context dircontext resources cache resource entry resourceentry classes resources loaded keyed resource path binary path key resources requested binary classes path resources property files mapping binary path unambiguous reverse mapping ambiguous map string resource entry resourceentry resource entries resourceentries concurrent hash map concurrenthashmap string resource entry resourceentry list resources hash map hashmap string string not found resources notfoundresources linked hash map linkedhashmap string string serialversionuid override remove eldest entry removeeldestentry map entry string string eldest size loader delegate parent loader strong strong searching repositories usual java delegation model code code loader search repositories delegate parent resource locally note code code behavior called servlet specification delegate time jar accessed last jar accessed lastjaraccessed list local repositories order searched locally loaded classes resources string repositories string repositories ur ls urls cache result geturls url repositoryurls repositories translated path work directory jasper originally generate fake ur ls urls geturls called file files file list ja rs jars order searched locally loaded classes resources jar file jarfile jar files jarfiles jar file jarfile list ja rs jars order searched locally loaded classes resources file jar real files jarrealfiles file path monitored jar files string jar path jarpath list ja rs jars order searched locally loaded classes resources string jar names jarnames string list ja rs jars modified dates order searched locally loaded classes resources last modified dates lastmodifieddates list resources checked checking modifications string paths string list read file jndi permission required loader web application context array list arraylist permission permission list permissionlist array list arraylist permission path resources loaded ja rs jars extracted file loader dir loaderdir string canonical loader dir canonicalloaderdir permission collection permissioncollection code source codesource web application context hash map hashmap string permission collection permissioncollection loaderpc hash map hashmap string permission collection permissioncollection instance security manager securitymanager installed security manager securitymanager security manager securitymanager parent loader class loader classloader parent system loader deprecated unused removed deprecated class loader classloader system bootstrap loader load javase classes implementations loader code cases link class loader classloader get parent getparent called recursively system loader result class loader classloader se class loader seclassloader component started started external repositories has external repositories hasexternalrepositories search external repositories search external first searchexternalfirst conversion properties files need convert needconvert permission permission all permission allpermission java security all permission allpermission enables rmi target memory leak detection control led controlled detection work java mod ularity modularity checks disabled clear references rmi targets clearreferencesrmitargets tomcat attempt fields loaded classes web application stopped work app are nt apparent garbage collection bugs application coding errors issues reported log option app lications applications memory leaks jvm s jvms operate correctly option code code code code deprecated option removed tomcat deprecated clear references static clearreferencesstatic tomcat attempt terminate threads started web application stop ping stopping threads performed deprecated good reason code thread code method result ins tab ility instability enabling viewed option res ort resort dev elopment development environment recommended product ion production environment code code clear references stop threads clearreferencesstopthreads tomcat attempt terminate link java util timer thread timerthread started web application code code clear references stop timer threads clearreferencesstoptimerthreads tomcat call link org apache juli logging log factory logfactory release loader stopped code code changing setting lead memory leaks issues clear references log factory release clearreferenceslogfactoryrelease http client httpclient alive timer thread started web application running tomcat change context loader current link webapp class loader base webappclassloaderbase link webapp class loader base webappclassloaderbase parent prevent memory leak note alive timer thread alives expire busy system happen time clear references http client keep alive thread clearreferenceshttpclientkeepalivethread context logging jmx associate web application clear references messages defaults unknown standard tomcat components updated init ialisation initialisation resources string context name contextname unknown h olds holds file transformers dec orating decorating loader copy on write array list copyonwritearraylist thread safe expensive writes rare fast reads synchronization import antly importantly class loader classloader block iter ating iterating transformers loading list class file transformer classfiletransformer transformers copy on write array list copyonwritearraylist class file transformer classfiletransformer code base classes loaded web inf classes url web inf classes code base webinfclassescodebase properties resources dir context dircontext get resources getresources resources resources set resources setresources dir context dircontext resources resources resources resources proxy dir context proxydircontext context name contextname proxy dir context proxydircontext resources get context name getcontextname context loader string get context name getcontextname context name contextname delegate flag loader get delegate getdelegate delegate delegate flag loader flag loader delegates parent loader strong strong searching repositories ordinary servlet chain java load ers loaders code code loader search repositories delegate parent resource locally servlet specification param delegate delegate flag set delegate setdelegate delegate delegate delegate returns antijarlocking getantijarlocking antijarlocking param antijarlocking antijarlocking setantijarlocking antijarlocking antijarlocking antijarlocking returns search external first searchexternalfirst get search external first getsearchexternalfirst search external first searchexternalfirst get clear references rmi targets getclearreferencesrmitargets clear references rmi targets clearreferencesrmitargets set clear references rmi targets setclearreferencesrmitargets clear references rmi targets clearreferencesrmitargets clear references rmi targets clearreferencesrmitargets clear references rmi targets clearreferencesrmitargets param search external first searchexternalfirst external repositories searched set search external first setsearchexternalfirst search external first searchexternalfirst search external first searchexternalfirst search external first searchexternalfirst java security manager securitymanager create read file permission filepermission jndi permission jndipermission file directory path param file path filepath file directory path add permission addpermission string file path filepath file path filepath string path file path filepath security manager securitymanager permission permission path starts with startswith jndi path starts with startswith jar jndi path ends with endswith path path permission jndi permission jndipermission path add permission addpermission permission path ends with endswith file separator permission file permission filepermission path read add permission addpermission permission path path file separator permission file permission filepermission path read add permission addpermission permission java security manager securitymanager create read file permission filepermission jndi permission jndipermission url param url url file directory local system add permission addpermission url url url add permission addpermission url to string tostring java security manager securitymanager create permission param permission permission add permission addpermission permission permission security manager securitymanager permission permission list permissionlist add permission jar path string get jar path getjarpath jar path jarpath change jar path set jar path setjarpath string jar path jarpath jar path jarpath jar path jarpath change work directory set work dir setworkdir file work dir workdir loader dir loaderdir file work dir workdir loader canonical loader dir canonicalloaderdir loader dir loaderdir get canonical path getcanonicalpath canonical loader dir canonicalloaderdir ends with endswith file separator canonical loader dir canonicalloaderdir file separator i o exception ioexception ioe canonical loader dir canonicalloaderdir utility method subclasses called lifecycle methods deprecated removed onwards deprecated set parent class loader setparentclassloader class loader classloader pcl parent pcl clear references static clearreferencesstatic flag context deprecated removed deprecated get clear references static getclearreferencesstatic clear references static clearreferencesstatic clear references static clearreferencesstatic feature context param clear references static clearreferencesstatic flag deprecated removed deprecated set clear references static setclearreferencesstatic clear references static clearreferencesstatic clear references static clearreferencesstatic clear references static clearreferencesstatic clear references stop threads clearreferencesstopthreads flag context get clear references stop threads getclearreferencesstopthreads clear references stop threads clearreferencesstopthreads clear references stop threads clearreferencesstopthreads feature context param clear references stop threads clearreferencesstopthreads flag set clear references stop threads setclearreferencesstopthreads clear references stop threads clearreferencesstopthreads clear references stop threads clearreferencesstopthreads clear references stop threads clearreferencesstopthreads clear references stop timer threads clearreferencesstoptimerthreads flag context get clear references stop timer threads getclearreferencesstoptimerthreads clear references stop timer threads clearreferencesstoptimerthreads clear references stop timer threads clearreferencesstoptimerthreads feature context param clear references stop timer threads clearreferencesstoptimerthreads flag set clear references stop timer threads setclearreferencesstoptimerthreads clear references stop timer threads clearreferencesstoptimerthreads clear references stop timer threads clearreferencesstoptimerthreads clear references stop timer threads clearreferencesstoptimerthreads clear references log factory release clearreferenceslogfactoryrelease flag context get clear references log factory release getclearreferenceslogfactoryrelease clear references log factory release clearreferenceslogfactoryrelease clear references log factory release clearreferenceslogfactoryrelease feature context param clear references log factory release clearreferenceslogfactoryrelease flag set clear references log factory release setclearreferenceslogfactoryrelease clear references log factory release clearreferenceslogfactoryrelease clear references log factory release clearreferenceslogfactoryrelease clear references log factory release clearreferenceslogfactoryrelease clear references http client keep alive thread clearreferenceshttpclientkeepalivethread flag context get clear references http client keep alive thread getclearreferenceshttpclientkeepalivethread clear references http client keep alive thread clearreferenceshttpclientkeepalivethread clear references http client keep alive thread clearreferenceshttpclientkeepalivethread feature context param clear references http client keep alive thread clearreferenceshttpclientkeepalivethread flag set clear references http client keep alive thread setclearreferenceshttpclientkeepalivethread clear references http client keep alive thread clearreferenceshttpclientkeepalivethread clear references http client keep alive thread clearreferenceshttpclientkeepalivethread clear references http client keep alive thread clearreferenceshttpclientkeepalivethread reloader methods adds file transformer loader transformer modify byte code bytecode classes loaded loader invocation method param transformer transformer add loader override add transformer addtransformer class file transformer classfiletransformer transformer transformer illegal argument exception illegalargumentexception get string getstring webapp class loader webappclassloader add transformer addtransformer illegal argument illegalargument get context name getcontextname transformers transformer instance transformer bail log warn get string getstring webapp class loader webappclassloader add transformer addtransformer duplicate transformer get context name getcontextname transformers add transformer log info get string getstring webapp class loader webappclassloader add transformer addtransformer transformer get context name getcontextname removes file transformer loader longer modify code classes loaded loader invocation method classes modified transformer remain transformed param transformer transformer remove override remove transformer removetransformer class file transformer classfiletransformer transformer transformer transformers remove transformer log info get string getstring webapp class loader webappclassloader remove transformer removetransformer transformer get context name getcontextname copy state without transformers copystatewithouttransformers webapp class loader base webappclassloaderbase base base antijarlocking antijarlocking base resources resources base files files base delegate delegate base last jar accessed lastjaraccessed last jar accessed lastjaraccessed base repositories repositories base jar path jarpath jar path jarpath base loader dir loaderdir loader dir loaderdir base canonical loader dir canonicalloaderdir canonical loader dir canonicalloaderdir base clear references static clearreferencesstatic clear references static clearreferencesstatic base clear references stop threads clearreferencesstopthreads clear references stop threads clearreferencesstopthreads base clear references stop timer threads clearreferencesstoptimerthreads clear references stop timer threads clearreferencesstoptimerthreads base clear references log factory release clearreferenceslogfactoryrelease clear references log factory release clearreferenceslogfactoryrelease base clear references http client keep alive thread clearreferenceshttpclientkeepalivethread clear references http client keep alive thread clearreferenceshttpclientkeepalivethread base repositoryurls repositoryurls clone base jar files jarfiles jar files jarfiles clone base jar real files jarrealfiles jar real files jarrealfiles clone base jar names jarnames jar names jarnames clone base last modified dates lastmodifieddates last modified dates lastmodifieddates clone base paths paths clone base not found resources notfoundresources put all putall not found resources notfoundresources base permission list permissionlist add all addall permission list permissionlist base loaderpc put all putall loaderpc base context name contextname context name contextname base has external repositories hasexternalrepositories has external repositories hasexternalrepositories base search external first searchexternalfirst search external first searchexternalfirst add repository places class loader classloader classes loaded param repository source classes loaded directory path name pathname jar file path name pathname zip file path name pathname exception illegal argument exception illegalargumentexception repository invalid exist add repository addrepository string repository add jar addjar add repository addrepository repository starts with startswith web inf lib repository starts with startswith web inf classes add repository underlying loader url url url repository addurl url has external repositories hasexternalrepositories repositoryurls malformedurlexception illegal argument exception illegalargumentexception iae illegal argument exception illegalargumentexception invalid repository repository iae init cause initcause iae add repository places class loader classloader classes loaded param repository source classes loaded directory path name pathname jar file path name pathname zip file path name pathname exception illegal argument exception illegalargumentexception repository invalid exist add repository addrepository string repository file file repository log is debug enabled isdebugenabled log debug add repository addrepository repository add repository internal list string result string repositories length repositories length result repositories result repositories length repository repositories result add file list file result file files length files length result files result files length file files result add jar addjar string jar jar file jarfile jar file jarfile file file i o exception ioexception jar jar file jarfile file log is debug enabled isdebugenabled log debug add jar addjar jar jar path jarpath jar starts with startswith jar path jarpath string jar name jarname jar substring jar path jarpath length jar name jarname starts with startswith jar name jarname jar name jarname substring string result string jar names jarnames length jar names jarnames length result jar names jarnames result jar names jarnames length jar name jarname jar names jarnames result register jar tracking last modified lastmodified resource attributes resourceattributes resources get attributes getattributes jar get last modified getlastmodified string result string paths length paths length result paths result paths length jar paths result result last modified dates lastmodifieddates length last modified dates lastmodifieddates length result last modified dates lastmodifieddates result last modified dates lastmodifieddates length last modified lastmodified last modified dates lastmodifieddates result naming exception namingexception class loading classloading validate jar file validatejarfile file jar file jarfile result jar file jarfile jar files jarfiles length jar files jarfiles length result jar files jarfiles result jar files jarfiles length jar file jarfile jar files jarfiles result add file list file result file jar real files jarrealfiles length jar real files jarrealfiles length result jar real files jarrealfiles result jar real files jarrealfiles length file jar real files jarrealfiles result string array current repositories loader repositories length array returned security reason returns clone array string immutable string find repositories findrepositories repositories clone classes resources modified reload modified log is debug enabled isdebugenabled log debug modified checking modified loaded resources length paths length rare race condition occur updates arrays to tally totally latest checked checked time length last modified dates lastmodifieddates length length length length length length last modified lastmodified resource attributes resourceattributes resources get attributes getattributes paths get last modified getlastmodified last modified lastmodified last modified dates lastmodifieddates log is debug enabled isdebugenabled log debug resource paths modified java util last modified lastmodified java util last modified dates lastmodifieddates naming exception namingexception log error resource paths missing length jar names jarnames length check ja rs jars removed get jar path getjarpath naming enumeration namingenumeration binding enumeration resources list bindings listbindings get jar path getjarpath enumeration has more elements hasmoreelements length name class pair nameclasspair nc pair ncpair enumeration next element nextelement string nc pair ncpair get name getname ignore ja rs jars lib folder ends with endswith jar equals jar names jarnames missing jar log info additional ja rs jars enumeration has more elements hasmoreelements enumeration has more elements hasmoreelements name class pair nameclasspair nc pair ncpair enumeration next element nextelement string nc pair ncpair get name getname additional jar files allowed ends with endswith jar ja rs jars log info additional ja rs jars jar names jarnames length ja rs jars log info additional ja rs jars naming exception namingexception log is debug enabled isdebugenabled log debug failed tracking modifications get jar path getjarpath class cast exception classcastexception log error failed tracking modifications get jar path getjarpath get message getmessage classes modified render string representation object override string to string tostring string builder stringbuilder string builder stringbuilder get class getclass get simple name getsimplename append context append context name contextname append delegate append delegate append repositories repositories repositories length append append repositories append parent append parent class loader classloader append parent to string tostring append transformers size append file transformers class file transformer classfiletransformer transformer transformers append transformer append to string tostring class loader classloader methods add url class loader classloader override addurl url url addurl url has external repositories hasexternalrepositories repositoryurls expose method unit tests do define class dodefineclass string len protection domain protectiondomain protection domain protectiondomain define class defineclass len protection domain protectiondomain find local repositories code class not found exception classnotfoundexception code param loaded exception class not found exception classnotfoundexception override find class findclass string class not found exception classnotfoundexception log is debug enabled isdebugenabled log debug find class findclass load local repositories loader stopped started class not found exception classnotfoundexception permission define security manager securitymanager security manager securitymanager last index of lastindexof log is trace enabled istraceenabled log trace security manager securitymanager check package definition checkpackagedefinition security manager securitymanager check package definition checkpackagedefinition substring exception log is trace enabled istraceenabled log trace exception class not found exception classnotfoundexception class not found exception classnotfoundexception superclass locate class not found exception classnotfoundexception clazz log is trace enabled istraceenabled log trace find class internal findclassinternal has external repositories hasexternalrepositories search external first searchexternalfirst clazz find class findclass class not found exception classnotfoundexception cnfe access control exception accesscontrolexception ace log warn webapp class loader base webappclassloaderbase find class internal findclassinternal security exception ace get message getmessage ace class not found exception classnotfoundexception ace runtime exception runtimeexception log is trace enabled istraceenabled log trace runtime exception runtimeexception rethrown clazz clazz find class internal findclassinternal class not found exception classnotfoundexception cnfe has external repositories hasexternalrepositories search external first searchexternalfirst cnfe access control exception accesscontrolexception ace log warn webapp class loader base webappclassloaderbase find class internal findclassinternal security exception ace get message getmessage ace class not found exception classnotfoundexception ace runtime exception runtimeexception log is trace enabled istraceenabled log trace runtime exception runtimeexception rethrown clazz has external repositories hasexternalrepositories search external first searchexternalfirst clazz find class findclass access control exception accesscontrolexception ace log warn webapp class loader base webappclassloaderbase find class internal findclassinternal security exception ace get message getmessage ace class not found exception classnotfoundexception ace runtime exception runtimeexception log is trace enabled istraceenabled log trace runtime exception runtimeexception rethrown clazz log is debug enabled isdebugenabled log debug returning class not found exception classnotfoundexception class not found exception classnotfoundexception class not found exception classnotfoundexception log is trace enabled istraceenabled log trace passing class not found exception classnotfoundexception located log is trace enabled istraceenabled log debug returning clazz log is trace enabled istraceenabled class loader classloader globals security enabled access controller accesscontroller do privileged doprivileged privileged get class loader privilegedgetclassloader clazz clazz get class loader getclassloader log debug loaded to string tostring clazz find resource local repository code url code ref erring referring code code resource param resource override url find resource findresource string log is debug enabled isdebugenabled log debug find resource findresource url url string path name to path nametopath has external repositories hasexternalrepositories search external first searchexternalfirst url find resource findresource url resource entry resourceentry entry resource entries resourceentries path entry security manager securitymanager privileged action privilegedaction resource entry resourceentry privileged find resource by name privilegedfindresourcebyname path entry access controller accesscontroller do privileged doprivileged entry find resource internal findresourceinternal path entry url entry source url has external repositories hasexternalrepositories search external first searchexternalfirst url find resource findresource log is debug enabled isdebugenabled url log debug returning url to string tostring log debug resource returning url enumeration code ur ls urls code representing resources resources empty enumeration param resources exception i o exception ioexception input output error occurs override enumeration url find resources findresources string i o exception ioexception log is debug enabled isdebugenabled log debug find resources findresources linked hash set linkedhashset vector avoid duplicates virtual mappings virtualmappings linked hash set linkedhashset url result linked hash set linkedhashset url jar files length jarfileslength jar files jarfiles length repositories length repositorieslength repositories length adding call superclass has external repositories hasexternalrepositories search external first searchexternalfirst enumeration url other resource paths otherresourcepaths find resources findresources other resource paths otherresourcepaths has more elements hasmoreelements result add other resource paths otherresourcepaths next element nextelement repositories repositories length repositorieslength string full path fullpath repositories resources lookup full path fullpath result add geturi file files malformedurlexception naming exception namingexception jar files jar files jarfiles openjars jar files length jarfileslength jar entry jarentry jar entry jarentry jar files jarfiles get jar entry getjarentry jar entry jarentry string jar fake url jarfakeurl geturi jar real files jarrealfiles to string tostring result add uri util uriutil build jar url buildjarurl jar fake url jarfakeurl malformedurlexception adding call superclass has external repositories hasexternalrepositories search external first searchexternalfirst enumeration url other resource paths otherresourcepaths find resources findresources other resource paths otherresourcepaths has more elements hasmoreelements result add other resource paths otherresourcepaths next element nextelement collections enumeration result find resource resource data images audio text accessed code independent location code resource separated path ide ntifies identifies resource resource code code method searches algorithm returning finds url resource returns code code code delegate code property code code call code get resource getresource code method parent loader call code find resource findresource code find resource locally defined repositories call code get resource getresource code method parent loader param resource url override url get resource getresource string log is debug enabled isdebugenabled log debug get resource getresource url url delegate parent requested delegate log is debug enabled isdebugenabled log debug delegating parent class loader classloader parent url parent get resource getresource url log is debug enabled isdebugenabled log debug returning url to string tostring url search local repositories url find resource findresource url jar antijarlocking string path name to path nametopath resource entry resourceentry entry resource entries resourceentries path string repository entry code base codebase to string tostring repository ends with endswith jar ends with endswith file suffix copy binary content work directory file resource file resourcefile file loader dir loaderdir url geturi resource file resourcefile exception log is debug enabled isdebugenabled log debug returning url to string tostring url delegate parent unconditionally att empted attempted delegate url parent get resource getresource url log is debug enabled isdebugenabled log debug returning url to string tostring url resource log is debug enabled isdebugenabled log debug resource returning find resource input stream reading search order code get resource getresource code checking resource data cached resource code code param resource input stream override input stream inputstream get resource as stream getresourceasstream string log is debug enabled isdebugenabled log debug get resource as stream getresourceasstream input stream inputstream stream check cached copy resource stream find loaded resource findloadedresource stream log is debug enabled isdebugenabled log debug returning stream cache stream delegate parent requested delegate log is debug enabled isdebugenabled log debug delegating parent class loader classloader parent stream parent get resource as stream getresourceasstream stream fixme cache log is debug enabled isdebugenabled log debug returning stream parent stream search local repositories log is debug enabled isdebugenabled log debug searching local repositories url url find resource findresource url fixme cache log is debug enabled isdebugenabled log debug returning stream local stream find loaded resource findloadedresource has external repositories hasexternalrepositories stream stream url open stream openstream i o exception ioexception stream stream delegate parent unconditionally delegate log is debug enabled isdebugenabled log debug delegating parent class loader classloader unconditionally parent stream parent get resource as stream getresourceasstream stream fixme cache log is debug enabled isdebugenabled log debug returning stream parent stream resource log is debug enabled isdebugenabled log debug resource returning load method searches classes manner code load class loadclass string code code code argument param loaded exception class not found exception classnotfoundexception override load class loadclass string class not found exception classnotfoundexception load class loadclass load searching algorithm finds returns returns code class not found exception classnotfoundexception code call code find loaded class findloadedclass string code check loaded code code object returned code delegate code property code code call code load class loadclass code method parent loader call code find class findclass code find locally defined repositories call code load class loadclass code method parent loader steps code resolve code flag code code method call code resolve class resolveclass code object param loaded param resolve code code resolve exception class not found exception classnotfoundexception suppress warnings suppresswarnings sync override override load class loadclass string resolve class not found exception classnotfoundexception get class loading lock internal getclassloadinglockinternal log is debug enabled isdebugenabled log debug load class loadclass resolve clazz log access stopped class loader classloader started illegal state exception illegalstateexception illegal state exception illegalstateexception log info get string getstring webapp class loader webappclassloader stopped check loaded local cache clazz find loaded class findloadedclass clazz log is debug enabled isdebugenabled log debug returning cache resolve resolve class resolveclass clazz clazz check loaded cache clazz find loaded class findloadedclass clazz log is debug enabled isdebugenabled log debug returning cache resolve resolve class resolveclass clazz clazz webapp overriding classes clazz se class loader seclassloader load class loadclass clazz resolve resolve class resolveclass clazz clazz class not found exception classnotfoundexception permission access security manager securitymanager security manager securitymanager last index of lastindexof security manager securitymanager check package access checkpackageaccess substring security exception securityexception string error security violation attempt restricted ends with endswith bean info beaninfo log debug error log info error class not found exception classnotfoundexception error delegate load delegateload delegate filter delegate parent requested delegate load delegateload log is debug enabled isdebugenabled log debug delegating parent class loader classloader parent clazz for name forname parent clazz log is debug enabled isdebugenabled log debug loading parent resolve resolve class resolveclass clazz clazz class not found exception classnotfoundexception search local repositories log is debug enabled isdebugenabled log debug searching local repositories clazz find class findclass clazz log is debug enabled isdebugenabled log debug loading local repository resolve resolve class resolveclass clazz clazz class not found exception classnotfoundexception delegate parent unconditionally delegate load delegateload log is debug enabled isdebugenabled log debug delegating parent class loader classloader parent clazz for name forname parent clazz log is debug enabled isdebugenabled log debug loading parent resolve resolve class resolveclass clazz clazz class not found exception classnotfoundexception class not found exception classnotfoundexception object get class loading lock internal getclassloadinglockinternal string class name classname jre compat jrecompat is jre isjre class loading classloading lock method class loading classloading lock method invoke class name classname exception per missions permissions code source codesource instance webapp class loader base webappclassloaderbase web application context add read file permission filepermission jndi per missions jndipermissions base directory unpacked context url jar file resources param code source codesource code loaded permission collection permissioncollection code source codesource override permission collection permissioncollection get per missions getpermissions code source codesource code source codesource string code url codeurl code source codesource get location getlocation to string tostring permission collection permissioncollection loaderpc code url codeurl get per missions getpermissions code source codesource iterator permission per ms perms permission list permissionlist iterator per ms perms has next hasnext permission per ms perms add loaderpc code url codeurl override check permission permission globals security enabled policy current policy currentpolicy policy get policy getpolicy current policy currentpolicy resource entry resourceentry entry find resource internal findresourceinternal entry code source codesource code source codesource entry code base codebase java security cert certificate permission collection permissioncollection current policy currentpolicy get per missions getpermissions impl ies implies permission returns search path ur ls urls loading classes resources includes original list ur ls urls constructor ur ls urls sub sequently subsequently appended addurl method search path ur ls urls loading classes resources override url geturls repositoryurls repositoryurls clone url external geturls files length fileslength files length jar files length jarfileslength jar real files jarrealfiles length ext ernals length externalslength external length url urls url files length fileslength jar files length jarfileslength ext ernals length externalslength search external first searchexternalfirst ext ernals length externalslength urls external ext ernals length externalslength files length fileslength urls geturi files files length fileslength jar files length jarfileslength urls geturi jar real files jarrealfiles jar files length jarfileslength search external first searchexternalfirst ext ernals length externalslength urls external repositoryurls urls malformedurlexception repositoryurls url repositoryurls clone lifecycle methods add lifecycle event listener component param listener listener add override add lifecycle listener addlifecyclelistener lifecycle listener lifecyclelistener listener noop lifecycle listeners lifecycle lifecycle listeners registered length array returned override lifecycle listener lifecyclelistener find lifecycle listeners findlifecyclelisteners lifecycle listener lifecyclelistener remove lifecycle event listener component param listener listener remove override remove lifecycle listener removelifecyclelistener lifecycle listener lifecyclelistener listener noop current source component current source component override lifecycle state lifecyclestate get state getstate lifecycle state lifecyclestate inherit doc inheritdoc override string get state name getstatename get state getstate to string tostring override init noop start loader exception lifecycle exception lifecycleexception lifecycle error occurs override start lifecycle exception lifecycleexception started string encoding encoding system get property getproperty file encoding security exception securityexception encoding index of indexof ebcdic need convert needconvert repositories length repositories equals web inf classes web inf classes code base webinfclassescodebase files touri tourl malformedurlexception is started isstarted started loader exception lifecycle exception lifecycleexception lifecycle error occurs override lifecycle exception lifecycleexception clearing references setting started side effects clear references clearreferences started length files length length files length jar files jarfiles length length jar files jarfiles jar files jarfiles close i o exception ioexception jar files jarfiles not found resources notfoundresources clear resource entries resourceentries clear resources repositories repositoryurls files jar files jarfiles jar real files jarrealfiles jar path jarpath jar names jarnames last modified dates lastmodifieddates paths has external repositories hasexternalrepositories parent web inf classes code base webinfclassescodebase permission list permissionlist clear loaderpc clear loader dir loaderdir delete dir deletedir loader dir loaderdir override destroy noop per iodically periodically signal class loader classloader release jar resources closejars force jar files jarfiles length jar files jarfiles force system current time millis currenttimemillis last jar accessed lastjaraccessed jar files jarfiles length jar files jarfiles jar files jarfiles close jar files jarfiles i o exception ioexception log is debug enabled isdebugenabled log debug failed close jar methods class loader classloader get java se class loader getjavaseclassloader se class loader seclassloader set java se class loader setjavaseclassloader class loader classloader class loader classloader class loader classloader illegal argument exception illegalargumentexception get string getstring webapp class loader webappclassloader java se class loader null javaseclassloadernull se class loader seclassloader class loader classloader clear references clear references clearreferences register remaining jdbc drivers clear references jdbc clearreferencesjdbc threads web application started clear references threads clearreferencesthreads check leaks triggered thread locals threadlocals loaded loader check thread locals for leaks checkthreadlocalsforleaks clear rmi targets loaded loader clear references rmi targets clearreferencesrmitargets clear references rmi targets clearreferencesrmitargets work around workaround app are nt apparent garbage collection bugs clear references static clearreferencesstatic clear references static final clearreferencesstaticfinal clear int rospection utils introspectionutils cache int rospection utils introspectionutils clear clear class loader classloader reference common logging clear references log factory release clearreferenceslogfactoryrelease org apache juli logging log factory logfactory release clear resource bundle cache should n shouldn cache weak references caused leaks oddly leak detection code standard host loader sun ibm jre s jres bug sun impl clear references resource bundles clearreferencesresourcebundles clear class loader classloader reference bean intro spec to r introspector java beans int rospector introspector flush caches flushcaches deregister jdbc drivers registered webapp webapp for got forgot unnecessary complex driver manager drivermanager checks loader calling easier checked context loader ref lection reflection create dependency driver manager drivermanager implementation changed create instance jdbc leak prevention jdbcleakprevention loaded common loader file catalina lib directory fail driver manager drivermanager check loader calling load bytes parent loader define loader jdbc leak prevention jdbcleakprevention webapp driver manager drivermanager apps cleaned clear references jdbc clearreferencesjdbc input stream inputstream get resource as stream getresourceasstream org apache catalina loader jdbc leak prevention jdbcleakprevention roughly big starting point class bytes classbytes offset read read class bytes classbytes offset class bytes classbytes length offset read offset read offset class bytes classbytes length buffer full size tmp class bytes classbytes length system arraycopy class bytes classbytes tmp class bytes classbytes length class bytes classbytes tmp read read class bytes classbytes offset class bytes classbytes length offset lp class lpclass define class defineclass org apache catalina loader jdbc leak prevention jdbcleakprevention class bytes classbytes offset get class getclass get protection domain getprotectiondomain object obj lp class lpclass new instance newinstance clear jdbc driver registrations clearjdbcdriverregistrations returns list string suppress warnings suppresswarnings unchecked list string driver names drivernames list string obj get class getclass get method getmethod clear jdbc driver registrations clearjdbcdriverregistrations invoke obj string driver names drivernames log error get string getstring webapp class loader webappclassloader clear jdbc clearjdbc context name contextname exception throwable exception utils exceptionutils unwrap invocation target exception unwrapinvocationtargetexception exception utils exceptionutils handle throwable handlethrowable log warn get string getstring webapp class loader webappclassloader jdbc remove failed jdbcremovefailed context name contextname close i o exception ioexception ioe log warn get string getstring webapp class loader webappclassloader jdbc remove stream error jdbcremovestreamerror context name contextname ioe clear references static final clearreferencesstaticfinal list resource entry resourceentry values array list arraylist resource entry resourceentry values add all addall resource entries resourceentries values iterator resource entry resourceentry loaded classes loadedclasses values iterator call cleared loaded classes loadedclasses has next hasnext resource entry resourceentry entry loaded classes loadedclasses entry loaded class loadedclass clazz entry loaded class loadedclass field fields clazz get declared fields getdeclaredfields fields length modifier is static isstatic fields get modifiers getmodifiers fields throwable loaded classes loadedclasses values iterator loaded classes loadedclasses has next hasnext resource entry resourceentry entry loaded classes loadedclasses entry loaded class loadedclass clazz entry loaded class loadedclass field fields clazz get declared fields getdeclaredfields fields length field field fields mods field get modifiers getmodifiers field get type gettype is primitive isprimitive field get name getname index of indexof modifier is static isstatic mods field set accessible setaccessible modifier is final isfinal mods field get type gettype get name getname starts with startswith java field get type gettype get name getname starts with startswith javax null instance nullinstance field field log is debug enabled isdebugenabled log debug field field get name getname clazz get name getname throwable exception utils exceptionutils handle throwable handlethrowable log is debug enabled isdebugenabled log debug field field get name getname clazz get name getname throwable exception utils exceptionutils handle throwable handlethrowable log is debug enabled isdebugenabled log debug clean fields clazz get name getname null instance nullinstance object instance instance field fields instance get class getclass get declared fields getdeclaredfields fields length field field fields mods field get modifiers getmodifiers field get type gettype is primitive isprimitive field get name getname index of indexof field set accessible setaccessible modifier is static isstatic mods modifier is final isfinal mods recursively risky object field instance object value class valueclass get class getclass loaded by this or child loadedbythisorchild value class valueclass log is debug enabled isdebugenabled log debug setting field field get name getname object instance get class getclass get name getname referenced object type value class valueclass get name getname loaded web application loader field instance log is debug enabled isdebugenabled log debug field field get name getname instance get class getclass get name getname throwable exception utils exceptionutils handle throwable handlethrowable log is debug enabled isdebugenabled log debug field field get name getname object instance instance get class getclass get name getname thread suppress warnings suppresswarnings deprecation clear references threads clearreferencesthreads thread threads get threads getthreads list thread executor threads to stop executorthreadstostop array list arraylist thread iterate threads thread thread threads thread class loader classloader ccl thread get context class loader getcontextclassloader ccl don warn thread thread thread current thread currentthread jvm control led controlled threads thread group threadgroup thread get thread group getthreadgroup jvm thread group names get name getname http client httpclient alive threads clear references http client keep alive thread clearreferenceshttpclientkeepalivethread thread get name getname equals alive timer thread set context class loader setcontextclassloader parent log debug get string getstring webapp class loader webappclassloader check threads http client checkthreadshttpclient don warn remaining jvm control led controlled threads skip threads died thread is alive isalive java util timer timer impl timerimpl apache harmony ibm jdk thread get class getclass get name getname starts with startswith java util timer clear references stop timer threads clearreferencesstoptimerthreads clear references stop timer thread clearreferencesstoptimerthread thread is request thread isrequestthread thread log error get string getstring webapp class loader webappclassloader warn request thread warnrequestthread context name contextname thread get name getname log error get string getstring webapp class loader webappclassloader warn thread warnthread context name contextname thread get name getname configured clear references stop threads clearreferencesstopthreads thread started executor shutting executor using executor usingexecutor runnable wrapped thread target sun oracle jdk runnable ibm jdk action apache harmony object target string field name fieldname string target runnable action field target field targetfield thread get class getclass get declared field getdeclaredfield field name fieldname target field targetfield set accessible setaccessible target target field targetfield thread no such field exception nosuchfieldexception nfe implementations target target get class getclass get canonical name getcanonicalname target get class getclass get canonical name getcanonicalname equals java util concurrent thread pool executor threadpoolexecutor worker field executor field executorfield target get class getclass get declared field getdeclaredfield executor field executorfield set accessible setaccessible object executor executor field executorfield target executor thread pool executor threadpoolexecutor thread pool executor threadpoolexecutor executor shutdown now shutdownnow using executor usingexecutor security exception securityexception log warn get string getstring webapp class loader webappclassloader stop thread fail stopthreadfail thread get name getname context name contextname no such field exception nosuchfieldexception log warn get string getstring webapp class loader webappclassloader stop thread fail stopthreadfail thread get name getname context name contextname illegal argument exception illegalargumentexception log warn get string getstring webapp class loader webappclassloader stop thread fail stopthreadfail thread get name getname context name contextname illegal access exception illegalaccessexception log warn get string getstring webapp class loader webappclassloader stop thread fail stopthreadfail thread get name getname context name contextname using executor usingexecutor executor time threads not e note threads stopped check method executor threads to stop executorthreadstostop add thread method deprecated good reason risky code option point good reason apps clean thread thread stop ping stopping enabled executor threads stopped executor shut depends thread correctly handling int errupt interrupt executor threads seconds shutdown running threads seconds shutdown count thread executor threads to stop executorthreadstostop is alive isalive count thread sleep interrupted exception interruptedexception count is alive isalive method deprecated good reason risky code option point good reason apps clean threads stack trace request thread isn per fect perfect good cases is request thread isrequestthread thread thread stack trace element stacktraceelement elements thread get stack trace getstacktrace elements elements length request processing thread elements length stack trace element stacktraceelement element elements elements length org apache catalina connector coyote adapter coyoteadapter equals element get class name getclassname clear references stop timer thread clearreferencesstoptimerthread thread thread field new tasks may be scheduled field newtasksmaybescheduledfield thread get class getclass get declared field getdeclaredfield new tasks may be scheduled newtasksmaybescheduled new tasks may be scheduled field newtasksmaybescheduledfield set accessible setaccessible field queue field queuefield thread get class getclass get declared field getdeclaredfield queue queue field queuefield set accessible setaccessible object queue queue field queuefield thread method clear method clearmethod queue get class getclass get declared method getdeclaredmethod clear clear method clearmethod set accessible setaccessible queue new tasks may be scheduled field newtasksmaybescheduledfield set boolean setboolean thread clear method clearmethod invoke queue queue empty queue notify no such field exception nosuchfieldexception nfe method cancel method cancelmethod thread get class getclass get declared method getdeclaredmethod cancel thread cancel method cancelmethod set accessible setaccessible cancel method cancelmethod invoke thread log error get string getstring webapp class loader webappclassloader warn timer thread warntimerthread context name contextname thread get name getname exception throwable exception utils exceptionutils unwrap invocation target exception unwrapinvocationtargetexception exception utils exceptionutils handle throwable handlethrowable log warn get string getstring webapp class loader webappclassloader stop timer thread fail stoptimerthreadfail thread get name getname context name contextname check thread locals for leaks checkthreadlocalsforleaks thread threads get threads getthreads fields thread store thread locals threadlocals accessible field thread locals field threadlocalsfield thread get declared field getdeclaredfield thread locals threadlocals thread locals field threadlocalsfield set accessible setaccessible field inherit able thread locals field inheritablethreadlocalsfield thread get declared field getdeclaredfield inherit able thread locals inheritablethreadlocals inherit able thread locals field inheritablethreadlocalsfield set accessible setaccessible underlying array thread load threadload thread local map threadlocalmap entry objects accessible tlm class tlmclass for name forname java lang thread local threadlocal thread local map threadlocalmap field table field tablefield tlm class tlmclass get declared field getdeclaredfield table table field tablefield set accessible setaccessible method exp unge stale entries method expungestaleentriesmethod tlm class tlmclass get declared method getdeclaredmethod exp unge stale entries expungestaleentries exp unge stale entries method expungestaleentriesmethod set accessible setaccessible threads length object thread local map threadlocalmap threads clear map thread local map threadlocalmap thread locals field threadlocalsfield threads thread local map threadlocalmap exp unge stale entries method expungestaleentriesmethod invoke thread local map threadlocalmap check thread local map for leaks checkthreadlocalmapforleaks thread local map threadlocalmap table field tablefield clear map thread local map threadlocalmap inherit able thread locals field inheritablethreadlocalsfield threads thread local map threadlocalmap exp unge stale entries method expungestaleentriesmethod invoke thread local map threadlocalmap check thread local map for leaks checkthreadlocalmapforleaks thread local map threadlocalmap table field tablefield throwable exception utils exceptionutils handle throwable handlethrowable log warn get string getstring webapp class loader webappclassloader check thread locals for leaks fail checkthreadlocalsforleaksfail get context name getcontextname analyzes thread local map object pass field points internal table save calculating call method check thread local map for leaks checkthreadlocalmapforleaks object map field internal table field internaltablefield illegal access exception illegalaccessexception no such field exception nosuchfieldexception map object table object internal table field internaltablefield map table table length object obj table obj key loaded by webapp keyloadedbywebapp value loaded by webapp valueloadedbywebapp check key object key reference obj equals key loaded by this or child loadedbythisorchild key key loaded by webapp keyloadedbywebapp check field value field valuefield obj get class getclass get declared field getdeclaredfield value field valuefield set accessible setaccessible object value field valuefield obj equals loaded by this or child loadedbythisorchild value loaded by webapp valueloadedbywebapp key loaded by webapp keyloadedbywebapp value loaded by webapp valueloadedbywebapp object args object args context name contextname key args get pretty class name getprettyclassname key get class getclass args key to string tostring exception log error get string getstring webapp class loader webappclassloader check thread locals for leaks checkthreadlocalsforleaks bad key badkey args args get string getstring webapp class loader webappclassloader check thread locals for leaks checkthreadlocalsforleaks unknown args get pretty class name getprettyclassname get class getclass args to string tostring exception log error get string getstring webapp class loader webappclassloader check thread locals for leaks checkthreadlocalsforleaks bad value badvalue args args get string getstring webapp class loader webappclassloader check thread locals for leaks checkthreadlocalsforleaks unknown value loaded by webapp valueloadedbywebapp log error get string getstring webapp class loader webappclassloader check thread locals for leaks checkthreadlocalsforleaks args log is debug enabled isdebugenabled log debug get string getstring webapp class loader webappclassloader check thread locals for leaks null checkthreadlocalsforleaksnull args log is debug enabled isdebugenabled log debug get string getstring webapp class loader webappclassloader check thread locals for leaks non e checkthreadlocalsforleaksnone args string get pretty class name getprettyclassname clazz string clazz get canonical name getcanonicalname clazz get name getname param object test code code loaded current class loader classloader desc end ants descendants loaded by this or child loadedbythisorchild object clazz clazz clazz get class getclass class loader classloader clazz get class loader getclassloader get parent getparent collection iterator iter collection iterator iter has next hasnext object entry iter loaded by this or child loadedbythisorchild entry concurrent modification exception concurrentmodificationexception log warn get string getstring webapp class loader webappclassloader clazz get name getname get context name getcontextname current threads array thread get threads getthreads current thread group thread group threadgroup thread current thread currentthread get thread group getthreadgroup find root thread group get parent getparent get parent getparent security exception securityexception string msg get string getstring webapp class loader webappclassloader get thread group error getthreadgrouperror get name getname log is debug enabled isdebugenabled log debug msg log warn msg thread count guess threadcountguess active count activecount thread threads thread thread count guess threadcountguess thread count actual threadcountactual enum erate enumerate threads don threads thread count actual threadcountactual thread count guess threadcountguess thread count guess threadcountguess threads thread thread count guess threadcountguess note enum erate enumerate thread silently ignores threads fit array thread count actual threadcountactual enum erate enumerate threads threads depends int ernals internals sun jvm ref lection reflection clear references rmi targets clearreferencesrmitargets access ccl field sun rmi transport target find leaks object target class objecttargetclass for name forname sun rmi transport target field ccl field cclfield object target class objecttargetclass get declared field getdeclaredfield ccl ccl field cclfield set accessible setaccessible access stub field report leaks field stub field stubfield object target class objecttargetclass get declared field getdeclaredfield stub stub field stubfield set accessible setaccessible clear obj table objtable map object table class objecttableclass for name forname sun rmi transport object table objecttable field obj table field objtablefield object table class objecttableclass get declared field getdeclaredfield obj table objtable obj table field objtablefield set accessible setaccessible object obj table objtable obj table field objtablefield obj table objtable iterate values table obj table objtable map iterator iter map obj table objtable values iterator iter has next hasnext object obj iter object ccl object cclobject ccl field cclfield obj ccl object cclobject iter remove object stub object stubobject stub field stubfield obj log error get string getstring webapp class loader webappclassloader clear rmi clearrmi stub object stubobject get class getclass get name getname stub object stubobject clear impl table impltable map field impl table field impltablefield object table class objecttableclass get declared field getdeclaredfield impl table impltable impl table field impltablefield set accessible setaccessible object impl table impltable impl table field impltablefield impl table impltable iterate values table impl table impltable map iterator iter map impl table impltable values iterator iter has next hasnext object obj iter object ccl object cclobject ccl field cclfield obj ccl object cclobject iter remove class not found exception classnotfoundexception log info get string getstring webapp class loader webappclassloader clear rmi info clearrmiinfo context name contextname security exception securityexception log warn get string getstring webapp class loader webappclassloader clear rmi fail clearrmifail context name contextname no such field exception nosuchfieldexception log warn get string getstring webapp class loader webappclassloader clear rmi fail clearrmifail context name contextname illegal argument exception illegalargumentexception log warn get string getstring webapp class loader webappclassloader clear rmi fail clearrmifail context name contextname illegal access exception illegalaccessexception log warn get string getstring webapp class loader webappclassloader clear rmi fail clearrmifail context name contextname exception jre compat jrecompat jre compat jrecompat jre compat jrecompat get instance getinstance jre compat jrecompat is instance of i naccessible object exception isinstanceofinaccessibleobjectexception log warn get string getstring webapp class loader webappclassloader add exports addexports runtime exception runtimeexception clear link resource bundle resourcebundle cache bundles loaded loader loader loader parent loader link resource bundle resourcebundle clear cache clearcache comp lications complications link org apache jasper servlet jasper loader jasperloader ref lection reflection based app roach approach complete resource bundle resourcebundle weak references weakreferences should n shouldn pinning loader memory clear references clear references resource bundles clearreferencesresourcebundles reference cache field cache list field cachelistfield resource bundle resourcebundle get declared field getdeclaredfield cache list cachelist cache list field cachelistfield set accessible setaccessible java concurrent map concurrentmap java soft cache softcache map map work map cache list cachelist map cache list field cachelistfield loader references key cache list cachelist key set keyset field loader ref field loaderreffield iterate loader instances iterator keys iter keysiter iterator count removed countremoved keys iter keysiter has next hasnext object key keys iter keysiter loader ref field loaderreffield loader ref field loaderreffield key get class getclass get declared field getdeclaredfield loader ref loaderref loader ref field loaderreffield set accessible setaccessible weak reference weakreference loader ref loaderref weak reference weakreference loader ref field loaderreffield key class loader classloader loader class loader classloader loader ref loaderref loader loader loader loader get parent getparent loader keys iter keysiter remove count removed countremoved count removed countremoved log is debug enabled isdebugenabled log debug get string getstring webapp class loader webappclassloader clear references resource bundles count clearreferencesresourcebundlescount integer value of valueof count removed countremoved context name contextname security exception securityexception log error get string getstring webapp class loader webappclassloader clear references resource bundles fail clearreferencesresourcebundlesfail context name contextname no such field exception nosuchfieldexception jre vendor jrevendor oracle jvm log error get string getstring webapp class loader webappclassloader clear references resource bundles fail clearreferencesresourcebundlesfail get context name getcontextname log debug get string getstring webapp class loader webappclassloader clear references resource bundles fail clearreferencesresourcebundlesfail get context name getcontextname illegal argument exception illegalargumentexception log error get string getstring webapp class loader webappclassloader clear references resource bundles fail clearreferencesresourcebundlesfail context name contextname illegal access exception illegalaccessexception log error get string getstring webapp class loader webappclassloader clear references resource bundles fail clearreferencesresourcebundlesfail context name contextname per iodically periodically signal class loader classloader release jar resources openjars started jar files jarfiles length last jar accessed lastjaraccessed system current time millis currenttimemillis jar files jarfiles jar files jarfiles length jar files jarfiles jar file jarfile jar real files jarrealfiles i o exception ioexception log warn get string getstring webapp class loader webappclassloader jar open fail jaropenfail jar files jarfiles closejars find local repositories loaded isn find class internal findclassinternal string class not found exception classnotfoundexception validate class not found exception classnotfoundexception resource entry resourceentry entry string path binary name to path binarynametopath security manager securitymanager privileged action privilegedaction resource entry resourceentry privileged find resource by name privilegedfindresourcebyname path entry access controller accesscontroller do privileged doprivileged entry find resource internal findresourceinternal path entry class not found exception classnotfoundexception clazz entry loaded class loadedclass clazz clazz get class loading lock internal getclassloadinglockinternal clazz entry loaded class loadedclass clazz clazz entry binary content binarycontent class not found exception classnotfoundexception string package name packagename pos last index of lastindexof pos package name packagename substring pos pkg package name packagename pkg get package getpackage package name packagename define pkg entry manifest define package definepackage package name packagename define package definepackage package name packagename entry manifest entry code base codebase illegal argument exception illegalargumentexception pkg get package getpackage package name packagename security manager securitymanager checking sealing pkg seal check sealcheck pkg is sealed issealed seal check sealcheck pkg is sealed issealed entry code base codebase seal check sealcheck entry manifest is package sealed ispackagesealed package name packagename entry manifest seal check sealcheck security exception securityexception sealing violation loading package name packagename sealed clazz define class defineclass entry binary content binarycontent entry binary content binarycontent length code source codesource entry code base codebase entry certificates unsupported class version error unsupportedclassversionerror ucve unsupported class version error unsupportedclassversionerror ucve get local ized message getlocalizedmessage get string getstring webapp class loader webappclassloader wrong version wrongversion defined clear elements local resource cache longer required entry loaded class loadedclass clazz entry binary content binarycontent entry code base codebase entry manifest entry certificates retain entry source get resource as stream getresourceasstream call file defined clazz find resource local repositories loaded resource resource isn resource entry resourceentry find resource internal findresourceinternal file file string path resource entry resourceentry entry resource entry resourceentry entry source geturi file file path string source string sourcestring entry source to string tostring source string sourcestring starts with startswith web inf classes code base webinfclassescodebase to string tostring source string sourcestring ends with endswith file suffix entry code base codebase web inf classes code base webinfclassescodebase entry code base codebase entry source malformedurlexception entry find resource local repositories loaded resource resource isn resource entry resourceentry find resource internal findresourceinternal string string path manifest required manifestrequired started log info get string getstring webapp class loader webappclassloader stopped path jar entry jarentry jar entry jarentry skip leading find res oucres resoucres ja rs jars string jar entry path jarentrypath path substring resource entry resourceentry entry resource entries resourceentries path entry manifest required manifestrequired entry manifest manifest unknown manifest required cache entry updated jar files jarfiles openjars jar files jarfiles length jar entry jarentry jar files jarfiles get jar entry getjarentry jar entry path jarentrypath jar entry jarentry entry manifest jar files jarfiles get manifest getmanifest i o exception ioexception ioe entry content length contentlength input stream inputstream binary stream binarystream is class resource isclassresource path ends with endswith file suffix is cache able iscacheable is class resource isclassresource is cache able iscacheable is cache able iscacheable path starts with startswith services prefix jar files length jarfileslength jar files jarfiles length repositories length repositorieslength repositories length resource resource file need convert fileneedconvert entry repositories length repositorieslength string full path fullpath repositories path object lookup result lookupresult resources lookup full path fullpath lookup result lookupresult resource resource resource lookup result lookupresult note exception resource resource attributes resourceattributes attributes resource attributes resourceattributes resources get attributes getattributes full path fullpath content length contentlength attributes get content length getcontentlength string canonical path canonicalpath attributes get canonical path getcanonicalpath canonical path canonicalpath create resource entry resourceentry based returned dir context dircontext path repository smart dir context dircontext implementations virtualize doc base docbase eclipse wtp entry find resource internal findresourceinternal file canonical path canonicalpath resource file system filesystem package d packaged war entry find resource internal findresourceinternal files path entry last modified lastmodified attributes get last modified getlastmodified resource binary stream binarystream resource stream content streamcontent i o exception ioexception need convert needconvert path ends with endswith properties file need convert fileneedconvert note syncing constant object needed all permission allpermission result last modified dates lastmodifieddates length last modified dates lastmodifieddates length result last modified dates lastmodifieddates result last modified dates lastmodifieddates length entry last modified lastmodified last modified dates lastmodifieddates result string result string paths length paths length result paths result paths length full path fullpath paths result naming exception namingexception entry not found resources notfoundresources contains key containskey jar files jarfiles openjars entry jar files length jarfileslength jar entry jarentry jar files jarfiles get jar entry getjarentry jar entry path jarentrypath jar entry jarentry entry resource entry resourceentry entry code base codebase geturi jar real files jarrealfiles entry source uri util uriutil build jar url buildjarurl entry code base codebase to string tostring jar entry path jarentrypath entry last modified lastmodified jar real files jarrealfiles last modified lastmodified malformedurlexception content length contentlength jar entry jarentry get size getsize manifest required manifestrequired entry manifest jar files jarfiles get manifest getmanifest entry manifest manifest unknown binary stream binarystream jar files jarfiles get input stream getinputstream jar entry jarentry i o exception ioexception extract resources contained jar work dir workdir antijarlocking path ends with endswith file suffix buf file resource file resourcefile file loader dir loaderdir jar entry jarentry get name getname resource file resourcefile exists enumeration jar entry jarentry entries jar files jarfiles entries entries has more elements hasmoreelements jar entry jarentry jar entry jarentry entries next element nextelement jar entry jarentry is directory isdirectory jar entry jarentry get name getname ends with endswith file suffix resource file resourcefile file loader dir loaderdir jar entry jarentry get name getname resource file resourcefile get canonical path getcanonicalpath starts with startswith canonical loader dir canonicalloaderdir illegal argument exception illegalargumentexception get string getstring webapp class loader webappclassloader illegal jar path illegaljarpath jar entry jarentry get name getname i o exception ioexception ioe illegal argument exception illegalargumentexception get string getstring webapp class loader webappclassloader validation error jar path validationerrorjarpath jar entry jarentry get name getname ioe file parent file parentfile resource file resourcefile get parent file getparentfile parent file parentfile mkdirs parent file parentfile exists ignore error i o exceptions ioexceptions file output stream fileoutputstream input stream inputstream jar files jarfiles get input stream getinputstream jar entry jarentry file output stream fileoutputstream resource file resourcefile read buf write buf resource file resourcefile set last modified setlastmodified jar entry jarentry get time gettime i o exception ioexception close i o exception ioexception close i o exception ioexception entry not found resources notfoundresources not found resources notfoundresources cache binary content content file binary content cached loaded file conversion add ress address encoding issues resource service provider configuration file located meta inf services cases cache content prevent exc essive excessive memory usage large resources https apache org bug zilla bugzilla bug cgi binary stream binarystream is cache able iscacheable file need convert fileneedconvert binary content binarycontent content length contentlength pos binary stream binarystream read binary content binarycontent pos binary content binarycontent length pos pos i o exception ioexception log error get string getstring webapp class loader webappclassloader read error readerror file need convert fileneedconvert work around workaround files platforms ebcdic encoding read file input stream fileinputstream commit message rev details http svn apache org view vc viewvc view revision revision string str string binary content binarycontent pos binary content binarycontent str get bytes getbytes charset utf exception entry binary content binarycontent binary content binarycontent input stream fully read jar entry jarentry entry certificates jar entry jarentry get certificates getcertificates binary stream binarystream binary stream binarystream close i o exception ioexception is class resource isclassresource entry binary content binarycontent transformers size resource loaded decorate attached transformers string class name classname ends with endswith file suffix substring length file suffix length string internal name internalname class name classname replace class file transformer classfiletransformer transformer transformers transformed transformer transform internal name internalname entry binary content binarycontent transformed entry binary content binarycontent transformed illegal class format exception illegalclassformatexception log error get string getstring webapp class loader webappclassloader transform error transformerror add entry local resource repository resource entries resourceentries ensures threads race load resource entry resourceentry instance resource entry resourceentry entry resource entries resourceentries path entry resource entries resourceentries path entry entry entry entry string binary name to path binarynametopath string binary name binaryname with leading slash withleadingslash leading string builder stringbuilder path string builder stringbuilder binary name binaryname length with leading slash withleadingslash path append path append binary name binaryname replace path append file suffix path to string tostring string name to path nametopath string starts with startswith string builder stringbuilder path string builder stringbuilder length path append path append path to string tostring returns sealed manifest is package sealed ispackagesealed string manifest man string path replace attributes attr man get attributes getattributes path string sealed attr sealed attr get value getvalue sealed sealed attr man get main attributes getmainattributes sealed attr get value getvalue sealed equals ignore case equalsignorecase sealed finds resource loaded cached loader input stream resource data resource cached code code param resource input stream inputstream find loaded resource findloadedresource string string path name to path nametopath resource entry resourceentry entry resource entries resourceentries path entry entry binary content binarycontent byte array input stream bytearrayinputstream entry binary content binarycontent entry source open stream openstream i o exception ioexception ioe finds loaded cached loader object cached code code param resource find loaded class findloadedclass string string path binary name to path binarynametopath resource entry resourceentry entry resource entries resourceentries path entry entry loaded class loadedclass fixme find loaded resource findloadedresource refresh system policy file pick event ual eventual refresh policy refreshpolicy policy file modified adjust permissions reloading loading reloading context policy policy policy get policy getpolicy policy refresh access control exception accesscontrolexception filter classes param filtered filter string string package name packagename pos last index of lastindexof pos package name packagename substring pos package triggers packagetriggers length package name packagename starts with startswith package triggers packagetriggers validate class name classname srv res trict restrict loading classes java classes servlet api javax servlet enhance robustness prevent number user error older version servlet jar web inf lib param valid validate string careful order load starts with startswith java load java classes starts with startswith javax servlet jsp jstl web apps jstl starts with startswith javax servlet web apps servlet jsp classes starts with startswith javax load javax classes assume check jar file code code trigger classes param file jar file checked exception i o exception ioexception input output error occurs validate jar file validatejarfile file file i o exception ioexception triggers jar file jarfile jar file jarfile jar file jarfile jar file jarfile file triggers length clazz parent clazz parent load class loadclass triggers clazz for name forname triggers exception clazz clazz string triggers replace file suffix log is debug enabled isdebugenabled log debug checking jar entry jarentry jar entry jarentry jar file jarfile get jar entry getjarentry jar entry jarentry log info validate jar file validatejarfile file jar loaded servlet spec off ending offending jar file jarfile jar file jarfile close i o exception ioexception ioe url deprecated link geturi file deprecated url geturl file file encoded malformedurlexception file real file realfile file real file realfile real file realfile get canonical file getcanonicalfile i o exception ioexception encoded geturi real file realfile real file realfile touri tourl uri file url geturi file file malformedurlexception file real file realfile file real file realfile real file realfile get canonical file getcanonicalfile i o exception ioexception real file realfile touri tourl delete directory including contents sub directories subdirectories recursively param dir file object representing directory deleted delete dir deletedir file dir string files dir list files files string files length file file file dir files file is directory isdirectory delete dir deletedir file file delete dir delete