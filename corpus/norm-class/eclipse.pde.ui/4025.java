copyright ibm corporation rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors ibm corporation initial api implementation org eclipse pde internal core text plugin java util array list arraylist java util hash map hashmap org eclipse jface text org eclipse osgi util nls org eclipse pde core i model changed event imodelchangedevent org eclipse pde internal core pde core messages pdecoremessages org eclipse pde internal core text org eclipse pde internal core util pde xml helper pdexmlhelper org eclipse text edits xml text change listener xmltextchangelistener abstract text change listener abstracttextchangelistener array list arraylist text edit textedit f operation list foperationlist array list arraylist text edit textedit hash map hashmap text edit textedit string f readable names freadablenames xml text change listener xmltextchangelistener i document idocument document document xml text change listener xmltextchangelistener i document idocument document generate readable names generatereadablenames document test map determine names generated generate readable names generatereadablenames f readable names freadablenames hash map hashmap text edit textedit string override text edit textedit get text operations gettextoperations f operation list foperationlist size text edit textedit f operation list foperationlist to array toarray text edit textedit f operation list foperationlist size insert text edit textedit parent text edit textedit edit parent has children haschildren parent add child addchild edit edit move source edit movesourceedit parent add child addchild move source edit movesourceedit edit get target edit gettargetedit text edit textedit children parent get children getchildren div e dive find parent children length text edit textedit child children covers child edit insert child edit moved edit covering children length text edit textedit child children covers edit child parent remove child removechild edit add child addchild child parent add child addchild edit edit move source edit movesourceedit parent add child addchild move source edit movesourceedit edit get target edit gettargetedit covers text edit textedit this edit thisedit text edit textedit other edit otheredit insertion point cover this edit thisedit get length getlength this offset thisoffset this edit thisedit get offset getoffset this end thisend this edit thisedit get exclusive end getexclusiveend other edit otheredit get length getlength other offset otheroffset other edit otheredit get offset getoffset this offset thisoffset other offset otheroffset other offset otheroffset this end thisend other offset otheroffset other edit otheredit get offset getoffset other end otherend other edit otheredit get exclusive end getexclusiveend this offset thisoffset other offset otheroffset other end otherend this end thisend delete node deletenode i document element node idocumentelementnode node delete previous node text edit textedit f operation table foperationtable node object f operation table foperationtable remove node f operation list foperationlist remove f readable names freadablenames f readable names freadablenames remove node offset delete node get offset getoffset create delete node text edit textedit get delete node operation getdeletenodeoperation node f operation table foperationtable node f operation list foperationlist add f readable names freadablenames f readable names freadablenames nls bind pde core messages pdecoremessages xml text change listener xmltextchangelistener edit names editnames remove node removenode node getxmltagname previous offset node rewrite highest ancestor offset insert node insertnode node insert node insertnode i document element node idocumentelementnode node text edit textedit node get highest node to be written gethighestnodetobewritten node node get parent node getparentnode bugs node is root isroot insert edit insertedit node write node get offset getoffset element form element broken element element replace edit replaceedit node get offset getoffset node get length getlength node write insert sibling offset insert after sibling insertaftersibling node insert child parent insert as first child insertasfirstchild node f operation table foperationtable node f operation list foperationlist add f readable names freadablenames f readable names freadablenames nls bind pde core messages pdecoremessages xml text change listener xmltextchangelistener edit names editnames insert node insertnode node getxmltagname insert edit insertedit insert after sibling insertaftersibling i document element node idocumentelementnode node i document element node idocumentelementnode sibling node get previous sibling getprevioussibling sibling sibling get offset getoffset node set line indent setlineindent sibling get line indent getlineindent insert edit insertedit sibling get offset getoffset sibling get length getlength f sep fsep node write sibling sibling get previous sibling getprevioussibling insert edit insertedit insert as first child insertasfirstchild i document element node idocumentelementnode node offset node get parent node getparentnode get offset getoffset length get next position getnextposition f document fdocument offset node set line indent setlineindent node get parent node getparentnode get line indent getlineindent insert edit insertedit offset length f sep fsep node write modify node modifynode i document element node idocumentelementnode node i model changed event imodelchangedevent event i document element node idocumentelementnode old node oldnode i document element node idocumentelementnode event get old value getoldvalue i document element node idocumentelementnode new node newnode i document element node idocumentelementnode event get new value getnewvalue i document element node idocumentelementnode node old node oldnode get previous sibling getprevioussibling old node oldnode equals new node newnode get previous sibling getprevioussibling old node oldnode new node newnode i document element node idocumentelementnode node node equals old node oldnode new node newnode old node oldnode node get offset getoffset node get offset getoffset text edit textedit f operation table foperationtable node node rule node rule rewrite parent ancestor insert node insertnode node node get offset getoffset node get offset getoffset nodes offsets create move target source combo operation i region iregion region get move region getmoveregion node move source edit movesourceedit source move source edit movesourceedit region get offset getoffset region get length getlength region get move region getmoveregion node source set target edit settargetedit move target edit movetargetedit region get offset getoffset f operation table foperationtable node source f operation list foperationlist add source f readable names freadablenames f readable names freadablenames source nls bind pde core messages pdecoremessages xml text change listener xmltextchangelistener edit names editnames modify node modifynode node getxmltagname node offset offset delete reinsert offset insert node insertnode node get offset getoffset node node i region iregion get move region getmoveregion i document element node idocumentelementnode node offset node get offset getoffset length node get length getlength f document fdocument offset to char array tochararray character is whitespace iswhitespace bad location exception badlocationexception region offset length add attribute operation addattributeoperation i document attribute node idocumentattributenode attr i model changed event imodelchangedevent event offset attr get value offset getvalueoffset object new value newvalue event get new value getnewvalue object changed object changedobject attr string text edit textedit offset new value newvalue new value newvalue to string tostring length length attr get value offset getvalueoffset attr get value length getvaluelength attr get name offset getnameoffset get attribute delete edit operation getattributedeleteeditoperation attr get name offset getnameoffset length f readable names freadablenames nls bind pde core messages pdecoremessages xml text change listener xmltextchangelistener edit names editnames remove attribute removeattribute string attr get attribute name getattributename attr get enclosing element getenclosingelement getxmltagname replace edit replaceedit offset attr get value length getvaluelength get writable string getwritablestring event get new value getnewvalue to string tostring f readable names freadablenames nls bind pde core messages pdecoremessages xml text change listener xmltextchangelistener edit names editnames modify attribute modifyattribute string attr get attribute name getattributename attr get enclosing element getenclosingelement getxmltagname i document element node idocumentelementnode node attr get enclosing element getenclosingelement node get offset getoffset changed object changedobject node len get next position getnextposition f document fdocument node get offset getoffset replace edit replaceedit node get offset getoffset len node write shallow writeshallow should terminate element shouldterminateelement f document fdocument node get offset getoffset len f readable names freadablenames nls bind pde core messages pdecoremessages xml text change listener xmltextchangelistener edit names editnames add attribute addattribute string attr get attribute name getattributename attr get enclosing element getenclosingelement getxmltagname insert node insertnode node f operation table foperationtable changed object changedobject f operation list foperationlist add f readable names freadablenames f readable names freadablenames add element content operation addelementcontentoperation i document text node idocumenttextnode text node textnode text edit textedit object changed object changedobject text node textnode text node textnode get offset getoffset string new text newtext get writable string getwritablestring text node textnode get text gettext replace edit replaceedit text node textnode get offset getoffset text node textnode get length getlength new text newtext i document element node idocumentelementnode parent text node textnode get enclosing element getenclosingelement parent get offset getoffset string end chars endchars f document fdocument parent get offset getoffset parent get length getlength nls equals nls end chars endchars parent element form element rewrite insert node insertnode parent bad location exception badlocationexception add text child changed object changedobject parent string buffer stringbuffer buffer string buffer stringbuffer f sep fsep parent get line indent getlineindent nls buffer append nls nls buffer append nls get writable string getwritablestring text node textnode get text gettext offset parent get offset getoffset length get next position getnextposition f document fdocument offset insert edit insertedit offset length buffer to string tostring insert node insertnode parent f operation table foperationtable changed object changedobject f operation list foperationlist add f readable names freadablenames f readable names freadablenames nls bind pde core messages pdecoremessages xml text change listener xmltextchangelistener edit names editnames add content addcontent text node textnode get enclosing element getenclosingelement getxmltagname should terminate element shouldterminateelement i document idocument doc offset doc offset to char array tochararray bad location exception badlocationexception get next position getnextposition i document idocument doc offset offset doc get length getlength doc offset to char array tochararray bad location exception badlocationexception delete edit deleteedit get attribute delete edit operation getattributedeleteeditoperation offset length f document fdocument offset length to char array tochararray character is whitespace iswhitespace length bad location exception badlocationexception delete edit deleteedit offset length delete edit deleteedit get delete node operation getdeletenodeoperation i document element node idocumentelementnode node offset node get offset getoffset length node get length getlength node starts start line startline f document fdocument get line of offset getlineofoffset offset start line startline offset start line offset startlineoffset f document fdocument get line offset getlineoffset start line startline hunt whitespace start start offset startoffset start offset startoffset loop find whitespace start offset startoffset offset start offset startoffset start line offset startlineoffset start offset startoffset character is whitespace iswhitespace f document fdocument get char getchar start offset startoffset move loop stopped reaching start offset startoffset node ends end line endline f document fdocument get line of offset getlineofoffset offset length length delimiter end line delim length endlinedelimlength f document fdocument get line delimiter getlinedelimiter end line endline length hunt whitespace extra length extralength extra length extralength length extra length extralength character is whitespace iswhitespace f document fdocument get char getchar offset extra length extralength white space move extra length extralength f document fdocument get line of offset getlineofoffset offset extra length extralength end line endline don touch line delim eters linedelimeters extra length extralength end line delim length endlinedelimlength reached start remove new line newline start offset startoffset start line offset startlineoffset start offset startoffset f document fdocument get line delimiter getlinedelimiter start line startline length add difference offset length extra length extralength offset start offset startoffset offset start offset startoffset print deletion range printdeletionrange offset length bad location exception badlocationexception delete edit deleteedit offset length print deletion range printdeletionrange offset length new lines newlines printed carriage returns printed tabs printed spaces printed string string f document fdocument offset length string buffer stringbuffer buffer string buffer stringbuffer string length string char at charat nls buffer append nls nls buffer append nls nls buffer append nls buffer append buffer append system println buffer to string tostring bad location exception badlocationexception i document element node idocumentelementnode get highest node to be written gethighestnodetobewritten i document element node idocumentelementnode node i document element node idocumentelementnode parent node get parent node getparentnode parent node parent get offset getoffset string end chars endchars f document fdocument parent get offset getoffset parent get length getlength nls equals end chars endchars nls parent nls node bad location exception badlocationexception node get highest node to be written gethighestnodetobewritten parent string get writable string getwritablestring string source pde xml helper pdexmlhelper get writable string getwritablestring source override model changed modelchanged i model changed event imodelchangedevent event object objects event get changed objects getchangedobjects objects objects length objects i document element node idocumentelementnode i document element node idocumentelementnode node i document element node idocumentelementnode objects object f operation table foperationtable remove node f operation list foperationlist remove f readable names freadablenames f readable names freadablenames remove event get change type getchangetype i model changed event imodelchangedevent remove delete node deletenode node i model changed event imodelchangedevent insert insert node insertnode node i model changed event imodelchangedevent change i document attribute node idocumentattributenode attr node get document attribute getdocumentattribute event get changed property getchangedproperty attr add attribute operation addattributeoperation attr event event get old value getoldvalue i document text node idocumenttextnode add element content operation addelementcontentoperation i document text node idocumenttextnode event get old value getoldvalue event get old value getoldvalue i document element node idocumentelementnode event get new value getnewvalue i document element node idocumentelementnode swap ping swapping nodes modify node modifynode node event override string get readable name getreadablename text edit textedit edit f readable names freadablenames f readable names freadablenames contains key containskey edit f readable names freadablenames edit