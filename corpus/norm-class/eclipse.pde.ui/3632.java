copyright ibm corporation rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors ibm corporation initial api implementation code corporation ongoing enhancements bar tosz bartosz michalik bar tosz bartosz michalik gmail bug benjamin cabe benjamin cabe any ware anyware tech bug bug johannes ahlers johannes ahlers gmx bug org eclipse pde internal wizards plugin java java lang reflect invocation target exception invocationtargetexception java util java util jar jar file jarfile java util jar manifest java util zip zip file zipfile org eclipse core resources org eclipse core runtime org eclipse jdt core org eclipse osgi service resolver bundle description bundledescription org eclipse osgi util manifest element manifestelement org eclipse osgi util nls org eclipse pde core build org eclipse pde core plugin org eclipse pde internal core i core constants icoreconstants org eclipse pde internal core build build org eclipse pde internal core build workspace build model workspacebuildmodel org eclipse pde internal core bundle bundle plugin base bundlepluginbase org eclipse pde internal core ibundle i bundle ibundle org eclipse pde internal core ibundle i bundle plugin model base ibundlepluginmodelbase org eclipse pde internal core natures pde org eclipse pde internal core plugin workspace plugin model base workspacepluginmodelbase org eclipse pde internal core project pde project pdeproject org eclipse pde internal org eclipse pde internal search dependencies add new binary dependencies operation addnewbinarydependenciesoperation org eclipse pde internal wizards i project provider iprojectprovider org eclipse pde i field data ifielddata org eclipse pde i plugin content wizard iplugincontentwizard org eclipse dialogs i overwrite query ioverwritequery org eclipse wizards data transfer datatransfer import operation importoperation org eclipse wizards data transfer datatransfer zip file structure provider zipfilestructureprovider org osgi framework bundle exception bundleexception org osgi framework constants new library plugin creation operation newlibraryplugincreationoperation new project creation operation newprojectcreationoperation nls string source prefix source library plugin field data librarypluginfielddata f data fdata new library plugin creation operation newlibraryplugincreationoperation library plugin field data librarypluginfielddata data i project provider iprojectprovider provider i plugin content wizard iplugincontentwizard content wizard contentwizard data provider content wizard contentwizard f data fdata data add jar addjar file jar file jarfile i project iproject project i progress monitor iprogressmonitor monitor core exception coreexception string jar name jarname jar file jarfile get name getname i file ifile file project get file getfile jar name jarname monitor sub task subtask nls bind pde ui messages pdeuimessages new project creation operation newprojectcreationoperation copying jar copyingjar jar name jarname input stream inputstream file input stream fileinputstream jar file jarfile file create monitor file not found exception filenotfoundexception fnfe close io exception ioexception ioe adjust export root adjustexportroot i project iproject project i bundle ibundle bundle core exception coreexception i resource iresource resources project members resources length resources i file ifile project equals nls resources get name getname nls classpath equals resources get name getname i core constants icoreconstants plugin filename descriptor equals resources get name getname i core constants icoreconstants build filename descriptor equals resources get name getname resource root export root remove export root removeexportroot bundle override adjust manifests adjustmanifests i progress monitor iprogressmonitor monitor i project iproject project i plugin base ipluginbase base core exception coreexception adjust manifests adjustmanifests monitor project base units f data fdata do find dependencies dofinddependencies units f data fdata is update references isupdatereferences sub monitor submonitor sub monitor submonitor sub monitor submonitor convert monitor units i bundle ibundle bundle base bundle plugin base bundlepluginbase bundle plugin base bundlepluginbase base get bundle getbundle bundle adjust export root adjustexportroot project bundle sub monitor submonitor worked add exported packages addexportedpackages project bundle sub monitor submonitor worked f data fdata do find dependencies dofinddependencies add dependencies adddependencies project base get model getmodel sub monitor submonitor split f data fdata is update references isupdatereferences update references updatereferences sub monitor submonitor split project update references updatereferences i progress monitor iprogressmonitor monitor i project iproject project java model exception javamodelexception i java project ijavaproject current project currentproject java core javacore create project i plugin model base ipluginmodelbase plugins to update pluginstoupdate f data fdata get plugins to update getpluginstoupdate sub monitor submonitor sub monitor submonitor sub monitor submonitor convert monitor plugins to update pluginstoupdate length plugins to update pluginstoupdate length sub monitor submonitor iteration monitor iterationmonitor sub monitor submonitor split set work remaining setworkremaining i project iproject proj plugins to update pluginstoupdate get underlying resource getunderlyingresource get project getproject current project currentproject get project getproject equals proj i java project ijavaproject java project javaproject java core javacore create proj i classpath entry iclasspathentry java project javaproject get raw classpath getrawclasspath i classpath entry iclasspathentry updated get updated classpath getupdatedclasspath current project currentproject updated java project javaproject set raw classpath setrawclasspath updated iteration monitor iterationmonitor split iteration monitor iterationmonitor set work remaining setworkremaining update required plugins updaterequiredplugins java project javaproject iteration monitor iterationmonitor split plugins to update pluginstoupdate core exception coreexception pde plugin pdeplugin log update required plugins updaterequiredplugins i java project ijavaproject java project javaproject i progress monitor iprogressmonitor monitor i plugin model base ipluginmodelbase model core exception coreexception i classpath entry iclasspathentry entries java project javaproject get raw classpath getrawclasspath list i classpath entry iclasspathentry classpath array list arraylist list i classpath entry iclasspathentry required projects requiredprojects array list arraylist entries length is plugin project entry ispluginprojectentry entries required projects requiredprojects add entries classpath add entries required projects requiredprojects size i file ifile file pde project pdeproject get manifest getmanifest java project javaproject get project getproject todo format manifest manifest manifest manifest file get contents getcontents string manifest get main attributes getmainattributes get value getvalue constants require bundle string buffer stringbuffer string buffer stringbuffer string buffer stringbuffer length nls append nls required projects requiredprojects size i classpath entry iclasspathentry entry required projects requiredprojects nls append append entry get path getpath segment entry is exported isexported todo nls append visibility reexport constant manifest get main attributes getmainattributes put value putvalue constants require bundle to string tostring byte array output stream bytearrayoutputstream content byte array output stream bytearrayoutputstream manifest write content sub monitor submonitor sub monitor submonitor sub monitor submonitor convert monitor file set contents setcontents byte array input stream bytearrayinputstream content to byte array tobytearray sub monitor submonitor split update classpath java project javaproject set raw classpath setrawclasspath classpath to array toarray i classpath entry iclasspathentry classpath size sub monitor submonitor split classpath computer classpathcomputer set classpath setclasspath java project javaproject get project getproject model io exception ioexception core exception coreexception is plugin project entry ispluginprojectentry i classpath entry iclasspathentry entry i classpath entry iclasspathentry cpe project entry get entry kind getentrykind i workspace root iworkspaceroot workspace root workspaceroot resources plugin resourcesplugin get workspace getworkspace get root getroot i project iproject workspace root workspaceroot get project getproject entry get path getpath segment pde has plugin nature haspluginnature pde project pdeproject get fragment xml getfragmentxml exists input stream inputstream pde project pdeproject get manifest getmanifest get contents getcontents manifest manifest get main attributes getmainattributes get value getvalue constants fragment host close io exception ioexception core exception coreexception updated classpath i classpath entry iclasspathentry get updated classpath getupdatedclasspath i classpath entry iclasspathentry i java project ijavaproject current project currentproject exposed ref index refindex list i classpath entry iclasspathentry result array list arraylist manifest manifests hash set hashset f data fdata get library paths getlibrarypaths length jar file jarfile jar file jarfile jar file jarfile f data fdata get library paths getlibrarypaths manifests add jar file jarfile get manifest getmanifest io exception ioexception pde plugin pdeplugin log i workspace root iworkspaceroot root resources plugin resourcesplugin get workspace getworkspace get root getroot length i classpath entry iclasspathentry cpe cpe get entry kind getentrykind i classpath entry iclasspathentry cpe library string path i path ipath location root get file getfile cpe get path getpath get location getlocation location path location to string tostring path absolute path path cpe get path getpath to string tostring jar file jarfile jar file jarfile jar file jarfile jar file jarfile path manifests jar file jarfile get manifest getmanifest ref index refindex all ocate allocate slot ref index refindex result size result add exposed cpe is exported isexported result add cpe io exception ioexception pde plugin pdeplugin log jar file jarfile jar file jarfile close io exception ioexception pde plugin pdeplugin log result add cpe ref index refindex result ref index refindex java core javacore new project entry newprojectentry current project currentproject get path getpath exposed result to array toarray i classpath entry iclasspathentry result size override create contents createcontents i progress monitor iprogressmonitor monitor i project iproject project core exception coreexception java model exception javamodelexception invocation target exception invocationtargetexception interrupted exception interruptedexception copy jars string paths f data fdata get library paths getlibrarypaths sub monitor submonitor sub monitor submonitor sub monitor submonitor convert monitor paths length paths length file jar file jarfile file paths f data fdata is unzip libraries isunziplibraries import jar importjar jar file jarfile project sub monitor submonitor split add jar addjar jar file jarfile project sub monitor submonitor delete manifest imported libraries i file ifile imported manifest importedmanifest pde project pdeproject get manifest getmanifest project imported manifest importedmanifest exists imported manifest importedmanifest delete sub monitor submonitor split sub monitor submonitor set work remaining setworkremaining f data fdata has bundle structure hasbundlestructure i folder ifolder meta inf nls project get folder getfolder nls meta inf meta inf members length meta inf delete sub monitor submonitor split sub monitor submonitor set work remaining setworkremaining override fill bin includes fillbinincludes i project iproject project i build entry ibuildentry bin entry binentry core exception coreexception f data fdata has bundle structure hasbundlestructure bin entry binentry add token addtoken i core constants icoreconstants manifest folder bin entry binentry add token addtoken i core constants icoreconstants plugin filename descriptor f data fdata is unzip libraries isunziplibraries i resource iresource resources project members resources length string resource name resourcename resources get name getname resources i folder ifolder nls nls settings equals resource name resourcename bin entry binentry resource name resourcename nls bin entry binentry add token addtoken nls resource name resourcename nls project equals nls resource name resourcename nls classpath equals nls resource name resourcename i core constants icoreconstants build filename descriptor equals resource name resourcename bin entry binentry resource name resourcename bin entry binentry add token addtoken resource name resourcename string library paths librarypaths f data fdata get library paths getlibrarypaths library paths librarypaths length file jar file jarfile file library paths librarypaths string jar file jarfile get name getname bin entry binentry bin entry binentry add token addtoken override i classpath entry iclasspathentry get internal class path entries getinternalclasspathentries i java project ijavaproject project i field data ifielddata data string library paths librarypaths f data fdata is unzip libraries isunziplibraries nls library paths librarypaths string library paths librarypaths f data fdata get library paths getlibrarypaths i classpath entry iclasspathentry entries i classpath entry iclasspathentry library paths librarypaths length library paths librarypaths length file jar file jarfile file library paths librarypaths string jar name jarname jar file jarfile get name getname i path ipath path project get project getproject get full path getfullpath append jar name jarname entries java core javacore new library entry newlibraryentry path entries override get number of work units getnumberofworkunits num units numunits get number of work units getnumberofworkunits num units numunits f data fdata get library paths getlibrarypaths length num units numunits import jar importjar file jar i resource iresource destination i progress monitor iprogressmonitor monitor core exception coreexception invocation target exception invocationtargetexception interrupted exception interruptedexception zip file zipfile input input zip file zipfile jar zip file structure provider zipfilestructureprovider provider zip file structure provider zipfilestructureprovider input import operation importoperation import operation importoperation destination get full path getfullpath provider get root getroot provider i overwrite query ioverwritequery override string query overwrite queryoverwrite string path string pathstring i overwrite query ioverwritequery monitor input input close io exception ioexception core exception coreexception status i status istatus error ipdeui constants ipdeuiconstants plugin i status istatus nls bind pde ui messages pdeuimessages new project creation operation newprojectcreationoperation error importing jar errorimportingjar jar remove export root removeexportroot i bundle ibundle bundle string bundle get header getheader constants bundle classpath nls manifest element manifestelement elems manifest element manifestelement parse header parseheader constants bundle classpath string buffer stringbuffer buf f buff string buffer stringbuffer length elems length nls elems get value getvalue equals nls buf f buff append elems get value getvalue bundle set header setheader constants bundle classpath buf f buff to string tostring bundle exception bundleexception override set plugin libraries setpluginlibraries workspace plugin model base workspacepluginmodelbase model core exception coreexception i plugin base ipluginbase plugin base pluginbase model get plugin base getpluginbase f data fdata is unzip libraries isunziplibraries i plugin library ipluginlibrary library model get plugin factory getpluginfactory create library createlibrary nls library set name setname library set exported setexported plugin base pluginbase add library string paths f data fdata get library paths getlibrarypaths paths length file jar file jarfile file paths i plugin library ipluginlibrary library model get plugin factory getpluginfactory create library createlibrary library set name setname jar file jarfile get name getname library set exported setexported plugin base pluginbase add library override create source output build entries createsourceoutputbuildentries workspace build model workspacebuildmodel model i build model factory ibuildmodelfactory factory core exception coreexception f data fdata is unzip libraries isunziplibraries source library nls i build entry ibuildentry entry factory create entry createentry i build entry ibuildentry jar prefix nls entry add token addtoken model get build getbuild add entry output library nls entry factory create entry createentry i build entry ibuildentry output prefix nls entry add token addtoken model get build getbuild add entry add exported packages addexportedpackages i project iproject project i bundle ibundle bundle string bundle get header getheader constants bundle classpath nls manifest element manifestelement elems manifest element manifestelement parse header parseheader constants bundle classpath hash map hashmap string array list arraylist string map hash map hashmap elems length array list arraylist string filter array list arraylist nls filter add nls map elems get value getvalue filter string packages get exports getexports project map string pkg value pkgvalue get comma values from packages set getcommavaluesfrompackagesset packages f data fdata get version getversion bundle set header setheader constants export pkg value pkgvalue bundle exception bundleexception suppress warnings suppresswarnings unchecked rawtypes string get exports getexports i project iproject proj map libs i file ifile build properties buildproperties pde project pdeproject get build properties getbuildproperties proj i build ibuild build build properties buildproperties workspace build model workspacebuildmodel build model buildmodel workspace build model workspacebuildmodel build properties buildproperties build build model buildmodel get build getbuild build build find packages findpackages proj libs build string find packages findpackages i project iproject proj map list libs i build ibuild build tree set treeset string result tree set treeset i java project ijavaproject java core javacore create proj iterator libs entry set entryset iterator has next hasnext suppress warnings suppresswarnings rawtypes map entry entry map entry string lib name libname entry get key getkey to string tostring list filter list entry get value getvalue i build entry ibuildentry lib entry libentry build get entry getentry source prefix lib name libname lib entry libentry string tokens lib entry libentry get tokens gettokens tokens length i resource iresource folder nls tokens equals nls folder proj folder proj get folder getfolder tokens folder add packages from frag root addpackagesfromfragroot get package fragment root getpackagefragmentroot folder result filter i resource iresource res proj find member findmember lib name libname res add packages from frag root addpackagesfromfragroot get package fragment root getpackagefragmentroot res result filter result add packages from frag root addpackagesfromfragroot i package fragment root ipackagefragmentroot root collection string result list filter root nls filter filter list iterator listiterator filter list iterator listiterator has next hasnext string pkg name pkgname to string tostring nls pkg name pkgname ends with endswith nls pkg name pkgname pkg name pkgname substring pkg name pkgname length i package fragment ipackagefragment frag root get package fragment getpackagefragment pkg name pkgname frag result add pkg name pkgname i java element ijavaelement children root get children getchildren children length i package fragment ipackagefragment fragment i package fragment ipackagefragment children string fragment get element name getelementname fragment has children haschildren result result add java model exception javamodelexception add dependencies adddependencies i project iproject project i shared plugin model isharedpluginmodel model i progress monitor iprogressmonitor monitor model i bundle plugin model base ibundlepluginmodelbase unzip f data fdata is unzip libraries isunziplibraries add new binary dependencies operation addnewbinarydependenciesoperation project i bundle plugin model base ibundlepluginmodelbase model override function include bundle target platform dependency override string find secondary bundles findsecondarybundles i bundle ibundle bundle string ignore pkgs ignorepkgs i plugin model base ipluginmodelbase bases plugin registry pluginregistry get active models getactivemodels string ids string bases length bases length bundle description bundledescription desc bases get bundle description getbundledescription desc ids bases get plugin base getpluginbase get id getid ids desc get symbolic name getsymbolicname ids override function jar unzipped build properties entry add project packages addprojectpackages find project packages includes bin includes override add project packages addprojectpackages i bundle ibundle bundle string ignore pkgs ignorepkgs unzip add project packages addprojectpackages bundle ignore pkgs ignorepkgs stack i resource iresource stack stack stack push f project fproject stack is empty isempty i container icontainer folder i container icontainer stack pop i resource iresource children folder members children length children i container icontainer stack push children equals nls i file ifile children get file extension getfileextension string path folder get project relative path getprojectrelativepath to string tostring ignore pkgs ignorepkgs add path replace core exception coreexception monitor invocation target exception invocationtargetexception interrupted exception interruptedexception