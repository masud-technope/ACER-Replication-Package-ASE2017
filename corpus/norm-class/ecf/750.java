converted major ref act ors refactors required memory efficient additional refactoring copyright apache software foundation licensed apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org jivesoftware smack util collect ions collections java io exception ioexception java object input stream objectinputstream java object output stream objectoutputstream java lang reference java lang reference queue referencequeue java lang soft reference softreference java lang weak reference weakreference java util implementation hash based map entries removed garbage collector features subclass reference hash based map key entries stored instances code reference entry referenceentry code overridden replaced iter ators iterators replaced replace key set keyset entry set entryset values view classes overridable methods change has hing hashing behaviour change entries removed map unusual subclasses construct code abstract reference map abstractreferencemap code kind references store map values hard references garbage collector remove mappings key unreachable jvm memory running reference types behave link reference types references values configured weak values hard behave href http java sun docs api java util weak hash map weakhashmap html code weak hash map weakhashmap code hard weak values combination constructor hard soft values providing memory sensitive cache link map implementation elements attempting add key map raise code null pointer exception nullpointerexception code iter ators iterators reset start casting code reset table iterator resettableiterator code calling code reset code implementation link java util collections synchronized map synchronizedmap provide access code reference map referencemap code author paul jack author matt hall john watkinson step hen stephen colebourne version revision java lang reference commons collections extracted reference map referencemap abstract reference map abstractreferencemap abstract has hed map abstracthashedmap constant indicating hard references hard constant indicating soft references soft constant indicating weak references weak reference type hard soft weak serial key type keytype reference type values hard soft weak serial value type valuetype automatically purge d purged key collected purge values purgevalues reference queue referencequeue eliminate stale mappings purge reference queue referencequeue queue constructor deserialization abstract reference map abstractreferencemap constructs empty map reference types load factor initial capacity param key type keytype type reference link soft link weak param value type valuetype type reference values link soft link weak param capacity initial capacity map param load factor loadfactor load factor map param purge values purgevalues automatically purge d purged key garbage collected abstract reference map abstractreferencemap key type keytype value type valuetype capacity load factor loadfactor purge values purgevalues capacity load factor loadfactor verify key type keytype key type keytype verify value type valuetype value type valuetype key type keytype key type keytype value type valuetype value type valuetype purge values purgevalues purge values purgevalues init ialise initialise subclass construction cloning deserialization init queue reference queue referencequeue checks type valid param error messages param type type check illegal argument exception illegalargumentexception invalid verify string type type hard type weak illegal argument exception illegalargumentexception hard soft weak size map size size purge before read purgebeforeread size checks map empty map size is empty isempty purge before read purgebeforeread is empty isempty checks map key param key key search map key contains key containskey object key purge before read purgebeforeread entry entry get entry getentry key entry entry get value getvalue checks map param search map contains value containsvalue object purge before read purgebeforeread contains value containsvalue mapped key param key key mapped match object key purge before read purgebeforeread entry entry get entry getentry key entry entry get value getvalue puts key mapping map key param key key add param add mapped key null pointer exception nullpointerexception key key key null pointer exception nullpointerexception allowed null pointer exception nullpointerexception values allowed purge before write purgebeforewrite key removes mapping map param key mapping remove mapped removed key key map remove object key key purge before write purgebeforewrite remove key clears map clear clear queue poll drain queue map iterator mapiterator reference map iterator returns valid key pairs map iterator map iterator mapiterator map iterator mapiterator reference map iterator referencemapiterator returns view map entries iterator returned entry valid code code called code set value setvalue code method code to array toarray code entries view map entries map entry entry set entryset entry set entryset entry set entryset reference entry set referenceentryset entry set entryset returns view map view map key set keyset key set keyset key set keyset reference key set referencekeyset key set keyset returns collection view map values view map values collection values values values reference values referencevalues values purges stale mappings map read operations implementation calls link purge main tain maintain consistent purge before read purgebeforeread purge purges stale mappings map write operations implementation calls link purge main tain maintain consistent purge before write purgebeforewrite purge purges stale mappings map note method special care instance stale mappings removed per iodic periodic basis background thread purge reference queue poll purge queue poll purges reference param reference purge purge reference hash code hashcode reference hash code hashcode mapping key reference ref ers refers mapping hash hash code hashcode hash index hashindex hash data length hash entry hashentry previous hash entry hashentry entry data entry reference entry referenceentry entry purge previous data entry previous entry size previous entry entry entry entry mapped key param key key entry match hash entry hashentry get entry getentry object key key get entry getentry key hash code map entry mapentry subclasses override identity hash code identityhashcode param key key hash code param hash code hash code map entry mapentry specification hash entry hashentry object key object key key hash code hashcode hash code hashcode compares internal converted form equal implementation converts key entry real reference comparison param key key compare passed param key key extracted entry code entry key code equal is equal key isequalkey object key object key key key type keytype hard reference key key key key key equals key creates reference entry referenceentry hash entry hashentry param entry sequence param hash code hashcode hash code param key key store param store newly created entry hash entry hashentry create entry createentry hash entry hashentry hash code hashcode key reference entry referenceentry reference entry referenceentry hash code hashcode key creates entry iterator entry set entryset iterator iterator map entry create entry set iterator createentrysetiterator reference entry set iterator referenceentrysetiterator creates key iterator key set keyset iterator iterator create key set iterator createkeysetiterator reference key set iterator referencekeysetiterator creates values iterator values iterator iterator create values iterator createvaluesiterator reference values iterator referencevaluesiterator entry set entryset implementation reference entry set referenceentryset entry set entryset reference entry set referenceentryset abstract has hed map abstracthashedmap parent parent object to array toarray to array toarray object to array toarray arr special implementation handle disappearing entries array list arraylist map entry list array list arraylist map entry iterator map entry iterator iterator iterator has next hasnext map entry iterator list add default map entry defaultmapentry get key getkey get value getvalue list to array toarray arr key set keyset implementation reference key set referencekeyset key set keyset reference key set referencekeyset abstract has hed map abstracthashedmap parent parent object to array toarray to array toarray object to array toarray arr special implementation handle disappearing list list array list arraylist parent size iterator iterator has next hasnext list add list to array toarray arr values implementation reference values referencevalues values reference values referencevalues abstract has hed map abstracthashedmap parent parent object to array toarray to array toarray object to array toarray arr special implementation handle disappearing values list list array list arraylist parent size iterator iterator has next hasnext list add list to array toarray arr map entry mapentry implementation map get key getkey get value getvalue returns mapping stale removed commons collections reference entry referenceentry hash entry hashentry parent map abstract reference map abstractreferencemap parent reference ref key refkey reference ref value refvalue creates entry object reference map referencemap param parent parent map param entry hash bucket param hash code hashcode hash code key param key key param reference entry referenceentry abstract reference map abstractreferencemap parent reference entry referenceentry hash code hashcode key hash code hashcode parent parent parent key type keytype hard ref key refkey to reference toreference parent key type keytype key hash code hashcode set key setkey key parent value type valuetype hard key hash code hashcode passed deliberately ref value refvalue to reference toreference parent value type valuetype hash code hashcode set value setvalue key entry method dereferences weak soft key garbage collected get key getkey parent key type keytype hard ref key refkey get key getkey entry method dereferences weak soft garbage collected get value getvalue parent value type valuetype hard ref value refvalue get value getvalue sets entry param obj object store previous set value setvalue obj get value getvalue parent value type valuetype hard ref value refvalue clear ref value refvalue to reference toreference parent value type valuetype obj hash code hashcode set value setvalue obj compares map entry implementation code is equal key isequalkey code code is equal value isequalvalue code main map comparison param obj map entry compare equal equals object obj obj obj map entry map entry entry map entry obj convert hard reference object entry key entrykey entry get key getkey convert hard reference object entry value entryvalue entry get value getvalue entry key entrykey entry value entryvalue not e note key direct access method parent is equal key isequalkey entry key entrykey get key getkey parent is equal value isequalvalue entry value entryvalue get value getvalue hash code hashcode entry temporary hard references implementation code hash entry hashentry code main map hash code hashcode entry hash code hashcode parent hash entry hashentry get key getkey get value getvalue constructs reference type ref erent referent reference registered queue purging param type hard soft weak param ref erent referent object refer param hash hash code key mapping number ref erent referent hash code hashcode ref erent referent represents key reference to reference toreference type ref erent referent hash type soft soft ref softref hash ref erent referent parent queue weak weak ref weakref hash ref erent referent parent queue error attempt create hard reference reference map referencemap purges reference param reference purge purge reference parent key type keytype hard ref key refkey parent value type valuetype hard ref value refvalue parent key type keytype hard ref key refkey clear parent value type valuetype hard ref value refvalue clear parent purge values purgevalues set value setvalue entry bucket entry bucket reference entry referenceentry reference entry referenceentry entry set entryset iterator reference iterator base referenceiteratorbase abstract reference map abstractreferencemap parent fields track table reference entry referenceentry entry reference entry referenceentry previous object fields provide hard references current entry ass ures assures has next hasnext returns valid element next key nextkey next value nextvalue current key currentkey current value currentvalue expected mod count expectedmodcount reference iterator base referenceiteratorbase abstract reference map abstractreferencemap parent parent parent parent size parent data length size invocation altered mod count modcount expected mod count expectedmodcount parent mod count modcount has next hasnext check mod checkmod next null nextnull reference entry referenceentry entry reference entry referenceentry parent data entry current key currentkey current value currentvalue next key nextkey get key getkey next value nextvalue get value getvalue next null nextnull entry entry check mod checkmod parent mod count modcount expected mod count expectedmodcount concurrent modification exception concurrentmodificationexception next null nextnull next key nextkey next value nextvalue reference entry referenceentry next entry nextentry check mod checkmod next null nextnull has next hasnext no such element exception nosuchelementexception previous entry entry entry current key currentkey next key nextkey current value currentvalue next value nextvalue next key nextkey next value nextvalue previous reference entry referenceentry current entry currententry check mod checkmod previous reference entry referenceentry super next supernext next entry nextentry remove check mod checkmod previous illegal state exception illegalstateexception parent remove current key currentkey previous current key currentkey current value currentvalue expected mod count expectedmodcount parent mod count modcount entry set entryset iterator reference entry set iterator referenceentrysetiterator reference iterator base referenceiteratorbase iterator map entry reference entry set iterator referenceentrysetiterator abstract reference map abstractreferencemap abstract reference map abstractreferencemap abstract reference map abstractreferencemap reference entry referenceentry super next supernext key set keyset iterator reference key set iterator referencekeysetiterator reference iterator base referenceiteratorbase iterator reference key set iterator referencekeysetiterator abstract reference map abstractreferencemap parent parent next entry nextentry get key getkey values iterator reference values iterator referencevaluesiterator reference iterator base referenceiteratorbase iterator reference values iterator referencevaluesiterator abstract reference map abstractreferencemap parent parent next entry nextentry get value getvalue map iterator mapiterator implementation reference map iterator referencemapiterator reference iterator base referenceiteratorbase map iterator mapiterator reference map iterator referencemapiterator abstract reference map abstractreferencemap parent parent next entry nextentry get key getkey get key getkey hash entry hashentry current current entry currententry current illegal state exception illegalstateexception abstract has hed map abstracthashedmap get key getkey invalid current get key getkey get value getvalue hash entry hashentry current current entry currententry current illegal state exception illegalstateexception abstract has hed map abstracthashedmap get value getvalue invalid current get value getvalue set value setvalue hash entry hashentry current current entry currententry current illegal state exception illegalstateexception abstract has hed map abstracthashedmap set value setvalue invalid current set value setvalue soft reference holder soft ref softref soft reference softreference hash code hashcode key reference points hash soft ref softref hash reference queue referencequeue hash hash hash code hashcode hash weak reference holder weak ref weakref weak reference weakreference hash weak ref weakref hash reference queue referencequeue hash hash hash code hashcode hash replaces superclass method store serialization jdk nicest topics normal serialization init ialise initialise superclass subclass isn code code method read subclass solution serialize data method method called code write object writeobject code serializable subclass subclasses override specific field read implementation work gen erally generally read determines serialized param output stream do write object dowriteobject object output stream objectoutputstream io exception ioexception write int writeint key type keytype write int writeint value type valuetype write boolean writeboolean purge values purgevalues write float writefloat load factor loadfactor write int writeint data length map iterator mapiterator map iterator mapiterator has next hasnext write object writeobject write object writeobject get value getvalue terminate map write object writeobject call do write object dowriteobject code doesn work reference map replaces superclass m superclassm method read serialization jdk nicest topics normal serialization init ialise initialise superclass subclass isn code code method read subclass solution deserialize data method method called code read object readobject code serializable subclass subclasses override subclass specific field code code code calculate threshold calculatethreshold code work correctly param input stream do read object doreadobject object input stream objectinputstream io exception ioexception class not found exception classnotfoundexception key type keytype read int readint value type valuetype read int readint purge values purgevalues read boolean readboolean load factor loadfactor read float readfloat capacity read int readint init data hash entry hashentry capacity key read object readobject key read object readobject key threshold calculate threshold calculatethreshold data length load factor loadfactor call do read object doreadobject code doesn work reference map