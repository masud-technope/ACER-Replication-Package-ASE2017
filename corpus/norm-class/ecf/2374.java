copyright jan rellermeyer systems group dep artment department computer science eth zurich rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors jan rellermeyer initial api implementation mark us markus alexander kuppe enhancements bug fixes ethz iks slp impl java byte array input stream bytearrayinputstream java data input stream datainputstream java data output stream dataoutputstream java file java io exception ioexception java interruptedioexception java lang reflect constructor java net bind exception bindexception java net data gram packet datagrampacket java net data gram socket datagramsocket java net inet address java net inet address inetaddress java net multicast socket multicastsocket java net protocol exception protocolexception java net socket java net socket exception socketexception java net unknown host exception unknownhostexception java util array list arraylist java util arrays java util hash map hashmap java util iterator java util list java util locale java util map ethz iks slp service location exception servicelocationexception ethz iks slp service type servicetype core jslp implementation code ethz iks slp service location manager servicelocationmanager code inherits ethz iks slp impl service location manager servicelocationmanager author jan rellermeyer iks eth zurich slp core slpcore is multicast socket initialized ismulticastsocketinitialized is initialized isinitialized platform abstract ion platformabstraction platform empty locale messages don locale locale locale locale get default getdefault port slp communication slp port reserved standard port slp res erved reserved port standard slp multicast address string slp mcast address inet address inetaddress mcast address slp configuration slp configuration slpconfiguration config debug ging debugging tcp standard service type d as das string slp type service directory agent check peer previous resp onder responder list string myips configured perform discovery no discovery nodiscovery constructor code advertiser code instances implementation exists constructor advert ise r advertiser constructor code locator code instances implementation exists constructor locator constructor code slp daemon slpdaemon code instances implementation exists constructor daemon constr daemonconstr daemon instance implementation exists daemon running machine slp daemon slpdaemon daemon multicast server thread thread multicast thread multicastthread multicast socket multicast socket multicastsocket mtc socket mtcsocket free xid next xid nextxid async hronously asynchronously receive replies query xid reply queue list map reply listeners replylisteners hash map hashmap map d as das string scope list strings url s urls map d as das hash map hashmap map sp is spis string url string string url list sp is spis map daspis hash map hashmap inet address inetaddress local host localhost initialize core local host localhost inet address inetaddress get local host getlocalhost throwable print stack trace printstacktrace locale locale check advertiser implementation constructor constr constr for name forname ethz iks slp impl advertiser impl advertiserimpl get constructor getconstructor locale exception advert ise r advertiser constr check locator implementation constr constr for name forname ethz iks slp impl locator impl locatorimpl get constructor getconstructor locale exception locator constr check daemon constr constr for name forname ethz iks slp impl slp daemon impl slpdaemonimpl get constructor getconstructor exception daemon constr daemonconstr constr read property file exists file prop file propfile file j slp jslp properties slp configuration slpconfiguration config config prop file propfile exists slp configuration slpconfiguration prop file propfile slp configuration slpconfiguration io exception ioexception system println parse property file prop file propfile to string tostring print stack trace printstacktrace config slp configuration slpconfiguration config config no discovery nodiscovery config get no da discovery getnodadiscovery determine interfaces jslp runs list ips array list arraylist string i ps ips config get interfaces getinterfaces i ps ips inet address inetaddress add res ses addresses add res ses addresses inet address inetaddress get all by name getallbyname inet address inetaddress get local host getlocalhost get host name gethostname add res ses addresses length https bugs eclipse org add res ses addresses inet address system err println support ip v ipv jslp https bugs eclipse org skip ping skipping ips add add res ses addresses get host address gethostaddress unknown host exception unknownhostexception system err println reverse lookup host failed running service discovery local loop localloop ips clear ips add inet address inetaddress get local host getlocalhost get host address gethostaddress unknown host exception unknownhostexception print stack trace printstacktrace ips add all addall arrays as list aslist i ps ips myips string ips to array toarray string ips size slp port config get port getport initialize xid random number next xid nextxid math math random max inet address inetaddress mcast mcast inet address inetaddress get by name getbyname slp core slpcore slp mcast address unknown host exception unknownhostexception print stack trace printstacktrace mcast address mcast init is initialized isinitialized is initialized isinitialized platform log debug logdebug jslp running interfaces java util arrays as list aslist myips platform log debug logdebug jslp port slp port string da add res ses daaddresses config get da add res ses getdaaddresses da add res ses daaddresses no discovery nodiscovery illegal argument exception illegalargumentexception configuration net slp no da discovery nodadiscovery requires empty list preconfigured d as das process preconfigured d as das service request servicerequest req service request servicerequest service type servicetype slp type req port slp port da add res ses daaddresses length req address inet address inetaddress get by name getbyname da add res ses daaddresses d aa d ver tis ement daadvertisement daa d aa d ver tis ement daadvertisement send message sendmessage req string scopes string daa scope list scopelist to array toarray string daa scope list scopelist size scopes length platform log debug logdebug jslp adding da add res ses daaddresses scope scopes slp utils slputils add value addvalue d as das scopes to lower case tolowercase da add res ses daaddresses service location exception servicelocationexception platform log warning logwarning error communitcating da add res ses daaddresses unknown host exception unknownhostexception platform log warning logwarning unknown net slp da add res ses daaddresses address da add res ses daaddresses illegal argument exception illegalargumentexception ise platform log debug logdebug happen ise no discovery nodiscovery perform initial lookup list scopes array list arraylist scopes add da lookup dalookup scopes exception platform log error logerror exception initial lookup pure doesn multicast listener required init multicast socket initmulticastsocket is multicast socket initialized ismulticastsocketinitialized is multicast socket initialized ismulticastsocketinitialized mtc socket mtcsocket multicast socket multicastsocket slp port mtc socket mtcsocket set time to live settimetolive config getmcastttl config get interfaces getinterfaces mtc socket mtcsocket set interface setinterface inet address inetaddress get by name getbyname myips throwable platform log debug logdebug setting multicast socket myips failed mtc socket mtcsocket join group joingroup mcast address bind exception bindexception platform log error logerror get message getmessage runtime exception runtimeexception root open port slp port exception platform log error logerror get message getmessage setup start multicast thread multicast thread multicastthread thread data gram packet datagrampacket packet bytes slp core slpcore config getmtu packet data gram packet datagrampacket bytes bytes length mtc socket mtcsocket receive packet slp message slpmessage reply handle message handlemessage slp message slpmessage parse packet get address getaddress packet get port getport data input stream datainputstream byte array input stream bytearrayinputstream packet get data getdata reply repbytes reply get bytes getbytes data gram packet datagrampacket data gram packet datagrampacket data gram packet datagrampacket repbytes repbytes length reply address reply port mtc socket mtcsocket send data gram packet datagrampacket platform log debug logdebug send reply address reply port reply to string tostring exception platform log error logerror exception multicast receiver thread multicast thread multicastthread start start daemon instance daemon constr daemonconstr daemon slp daemon slpdaemon daemon constr daemonconstr new instance newinstance exception platform log warning logwarning jslp created slp daemon slpdaemon daemon inet address inetaddress get my p getmyip inet address inetaddress get by name getbyname myips unknown host exception unknownhostexception platform log error logerror unknown net slp interfaces address myips list scopes list scopes rfc prop oses proposes code vector code jslp returns code list code service location exception servicelocationexception exception underlying framework list find scopes findscopes service location exception servicelocationexception array list arraylist d as das key set keyset handle incoming udp messages param message incoming message service location exception servicelocationexception wrong slp message slpmessage handle message handlemessage slp message slpmessage message service location exception servicelocationexception message platform log trace message logtracemessage received message address message port message message funcid slp message slpmessage daadvert drop message nodadiscovery no discovery nodiscovery platform log trace drop logtracedrop dropped message address message port message to string tostring reason nodadiscovery d aa d ver tis ement daadvertisement advert d aa d ver tis ement daadvertisement message advert error code errorcode platform log trace drop logtracedrop dropped d aad ver tis ement daadvertisement advert address advert port advert to string tostring reason advert error code errorcode advert url advert address get host address gethostaddress advert url advert address get host address gethostaddress state less boot timestamp statelessboottimestamp advert state less boot timestamp statelessboottimestamp iterator iter advert scope list scopelist iterator iter has next hasnext string scope string iter to lower case tolowercase slp utils slputils remove value removevalue slp core slpcore d as das scope to lower case tolowercase advert url daspis remove advert url iterator iter advert scope list scopelist iterator iter has next hasnext string scope string iter to lower case tolowercase openslp str ictly strictly follow rfc send state less boot timestamp statelessboottimestamp rebooted lost registrations reasons openslp sends sbt sends daadvert reregister services receive daadvert caring sbt slp utils slputils add value addvalue slp core slpcore d as das scope advert url config get security enabled getsecurityenabled daspis advert url slp message slpmessage string to list stringtolist advert spi d as das d as das notify all notifyall daemon daemon new da d is covered newdadiscovered advert platform log debug logdebug list d as das reply messages slp message slpmessage attr rply attrrply slp message slpmessage srvrply slp message slpmessage srvtyperply reply listeners replylisteners list queue list reply listeners replylisteners integer message xid queue queue queue add message queue notify all notifyall platform log trace reg logtracereg srvtypereply recieved message address message port message to string tostring reply listeners replylisteners request messages slp message slpmessage srvrqst slp message slpmessage attr rqst attrrqst slp message slpmessage srvtyperqst resp onder responder list slp core slpcore myips length request message requestmessage message prev res p list prevresplist slp core slpcore myips platform log trace drop logtracedrop dropped message address message port message to string tostring udp multicast message daemon daemon daemon handle message handlemessage message platform log debug logdebug srvtyperqst recieved message address message port message to string tostring slp daemon slpdaemon handle message messages daemon daemon daemon handle message handlemessage message platform log debug logdebug message recieved message address message port message to string tostring slp daemon slpdaemon handle message xid xid next xid nextxid next xid nextxid next xid nextxid next xid nextxid find d as das scopes sending multicast service request service service directory agent param scopes code list code scopes service location exception servicelocationexception net work network errors da lookup dalookup list scopes service location exception servicelocationexception altered jan compatible java myips length create socket bound address inet address inetaddress add r addr inet address inetaddress get by name getbyname myips data gram socket datagramsocket socket data gram socket datagramsocket add r addr service request servicerequest sreq service request servicerequest service type servicetype slp type scopes slp core slpcore locale sreq xid slp core slpcore next xid nextxid sreq scope list scopelist scopes sreq address mcast address sreq multicast bytes sreq get bytes getbytes data gram packet datagrampacket data gram packet datagrampacket bytes bytes length mcast address slp port platform log trace message logtracemessage sreq udp multicast setup receiver thread setupreceiverthread socket config get wait time getwaittime sreq socket send socket exception socketexception list remaining array list arraylist java util arrays as list aslist myips string faulty myips remaining remove faulty myips string remaining to array toarray string remaining size platform log debug logdebug black listing blacklisting faulty illegal argument exception illegalargumentexception ise platform log debug logdebug happen filter ise unknown host exception unknownhostexception uhe platform log warning logwarning unknown net slp interfaces address myips uhe service location exception servicelocationexception service location exception servicelocationexception network error uhe get message getmessage io exception ioexception platform log warning logwarning error connecting myips service location exception servicelocationexception service location exception servicelocationexception network error get message getmessage send unicast message tcp param msg message reply service location exception servicelocationexception net work network errors reply message replymessage sendmessagetcp slp message slpmessage msg service location exception servicelocationexception msg xid msg xid next xid nextxid socket socket socket msg address msg port socket set so timeout setsotimeout config gettcptimeout data output stream dataoutputstream data output stream dataoutputstream socket get output stream getoutputstream data input stream datainputstream data input stream datainputstream socket get input stream getinputstream write msg get bytes getbytes reply message replymessage reply reply message replymessage slp message slpmessage parse msg address msg port socket close reply exception service location exception servicelocationexception service location exception servicelocationexception network error get message getmessage send unicast message udp param msg message param expect reply expectreply waits reply reply service location exception servicelocationexception net work network errors reply message replymessage send message sendmessage slp message slpmessage msg expect reply expectreply service location exception servicelocationexception msg xid msg xid next xid nextxid msg get size getsize config getmtu tcp daemon is multicast socket initialized ismulticastsocketinitialized sendmessagetcp msg data gram socket datagramsocket dsocket data gram socket datagramsocket dsocket set so timeout setsotimeout config get data gram max wait getdatagrammaxwait bytes msg get bytes getbytes data gram packet datagrampacket packet data gram packet datagrampacket bytes bytes length msg address msg port received bytes receivedbytes config getmtu data gram packet datagrampacket received data gram packet datagrampacket received bytes receivedbytes received bytes receivedbytes length dsocket send packet platform log trace message logtracemessage msg address msg port msg udp port dsocket get local port getlocalport reply expected expect reply expectreply dsocket receive received dsocket close data input stream datainputstream data input stream datainputstream byte array input stream bytearrayinputstream received get data getdata reply message replymessage reply reply message replymessage slp message slpmessage parse received get address getaddress received get port getport reply socket exception socketexception service location exception servicelocationexception service location exception servicelocationexception network init failed get message getmessage protocol exception protocolexception sendmessagetcp msg io exception ioexception ioe platform log error logerror exception sending msg platform log error logerror msg address msg port platform log error logerror exception ioe service location exception servicelocationexception service location exception servicelocationexception network error ioe get message getmessage throwable platform log debug logdebug get message getmessage service location exception servicelocationexception get message getmessage send request multicast convergence algorithm param msg message collected reply messages service location exception servicelocationexception net work network errors list multicast convergence multicastconvergence request message requestmessage msg service location exception servicelocationexception start system current time millis currenttimemillis list reply queue replyqueue array list arraylist list resp onders responders array list arraylist list res ponses responses array list arraylist msg xid msg xid slp core slpcore next xid nextxid register reply queue listener integer queryxid integer msg xid reply listeners replylisteners reply listeners replylisteners queryxid reply queue replyqueue msg port slp core slpcore slp port msg prev res p list prevresplist array list arraylist msg multicast send localhost support multicast loop back loopback fail running locally msg address local host localhost reply queue replyqueue add sendmessagetcp msg service location exception servicelocationexception get error code geterrorcode service location exception servicelocationexception network error msg address mcast address reply message replymessage reply myips length create socket bound address inet address inetaddress add r addr inet address inetaddress get by name getbyname myips multicast socket multicastsocket socket multicast socket multicastsocket socket set interface setinterface add r addr socket set time to live settimetolive config getmcastttl setup receiver thread setupreceiverthread socket config get mcast max wait getmcastmaxwait msg multicast convergence algorithm total timeout totaltimeout system current time millis currenttimemillis config get mcast max wait getmcastmaxwait transmission schedule transmissionschedule slp core slpcore config get mcast time outs getmcasttimeouts retry counter retrycounter next timeout nexttimeout fail counter failcounter see n new seennew see n local response seenlocalresponse next timeout nexttimeout system current time millis currenttimemillis transmission schedule transmissionschedule retry counter retrycounter thread current thread currentthread is interrupted isinterrupted total timeout totaltimeout system current time millis currenttimemillis next timeout nexttimeout system current time millis currenttimemillis retry counter retrycounter transmission schedule transmissionschedule length fail counter failcounter config get convergence failer count getconvergencefailercount msg prev res p list prevresplist resp onders responders message msg get bytes getbytes finish convergence message size exe eds exeeds mtu message length config getmtu send message data gram packet datagrampacket data gram packet datagrampacket message message length inet address inetaddress get by name getbyname slp mcast address slp port socket send io exception ioexception ioe platform log trace message logtracemessage msg bug changed processing reply queue replyqueue richard reid figuring problem multicast replies prop osing proposing thread sleep transmission schedule transmissionschedule retry counter retrycounter interrupted exception interruptedexception dont care dontcare thread current thread currentthread int errupt interrupt reply queue replyqueue wake reply queue replyqueue is empty isempty fail counter failcounter next timeout nexttimeout system current time millis currenttimemillis transmission schedule transmissionschedule retry counter retrycounter reply queue replyqueue is empty isempty reply reply message replymessage reply queue replyqueue remove resp onders responders reply address get host address gethostaddress is local res ponder islocalresponder reply address see n local response seenlocalresponse see n local response seenlocalresponse see n new seennew resp onders responders add reply address get host address gethostaddress res ponses responses add all addall reply get result getresult see n new seennew fail counter failcounter see n new seennew next timeout nexttimeout system current time millis currenttimemillis transmission schedule transmissionschedule retry counter retrycounter remove listener queue reply listeners replylisteners reply listeners replylisteners remove queryxid platform log debug logdebug convergence xid msg xid finished system current time millis currenttimemillis start result res ponses responses res ponses responses io exception ioexception ioe platform log debug logdebug ioe get message getmessage ioe service location exception servicelocationexception service location exception servicelocationexception network error ioe get message getmessage is local res ponder islocalresponder inet address inetaddress add r addr slp core slpcore myips length add r addr get host address gethostaddress equals slp core slpcore myips setup receiver thread socket param socket code data gram socket datagramsocket code receiver thread param min life time minlifetime minimum lifetime receiver thread setup receiver thread setupreceiverthread data gram socket datagramsocket socket min life time minlifetime slp message slpmessage msg thread prepare empty data gram datagram receiving data gram packet datagrampacket packet bytes slp core slpcore config getmtu calculate lifetime timeout system current time millis currenttimemillis min life time minlifetime lifetime expired system current time millis currenttimemillis timeout socket timeout timeout system current time millis currenttimemillis so timeout sotimeout socket set so timeout setsotimeout so timeout sotimeout socket exception socketexception platform log error logerror exception mcast receiver thread packet data gram packet datagrampacket bytes bytes length receive data gram datagram packet socket receive packet interruptedioexception iioe io exception ioexception platform log debug logdebug get message getmessage data input stream datainputstream data input stream datainputstream byte array input stream bytearrayinputstream packet get data getdata delegate slp core slpcore handle message handlemessage slp message slpmessage parse packet get address getaddress packet get port getport protocol exception protocolexception msg address packet get address getaddress msg port packet get port getport msg multicast handle message handlemessage sendmessagetcp msg service location exception servicelocationexception service location exception servicelocationexception platform log debug logdebug get message getmessage close socket socket close start