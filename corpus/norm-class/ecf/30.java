copyright ibm rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors ibm corporation initial api implementation org eclipse ecf tests file transfer filetransfer java file java io exception ioexception java net url org apache commons http client httpclient server http request handler httprequesthandler org apache commons http client httpclient server response writer responsewriter org apache commons http client httpclient server simple http server simplehttpserver org apache commons http client httpclient server simple http server connection simplehttpserverconnection org apache commons http client httpclient server simple request simplerequest org eclipse core runtime jobs i job change event ijobchangeevent org eclipse ecf file transfer filetransfer file transfer job filetransferjob org eclipse ecf file transfer filetransfer i file transfer listener ifiletransferlistener org eclipse ecf file transfer filetransfer user cancelled exception usercancelledexception org eclipse ecf file transfer filetransfer events i file transfer connect start event ifiletransferconnectstartevent org eclipse ecf file transfer filetransfer events i incoming file transfer receive data event iincomingfiletransferreceivedataevent org eclipse ecf file transfer filetransfer events i incoming file transfer receive done event iincomingfiletransferreceivedoneevent org eclipse ecf file transfer filetransfer events i incoming file transfer receive start event iincomingfiletransferreceivestartevent org eclipse ecf file transfer filetransfer events socket i socket connected event isocketconnectedevent org eclipse ecf file transfer filetransfer events socket i socket event isocketevent org eclipse ecf file transfer filetransfer events socket i socket event source isocketeventsource org eclipse ecf file transfer filetransfer events socket i socket listener isocketlistener org eclipse ecf file transfer filetransfer identity i file d ifileid org eclipse ecf internal tests file transfer filetransfer https erver httpserver simple server simpleserver org eclipse ecf provider file transfer filetransfer retrieve abstract retrieve file transfer abstractretrievefiletransfer org eclipse ecf tests file transfer filetransfer socket event test util socketeventtestutil socket in read wrapper socketinreadwrapper org eclipse ecf tests file transfer filetransfer socket event test util socketeventtestutil track socket events tracksocketevents url retrieve test cancel connect job urlretrievetestcancelconnectjob abstract retrieve test case abstractretrievetestcase file tmp file tmpfile track socket events tracksocketevents socket events socketevents socket in read wrapper socketinreadwrapper socket in read wrapper socketinreadwrapper cancel supported connect system get property getproperty org eclipse ecf tests file transfer filetransfer cancel supported on connect cancelsupportedonconnect boolean value booleanvalue javadoc junit framework test case testcase set up setup set up setup exception set up setup create temp file createtempfile io exception ioexception tmp file tmpfile file create temp file createtempfile ecf test ecftest javadoc junit framework test case testcase tear down teardown tear down teardown exception tear down teardown tmp file tmpfile tmp file tmpfile delete tmp file tmpfile javadoc org eclipse ecf tests file transfer filetransfer abstract retrieve test case abstractretrievetestcase handle start connect event handlestartconnectevent org eclipse ecf file transfer filetransfer events i file transfer connect start event ifiletransferconnectstartevent handle start connect event handlestartconnectevent i file transfer connect start event ifiletransferconnectstartevent event handle start connect event handlestartconnectevent event socket events socketevents socket event test util socketeventtestutil observe socket events observesocketevents event i socket event source isocketeventsource source i socket event source isocketeventsource event get adapter getadapter i socket event source isocketeventsource source add listener addlistener i socket listener isocketlistener handle socket event handlesocketevent i socket event isocketevent event event i socket connected event isocketconnectedevent i socket connected event isocketconnectedevent connected event connectedevent i socket connected event isocketconnectedevent event socket in read wrapper socketinreadwrapper socket in read wrapper socketinreadwrapper connected event connectedevent get socket getsocket start time starttime connected event connectedevent set socket setsocket socket in read wrapper socketinreadwrapper handle done event handledoneevent i incoming file transfer receive done event iincomingfiletransferreceivedoneevent event handle done event handledoneevent event assert true asserttrue event get source getsource get exception getexception user cancelled exception usercancelledexception test receive testreceive string url i file transfer listener ifiletransferlistener listener exception assert not null assertnotnull retrieve adapter retrieveadapter i file d ifileid fileid create file d createfileid url url retrieve adapter retrieveadapter send retrieve request sendretrieverequest fileid listener wait for done waitfordone test receive file testreceivefile cancel on connect event cancelonconnectevent exception cancel supported connect trace warning cancel supported provider test receive file testreceivefile cancel on connect event cancelonconnectevent i file transfer listener ifiletransferlistener listener create file transfer listener createfiletransferlistener file transfer listener wrapper filetransferlistenerwrapper file transfer listener wrapper filetransferlistenerwrapper listener handle start connect event handlestartconnectevent i file transfer connect start event ifiletransferconnectstartevent event assert not null assertnotnull event get file d getfileid assert not null assertnotnull event get file d getfileid get file name getfilename assert null assertnull socket in read wrapper socketinreadwrapper set done setdone event cancel test receive testreceive url retrieve test urlretrievetest http retrieve assert has event asserthasevent start connect events startconnectevents i file transfer connect start event ifiletransferconnectstartevent assert has no event asserthasnoevent start events startevents i incoming file transfer receive start event iincomingfiletransferreceivestartevent assert has no event asserthasnoevent data events dataevents i incoming file transfer receive data event iincomingfiletransferreceivedataevent assert done cancelled assertdonecancelled assert null assertnull tmp file tmpfile socket events socketevents validate no socket created validatenosocketcreated todo add test cancel connect job server resp ond respond test receive file testreceivefile cancel connect job cancelconnectjob exception cancel supported connect trace warning cancel supported provider test receive file testreceivefile cancel connect job cancelconnectjob object do cancel docancel object i file transfer listener ifiletransferlistener listener create file transfer listener createfiletransferlistener file transfer listener wrapper filetransferlistenerwrapper file transfer listener wrapper filetransferlistenerwrapper listener handle start connect event handlestartconnectevent i file transfer connect start event ifiletransferconnectstartevent event assert not null assertnotnull event get file d getfileid assert not null assertnotnull event get file d getfileid get file name getfilename file transfer job filetransferjob connect job connectjob event prepare connect job prepareconnectjob connect job connectjob add job change listener addjobchangelistener job change trace listener jobchangetracelistener start time starttime running i job change event ijobchangeevent job event jobevent running job event jobevent spawn cancel thread spawncancelthread do cancel docancel i cancel able icancelable cancel assert not null assertnotnull socket in read wrapper socketinreadwrapper assert true asserttrue socket in read wrapper socketinreadwrapper in read inread event cancel event connect using job connectusingjob connect job connectjob simple server simpleserver server simple server simpleserver get name getname simple http server simplehttpserver simple server get simple http server getsimplehttpserver simple set request handler setrequesthandler http request handler httprequesthandler process request processrequest simple http server connection simplehttpserverconnection conn simple request simplerequest request io exception ioexception trace resp onding responding request request get request line getrequestline stalled in request handler stalledinrequesthandler do cancel docancel path matter server resp ond respond test receive testreceive server getserverurl foo assert has event asserthasevent start connect events startconnectevents i file transfer connect start event ifiletransferconnectstartevent assert has no event asserthasnoevent start events startevents i incoming file transfer receive start event iincomingfiletransferreceivestartevent assert has no event asserthasnoevent data events dataevents i incoming file transfer receive data event iincomingfiletransferreceivedataevent i incoming file transfer receive done event iincomingfiletransferreceivedoneevent done event doneevent get done event getdoneevent assert true asserttrue done event doneevent get exception getexception to string tostring done event doneevent get exception getexception user cancelled exception usercancelledexception assert true asserttrue done event doneevent get source getsource is done isdone assert same assertsame done event doneevent get exception getexception done event doneevent get source getsource get exception getexception assert null assertnull tmp file tmpfile assert false assertfalse socket in read wrapper socketinreadwrapper in read inread socket events socketevents validate one socket created and closed validateonesocketcreatedandclosed server shutdown write lines writelines response writer responsewriter string lines io exception ioexception lines length println lines test receive file testreceivefile cancel transfer job canceltransferjob exception cancel supported connect trace warning cancel supported provider test receive file testreceivefile cancel transfer job canceltransferjob object do cancel docancel object i file transfer listener ifiletransferlistener listener create file transfer listener createfiletransferlistener file transfer listener wrapper filetransferlistenerwrapper file transfer listener wrapper filetransferlistenerwrapper listener handle start connect event handlestartconnectevent i file transfer connect start event ifiletransferconnectstartevent event assert not null assertnotnull event get file d getfileid assert not null assertnotnull event get file d getfileid get file name getfilename file transfer job filetransferjob connect job connectjob event prepare connect job prepareconnectjob connect job connectjob add job change listener addjobchangelistener job change trace listener jobchangetracelistener start time starttime event connect using job connectusingjob connect job connectjob handle start event handlestartevent i incoming file transfer receive start event iincomingfiletransferreceivestartevent event spawn cancel thread spawncancelthread do cancel docancel i cancel able icancelable cancel wait for socket in read waitforsocketinread assert not null assertnotnull socket in read wrapper socketinreadwrapper assert true asserttrue socket in read wrapper socketinreadwrapper in read inread event cancel create temp file createtempfile event receive tmp file tmpfile io exception ioexception print stack trace printstacktrace fail to string tostring simple server simpleserver server simple server simpleserver get name getname simple http server simplehttpserver simple server get simple http server getsimplehttpserver simple set request handler setrequesthandler http request handler httprequesthandler process request processrequest simple http server connection simplehttpserverconnection conn simple request simplerequest request io exception ioexception trace res ponding responding request provide full body request get request line getrequestline response writer responsewriter conn get writer getwriter write lines writelines string http content length content type text plain charset utf flush do cancel docancel do cancel docancel conn set keep alive setkeepalive stalled in request handler stalledinrequesthandler do cancel docancel path matter server resp ond respond test receive testreceive server getserverurl foo assert has event asserthasevent start connect events startconnectevents i file transfer connect start event ifiletransferconnectstartevent assert has event asserthasevent start events startevents i incoming file transfer receive start event iincomingfiletransferreceivestartevent assert done cancelled assertdonecancelled assert not null assertnotnull tmp file tmpfile assert true asserttrue tmp file tmpfile exists assert equals assertequals tmp file tmpfile length assert false assertfalse socket in read wrapper socketinreadwrapper in read inread socket events socketevents validate one socket created and closed validateonesocketcreatedandclosed server shutdown wait for socket in read waitforsocketinread assert not null assertnotnull socket in read wrapper socketinreadwrapper socket in read wrapper socketinreadwrapper in read inread thread sleep interrupted exception interruptedexception assert true asserttrue socket in read wrapper socketinreadwrapper in read inread test receive file testreceivefile cancel transfer job after one block canceltransferjobafteroneblock exception cancel supported connect trace warning cancel supported provider test receive file testreceivefile cancel transfer job after one block canceltransferjobafteroneblock test receive file testreceivefile cancel transfer job in middle canceltransferjobinmiddle abstract retrieve file transfer abstractretrievefiletransfer buf length test receive file testreceivefile cancel transfer job in middle canceltransferjobinmiddle exception cancel supported connect trace warning cancel supported provider test receive file testreceivefile cancel transfer job in middle canceltransferjobinmiddle test receive file testreceivefile cancel transfer job in middle canceltransferjobinmiddle test receive file testreceivefile cancel transfer job in middle canceltransferjobinmiddle len expected socket in read expectedsocketinread exception cancel supported connect trace warning cancel supported provider test receive file testreceivefile cancel transfer job in middle canceltransferjobinmiddle object do cancel docancel object i file transfer listener ifiletransferlistener listener create file transfer listener createfiletransferlistener file transfer listener wrapper filetransferlistenerwrapper file transfer listener wrapper filetransferlistenerwrapper listener handle start connect event handlestartconnectevent i file transfer connect start event ifiletransferconnectstartevent event assert not null assertnotnull event get file d getfileid assert not null assertnotnull event get file d getfileid get file name getfilename file transfer job filetransferjob connect job connectjob event prepare connect job prepareconnectjob connect job connectjob add job change listener addjobchangelistener job change trace listener jobchangetracelistener start time starttime event connect using job connectusingjob connect job connectjob handle start event handlestartevent i incoming file transfer receive start event iincomingfiletransferreceivestartevent event spawn cancel thread spawncancelthread do cancel docancel i cancel able icancelable cancel expected socket in read expectedsocketinread wait for socket in read waitforsocketinread event cancel create temp file createtempfile event receive tmp file tmpfile io exception ioexception print stack trace printstacktrace fail to string tostring simple server simpleserver server simple server simpleserver get name getname simple http server simplehttpserver simple server get simple http server getsimplehttpserver simple set request handler setrequesthandler http request handler httprequesthandler process request processrequest simple http server connection simplehttpserverconnection conn simple request simplerequest request io exception ioexception trace res ponding responding request provide body request get request line getrequestline response writer responsewriter conn get writer getwriter write lines writelines string http content length len content type text plain charset utf flush len write flush conn set keep alive setkeepalive bit time receive data thread sleep interrupted exception interruptedexception stalled in request handler stalledinrequesthandler do cancel docancel path matter server resp ond respond test receive testreceive server getserverurl foo assert has event asserthasevent start connect events startconnectevents i file transfer connect start event ifiletransferconnectstartevent assert has event asserthasevent start events startevents i incoming file transfer receive start event iincomingfiletransferreceivestartevent assert has more than event count asserthasmorethaneventcount data events dataevents i incoming file transfer receive data event iincomingfiletransferreceivedataevent assert done cancelled assertdonecancelled assert not null assertnotnull tmp file tmpfile assert true asserttrue tmp file tmpfile exists assert equals assertequals len tmp file tmpfile length assert false assertfalse socket in read wrapper socketinreadwrapper in read inread socket events socketevents validate one socket created and closed validateonesocketcreatedandclosed server shutdown stalled in request handler stalledinrequesthandler object do cancel docancel exception do cancel docancel do cancel docancel do cancel docancel wait interrupted exception interruptedexception trace leaving request handler assert true asserttrue interrupted exception interruptedexception i cancel able icancelable cancel spawn cancel thread spawncancelthread object do cancel docancel i cancel able icancelable cancel able cancelable thread thread runnable trace cancel runnable started cancel do cancel docancel cancel do cancel docancel cancel trace calling cancel cancel able cancelable cancel trace calling cancel thread sleep interrupted exception interruptedexception trace cancel runnable start