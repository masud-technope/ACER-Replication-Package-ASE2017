rights reserved licensed apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org jivesoftware smackx bytes treams bytestreams socks java io exception ioexception java net socket java util array list arraylist java util collections java util hash map hashmap java util iterator java util linked list linkedlist java util list java util map java util random java util concurrent concurrent hash map concurrenthashmap java util concurrent timeout exception timeoutexception org jivesoftware smack abstract connection listener abstractconnectionlistener org jivesoftware smack connection org jivesoftware smack connection creation listener connectioncreationlistener org jivesoftware smack xmpp exception xmppexception org jivesoftware smack packet org jivesoftware smack packet packet org jivesoftware smack packet xmpp error xmpperror org jivesoftware smack util sync packet send syncpacketsend org jivesoftware smackx service discovery manager servicediscoverymanager org jivesoftware smackx bytes treams bytestreams bytestream listener bytestreamlistener org jivesoftware smackx bytes treams bytestreams bytestream manager bytestreammanager org jivesoftware smackx bytes treams bytestreams socks packet bytestream org jivesoftware smackx bytes treams bytestreams socks packet bytestream stream host streamhost org jivesoftware smackx bytes treams bytestreams socks packet bytestream stream host used streamhostused org jivesoftware smackx file transfer filetransfer file transfer manager filetransfermanager org jivesoftware smackx packet discover info discoverinfo org jivesoftware smackx packet discover items discoveritems org jivesoftware smackx packet discover info discoverinfo identity org jivesoftware smackx packet discover items discoveritems item socks bytestream manager bytestreammanager handles establishing socks bytes treams bytestreams href http xmpp org extensions xep html xep socks bytestream negotiated partly xmpp xml stream partly separate socket actual transfer takes place sep arately separately created socket socks bytestream gen erally generally part ies parties initiator target stream host stream host special ized specialized socks proxy setup server initiator stream host establish socks bytestream invoke link establish session establishsession string method negotiate socks bytestream target jid socket session socks bytestream negotiated negotiating file transfer invoke link establish session establishsession string string handle incoming socks bytestream requests add link socks bytestream listener bytestreamlistener manager ways add listener info rmed informed incoming socks bytes treams bytestreams specific user add listener invoking link add incoming bytestream listener addincomingbytestreamlistener bytestream listener bytestreamlistener string listener resp ond respond socks bytestream requests invoke link add incoming bytestream listener addincomingbytestreamlistener bytestream listener bytestreamlistener note registered link socks bytestream listener bytestreamlistener not ified notified incoming socks byte stream bytestream requests context href http xmpp org extensions xep html xep file transfer link file transfer manager filetransfermanager link socks bytestream listener bytestreamlistener registered incoming socks bytestream requests rejected returning acceptable error initiator author henning s tai b staib socks bytestream manager bytestreammanager bytestream manager bytestreammanager create socks bytestream manager bytestreammanager register shutdown listener established connection connection add connection creation listener addconnectioncreationlistener connection creation listener connectioncreationlistener connection created connectioncreated connection connection socks bytestream manager bytestreammanager manager manager socks bytestream manager bytestreammanager get bytestream manager getbytestreammanager connection register shutdown listener connection add connection listener addconnectionlistener abstract connection listener abstractconnectionlistener connection closed connectionclosed manager disable service disableservice xmpp namespace socks bytestream string name space namespace http jabber org protocol bytes treams bytestreams prefix generate session id s ids string session prefix random generator create session id s ids random random generator randomgenerator random stores socks bytestream manager bytestreammanager xmpp connection map connection socks bytestream manager bytestreammanager managers hash map hashmap connection socks bytestream manager bytestreammanager xmpp connection connection connection assigns user listener info rmed informed byte stream bytestream request user received map string bytestream listener bytestreamlistener user listeners userlisteners concurrent hash map concurrenthashmap string bytestream listener bytestreamlistener list listeners resp ond respond byte stream bytestream requests user specific listeners request list bytestream listener bytestreamlistener all request listeners allrequestlisteners collections synchronized list synchronizedlist linked list linkedlist bytestream listener bytestreamlistener listener handles incoming byte stream bytestream requests init iation listener initiationlistener initiation listener initiationlistener timeout wait response socks bytestream initialization request target response timeout targetresponsetimeout timeout connecting socks proxy selected target proxy connection timeout proxyconnectiontimeout blacklist error nous errornous socks proxies list string proxy blacklist proxyblacklist collections synchronized list synchronizedlist linked list linkedlist string remember proxy worked prioritize string last working proxy lastworkingproxy flag enable disable prioritization working proxy proxy prioritization enabled proxyprioritizationenabled list session id s ids socks bytestream initialization pack ets packets init iation listener initiationlistener list string ignored bytestream requests ignoredbytestreamrequests collections synchronized list synchronizedlist linked list linkedlist string returns socks bytestream manager bytestreammanager handle socks bytes treams bytestreams link connection manager exists created initialized param connection xmpp connection code code connection code code socks bytestream manager bytestreammanager xmpp connection socks bytestream manager bytestreammanager get bytestream manager getbytestreammanager connection connection connection socks bytestream manager bytestreammanager manager managers connection manager manager socks bytestream manager bytestreammanager connection managers connection manager manager activate manager constructor param connection xmpp connection socks bytestream manager bytestreammanager connection connection connection connection initiation listener initiationlistener init iation listener initiationlistener adds bytestream listener bytestreamlistener called incoming socks bytestream request user specific bytestream listener bytestreamlistener registered listeners registered socks bytestream request rejected acceptable error note registered link bytestream listener bytestreamlistener not ified notified incoming socks byte stream bytestream requests context href http xmpp org extensions xep html xep file transfer link file transfer manager filetransfermanager param listener listener register add incoming bytestream listener addincomingbytestreamlistener bytestream listener bytestreamlistener listener all request listeners allrequestlisteners add listener removes listener list listeners incoming socks bytestream requests param listener listener remove remove incoming bytestream listener removeincomingbytestreamlistener bytestream listener bytestreamlistener listener all request listeners allrequestlisteners remove listener adds bytestream listener bytestreamlistener called incoming socks bytestream request user method awaiting incoming socks bytestream request specific user listeners registered socks bytestream request rejected acceptable error note registered link bytestream listener bytestreamlistener not ified notified incoming socks byte stream bytestream requests context href http xmpp org extensions xep html xep file transfer link file transfer manager filetransfermanager param listener listener register param initiatorjid jid user establish socks bytestream add incoming bytestream listener addincomingbytestreamlistener bytestream listener bytestreamlistener listener string initiatorjid user listeners userlisteners initiatorjid listener removes listener user param initiatorjid jid user listener removed remove incoming bytestream listener removeincomingbytestreamlistener string initiatorjid user listeners userlisteners remove initiatorjid method ignore incoming socks bytestream request session listeners not ified notified request error returned initiator method awaiting socks bytestream request reply packet file transfer param sessionid ignore bytestream request once ignorebytestreamrequestonce string sessionid ignored bytestream requests ignoredbytestreamrequests add sessionid d isables disables socks bytestream manager removing socks bytestream feature service discovery disabling listener socks bytestream initiation requests reset ting resetting internal enable socks bytestream feature invoke link get bytestream manager getbytestreammanager connection file transfer api automatically enable socks bytestream feature disable service disableservice remove initiation packet listener connection remove packet listener removepacketlistener initiation listener initiationlistener shutdown threads initiation listener initiationlistener shutdown clear listeners all request listeners allrequestlisteners clear user listeners userlisteners clear reset internal last working proxy lastworkingproxy proxy blacklist proxyblacklist clear ignored bytestream requests ignoredbytestreamrequests clear remove manager managers map managers remove connection shutdown local socks proxy managers connections managers size socks proxy get socks getsocks proxy remove feature service discovery service discovery manager servicediscoverymanager service discovery manager servicediscoverymanager service discovery manager servicediscoverymanager get instance for getinstancefor connection check service discovery disposed connection shutdown service discovery manager servicediscoverymanager service discovery manager servicediscoverymanager remove feature removefeature name space namespace returns timeout wait response socks bytestream initialization request timeout wait response socks bytestream initialization request get target response timeout gettargetresponsetimeout target response timeout targetresponsetimeout target response timeout targetresponsetimeout target response timeout targetresponsetimeout sets timeout wait response socks bytestream initialization request param target response timeout targetresponsetimeout timeout set target response timeout settargetresponsetimeout target response timeout targetresponsetimeout target response timeout targetresponsetimeout target response timeout targetresponsetimeout returns timeout connecting socks proxy selected target timeout connecting socks proxy selected target get proxy connection timeout getproxyconnectiontimeout proxy connection timeout proxyconnectiontimeout proxy connection timeout proxyconnectiontimeout proxy connection timeout proxyconnectiontimeout sets timeout connecting socks proxy selected target param proxy connection timeout proxyconnectiontimeout timeout set proxy connection timeout setproxyconnectiontimeout proxy connection timeout proxyconnectiontimeout proxy connection timeout proxyconnectiontimeout proxy connection timeout proxyconnectiontimeout returns prioritization working socks proxy successive socks bytestream connections enabled code code code code prioritization enabled code code is proxy prioritization enabled isproxyprioritizationenabled proxy prioritization enabled proxyprioritizationenabled enable disable prioritization working socks proxy successive socks bytestream connections param proxy prioritization enabled proxyprioritizationenabled enable disable prioritization working socks proxy set proxy prioritization enabled setproxyprioritizationenabled proxy prioritization enabled proxyprioritizationenabled proxy prioritization enabled proxyprioritizationenabled proxy prioritization enabled proxyprioritizationenabled establishes socks bytestream user returns socket send receive data user method establish socks bytes treams bytestreams users accepting incoming socks byte stream bytestream requests method doesn provide user data establish socks bytestream negotiation kind data file transfer link establish session establishsession string string param targetjid jid user socks bytestream established socket send receive data user xmpp exception xmppexception user doesn support accept socks bytes treams bytestreams socks proxy user could n couldn connect socks proxies io exception ioexception byte stream bytestream established interrupted exception interruptedexception current thread int errupted interrupted waiting socks bytestream session bytestreamsession establish session establishsession string targetjid xmpp exception xmppexception io exception ioexception interrupted exception interruptedexception string sessionid get next session d getnextsessionid establish session establishsession targetjid sessionid establishes socks bytestream user session returns socket send receive data user param targetjid jid user socks bytestream established param sessionid session socks bytestream request socket send receive data user xmpp exception xmppexception user doesn support accept socks bytes treams bytestreams socks proxy user could n couldn connect socks proxies io exception ioexception byte stream bytestream established interrupted exception interruptedexception current thread int errupted interrupted waiting socks bytestream session bytestreamsession establish session establishsession string targetjid string sessionid xmpp exception xmppexception io exception ioexception interrupted exception interruptedexception xmpp exception xmppexception discovery exception discoveryexception check target supports socks bytestream supports socks supportssocks targetjid xmpp exception xmppexception targetjid doesn support socks bytestream list string proxies array list arraylist string determine socks proxies xmpp server proxies add all addall determine proxies determineproxies xmpp exception xmppexception discovery exception discoveryexception determine address port proxy list stream host streamhost stream hosts streamhosts determine stream host infos determinestreamhostinfos proxies stream hosts streamhosts is empty isempty discovery exception discoveryexception discovery exception discoveryexception xmpp exception xmppexception socks proxies compute digest string digest socks utils create digest createdigest sessionid connection get user getuser targetjid prioritize working socks proxy exists proxy prioritization enabled proxyprioritizationenabled last working proxy lastworkingproxy stream host streamhost selected stream host selectedstreamhost stream host streamhost stream host streamhost stream hosts streamhosts stream host streamhost getjid equals last working proxy lastworkingproxy selected stream host selectedstreamhost stream host streamhost selected stream host selectedstreamhost stream hosts streamhosts remove selected stream host selectedstreamhost stream hosts streamhosts add selected stream host selectedstreamhost socks proxy socks proxy socks proxy get socks getsocks proxy add transfer digest local proxy transfer valid socks proxy add transfer addtransfer digest create initiation packet bytestream initiation create bytestream init iation createbytestreaminitiation sessionid targetjid stream hosts streamhosts send initiation packet packet response sync packet send syncpacketsend get reply getreply connection initiation get target response timeout gettargetresponsetimeout extract stream host response stream host used streamhostused stream host used streamhostused bytestream response get used host getusedhost stream host streamhost used stream host usedstreamhost initiation get stream host getstreamhost stream host used streamhostused getjid used stream host usedstreamhost xmpp exception xmppexception remote user resp onded responded unknown host build socks client socks client socks client socks client for init iator clientforinitiator used stream host usedstreamhost digest connection sessionid targetjid establish connection proxy socket socket socks client get socket getsocket get proxy connection timeout getproxyconnectiontimeout remember working socks proxy prioritize request last working proxy lastworkingproxy used stream host usedstreamhost getjid negotiation successful output stream socks bytestream session bytestreamsession socket used stream host usedstreamhost getjid equals connection get user getuser timeout exception timeoutexception io exception ioexception timeout connecting socks proxy remove transfer digest output stream returned exception occurred socks proxy remove transfer removetransfer digest returns code code target jid supports feature socks bytestream param targetjid target jid code code target jid supports feature socks bytestream code code xmpp exception xmppexception error querying target supported features supports socks supportssocks string targetjid xmpp exception xmppexception service discovery manager servicediscoverymanager service discovery manager servicediscoverymanager service discovery manager servicediscoverymanager get instance for getinstancefor connection discover info discoverinfo discover info discoverinfo service discovery manager servicediscoverymanager discover info discoverinfo targetjid discover info discoverinfo contains feature containsfeature name space namespace returns list jid s jids socks proxies querying xmpp server socks proxies order returned xmpp server list jid s jids socks proxies xmpp exception xmppexception error querying xmpp server socks proxies list string determine proxies determineproxies xmpp exception xmppexception service discovery manager servicediscoverymanager service discovery manager servicediscoverymanager service discovery manager servicediscoverymanager get instance for getinstancefor connection list string proxies array list arraylist string items form xmpp server discover items discoveritems discover items discoveritems service discovery manager servicediscoverymanager discover items discoveritems connection get service name getservicename iterator item item iterator itemiterator discover items discoveritems get items getitems query items socks proxies item iterator itemiterator has next hasnext item item item iterator itemiterator skip black listed blacklisted servers proxy blacklist proxyblacklist item get entity d getentityid discover info discoverinfo proxy info proxyinfo proxy info proxyinfo service discovery manager servicediscoverymanager discover info discoverinfo item get entity d getentityid iterator identity ide ntities identities proxy info proxyinfo get ident ities getidentities item category proxy type byte stream bytestream ide ntities identities has next hasnext identity identity ide ntities identities proxy equals ignore case equalsignorecase identity get category getcategory bytes treams bytestreams equals ignore case equalsignorecase identity get type gettype proxies add item get entity d getentityid server socks proxy blacklist server skip time socks byte stream bytestream established proxy blacklist proxyblacklist add item get entity d getentityid xmpp exception xmppexception proxy blacklist proxyblacklist add item get entity d getentityid proxies returns list stream hosts address port list socks proxy jid s jids order returned list list jid s jids excluding socks proxies net work network settings determined local socks proxy running item list returned param proxies list socks proxy jid s jids list stream hosts address port list stream host streamhost determine stream host infos determinestreamhostinfos list string proxies list stream host streamhost stream hosts streamhosts array list arraylist stream host streamhost add local proxy position exists list stream host streamhost local proxies localproxies get local stream host getlocalstreamhost local proxies localproxies stream hosts streamhosts add all addall local proxies localproxies query socks proxies net work network settings string proxy proxies bytestream stream host request streamhostrequest create stream host request createstreamhostrequest proxy bytestream response bytestream sync packet send syncpacketsend get reply getreply connection stream host request streamhostrequest stream hosts streamhosts add all addall response get stream hosts getstreamhosts xmpp exception xmppexception proxy blacklist proxyblacklist add proxy stream hosts streamhosts returns packet query socks proxy net work network settings param proxy proxy query packet query socks proxy net work network settings bytestream create stream host request createstreamhostrequest string proxy bytestream request bytestream request set type settype type request set to setto proxy request returns stream host local socks proxy address port local socks proxy running stream host local socks proxy local socks proxy running list stream host streamhost get local stream host getlocalstreamhost local proxy singleton socks proxy socks server socks proxy get socks getsocks proxy socks server is running isrunning list string add res ses addresses socks server get local addr esses getlocaladdresses port socks server get port getport add res ses addresses size list stream host streamhost stream hosts streamhosts array list arraylist stream host streamhost string address add res ses addresses stream host streamhost stream host streamhost stream host streamhost connection get user getuser address stream host streamhost set port setport port stream hosts streamhosts add stream host streamhost stream hosts streamhosts server running local address determined returns socks bytestream initialization request packet session stream hosts target jid param sessionid session socks bytestream param targetjid target jid socks bytestream request param stream hosts streamhosts list socks proxies target connect socks bytestream initialization request packet bytestream create bytestream init iation createbytestreaminitiation string sessionid string targetjid list stream host streamhost stream hosts streamhosts bytestream initiation bytestream sessionid add stream hosts stream host streamhost stream host streamhost stream hosts streamhosts initiation add stream host addstreamhost stream host streamhost initiation set type settype type initiation set to setto targetjid initiation res ponses responses packet sender xmpp error socks bytestream accepted param packet packet answered acceptable error reply reject packet replyrejectpacket packet xmpp error xmpperror xmpp error xmpperror xmpp error xmpperror xmpp error xmpperror condition acceptable erroriq create error response createerrorresponse packet xmpp error xmpperror connection send packet sendpacket erroriq activates socks bytestream manager bytestreammanager registering socks bytestream initialization listener enabling socks bytestream feature activate register byte stream bytestream initiation packet listener connection add packet listener addpacketlistener initiation listener initiationlistener initiation listener initiationlistener get filter getfilter enable socks feature enable service enableservice adds socks bytestream feature service discovery enable service enableservice service discovery manager servicediscoverymanager manager service discovery manager servicediscoverymanager get instance for getinstancefor connection manager includes feature includesfeature name space namespace manager add feature addfeature name space namespace returns unique session unique session string get next session d getnextsessionid string builder stringbuilder buffer string builder stringbuilder buffer append session prefix buffer append math abs random generator randomgenerator next long nextlong buffer to string tostring returns xmpp connection xmpp connection connection get connection getconnection connection returns link bytestream listener bytestreamlistener info rmed informed socks bytestream request initiator jid received param initiator initiator jid listener bytestream listener bytestreamlistener get user listener getuserlistener string initiator user listeners userlisteners initiator returns list link bytestream listener bytestreamlistener info rmed informed listeners specific initiator list listeners list bytestream listener bytestreamlistener get all request listeners getallrequestlisteners all request listeners allrequestlisteners returns list session id s ids init ialtion listener initialtionlistener list session id s ids list string get ignored bytestream requests getignoredbytestreamrequests ignored bytestream requests ignoredbytestreamrequests