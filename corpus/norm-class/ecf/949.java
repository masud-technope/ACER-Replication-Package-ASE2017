copyright remy chi jian suen rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors remy chi jian suen initial api implementation org eclipse ecf provider datashare nio java byte array input stream bytearrayinputstream java io exception ioexception java object input stream objectinputstream java net socket address socketaddress java nio byte buffer bytebuffer java nio channels socket channel socketchannel java util array list arraylist java util hash map hashmap java util iterator java util linked list linkedlist java util list java util map org eclipse core runtime org eclipse core runtime i safe runnable isaferunnable org eclipse core runtime i status istatus org eclipse core runtime listener list listenerlist org eclipse core runtime safe runner saferunner org eclipse core runtime status org eclipse ecf core i container icontainer org eclipse ecf core i container listener icontainerlistener org eclipse ecf core events i container connected event icontainerconnectedevent org eclipse ecf core events i container disconnected event icontainerdisconnectedevent org eclipse ecf core events i container dispose event icontainerdisposeevent org eclipse ecf core events i container event icontainerevent org eclipse ecf core identity org eclipse ecf core util ecf exception ecfexception org eclipse ecf datashare i channel ichannel org eclipse ecf datashare i channel config ichannelconfig org eclipse ecf datashare i channel container adapter ichannelcontaineradapter org eclipse ecf datashare i channel container listener ichannelcontainerlistener org eclipse ecf datashare i channel listener ichannellistener org eclipse ecf datashare events i channel container channel activated event ichannelcontainerchannelactivatedevent org eclipse ecf datashare events i channel container channel deactivated event ichannelcontainerchanneldeactivatedevent org eclipse ecf datashare events i channel container event ichannelcontainerevent datashare channel container implementation creates channels nio sending receiving messages channel container facilitates communication socket level link nio channel niochannel request received remote peer establish channel connection request honoured calling link enqueue socket address socketaddress method remote peer socket address parameter subclasses implement channel creation link createniochannel i channel listener ichannellistener map link createniochannel i channel config ichannelconfig facilitate logging stat uses statuses link log i status istatus note int erim interim api dev elopment development expected change reaching stability early stage solicit feedback pioneering adopters under standin g understanding code api broken repeatedly api evolves nio d atashare container niodatasharecontainer i channel container adapter ichannelcontaineradapter thread establishing connection remote clients thread connection thread connectionthread list add res ses addresses connected linked list linkedlist pending connections pendingconnections list socket channels processed hand shaking handshaking remote peer list pending sockets pendingsockets map datashare channels owned container mapped ids map channels parent container datashare container i container icontainer container list i channel container listeners ichannelcontainerlisteners attached datashare container listener list listenerlist listener list listenerlist ins tantiates instantiates datashare container connect remote clients nio functionality param container parent container datashare container code code nio d atashare container niodatasharecontainer i container icontainer container nls is not null isnotnull container container container container container add listener addlistener i container listener icontainerlistener handle event handleevent i container event icontainerevent event event i container connected event icontainerconnectedevent i container connected event icontainerconnectedevent event get target d gettargetid fire channel connected event firechannelconnectedevent event i container disconnected event icontainerdisconnectedevent i container disconnected event icontainerdisconnectedevent event get target d gettargetid fire channel disconnected event firechanneldisconnectedevent disconnect event i container dispose event icontainerdisposeevent invoke disconnect disconnect ion disconnection event fired disconnect channels hash map hashmap pending connections pendingconnections linked list linkedlist pending sockets pendingsockets array list arraylist listener list listenerlist listener list listenerlist fires channel connected event channel container channels not ifying notifying parent container connected target param container target id containertargetid target parent container connected fire channel connected event firechannelconnectedevent container target id containertargetid channels iterator channels values iterator has next hasnext nio channel niochannel channel nio channel niochannel channel fire channel connect event firechannelconnectevent container target id containertargetid fires channel disconnected event channel container channels not ifying notifying parent container disconnected target param container target id containertargetid target parent container disconnected fire channel disconnected event firechanneldisconnectedevent channels iterator channels values iterator has next hasnext nio channel niochannel channel nio channel niochannel channel fire channel disconnect event firechanneldisconnectevent not ifies notifies listener event param listener listener notify param event event notify listener fire channel container event firechannelcontainerevent i channel container listener ichannelcontainerlistener listener i channel container event ichannelcontainerevent event safe runner saferunner send not ification notification ensure client side failures channel die safe runner saferunner i safe runnable isaferunnable exception listener handle channel container event handlechannelcontainerevent event handle exception handleexception throwable log status i status istatus error util plugin error handling channel container event fire channel container activated event firechannelcontaineractivatedevent channel id channelid object listeners listener list listenerlist get listeners getlisteners listeners length i channel container listener ichannelcontainerlistener listener i channel container listener ichannelcontainerlistener listeners fire channel container event firechannelcontainerevent listener i channel container channel activated event ichannelcontainerchannelactivatedevent get channel d getchannelid channel id channelid get channel container d getchannelcontainerid container getid string to string tostring string buffer stringbuffer buffer string buffer stringbuffer buffer append i channel container channel activated event ichannelcontainerchannelactivatedevent nls buffer append nls container append container getid nls buffer append channel append nls channel id channelid buffer append buffer to string tostring fire channel container deactivated event firechannelcontainerdeactivatedevent channel id channelid object listeners listener list listenerlist get listeners getlisteners listeners length i channel container listener ichannelcontainerlistener listener i channel container listener ichannelcontainerlistener listeners fire channel container event firechannelcontainerevent listener i channel container channel deactivated event ichannelcontainerchanneldeactivatedevent get channel d getchannelid channel id channelid get channel container d getchannelcontainerid container getid string to string tostring string buffer stringbuffer buffer string buffer stringbuffer buffer append i channel container channel deactivated event ichannelcontainerchanneldeactivatedevent nls buffer append nls container append container getid nls buffer append channel append nls channel id channelid buffer append buffer to string tostring log i status istatus status stores channel based container param channel channel store store channel storechannel i channel ichannel channel channels channel getid channel disconnect connection thread connectionthread connection thread connectionthread int errupt interrupt connection thread connectionthread pending connections pendingconnections pending connections pendingconnections clear pending sockets pendingsockets pending sockets pendingsockets size socket channel socketchannel channel socket channel socketchannel pending sockets pendingsockets util close channel closechannel channel pending sockets pendingsockets clear channels iterator channels values iterator has next hasnext i channel ichannel channel i channel ichannel dispose channel safe runner saferunner exceptions don prevent disposing channels safe runner saferunner i safe runnable isaferunnable exception channel dispose handle exception handleexception throwable log status i status istatus error util plugin error disposing channel channel channels clear attempts connect remote address enqueue d enqueued channel container processing link enqueue socket address socketaddress method param buffer buffer reading writing data io exception ioexception error occurs attempting contact peer connect byte buffer bytebuffer buffer io exception ioexception pending connections pendingconnections is empty isempty retrieve address connect socket address socketaddress remote socket address socketaddress pending connections pendingconnections remove first removefirst open socket channel remote address socket channel socketchannel socket channel socketchannel socket channel socketchannel open remote bytes util serialize container get connected d getconnectedid bytes serialization failed close socket util close channel closechannel socket channel socketchannel socket channel socketchannel configure blocking configureblocking util write socket channel socketchannel buffer bytes pending sockets pendingsockets add socket channel socketchannel enqueues address connected invoked request received remote user param address address connect code code nio channel niochannel send request sendrequest enqueue socket address socketaddress address nls is not null isnotnull address socket address connection thread connectionthread connection thread connectionthread thread connection runnable connectionrunnable get class getclass get name getname thread nls container getid to string tostring connection thread connectionthread start pending connections pendingconnections add address performs handshake operation remote peer param socket channel socketchannel socket channel handshake param data data channel class not found exception classnotfoundexception deserialization error occurs io exception ioexception error occurs reading writing data handshake socket channel socketchannel socket channel socketchannel channel data channeldata data class not found exception classnotfoundexception io exception ioexception retrieve data message data get data getdata read response byte array input stream bytearrayinputstream bais byte array input stream bytearrayinputstream message object input stream objectinputstream ois object input stream objectinputstream bais response channel channel id channelid ois read object readobject channels retrieve channel corresponds i channel ichannel channel get channel getchannel channel id channelid channel find channel corresponds close socket util close channel closechannel socket channel socketchannel open object input stream objectinputstream object serialized sep arately separately ois object input stream objectinputstream bais remote user peer id peerid ois read object readobject store peer socket retrieved nio channel nio channel niochannel datashare nio channel niochannel channel datashare peer id peerid socket channel socketchannel check bytes left read bais extra bytes data sender process messages received copy remaining system arraycopy message message length received process received data datashare process incoming message processincomingmessage socket channel socketchannel received processes pending sockets queue d queued channel container waiting init iate initiate handshake process remote peer param buffer buffer reading writing data class not found exception classnotfoundexception serialization deserialization operation encountered errors io exception ioexception error occurs reading writing data process pending sockets processpendingsockets byte buffer bytebuffer buffer class not found exception classnotfoundexception io exception ioexception pending sockets pendingsockets size socket channel socketchannel socket channel socketchannel socket channel socketchannel pending sockets pendingsockets buffer clear read response channel data channeldata data util read socket channel socketchannel buffer data is open isopen channel isn open close util close channel closechannel socket channel socketchannel remove channel pending sockets pendingsockets remove data get data getdata handshake socket channel socketchannel data socket processed remove pending sockets pendingsockets remove creates nio capable channel container param channel id channelid channel code code param listener listener receiving not ifications notifications per tai ning pertaining created channel code code listener not ified notified param properties map properties provide channel code code created nio channel niochannel instance ecf exception ecfexception error occurred creating channel create channel createchannel i channel listener ichannellistener map nio channel niochannel createniochannel channel id channelid i channel listener ichannellistener listener map properties ecf exception ecfexception creates nio capable channel container param new channel config newchannelconfig configuration newly created channel code code created nio channel niochannel instance ecf exception ecfexception error occurred creating channel create channel createchannel i channel config ichannelconfig nio channel niochannel createniochannel i channel config ichannelconfig new channel config newchannelconfig ecf exception ecfexception i channel ichannel create channel createchannel channel id channelid i channel listener ichannellistener listener map properties ecf exception ecfexception nls is not null isnotnull channel id channelid channel i channel ichannel channel createniochannel channel id channelid listener properties channel store channel storechannel channel fire channel container activated event firechannelcontaineractivatedevent channel id channelid channel i channel ichannel create channel createchannel i channel config ichannelconfig new channel config newchannelconfig ecf exception ecfexception nls is not null isnotnull new channel config newchannelconfig channel config is not null isnotnull new channel config newchannelconfig getid nls channel config i channel ichannel channel createniochannel new channel config newchannelconfig channel store channel storechannel channel fire channel container activated event firechannelcontaineractivatedevent new channel config newchannelconfig getid channel add listener addlistener i channel container listener ichannelcontainerlistener listener listener list listenerlist add listener i channel ichannel get channel getchannel channel id channelid nls is not null isnotnull channel id channelid channel i channel ichannel channels channel id channelid remove channel removechannel channel id channelid i channel ichannel channel i channel ichannel channels remove channel id channelid channel channel dispose remove listener removelistener i channel container listener ichannelcontainerlistener listener listener list listenerlist remove listener object get adapter getadapter adapter adapter adapter is instance isinstance adapter i container icontainer container string to string tostring string buffer stringbuffer buffer string buffer stringbuffer get class getclass get name getname nls buffer append parent container parentcontainer append container append buffer to string tostring connection runnable connectionrunnable runnable byte buffer bytebuffer buffer byte buffer bytebuffer all ocate allocate buffer clear thread current thread currentthread is interrupted isinterrupted pending connections pendingconnections pending connections pendingconnections is empty isempty connect buffer process pending sockets processpendingsockets buffer thread sleep interrupted exception interruptedexception thread int errupted interrupted class not found exception classnotfoundexception log status i status istatus error util plugin deserialize io exception ioexception log status i status istatus error util plugin error occurred runtime exception runtimeexception log status i status istatus error util plugin runtime error occurred