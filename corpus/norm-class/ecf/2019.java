rights reserved licensed apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org jivesoftware smack x smackx bytes treams bytestreams socks java data input stream datainputstream java data output stream dataoutputstream java io exception ioexception java net inet address inetaddress java net server socket serversocket java net socket java net socket exception socketexception java net unknown host exception unknownhostexception java util array list arraylist java util collections java util linked hash set linkedhashset java util linked list linkedlist java util list java util map java util java util concurrent concurrent hash map concurrenthashmap org jivesoftware smack smack configuration smackconfiguration org jivesoftware smack xmpp exception xmppexception socks proxy represents local socks proxy server enabled disabled setting code local socks localsocks proxy enabled proxyenabled code flag code smack config xml code invoking link smack configuration smackconfiguration set local socks setlocalsocks proxy enabled proxyenabled proxy enabled port local socks proxy configured setting code local socks localsocks proxy port proxyport code code smack config xml code invoking link smack configuration smackconfiguration set local socks setlocalsocks proxy port proxyport port port negative smack absolute finds open port application running machine multiple network interfaces provide address nat router invoke link add local address addlocaladdress string link replace local add res ses replacelocaladdresses list modify list local network add resses addresses out going outgoing socks bytes tream bytestream requests local socks proxy server ref uses refuses connections explicitly allowed process establishing socks bytes tream bytestream link socks bytes tream manager bytestreammanager establish session establishsession string implementation limitations supports authentication authentication method supports code connect code command answer correctly commands supports requests domain address type correctly answer requests address types href http tools ietf org html rfc rfc author henning s tai b staib socks proxy socks proxy singleton socks proxy socks server reusable implementation socks proxy server process socks server process serverprocess server process serverprocess thread running socks server process thread server thread serverthread server socket accept socks connections server socket serversocket server socket serversocket assigns connection digest map string socket connection map connectionmap concurrent hash map concurrenthashmap string socket list digests connections stored list string allowed connections allowedconnections collections synchronized list synchronizedlist linked list linkedlist string string local add res ses localaddresses collections synchronized set synchronizedset linked hash set linkedhashset string constructor socks proxy server process serverprocess socks server process serverprocess add local address local add res ses localaddresses add inet address inetaddress get local host getlocalhost get host address gethostaddress unknown host exception unknownhostexception returns local socks proxy server local socks proxy server socks proxy get socks getsocks proxy socks server socks server socks proxy smack configuration smackconfiguration is local socks islocalsocks proxy enabled proxyenabled socks server start socks server starts local socks proxy server running method start is running isrunning smack configuration smackconfiguration get local socks getlocalsocks proxy port proxyport port math abs smack configuration smackconfiguration get local socks getlocalsocks proxy port proxyport port server socket serversocket server socket serversocket port io exception ioexception server socket serversocket server socket serversocket smack configuration smackconfiguration get local socks getlocalsocks proxy port proxyport server socket serversocket server thread serverthread thread server process serverprocess server thread serverthread start io exception ioexception system err println could n couldn setup local socks proxy port smack configuration smackconfiguration get local socks getlocalsocks proxy port proxyport get message getmessage s tops stops local socks proxy server running method is running isrunning server socket serversocket close io exception ioexception server thread serverthread server thread serverthread is alive isalive server thread serverthread int errupt interrupt server thread serverthread join interrupted exception interruptedexception server thread serverthread server socket serversocket adds address list local network add resses addresses method provide multiple add resses addresses socks bytes tream bytestream request application running machine multiple network interfaces provide address nat router order add resses addresses determined order add add resses addresses note list add resses addresses init ially initially address returned code inet address inetaddress get local host getlocalhost get host address gethostaddress code replace list add resses addresses invoking link replace local add res ses replacelocaladdresses list param address local network address add add local address addlocaladdress string address address illegal argument exception illegalargumentexception address local add res ses localaddresses add address removes address list local network add resses addresses address longer out going outgoing socks bytes tream bytestream requests param address local network address remove remove local address removelocaladdress string address local add res ses localaddresses remove address returns unmodifiable list local network add resses addresses stream host streamhost candidates out going outgoing socks bytes tream bytestream requests unmodifiable list local network add resses addresses list string get local add res ses getlocaladdresses collections unmodifiable list unmodifiablelist array list arraylist string local add res ses localaddresses replaces list local network add resses addresses method provide multiple add resses addresses socks bytes tream bytestream request define order application running machine multiple network interfaces provide address nat router param add resses addresses list local network add resses addresses replace local add res ses replacelocaladdresses list string add resses addresses add resses addresses illegal argument exception illegalargumentexception list local add res ses localaddresses clear local add res ses localaddresses add all addall add resses addresses returns port local socks proxy server running returned port local socks proxy server proxy running get port getport is running isrunning server socket serversocket get local port getlocalport returns socket digest socket returned digest list allowed transfers link add transfer addtransfer string peer connected socks proxy param digest identifying connection socket socket digest socket get socket getsocket string digest connection map connectionmap digest add digest list allowed transfers connections allowed transfers stored retrieved invoking link get socket getsocket string connections local socks proxy don allowed digest discarded param digest list allowed transfers add transfer addtransfer string digest allowed connections allowedconnections add digest removes digest list allowed transfers invoking method stored connections digest removed digest removed establishing socks bytes tream bytestream finished error occurred establishing connection connection allowed param digest removed list allowed transfers remove transfer removetransfer string digest allowed connections allowedconnections remove digest connection map connectionmap remove digest returns code code local socks proxy server running code code code code local socks proxy server running code code is running isrunning server socket serversocket implementation simplified socks proxy server socks server process serverprocess runnable socket socket socks proxy server socket serversocket is closed isclosed thread current thread currentthread is interrupted isinterrupted accept connection socket socks proxy server socket serversocket accept initialize connection establish connection establishconnection socket socket exception socketexception exception socket socket close io exception ioexception negotiates socks connection stores success param socket connection client xmpp exception xmppexception client requests connection unsupported io exception ioexception network error occurred establish connection establishconnection socket socket xmpp exception xmppexception io exception ioexception data output stream dataoutputstream data output stream dataoutputstream socket get output stream getoutputstream data input stream datainputstream data input stream datainputstream socket get input stream getinputstream version read xmpp exception xmppexception socks supported number authentication methods supported read read list supported authentication methods read fully readfully auth method selection response authmethodselectionresponse protocol version auth method selection response authmethodselectionresponse authentication method authentication supported no auth method found noauthmethodfound length no auth method found noauthmethodfound no auth method found noauthmethodfound accept able acceptable methods auth method selection response authmethodselectionresponse xff write auth method selection response authmethodselectionresponse flush xmpp exception xmppexception authentication method supported authentication method auth method selection response authmethodselectionresponse write auth method selection response authmethodselectionresponse flush receive connection request connection request connectionrequest socks utils receive socks receivesocks message extract digest string response digest responsedigest string connection request connectionrequest connection request connectionrequest error digest allowed socks proxy allowed connections allowedconnections response digest responsedigest status connection ref used refused connection request connectionrequest write connection request connectionrequest flush xmpp exception xmppexception connection allowed status success connection request connectionrequest write connection request connectionrequest flush store connection socks proxy connection map connectionmap response digest responsedigest socket