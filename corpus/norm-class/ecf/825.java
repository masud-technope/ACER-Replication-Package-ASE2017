copyright florian schmaus rights reserved licensed apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org jivesoftware smack keep alive keepalive java util collections java util java util hash map hashmap java util hash set hashset java util map java util java util concurrent scheduled executor service scheduledexecutorservice java util concurrent scheduled future scheduledfuture java util concurrent scheduled thread pool executor scheduledthreadpoolexecutor java util concurrent thread factory threadfactory java util concurrent time unit timeunit org jivesoftware smack connection org jivesoftware smack connection creation listener connectioncreationlistener org jivesoftware smack connection listener connectionlistener org jivesoftware smack packet collector packetcollector org jivesoftware smack packet listener packetlistener org jivesoftware smack smack configuration smackconfiguration org jivesoftware smack filter packet filter packetfilter org jivesoftware smack filter packetidfilter org jivesoftware smack packet packet org jivesoftware smack ping ping failed listener pingfailedlistener org jivesoftware smack ping packet ping implementation href http xmpp org extensions xep html xmpp ping xep keep alive keepalive functionality server per iodically periodically ping server main tain maintain verify connection exists ping application level protocol agnostic work standard tcp connections bosh transport protocol work server supports ping extension error response ping serves purpose pong author florian schmaus keep alive manager keepalivemanager map connection keep alive manager keepalivemanager instances hash map hashmap connection keep alive manager keepalivemanager scheduled executor service scheduledexecutorservice periodic ping executor service periodicpingexecutorservice smack configuration smackconfiguration get keep alive interval getkeepaliveinterval connection add connection creation listener addconnectioncreationlistener connection creation listener connectioncreationlistener connection created connectioncreated connection connection keep alive manager keepalivemanager connection connection connection ping interval pinginterval smack configuration smackconfiguration get keep alive interval getkeepaliveinterval ping failed listener pingfailedlistener ping failed listeners pingfailedlisteners collections synchronized set synchronizedset hash set hashset ping failed listener pingfailedlistener scheduled future scheduledfuture periodic ping task periodicpingtask last successful contact lastsuccessfulcontact retrieves link keep alive manager keepalivemanager link connection creating doesn exist param connection connection manager attached existing manager keep alive manager keepalivemanager get instance for getinstancefor connection connection keep alive manager keepalivemanager ping manager pingmanager instances connection ping manager pingmanager ping manager pingmanager keep alive manager keepalivemanager connection instances connection ping manager pingmanager ping manager pingmanager start executor service has n hasn started enable executor service enableexecutorservice periodic ping executor service periodicpingexecutorservice periodic ping executor service periodicpingexecutorservice scheduled thread pool executor scheduledthreadpoolexecutor thread factory threadfactory override thread new thread newthread runnable runnable thread ping thread pingthread thread runnable smack keep alive keepalive ping thread pingthread set daemon setdaemon ping thread pingthread executor service monitored connections disconnected handle disconnect handledisconnect connection con periodic ping executor service periodicpingexecutorservice instances remove con instances is empty isempty periodic ping executor service periodicpingexecutorservice shutdown now shutdownnow periodic ping executor service periodicpingexecutorservice keep alive manager keepalivemanager connection connection connection connection init handle connect handleconnect call connection add packet listener handle connect handleconnect listen incoming pack ets packets reset scheduled ping arrives connection add packet listener addpacketlistener packet listener packetlistener override process packet processpacket packet packet res chedule reschedule ping based server contact last successful contact lastsuccessfulcontact system current time millis currenttimemillis schedule ping server task schedulepingservertask init connection add connection listener addconnectionlistener connection listener connectionlistener override connection closed connectionclosed stop ping server task stoppingservertask handle disconnect handledisconnect connection override connection closed on error connectionclosedonerror exception arg stop ping server task stoppingservertask handle disconnect handledisconnect connection override reconnect ion successful reconnectionsuccessful handle connect handleconnect schedule ping server task schedulepingservertask override rec onnecting in reconnectingin seconds override reconnect ion failed reconnectionfailed exception instances connection schedule ping server task schedulepingservertask sets ping int erval interval param ping interval pinginterval ping time int erval interval milliseconds set ping interval setpinginterval new ping interval newpinginterval ping interval pinginterval new ping interval newpinginterval enable executor service new ping interval newpinginterval enable executor service enableexecutorservice ping interval pinginterval new ping interval newpinginterval ping interval pinginterval stop pinging stoppinging schedule ping server task schedulepingservertask s tops stops pinging server ping started prevent triggered restart call link set ping interval setpinginterval stop pinging stoppinging ping interval pinginterval stop ping server task stoppingservertask ping int erval interval ping int erval interval milliseconds get ping interval getpinginterval ping interval pinginterval add listener not ification notification server ping fails not e note doesn connection lost slow resp ond respond server failure resp ond respond causing reply timeout param listener listener called add ping failed listener addpingfailedlistener ping failed listener pingfailedlistener listener ping failed listeners pingfailedlisteners add listener remove listener param listener listener removed remove ping failed listener removepingfailedlistener ping failed listener pingfailedlistener listener ping failed listeners pingfailedlisteners remove listener returns elapsed time milliseconds successful contact server time message received note result message received manager created elapsed time negative clock reset elapsed time message received get time since last contact gettimesincelastcontact last successful contact lastsuccessfulcontact last successful contact lastsuccessfulcontact delta system current time millis currenttimemillis last successful contact lastsuccessfulcontact delta delta can cels cancels existing periodic ping task schedules ping task ping interval pinginterval greater designed executor scheduling pings connections thread pinging schedule ping server task schedulepingservertask enable executor service enableexecutorservice stop ping server task stoppingservertask ping interval pinginterval periodic ping task periodicpingtask periodic ping executor service periodicpingexecutorservice schedule runnable override ping ping ping packet filter packetfilter response filter responsefilter packetidfilter ping get packet d getpacketid packet collector packetcollector response ping failed listeners pingfailedlisteners is empty isempty connection create packet collector createpacketcollector response filter responsefilter connection send packet sendpacket ping response schedule collector ping reply notify listeners received periodic ping executor service periodicpingexecutorservice schedule runnable override packet result response next result nextresult queuing response cancel actual result reply care result ping failed listener pingfailedlistener listener ping failed listeners pingfailedlisteners listener ping failed pingfailed smack configuration smackconfiguration get packet reply timeout getpacketreplytimeout time unit timeunit milliseconds get ping interval getpinginterval time unit timeunit milliseconds stop ping server task stoppingservertask periodic ping task periodicpingtask periodic ping task periodicpingtask cancel periodic ping task periodicpingtask