copyright remy suen comp osent composent rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors remy suen remy suen gmail initial api implementation org eclipse ecf protocol bit torrent bittorrent java io exception ioexception java net inet socket address inetsocketaddress java net server socket serversocket java nio byte buffer bytebuffer java nio channels async hronous close exception asynchronouscloseexception java nio channels closed channel exception closedchannelexception java nio channels server socket channel serversocketchannel java nio channels socket channel socketchannel java util hash map hashmap java util map code torrent server torrentserver code list ens listens incoming connections hooks link torrent based info hash hand shake torrent server torrentserver map active torrents activetorrents hash map hashmap shared instance code torrent server torrentserver code monitoring port incoming connections torrent server torrentserver peer listener peerlistener port listen incoming connections port read process incoming connection handshake byte buffer bytebuffer buffer byte buffer bytebuffer all ocate allocate buffer array bufferarray buffer array handshake server socket channel serversocketchannel channel server socket serversocket server socket serversocket thread list ening thread listeningthread peer listener peerlistener torrent server torrentserver io exception ioexception illegal state exception illegalstateexception get message getmessage sets port listen incoming connections param port port listen illegal argument exception illegalargumentexception code port code negative io exception ioexception error occurs binding port set port setport port io exception ioexception port nls illegal argument exception illegalargumentexception listen incoming connections negative port port peer listener peerlistener torrent server torrentserver port port peer listener peerlistener channel close io exception ioexception peer listener peerlistener torrent server torrentserver port peer listener peerlistener listen retrieves port listen incoming connections port get port getport port add torrent addtorrent string hash torrent torrent active torrents activetorrents contains key containskey hash active torrents activetorrents hash torrent active torrents activetorrents size peer listener peerlistener listen torrent string hash torrent active torrents activetorrents hash torrent remove string hash torrent host torrent active torrents activetorrents remove hash active torrents activetorrents is empty isempty peer listener peerlistener channel close io exception ioexception peer listener peerlistener list ening thread listeningthread host torrent server torrentserver inet socket address inetsocketaddress address io exception ioexception channel server socket channel serversocketchannel open server socket serversocket channel socket server socket serversocket bind address port server socket serversocket get local port getlocalport torrent server torrentserver port io exception ioexception nls inet socket address inetsocketaddress localhost port starts thread list ening listening incoming connections listen list ening thread listeningthread list ening thread listeningthread list ening thread listeningthread list ening thread listeningthread start list ening thread listeningthread thread list ening thread listeningthread nls list ening listening thread read ret socket channel socketchannel socket channel socketchannel channel accept ret socket channel socketchannel read buffer ret socket channel socketchannel close io exception ioexception read ret read ret socket channel socketchannel read buffer ret socket channel socketchannel close io exception ioexception read ret ret system arraycopy buffer array bufferarray handshake torrent torrent torrent active torrents activetorrents string nls handshake nls iso torrent torrent connect to connectto socket channel socketchannel connected simply close connection socket channel socketchannel close io exception ioexception buffer clear async hronous close exception asynchronouscloseexception closed channel exception closedchannelexception io exception ioexception runtime exception runtimeexception