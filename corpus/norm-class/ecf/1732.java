copyright arthur van hoff rick blair javax jmdns impl java io exception ioexception java net java util javax jmdns javax jmdns impl tasks mdns implementation java version author arthur van hoff rick blair jeff son stein sonstein werner ran del shofer randelshofer pierre frisch s cott scott lewis jmdnsimpl jmdns logger logger logger get logger getlogger jmdnsimpl get name getname hack i phone iphone a rm arm darwin network interface networkinterface fails gnu classpath is iphone isiphone get boolean getboolean net mdns is arm darwin isarmdarwin multicast group list ening listening multicast dns messages inet address inetaddress group multicast socket multicast socket multicastsocket socket live lock problem unregester closed h olds holds instances jmdns dns listener dnslistener collection updated concurrent threads list listeners h olds holds instances service listener servicelistener strings holding fully qualified service type values linked list linkedlist service listener servicelistener map service listeners servicelisteners h olds holds instances service type listener servicetypelistener list type listeners typelisteners cache dns entry dnsentry dns cache dnscache cache hashtable holds services registered instances string hold version fully qualified service values instances service info serviceinfo map services hashtable holds service types registered received incoming data gram datagram instances string hold version fully qualified service type values hold fully qualified service type map service types servicetypes shutdown hook registered java runtime thread shutdown handle local host host info hostinfo local host localhost thread incoming listener incominglistener throttle count count number pro bes probes jmdns throttle increment happened throttle throttle increment last throttle increment lastthrottleincrement timer dispatch out going outgoing messages jmdns dispatch main tenance maintenance tasks dns cache timer timer source random values int roduce introduce random delays resp onses responses reduces potential collisions net work network random random random lock coordinate processing incoming out going outgoing messages needed rendezvous conf ormance conformance test for give forgive race conditions object io lock iolock object incoming answer truncated store add incoming dns records dnsrecords jmdns res ponder responder timer picks remind work multiple planned answers packages clients dns incoming dnsincoming planned answer plannedanswer machine jmdns proper handling concurrency variable changed methods advance state advancestate revert state revertstate cancel dns state dnsstate dns state dnsstate probing timer task host prevent multiple tasks host time timer task timertask task hashtable main tain maintain list service types collected jmdns instance key hashtable service type instance jmdns service collector servicecollector list hash map hashmap service collectors servicecollectors hash map hashmap create instance jmdns jmdnsimpl io exception ioexception logger finer jmdns instance created determine inet address inetaddress add r addr string system get property getproperty net mdns add r addr inet address inetaddress get by name getbyname init add r addr add r addr get host name gethostname add r addr inet address inetaddress get local host getlocalhost init add r addr is loop back address isloopbackaddress add r addr add r addr get host name gethostname pjyf oct disallow loop back loopback address io exception ioexception init compute r computer create instance jmdns bind specific net work network address jmdnsimpl inet address inetaddress add r addr io exception ioexception init add r addr add r addr get host name gethostname io exception ioexception init compute r computer initialize param address jmdns bin ds binds param host init inet address inetaddress address string io exception ioexception host illegal str ip strip append local idx index of indexof idx substring idx local local host localhost address binding local host localhost host info hostinfo address cache dns cache dnscache listeners collections synchronized list synchronizedlist array list arraylist service listeners servicelisteners hash map hashmap type listeners typelisteners array list arraylist services hashtable service types servicetypes hashtable remind pass timer thread pass jmdns timer timer timer record reaper recordreaper start timer shutdown thread shutdown jmdns shutdown runtime get runtime getruntime add shutdown hook addshutdownhook shutdown incoming listener incominglistener thread socket listener socketlistener jmdns socket listener socketlistener bind multicast socket open multicast socket openmulticastsocket get local host getlocalhost start get services getservices values start collection service infos serviceinfos set state setstate dns state dnsstate probing incoming listener incominglistener start prober start timer iterator iterator service infos serviceinfos iterator iterator has next hasnext register service registerservice service info impl serviceinfoimpl service info impl serviceinfoimpl iterator exception exception open multicast socket openmulticastsocket host info hostinfo host info hostinfo io exception ioexception group group inet address inetaddress get by name getbyname dns constants dnsconstants mdns group socket close multicast socket closemulticastsocket socket multicast socket multicastsocket dns constants dnsconstants mdns port is iphone isiphone host info hostinfo local host localhost get interface getinterface socket set network interface setnetworkinterface host info hostinfo get interface getinterface socket set time to live settimetolive socket join group joingroup group close multicast socket closemulticastsocket logger finer close multicast socket closemulticastsocket socket close socket socket leave group leavegroup group socket close incoming listener incominglistener incoming listener incominglistener join exception exception socket machine sets not ifies notifies objects wait jmdns advance state advancestate set state setstate get state getstate advance notify all notifyall sets not ifies notifies objects wait jmdns revert state revertstate set state setstate get state getstate revert notify all notifyall sets not ifies notifies objects wait jmdns cancel set state setstate dns state dnsstate canceled notify all notifyall returns current info dns state dnsstate get state getstate dns cache dnscache cache variable dns cache dnscache get cache getcache cache javax jmdns jmdns get host name gethostname string get host name gethostname local host localhost get name getname host info hostinfo get local host getlocalhost local host localhost javax jmdns jmdns get interface getinterface inet address inetaddress get interface getinterface io exception ioexception socket get interface getinterface javax jmdns jmdns get service info getserviceinfo java lang string java lang string service info serviceinfo get service info getserviceinfo string type string get service info getserviceinfo type javax jmdns jmdns get service info getserviceinfo java lang string java lang string service info serviceinfo get service info getserviceinfo string type string timeout service info impl serviceinfoimpl info service info impl serviceinfoimpl type service info resolver serviceinforesolver info start timer system current time millis currenttimemillis timeout delay info info has data hasdata delay system current time millis currenttimemillis info wait delay interrupted exception interruptedexception info has data hasdata info javax jmdns jmdns request service info requestserviceinfo java lang string java lang string request service info requestserviceinfo string type string request service info requestserviceinfo type javax jmdns jmdns request service info requestserviceinfo java lang string java lang string request service info requestserviceinfo string type string timeout register service type registerservicetype type service info impl serviceinfoimpl info service info impl serviceinfoimpl type service info resolver serviceinforesolver info start timer system current time millis currenttimemillis timeout delay info info has data hasdata delay system current time millis currenttimemillis info wait delay interrupted exception interruptedexception handle service resolved handleserviceresolved service info impl serviceinfoimpl info list list array list arraylist list copy listcopy service listeners servicelisteners list list service listeners servicelisteners info type to lower case tolowercase list list copy listcopy array list arraylist list list copy listcopy service event serviceevent event service event impl serviceeventimpl info type info get name getname info iterator iterator list copy listcopy iterator iterator has next hasnext service listener servicelistener iterator service resolved serviceresolved event javax jmdns jmdns add service type listener addservicetypelistener javax jmdns service type listener servicetypelistener add service type listener addservicetypelistener service type listener servicetypelistener listener io exception ioexception type listeners typelisteners remove listener type listeners typelisteners add listener report cached service types iterator iterator service types servicetypes values iterator iterator has next hasnext listener service type added servicetypeadded service event impl serviceeventimpl string iterator type resolver typeresolver start timer javax jmdns jmdns remove service type listener removeservicetypelistener javax jmdns service type listener servicetypelistener remove service type listener removeservicetypelistener service type listener servicetypelistener listener type listeners typelisteners remove listener javax jmdns jmdns add service listener addservicelistener java lang string javax jmdns service listener servicelistener add service listener addservicelistener string type service listener servicelistener listener string lotype type to lower case tolowercase remove service listener removeservicelistener lotype listener list list service listeners servicelisteners list list service listeners servicelisteners lotype list list collections synchronized list synchronizedlist linked list linkedlist service listeners servicelisteners lotype list list add listener report cached service types list service events serviceevents array list arraylist cache iterator cache iterator has next hasnext dns cache dnscache cache node cachenode dns cache dnscache cache node cachenode dns record dnsrecord rec dns record dnsrecord get value getvalue rec type dns constants dnsconstants type srv rec ends with endswith type service events serviceevents add service event impl serviceeventimpl type to unqualified name tounqualifiedname type rec call listener service events iterator service events serviceevents iterator has next hasnext listener service added serviceadded service event impl serviceeventimpl create start service resolver serviceresolver service resolver serviceresolver type start timer javax jmdns jmdns remove service listener removeservicelistener java lang string javax jmdns service listener servicelistener remove service listener removeservicelistener string type service listener servicelistener listener type type to lower case tolowercase list list service listeners servicelisteners list list service listeners servicelisteners type list list remove listener list size service listeners servicelisteners remove type javax jmdns jmdns register service registerservice javax jmdns service info serviceinfo register service registerservice service info serviceinfo info abstract infoabstract io exception ioexception service info impl serviceinfoimpl info service info impl serviceinfoimpl info abstract infoabstract register service type registerservicetype info type bind service address info server local host localhost get name getname info add r addr local host localhost get address getaddress make service name unique makeservicenameunique info services info get qualified name getqualifiedname to lower case tolowercase info service prober start timer info info get state getstate compare to compareto dns state dnsstate announced info wait interrupted exception interruptedexception logger fine register service registerservice jmdns registered service info javax jmdns jmdns unregister service unregisterservice javax jmdns service info serviceinfo unregister service unregisterservice service info serviceinfo info abstract infoabstract service info impl serviceinfoimpl info service info impl serviceinfoimpl info abstract infoabstract services remove info get qualified name getqualifiedname to lower case tolowercase info cancel note lock object synchronize synch ronizing synchronizing object service info serviceinfo sense sole purpose lock wait can celer canceler finished service info serviceinfo canceler block accesses methods object object lock object remind deadlock canceler lock canceler info lock start timer lock wait interrupted exception interruptedexception javax jmdns jmdns unregister all services unregisterallservices unregister all services unregisterallservices logger finer unregister all services unregisterallservices services size collection list list linked list linkedlist services values services clear iterator iterator list iterator iterator has next hasnext service info impl serviceinfoimpl iterator cancel object lock object canceler list lock start timer remind live lock livelock canceler lock closed lock wait interrupted exception interruptedexception javax jmdns jmdns register service type registerservicetype java lang string register service type registerservicetype string type string type to lower case tolowercase service types servicetypes type index of indexof dns constants dnsconstants dns meta query type ends with endswith add r addr a rpa arpa collection list service types servicetypes type list linked list linkedlist type listeners typelisteners iterator iterator list iterator iterator has next hasnext service type listener servicetypelistener iterator service type added servicetypeadded service event impl serviceeventimpl type generate unique host cache returns host changed make host name unique makehostnameunique dns record dnsrecord address host string original name originalname host get name getname system current time millis currenttimemillis collision collision check collision cache dns cache dnscache cache node cachenode cache find host get name getname to lower case tolowercase host increment name incrementname host get name getname collision collision original name originalname equals host get name getname generate unique service cache returns service info changed make service name unique makeservicenameunique service info impl serviceinfoimpl info string original qualified name originalqualifiedname info get qualified name getqualifiedname system current time millis currenttimemillis collision collision check collision cache dns cache dnscache cache node cachenode cache find info get qualified name getqualifiedname to lower case tolowercase dns record dnsrecord dns record dnsrecord get value getvalue type dns constants dnsconstants type srv is expired isexpired dns record dnsrecord service dns record dnsrecord service port info port server equals local host localhost get name getname logger finer make service name unique makeservicenameunique jmdns make service name unique makeservicenameunique srv collision server server local host localhost get name getname equals server equals local host localhost get name getname info set name setname increment name incrementname info get name getname collision check collision service infos published jmdns object self service selfservice services info get qualified name getqualifiedname to lower case tolowercase self service selfservice self service selfservice info info set name setname increment name incrementname info get name getname collision collision original qualified name originalqualifiedname equals info get qualified name getqualifiedname string increment name incrementname string last index of lastindexof last index of lastindexof substring integer parse int parseint substring number format exception numberformatexception add listener question listener receive updates answers question a rrive arrive cache add listener addlistener dns listener dnslistener listener dns question dnsquestion question system current time millis currenttimemillis add listener listeners add listener report existing matched records question dns cache dnscache cache node cachenode cache find question dns record dnsrecord dns record dnsrecord get value getvalue question answered by answeredby is expired isexpired listener update record updaterecord remove listener out standing outstanding questions listener longer receive updates remove listener removelistener dns listener dnslistener listener listeners remove listener remind method update record updaterecord receive notify listeners record updated update record updaterecord dns record dnsrecord rec block entire dns updating record listener service info list listener list listenerlist listener list listenerlist array list arraylist listeners iterator iterator listener list listenerlist iterator iterator has next hasnext dns listener dnslistener listener dns listener dnslistener iterator listener update record updaterecord rec rec type dns constants dnsconstants type ptr rec type dns constants dnsconstants type srv list service listener list servicelistenerlist service listeners servicelisteners service listener list servicelistenerlist list service listeners servicelisteners rec to lower case tolowercase iter ate iterate copy listeners modify service listener list servicelistenerlist service listener list servicelistenerlist array list arraylist service listener list servicelistenerlist service listener list servicelistenerlist expired rec is expired isexpired string type rec get name getname string dns record dnsrecord pointer rec get alias getalias dns record dnsrecord dns record dnsrecord services to lower case tolowercase expired record service event serviceevent event service event impl serviceeventimpl type to unqualified name tounqualifiedname type iterator iterator service listener list servicelistenerlist iterator iterator has next hasnext service listener servicelistener iterator service added serviceadded event expire record service event serviceevent event service event impl serviceeventimpl type to unqualified name tounqualifiedname type iterator iterator service listener list servicelistenerlist iterator iterator has next hasnext service listener servicelistener iterator service removed serviceremoved event handle incoming response cache answers pass questions handle response handleresponse dns incoming dnsincoming msg io exception ioexception system current time millis currenttimemillis host conflict detected hostconflictdetected service conflict detected serviceconflictdetected iterator msg answers iterator has next hasnext is info rmative isinformative dns record dnsrecord rec dns record dnsrecord expired rec is expired isexpired update cache dns record dnsrecord dns record dnsrecord cache rec expired is info rmative isinformative cache remove resetttl rec rec expired is info rmative isinformative cache add rec rec type dns constants dnsconstants type ptr handle mdns udp records rec get name getname index of indexof dns constants dnsconstants dns meta query expired rec starts with startswith services dns constants dnsconstants dns meta query is info rmative isinformative register service type registerservicetype dns record dnsrecord pointer rec alias register service type registerservicetype rec rec get type gettype dns constants dnsconstants type rec get type gettype dns constants dnsconstants type aaaa host conflict detected hostconflictdetected rec handle response handleresponse service conflict detected serviceconflictdetected rec handle response handleresponse notify listeners is info rmative isinformative update record updaterecord rec host conflict detected hostconflictdetected service conflict detected serviceconflictdetected prober start timer handle incoming query answer service infos handle query handlequery dns incoming dnsincoming inet address inetaddress add r addr port io exception ioexception track answers host conflict detected hostconflictdetected service conflict detected serviceconflictdetected expiration time expirationtime system current time millis currenttimemillis dns constants dnsconstants answer ttl iterator answers iterator has next hasnext dns record dnsrecord answer dns record dnsrecord answer get type gettype dns constants dnsconstants type answer get type gettype dns constants dnsconstants type aaaa host conflict detected hostconflictdetected answer handle query handlequery expiration time expirationtime service conflict detected serviceconflictdetected answer handle query handlequery expiration time expirationtime planned answer plannedanswer planned answer plannedanswer append is truncated istruncated planned answer plannedanswer res ponder responder add r addr port start host conflict detected hostconflictdetected service conflict detected serviceconflictdetected prober start timer add answer question deal out going outgoing packet over flows overflows dns out going dnsoutgoing add answer addanswer dns incoming dnsincoming inet address inetaddress add r addr port dns out going dnsoutgoing dns record dnsrecord rec io exception ioexception dns out going dnsoutgoing dns constants dnsconstants flags response dns constants dnsconstants flags add answer addanswer rec io exception ioexception flags dns constants dnsconstants flags finish send dns out going dnsoutgoing dns constants dnsconstants flags response dns constants dnsconstants flags add answer addanswer rec send out going outgoing multicast dns message send dns out going dnsoutgoing io exception ioexception finish is empty isempty data gram packet datagrampacket packet data gram packet datagrampacket data group dns constants dnsconstants mdns port dns incoming dnsincoming msg dns incoming dnsincoming packet logger finest send jmdns msg print io exception ioexception multicast socket multicastsocket socket is closed isclosed send packet start anno uncer startannouncer get state getstate dns state dnsstate canceled anno uncer announcer start timer start renewer startrenewer get state getstate dns state dnsstate canceled renewer start timer schedule timer task timertask task delay get state getstate dns state dnsstate canceled timer schedule task delay shutdown operations shutdown runnable shutdown close recover jmdns error recover cover address changing feet dns state dnsstate canceled get state getstate synchronize process prevent dead locks logger finer recover clean ning cleanning jmdns pro tects protects recursive set state setstate dns state dnsstate canceled calls copy reregistration collection old service infos oldserviceinfos array list arraylist get services getservices values cancel services unregister all services unregisterallservices dispose service collectors disposeservicecollectors close multicast socket close multicast socket closemulticastsocket cache clear open multicast socket openmulticastsocket get local host getlocalhost start old service infos oldserviceinfos exception exception logger log level warning recover javax jmdns jmdns close close get state getstate dns state dnsstate canceled synchronize process prevent dead locks jmdns pro tects protects recursive set state setstate dns state dnsstate canceled calls unregister all services unregisterallservices timer timer cancel dispose service collectors disposeservicecollectors close socket close multicast socket closemulticastsocket remove shutdown hook shutdown runtime get runtime getruntime remove shutdown hook removeshutdownhook shutdown list cache entries debug ging debugging print system println cache cache print system println javax jmdns jmdns print services printservices print services printservices system err println to string tostring string to string tostring string buffer stringbuffer a log alog string buffer stringbuffer a log alog append services services iterator services key set keyset iterator has next hasnext object key a log alog append t service tservice key services key a log alog append a log alog append types service types servicetypes iterator service types servicetypes key set keyset iterator has next hasnext object key a log alog append t type ttype key service types servicetypes key a log alog append a log alog append cache to string tostring a log alog append a log alog append service collectors service collectors servicecollectors service collectors servicecollectors iterator service collectors servicecollectors key set keyset iterator has next hasnext object key a log alog append t service tservice collector key service collectors servicecollectors key service collectors servicecollectors clear a log alog to string tostring javax jmdns jmdns list java lang string service info serviceinfo list string type implementation not e note time list type requested service collector servicecollector created collects service infos greatly speeds performance subsequent calls method caveats call method type slow spawn service collector servicecollector instance service type inc reases increases net work network tra ffic traffic service collector servicecollector collector new collector created newcollectorcreated service collectors servicecollectors collector service collector servicecollector service collectors servicecollectors type collector collector service collector servicecollector type service collectors servicecollectors type collector add service listener addservicelistener type collector new collector created newcollectorcreated new collector created newcollectorcreated infos net work network new collector created newcollectorcreated thread sleep interrupted exception interruptedexception collector list method disposes service collector servicecollector instances created calls method code list type code list dispose service collectors disposeservicecollectors logger finer dispose service collectors disposeservicecollectors service collectors servicecollectors iterator service collectors servicecollectors values iterator has next hasnext service collector servicecollector collector service collector servicecollector remove service listener removeservicelistener collector type collector service collectors servicecollectors clear instances service collector servicecollector int ernally internally speed performance method code list type code list service collector servicecollector service listener servicelistener logger logger logger get logger getlogger service collector servicecollector get name getname collected service instance names map infos collections synchronized map synchronizedmap hash map hashmap string type service collector servicecollector string type type type service service added serviceadded service event serviceevent event infos event getdns request service info requestserviceinfo event get type gettype event get name getname service removed service removed serviceremoved service event serviceevent event infos infos remove event get name getname service has e hase resolved details service info serviceinfo record service resolved serviceresolved service event serviceevent event infos infos event get name getname event get info getinfo returns array service infos collected service collector servicecollector service info impl serviceinfoimpl list infos service info impl serviceinfoimpl infos values to array toarray service info impl serviceinfoimpl infos size string to string tostring string buffer stringbuffer a log alog string buffer stringbuffer infos iterator infos key set keyset iterator has next hasnext object key a log alog append t service tservice key infos key a log alog to string tostring string to unqualified name tounqualifiedname string type string qualified name qualifiedname qualified name qualifiedname ends with endswith type qualified name qualifiedname substring qualified name qualifiedname length type length qualified name qualifiedname set state setstate dns state dnsstate set task settask timer task timertask task task task timer task timertask get task gettask task map get services getservices services set last throttle increment setlastthrottleincrement last throttle increment lastthrottleincrement last throttle increment lastthrottleincrement last throttle increment lastthrottleincrement get last throttle increment getlastthrottleincrement last throttle increment lastthrottleincrement set throttle setthrottle throttle throttle throttle get throttle getthrottle throttle random get random getrandom random set io lock setiolock object io lock iolock io lock iolock io lock iolock object get io lock getiolock io lock iolock set planned answer setplannedanswer dns incoming dnsincoming planned answer plannedanswer planned answer plannedanswer planned answer plannedanswer dns incoming dnsincoming get planned answer getplannedanswer planned answer plannedanswer set local host setlocalhost host info hostinfo local host localhost local host localhost local host localhost map get service types getservicetypes service types servicetypes set closed setclosed closed closed closed is closed isclosed closed multicast socket multicastsocket get socket getsocket socket inet address inetaddress get group getgroup group