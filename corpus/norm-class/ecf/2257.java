copyright ibm corporation comp osent composent rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors comp osent composent initial api implementation ibm corporation initial api implementation distributed event admin eventadmin mark us markus alexander kuppe https bugs eclipse org org eclipse ecf remoteservice event admin eventadmin java io exception ioexception java not serializable exception notserializableexception java security permission java util arrays java util hash map hashmap java util hash set hashset java util iterator java util list java util map java util org eclipse core runtime org eclipse ecf core i container icontainer org eclipse ecf core identity org eclipse ecf core shared object sharedobject base shared object basesharedobject org eclipse ecf core shared object sharedobject shared object msg sharedobjectmsg org eclipse ecf core shared object sharedobject events i shared object create response event isharedobjectcreateresponseevent org eclipse ecf core shared object sharedobject events i shared object message event isharedobjectmessageevent org eclipse ecf internal remoteservice event admin eventadmin default serialization handler defaultserializationhandler org eclipse ecf internal remoteservice event admin eventadmin event handler tracker eventhandlertracker org eclipse ecf internal remoteservice event admin eventadmin event handler wrapper eventhandlerwrapper org eclipse ecf internal remoteservice event admin eventadmin log tracker logtracker org eclipse ecf remoteservice event admin eventadmin serialization serialization handler serializationhandler org eclipse osgi framework event mgr eventmgr copy on write identity map copyonwriteidentitymap org eclipse osgi framework event mgr eventmgr event manager eventmanager org eclipse osgi framework event mgr eventmgr listener queue listenerqueue org osgi framework bundle context bundlecontext org osgi framework service exception serviceexception org osgi framework service reference servicereference org osgi framework service registration serviceregistration org osgi service event event org osgi service event event admin eventadmin org osgi service event event handler eventhandler org osgi service event topic permission topicpermission org osgi service log log service logservice org osgi util tracker service tracker servicetracker org osgi util tracker service tracker customizer servicetrackercustomizer distributed event admin distributedeventadmin base shared object basesharedobject event admin eventadmin noreference unit tests ignore serialization exceptions ignoreserializationexceptions get boolean getboolean distributed event admin distributedeventadmin get name getname ignore serial zation failures ignoreserialzationfailures log tracker logtracker log tracker logtracker log service logservice log event manager eventmanager event manager eventmanager service tracker servicetracker etf service tracker etfservicetracker service tracker servicetracker sh service tracker shservicetracker event filters eventfilters hash set hashset map topic serialization handler serializationhandler hash map hashmap string shared object message method handle post event shared object msg handleposteventsharedobjectmsg noreference field intended referenced clients event handler tracker eventhandlertracker event handler tracker eventhandlertracker bundle context bundlecontext context noreference distributed event admin distributedeventadmin nop create distributed event admin eventadmin implementation param context bundle context bundlecontext code code param log link log service logservice code code code code log tracker logtracker created find link log service logservice distributed event admin distributedeventadmin bundle context bundlecontext context log service logservice log is not null isnotnull context context context log create log tracker log log tracker logtracker log tracker logtracker context system log log tracker logtracker log tracker logtracker log log create event handler eventhandler tracker event handler tracker eventhandlertracker event handler tracker eventhandlertracker context log create distributed event admin eventadmin implementation param context bundle context bundlecontext code code distributed event admin distributedeventadmin bundle context bundlecontext context context start distributed event admin instance method called prior registering object link event admin eventadmin implementation osg i osgi service registry start log tracker logtracker log tracker logtracker open nls thread group threadgroup event group eventgroup thread group threadgroup distributed event admin eventadmin event group eventgroup set daemon setdaemon event manager eventmanager event manager eventmanager distributed event admin eventadmin async event dispatcher thread event group eventgroup event handler tracker eventhandlertracker open services contribute event topic filters distribution distributed event admin distributedeventadmin cases event data serialized serialization expensive etf service tracker etfservicetracker service tracker servicetracker context event topic filter eventtopicfilter service tracker customizer servicetrackercustomizer object adding service addingservice service reference servicereference reference event topic filter eventtopicfilter etf event topic filter eventtopicfilter context get service getservice reference add event topic filters addeventtopicfilters etf get filters getfilters etf modified service modifiedservice service reference servicereference reference object service nop removed service removedservice service reference servicereference reference object service event topic filter eventtopicfilter etf event topic filter eventtopicfilter service remove event topic filters removeeventtopicfilters etf get filters getfilters etf service tracker etfservicetracker open serialization handler serializationhandler responsible handle serialization event properties sh service tracker shservicetracker service tracker servicetracker context serialization handler serializationhandler service tracker customizer servicetrackercustomizer object adding service addingservice service reference servicereference reference serialization handler serializationhandler serialization handler serializationhandler context get service getservice reference topic serialization handler serializationhandler get topic gettopic modified service modifiedservice service reference servicereference reference object service nop removed service removedservice service reference servicereference reference object service serialization handler serializationhandler serialization handler serializationhandler service topic serialization handler serializationhandler remove get topic gettopic sh service tracker shservicetracker open distributed event admin instance method called unregistering link service registration serviceregistration created registration osg i osgi service registry event handler tracker eventhandlertracker close event manager eventmanager event manager eventmanager close event manager eventmanager log tracker logtracker log tracker logtracker close etf service tracker etfservicetracker etf service tracker etfservicetracker close etf service tracker etfservicetracker sh service tracker shservicetracker sh service tracker shservicetracker close sh service tracker shservicetracker send event sync hronously synchronously implementation method simply local dispatch link event handler eventhandler attempt distribute event link post event postevent event param event event send sync hronously synchronously local link event handler eventhandler code code send event sendevent event event local dispatch localdispatch event bug https bugs eclipse org post event asynchronous delivery distributed event admin primary entry point distributed event admin implementation asynchronous delivery receivers shared object enclosing link i container icontainer event post code code implementation steps call link get event to send geteventtosend event event returned get event to send geteventtosend code code method calls occur post event postevent returns call link send message sendmessage event code code result link get event to send geteventtosend event call link notify post send message notifypostsendmessage event call link local dispatch localdispatch event param event event send asynchronously matching link event handler eventhandler code code post event postevent event event subclasses decide event translated message send event event event to send eventtosend get event to send geteventtosend event event to send eventtosend event filters eventfilters event get topic gettopic send message sendmessage event to send eventtosend dispatch local event handlers eventhandlers notify post send message notifypostsendmessage event to send eventtosend local dispatch asynchronously local dispatch localdispatch event send event shared object message event serialized link send shared object msg to sendsharedobjectmsgto shared object msg sharedobjectmsg prior actual sending link get target gettarget event method called subclasses determine target receiver link create message data from event createmessagedatafromevent event method called create object data sending message object returned link create message data from event createmessagedatafromevent event serializable link create message data from event createmessagedatafromevent event subclasses override method customize replace send message sendmessage behavior exception occurs serialization sending link handle send message exception handlesendmessageexception string event object io exception ioexception method called handle param event to send eventtosend event send code code send message sendmessage event event to send eventtosend target object message data messagedata target get target gettarget event to send eventtosend message data messagedata create message data from event createmessagedatafromevent target event to send eventtosend send shared object msg to sendsharedobjectmsgto target shared object msg sharedobjectmsg create msg createmsg shared object message method message data messagedata io exception ioexception handle send message exception handlesendmessageexception send exception target target event to send eventtosend message data messagedata create message data deliver target code code designate multiple target receivers object serializable form receivers deserialize link create event from message data createeventfrommessagedata object receiver implementation creates single link event message eventmessage instance adds object length subclasses override customize serialization event to send eventtosend subclasses override method overridden link create event from message data createeventfrommessagedata object overridden receiver param target target link intended receiver returned link get target gettarget event param event to send eventtosend event send code code object actual message data serialized serializable link send message sendmessage event implementation creates single link event message eventmessage instance adds object length not serializable exception notserializableexception event to send eventtosend serialized object create message data from event createmessagedatafromevent target event event to send eventtosend not serializable exception notserializableexception object event message eventmessage event to send eventtosend get serialization handler getserializationhandler event to send eventtosend get topic gettopic serialization handler serializationhandler get serialization handler getserializationhandler string topic serialization handler serializationhandler serialization handler serializationhandler topic serialization handler serializationhandler topic default serialization handler defaultserializationhandler inst create local link event deserialized message data messagedata fromid code code link instance container sender distributed event admin distributedeventadmin implementation assumes single link event message eventmessage array element message data messagedata casts message data messagedata event message eventmessage returns event message eventmessage get event getevent subclasses override method overridden link create message data from event createmessagedatafromevent event overridden sender param fromid message sender code code param message data messagedata object received fromid deserialized local version object fromid event delivered local link event handler eventhandler code code event create event from message data createeventfrommessagedata fromid object message data messagedata event message eventmessage event message eventmessage event message eventmessage message data messagedata event message eventmessage set serialization handler setserializationhandler get serialization handler getserializationhandler event message eventmessage get topic gettopic event message eventmessage get event getevent handle exceptions occuring event serialization message send call link log error logerror string throwable event to send eventtosend message params messageparams appended message parameter param message message exception param event to send eventtosend event param message params messageparams message params handle send message exception handlesendmessageexception string message event event to send eventtosend object message params messageparams io exception ioexception exception string exception message exceptionmessage message message event to send eventtosend event to send eventtosend message params messageparams message params messageparams arrays as list aslist message params messageparams exception explicitly turned exception not serializable exception notserializableexception ignore serialization exceptions ignoreserializationexceptions log error logerror exception message exceptionmessage exception service exception serviceexception exception message exceptionmessage exception log warning logwarning exception message exceptionmessage exception target receiver event to send eventtosend returned link send shared object message single link i container icontainer group link i container icontainer send entire group method code code implementation code code meaning event to send eventtosend receivers connected shared object enclosing link i container icontainer param event to send eventtosend event to send eventtosend code code target link send message sendmessage event send code code code code implementation meaning event delivered members group shared object link i container icontainer get target gettarget event event to send eventtosend actual event pass link send message sendmessage event implementation method simply event passed method argument subclasses override filter transform event prior calling link send message sendmessage event param event event code code event send event argument returned event get event to send geteventtosend event event distribute event passed event method called link send message sendmessage event called typically link post event postevent event prior local dispatch implementation param event sent eventsent event code code notify post send message notifypostsendmessage event event sent eventsent method called link local dispatch localdispatch event prior actual deliver matching link event handler eventhandler implementation returns event subclasses override returned event code code local dispatch occur event subclasses override param event event dispatch code code event event dispatch code code local dispatch event event notify pre local dispatch notifyprelocaldispatch event event event notification called local dispatch impl emenation implemenation note method called thread calls link local dispatch localdispatch event actual dispatch thread param local dispatch localdispatch code code dispatch occur actual handling matching link event handler eventhandler subclasses override param event event delivered matching link event handler eventhandler code code notify post local dispatch notifypostlocaldispatch event event locally dispatch event method deliver link event matching link event handler eventhandler registered local osg i osgi service registry param dispatched event dispatchedevent event dispatch code code param is async isasync code code dispatch asynchronously blocking code code dispatch sync hronously synchronously local dispatch localdispatch event dispatched event dispatchedevent is async isasync event manager eventmanager current manager currentmanager event manager eventmanager current manager currentmanager dispatched event dispatchedevent log log log service logservice log error event passed event admin eventadmin event event notify pre local dispatch notifyprelocaldispatch dispatched event dispatchedevent event string event topic eventtopic event get topic gettopic security manager securitymanager system get security manager getsecuritymanager check permission checkpermission topic permission topicpermission event topic eventtopic topic permission topicpermission publish security exception securityexception log error logerror caller bundle topic permission topicpermission publish topic event topic eventtopic event handler wrappers eventhandlerwrappers event handler tracker eventhandlertracker get handlers gethandlers event topic eventtopic security manager securitymanager system get security manager getsecuritymanager permission per m perm topic permission topicpermission event topic eventtopic topic permission topicpermission sub scr ibe subscribe copy on write identity map copyonwriteidentitymap listeners copy on write identity map copyonwriteidentitymap iterator iter event handler wrappers eventhandlerwrappers iterator iter has next hasnext event handler wrapper eventhandlerwrapper wrapper event handler wrapper eventhandlerwrapper iter listeners wrapper per m perm listener queue listenerqueue listener queue listenerqueue listener queue listenerqueue current manager currentmanager listener queue listenerqueue queue listeners queuelisteners listeners entry set entryset event handler tracker eventhandlertracker is async isasync listener queue listenerqueue dispatch event async hronous dispatcheventasynchronous event listener queue listenerqueue dispatch event sync hronous dispatcheventsynchronous event notify post local dispatch notifypostlocaldispatch event handle shared object message method called receiver implementations distributed event admin distributedeventadmin deliver locally registered link event handler eventhandler implementation verifies link shared object msg sharedobjectmsg get method getmethod matches string calls create event from message data createeventfrommessagedata object convert message data returned create message data from event createmessagedatafromevent event sender event returned create event from message data createeventfrommessagedata object code code call notify received event notifyreceivedevent event subclasses not ified notified prior local dispatch local dispatch localdispatch event local dispatch asynchronously handle shared object msg handlesharedobjectmsg fromid shared object msg sharedobjectmsg msg string so method somethod msg get method getmethod shared object message method equals so method somethod object message data messagedata msg get parameters getparameters event received event receivedevent create event from message data createeventfrommessagedata fromid message data messagedata received event receivedevent notify received event notifyreceivedevent fromid received event receivedevent local dispatch localdispatch received event receivedevent exception log error logerror distributed event admin distributedeventadmin handle shared object msg handlesharedobjectmsg error receiving msg msg log error logerror distributed event admin distributedeventadmin received bad shared object msg msg fromid notify received event notifyreceivedevent fromid event received event receivedevent override base shared object basesharedobject handle shared object msg event handlesharedobjectmsgevent subclasses override method handle shared object msg event handlesharedobjectmsgevent i shared object message event isharedobjectmessageevent event result event i shared object create response event isharedobjectcreateresponseevent result handle shared object create response event handlesharedobjectcreateresponseevent i shared object create response event isharedobjectcreateresponseevent event shared object msg sharedobjectmsg msg get shared object msg from event getsharedobjectmsgfromevent event msg result handle shared object msg handlesharedobjectmsg event get remote container d getremotecontainerid msg result log methods log warning subclasses override param message message include warning code code log warning logwarning string message log warning logwarning message log warning subclasses override param message message include warning code code param exception exception include warning code code code code exception printed system log warning logwarning string message throwable exception log log log log service logservice log warning message exception system println message exception exception print stack trace printstacktrace system log error subclasses override param message message include error code code log error logerror string message log error logerror message log error subclasses override param message message include error code code param exception exception include warning code code code code exception printed system log error logerror string message throwable exception log log log log service logservice log error message exception system err println message exception exception print stack trace printstacktrace system err add event topic filters addeventtopicfilters string filters list as list aslist arrays as list aslist filters event filters eventfilters add all addall as list aslist remove event topic filters removeeventtopicfilters string filters list as list aslist arrays as list aslist filters event filters eventfilters remove all removeall as list aslist