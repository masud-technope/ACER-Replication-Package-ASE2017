copyright jonas ã…dahl copyright florian schmaus rights reserved licensed apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org jivesoftware smackx entity caps entitycaps org jivesoftware smack connection org jivesoftware smack connection creation listener connectioncreationlistener org jivesoftware smack connection listener connectionlistener org jivesoftware smack packet interceptor packetinterceptor org jivesoftware smack packet listener packetlistener org jivesoftware smack smack configuration smackconfiguration org jivesoftware smack xmpp connection xmppconnection org jivesoftware smack xmpp exception xmppexception org jivesoftware smack packet org jivesoftware smack packet packet org jivesoftware smack packet packet extension packetextension org jivesoftware smack packet presence org jivesoftware smack filter not filter notfilter org jivesoftware smack filter packet filter packetfilter org jivesoftware smack filter and filter andfilter org jivesoftware smack filter packet type filter packettypefilter org jivesoftware smack filter packet extension filter packetextensionfilter org jivesoftware smack util base org jivesoftware smack util cache org jivesoftware smackx form org jivesoftware smackx form field formfield org jivesoftware smackx node information provider nodeinformationprovider org jivesoftware smackx service discovery manager servicediscoverymanager org jivesoftware smackx entity caps entitycaps cache entity caps persistent cache entitycapspersistentcache org jivesoftware smackx entity caps entitycaps packet caps extension capsextension org jivesoftware smackx packet discover info discoverinfo org jivesoftware smackx packet data form dataform org jivesoftware smackx packet discover info discoverinfo feature org jivesoftware smackx packet discover info discoverinfo identity org jivesoftware smackx packet discover items discoveritems item java util collections java util comparator java util hash map hashmap java util iterator java util linked list linkedlist java util list java util map java util queue java util sorted set sortedset java util tree set treeset java util weak hash map weakhashmap java util concurrent concurrent linked queue concurrentlinkedqueue java i o exception ioexception java lang weak reference weakreference java security message digest messagedigest java security no such algorithm exception nosuchalgorithmexception track entity capabilities author florian schmaus entity caps manager entitycapsmanager string name space namespace http jabber org protocol caps string element string entity node http igniterealtime org projects smack map string message digest messagedigest supported hashes hash map hashmap string message digest messagedigest entity caps persistent cache entitycapspersistentcache persistent cache persistentcache map connection entity caps manager entitycapsmanager instances collections synchronized map synchronizedmap weak hash map weakhashmap connection entity caps manager entitycapsmanager map node hash algorithm discover info discoverinfo data map string discover info discoverinfo caps cache string discover info discoverinfo map full jid discover info discoverinfo connection key for med formed user server resource resource required link local connection key for med formed user host resource server component key for med formed domain map string node ver hash nodeverhash jid caps jidcaps cache string node ver hash nodeverhash connection add connection creation listener addconnectioncreationlistener connection creation listener connectioncreationlistener connection created connectioncreated connection connection connection xmpp connection xmppconnection entity caps manager entitycapsmanager connection message digest messagedigest sha message digest messagedigest message digest messagedigest get instance getinstance sha supported hashes sha sha message digest messagedigest no such algorithm exception nosuchalgorithmexception weak reference weakreference connection weak ref connection weakrefconnection service discovery manager servicediscoverymanager sdm entity caps enabled entitycapsenabled string current caps version currentcapsversion presence send presencesend queue string last local caps versions lastlocalcapsversions concurrent linked queue concurrentlinkedqueue string add discover info discoverinfo database param node ver nodever node verification string http psi org i kje yjv syhy ikjeyjvhsyhy cxm ki cxmki param info discover info discoverinfo node add discover info by node adddiscoverinfobynode string node ver nodever discover info discoverinfo info caps node ver nodever info persistent cache persistentcache persistent cache persistentcache add discover info by node persistent adddiscoverinfobynodepersistent node ver nodever info node version node ver jid returns string entiy caps manager entiycapsmanager param user user full jid node version node ver string get node version by jid getnodeversionbyjid string jid node ver hash nodeverhash nvh jid caps jidcaps jid nvh nvh node ver nodever node ver hash nodeverhash get node ver hash by jid getnodeverhashbyjid string jid jid caps jidcaps jid discover info user discover info returned user node ver node ver discover info param user user full jid discovered info discover info discoverinfo get discover info by user getdiscoverinfobyuser string user node ver hash nodeverhash nvh jid caps jidcaps user nvh get discovery info by node ver getdiscoveryinfobynodever nvh node ver nodever retrieve discover info discoverinfo specific node param node ver nodever node http psi org i kje yjv syhy ikjeyjvhsyhy cxm ki cxmki discover info discoverinfo discover info discoverinfo get discovery info by node ver getdiscoveryinfobynodever string node ver nodever discover info discoverinfo info caps node ver nodever info info discover info discoverinfo info info persistent cache implementation param cache i o exception ioexception set persistent cache setpersistentcache entity caps persistent cache entitycapspersistentcache cache i o exception ioexception persistent cache persistentcache illegal state exception illegalstateexception entity caps persistent cache persistent cache persistentcache cache persistent cache persistentcache rep lay replay sets maximum cache size jid node ver nodever cache param max cache size maxcachesize suppress warnings suppresswarnings rawtypes set jid caps max cache size setjidcapsmaxcachesize max cache size maxcachesize cache jid caps jidcaps set max cache size setmaxcachesize max cache size maxcachesize sets maximum cache size node ver nodever discover info discoverinfo cache param max cache size maxcachesize suppress warnings suppresswarnings rawtypes set caps max cache size setcapsmaxcachesize max cache size maxcachesize cache caps set max cache size setmaxcachesize max cache size maxcachesize entity caps manager entitycapsmanager connection connection weak ref connection weakrefconnection weak reference weakreference connection connection sdm service discovery manager servicediscoverymanager get instance for getinstancefor connection init init connection connection weak ref connection weakrefconnection instances connection connection add connection listener addconnectionlistener connection listener connectionlistener connection closed connectionclosed unregister instance connection closed presence send presencesend instances remove weak ref connection weakrefconnection connection closed on error connectionclosedonerror exception presence send presencesend reconnect ion failed reconnectionfailed exception ignore rec onnecting i n reconnectingin seconds ignore reconnect ion successful reconnectionsuccessful ignore cal culates calculates local entity caps version update local entity caps updatelocalentitycaps smack configuration smackconfiguration auto enable entity caps autoenableentitycaps enable entity caps enableentitycaps packet filter packetfilter packet filter packetfilter and filter andfilter packet type filter packettypefilter presence packet extension filter packetextensionfilter element name space namespace connection add packet listener addpacketlistener packet listener packetlistener listen remote presence sta nzas stanzas caps extension receive sta nza stanza record jid node ver nodever override process packet processpacket packet packet entity caps enabled entitycapsenabled caps extension capsextension ext caps extension capsextension packet get extension getextension entity caps manager entitycapsmanager element entity caps manager entitycapsmanager name space namespace string hash ext get hash gethash to lower case tolowercase supported hashes contains key containskey hash string packet get from getfrom string node ext get node getnode string ver ext get ver getver jid caps jidcaps node ver hash nodeverhash node ver hash packet filter packetfilter packet filter packetfilter and filter andfilter packet type filter packettypefilter presence not filter notfilter packet extension filter packetextensionfilter element name space namespace connection add packet listener addpacketlistener packet listener packetlistener override process packet processpacket packet packet remove jid map entity caps entitycaps disabled string packet get from getfrom jid caps jidcaps remove packet filter packetfilter packet filter packetfilter packet type filter packettypefilter presence connection add packet sending listener addpacketsendinglistener packet listener packetlistener override process packet processpacket packet packet presence send presencesend packet filter packetfilter int ercept intercept presence packages add caps data intended xep specifies client include entity capabilities presence not ification notification sends packet filter packetfilter caps packet filter capspacketfilter packet type filter packettypefilter presence packet interceptor packetinterceptor packet interceptor packetinterceptor packet interceptor packetinterceptor int ercept packet interceptpacket packet packet entity caps enabled entitycapsenabled caps extension capsextension caps caps extension capsextension entity node get caps version getcapsversion sha packet add extension addextension caps connection add packet interceptor addpacketinterceptor packet interceptor packetinterceptor caps packet filter capspacketfilter action behavior sdm ways sdm set entity caps manager setentitycapsmanager entity caps manager entitycapsmanager get instance for getinstancefor connection connection work bosh connections connection xmpp connection xmppconnection supported hashes size entity caps manager entitycapsmanager entity caps manager entitycapsmanager instances connection entity caps manager entitycapsmanager entity caps manager entitycapsmanager entity caps manager entitycapsmanager connection entity caps manager entitycapsmanager enable entity caps enableentitycaps add entity capabilities xep feature node sdm add feature addfeature name space namespace update local entity caps updatelocalentitycaps entity caps enabled entitycapsenabled disable entity caps disableentitycaps entity caps enabled entitycapsenabled sdm remove feature removefeature name space namespace entity caps enabled entitycapsenabled entity caps enabled entitycapsenabled remove record telling entity caps node user param user user full jid remove user caps node removeusercapsnode string user jid caps jidcaps remove user caps version version depends enabled features caps version naeabkkwk efjtgmu vxi caps version string get caps version getcapsversion current caps version currentcapsversion returns local entity node ver nodever http igniterealtime org projects smack naeabkkwk efjtgmu vxi string get local node ver getlocalnodever entity node get caps version getcapsversion returns entity caps supported jid param jid are entity caps supported areentitycapssupported string jid jid discover info discoverinfo result sdm discover info discoverinfo jid result contains feature containsfeature name space namespace xmpp exception xmppexception returns entity caps supported local service server are entity caps supported by server areentitycapssupportedbyserver are entity caps supported areentitycapssupported weak ref connection weakrefconnection get service name getservicename updates local user entity caps data connected presence send presence send info rm inform entity caps node string param discover info discoverinfo local users discover info service discovery features param identity type identitytype local users identity type param identity name identityname local users identity param extended info extendedinfo local users extended info update local entity caps updatelocalentitycaps connection connection weak ref connection weakrefconnection discover info discoverinfo discover info discoverinfo discover info discoverinfo discover info discoverinfo set type settype type result discover info discoverinfo set node setnode get local node ver getlocalnodever connection discover info discoverinfo set from setfrom connection get user getuser sdm add discover info to adddiscoverinfoto discover info discoverinfo current caps version currentcapsversion generate verification string generateverificationstring discover info discoverinfo sha add discover info by node adddiscoverinfobynode entity node current caps version currentcapsversion discover info discoverinfo last local caps versions lastlocalcapsversions size string old caps version oldcapsversion last local caps versions lastlocalcapsversions poll sdm remove node information provider removenodeinformationprovider entity node old caps version oldcapsversion last local caps versions lastlocalcapsversions add current caps version currentcapsversion caps current caps version currentcapsversion discover info discoverinfo connection jid caps jidcaps connection get user getuser node ver hash nodeverhash entity node current caps version currentcapsversion sha sdm set node information provider setnodeinformationprovider entity node current caps version currentcapsversion node information provider nodeinformationprovider list string features sdm get features list getfeatureslist list identity ide ntities identities linked list linkedlist identity service discovery manager servicediscoverymanager get identities getidentities list packet extension packetextension packet extensions packetextensions sdm get extended info as list getextendedinfoaslist override list item get node items getnodeitems override list string get node features getnodefeatures features override list identity get node identities getnodeidentities ide ntities identities override list packet extension packetextension get node packet extensions getnodepacketextensions packet extensions packetextensions resp ect respect connection configuration connectionconfiguration is send presence issendpresence connection connection is authenticated isauthenticated presence send presencesend presence presence presence presence type connection send packet sendpacket presence verify disover info disoverinfo caps node defined xep processing method href http xmpp org extensions xep html ver proc xep processing method param caps node capsnode caps node node ver param info valid cache verify discover info version verifydiscoverinfoversion string ver string hash discover info discoverinfo info step check duplicate ide ntities identities info contains duplicate identities containsduplicateidentities step check duplicate features info contains duplicate features containsduplicatefeatures step check for med formed packet extensions verify packet extensions verifypacketextensions info string calculated ver calculatedver generate verification string generateverificationstring info hash ver equals calculated ver calculatedver param info packet extensions ill for med formed verify packet extensions verifypacketextensions discover info discoverinfo info list form field formfield found form types foundformtypes linked list linkedlist form field formfield iterator packet extension packetextension info get extensions getextensions iterator has next hasnext packet extension packetextension get name space getnamespace equals form name space namespace data form dataform data form dataform iterator form field formfield get fields getfields has next hasnext form field formfield get variable getvariable equals form type form field formfield fft found form types foundformtypes equals fft found form types foundformtypes add generates xep verification string href http xmpp org extensions xep html ver xep verification string param discover info discoverinfo param hash hash function generated verification string hash supported string generate verification string generateverificationstring discover info discoverinfo discover info discoverinfo string hash message digest messagedigest supported hashes hash to lower case tolowercase data form dataform extended info extendedinfo data form dataform discover info discoverinfo get extension getextension form element form name space namespace initialize empty string method string builder stringbuilder don string builder stringbuilder string builder stringbuilder thread safe string buffer stringbuffer sort service discovery ide ntities identities category type xml lang exists for matted formatted category type lang note slash included lang included xep category type included sorted set sortedset discover info discoverinfo identity sorted identities sortedidentities tree set treeset discover info discoverinfo identity iterator discover info discoverinfo identity discover info discoverinfo get identities getidentities has next hasnext sorted identities sortedidentities add character iterator discover info discoverinfo identity sorted identities sortedidentities iterator has next hasnext discover info discoverinfo identity identity append identity get category getcategory append append identity get type gettype append append identity get language getlanguage identity get language getlanguage append append identity get name getname identity get name getname append sort supported service discovery features sorted set sortedset string features tree set treeset string iterator feature discover info discoverinfo get features getfeatures has next hasnext features add get var getvar character string features append append xep step extended info extendedinfo extended info extendedinfo has hidden form type field hashiddenformtypefield extended info extendedinfo service discovery response includes xep data forms sort forms form type xml character data element sorted set sortedset form field formfield tree set treeset form field formfield comparator form field formfield compare form field formfield form field formfield get variable getvariable compare to compareto get variable getvariable form field formfield iterator form field formfield extended info extendedinfo get fields getfields has next hasnext form field formfield get variable getvariable equals form type add add form type values form field values to caps formfieldvaluestocaps get values getvalues character form field formfield append get variable getvariable append form field values to caps formfieldvaluestocaps get values getvalues ensure encoded utf encoding rfc compute verification string has hing hashing algorithm hash attribute sha defined rfc has hed hashed data generated binary output encoded base rfc not e note base output include whitespace padding bits digest digest to string tostring get bytes getbytes base encode bytes encodebytes digest form field values to caps formfieldvaluestocaps iterator string string builder stringbuilder sorted set sortedset string fvs tree set treeset string has next hasnext fvs add string fvs append append node ver hash nodeverhash string node string hash string ver string node ver nodever node ver hash nodeverhash string node string ver string hash node node ver ver hash hash node ver nodever node ver string get node ver getnodever node ver nodever string get node getnode node string get hash gethash hash string get ver getver ver