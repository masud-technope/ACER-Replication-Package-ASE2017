revision jun copyright jive software rights reserved licensed apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license org jivesoftware smack util java util array list arraylist java util collections java util linked list linkedlist java util list java util map java util sorted map sortedmap java util tree map treemap org jivesoftware smack util dns dns resolver dnsresolver org jivesoftware smack util dns host address hostaddress org jivesoftware smack util dns srv record srvrecord utility perform dns lookups xmpp services author matt tucker dns util dnsutil create cache hold accessed dns lookups period min utes minutes map string list host address hostaddress cache cache string list host address hostaddress dns resolver dnsresolver dns resolver dnsresolver dns resolver perform dns lookups param resolver setdnsresolver dns resolver dnsresolver resolver dns resolver dnsresolver resolver returns current dns resolved perform dns lookups dns resolver dnsresolver getdnsresolver dns resolver dnsresolver returns list host addr esses hostaddresses xmpp server reached client server communication dns lookup srv record form xmpp client tcp attempted rfc lookup fails lookup older form jabber tcp attempted servers implement older version protocol listed notation lookup fails assumed xmpp server lives host resolved dns lookup domain port lookup param domain domain list host address hostaddress encompasses hostname port xmpp server reached domain list host address hostaddress resolvexmppdomain string domain dns resolver dnsresolver list host address hostaddress add resses addresses array list arraylist host address hostaddress add resses addresses add host address hostaddress domain add resses addresses resolve domain resolvedomain domain returns list host addr esses hostaddresses xmpp server reached server server communication dns lookup srv record form xmpp server tcp attempted rfc lookup fails lookup older form jabber tcp attempted servers implement older version protocol listed notation lookup fails assumed xmpp server lives host resolved dns lookup domain port lookup param domain domain list host address hostaddress encompasses hostname port xmpp server reached domain list host address hostaddress resolvexmppserverdomain string domain dns resolver dnsresolver list host address hostaddress add resses addresses array list arraylist host address hostaddress add resses addresses add host address hostaddress domain add resses addresses resolve domain resolvedomain domain list host address hostaddress resolve domain resolvedomain string domain key prefix keyprefix prefix key distinguish client domain lookups string key key prefix keyprefix domain item cache exists cache contains key containskey key list host address hostaddress add resses addresses cache key add resses addresses add resses addresses list host address hostaddress add resses addresses array list arraylist host address hostaddress step srv lookups string srv domain srvdomain key prefix keyprefix srv domain srvdomain xmpp server tcp domain key prefix keyprefix srv domain srvdomain xmpp client tcp domain srv domain srvdomain domain list srv record srvrecord srv records srvrecords dns resolver dnsresolver lookupsrvrecords srv domain srvdomain list host address hostaddress sorted records sortedrecords sortsrvrecords srv records srvrecords sorted records sortedrecords add resses addresses add all addall sorted records sortedrecords step add hostname list add resses addresses add host address hostaddress domain add item cache cache key add resses addresses add resses addresses sort list srv records srvrecords rfc note follow rfc exception group priority entry calculated random ore simply ordered priority param records list host address hostaddress sortsrvrecords list srv record srvrecord records root domain abort records size records getfqdn equals sorting records imp roves improves performance bisection collections sort records create priority buckets sorted map sortedmap integer list srv record srvrecord buckets tree map treemap integer list srv record srvrecord srv record srvrecord records integer priority get priority getpriority list srv record srvrecord bucket buckets priority create list srv records srvrecords doesn exist bucket bucket linked list linkedlist srv record srvrecord buckets priority bucket bucket add list host address hostaddress res array list arraylist host address hostaddress records size integer priority buckets key set keyset list srv record srvrecord bucket buckets priority bucket size bucketsize bucket size bucketsize bucket size totals bucket size running total count zero weight zeroweight srv record srvrecord bucket get weight getweight zero weight zeroweight srv record srvrecord bucket running total get weight getweight zero weight zeroweight totals count running total count selected pos selectedpos running total running total weights priority group simply select weights randomly normal algorithm unable handle selected pos selectedpos math random bucket size bucketsize rnd math random running total selected pos selectedpos bisect totals rnd add srv record srvrecord randomly chosen weight start result list srv record srvrecord chosensrvrecord bucket remove selected pos selectedpos res add chosensrvrecord res todo bisection stupid linear search bisect array pos element array element pos pos