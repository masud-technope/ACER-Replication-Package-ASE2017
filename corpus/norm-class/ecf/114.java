copyright remy chi jian suen rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors remy chi jian suen initial api implementation org eclipse ecf provider data share datashare nio java byte array input stream bytearrayinputstream java byte array output stream bytearrayoutputstream java io exception ioexception java object input stream objectinputstream java object output stream objectoutputstream java net server socket serversocket java net socket address socketaddress java nio byte buffer bytebuffer java nio channels server socket channel serversocketchannel java nio channels socket channel socketchannel java util array list arraylist java util collection java util hash map hashmap java util hash set hashset java util iterator java util linked list linkedlist java util list java util map org eclipse core runtime org eclipse core runtime i safe runnable isaferunnable org eclipse core runtime i status istatus org eclipse core runtime safe runner saferunner org eclipse core runtime status org eclipse ecf core identity org eclipse ecf core util ecf exception ecfexception org eclipse ecf data share datashare i channel ichannel org eclipse ecf data share datashare i channel listener ichannellistener org eclipse ecf data share datashare events i channel connect event ichannelconnectevent org eclipse ecf data share datashare events i channel disconnect event ichanneldisconnectevent org eclipse ecf data share datashare events i channel event ichannelevent org eclipse ecf data share datashare events i channel message event ichannelmessageevent implementation code i channel ichannel code java nio api s apis sending retrieving data channel inherently spawn multiple socket connections messages remote clients link send message sendmessage not e note current implementation handle repeated invocations method refer javadoc subclasses implement communicating local establishing socket connection link send request sendrequest facilitate logging stat uses statuses link log i status istatus note int erim interim api dev elopment development expected change reaching stability early stage solicit feedback pioneering adopters under standin g understanding code api broken repeatedly api evolves nio channel niochannel i channel ichannel nio datas hare container niodatasharecontainer data share container datasharecontainer originating owner container data share datashare container created channel container id containerid channel server socket list ening listening incoming connections channel blocking server socket channel serversocketchannel server socket channel serversocketchannel port server socket list ening listening incoming connections server socket channel serversocketchannel get local port getlocalport local port localport map code code code socket channel socketchannel code map connected sockets connectedsockets list sockets waiting handshake remote peers list pending sockets pendingsockets queue messages remote clients linked list linkedlist messages channel listener code code i channel listener ichannellistener listener thread responsible processing incoming messages sending messages remote peers thread processing thread processingthread ins tantiates instantiates channel sending receiving messages blocking manner sockets param data share container datasharecontainer source nio datas hare container niodatasharecontainer created channel code code param container id containerid originating owner container data share datashare container created channel parent container data share datashare container code code param channel code code param listener channel listener channel code code not ification notification required ecf exception ecfexception error occurred creating channel nio channel niochannel nio datas hare container niodatasharecontainer data share container datasharecontainer container id containerid i channel listener ichannellistener listener ecf exception ecfexception is not null isnotnull data share container datasharecontainer nls datas hare datashare container nls is not null isnotnull container id containerid container nls is not null isnotnull channel data share container datasharecontainer data share container datasharecontainer container id containerid container id containerid listener listener open server socket server socket channel serversocketchannel server socket channel serversocketchannel open server socket channel serversocketchannel configure blocking configureblocking io exception ioexception ecf exception ecfexception status i status istatus error util plugin create server socket bind local port server socket serversocket socket server socket channel serversocketchannel socket socket bind get bind address getbindaddress get back log getbacklog io exception ioexception ecf exception ecfexception status i status istatus error util plugin bind server socket local port localport server socket channel serversocketchannel socket get local port getlocalport connected sockets connectedsockets hash map hashmap pending sockets pendingsockets array list arraylist messages linked list linkedlist processing thread processingthread thread processing runnable processingrunnable get class getclass get name getname thread nls to string tostring processing thread processingthread start fires channel connected event channel listener attached param container id containerid target container connected fire channel connect event firechannelconnectevent container id containerid i channel listener ichannellistener listener get listener getlistener listener fire channel event firechannelevent listener i channel connect event ichannelconnectevent get channel d getchannelid get target d gettargetid container id containerid string to string tostring string buffer stringbuffer buffer string buffer stringbuffer buffer append i channel connect event ichannelconnectevent nls buffer append channel append nls nls buffer append target append container id containerid append nls buffer to string tostring fires channel disconnected event channel listener attached param container id containerid target container disconnected fire channel disconnect event firechanneldisconnectevent container id containerid i channel listener ichannellistener listener get listener getlistener listener fire channel event firechannelevent listener i channel disconnect event ichanneldisconnectevent get channel d getchannelid get target d gettargetid container id containerid string to string tostring string buffer stringbuffer buffer string buffer stringbuffer buffer append i channel disconnect event ichanneldisconnectevent nls buffer append channel append nls nls buffer append target append container id containerid append nls buffer to string tostring log i status istatus status returns add ress address channel server socket bind code code port valid local add ress address channel server socket bind add ress address code code socket address socketaddress get bind address getbindaddress retrieves listen back log backlog length channel server socket equal length channel server socket listen back log backlog length get back log getbacklog s ends sends pending messages queue d queued send pending messages sendpendingmessages collection dead sockets deadsockets collection processed messages processedmessages iterator messages iterator has next hasnext channel message channelmessage message channel message channelmessage message get id getid socket channel socketchannel channel socket channel socketchannel connected sockets connectedsockets check socket target message channel data message get data getdata flush data regular method saves extra work const antly constantly flip clear byte buffer bytebuffer ensures message piece chunks channel configure blocking configureblocking channel socket get output stream getoutputstream write data channel socket get output stream getoutputstream flush turn blocking channel configure blocking configureblocking io exception ioexception log status i status istatus error util plugin error occurred sending message dead sockets deadsockets dead sockets deadsockets hash set hashset dead sockets deadsockets add processed messages processedmessages processed messages processedmessages linked list linkedlist store processed message processed messages processedmessages add message remove messages processed processed messages processedmessages messages remove all removeall processed messages processedmessages dead sockets deadsockets iterator dead sockets deadsockets iterator has next hasnext socket channel socketchannel channel socket channel socketchannel connected sockets connectedsockets remove util close channel closechannel channel reads incoming messages remote clients param buffer buffer reading socket io exception ioexception error occurs reading socket process incoming messages processincomingmessages byte buffer bytebuffer buffer io exception ioexception collection dead sockets deadsockets iterator connected sockets connectedsockets entry set entryset iterator has next hasnext map entry entry map entry socket channel socketchannel socket channel socketchannel socket channel socketchannel entry get value getvalue process incoming messages processincomingmessages socket channel socketchannel buffer dead sockets deadsockets dead sockets deadsockets hash set hashset dead sockets deadsockets add entry get key getkey io exception ioexception log status i status istatus error util plugin error occurred sending message dead sockets deadsockets dead sockets deadsockets hash set hashset dead sockets deadsockets add entry get key getkey dead sockets deadsockets iterator dead sockets deadsockets iterator has next hasnext socket channel socketchannel channel socket channel socketchannel connected sockets connectedsockets remove util close channel closechannel channel processes incoming messages channel reading buffer returns channel reached stream param socket channel socketchannel channel read messages param buffer buffer read messages code code channel active code code reached stream io exception ioexception error occurred read channel process incoming messages processincomingmessages socket channel socketchannel socket channel socketchannel byte buffer bytebuffer buffer io exception ioexception channel data channeldata channel data channeldata util read socket channel socketchannel buffer message channel data channeldata get data getdata message process incoming message processincomingmessage socket channel socketchannel message channel data channeldata is open isopen processes message received channel param socket channel socketchannel channel message param message message received process incoming message processincomingmessage socket channel socketchannel socket channel socketchannel message read notify i channel listener ichannellistener listener get listener getlistener listener listener convert data notify messages convert message messages fire message events firemessageevents listener socket channel socketchannel messages converts data read socket separate instances param message data read socket individual messages convert message read data byte array input stream bytearrayinputstream byte array input stream bytearrayinputstream bais byte array input stream bytearrayinputstream message instantiate object input stream objectinputstream read individual bytes object input stream objectinputstream bais read object readobject bais bytes collection array list arraylist add bytes bais instantiate object input stream objectinputstream read individual bytes object input stream objectinputstream bais read object readobject store add bytes individual to array toarray size io exception ioexception class not found exception classnotfoundexception fires message events listener message received param listener listener notify param socket channel socketchannel socket message read param messages messages received fire message events firemessageevents i channel listener ichannellistener listener socket channel socketchannel socket channel socketchannel messages messages length i channel event ichannelevent event create message event createmessageevent socket channel socketchannel messages event fire channel event firechannelevent listener event not ifies notifies listener channel event code safe runner saferunner ensure program flow event errors not ification notification param listener listener notify param event event fire fire channel event firechannelevent i channel listener ichannellistener listener i channel event ichannelevent event safe runner saferunner send not ification notification ensure client side failures channel die safe runner saferunner i safe runnable isaferunnable exception listener handle channel event handlechannelevent event handle exception handleexception throwable log status i status istatus error util plugin error handling channel event creates returns message event channel data read param channel socket channel message param data message remote peer message event describing received message code code channel identified i channel event ichannelevent create message event createmessageevent socket channel socketchannel channel data search channel iterator connected sockets connectedsockets entry set entryset iterator has next hasnext map entry entry map entry channel entry get value getvalue from id fromid entry get key getkey i channel message event ichannelmessageevent get data getdata data get from container d getfromcontainerid from id fromid get channel d getchannelid string to string tostring string buffer stringbuffer buffer string buffer stringbuffer buffer append i channel message event ichannelmessageevent nls buffer append container append nls from id fromid nls buffer append channel append nls nls buffer append data append data append nls buffer to string tostring stores socket channel socket act ively actively reading sending messages param target socket connected param socket channel socketchannel socket channel stored socket channel socketchannel socket channel socketchannel connected sockets connectedsockets socket channel socketchannel accept socket potential client attempt handshake param socket channel socketchannel socket establish connection class not found exception classnotfoundexception object deserialized io exception ioexception net working networking error occurs socket reading sending messages accept socket channel socketchannel socket channel socketchannel byte buffer bytebuffer buffer class not found exception classnotfoundexception io exception ioexception read socket channel socketchannel read buffer buffer flip bytes read buffer bytes buffer clear object input stream objectinputstream ois object input stream objectinputstream byte array input stream bytearrayinputstream bytes object object ois read object readobject object bytes serialize socket channel socketchannel socket get output stream getoutputstream write bytes bytes serialize container id containerid socket channel socketchannel socket get output stream getoutputstream write bytes socket channel socketchannel socket get output stream getoutputstream flush socket channel socketchannel configure blocking configureblocking object socket channel socketchannel performs handshake remote peer socket channel returns code code attempts required note code code handshake successful remote peer closed channel code code returned attempts att empted attempted param socket channel socketchannel channel handshake remote peer param buffer buffer reading writing data channel code code handshake attempts required code code class not found exception classnotfoundexception deserialization failed handshake io exception ioexception error occurred performing handshake handshake socket channel socketchannel socket channel socketchannel byte buffer bytebuffer buffer class not found exception classnotfoundexception io exception ioexception channel data channeldata data util read socket channel socketchannel buffer data is open isopen channel dead close util close channel closechannel socket channel socketchannel bytes data get data getdata bytes object input stream objectinputstream ois object input stream objectinputstream byte array input stream bytearrayinputstream bytes object object ois read object readobject object socket channel socketchannel configure blocking configureblocking util serialize util serialize container id containerid bytes length length system arraycopy bytes length system arraycopy bytes length length socket channel socketchannel socket get output stream getoutputstream write bytes socket channel socketchannel socket get output stream getoutputstream flush socket channel socketchannel configure blocking configureblocking object socket channel socketchannel returns port open incoming socket connections open port socket connections send request sendrequest nio datas hare container niodatasharecontainer enqueue socket address socketaddress get local port getlocalport local port localport s ends sends request receiver notify socket open waiting incoming connections establish channel connection client decide request communication channel client dependent underlying provider net working networking protocol method invoked socket receiver param receiver receiver contact code code ecf exception ecfexception error occurred attempting send request get local port getlocalport nio datas hare container niodatasharecontainer enqueue socket address socketaddress send request sendrequest receiver ecf exception ecfexception send message sendmessage message ecf exception ecfexception ecf exception ecfexception status i status istatus error util plugin receiver send message sendmessage s ends sends message remote instance channel target peer note current implementation handle repeated invocations method success ion succession prior socket connection established opt imal optimal performance ass urance assurance success time lag message follow lag provider sufficient time establishing socket connection remote peer multiple invocations link send request sendrequest clients responsible handling individually param receiver receiver send message code code param message message send code code send message sendmessage receiver message ecf exception ecfexception nls is not null isnotnull receiver receiver nls is not null isnotnull message message check socket receiver connected sockets connectedsockets contains key containskey receiver send request receiver establishing socket connection send request sendrequest receiver messages enqueue message processing messages add channel message channelmessage receiver message disposes channel clients extend perform additional clean call code dispose code method returns dispose processing thread processingthread int errupt interrupt turn server prevent deny incoming connections server socket channel serversocketchannel server socket channel serversocketchannel close server socket channel serversocketchannel io exception ioexception server socket channel serversocketchannel connected sockets connectedsockets close connections iterator connected sockets connectedsockets values iterator has next hasnext socket channel socketchannel socket socket channel socketchannel util close channel closechannel socket connected sockets connectedsockets clear data share container datasharecontainer fire channel container deactivated event firechannelcontainerdeactivatedevent i channel listener ichannellistener get listener getlistener listener i channel listener ichannellistener set listener setlistener i channel listener ichannellistener listener i channel listener ichannellistener previous listener listener listener previous object get adapter getadapter adapter adapter adapter is instance isinstance getid processing runnable processingrunnable runnable byte buffer bytebuffer buffer byte buffer bytebuffer all ocate allocate thread sleep thread current thread currentthread is interrupted isinterrupted perform hand shaking handshaking pending sockets pending sockets pendingsockets size socket channel socketchannel channel socket channel socketchannel pending sockets pendingsockets handshake channel buffer remove handled pending sockets pendingsockets remove process incoming messages processincomingmessages buffer check pending messages send messages messages is empty isempty send pending messages sendpendingmessages socket channel socketchannel socket channel socketchannel server socket channel serversocketchannel accept socket channel socketchannel socket channel socketchannel configure blocking configureblocking pending sockets pendingsockets add socket channel socketchannel interrupted exception interruptedexception thread int errupted interrupted class not found exception classnotfoundexception log status i status istatus error util plugin deserialize io exception ioexception log status i status istatus error util plugin error occurred runtime exception runtimeexception log status i status istatus error util plugin runtime error occurred channel message channelmessage from id fromid data channel message channelmessage from id fromid data ecf exception ecfexception from id fromid from id fromid data convert data convert data ecf exception ecfexception byte array output stream bytearrayoutputstream baos byte array output stream bytearrayoutputstream object output stream objectoutputstream oos object output stream objectoutputstream baos oos write object writeobject data baos to byte array tobytearray io exception ioexception ecf exception ecfexception get id getid from id fromid get data getdata data