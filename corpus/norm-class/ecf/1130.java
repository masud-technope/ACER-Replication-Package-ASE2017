copyright jan rellermeyer systems group dep artment department computer science eth zurich rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors jan rellermeyer initial api implementation mark us markus alexander kuppe enhancements bug fixes ethz iks slp impl java buffered input stream bufferedinputstream java data input stream datainputstream java data output stream dataoutputstream java io exception ioexception java net inet address inetaddress java net server socket serversocket java net socket java net unknown host exception unknownhostexception java util array list arraylist java util arrays java util hash map hashmap java util iterator java util list java util map java util sorted map sortedmap java util tree map treemap ethz iks slp service location exception servicelocationexception ethz iks slp service type servicetype ethz iks slp serviceurl jslp daemon required peer configured slp daemon running machine configurations d is tributions distributions intended machine openslp slp d slpd package d packaged author jan rellermeyer eth zurich slp daemon impl slpdaemonimpl slp daemon slpdaemon thread loop variable running map registered services string scope list serviceurls services map registered services registeredservices hash map hashmap sorted disposal services life times lifetimes expired expiration timestamp expirationtimestamp serviceurl service sorted map sortedmap service disposal queue servicedisposalqueue tree map treemap create slp daemon slpdaemon instance param tcp socket tcpsocket server socket exception wrong slp daemon impl slpdaemonimpl exception tcp server thread tcpserverthread service disposal thread servicedisposalthread slp core slpcore platform log debug logdebug jslp daemon starting register service slp framework scopes d as das service registered d as das param reg service registration serviceregistration register service registerservice service registration serviceregistration reg service service service reg iterator scope iter scopeiter reg scope list scopelist iterator scope iter scopeiter has next hasnext string scope string scope iter scopeiter scope scope to lower case tolowercase registered services registeredservices slp utils slputils add value addvalue registered services registeredservices scope service reg url get life time getlifetime serviceurl l ifetime lifetime per manent permanent service disposal queue servicedisposalqueue system current time millis currenttimemillis reg url get life time getlifetime array list arraylist array list arraylist service disposal queue servicedisposalqueue key set keyset iterator iter iterator iter has next hasnext object key iter service disposal queue servicedisposalqueue key equals reg url service disposal queue servicedisposalqueue remove key service disposal queue servicedisposalqueue reg url service disposal queue servicedisposalqueue notify all notifyall slp core slpcore platform log trace reg logtracereg registered reg url register service d as das scopes list da list dalist list slp core slpcore d as das scope find da list dalist da list dalist is empty isempty slp core slpcore no discovery nodiscovery slp core slpcore da lookup dalookup arrays as list aslist string string scope wait time incoming rep lies replies slp core slpcore d as das slp core slpcore d as das wait slp core slpcore config get wait time getwaittime interrupted exception interruptedexception da list dalist list slp core slpcore d as das scope service location exception servicelocationexception sle slp core slpcore platform log error logerror sle get message getmessage sle fill in stack trace fillinstacktrace da list dalist da list dalist is empty isempty string d as das string da list dalist to array toarray string da list dalist size service registration serviceregistration announcement service registration serviceregistration reg url reg service type servicetype reg scope list scopelist reg att list attlist reg locale announcement auth blocks authblocks reg auth blocks authblocks d as das length anno unce service announceservice d as das announcement slp core slpcore platform log trace reg logtracereg announced announcement url d as das service location exception servicelocationexception slp utils slputils remove value from all removevaluefromall slp core slpcore d as das d as das slp core slpcore daspis remove d as das slp core slpcore platform log error logerror get message getmessage fill in stack trace fillinstacktrace deregister service slp framework deregisters d as das scopes local service cache param dereg service deregistration service location exception servicelocationexception deregister service deregisterservice service deregistration servicederegistration dereg service location exception servicelocationexception string scopes string registered services registeredservices key set keyset to array toarray string registered services registeredservices size scopes length list tmp list registered services registeredservices scopes service services service tmp to array toarray service tmp size services length dereg url matches services url list da list dalist list slp core slpcore d as das scopes to lower case tolowercase da list dalist iterator da iter daiter da list dalist iterator da iter daiter has next hasnext string string da iter daiter dereg address inet address inetaddress get by name getbyname dereg port slp core slpcore slp reserved port dereg xid slp core slpcore next xid nextxid slp core slpcore config get security enabled getsecurityenabled list spi list spilist list slp core slpcore daspis dereg sign spi list spilist reply message replymessage reply slp core slpcore send message sendmessage dereg reply error code errorcode service location exception servicelocationexception reply error code errorcode error deregistration reply error code errorcode unknown host exception unknownhostexception uhe service location exception servicelocationexception service location exception servicelocationexception network error uhe get message getmessage registered services registeredservices slp utils slputils remove value removevalue registered services registeredservices scopes services incoming messages handled param msg message processed reply handled message tcp returned service location exception servicelocationexception reasons authentication failures reply message replymessage handle message handlemessage slp message slpmessage msg service location exception servicelocationexception msg string msg tcp tcp udp slp core slpcore platform log trace message logtracemessage received msg address msg port msg to string tostring reply message replymessage reply msg funcid slp message slpmessage srvrqst service request servicerequest req service request servicerequest msg list array list arraylist iterator scopes req scope list scopelist iterator scopes has next hasnext string scope string scopes list services list registered services registeredservices scope to lower case tolowercase services iterator srvs services iterator srvs has next hasnext service service service srvs service url get service type getservicetype matches req service type servicetype req predicate add service url req predicate match service attributes add service url result don send reply message times rfc str ictly strictly d emands demands multicast requests size req multicast reply service reply servicereply req slp core slpcore config get security enabled getsecurityenabled service reply servicereply reply sign req spi reply slp message slpmessage attr rqst attrrqst attribute request attributerequest attreq attribute request attributerequest msg list att result attresult array list arraylist iterator scopes attreq scope list scopelist iterator scopes has next hasnext string scope string scopes list services list registered services registeredservices scope to lower case tolowercase services request serviceurl service type servicetype object req service reqservice full url fullurl attreq url index of indexof req service reqservice service type servicetype attreq url full url fullurl req service reqservice serviceurl attreq url tag list empty attreq spi equals full url fullurl attreq tag list taglist is empty isempty iterator srvs services iterator srvs has next hasnext service service service srvs service url matches req service reqservice att result attresult add all addall slp utils slputils find matches findmatches attreq tag list taglist service attributes reply attribute reply attributereply attreq att result attresult slp core slpcore config get security enabled getsecurityenabled attribute reply attributereply reply sign attreq spi reply slp message slpmessage srvtyperqst service type request servicetyperequest str eq streq service type request servicetyperequest msg array list arraylist result array list arraylist iter ate iterate scopes iterator scope iter scopeiter str eq streq scope list scopelist iterator scope iter scopeiter has next hasnext iter ate iterate registered services string scope string scope iter scopeiter list services list registered services registeredservices scope to lower case tolowercase services iterator iter services iterator iter has next hasnext service service service iter service type servicetype type service url get service type getservicetype str eq streq naming authority namingauthority equals str eq streq naming authority namingauthority equals type get naming authority getnamingauthority equals str eq streq naming authority namingauthority result type result add type reply service type reply servicetypereply str eq streq result reply slp message slpmessage srvreg register service registerservice service registration serviceregistration msg reply service acknowledgement serviceacknowledgement msg reply slp message slpmessage srvdereg deregister service deregisterservice service deregistration servicederegistration msg reply service acknowledgement serviceacknowledgement msg reply slp message slpmessage srvack reply message replymessage rep reply message replymessage msg rep error code errorcode slp core slpcore platform log warning logwarning msg address rep lied replied error code rep error code errorcode rep exception parsing service location exception servicelocationexception service location exception servicelocationexception implemented message type slp message slpmessage get type gettype msg funcid implemented info rmed informed discovered registers services scopes param advert advert is ement advertisement new da discovered newdadiscovered d aa d ver tis ement daadvertisement advert find services scopes iterator iter advert scope list scopelist iterator iter has next hasnext string scope string iter list services list registered services registeredservices scope to lower case tolowercase services iterator service iter serviceiter services iterator service iter serviceiter has next hasnext register service service service service iter serviceiter service registration serviceregistration reg service registration serviceregistration service url service url get service type getservicetype arrays as list aslist object scope slp utils slputils dict to attr list dicttoattrlist service attributes slp core slpcore locale slp core slpcore platform log debug logdebug registering service url advert url anno unce service announceservice advert url reg service location exception servicelocationexception slp core slpcore platform log error logerror get message getmessage fill in stack trace fillinstacktrace register service param daaddress address code string code param reg code service registration serviceregistration code message service location exception servicelocationexception net work network errors anno unce service announceservice string daaddress service registration serviceregistration reg service location exception servicelocationexception reg address inet address inetaddress get by name getbyname daaddress reg port slp core slpcore slp reserved port reg xid slp core slpcore next xid nextxid slp core slpcore config get security enabled getsecurityenabled list spi list spilist list slp core slpcore daspis daaddress reg sign spi list spilist handle message handlemessage slp core slpcore send message sendmessage reg unknown host exception unknownhostexception slp core slpcore platform log error logerror service announcement daaddress failed fill in stack trace fillinstacktrace tcp server thread tcp server thread tcpserverthread thread server socket serversocket socket creates starts tcp server thread io exception ioexception socket creation fails tcp server thread tcpserverthread io exception ioexception socket server socket serversocket slp core slpcore slp port slp core slpcore get my p getmyip socket server socket serversocket slp core slpcore slp port start thread loop running socket con socket accept data input stream datainputstream data input stream datainputstream buffered input stream bufferedinputstream con get input stream getinputstream slp message slpmessage msg slp message slpmessage parse con get inet address getinetaddress con get port getport reply message replymessage reply handle message handlemessage msg reply slp core slpcore platform log trace message logtracemessage send reply reply address reply port reply data output stream dataoutputstream data output stream dataoutputstream con get output stream getoutputstream write reply get bytes getbytes todo rfc enc our ages encourages connection open side send multiple requests connection start server thread incoming connection closing connection request close close con close exception ioe slp core slpcore platform log error logerror exception tcp receiver thread ioe service disposal thread removes services local registry lifetime expired service disposal thread servicedisposalthread thread create start instance thread service disposal thread servicedisposalthread start thread main loop running service disposal queue servicedisposalqueue service disposal queue servicedisposalqueue is empty isempty sleep arrives slp core slpcore platform log debug logdebug service disposal thread servicedisposalthread sleeping service disposal queue servicedisposalqueue wait work next activity nextactivity service disposal queue servicedisposalqueue is empty isempty next activity nextactivity service disposal queue servicedisposalqueue first key firstkey long value longvalue system current time millis currenttimemillis serviceurl service serviceurl service disposal queue servicedisposalqueue next activity nextactivity service deregistration servicederegistration dereg service deregistration servicederegistration service slp core slpcore locale deregister service deregisterservice dereg service location exception servicelocationexception sle slp core slpcore platform log error logerror sle get message getmessage sle fill in stack trace fillinstacktrace slp core slpcore platform log trace reg logtracereg disposed service service service disposal queue servicedisposalqueue remove next activity nextactivity service disposal queue servicedisposalqueue is empty isempty act ivities activities sleep act ivity activity next activity nextactivity service disposal queue servicedisposalqueue first key firstkey wait time waittime next activity nextactivity long value longvalue system current time millis currenttimemillis wait time waittime slp core slpcore platform log debug logdebug sleeping wait time waittime seconds service disposal queue servicedisposalqueue wait wait time waittime interrupted exception interruptedexception